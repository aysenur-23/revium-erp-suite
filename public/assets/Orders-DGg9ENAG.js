var ds=Object.defineProperty,ps=Object.defineProperties;var hs=Object.getOwnPropertyDescriptors;var Fe=Object.getOwnPropertySymbols;var gs=Object.prototype.hasOwnProperty,fs=Object.prototype.propertyIsEnumerable;var qe=(n,u,e)=>u in n?ds(n,u,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[u]=e,xe=(n,u)=>{for(var e in u||(u={}))gs.call(u,e)&&qe(n,e,u[e]);if(Fe)for(var e of Fe(u))fs.call(u,e)&&qe(n,e,u[e]);return n},ue=(n,u)=>ps(n,hs(u));var B=(n,u,e)=>new Promise((w,b)=>{var c=f=>{try{_(e.next(f))}catch(i){b(i)}},o=f=>{try{_(e.throw(f))}catch(i){b(i)}},_=f=>f.done?w(f.value):Promise.resolve(f.value).then(c,o);_((e=e.apply(n,u)).next())});import{u as js,a as j,j as s,B as T,s as Ye,t as Ie,v as Ge,C as W,p as re,q as oe,b as Q,w as ys,x as bs,r as Ns,S as He,c as We,d as Qe,e as Je,f as g,T as Xe}from"./index-BQmY0BmM.js";import{r as x,H as Ze,aa as vs,ab as ws,ac as Ss,X as Cs,n as ts,l as ks,J as Ts,K as _s,N as Ds,O as ls,g as ns,T as is,S as cs,y as As,h as Os,k as Bs,i as Rs,o as Ms,ad as $s,P as Ps,ae as zs,af as Es}from"./lucide-react-CAeuRJQk.js";import{p as ms,o as xs,D as Ls,a as Vs,b as Ks,c as Us,e as Fs,B as Ne,J as qs,K as es,u as ss,L as Ys,N as Is,O as Gs,M as as,d as Hs}from"./MainLayout-Dv9j77B5.js";import{S as Ws}from"./search-input-DCf0xYml.js";import{T as us,a as rs,b as pe,c as v,d as os,e as y}from"./table-zhTdMUM_.js";import{A as Qs,a as Js,b as Xs,c as Zs,d as ea,e as sa,f as aa,g as ta}from"./alert-dialog-vDPnsgl6.js";import{C as la}from"./CreateOrderDialog-BMioWDNS.js";import{S as na}from"./separator-C1rUq6WW.js";import{C as Be}from"./currency-BpxR3_y8.js";import{C as ia}from"./CustomerDetailModal-DKJKtFVM.js";import{L as ca}from"./loading-state-BC76X596.js";import"./taskService-CI62TrOj.js";import"./CustomerCombobox-LwAUFZox.js";import"./popover-Bq_PZ6uK.js";import"./CreateCustomerDialog-C7Uvoya8.js";import"./isSameDay-CbFR9PGK.js";import"./format-CN3feEER.js";import"./subDays-DIU4Ell8.js";import"./addDays-DpNspVkx.js";import"./isBefore-DY2_5hKP.js";import"./reportService-yUgxtgcG.js";import"./storageService-BUAGZT8Z.js";import"./driveService-ChwQKMyd.js";const de=[{value:"draft",label:"Taslak",icon:As,color:"text-muted-foreground"},{value:"pending",label:"Beklemede",icon:Os,color:"text-amber-500"},{value:"planned",label:"Planlandı",icon:Bs,color:"text-blue-500"},{value:"confirmed",label:"Onaylandı",icon:Rs,color:"text-emerald-500"},{value:"in_production",label:"Üretimde",icon:Ms,color:"text-blue-600"},{value:"quality_check",label:"Kalite Kontrolü",icon:ns,color:"text-purple-500"},{value:"completed",label:"Tamamlandı",icon:ts,color:"text-emerald-600"},{value:"shipped",label:"Kargoda",icon:ls,color:"text-sky-500"},{value:"delivered",label:"Teslim Edildi",icon:$s,color:"text-primary"}],Oe=n=>n?n==="in_progress"?"in_production":n:"draft",te=n=>n?typeof n=="string"||n instanceof Date?n:n!=null&&n.seconds?new Date(n.seconds*1e3):n!=null?n:null:null,q=(n,u)=>{const e=typeof n=="number"?n:Number(n)||0,w=u||"TRY",b=w==="TRY"?"TRY":w,c=w==="TRY"?"tr-TR":"en-US",o=Be[w]||"₺";try{return new Intl.NumberFormat(c,{style:"currency",currency:b,minimumFractionDigits:2}).format(e)}catch(_){return`${o}${e.toFixed(2)}`}},Y=n=>{if(!n)return"-";const u=n instanceof Date?n:new Date(n);return Number.isNaN(u.getTime())?"-":u.toLocaleDateString("tr-TR",{day:"2-digit",month:"short",year:"numeric"})},ma=({open:n,onOpenChange:u,order:e,onEdit:w,onDelete:b})=>{var L,je,me,H,k,ye,Me,$e,Pe,ze,Ee,Le,Ve,Ke,Ue;const{user:c,isAdmin:o}=js(),[_,f]=x.useState([]),[i,V]=x.useState(null),[ve,M]=x.useState(!0),[J,D]=x.useState(!1),[$,K]=x.useState(Oe(e==null?void 0:e.status)),[U,I]=x.useState(e==null?void 0:e.approvalStatus),[P,we]=x.useState({}),z=(e==null?void 0:e.order_number)||(e==null?void 0:e.orderNumber)||(e==null?void 0:e.id),X=te((e==null?void 0:e.order_date)||(e==null?void 0:e.orderDate)),Z=te((e==null?void 0:e.delivery_date)||(e==null?void 0:e.deliveryDate)),Se=te((e==null?void 0:e.received_date)||(e==null?void 0:e.receivedDate)),ee=te((e==null?void 0:e.due_date)||(e==null?void 0:e.dueDate)),he=te((e==null?void 0:e.created_at)||(e==null?void 0:e.createdAt)),Ce=te((e==null?void 0:e.updated_at)||(e==null?void 0:e.updatedAt)),ke=(e==null?void 0:e.payment_terms)||(e==null?void 0:e.paymentTerms)||"-",le=(e==null?void 0:e.delivery_address)||(e==null?void 0:e.shippingAddress)||(e==null?void 0:e.shipping_address),ne=(e==null?void 0:e.delivery_notes)||(e==null?void 0:e.shippingNotes)||(e==null?void 0:e.shipping_notes),S=(e==null?void 0:e.currency)||"TRY",Te=_.reduce((a,m)=>a+(Number(m.quantity)||0),0),se=_.reduce((a,m)=>a+(Number(m.discount)||0),0),t=Number((me=(je=(L=e==null?void 0:e.subtotal)!=null?L:e==null?void 0:e.totalAmount)!=null?je:e==null?void 0:e.total)!=null?me:0),d=Number((k=(H=e==null?void 0:e.tax)!=null?H:e==null?void 0:e.taxAmount)!=null?k:0),C=Number((Me=(ye=e==null?void 0:e.total)!=null?ye:e==null?void 0:e.totalAmount)!=null?Me:t+d-se),N=(($e=c==null?void 0:c.roles)==null?void 0:$e.includes("manager"))||o,A=(c==null?void 0:c.id)===(e==null?void 0:e.createdBy),ie=N||o,ce=N||o||A,_e=[{label:"Kalem Sayısı",value:_.length||0,icon:Ze,helper:"Siparişe bağlı ürün",accent:"from-blue-50/80 via-white to-white border-blue-100",tooltip:"Bu siparişe eklenmiş toplam satır sayısı"},{label:"Toplam Miktar",value:Te,icon:vs,helper:"Siparişteki toplam adet",accent:"from-indigo-50/80 via-white to-white border-indigo-100",tooltip:"Ürün miktarlarının toplamı"},{label:"Ara Toplam",value:q((ze=(Pe=e==null?void 0:e.subtotal)!=null?Pe:e==null?void 0:e.total)!=null?ze:0,S),icon:ws,helper:"Vergi & indirim öncesi",accent:"from-slate-50/80 via-white to-white border-slate-100",tooltip:"KDV ve indirim uygulanmadan önceki tutar"},{label:"İndirim",value:se?`-${q(se,S)}`:"-",icon:Ss,helper:"Ürün bazlı indirim",accent:"from-emerald-50/80 via-white to-white border-emerald-100",tooltip:"Kalemlere uygulanan toplam indirim"}],De=[{label:"Sipariş No",value:z},{label:"Sipariş Edilen Tarih",value:Y(X)},{label:"Teslimat Tarihi",value:Y(Z)},{label:"Teslim Alınan Tarih",value:Y(Se)},{label:"Son Ödeme",value:Y(ee)},{label:"Para Birimi",value:S},{label:"Ödeme Şartı",value:ke},{label:"Oluşturan",value:e!=null&&e.createdBy?P[e.createdBy]||((Ee=e==null?void 0:e.creator)==null?void 0:Ee.full_name)||"-":((Le=e==null?void 0:e.creator)==null?void 0:Le.full_name)||"-"},{label:"Son Güncelleme",value:Y(Ce)}],ge=[z&&{label:"Sipariş No",value:z},he&&{label:"Oluşturulma",value:Y(he)},ee&&{label:"Son Ödeme",value:Y(ee)},S&&{label:"Para Birimi",value:S}].filter(Boolean);x.useEffect(()=>{e!=null&&e.id&&n&&(Re(),I(e.approvalStatus))},[e,n]),x.useEffect(()=>{n&&B(void 0,null,function*(){try{const m=yield Ns(),O={};m.forEach(R=>{O[R.id]=R.fullName||R.displayName||R.email||"Bilinmeyen"}),we(O)}catch(m){console.error("Error loading users:",m)}})},[n]),x.useEffect(()=>{K(Oe(e==null?void 0:e.status))},[e==null?void 0:e.status]);const Re=()=>B(void 0,null,function*(){M(!0);try{const a=yield ms(e.id);if(f(a),e.customer_id||e.customerId){const m=e.customer_id||e.customerId,O=yield xs(m);V(O)}}catch(a){console.error("Fetch order details error:",a),j.error("Detaylar yüklenirken hata: "+(a.message||"Bilinmeyen hata"))}finally{M(!1)}}),G=a=>{switch(a){case"draft":return"outline";case"pending":return"secondary";case"confirmed":return"default";case"in_production":case"in_progress":return"secondary";case"completed":return"default";case"shipped":return"secondary";case"delivered":return"default";case"cancelled":return"destructive";default:return"outline"}},F=a=>({draft:"Taslak",pending:"Beklemede",confirmed:"Onaylandı",planned:"Planlandı",in_production:"Üretimde",in_progress:"Üretimde",quality_check:"Kalite Kontrolü",completed:"Tamamlandı",shipped:"Kargoda",delivered:"Teslim Edildi",cancelled:"İptal Edildi",on_hold:"Beklemede"})[a]||a,fe=()=>{const a=Oe($),m=de.findIndex(O=>O.value===a);return m===-1?0:m},l=()=>{const a=fe();return a===-1||a>=de.length-1?null:de[a+1]},h=a=>B(void 0,null,function*(){if(!(!(e!=null&&e.id)||!(c!=null&&c.id))){D(!0);try{if(a==="completed"){if(!(o||N||A)){yield qs(e.id,c.id),I("pending"),j.success("Sipariş tamamlandı olarak işaretlendi ve onay için yöneticiye gönderildi."),D(!1);return}yield es(e.id,c.id),K("completed"),I("approved"),j.success(`Sipariş durumu ${F("completed")} olarak güncellendi.`),D(!1);return}yield ss(e.id,{status:a},c.id,o),K(a),j.success(`Sipariş durumu ${F(a)} olarak güncellendi.`)}catch(m){console.error("Order status update error:",m),j.error("Durum güncellenemedi: "+((m==null?void 0:m.message)||"Bilinmeyen hata"))}finally{D(!1)}}}),p=()=>B(void 0,null,function*(){if(!(!(e!=null&&e.id)||!(c!=null&&c.id)))try{yield es(e.id,c.id),K("completed"),I("approved"),j.success("Sipariş onayı kabul edildi.")}catch(a){j.error("Onaylama başarısız: "+a.message)}}),r=()=>B(void 0,null,function*(){if(!(!(e!=null&&e.id)||!(c!=null&&c.id)))try{yield Ys(e.id,c.id),K("in_production"),I("rejected"),j.success("Sipariş onayı reddedildi.")}catch(a){j.error("Reddetme başarısız: "+a.message)}}),E=a=>B(void 0,null,function*(){if(!(!(e!=null&&e.id)||!(c!=null&&c.id)||!o&&!N)){D(!0);try{yield ss(e.id,{status:a},c.id,o),K(a),j.success(`Sipariş durumu ${F(a)} olarak güncellendi.`)}catch(m){console.error("Order status revert error:",m),j.error("Durum güncellenemedi: "+((m==null?void 0:m.message)||"Bilinmeyen hata"))}finally{D(!1)}}});return s.jsx(Ls,{open:n,onOpenChange:u,children:s.jsx(Vs,{className:"!max-w-[100vw] sm:!max-w-[95vw] !w-[100vw] sm:!w-[95vw] !h-[100vh] sm:!h-[90vh] !max-h-[100vh] sm:!max-h-[90vh] !left-0 sm:!left-[2.5vw] !top-0 sm:!top-[5vh] !right-0 sm:!right-auto !bottom-0 sm:!bottom-auto !translate-x-0 !translate-y-0 overflow-hidden !p-0 gap-0 bg-white flex flex-col !m-0 !rounded-none sm:!rounded-lg !border-0 sm:!border",children:s.jsxs("div",{className:"flex flex-col h-full min-h-0",children:[s.jsx(Ks,{className:"p-3 sm:p-4 border-b bg-white flex-shrink-0",children:s.jsxs("div",{className:"flex items-center justify-between gap-3",children:[s.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 flex-1 min-w-0",children:[s.jsx("div",{className:"h-8 w-8 sm:h-10 sm:w-10 rounded-lg bg-primary/10 flex items-center justify-center border border-primary/20 flex-shrink-0",children:s.jsx(Ze,{className:"h-4 w-4 sm:h-5 sm:w-5 text-primary"})}),s.jsxs(Us,{className:"text-lg sm:text-xl font-semibold text-foreground truncate",children:["Sipariş Detayı - ",z]}),s.jsx(Fs,{className:"sr-only",children:"Sipariş detayları ve bilgileri"})]}),s.jsxs("div",{className:"flex flex-wrap gap-2 flex-shrink-0 relative z-10 pr-10 sm:pr-12",children:[U==="pending"&&s.jsx(Ne,{variant:"outline",className:"border-yellow-500 text-yellow-600 bg-yellow-50 text-xs px-2 sm:px-3 py-1 relative z-10",children:"Onay Bekliyor"}),s.jsx(Ne,{variant:G($),className:"text-xs px-2 sm:px-3 py-1 relative z-10",children:F($)})]})]})}),ge.length>0&&s.jsx("div",{className:"px-3 sm:px-4 py-2 border-b bg-gray-50/50 flex flex-wrap items-center gap-2 flex-shrink-0",children:ge.map(a=>s.jsxs("div",{className:"flex items-center gap-1 rounded-full border bg-muted/40 px-3 py-1.5 text-xs font-medium text-muted-foreground",children:[s.jsxs("span",{className:"text-muted-foreground/70",children:[a.label,":"]}),s.jsx("span",{className:"text-foreground",children:a.value})]},`${a.label}-${a.value}`))}),s.jsx("div",{className:"flex-1 overflow-hidden bg-gray-50/50 p-3 sm:p-4 min-h-0",children:s.jsx("div",{className:"max-w-full mx-auto h-full overflow-y-auto",children:ve?s.jsx("div",{className:"flex items-center justify-center py-8",children:s.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}):s.jsxs("div",{className:"space-y-6",children:[U==="pending"&&s.jsx("div",{className:"p-4 bg-yellow-50 border border-yellow-200 rounded-lg",children:s.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4",children:[s.jsxs("div",{children:[s.jsx("h4",{className:"text-sm font-semibold text-yellow-900",children:"Sipariş Tamamlanma Onayı Bekliyor"}),s.jsx("p",{className:"text-sm text-yellow-700",children:"Bu sipariş tamamlandı olarak işaretlendi ve onayınızı bekliyor."})]}),ce&&s.jsxs("div",{className:"flex gap-2 w-full sm:w-auto",children:[s.jsxs(T,{size:"sm",variant:"outline",className:"flex-1 sm:flex-none border-yellow-300 text-yellow-900 hover:bg-yellow-100",onClick:r,children:[s.jsx(Cs,{className:"h-4 w-4 mr-1"}),"Reddet"]}),s.jsxs(T,{size:"sm",className:"flex-1 sm:flex-none bg-yellow-600 hover:bg-yellow-700 text-white border-none",onClick:p,children:[s.jsx(ts,{className:"h-4 w-4 mr-1"}),"Onayla"]})]})]})}),s.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-4 gap-4 auto-rows-fr",children:_e.map(a=>{const m=a.icon;return s.jsxs(Ye,{delayDuration:150,children:[s.jsx(Ie,{asChild:!0,children:s.jsxs("div",{className:`rounded-2xl border bg-gradient-to-br text-card-foreground p-4 shadow-sm transition hover:shadow-md hover:-translate-y-0.5 h-full ${a.accent}`,children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-xs uppercase tracking-wide text-muted-foreground",children:a.label}),s.jsx("p",{className:"text-2xl font-semibold mt-1 leading-tight",children:a.value})]}),s.jsx("div",{className:"rounded-full border p-2 bg-white/75 shadow-inner shrink-0",children:s.jsx(m,{className:"h-5 w-5 text-primary"})})]}),s.jsx("p",{className:"text-xs text-muted-foreground mt-3",children:a.helper})]})}),s.jsx(Ge,{children:a.tooltip})]},a.label)})}),s.jsxs(W,{children:[s.jsx(re,{className:"space-y-1",children:s.jsxs("div",{className:"flex items-center justify-between gap-3",children:[s.jsxs("div",{children:[s.jsx(oe,{className:"text-lg",children:"Sipariş Durumu"}),s.jsx("p",{className:"text-sm text-muted-foreground",children:l()?`${F($)} aşamasındasınız. Sıradaki adım: ${l().label}`:"Workflow tamamlandı."})]}),s.jsxs("div",{className:"text-xs text-muted-foreground text-right",children:["Son güncelleyen: ",e!=null&&e.statusUpdatedBy?P[e.statusUpdatedBy]||e.statusUpdatedBy:(c==null?void 0:c.fullName)||"-",s.jsx("br",{}),s.jsx("span",{className:"text-[11px]",children:e!=null&&e.statusUpdatedAt?Y(e.statusUpdatedAt):""})]})]})}),s.jsx(Q,{className:"p-3 sm:p-4 md:p-6",children:s.jsxs("div",{className:"space-y-3 sm:space-y-4",children:[s.jsx("div",{className:"flex items-center justify-between overflow-x-auto overflow-y-visible pt-2 pb-4",children:de.map((a,m)=>{const O=a.icon,R=fe(),be=m===R,ae=m<R,Ae=(o||N)&&ae&&a.value!=="cancelled"&&U!=="pending";return s.jsxs("div",{className:"flex items-center flex-1 min-w-0",children:[s.jsxs("div",{className:"flex flex-col items-center flex-1 min-w-0",children:[s.jsxs(Ye,{delayDuration:150,children:[s.jsx(Ie,{asChild:!0,children:s.jsx("div",{className:`
                                    w-10 h-10 rounded-full flex items-center justify-center border-2 transition-all relative z-10
                                    ${be?"bg-primary text-primary-foreground border-primary scale-110":""}
                                    ${ae?"bg-green-500 text-white border-green-500":""}
                                    ${!be&&!ae?"bg-muted border-muted-foreground/20":""}
                                    ${Ae?"cursor-pointer hover:scale-105 hover:ring-2 hover:ring-primary/50":""}
                                  `,onClick:()=>{Ae&&E(a.value)},children:s.jsx(O,{className:`h-5 w-5 ${be||ae?"text-white":a.color}`})})}),s.jsx(Ge,{children:Ae?`${a.label} durumuna geri dönmek için tıklayın`:a.label})]}),s.jsx("p",{className:`text-xs mt-2 text-center font-medium ${be?"text-primary":ae?"text-green-600":"text-muted-foreground"}`,children:a.label})]}),m<de.length-1&&s.jsx("div",{className:`flex-1 h-0.5 mx-2 ${ae?"bg-green-500":"bg-muted"}`})]},a.value)})}),l()&&$!=="delivered"&&$!=="cancelled"&&U!=="pending"&&s.jsx("div",{className:"flex justify-center pt-4 border-t",children:s.jsx(T,{onClick:()=>h(l().value),disabled:J,className:"gap-2",children:J?s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"Güncelleniyor..."]}):s.jsxs(s.Fragment,{children:[(()=>{const a=l().icon;return s.jsx(a,{className:"h-4 w-4"})})(),l().label," Durumuna Geç"]})})})]})})]}),s.jsxs("div",{className:"grid gap-4 sm:gap-6 grid-cols-1 lg:grid-cols-2",children:[s.jsxs(W,{children:[s.jsxs(re,{className:"space-y-1",children:[s.jsx(oe,{className:"text-lg",children:"Müşteri Bilgileri"}),s.jsx("p",{className:"text-sm text-muted-foreground",children:"İletişim ve teslimat detayları"})]}),s.jsxs(Q,{className:"space-y-3 sm:space-y-4",children:[s.jsxs("div",{className:"space-y-2 sm:space-y-3",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(ks,{className:"h-4 w-4 text-muted-foreground"}),s.jsx("span",{className:"font-medium",children:(i==null?void 0:i.name)||(e==null?void 0:e.customerName)||(e==null?void 0:e.customer_name)||"-"})]}),((i==null?void 0:i.company)||(e==null?void 0:e.customerCompany))&&s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(Ts,{className:"h-4 w-4 text-muted-foreground"}),s.jsx("span",{children:(i==null?void 0:i.company)||(e==null?void 0:e.customerCompany)||(e==null?void 0:e.customer_company)})]}),((i==null?void 0:i.phone)||(e==null?void 0:e.customerPhone))&&s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(_s,{className:"h-4 w-4 text-muted-foreground"}),s.jsx("span",{children:ys((i==null?void 0:i.phone)||(e==null?void 0:e.customerPhone)||(e==null?void 0:e.customer_phone))})]}),((i==null?void 0:i.email)||(e==null?void 0:e.customerEmail))&&s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(Ds,{className:"h-4 w-4 text-muted-foreground"}),s.jsx("span",{children:(i==null?void 0:i.email)||(e==null?void 0:e.customerEmail)||(e==null?void 0:e.customer_email)})]})]}),((i==null?void 0:i.phone)||(i==null?void 0:i.email)||(e==null?void 0:e.customerPhone)||(e==null?void 0:e.customerEmail))&&s.jsxs("div",{className:"flex flex-wrap gap-3 pt-1",children:[((i==null?void 0:i.phone)||(e==null?void 0:e.customerPhone))&&s.jsx(T,{variant:"outline",size:"sm",asChild:!0,children:s.jsx("a",{href:`tel:${bs((i==null?void 0:i.phone)||(e==null?void 0:e.customerPhone)||(e==null?void 0:e.customer_phone))}`,children:"Ara"})}),((i==null?void 0:i.email)||(e==null?void 0:e.customerEmail))&&s.jsx(T,{variant:"outline",size:"sm",onClick:()=>{const a=(i==null?void 0:i.email)||(e==null?void 0:e.customerEmail)||(e==null?void 0:e.customer_email);a&&window.open(`https://mail.google.com/mail/?view=cm&fs=1&to=${encodeURIComponent(a)}`,"_blank")},children:"E-posta Gönder"})]}),(le||ne)&&s.jsxs("div",{className:"space-y-2 rounded-lg border bg-muted/40 p-3",children:[s.jsxs("p",{className:"text-sm font-medium text-muted-foreground flex items-center gap-2",children:[s.jsx(ls,{className:"h-4 w-4"}),"Teslimat Bilgileri"]}),le&&s.jsx("p",{className:"text-sm",children:le}),ne&&s.jsx("p",{className:"text-xs text-muted-foreground",children:ne})]})]})]}),s.jsxs(W,{children:[s.jsx(re,{children:s.jsx(oe,{className:"text-lg",children:"Sipariş Bilgileri"})}),s.jsxs(Q,{className:"space-y-3 sm:space-y-4",children:[s.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4",children:De.map(a=>s.jsxs("div",{className:"rounded-lg border bg-muted/30 px-3 py-2",children:[s.jsx("p",{className:"text-xs text-muted-foreground uppercase tracking-wide",children:a.label}),s.jsx("p",{className:"text-sm font-medium mt-1",children:a.value||"-"})]},a.label))}),(e==null?void 0:e.notes)&&s.jsxs("div",{className:"rounded-lg border bg-muted/20 p-3",children:[s.jsxs("p",{className:"text-sm text-muted-foreground mb-1 flex items-center gap-2",children:[s.jsx(ns,{className:"h-4 w-4"}),"İç Not"]}),s.jsx("p",{className:"text-sm leading-relaxed",children:e.notes})]})]})]})]}),s.jsxs(W,{children:[s.jsx(re,{children:s.jsx(oe,{className:"text-lg",children:"Ürünler"})}),s.jsx(Q,{className:"p-4 sm:p-6",children:_.length?s.jsx("div",{className:"rounded-lg border",children:s.jsxs(us,{children:[s.jsx(rs,{children:s.jsxs(pe,{children:[s.jsx(v,{children:"Ürün"}),s.jsx(v,{children:"SKU"}),s.jsx(v,{children:"Kategori"}),s.jsx(v,{className:"text-right",children:"Miktar"}),s.jsx(v,{className:"text-right",children:"Birim Fiyat"}),s.jsx(v,{className:"text-right",children:"İndirim"}),s.jsx(v,{className:"text-right",children:"Toplam"})]})}),s.jsx(os,{children:_.map(a=>{var m,O,R;return s.jsxs(pe,{children:[s.jsx(y,{className:"font-medium",children:((m=a.products)==null?void 0:m.name)||a.productName||a.product_name||"-"}),s.jsx(y,{children:((O=a.products)==null?void 0:O.sku)||"-"}),s.jsx(y,{children:a.category||"-"}),s.jsx(y,{className:"text-right",children:a.quantity}),s.jsx(y,{className:"text-right",children:q((R=a.unit_price)!=null?R:a.unitPrice,S)}),s.jsx(y,{className:"text-right text-destructive",children:a.discount?`-${q(a.discount,S)}`:"-"}),s.jsx(y,{className:"text-right font-semibold",children:q(a.total,S)})]},a.id)})})]})}):s.jsx("div",{className:"text-center text-sm text-muted-foreground py-6",children:"Bu siparişe ait ürün bulunamadı."})})]}),s.jsxs(W,{children:[s.jsx(re,{children:s.jsx(oe,{className:"text-lg",children:"Finansal Özet"})}),s.jsx(Q,{className:"p-4 sm:p-6",children:s.jsxs("div",{className:"space-y-2",children:[s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"Ara Toplam:"}),s.jsx("span",{children:q(t,S)})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"KDV:"}),s.jsx("span",{children:q(d,S)})]}),s.jsx(na,{}),s.jsxs("div",{className:"flex justify-between font-bold text-lg",children:[s.jsx("span",{children:"Genel Toplam:"}),s.jsx("span",{children:q(C,S)})]})]})})]}),((e==null?void 0:e.createdBy)&&P[e.createdBy]||((Ve=e==null?void 0:e.creator)==null?void 0:Ve.full_name))&&s.jsxs("p",{className:"text-xs text-muted-foreground text-right",children:["Siparişi ekleyen: ",s.jsx("span",{className:"font-medium",children:e!=null&&e.createdBy?P[e.createdBy]||((Ke=e==null?void 0:e.creator)==null?void 0:Ke.full_name)||"Bilinmeyen":((Ue=e==null?void 0:e.creator)==null?void 0:Ue.full_name)||"Bilinmeyen"})]}),s.jsxs("div",{className:"flex justify-end gap-2",children:[ie&&b&&s.jsxs(T,{variant:"outline",onClick:b,className:"gap-2 h-10",children:[s.jsx(is,{className:"h-4 w-4"}),"Sil"]}),w&&s.jsxs(T,{onClick:w,className:"gap-2 h-10 bg-primary hover:bg-primary/90 text-white",children:[s.jsx(cs,{className:"h-4 w-4"}),"Düzenle"]})]})]})})})]})})})},Ra=()=>{Is();const[n,u]=x.useState([]),[e,w]=x.useState(!0),[b,c]=x.useState(""),[o,_]=x.useState("all"),[f,i]=x.useState("order_date"),[V,ve]=x.useState("desc"),[M,J]=x.useState(1),[D,$]=x.useState(1),[K,U]=x.useState(!1),[I,P]=x.useState(!1),[we,z]=x.useState(!1),[X,Z]=x.useState(null),[Se,ee]=x.useState(!1),[he,Ce]=x.useState(null);x.useEffect(()=>{const t={};o!=="all"&&(t.status=o);const d=Gs(t,C=>B(void 0,null,function*(){try{if(!Array.isArray(C)){u([]),$(1),w(!1);return}const N=C.filter(l=>(l==null?void 0:l.totalAmount)||(l==null?void 0:l.total_amount)),A=C.filter(l=>!(l!=null&&l.totalAmount)&&!(l!=null&&l.total_amount)),ie=N.map(l=>ue(xe({},l),{totalAmount:l.totalAmount||l.total_amount,total_amount:l.totalAmount||l.total_amount})),ce=A.slice(0,20),_e=yield Promise.allSettled(ce.map(l=>B(void 0,null,function*(){if(!(l!=null&&l.id))return null;try{const h=yield ms(l.id),p=(Array.isArray(h)?h:[]).reduce((H,k)=>{if(!k)return H;const ye=k.total||(k.unitPrice||k.unit_price||0)*(k.quantity||0)-(k.discount||0);return H+ye},0),r=(Array.isArray(h)?h:[]).reduce((H,k)=>H+((k==null?void 0:k.quantity)||0),0),E=l.taxRate||l.tax_rate||0,L=p,je=L*(E/100),me=L+je;return ue(xe({},l),{totalAmount:me,total_amount:me,totalQuantity:r,total_quantity:r,subtotal:L})}catch(h){return ue(xe({},l),{totalAmount:0,total_amount:0})}}))),De=A.slice(20).map(l=>ue(xe({},l),{totalAmount:0,total_amount:0})),ge=_e.filter(l=>l.status==="fulfilled"&&l.value!==null).map(l=>l.value);let G=[...ie,...ge,...De];if(b){const l=b.toLocaleLowerCase("tr-TR");G=G.filter(h=>{var p,r,E;return((p=h.orderNumber)==null?void 0:p.toLocaleLowerCase("tr-TR").includes(l))||((r=h.customerName)==null?void 0:r.toLocaleLowerCase("tr-TR").includes(l))||((E=h.customerCompany)==null?void 0:E.toLocaleLowerCase("tr-TR").includes(l))})}G.sort((l,h)=>{var E,L;let p,r;return f==="order_date"?(p=l.orderDate||l.createdAt,r=h.orderDate||h.createdAt):f==="total"?(p=l.totalAmount||0,r=h.totalAmount||0):f==="priority"?(p=(E=l.priority)!=null?E:0,r=(L=h.priority)!=null?L:0):(p=l.orderNumber||"",r=h.orderNumber||""),p instanceof Xe&&(p=p.toMillis()),r instanceof Xe&&(r=r.toMillis()),p instanceof Date&&(p=p.getTime()),r instanceof Date&&(r=r.getTime()),V==="asc"?p>r?1:-1:p<r?1:-1});const F=(M-1)*50,fe=F+50;u(G.slice(F,fe)),$(Math.ceil(G.length/50)),w(!1)}catch(N){console.error("Real-time orders update error:",N),w(!1)}}));return()=>{d()}},[o,f,V,b,M]);const ke=t=>B(void 0,null,function*(){if(t)try{const d=yield xs(t);d?(Ce(d),ee(!0)):j.error("Müşteri bulunamadı")}catch(d){console.error("Get customer error:",d),j.error(d.message||"Müşteri bilgileri alınamadı")}});x.useEffect(()=>{M!==1&&J(1)},[o,f,V,b]);const le=t=>({draft:"Taslak",pending:"Beklemede",confirmed:"Onaylandı",planned:"Planlanan",in_production:"Üretimde",in_progress:"Üretimde",quality_check:"Kalite Kontrol",on_hold:"Beklemede",completed:"Tamamlandı",shipped:"Kargoda",delivered:"Teslim Edildi",cancelled:"İptal"})[t]||t,ne=t=>({draft:"bg-gray-100 text-gray-800 border-gray-300",pending:"bg-yellow-100 text-yellow-800 border-yellow-300",confirmed:"bg-blue-100 text-blue-800 border-blue-300",planned:"bg-indigo-100 text-indigo-800 border-indigo-300",in_production:"bg-orange-100 text-orange-800 border-orange-300",in_progress:"bg-orange-100 text-orange-800 border-orange-300",quality_check:"bg-cyan-100 text-cyan-800 border-cyan-300",on_hold:"bg-amber-100 text-amber-800 border-amber-300",completed:"bg-green-100 text-green-800 border-green-300",shipped:"bg-purple-100 text-purple-800 border-purple-300",delivered:"bg-emerald-100 text-emerald-800 border-emerald-300",cancelled:"bg-red-100 text-red-800 border-red-300"})[t]||"bg-gray-100 text-gray-800 border-gray-300",S=()=>B(void 0,null,function*(){if(X)try{yield Hs(X.id),j.success("Sipariş silindi"),z(!1),Z(null)}catch(t){console.error("Delete order error:",t),j.error(t.message||"Sipariş silinirken hata oluştu")}}),Te=(t,d)=>{if(t==null)return`${d&&Be[d]||"₺"}0,00`;const C=d||"TRY",N=C==="TRY"?"TRY":C,A=C==="TRY"?"tr-TR":"en-US",ie=Be[C]||"₺";try{return new Intl.NumberFormat(A,{style:"currency",currency:N,minimumFractionDigits:2}).format(t)}catch(ce){return`${ie}${t.toFixed(2)}`}},se=t=>t==null?{label:"Öncelik: 0",className:"bg-muted text-muted-foreground"}:t>=4?{label:`Öncelik: ${t}`,className:"bg-destructive/15 text-destructive"}:t>=2?{label:`Öncelik: ${t}`,className:"bg-amber-100 text-amber-800"}:{label:`Öncelik: ${t}`,className:"bg-slate-200 text-slate-800"};return e?s.jsx(as,{children:s.jsx(ca,{message:"Siparişler yükleniyor..."})}):s.jsxs(as,{children:[s.jsxs("div",{className:"space-y-3 sm:space-y-4 md:space-y-6",children:[s.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-2 sm:gap-3 md:gap-4",children:[s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsx("h1",{className:"text-xl sm:text-2xl md:text-3xl font-bold text-foreground",children:"Siparişler"}),s.jsx("p",{className:"text-muted-foreground mt-0.5 sm:mt-1 text-xs sm:text-sm",children:"Sipariş takibi ve yönetimi"})]}),s.jsxs(T,{className:"gap-1.5 sm:gap-2 w-full sm:w-auto min-h-[44px] sm:min-h-10 text-xs sm:text-sm",onClick:()=>U(!0),children:[s.jsx(Ps,{className:"h-4 w-4"}),s.jsx("span",{className:"hidden sm:inline",children:"Yeni Sipariş"}),s.jsx("span",{className:"sm:hidden",children:"Yeni"})]})]}),s.jsx(W,{children:s.jsx(Q,{className:"p-3 sm:p-4 md:p-6",children:s.jsxs("div",{className:"flex flex-col sm:flex-row items-stretch sm:items-center gap-2 sm:gap-3 md:gap-4",children:[s.jsx("div",{className:"flex-1 min-w-0 w-full sm:w-auto sm:min-w-[200px] md:min-w-[250px]",children:s.jsx(Ws,{placeholder:"Sipariş ara...",className:"w-full h-9 sm:h-10 text-xs sm:text-sm",value:b,onChange:t=>c(t.target.value)})}),s.jsx("div",{className:"w-full sm:w-auto sm:min-w-[160px] md:min-w-[180px]",children:s.jsxs(He,{value:o,onValueChange:_,children:[s.jsx(We,{className:"w-full h-9 sm:h-10 text-xs sm:text-sm",children:s.jsx(Qe,{placeholder:"Durum Filtrele"})}),s.jsxs(Je,{children:[s.jsx(g,{value:"all",children:"Tüm Durumlar"}),s.jsx(g,{value:"draft",children:"Taslak"}),s.jsx(g,{value:"pending",children:"Beklemede"}),s.jsx(g,{value:"confirmed",children:"Onaylandı"}),s.jsx(g,{value:"planned",children:"Planlanan"}),s.jsx(g,{value:"in_production",children:"Üretimde"}),s.jsx(g,{value:"in_progress",children:"Üretimde"}),s.jsx(g,{value:"quality_check",children:"Kalite Kontrol"}),s.jsx(g,{value:"on_hold",children:"Beklemede"}),s.jsx(g,{value:"completed",children:"Tamamlandı"}),s.jsx(g,{value:"shipped",children:"Kargoda"}),s.jsx(g,{value:"delivered",children:"Teslim Edildi"}),s.jsx(g,{value:"cancelled",children:"İptal"})]})]})}),s.jsx("div",{className:"w-full sm:w-auto sm:min-w-[160px] md:min-w-[180px]",children:s.jsxs(He,{value:f,onValueChange:i,children:[s.jsx(We,{className:"w-full h-9 sm:h-10 text-xs sm:text-sm",children:s.jsx(Qe,{placeholder:"Sırala"})}),s.jsxs(Je,{children:[s.jsx(g,{value:"order_date",children:"Tarihe Göre"}),s.jsx(g,{value:"total",children:"Tutara Göre"}),s.jsx(g,{value:"priority",children:"Önceliğe Göre"}),s.jsx(g,{value:"order_number",children:"Sipariş No"})]})]})}),s.jsxs(T,{variant:"outline",size:"sm",onClick:()=>ve(V==="asc"?"desc":"asc"),className:"h-9 sm:h-10 text-xs sm:text-sm",children:[V==="asc"?s.jsx(zs,{className:"h-3.5 w-3.5 sm:h-4 sm:w-4 sm:mr-2"}):s.jsx(Es,{className:"h-3.5 w-3.5 sm:h-4 sm:w-4 sm:mr-2"}),s.jsx("span",{className:"hidden sm:inline",children:V==="asc"?"Artan":"Azalan"})]})]})})}),s.jsx(W,{children:s.jsxs(Q,{className:"p-0",children:[s.jsx("div",{className:"overflow-x-auto -mx-4 sm:mx-0 px-4 sm:px-0",children:s.jsxs(us,{className:"min-w-[800px] sm:min-w-full",children:[s.jsx(rs,{children:s.jsxs(pe,{children:[s.jsx(v,{className:"text-xs sm:text-sm px-2 sm:px-4",children:"Sipariş No"}),s.jsx(v,{className:"text-xs sm:text-sm px-2 sm:px-4 hidden md:table-cell",children:"Müşteri"}),s.jsx(v,{className:"text-xs sm:text-sm px-2 sm:px-4 hidden lg:table-cell",children:"Tarih"}),s.jsx(v,{className:"text-xs sm:text-sm px-2 sm:px-4",children:"Durum"}),s.jsx(v,{className:"text-xs sm:text-sm px-2 sm:px-4 hidden xl:table-cell",children:"Öncelik"}),s.jsx(v,{className:"text-right text-xs sm:text-sm px-2 sm:px-4",children:"Tutar"}),s.jsx(v,{className:"text-right text-xs sm:text-sm px-2 sm:px-4",children:"İşlemler"})]})}),s.jsxs(os,{children:[n.map(t=>{var d,C,N;return s.jsxs(pe,{className:"cursor-pointer",onClick:()=>{Z(t),P(!0)},children:[s.jsx(y,{className:"font-medium text-xs sm:text-sm px-2 sm:px-4 py-2 sm:py-3",children:s.jsxs("div",{className:"flex flex-col gap-0.5",children:[s.jsx("span",{children:t.order_number}),s.jsx("span",{className:"md:hidden text-[10px] text-muted-foreground",children:t.customer_name||((d=t.customers)==null?void 0:d.name)}),s.jsx("span",{className:"lg:hidden text-[10px] text-muted-foreground",children:t.order_date?new Date(t.order_date).toLocaleDateString("tr-TR"):"-"})]})}),s.jsx(y,{className:"text-xs sm:text-sm px-2 sm:px-4 py-2 sm:py-3 hidden md:table-cell",children:s.jsxs("button",{type:"button",className:"text-left hover:text-primary focus:outline-none truncate max-w-[200px]",onClick:A=>{A.stopPropagation(),ke(t.customer_id)},children:[t.customer_name||((C=t.customers)==null?void 0:C.name),t.customer_company&&s.jsxs("span",{className:"text-muted-foreground",children:[" - ",t.customer_company]}),((N=t.customers)==null?void 0:N.company)&&s.jsxs("span",{className:"text-muted-foreground",children:[" - ",t.customers.company]})]})}),s.jsx(y,{className:"text-xs sm:text-sm px-2 sm:px-4 py-2 sm:py-3 hidden lg:table-cell",children:t.order_date?new Date(t.order_date).toLocaleDateString("tr-TR"):"-"}),s.jsx(y,{className:"px-2 sm:px-4 py-2 sm:py-3",children:s.jsx(Ne,{className:`${ne(t.status)} text-[10px] sm:text-xs`,children:le(t.status)})}),s.jsx(y,{className:"px-2 sm:px-4 py-2 sm:py-3 hidden xl:table-cell",children:s.jsx(Ne,{className:`${se(t.priority||0).className} text-[10px] sm:text-xs`,children:se(t.priority||0).label})}),s.jsx(y,{className:"text-right font-semibold text-xs sm:text-sm px-2 sm:px-4 py-2 sm:py-3",children:Te(t.totalAmount||t.total_amount||0,t.currency)}),s.jsx(y,{className:"text-right px-2 sm:px-4 py-2 sm:py-3",children:s.jsxs("div",{className:"flex items-center justify-end gap-1 sm:gap-2",onClick:A=>A.stopPropagation(),children:[s.jsx(T,{variant:"outline",size:"sm",className:"h-8 w-8 sm:h-9 sm:w-9 p-0",onClick:()=>{Z(t),P(!0)},children:s.jsx(cs,{className:"h-3.5 w-3.5 sm:h-4 sm:w-4"})}),s.jsx(T,{variant:"outline",size:"sm",className:"h-8 w-8 sm:h-9 sm:w-9 p-0",onClick:()=>{Z(t),z(!0)},children:s.jsx(is,{className:"h-3.5 w-3.5 sm:h-4 sm:w-4"})})]})})]},t.id)}),n.length===0&&!e&&s.jsx(pe,{children:s.jsx(y,{colSpan:7,className:"text-center py-6 sm:py-8 text-xs sm:text-sm text-muted-foreground",children:b||o!=="all"?"Arama sonucu bulunamadı":"Henüz sipariş bulunmuyor"})})]})]})}),D>1&&s.jsxs("div",{className:"flex flex-col gap-2 sm:gap-3 px-4 sm:px-6 py-3 sm:py-4 border-t md:flex-row md:items-center md:justify-between",children:[s.jsxs("div",{className:"text-xs sm:text-sm text-muted-foreground text-center md:text-left",children:["Sayfa ",M," / ",D]}),s.jsxs("div",{className:"flex gap-2 justify-center md:justify-end",children:[s.jsx(T,{variant:"outline",size:"sm",className:"h-8 sm:h-9 text-xs sm:text-sm",onClick:()=>J(t=>Math.max(1,t-1)),disabled:M===1||e,children:"Önceki"}),s.jsx(T,{variant:"outline",size:"sm",className:"h-8 sm:h-9 text-xs sm:text-sm",onClick:()=>J(t=>Math.min(D,t+1)),disabled:M===D||e,children:"Sonraki"})]})]})]})})]}),s.jsx(la,{open:K,onOpenChange:U,onSuccess:()=>{U(!1)}}),X&&s.jsx(ma,{open:I,onOpenChange:P,order:X,onEdit:()=>{},onDelete:()=>{P(!1),z(!0)}}),s.jsx(ia,{open:Se,onOpenChange:ee,customer:he}),s.jsx(Qs,{open:we,onOpenChange:z,children:s.jsxs(Js,{children:[s.jsxs(Xs,{children:[s.jsx(Zs,{children:"Siparişi sil?"}),s.jsx(ea,{children:"Bu işlem geri alınamaz. Sipariş ve bağlı ürünler kalıcı olarak silinecek."})]}),s.jsxs(sa,{children:[s.jsx(aa,{children:"İptal"}),s.jsx(ta,{onClick:S,children:"Sil"})]})]})})]})};export{Ra as default};
