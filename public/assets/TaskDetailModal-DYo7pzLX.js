const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/taskService-CQO0i9v5.js","assets/index-Xd90qdO9.js","assets/index-HS3kTX7E.css","assets/storageService-pEqhfEwa.js","assets/driveService-020R8zku.js","assets/toastHelpers-I2G9dhou.js","assets/permissions-D79DzJt5.js","assets/rolePermissionsService-CoZ8Qmsy.js"])))=>i.map(i=>d[i]);
import{a3 as Na,k as ka,a as Da,r as l,g as Ea,b as n,T as q,j as e,w as k,R as G,S as mt,p as xt,q as ut,s as ht,t as Ne,V as he,a6 as Ca,X as ke,B as x,L as ge,i as Xe,v as gt,W as _a,Y as Fa,Z as Aa,C as O,c as M,d as V,e as $,h as ft,ab as Ba,U as Sa,f as Ta,_ as A}from"./index-Xd90qdO9.js";import{D as te,a as ae,b as re,c as ie,d as De,P as Ds,J as Ra,T as fe,k as za,B as I,w as Ee,K as Pa,I as La,e as We,C as Ga,L as Oa}from"./MainLayout-DW7UjMSA.js";import{A as Ma,a as Va}from"./avatar-KtUT5CWN.js";import{g as $a,a as Ha,E as Ka,F as Ya,G as Ia,H as qa,v as Wa,w as Ja,u as pt,f as Qa,p as Xa,t as Za,I as Ua,J as er,x as sr,y as tr,K as vt,L as ar,M as rr,N as ir,O as lr,P as Es,m as jt,Q as nr,R as bt,S as cr,D as dr,C as or,T as mr}from"./taskService-CQO0i9v5.js";import{canViewTask as xr,canEditTask as ur,canInteractWithTask as hr}from"./permissions-D79DzJt5.js";import{O as gr}from"./OrderDetailModal-DehNQxg3.js";import{P as fr}from"./progress-DSBhhNxd.js";import{U as yt,P as Je}from"./UserMultiSelect-KlPlOKAA.js";import{P as pe}from"./plus-D9uLCipi.js";import{M as Cs}from"./message-square-BAQ_w3zD.js";import{L as Ce}from"./list-checks-CkcaKLuC.js";import{U as _s}from"./user-plus-DWuSLDZe.js";import{T as Fs}from"./tag-EYbV-h0Y.js";import{C as wt}from"./calendar-days-DIIfLF_e.js";import{S as pr}from"./send-DtcYVw6S.js";import{T as Qe}from"./trash-2-DlZRXDqX.js";import{E as vr}from"./ellipsis-vertical-gVlTlFy-.js";import{C as jr}from"./circle-dot-CCfpRgG9.js";import{f as _e}from"./format-DuC-NjES.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Nt=Na("Link2",[["path",{d:"M9 17H7A5 5 0 0 1 7 7h2",key:"8i5ue5"}],["path",{d:"M15 7h2a5 5 0 1 1 0 10h-2",key:"1b9ql8"}],["line",{x1:"8",x2:"16",y1:"12",y2:"12",key:"1jonct"}]]),le=[{value:"pending",label:"Yapılacak",icon:jr,color:"text-amber-500"},{value:"in_progress",label:"Devam Ediyor",icon:Ga,color:"text-blue-500"},{value:"completed",label:"Tamamlandı",icon:Xe,color:"text-emerald-600"},{value:"approved",label:"Onaylandı",icon:Xe,color:"text-green-600"}],Fe=c=>{if(!c)return"-";let b;return c instanceof q?b=c.toDate():c instanceof Date?b=c:b=new Date(c),Number.isNaN(b.getTime())?"-":b.toLocaleDateString("tr-TR",{day:"2-digit",month:"short",year:"numeric"})},Hr=({taskId:c,open:b,onOpenChange:Q,onUpdate:m,initialStatus:As="pending",projectId:y})=>{var ct,dt,ot;const{user:r,isAdmin:X,isSuperAdmin:H,isTeamLeader:kt}=ka(),Dt=Da(),[t,Ae]=l.useState(null),[_,Et]=l.useState([]),[Bs,Ss]=l.useState(!0),[R,Ct]=l.useState(null),[_t,Be]=l.useState(!1),[Ft,Se]=l.useState(!1),[At,Te]=l.useState(!1),[ne,Ze]=l.useState(""),[Re,Ue]=l.useState(""),[B,es]=l.useState(""),[ze,ss]=l.useState(null),[w,N]=l.useState(!1),[Ts,Rs]=l.useState(!1),[Z,zs]=l.useState(""),[ce,Pe]=l.useState({}),[Bt,St]=l.useState([]),[br,z]=l.useState(!1),Tt=l.useRef(null),[Rt,Ps]=l.useState(!1),[Ls,zt]=l.useState(null),[Gs,Os]=l.useState(!1);l.useState(null);const[Pt,ts]=l.useState(!1),[yr,Lt]=l.useState("file"),[de,as]=l.useState(""),[Le,rs]=l.useState(""),[Ms,is]=l.useState(!1),[Vs,Ge]=l.useState(!1),[$s,Oe]=l.useState(!1),[Hs,Me]=l.useState(!1),[ls,ns]=l.useState(""),[Ve,cs]=l.useState(""),[Ks,Gt]=l.useState("#61BD4F"),[ds,os]=l.useState([]),[P,ms]=l.useState(""),[U,W]=l.useState(!1),[Ot,Mt]=l.useState([]),[wr,Vt]=l.useState([]);l.useState(""),l.useState(!1),l.useState(!0);const[$e,xs]=l.useState(""),[Ys,us]=l.useState(""),[hs,gs]=l.useState([]),[J,oe]=l.useState([]),[me,ve]=l.useState(""),[He,Ke]=l.useState([]),[fs,Ye]=l.useState(""),[Is,ps]=l.useState("#61BD4F"),[vs,js]=l.useState(""),[D,Ie]=l.useState(y||null),[ee,je]=l.useState(!1),[E,S]=l.useState([]),[C,be]=l.useState(!1),[$t,bs]=l.useState(!1),[se,ys]=l.useState(!1),[K,ws]=l.useState(!1),qs=l.useRef(null),Ws=l.useRef(null),Js=l.useRef(null),Qs=l.useRef(null),Xs=l.useRef(null),Ht=l.useRef(null),Zs=[{name:"green",value:"#61BD4F",class:"bg-[#61BD4F]"},{name:"yellow",value:"#F2D600",class:"bg-[#F2D600]"},{name:"orange",value:"#FF9F1A",class:"bg-[#FF9F1A]"},{name:"red",value:"#EB5A46",class:"bg-[#EB5A46]"},{name:"purple",value:"#C377E0",class:"bg-[#C377E0]"},{name:"blue",value:"#0079BF",class:"bg-[#0079BF]"},{name:"sky",value:"#00C2E0",class:"bg-[#00C2E0]"},{name:"lime",value:"#51E898",class:"bg-[#51E898]"},{name:"pink",value:"#FF78CB",class:"bg-[#FF78CB]"},{name:"black",value:"#344563",class:"bg-[#344563]"}],ye=s=>{var a;(a=s.current)==null||a.scrollIntoView({behavior:"smooth",block:"start"})};l.useEffect(()=>{b&&c?f():b&&!c&&(xs(""),us(""),gs([]),oe([]),ve(""),Ke([]),Ye(""),ps("#61BD4F"),js(""),Ie(y||null),je(!1),Ss(!1))},[b,c]),l.useEffect(()=>{b&&(async()=>{try{const{getProjects:a,getProjectById:i}=await A(async()=>{const{getProjects:o,getProjectById:u}=await import("./taskService-CQO0i9v5.js").then(v=>v.V);return{getProjects:o,getProjectById:u}},__vite__mapDeps([0,1,2]));if(y&&!c)try{const o=await i(y);if(o.isPrivate){if(X||H){S([o]);return}if(r!=null&&r.id&&o.createdBy===r.id){S([o]);return}if(r!=null&&r.id)try{const{getTasks:u,getTaskAssignments:v}=await A(async()=>{const{getTasks:p,getTaskAssignments:L}=await import("./taskService-CQO0i9v5.js").then(h=>h.W);return{getTasks:p,getTaskAssignments:L}},__vite__mapDeps([0,1,2])),F=await u({projectId:y});for(const p of F){if(p.createdBy===r.id){S([o]);return}if(p.assignedUsers&&p.assignedUsers.includes(r.id)){S([o]);return}if((await v(p.id)).some(j=>j.assignedTo===r.id&&(j.status==="accepted"||j.status==="pending"))){S([o]);return}}}catch(u){console.error("Error checking project tasks:",u)}S([]);return}else{S([o]);return}}catch(o){console.error("Proje yüklenemedi",o),S([]);return}const d=await a({status:"active"});if(y&&!c){const o=d.find(u=>u.id===y);if(o!=null&&o.isPrivate){S([o]);return}}const g=await Promise.all(d.map(async o=>{if(y&&!c){const u=d.find(v=>v.id===y);if(u!=null&&u.isPrivate&&o.isPrivate&&o.id!==y)return null}if(!o.isPrivate||H||r!=null&&r.id&&o.createdBy===r.id)return o;if(r!=null&&r.id)try{const{getTasks:u,getTaskAssignments:v}=await A(async()=>{const{getTasks:p,getTaskAssignments:L}=await import("./taskService-CQO0i9v5.js").then(h=>h.W);return{getTasks:p,getTaskAssignments:L}},__vite__mapDeps([0,1,2])),F=await u({projectId:o.id});for(const p of F)if(p.createdBy===r.id||p.assignedUsers&&p.assignedUsers.includes(r.id)||(await v(p.id)).some(j=>j.assignedTo===r.id&&(j.status==="accepted"||j.status==="pending")))return o}catch(u){console.error("Error checking project tasks:",u)}return null}));S(g.filter(o=>o!==null))}catch(a){console.error("Projeler yüklenemedi",a)}})()},[b,c,X,H,r==null?void 0:r.id,y]),l.useEffect(()=>{ee&&b&&!c&&(async()=>{try{const{getProjects:a}=await A(async()=>{const{getProjects:g}=await import("./taskService-CQO0i9v5.js").then(o=>o.V);return{getProjects:g}},__vite__mapDeps([0,1,2])),i=await a({status:"active"}),d=await Promise.all(i.map(async g=>{if(!g.isPrivate)return null;if(H||r!=null&&r.id&&g.createdBy===r.id)return g;if(r!=null&&r.id)try{const{getTasks:o,getTaskAssignments:u}=await A(async()=>{const{getTasks:F,getTaskAssignments:p}=await import("./taskService-CQO0i9v5.js").then(L=>L.W);return{getTasks:F,getTaskAssignments:p}},__vite__mapDeps([0,1,2])),v=await o({projectId:g.id});for(const F of v)if(F.createdBy===r.id||F.assignedUsers&&F.assignedUsers.includes(r.id)||(await u(F.id)).some(h=>h.assignedTo===r.id&&(h.status==="accepted"||h.status==="pending")))return g}catch(o){console.error("Error checking project tasks:",o)}return null}));S(d.filter(g=>g!==null))}catch(a){console.error("Projeler yüklenemedi",a)}})()},[ee,b,c,X,H,r==null?void 0:r.id]),l.useEffect(()=>{if(!c&&E.length>0){const s=D||y;if(s){const a=E.find(i=>i.id===s);a!=null&&a.isPrivate&&je(!0)}}},[D,y,E,c]);const f=async()=>{try{const[s,a,i,d,g,o,u]=await Promise.all([$a(c),Ha(c),Ea(),Ka(c).catch(()=>[]),Ya(c).catch(()=>[]),Ia(c).catch(()=>[]),qa(c).catch(()=>[])]);if(!s){n.error("Görev bulunamadı");return}let v=[];if(s.labels)if(typeof s.labels=="string")try{const h=JSON.parse(s.labels);v=Array.isArray(h)?h:[]}catch{v=[]}else Array.isArray(s.labels)&&(v=s.labels.map(h=>typeof h=="string"?{name:h,color:"#61BD4F"}:h));const F={...s,labels:v,attachments:u,checklists:o,createdBy:s.createdBy,approvalStatus:s.approvalStatus,due_date:s.dueDate?s.dueDate instanceof q?s.dueDate.toDate().toISOString():new Date(s.dueDate).toISOString():null,created_at:s.createdAt instanceof q?s.createdAt.toDate().toISOString():new Date(s.createdAt).toISOString()};Ae(F),ns(s.description||""),ms(s.dueDate?(s.dueDate instanceof q?s.dueDate.toDate():new Date(s.dueDate)).toISOString().split("T")[0]:"");const p=a.map(h=>{const j=i.find(wa=>wa.id===h.assignedTo);return{id:h.assignedTo,assignment_id:h.id,full_name:(j==null?void 0:j.fullName)||(j==null?void 0:j.displayName)||"",email:(j==null?void 0:j.email)||"",accepted_at:h.acceptedAt?h.acceptedAt instanceof q?h.acceptedAt.toDate().toISOString():new Date(h.acceptedAt).toISOString():null,completed_at:h.completedAt?h.completedAt instanceof q?h.completedAt.toDate().toISOString():new Date(h.completedAt).toISOString():null,status:h.status,rejection_reason:h.rejectionReason||null,assigned_by:h.assignedBy||null}});Et(p),os(p.map(h=>h.id));const L=p.find(h=>h.id===(r==null?void 0:r.id));Ct(L||null),Pe({}),Mt(d),Vt(g),St(o),await Us(s,p.map(h=>h.id))}catch(s){console.error("Fetch task details error:",s),n.error(s.message||"Görev detayları yüklenirken hata oluştu")}finally{Ss(!1)}},Us=async(s,a)=>{if(!s||!r){bs(!1),ys(!1),ws(!1);return}try{const i=r,[d,g,o]=await Promise.all([xr(s,i,a),ur(s,i),hr(s,i,a)]);bs(d),ys(g),ws(o)}catch(i){console.error("Error checking permissions:",i),bs(!1),ys(!1),ws(!1)}};l.useEffect(()=>{if(t&&r){const s=_.map(a=>a.id);Us(t,s)}},[t,r,_]);const et=async()=>{if(t!=null&&t.production_order_id){Os(!0);try{const s=await Oa(t.production_order_id);s?(zt(s),Ps(!0)):n.error("Sipariş bulunamadı")}catch(s){console.error("Get order detail error:",s),n.error(s.message||"Sipariş detayları alınamadı")}finally{Os(!1)}}},xe=s=>({pending:"Yapılacak",in_progress:"Devam Ediyor",completed:"Tamamlandı",approved:"Onaylandı"})[s]||s,[T,Ns]=l.useState((t==null?void 0:t.status)||As||"pending"),[qe,Y]=l.useState(!1),[we,Nr]=l.useState({}),ks=()=>{if(T==="completed"&&(t==null?void 0:t.approvalStatus)==="approved")return 3;if(T==="completed")return 2;const s=T,a=le.findIndex(i=>i.value===s);return a===-1?0:a},ue=()=>{const s=ks();return s===-1||s>=le.length-1?null:le[s+1]},Kt=(s,a)=>({pending:"in_progress",in_progress:"completed"})[s]===a,Yt=async s=>{if(!(!c||!(r!=null&&r.id))){if(!Kt(T,s)){n.error(`Geçersiz durum geçişi: ${xe(T)} → ${xe(s)}`);return}Y(!0);try{await pt(c,s),Ns(s),n.success(`Görev durumu ${xe(s)} olarak güncellendi.`),await f(),m==null||m()}catch(a){console.error("Task status update error:",a),n.error("Durum güncellenemedi: "+((a==null?void 0:a.message)||"Bilinmeyen hata"))}finally{Y(!1)}}},It=async()=>{if(!(!c||!(r!=null&&r.id))){Y(!0);try{await Qa(c,r.id),n.success("Görev onay için yöneticiye gönderildi."),await f(),m==null||m()}catch(s){console.error("Request approval error:",s),n.error("Onay isteği gönderilemedi: "+((s==null?void 0:s.message)||"Bilinmeyen hata"))}finally{Y(!1)}}},qt=async s=>{if(!(!c||!(r!=null&&r.id))){if(!X&&!H){n.error("Sadece yöneticiler durumu geri alabilir.");return}if(s==="approved"){n.error("Onaylandı durumuna geri alınamaz.");return}Y(!0);try{const a=ks(),i=le.findIndex(g=>g.value===s);if(i===-1){n.error("Geçersiz durum."),Y(!1);return}if(i>=a){n.error("Sadece önceki durumlara geri alabilirsiniz."),Y(!1);return}if((t==null?void 0:t.approvalStatus)==="pending"){n.error("Onay bekleyen görevler geri alınamaz."),Y(!1);return}const d=le[i];await pt(c,d.value),Ns(d.value),n.success(`Görev durumu ${d.label} olarak geri alındı.`),await f(),m==null||m()}catch(a){console.error("Revert status error:",a),n.error("Durum geri alınamadı: "+((a==null?void 0:a.message)||"Bilinmeyen hata"))}finally{Y(!1)}}};l.useEffect(()=>{t!=null&&t.status&&Ns(t.status)},[t==null?void 0:t.status]);const Wt=async()=>{if(R){N(!0);try{await Xa(c,R.assignment_id),n.success("Görev kabul edildi"),f(),m==null||m()}catch(s){console.error("Accept task error:",s),n.error(s.message||"Görev kabul edilemedi")}finally{N(!1)}}},Jt=async()=>{if(!R||!ne.trim()||ne.trim().length<20){n.error("Reddetme sebebi en az 20 karakter olmalıdır");return}N(!0);try{await Za(c,R.assignment_id,ne.trim()),n.success("Görev reddedildi"),Be(!1),Ze(""),f(),m==null||m()}catch(s){console.error("Reject task error:",s),n.error(s.message||"Görev reddedilemedi")}finally{N(!1)}},Qt=async()=>{if(!c){n.error("Görev bulunamadı");return}if(!de.trim()||!Le.trim()){n.error("Lütfen Drive linki ve isim girin");return}if(!/^https:\/\/(drive\.google\.com|docs\.google\.com)/.test(de.trim())){n.error("Geçerli bir Google Drive linki girin");return}Rs(!0);try{await Ua(c,{name:Le.trim(),url:de.trim(),size:0,type:"drive_link",attachmentType:"drive_link",driveLink:de.trim(),uploadedBy:(r==null?void 0:r.id)||""}),n.success("Drive linki eklendi"),ts(!1),as(""),rs(""),Lt("file"),f()}catch(a){n.error(a.message||"Drive linki eklenirken hata oluştu")}finally{Rs(!1)}},Xt=async s=>{try{const{deleteFile:a}=await A(async()=>{const{deleteFile:i}=await import("./storageService-pEqhfEwa.js");return{deleteFile:i}},__vite__mapDeps([3,1,2,4]));s.storageProvider==="google_drive"&&s.driveFileId?await a(s.url,{provider:"google_drive",fileId:s.driveFileId}):s.attachmentType!=="drive_link"&&await a(s.url),await er(c,s.id),n.success("Dosya silindi"),f()}catch(a){n.error(a.message||"Dosya silinirken hata oluştu")}},Zt=async()=>{if(!(!(r!=null&&r.id)||!c)){N(!0);try{await sr(c,r.id),n.success("Görev onaylandı ve kapatıldı"),await f(),m==null||m()}catch(s){console.error("Approve task error:",s),n.error(s.message||"Görev onaylanamadı")}finally{N(!1)}}},Ut=async()=>{!(r!=null&&r.id)||!c||Se(!0)},ea=async()=>{if(!(!(r!=null&&r.id)||!c)){if(!Re.trim()){n.error("Lütfen reddetme nedeni girin");return}N(!0);try{await tr(c,r.id,Re.trim()),n.success("Görev onayı reddedildi ve görev panoya döndü"),Se(!1),Ue(""),await f(),m==null||m()}catch(s){console.error("Reject task approval error:",s),n.error(s.message||"Görev onayı reddedilemedi")}finally{N(!1)}}},st=async()=>{if(!(!Z.trim()||!r)){if(!K){const{showPermissionErrorToast:s}=await A(async()=>{const{showPermissionErrorToast:a}=await import("./toastHelpers-I2G9dhou.js");return{showPermissionErrorToast:a}},__vite__mapDeps([5,1,2,0]));s("create","checklist");return}z(!0);try{const s=ce[Z]?ce[Z].split(`
`).filter(a=>a.trim()):[];await vt(c,Z.trim(),s.map(a=>({text:a.trim()}))),n.success("Checklist eklendi"),zs(""),Pe({}),await f()}catch(s){console.error("Add checklist error:",s),n.error(s.message||"Checklist eklenemedi")}finally{z(!1)}}},sa=async s=>{if(!K){const{showPermissionErrorToast:a}=await A(async()=>{const{showPermissionErrorToast:i}=await import("./toastHelpers-I2G9dhou.js");return{showPermissionErrorToast:i}},__vite__mapDeps([5,1,2,0]));a("delete","checklist");return}z(!0);try{await ar(c,s),n.success("Checklist silindi"),await f()}catch(a){console.error("Delete checklist error:",a),n.error(a.message||"Checklist silinemedi")}finally{z(!1)}},tt=async s=>{var i;const a=(i=ce[s])==null?void 0:i.trim();if(a){if(!K){const{showPermissionErrorToast:d}=await A(async()=>{const{showPermissionErrorToast:g}=await import("./toastHelpers-I2G9dhou.js");return{showPermissionErrorToast:g}},__vite__mapDeps([5,1,2,0]));d("create","checklist");return}z(!0);try{await rr(c,s,a),n.success("Checklist öğesi eklendi"),Pe(d=>({...d,[s]:""})),await f()}catch(d){console.error("Add checklist item error:",d),n.error(d.message||"Checklist öğesi eklenemedi")}finally{z(!1)}}},ta=async(s,a,i)=>{if(!(!c||!(r!=null&&r.id))){if(!K){const{showPermissionErrorToast:d}=await A(async()=>{const{showPermissionErrorToast:g}=await import("./toastHelpers-I2G9dhou.js");return{showPermissionErrorToast:g}},__vite__mapDeps([5,1,2,0]));d("interact","checklist");return}z(!0);try{await ir(c,s,a,i,r.id),await f()}catch(d){console.error("Toggle checklist item error:",d),n.error(d.message||"Checklist öğesi güncellenemedi")}finally{z(!1)}}},aa=async(s,a)=>{if(!K){const{showPermissionErrorToast:i}=await A(async()=>{const{showPermissionErrorToast:d}=await import("./toastHelpers-I2G9dhou.js");return{showPermissionErrorToast:d}},__vite__mapDeps([5,1,2,0]));i("delete","checklist");return}z(!0);try{await lr(c,s,a),n.success("Checklist öğesi silindi"),await f()}catch(i){console.error("Delete checklist item error:",i),n.error(i.message||"Checklist öğesi silinemedi")}finally{z(!1)}},ra=s=>s.split(" ").map(a=>a[0]).join("").toUpperCase().slice(0,2),ia=async()=>{W(!0);try{await Es(c,{description:ls||null}),n.success("Açıklama güncellendi"),Ae({...t,description:ls}),is(!1),m==null||m()}catch(s){console.error("Update description error:",s),n.error(s.message||"Açıklama güncellenemedi")}finally{W(!1)}},at=()=>{if(!Ve.trim())return;const s=(t==null?void 0:t.labels)||[],a={name:Ve.trim(),color:Ks},i=[...s,a];rt(i),cs("")},la=s=>{const i=((t==null?void 0:t.labels)||[]).filter(d=>d.name!==s);rt(i)},rt=async s=>{W(!0);try{const a=s.map(i=>i.name);await Es(c,{labels:a}),_.length>0&&r&&await Promise.all(_.filter(i=>i.id!==r.id&&i.status==="accepted").map(i=>jt({userId:i.id,type:"task_updated",title:"Görev güncellendi",message:`${r.fullName||r.email||"Bir kullanıcı"} "${t==null?void 0:t.title}" görevinin etiketlerini güncelledi.`,read:!1,relatedId:c}))),n.success("Etiketler güncellendi"),Ae({...t,labels:s}),Ge(!1),m==null||m()}catch(a){console.error("Update labels error:",a),n.error(a.message||"Etiketler güncellenemedi")}finally{W(!1)}},na=async()=>{if(r){try{const{canPerformSubPermission:s}=await A(async()=>{const{canPerformSubPermission:d}=await import("./permissions-D79DzJt5.js");return{canPerformSubPermission:d}},__vite__mapDeps([6,7,1,2])),a={id:r.id,email:r.email,emailVerified:r.emailVerified,fullName:r.fullName,displayName:r.fullName,phone:r.phone,dateOfBirth:r.dateOfBirth,role:r.roles||[],createdAt:null,updatedAt:null};if(!await s(a,"tasks","canAssign")&&!X&&!H){n.error("Görev atama yetkiniz yok");return}}catch(s){console.error("Permission check error:",s)}W(!0);try{const s=_.map(d=>d.id),a=ds.filter(d=>!s.includes(d)),i=s.filter(d=>!ds.includes(d));for(const d of i){const g=_.find(o=>o.id===d);g&&await nr(c,g.assignment_id,r.id)}for(const d of a)await bt(c,d,r.id);n.success("Üyeler güncellendi"),f(),Oe(!1),m==null||m()}catch(s){console.error("Assign members error:",s),n.error(s.message||"Üyeler güncellenemedi")}finally{W(!1)}}},ca=async()=>{W(!0);try{const s=P?q.fromDate(new Date(P)):null;await Es(c,{dueDate:s}),r&&await cr(c,r.id,"updated",`bu kartın bitiş tarihini ${P?_e(new Date(P),"d MMM yyyy HH:mm",{locale:Ee}):"kaldırdı"} olarak ayarladı`,{field:"dueDate",oldValue:t.due_date,newValue:P},r.fullName,r.email),_.length>0&&r&&await Promise.all(_.filter(a=>a.id!==r.id&&a.status==="accepted").map(a=>jt({userId:a.id,type:"task_updated",title:"Görev güncellendi",message:`${r.fullName||r.email||"Bir kullanıcı"} "${t==null?void 0:t.title}" görevinin bitiş tarihini ${P?_e(new Date(P),"d MMM yyyy HH:mm",{locale:Ee}):"kaldırdı"}.`,read:!1,relatedId:c}))),n.success("Tarih güncellendi"),Ae({...t,due_date:P?`${P}T00:00:00.000Z`:null}),Me(!1),f(),m==null||m()}catch(s){console.error("Update due date error:",s),n.error(s.message||"Tarih güncellenemedi")}finally{W(!1)}},da=()=>{Oe(!0),ye(Xs)},oa=()=>{Ge(!0),ye(qs)},ma=()=>{ye(Qs)},xa=()=>{Me(!0),ye(Ws)},ua=()=>{ye(Js),setTimeout(()=>{var s;return(s=Tt.current)==null?void 0:s.click()},180)},it=()=>{n.info("Sipariş bağlama özelliği üzerinde çalışıyoruz.")},ha=()=>{f(),n.success("Kart güncellendi")},ga=async()=>{if(!(!(r!=null&&r.id)||!c)){N(!0);try{t!=null&&t.is_archived?(await dr(c,r.id),n.success("Görev arşivden çıkarıldı")):(await or(c,r.id),n.success("Görev arşivlendi")),await f(),m==null||m()}catch(s){console.error("Archive task error:",s),n.error(s.message||"Görev arşivlenemedi")}finally{N(!1)}}},fa=()=>{n.info("Silme işlemi için görev listesi üzerinden ilerleyin.")},pa=async()=>{if(!$e.trim()||!r){n.error("Görev başlığı gereklidir");return}be(!0);try{let s=D||y||null,a=ee;if(s){const u=E.find(v=>v.id===s);u!=null&&u.isPrivate&&(ee||(a=!0))}if(a){if(!s){n.error("Gizli görevler için bir gizli proje seçmelisiniz. Lütfen önce bir gizli proje oluşturun."),be(!1);return}const u=E.find(v=>v.id===s);if(u&&!u.isPrivate){n.error("Gizli görevler sadece gizli projelere atanabilir. Lütfen bir gizli proje seçin."),be(!1);return}}if((!s||s==="general")&&!ee){n.error("Lütfen bir proje seçin. Her görevin bir projesi olmalıdır."),be(!1);return}const i=He.map(u=>u.name),d=vs?q.fromDate(new Date(vs)):null,o=(await mr({title:$e.trim(),description:Ys.trim()||null,status:As,priority:2,dueDate:d,labels:i.length>0?i:null,projectId:s||null,isPrivate:a,productionOrderId:null,productionProcessId:null,createdBy:r.id})).id;if(hs.length>0)try{await Promise.all(hs.map(u=>bt(o,u,r.id)))}catch(u){console.error("Assignment error:",u)}if(J.length>0)try{await vt(o,"Checklist",J)}catch(u){console.error("Checklist creation error:",u)}n.success("Görev oluşturuldu"),xs(""),us(""),gs([]),oe([]),ve(""),Ke([]),Ye(""),ps("#61BD4F"),js(""),Ie(y||null),je(!1),m==null||m(),Q(!1)}catch(s){console.error("Create task error:",s),n.error(s.message||"Görev oluşturulamadı")}finally{be(!1)}},lt=()=>{const s=fs.trim();if(s){if(He.some(a=>a.name.toLowerCase()===s.toLowerCase())){n.info("Bu etiket zaten ekli");return}Ke(a=>[...a,{name:s,color:Is}]),Ye("")}},va=s=>{Ke(a=>a.filter(i=>i.name!==s))},ja=[{id:"members",title:"Üye Ekle",description:"Göreve kişi ata",icon:_s,accent:"bg-[#E8F5FF] text-[#0B69C6]",action:da},{id:"labels",title:"Etiketler",description:"Renklerle kategorize et",icon:Fs,accent:"bg-[#FFF5D9] text-[#D39B00]",action:oa},{id:"checklist",title:"Checklist",description:"Adım adım ilerle",icon:Ce,accent:"bg-[#EBF8F2] text-[#1B7F5D]",action:ma},{id:"dates",title:"Tarih",description:"Termin planla",icon:wt,accent:"bg-[#F5EBFF] text-[#6F2DBD]",action:xa},{id:"attachments",title:"Ek",description:"Dosya paylaş",icon:Je,accent:"bg-[#FFEDEA] text-[#C13828]",action:ua}];if(Bs&&c)return e.jsx(te,{open:b,onOpenChange:Q,children:e.jsxs(ae,{children:[e.jsxs(re,{className:"sr-only",children:[e.jsx(ie,{children:"Görev yükleniyor"}),e.jsx(De,{children:"Görev detayları hazırlanıyor"})]}),e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary"})})]})});if(!c)return e.jsx(te,{open:b,onOpenChange:Q,children:e.jsx(ae,{className:"!max-w-[100vw] sm:!max-w-[95vw] !w-[100vw] sm:!w-[95vw] !h-[100vh] sm:!h-[90vh] !max-h-[100vh] sm:!max-h-[90vh] !left-0 sm:!left-[2.5vw] !top-0 sm:!top-[5vh] !right-0 sm:!right-auto !bottom-0 sm:!bottom-auto !translate-x-0 !translate-y-0 overflow-hidden !p-0 gap-0 bg-white flex flex-col !m-0 !rounded-none sm:!rounded-lg !border-0 sm:!border","data-task-modal":!0,children:e.jsxs("div",{className:"flex flex-col h-full min-h-0",children:[e.jsx(re,{className:"p-3 sm:p-4 border-b bg-white flex-shrink-0",children:e.jsx(ie,{className:"text-lg sm:text-xl font-semibold text-foreground",children:"Yeni Görev Oluştur"})}),e.jsx("div",{className:"flex-1 overflow-hidden bg-gray-50/50 p-3 sm:p-4 min-h-0",children:e.jsx("div",{className:"max-w-full mx-auto h-full overflow-y-auto",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs(k,{className:"text-sm sm:text-base font-bold text-[#172B4D] flex items-center gap-2 sm:gap-3",children:[e.jsx(Ds,{className:"h-4 w-4 sm:h-5 sm:w-5 text-[#0079BF]"}),"Görev Başlığı ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(G,{placeholder:"Örn: Yeni özellik geliştir...",value:$e,onChange:s=>xs(s.target.value),className:"h-11 sm:h-12 bg-white border-2 border-[#DFE1E6] text-[#172B4D] text-base focus:border-[#0079BF] focus:ring-2 focus:ring-[#0079BF]/20",disabled:C,autoFocus:!0})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 sm:gap-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs(k,{className:"text-sm sm:text-base font-bold text-[#172B4D] flex items-center gap-2 sm:gap-3",children:[e.jsx(Ds,{className:"h-4 w-4 sm:h-5 sm:w-5 text-[#0079BF]"}),"Proje ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsxs(mt,{value:D||"",onValueChange:s=>{if(s==="__create_project__"){Dt("/projects"),Q(!1);return}Ie(s);const a=E.find(i=>i.id===s);a!=null&&a.isPrivate&&je(!0)},disabled:C,children:[e.jsx(xt,{className:"h-11 sm:h-12 border-2 border-[#DFE1E6] bg-white",children:e.jsx(ut,{placeholder:"Proje seçiniz"})}),e.jsxs(ht,{children:[(()=>{const s=D?E.find(i=>i.id===D):null;let a=E;return ee?a=E.filter(i=>i.isPrivate):s!=null&&s.isPrivate&&(a=E.filter(i=>i.isPrivate)),a.map(i=>e.jsx(Ne,{value:i.id,children:i.name},i.id))})(),e.jsx("div",{className:"border-t border-border mt-1 pt-1",children:e.jsxs(Ne,{value:"__create_project__",className:"text-primary font-medium cursor-pointer",children:[e.jsx(pe,{className:"h-4 w-4 mr-2 inline"}),"Yeni Proje Ekle"]})})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs(k,{className:"text-sm sm:text-base font-bold text-[#172B4D] flex items-center gap-2 sm:gap-3",children:[e.jsx(Ra,{className:"h-4 w-4 sm:h-5 sm:w-5 text-[#0079BF]"}),"Gizlilik"]}),e.jsx("div",{className:"flex items-center gap-3 h-12 px-4 border-2 border-[#DFE1E6] rounded-md bg-white",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",id:"private-task",checked:ee,disabled:C||D&&((ct=E.find(s=>s.id===D))==null?void 0:ct.isPrivate),onChange:s=>{const a=D?E.find(i=>i.id===D):null;a!=null&&a.isPrivate||(je(s.target.checked),s.target.checked&&D&&!(a!=null&&a.isPrivate)&&Ie(null))},className:"h-4 w-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),e.jsxs(k,{htmlFor:"private-task",className:he("text-sm font-medium text-gray-700 flex items-center gap-2",D&&((dt=E.find(s=>s.id===D))!=null&&dt.isPrivate)?"cursor-default":"cursor-pointer"),children:[e.jsx(Ca,{className:"h-4 w-4 text-gray-500"}),"Sadece atanan kişiler görebilir"]})]})})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs(k,{className:"text-base font-bold text-[#172B4D] flex items-center gap-3",children:[e.jsx(Cs,{className:"h-5 w-5 text-[#0079BF]"}),"Açıklama"]}),e.jsx(fe,{placeholder:"Görev hakkında detaylı bilgi ekleyin...",value:Ys,onChange:s=>us(s.target.value),rows:5,disabled:C,className:"bg-white border-2 border-[#DFE1E6] text-[#172B4D] resize-none text-base focus:border-[#0079BF] focus:ring-2 focus:ring-[#0079BF]/20"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs(k,{className:"text-base font-bold text-[#172B4D] flex items-center gap-3",children:[e.jsx(Ce,{className:"h-5 w-5 text-[#0079BF]"}),"Kontrol Listesi"]}),J.length>0&&e.jsx("div",{className:"space-y-3 bg-[#F4F5F7] rounded-xl p-5 border-2 border-[#DFE1E6]",children:J.map((s,a)=>e.jsxs("div",{className:"flex items-center gap-4 text-sm group p-3 rounded-lg hover:bg-white/50 transition-colors",children:[e.jsx("input",{type:"checkbox",checked:s.completed,onChange:i=>{const d=[...J];d[a].completed=i.target.checked,oe(d)},className:"w-5 h-5 rounded border-2 border-[#DFE1E6] text-[#0079BF] cursor-pointer focus:ring-2 focus:ring-[#0079BF]/20"}),e.jsx("span",{className:he("flex-1 text-base",s.completed?"line-through text-[#5E6C84]":"text-[#172B4D] font-medium"),children:s.text}),e.jsx("button",{type:"button",onClick:()=>{oe(J.filter((i,d)=>d!==a))},className:"opacity-0 group-hover:opacity-100 text-[#5E6C84] hover:text-[#EB5A46] transition-opacity p-2 rounded-lg hover:bg-[#EB5A46]/10",children:e.jsx(ke,{className:"h-4 w-4"})})]},a))}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(G,{placeholder:"Yeni madde ekle...",value:me,onChange:s=>ve(s.target.value),onKeyDown:s=>{s.key==="Enter"&&me.trim()&&(s.preventDefault(),oe([...J,{text:me.trim(),completed:!1}]),ve(""))},disabled:C,className:"flex-1 h-12 border-2 border-[#DFE1E6] focus:border-[#0079BF] focus:ring-2 focus:ring-[#0079BF]/20"}),e.jsx(x,{type:"button",size:"sm",onClick:()=>{me.trim()&&(oe([...J,{text:me.trim(),completed:!1}]),ve(""))},disabled:C||!me.trim(),className:"h-12 px-6 bg-[#0079BF] hover:bg-[#005A8B] text-white font-semibold shadow-md hover:shadow-lg transition-all",children:e.jsx(pe,{className:"h-5 w-5"})})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs(k,{className:"text-base font-bold text-[#172B4D] flex items-center gap-3",children:[e.jsx(_s,{className:"h-5 w-5 text-[#0079BF]"}),"Kişi Ata"]}),e.jsx("div",{className:"border-2 border-[#DFE1E6] rounded-xl p-4 bg-white shadow-sm",children:e.jsx(yt,{selectedUsers:hs,onSelectionChange:gs})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs(k,{className:"text-base font-bold text-[#172B4D] flex items-center gap-3",children:[e.jsx(Fs,{className:"h-5 w-5 text-[#0079BF]"}),"Etiketler"]}),He.length>0&&e.jsx("div",{className:"flex flex-wrap gap-3",children:He.map((s,a)=>e.jsxs("div",{className:"flex items-center gap-2 px-4 py-2 rounded-full text-sm font-semibold text-white cursor-pointer hover:opacity-90 transition-opacity shadow-md",style:{backgroundColor:s.color},onClick:()=>va(s.name),children:[e.jsx("span",{children:s.name}),e.jsx(ke,{className:"h-3.5 w-3.5"})]},a))}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(G,{value:fs,onChange:s=>Ye(s.target.value),placeholder:"Etiket adı girin...",className:"flex-1 h-12 border-2 border-[#DFE1E6] focus:border-[#0079BF] focus:ring-2 focus:ring-[#0079BF]/20",onKeyDown:s=>{s.key==="Enter"&&(s.preventDefault(),lt())},disabled:C}),e.jsx(x,{type:"button",onClick:lt,size:"sm",disabled:!fs.trim()||C,className:"h-12 px-6 bg-[#0079BF] hover:bg-[#005A8B] text-white font-semibold shadow-md hover:shadow-lg transition-all",children:"Ekle"})]}),e.jsx("div",{className:"flex flex-wrap gap-3",children:Zs.map(s=>e.jsx("button",{onClick:()=>ps(s.value),className:he("w-10 h-10 rounded-xl border-2 transition-all hover:scale-110 shadow-sm",s.class,Is===s.value?"border-[#172B4D] scale-110 ring-2 ring-[#0079BF] ring-offset-2":"border-[#DFE1E6] hover:border-[#C1C7D0]"),title:s.name,disabled:C},s.name))})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs(k,{className:"text-base font-bold text-[#172B4D] flex items-center gap-3",children:[e.jsx(wt,{className:"h-5 w-5 text-[#0079BF]"}),"Bitiş Tarihi"]}),e.jsx(G,{type:"date",value:vs,onChange:s=>js(s.target.value),className:"h-12 border-2 border-[#DFE1E6] focus:border-[#0079BF] focus:ring-2 focus:ring-[#0079BF]/20",disabled:C})]}),e.jsxs("div",{className:"flex items-center gap-4 pt-6 border-t-2 border-[#DFE1E6]",children:[e.jsx(x,{onClick:pa,disabled:C||!$e.trim(),className:"bg-[#0079BF] hover:bg-[#005A8B] text-white flex-1 font-bold h-14 text-base shadow-lg hover:shadow-xl transition-all disabled:opacity-50",children:C?e.jsxs(e.Fragment,{children:[e.jsx(ge,{className:"h-5 w-5 animate-spin mr-3"}),"Oluşturuluyor..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Xe,{className:"h-5 w-5 mr-3"}),"Görev Oluştur"]})}),e.jsx(x,{variant:"outline",onClick:()=>Q(!1),disabled:C,className:"h-14 px-8 border-2 border-[#DFE1E6] text-[#172B4D] hover:bg-[#F4F5F7] hover:border-[#0079BF] font-semibold transition-all",children:"İptal"})]})]})})})]})})});if(!t)return null;if(!$t)return n.error("Bu görevi görüntüleme yetkiniz yok"),Q(!1),null;const ba=[{label:"Atanan Kişiler",value:_.length||0,icon:_s,helper:"Göreve atanan kullanıcı",accent:"from-blue-50/80 via-white to-white border-blue-100",tooltip:"Bu göreve atanan toplam kullanıcı sayısı"},{label:"Checklist",value:Bt.length||0,icon:Ce,helper:"Kontrol listesi sayısı",accent:"from-indigo-50/80 via-white to-white border-indigo-100",tooltip:"Göreve eklenmiş kontrol listeleri"},{label:"Dosyalar",value:((ot=t==null?void 0:t.attachments)==null?void 0:ot.length)||0,icon:Je,helper:"Eklenen dosya sayısı",accent:"from-slate-50/80 via-white to-white border-slate-100",tooltip:"Göreve eklenmiş toplam dosya sayısı"},{label:"Yorumlar",value:Ot.length||0,icon:Cs,helper:"Yorum sayısı",accent:"from-emerald-50/80 via-white to-white border-emerald-100",tooltip:"Göreve eklenmiş toplam yorum sayısı"}],nt=[(t==null?void 0:t.id)&&{label:"Görev ID",value:t.id.substring(0,8)},(t==null?void 0:t.created_at)&&{label:"Oluşturulma",value:Fe(new Date(t.created_at))},(t==null?void 0:t.due_date)&&{label:"Termin",value:Fe(new Date(t.due_date))},(t==null?void 0:t.priority)&&{label:"Öncelik",value:t.priority.toString()}].filter(Boolean),ya=s=>{switch(s){case"pending":return"secondary";case"in_progress":return"default";case"completed":return"default";default:return"outline"}};return e.jsxs(e.Fragment,{children:[e.jsx(te,{open:b,onOpenChange:Q,children:e.jsx(ae,{className:"!max-w-[100vw] sm:!max-w-[95vw] !w-[100vw] sm:!w-[95vw] !h-[100vh] sm:!h-[90vh] !max-h-[100vh] sm:!max-h-[90vh] !left-0 sm:!left-[2.5vw] !top-0 sm:!top-[5vh] !right-0 sm:!right-auto !bottom-0 sm:!bottom-auto !translate-x-0 !translate-y-0 overflow-hidden !p-0 gap-0 bg-white flex flex-col !m-0 !rounded-none sm:!rounded-lg !border-0 sm:!border","aria-describedby":"task-detail-description","data-task-modal":!0,children:e.jsxs("div",{className:"flex flex-col h-full min-h-0",children:[e.jsx(re,{className:"p-3 sm:p-4 border-b bg-white flex-shrink-0",children:e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 flex-1 min-w-0",children:[e.jsx("div",{className:"h-8 w-8 sm:h-10 sm:w-10 rounded-lg bg-primary/10 flex items-center justify-center border border-primary/20 flex-shrink-0",children:e.jsx(za,{className:"h-4 w-4 sm:h-5 sm:w-5 text-primary"})}),e.jsxs(ie,{className:"text-lg sm:text-xl font-semibold text-foreground truncate",children:["Görev Detayı - ",(t==null?void 0:t.title)||"Yeni Görev"]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 flex-shrink-0 relative z-10 pr-10 sm:pr-12",children:[(t==null?void 0:t.approvalStatus)==="pending"&&e.jsx(I,{variant:"outline",className:"border-yellow-500 text-yellow-600 bg-yellow-50 text-xs px-2 sm:px-3 py-1 relative z-10",children:"Onay Bekliyor"}),t&&e.jsx(I,{variant:ya(t.status),className:"text-xs px-2 sm:px-3 py-1 relative z-10",children:xe(t.status)}),(t==null?void 0:t.priority)&&e.jsxs(I,{variant:t.priority>=3?"destructive":"secondary",className:"text-xs px-2 sm:px-3 py-1 relative z-10",children:["Öncelik ",t.priority]})]})]})}),nt.length>0&&e.jsx("div",{className:"px-3 sm:px-6 py-2 sm:py-3 border-b bg-gray-50/50 flex flex-wrap items-center gap-2 flex-shrink-0",children:nt.map(s=>e.jsxs("div",{className:"flex items-center gap-1 rounded-full border bg-muted/40 px-3 py-1.5 text-xs font-medium text-muted-foreground",children:[e.jsxs("span",{className:"text-muted-foreground/70",children:[s.label,":"]}),e.jsx("span",{className:"text-foreground",children:s.value})]},`${s.label}-${s.value}`))}),e.jsx("div",{className:"flex-1 overflow-hidden bg-gray-50/50 p-3 sm:p-4 min-h-0",children:e.jsx("div",{className:"max-w-full mx-auto h-full overflow-y-auto",children:Bs?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}):e.jsxs("div",{className:"space-y-6",children:[(t==null?void 0:t.approvalStatus)==="pending"&&r&&((t.createdBy||t.created_by)===r.id||X||H||kt)&&e.jsx("div",{className:"p-4 bg-yellow-50 border border-yellow-200 rounded-lg",children:e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-semibold text-yellow-900",children:"Görev Tamamlanma Onayı Bekliyor"}),e.jsx("p",{className:"text-sm text-yellow-700",children:"Bu görev tamamlandı olarak işaretlendi ve onayınızı bekliyor."})]}),e.jsxs("div",{className:"flex gap-2 w-full sm:w-auto",children:[e.jsxs(x,{size:"sm",variant:"outline",className:"flex-1 sm:flex-none border-yellow-300 text-yellow-900 hover:bg-yellow-100",onClick:Ut,disabled:w,children:[e.jsx(ke,{className:"h-4 w-4 mr-1"}),"Reddet"]}),e.jsxs(x,{size:"sm",className:"flex-1 sm:flex-none bg-yellow-600 hover:bg-yellow-700 text-white border-none",onClick:Zt,disabled:w,children:[e.jsx(gt,{className:"h-4 w-4 mr-1"}),"Onayla"]})]})]})}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-4 gap-4 auto-rows-fr",children:ba.map(s=>{const a=s.icon;return e.jsxs(_a,{delayDuration:150,children:[e.jsx(Fa,{asChild:!0,children:e.jsxs("div",{className:`rounded-2xl border bg-gradient-to-br text-card-foreground p-4 shadow-sm transition hover:shadow-md hover:-translate-y-0.5 h-full ${s.accent}`,children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase tracking-wide text-muted-foreground",children:s.label}),e.jsx("p",{className:"text-2xl font-semibold mt-1 leading-tight",children:s.value})]}),e.jsx("div",{className:"rounded-full border p-2 bg-white/75 shadow-inner shrink-0",children:e.jsx(a,{className:"h-5 w-5 text-primary"})})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-3",children:s.helper})]})}),e.jsx(Aa,{children:s.tooltip})]},s.label)})}),e.jsxs(O,{children:[e.jsx(M,{className:"space-y-1",children:e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx(V,{className:"text-lg",children:"Görev Durumu"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:(()=>{if(T==="completed"&&(t==null?void 0:t.approvalStatus)==="approved")return"Görev onaylandı ve tamamlandı.";if(T==="completed"&&(t==null?void 0:t.approvalStatus)==="pending")return"Görev tamamlandı ve onay bekleniyor.";if(T==="completed")return"Görev tamamlandı. Onaya göndermek için butona tıklayın.";const s=ue();return s?`${xe(T)} aşamasındasınız. Sıradaki adım: ${s.label}`:"Workflow tamamlandı."})()})]}),e.jsxs("div",{className:"text-xs text-muted-foreground text-right",children:["Son güncelleyen: ",t!=null&&t.statusUpdatedBy?we[t.statusUpdatedBy]||t.statusUpdatedBy:(r==null?void 0:r.fullName)||"-",e.jsx("br",{}),e.jsx("span",{className:"text-[11px]",children:t!=null&&t.statusUpdatedAt?Fe(t.statusUpdatedAt):""})]})]})}),e.jsx($,{className:"p-4 sm:p-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex items-center justify-between overflow-x-auto overflow-y-visible pt-2 pb-4",children:le.map((s,a)=>{const i=s.icon,d=ks(),g=a===d,o=a<d,u=(X||H)&&a<d&&s.value!=="approved"&&(t==null?void 0:t.approvalStatus)!=="pending";return e.jsxs("div",{className:"flex items-center flex-1 min-w-0",children:[e.jsxs("div",{className:"flex flex-col items-center flex-1 min-w-0",children:[e.jsx("div",{onClick:u?()=>qt(s.value):void 0,className:`
                                      w-10 h-10 rounded-full flex items-center justify-center border-2 transition-all relative z-10
                                      ${g?"bg-primary text-primary-foreground border-primary scale-110":""}
                                      ${o?"bg-green-500 text-white border-green-500":""}
                                      ${!g&&!o?"bg-muted border-muted-foreground/20":""}
                                      ${u?"cursor-pointer hover:scale-110 hover:shadow-md":""}
                                    `,title:u?`${s.label} durumuna geri al`:void 0,children:e.jsx(i,{className:`h-5 w-5 ${g||o?"text-white":s.color}`})}),e.jsx("p",{className:`text-xs mt-2 text-center font-medium ${g?"text-primary":o?"text-green-600":"text-muted-foreground"}`,children:s.label})]}),a<le.length-1&&e.jsx("div",{className:`flex-1 h-0.5 mx-2 ${o?"bg-green-500":"bg-muted"}`})]},s.value)})}),T==="completed"&&(t==null?void 0:t.approvalStatus)==="approved"?null:T==="completed"&&(t==null?void 0:t.approvalStatus)!=="pending"&&(t==null?void 0:t.approvalStatus)!=="approved"?e.jsx("div",{className:"flex justify-center pt-4 border-t",children:e.jsx(x,{onClick:It,disabled:qe,className:"gap-2",children:qe?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"Gönderiliyor..."]}):e.jsxs(e.Fragment,{children:[e.jsx(pr,{className:"h-4 w-4"}),"Onaya Gönder"]})})}):ue()&&(t==null?void 0:t.approvalStatus)!=="pending"&&(t==null?void 0:t.approvalStatus)!=="approved"&&ue().value==="completed"?e.jsx("div",{className:"flex justify-center pt-4 border-t",children:e.jsx(x,{onClick:()=>Yt(ue().value),disabled:qe,className:"gap-2",children:qe?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"Güncelleniyor..."]}):e.jsxs(e.Fragment,{children:[(()=>{const s=ue().icon;return e.jsx(s,{className:"h-4 w-4"})})(),ue().label," Durumuna Geç"]})})}):null,(t==null?void 0:t.approvalStatus)==="rejected"&&(t==null?void 0:t.rejectionReason)&&e.jsx("div",{className:"mt-4 pt-4 border-t",children:e.jsx("div",{className:"p-3 bg-red-50 border border-red-200 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(ft,{className:"h-4 w-4 text-red-600 mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-semibold text-red-900 mb-1",children:"Görev Onayı Reddedildi"}),e.jsx("p",{className:"text-sm text-red-800 whitespace-pre-wrap",children:t.rejectionReason}),t.rejectedBy&&we[t.rejectedBy]&&e.jsxs("p",{className:"text-xs text-red-700 mt-2",children:["Reddeden: ",we[t.rejectedBy],t.rejectedAt&&e.jsxs("span",{className:"ml-2",children:["• ",Fe(t.rejectedAt)]})]})]})]})})})]})})]}),e.jsxs("div",{className:"grid gap-6 lg:grid-cols-2",children:[e.jsxs(O,{ref:Ht,children:[e.jsx(M,{className:"space-y-1",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(V,{className:"text-lg",children:"Açıklama"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Görev detayları ve notlar"})]}),!Ms&&se&&e.jsxs(x,{variant:"outline",size:"sm",onClick:()=>is(!0),className:"w-full sm:w-auto",children:[e.jsx(pe,{className:"h-4 w-4 mr-1"}),"Düzenle"]})]})}),e.jsx($,{className:"space-y-4",children:Ms?e.jsxs("div",{className:"space-y-3",children:[e.jsx(fe,{value:ls,onChange:s=>ns(s.target.value),placeholder:"Açıklama ekleyin...",rows:6,className:"resize-none"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(x,{size:"sm",onClick:ia,disabled:U,className:"flex-1 sm:flex-none",children:U?e.jsx(ge,{className:"h-4 w-4 animate-spin"}):"Kaydet"}),e.jsx(x,{size:"sm",variant:"outline",onClick:()=>{is(!1),ns(t.description||"")},children:"İptal"})]})]}):t.description?e.jsx("p",{className:"text-sm whitespace-pre-wrap leading-relaxed",children:t.description}):e.jsx("div",{className:"text-sm text-muted-foreground border border-dashed rounded-lg p-6 text-center bg-muted/30",children:"Henüz açıklama eklenmemiş."})})]}),e.jsxs(O,{children:[e.jsx(M,{className:"space-y-1",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs(V,{className:"text-lg flex items-center gap-2",children:[e.jsx(Fs,{className:"h-4 w-4"}),"Etiketler"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Görevi kategorize etmek için etiketler"})]}),!Vs&&se&&e.jsxs(x,{variant:"outline",size:"sm",onClick:()=>Ge(!0),children:[e.jsx(pe,{className:"h-4 w-4 mr-1"}),"Düzenle"]})]})}),e.jsx($,{className:"space-y-4",children:e.jsx("div",{ref:qs,children:Vs?e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex flex-wrap gap-2.5 mb-4",children:t.labels&&t.labels.length>0?t.labels.map((s,a)=>e.jsxs("div",{className:"flex items-center gap-1.5 px-2.5 py-1 rounded-full text-xs font-semibold text-white cursor-pointer hover:opacity-90 transition-opacity",style:{backgroundColor:s.color||"#475569"},onClick:()=>la(s.name),children:[e.jsx("span",{children:s.name}),e.jsx(ke,{className:"h-3 w-3"})]},`${s.name}-${a}`)):e.jsx("p",{className:"text-sm text-[#5E6C84]",children:"Etiket bulunmuyor."})}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex gap-3",children:[e.jsx(G,{value:Ve,onChange:s=>cs(s.target.value),placeholder:"Etiket adı girin...",className:"flex-1 text-sm bg-white border-[#DFE1E6] text-[#172B4D] h-10",onKeyDown:s=>{s.key==="Enter"&&(s.preventDefault(),at())}}),e.jsx(x,{type:"button",onClick:at,size:"sm",disabled:!Ve.trim()||U,className:"bg-[#0079BF] hover:bg-[#005A8B] text-white font-medium h-10 px-4 disabled:opacity-50 disabled:cursor-not-allowed",children:"Ekle"})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:Zs.map(s=>e.jsx("button",{onClick:()=>Gt(s.value),className:he("w-8 h-8 rounded border-2 transition-all hover:scale-110",s.class,Ks===s.value?"border-[#172B4D] scale-110 ring-2 ring-[#0079BF]":"border-[#DFE1E6] hover:border-[#C1C7D0]"),title:s.name},s.name))})]}),e.jsx("div",{className:"flex gap-2",children:e.jsx(x,{size:"sm",variant:"outline",onClick:()=>{Ge(!1),cs("")},className:"border-[#DFE1E6] text-[#172B4D] hover:bg-[#F4F5F7] font-medium",children:"Kapat"})})]}):e.jsx("div",{className:"flex flex-wrap gap-2.5",children:t.labels&&t.labels.length>0?t.labels.map((s,a)=>e.jsx("span",{className:"px-4 py-1.5 rounded-full text-xs font-semibold text-white shadow-sm",style:{backgroundColor:s.color||"#475569"},children:s.name},`${s.name}-${a}`)):e.jsx("p",{className:"text-sm text-muted-foreground italic",children:"Etiket bulunmuyor."})})})})]})]}),e.jsxs(O,{ref:Js,children:[e.jsx(M,{className:"space-y-1",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsx("div",{children:e.jsxs(V,{className:"text-lg flex items-center gap-2",children:[e.jsx(Je,{className:"h-4 w-4"}),"Ekler"]})})})}),e.jsx($,{className:"space-y-4",children:t.attachments&&t.attachments.length>0?t.attachments.map(s=>e.jsxs("div",{className:"flex items-center justify-between rounded-xl border border-[#DFE1E6] bg-[#F4F5F7] px-4 py-3 gap-4 hover:bg-[#EBECF0] transition-colors",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"text-sm font-medium text-[#172B4D] truncate",children:s.name}),(s.attachmentType==="drive_link"||s.storageProvider==="google_drive")&&e.jsxs(I,{variant:"outline",className:"text-xs",children:[e.jsx(Nt,{className:"h-3 w-3 mr-1"}),"Drive"]})]}),e.jsxs("p",{className:"text-xs text-[#5E6C84]",children:[s.uploadedAt?_e(s.uploadedAt instanceof q?s.uploadedAt.toDate():new Date(s.uploadedAt),"dd MMM yyyy, HH:mm",{locale:Ee}):"",s.size&&s.size>0&&` • ${(s.size/1024).toFixed(1)} KB`]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("a",{href:s.driveLink||s.url,target:"_blank",rel:"noopener noreferrer",download:s.storageProvider==="google_drive"||s.attachmentType==="drive_link"?void 0:s.name,children:e.jsx(x,{size:"sm",variant:"secondary",className:"bg-white border-[#DFE1E6] text-[#172B4D] hover:bg-[#F4F5F7] font-medium",children:s.storageProvider==="google_drive"||s.attachmentType==="drive_link"?"Aç":"İndir"})}),se&&e.jsx(x,{size:"sm",variant:"ghost",className:"text-[#EB5A46] hover:text-[#C9372C] hover:bg-[#EB5A46]/10",onClick:()=>Xt(s),children:e.jsx(Qe,{className:"h-4 w-4"})})]})]},s.id)):e.jsxs("div",{className:"text-center py-8 text-muted-foreground text-sm rounded-lg border border-dashed bg-muted/30",children:[e.jsx(Je,{className:"h-8 w-8 mx-auto mb-2 text-muted-foreground/50"}),e.jsx("p",{children:"Henüz dosya eklenmemiş"})]})})]}),e.jsxs(O,{children:[e.jsx(M,{className:"space-y-1",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsxs(V,{className:"text-lg flex items-center gap-2",children:[e.jsx(Ce,{className:"h-4 w-4"}),"Checklistler"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Görev için kontrol listeleri"})]})})}),e.jsxs($,{children:[e.jsx("div",{ref:Qs,className:"space-y-4",children:K&&e.jsxs("div",{className:"flex gap-3 flex-1 sm:flex-none",children:[e.jsx(G,{value:Z,onChange:s=>zs(s.target.value),placeholder:"Yeni checklist başlığı",className:"flex-1 bg-white border-[#DFE1E6] text-[#172B4D] h-10",onKeyDown:s=>{s.key==="Enter"&&Z.trim()&&st()}}),e.jsxs(x,{size:"sm",onClick:st,disabled:!Z.trim(),className:"gap-1 bg-[#0079BF] hover:bg-[#005A8B] text-white font-medium h-10 px-4 disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(pe,{className:"h-4 w-4"}),"Ekle"]})]})}),e.jsx("div",{className:"space-y-4",children:t.checklists&&t.checklists.length>0?t.checklists.map(s=>{var a;return e.jsxs("div",{className:"border border-[#DFE1E6] rounded-xl p-5 space-y-4 bg-[#F4F5F7] shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm text-[#172B4D]",children:s.title}),e.jsxs("p",{className:"text-xs text-[#5E6C84]",children:[s.completed_items||0,"/",s.total_items||0," tamamlandı"]}),s.total_items?e.jsx(fr,{value:s.total_items>0?(s.completed_items||0)/s.total_items*100:0,className:"h-2 mt-2"}):null]}),K&&e.jsx(x,{variant:"ghost",size:"icon",className:"text-[#5E6C84] hover:text-[#172B4D] hover:bg-white",onClick:()=>sa(s.id),children:e.jsx(Qe,{className:"h-4 w-4"})})]}),e.jsx("div",{className:"space-y-2.5",children:s.items&&s.items.length>0?s.items.map(i=>e.jsxs("div",{className:"flex items-center gap-3 text-sm p-2.5 rounded-lg hover:bg-white/50 transition-colors",children:[e.jsx("input",{type:"checkbox",checked:!!i.completed,onChange:d=>ta(s.id,i.id,d.target.checked),className:"h-4 w-4 accent-[#0079BF] cursor-pointer"}),e.jsx("span",{className:he("flex-1",i.completed?"line-through text-[#5E6C84]":"text-[#172B4D]"),children:i.text||i.title}),K&&e.jsx(x,{variant:"ghost",size:"icon",className:"h-7 w-7 text-[#5E6C84] hover:text-red-600 hover:bg-red-50",onClick:()=>aa(s.id,i.id),children:e.jsx(Qe,{className:"h-3.5 w-3.5"})})]},i.id)):e.jsx("p",{className:"text-xs text-[#5E6C84] italic py-2",children:"Henüz öğe yok."})}),K&&e.jsxs("div",{className:"flex gap-3 pt-2 border-t border-[#DFE1E6]",children:[e.jsx(G,{value:ce[s.id]||"",onChange:i=>Pe(d=>({...d,[s.id]:i.target.value})),placeholder:"Öğe ekle",className:"flex-1 bg-white border-[#DFE1E6] text-[#172B4D] h-10",onKeyDown:i=>{var d;i.key==="Enter"&&((d=ce[s.id])!=null&&d.trim())&&tt(s.id)}}),e.jsx(x,{size:"sm",variant:"secondary",onClick:()=>tt(s.id),disabled:!((a=ce[s.id])!=null&&a.trim()),className:"bg-white border-[#DFE1E6] text-[#172B4D] hover:bg-[#F4F5F7] font-medium h-10 px-4 disabled:opacity-50 disabled:cursor-not-allowed",children:"Ekle"})]})]},s.id)}):e.jsxs("div",{className:"text-center py-8 text-[#5E6C84] text-sm rounded-xl border border-dashed border-[#DFE1E6] bg-[#F4F5F7]",children:[e.jsx(Ce,{className:"h-8 w-8 mx-auto mb-2 text-[#A5ADBA]"}),e.jsx("p",{children:"Herhangi bir checklist bulunmuyor"})]})})]})]}),R&&R.status==="pending"&&e.jsxs("div",{className:"rounded-2xl border-2 border-blue-200 bg-gradient-to-br from-blue-50 to-blue-100/50 p-6 space-y-4 shadow-sm",children:[e.jsx("div",{className:"font-semibold text-blue-700 text-base",children:"Size Atanan Görev"}),e.jsx("p",{className:"text-sm text-[#172B4D] leading-relaxed",children:"Bu görev size atanmış. Lütfen kabul edin veya reddedin."}),e.jsxs("div",{className:"flex gap-3 flex-wrap",children:[e.jsxs(x,{onClick:Wt,disabled:w,className:"flex-1 bg-emerald-500 hover:bg-emerald-600 text-white font-medium h-11 disabled:opacity-50 disabled:cursor-not-allowed shadow-sm",children:[e.jsx(gt,{className:"h-4 w-4 mr-2"}),w?"İşleniyor...":"Kabul Et"]}),e.jsxs(x,{variant:"destructive",onClick:()=>Be(!0),disabled:w,className:"flex-1 font-medium h-11 disabled:opacity-50 disabled:cursor-not-allowed shadow-sm",children:[e.jsx(ke,{className:"h-4 w-4 mr-2"}),"Reddet"]})]})]}),R&&R.status==="rejected"&&R.rejection_reason&&e.jsxs("div",{className:"rounded-2xl border-2 border-red-200 bg-gradient-to-br from-red-50 to-red-100/50 p-6 space-y-3 shadow-sm",children:[e.jsx("div",{className:"font-semibold text-red-700 text-base",children:"Görev Reddedildi"}),e.jsxs("p",{className:"text-sm text-[#172B4D] leading-relaxed",children:[e.jsx("strong",{children:"Reddetme Sebebi:"})," ",R.rejection_reason]})]}),e.jsxs("div",{className:"grid gap-6 lg:grid-cols-2",children:[e.jsxs(O,{ref:Xs,children:[e.jsx(M,{className:"space-y-1",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(V,{className:"text-lg",children:"Görevdeki Kişiler"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Atanan kullanıcılar ve durumları"})]}),!$s&&se&&e.jsxs(x,{variant:"outline",size:"sm",onClick:()=>Oe(!0),className:"w-full sm:w-auto",children:[e.jsx(pe,{className:"h-4 w-4 mr-1"}),"Düzenle"]})]})}),e.jsx($,{className:"space-y-4",children:$s?e.jsxs("div",{className:"space-y-4",children:[e.jsx(yt,{selectedUsers:ds,onSelectionChange:os}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(x,{size:"sm",onClick:na,disabled:U,className:"bg-[#0079BF] hover:bg-[#005A8B] text-white font-medium h-10 px-4 disabled:opacity-50 disabled:cursor-not-allowed",children:U?e.jsx(ge,{className:"h-4 w-4 animate-spin"}):"Kaydet"}),e.jsx(x,{size:"sm",variant:"outline",onClick:()=>{Oe(!1),os(_.map(s=>s.id))},className:"border-[#DFE1E6] text-[#172B4D] hover:bg-[#F4F5F7] font-medium h-10 px-4",children:"İptal"})]})]}):e.jsxs("div",{className:"space-y-3",children:[_.map(s=>e.jsxs("div",{className:"flex items-center gap-4 p-4 rounded-xl border border-[#DFE1E6] bg-[#F4F5F7] hover:bg-[#EBECF0] transition-colors shadow-sm",children:[e.jsx(Ma,{children:e.jsx(Va,{className:"bg-white text-[#172B4D]",children:ra(s.full_name)})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium text-[#172B4D]",children:s.full_name}),e.jsx("div",{className:"text-sm text-[#5E6C84]",children:s.email}),s.rejection_reason&&e.jsxs("div",{className:"text-xs text-red-600 mt-1",children:["Reddetme sebebi: ",s.rejection_reason]})]}),s.status==="accepted"&&s.completed_at&&e.jsx(I,{variant:"default",className:"bg-emerald-500 text-white font-medium",children:"Tamamlandı"}),s.status==="accepted"&&!s.completed_at&&e.jsx(I,{variant:"secondary",className:"bg-[#EBECF0] text-[#172B4D] font-medium",children:"Kabul Edildi"}),s.status==="rejected"&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(I,{variant:"destructive",className:"font-medium",children:"Reddedildi"}),s.assigned_by===(r==null?void 0:r.id)&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(x,{size:"sm",variant:"default",className:"h-7 text-xs",onClick:async()=>{if(!(!c||!s.assignment_id)){N(!0);try{await Wa(c,s.assignment_id),n.success("Görev reddi onaylandı"),await f(),m==null||m()}catch(a){n.error(a.message||"Red onaylanamadı")}finally{N(!1)}}},disabled:w,children:[e.jsx(Xe,{className:"h-3 w-3 mr-1"}),"Reddi Kabul Et"]}),e.jsxs(x,{size:"sm",variant:"outline",className:"h-7 text-xs",onClick:()=>{ss(s),Te(!0)},disabled:w,children:[e.jsx(Ba,{className:"h-3 w-3 mr-1"}),"Reddi Reddet"]})]})]}),s.status==="pending"&&e.jsx(I,{variant:"outline",className:"text-[#172B4D] border-[#DFE1E6] font-medium",children:"Bekliyor"})]},s.id)),_.length===0&&e.jsxs("div",{className:"text-center py-8 text-[#5E6C84] text-sm rounded-xl border border-dashed border-[#DFE1E6] bg-[#F4F5F7]",children:[e.jsx(Sa,{className:"h-8 w-8 mx-auto mb-2 text-[#A5ADBA]"}),e.jsx("p",{children:"Henüz kimse atanmadı"})]})]})})]}),e.jsxs(O,{ref:Ws,children:[e.jsx(M,{className:"space-y-1",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(V,{className:"text-lg",children:"Detaylar"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Tarih ve durum bilgileri"})]}),!Hs&&se&&e.jsxs(x,{variant:"ghost",size:"sm",onClick:()=>Me(!0),className:"text-[#5E6C84] hover:text-[#172B4D] h-6 px-2 text-xs",children:[e.jsx(Ta,{className:"h-3 w-3 mr-1"}),"Düzenle"]})]})}),e.jsxs($,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"rounded-lg border bg-muted/30 px-3 py-2",children:[e.jsx("p",{className:"text-xs text-muted-foreground uppercase tracking-wide",children:"Oluşturulma"}),e.jsx("p",{className:"text-sm font-medium mt-1",children:_e(new Date(t.created_at),"dd MMM yyyy HH:mm",{locale:Ee})})]}),e.jsxs("div",{className:"rounded-lg border bg-muted/30 px-3 py-2",children:[e.jsx("p",{className:"text-xs text-muted-foreground uppercase tracking-wide",children:"Bitiş"}),Hs?e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx(G,{type:"date",value:P,onChange:s=>ms(s.target.value),className:"flex-1 h-8 text-xs"}),e.jsx(x,{size:"sm",onClick:ca,disabled:U,className:"h-8 px-2",children:U?e.jsx(ge,{className:"h-3 w-3 animate-spin"}):"✓"}),e.jsx(x,{size:"sm",variant:"ghost",onClick:()=>{Me(!1),ms(t.due_date?t.due_date.split("T")[0]:"")},className:"h-8 px-2",children:"✕"})]}):e.jsx("p",{className:"text-sm font-medium mt-1",children:t.due_date?_e(new Date(t.due_date),"dd MMM yyyy HH:mm",{locale:Ee}):"-"})]}),e.jsxs("div",{className:"rounded-lg border bg-muted/30 px-3 py-2",children:[e.jsx("p",{className:"text-xs text-muted-foreground uppercase tracking-wide",children:"Durum"}),e.jsx("p",{className:"text-sm font-medium mt-1",children:xe(t.status)})]})]}),(t==null?void 0:t.approvalStatus)==="rejected"&&(t==null?void 0:t.rejectionReason)&&e.jsx("div",{className:"mt-4 pt-4 border-t",children:e.jsx("div",{className:"p-3 bg-red-50 border border-red-200 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(ft,{className:"h-4 w-4 text-red-600 mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-xs text-muted-foreground uppercase tracking-wide mb-1",children:"Red Nedeni"}),e.jsx("p",{className:"text-sm text-red-800 whitespace-pre-wrap font-medium",children:t.rejectionReason}),t.rejectedBy&&we[t.rejectedBy]&&e.jsxs("p",{className:"text-xs text-red-700 mt-2",children:["Reddeden: ",we[t.rejectedBy],t.rejectedAt&&e.jsxs("span",{className:"ml-2",children:["• ",Fe(t.rejectedAt)]})]})]})]})})})]})]})]}),se&&e.jsxs(O,{children:[e.jsx(M,{className:"space-y-1",children:e.jsxs(V,{className:"text-lg flex items-center gap-2",children:[e.jsx(vr,{className:"h-4 w-4"}),"Eylemler"]})}),e.jsx($,{className:"space-y-4",children:e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3",children:ja.map(s=>{const a=s.icon;return e.jsxs("button",{onClick:s.action,className:"flex items-center gap-3 rounded-xl border border-[#E1E4EA] bg-white px-4 py-3 text-left transition-all hover:-translate-y-0.5 hover:shadow-md hover:border-[#C1C7D0]",children:[e.jsx("div",{className:he("h-10 w-10 rounded-xl border border-transparent flex items-center justify-center shadow-sm",s.accent),children:e.jsx(a,{className:"h-5 w-5"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-semibold text-[#172B4D] mb-0.5",children:s.title}),e.jsx("p",{className:"text-xs text-[#5E6C84] truncate",children:s.description})]}),e.jsx(Pa,{className:"h-4 w-4 text-[#A5ADBA] flex-shrink-0"})]},s.id)})})})]}),e.jsxs(O,{children:[e.jsx(M,{className:"space-y-1",children:e.jsxs(V,{className:"text-lg flex items-center gap-2",children:[e.jsx(Nt,{className:"h-4 w-4"}),"İlişkiler"]})}),e.jsxs($,{className:"space-y-4",children:[e.jsxs(mt,{value:t.production_order_id?"linked":"none",onValueChange:s=>{s==="link"&&it(),s==="linked"&&et()},children:[e.jsx(xt,{className:"border-2 border-[#E1E4EA] text-[#172B4D] bg-white h-12 shadow-sm hover:border-[#0079BF] transition-colors",children:e.jsx(ut,{children:t.production_order_id?`Sipariş #${t.production_order_number||t.production_order_id}`:"Bağlı sipariş yok"})}),e.jsxs(ht,{children:[e.jsx(Ne,{value:"none",children:"Bağlı sipariş yok"}),t.production_order_id&&e.jsxs(Ne,{value:"linked",children:["Sipariş #",t.production_order_number||t.production_order_id]}),e.jsx(Ne,{value:"link",children:"Sipariş bağla"})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(x,{className:"flex-1 bg-[#0079BF] hover:bg-[#005A8B] text-white h-12 font-semibold shadow-md hover:shadow-lg transition-all",onClick:it,children:"Bağla"}),e.jsx(x,{variant:"outline",className:"flex-1 border-2 border-[#E1E4EA] text-[#172B4D] hover:bg-[#F4F5F7] hover:border-[#0079BF] h-12 font-semibold transition-all",onClick:ha,children:"Yenile"})]}),t.production_order_id&&e.jsxs("div",{className:"mt-4 rounded-xl border border-[#DFE1E6] bg-gradient-to-br from-[#F4F5F7] to-white p-4 space-y-3 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm font-semibold text-[#172B4D]",children:[e.jsx(Ds,{className:"h-4 w-4"}),"Bağlı Sipariş"]}),e.jsx("p",{className:"text-sm text-[#172B4D] font-medium",children:t.production_order_number||t.production_order_id}),t.production_order_customer&&e.jsx("p",{className:"text-xs text-[#5E6C84]",children:t.production_order_customer}),e.jsx(x,{variant:"outline",size:"sm",className:"w-full border-[#DFE1E6] text-[#172B4D] hover:bg-white font-medium h-10",onClick:et,disabled:Gs,children:Gs?e.jsx(ge,{className:"h-4 w-4 animate-spin"}):"Detayları Aç"})]})]})]}),se&&e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsxs(x,{variant:"outline",onClick:ga,disabled:w,className:"gap-2 h-10",children:[e.jsx(La,{className:"h-4 w-4"}),t!=null&&t.is_archived?"Arşivden Çıkar":"Arşivle"]}),e.jsxs(x,{variant:"outline",onClick:fa,className:"gap-2 h-10",children:[e.jsx(Qe,{className:"h-4 w-4"}),"Sil"]})]}),e.jsxs(O,{children:[e.jsx(M,{className:"space-y-1",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{children:e.jsxs(V,{className:"text-lg flex items-center gap-2",children:[e.jsx(Cs,{className:"h-4 w-4"}),"Yorumlar ve Etkinlik"]})}),e.jsx(I,{variant:"outline",className:"border-[#DFE1E6] text-[#5E6C84] font-medium",children:"Yakında"})]})}),e.jsxs($,{className:"space-y-4",children:[e.jsx(fe,{placeholder:"Yorum yaz...",className:"bg-white border-[#DFE1E6] text-[#172B4D] resize-none",disabled:!0}),e.jsx("p",{className:"text-xs text-[#5E6C84]",children:"Yorum altyapısı üzerinde çalışıyoruz."})]})]})]})})})]})})}),e.jsx(te,{open:Pt,onOpenChange:ts,children:e.jsxs(ae,{className:"max-w-md",children:[e.jsxs(re,{children:[e.jsx(ie,{children:"Google Drive Linki Ekle"}),e.jsx(De,{children:"Google Drive'dan bir dosya veya klasör linki ekleyin"})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{htmlFor:"drive-link-name",children:"İsim *"}),e.jsx(G,{id:"drive-link-name",value:Le,onChange:s=>rs(s.target.value),placeholder:"Örn: Proje Dokümantasyonu",className:"w-full"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{htmlFor:"drive-link",children:"Google Drive Linki *"}),e.jsx(G,{id:"drive-link",value:de,onChange:s=>as(s.target.value),placeholder:"https://drive.google.com/...",className:"w-full"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Google Drive dosya veya klasör linkini yapıştırın"})]})]}),e.jsxs(We,{children:[e.jsx(x,{variant:"outline",onClick:()=>{ts(!1),as(""),rs("")},children:"İptal"}),e.jsx(x,{onClick:Qt,disabled:Ts||!de.trim()||!Le.trim(),children:Ts?e.jsxs(e.Fragment,{children:[e.jsx(ge,{className:"h-4 w-4 animate-spin mr-2"}),"Ekleniyor..."]}):"Ekle"})]})]})}),e.jsx(te,{open:_t,onOpenChange:Be,children:e.jsxs(ae,{children:[e.jsxs(re,{children:[e.jsx(ie,{children:"Görevi Reddet"}),e.jsx(De,{children:"Görevi reddetmek için lütfen en az 20 karakterlik bir sebep belirtin."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs(k,{htmlFor:"rejection_reason",children:["Reddetme Sebebi ",e.jsx("span",{className:"text-destructive",children:"*"})," (En az 20 karakter)"]}),e.jsx(fe,{id:"rejection_reason",value:ne,onChange:s=>Ze(s.target.value),placeholder:"Görevi neden reddettiğinizi açıklayın (en az 20 karakter)...",rows:4,className:"mt-2"}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[ne.length,"/20 karakter"]})]}),e.jsxs(We,{children:[e.jsx(x,{variant:"outline",onClick:()=>{Be(!1),Ze("")},children:"İptal"}),e.jsx(x,{variant:"destructive",onClick:Jt,disabled:w||ne.trim().length<20,children:w?"İşleniyor...":"Reddet"})]})]})]})}),e.jsx(te,{open:Ft,onOpenChange:Se,children:e.jsxs(ae,{children:[e.jsxs(re,{children:[e.jsx(ie,{children:"Görev Onayını Reddet"}),e.jsx(De,{children:"Görev onayını reddetmek için lütfen bir not ekleyin. Görev tekrar panoya dönecektir."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs(k,{htmlFor:"rejection_approval_reason",children:["Reddetme Notu ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(fe,{id:"rejection_approval_reason",value:Re,onChange:s=>Ue(s.target.value),placeholder:"Görev onayını neden reddettiğinizi açıklayın...",rows:4,className:"mt-2"})]}),e.jsxs(We,{children:[e.jsx(x,{variant:"outline",onClick:()=>{Se(!1),Ue("")},children:"İptal"}),e.jsx(x,{variant:"destructive",onClick:ea,disabled:w||!Re.trim(),children:w?"İşleniyor...":"Reddet"})]})]})]})}),e.jsx(te,{open:At,onOpenChange:Te,children:e.jsxs(ae,{children:[e.jsxs(re,{children:[e.jsx(ie,{children:"Görev Reddi Reddet"}),e.jsx(De,{children:"Görev reddi reddedildiğinde görev tekrar atanan kişiye döner. Lütfen en az 20 karakterlik bir sebep belirtin."})]}),e.jsx("div",{className:"space-y-4 py-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{htmlFor:"rejection_rejection_reason",children:"Reddetme Sebebi *"}),e.jsx(fe,{id:"rejection_rejection_reason",value:B,onChange:s=>es(s.target.value),placeholder:"Görev reddi neden reddedildiğini açıklayın (en az 20 karakter)...",rows:4,className:B.length>0&&B.length<20?"border-destructive":""}),B.length>0&&B.length<20&&e.jsxs("p",{className:"text-xs text-destructive",children:["En az ",20-B.length," karakter daha gerekli"]}),B.length>=20&&e.jsxs("p",{className:"text-xs text-muted-foreground",children:[B.length," / 20 karakter"]})]})}),e.jsxs(We,{children:[e.jsx(x,{variant:"outline",onClick:()=>{Te(!1),es(""),ss(null)},disabled:w,children:"İptal"}),e.jsx(x,{variant:"destructive",onClick:async()=>{if(!(!c||!(ze!=null&&ze.assignment_id)||B.trim().length<20)){N(!0);try{await Ja(c,ze.assignment_id,B.trim()),n.success("Görev reddi reddedildi, görev tekrar atanan kişiye döndü"),Te(!1),es(""),ss(null),await f(),m==null||m()}catch(s){n.error(s.message||"Red reddedilemedi")}finally{N(!1)}}},disabled:w||B.trim().length<20,children:w?"Reddediliyor...":"Reddi Reddet"})]})]})}),Ls&&e.jsx(gr,{open:Rt,onOpenChange:Ps,order:Ls})]})};export{Hr as T};
