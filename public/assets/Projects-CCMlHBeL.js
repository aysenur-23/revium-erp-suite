const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/taskService-CQO0i9v5.js","assets/index-Xd90qdO9.js","assets/index-HS3kTX7E.css","assets/toastHelpers-I2G9dhou.js"])))=>i.map(i=>d[i]);
import{k as we,a as Ne,a5 as be,r as n,_,b as o,j as e,B as x,C as N,e as b,a6 as L,a7 as ye,X as U,c as $,d as M,w as h,R as Y,S as W,p as X,q as J,s as Q,t as g,a8 as Pe}from"./index-Xd90qdO9.js";import{M as Z,F as O,B as y,D as B,a as G,b as R,c as I,T as ee}from"./MainLayout-DW7UjMSA.js";import{S as ke}from"./search-input-QX7HVhJf.js";import{c as Ce,j as De,k as Ae,l as Te}from"./taskService-CQO0i9v5.js";import{canCreateProject as Se}from"./permissions-D79DzJt5.js";import{A as ze,a as Fe,b as Ee,c as _e,d as Le,e as Oe,f as Be,g as Ge}from"./alert-dialog-BVp-ELLM.js";import{T as Re}from"./TaskInlineForm-CDqKbM2W.js";import{C as se}from"./checkbox-BX7aNvy5.js";import{L as Ie}from"./loading-state-CyTUOPV3.js";import{P as ae}from"./plus-D9uLCipi.js";import{S as Ve}from"./square-pen-zeHrcQ7c.js";import{T as Ke}from"./trash-2-DlZRXDqX.js";import{S as re}from"./save-Bgz0wbo5.js";import"./rolePermissionsService-CoZ8Qmsy.js";import"./storageService-pEqhfEwa.js";import"./driveService-020R8zku.js";import"./UserMultiSelect-KlPlOKAA.js";import"./popover-BA39Kv9C.js";import"./avatar-KtUT5CWN.js";import"./list-checks-CkcaKLuC.js";const xs=()=>{const{user:a,isSuperAdmin:te,isAdmin:V}=we(),S=Ne(),[ie,le]=be(),[u,ne]=n.useState([]),[oe,K]=n.useState(!0),[ce,P]=n.useState(!1),[me,k]=n.useState(!1),[de,z]=n.useState(!1),[f,C]=n.useState(null),[F,xe]=n.useState(""),[D,E]=n.useState(!1),[t,c]=n.useState({name:"",description:"",status:"active",isPrivate:!1}),[q,A]=n.useState(null);n.useEffect(()=>{(async()=>{if(!a){E(!1);return}try{const i=await Pe(),d={id:a.id,email:a.email,emailVerified:a.emailVerified,fullName:a.fullName,displayName:a.fullName,phone:a.phone,dateOfBirth:a.dateOfBirth,role:a.roles,createdAt:null,updatedAt:null},r=await Se(d,i);E(r)}catch(i){console.error("Error checking create permission:",i),E(!1)}})()},[a]),n.useEffect(()=>{j()},[]);const j=async()=>{try{K(!0);const s=await Ce(),d=(await Promise.all(s.map(async r=>{if(!r.isPrivate||te||a!=null&&a.id&&r.createdBy===a.id)return r;if(a!=null&&a.id)try{const{getTasks:m}=await _(async()=>{const{getTasks:p}=await import("./taskService-CQO0i9v5.js").then(T=>T.W);return{getTasks:p}},__vite__mapDeps([0,1,2])),l=await m({projectId:r.id});if(l.some(p=>!!(p.createdBy===a.id||p.assignedUsers&&p.assignedUsers.includes(a.id))))return r;for(const p of l)try{const{getTaskAssignments:T}=await _(async()=>{const{getTaskAssignments:w}=await import("./taskService-CQO0i9v5.js").then(ve=>ve.W);return{getTaskAssignments:w}},__vite__mapDeps([0,1,2]));if((await T(p.id)).some(w=>w.assignedTo===a.id&&(w.status==="accepted"||w.status==="pending")))return r}catch{}}catch(m){console.error("Error checking project tasks:",m)}return null}))).filter(r=>!(r===null||r.name==="Gizli Görevler"&&r.isPrivate===!0&&r.description==="Projesi olmayan gizli görevler için otomatik oluşturulan proje"));ne(d)}catch(s){console.error("Fetch projects error:",s),o.error(s.message||"Projeler yüklenirken hata oluştu")}finally{K(!1)}},he=async()=>{if(!t.name.trim()){o.error("Proje adı gereklidir");return}if(!(a!=null&&a.id)){o.error("Kullanıcı bilgisi bulunamadı");return}try{await De({name:t.name.trim(),description:t.description.trim()||null,status:t.status,isPrivate:t.isPrivate||!1,createdBy:a.id}),o.success("Proje oluşturuldu"),P(!1),c({name:"",description:"",status:"active",isPrivate:!1}),await j();const s=ie.get("returnTo");s&&(le({}),S(s))}catch(s){console.error("Create project error:",s),o.error(s.message||"Proje oluşturulurken hata oluştu")}},ue=async()=>{if(!f||!t.name.trim()){o.error("Proje adı gereklidir");return}if(!(a!=null&&a.id)){o.error("Kullanıcı bilgisi bulunamadı");return}try{await Ae(f.id,{name:t.name.trim(),description:t.description.trim()||null,status:t.status},a.id),o.success("Proje güncellendi"),k(!1),C(null),c({name:"",description:"",status:"active",isPrivate:!1}),j()}catch(s){console.error("Update project error:",s),o.error(s.message||"Proje güncellenirken hata oluştu")}},pe=async()=>{if(f){if(!(a!=null&&a.id)){o.error("Kullanıcı bilgisi bulunamadı");return}try{await Te(f.id,a.id),o.success("Proje silindi"),j(),z(!1),C(null)}catch(s){console.error("Delete project error:",s),o.error(s.message||"Proje silinirken hata oluştu")}}},fe=s=>{C(s),c({name:s.name,description:s.description||"",status:s.status,isPrivate:s.isPrivate||!1}),k(!0)},ge=s=>{C(s),z(!0)},je=s=>{switch(s){case"active":return e.jsx(y,{variant:"default",children:"Aktif"});case"completed":return e.jsx(y,{variant:"secondary",children:"Tamamlandı"});case"archived":return e.jsx(y,{variant:"outline",children:"Arşivlendi"});default:return e.jsx(y,{children:s})}},H=u.filter(s=>{var m,l;const i=F.toLocaleLowerCase("tr-TR"),d=((m=s.name)==null?void 0:m.toLocaleLowerCase("tr-TR"))||"",r=((l=s.description)==null?void 0:l.toLocaleLowerCase("tr-TR"))||"";return d.includes(i)||r.includes(i)}),v=n.useMemo(()=>{const s=u.length,i=u.filter(l=>l.status==="active").length,d=u.filter(l=>l.status==="completed").length,r=u.filter(l=>l.status==="archived").length,m=u.filter(l=>l.isPrivate===!0).length;return{total:s,active:i,completed:d,archived:r,privateProjects:m}},[u]);return oe?e.jsx(Z,{children:e.jsx(Ie,{message:"Projeler yükleniyor..."})}):e.jsx(Z,{children:e.jsxs("div",{className:"space-y-4 sm:space-y-5",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3 sm:gap-4",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h1",{className:"text-xl sm:text-2xl md:text-3xl font-bold text-foreground",children:"Projeler"}),e.jsx("p",{className:"text-muted-foreground mt-0.5 sm:mt-1 text-xs sm:text-sm",children:"Projelerinizi yönetin ve görevlerinizi takip edin"})]}),e.jsxs(x,{className:"gap-2 w-full sm:w-auto min-h-[44px] sm:min-h-0",onClick:async()=>{if(!D){const{showPermissionErrorToast:s}=await _(async()=>{const{showPermissionErrorToast:i}=await import("./toastHelpers-I2G9dhou.js");return{showPermissionErrorToast:i}},__vite__mapDeps([3,1,2,0]));s("create","project");return}c({name:"",description:"",status:"active",isPrivate:!1}),P(!0)},disabled:!D,children:[e.jsx(ae,{className:"h-4 w-4"}),"Yeni Proje"]})]}),e.jsx("div",{className:"grid gap-3 sm:gap-4 grid-cols-2 sm:grid-cols-3 lg:grid-cols-5",children:[{label:"Toplam Proje",value:v.total,sub:"Tüm projeler",badgeClass:"text-primary"},{label:"Aktif",value:v.active,sub:"Devam eden projeler",badgeClass:"text-emerald-600"},{label:"Tamamlanan",value:v.completed,sub:"Kapatılan projeler",badgeClass:"text-blue-600"},{label:"Arşivlenmiş",value:v.archived,sub:"Arşivdeki projeler",badgeClass:"text-muted-foreground"},{label:"Gizli",value:v.privateProjects,sub:"Gizli projeler",badgeClass:"text-amber-600"}].map(s=>e.jsx(N,{className:"cursor-pointer hover:shadow-md transition-all duration-200 hover:border-primary/50",children:e.jsxs(b,{className:"p-4 sm:p-5",children:[e.jsx("p",{className:"text-xs sm:text-sm text-muted-foreground mb-2 truncate",children:s.label}),e.jsx("div",{className:"text-2xl sm:text-3xl font-bold mb-1",children:s.value}),e.jsx("p",{className:`text-xs font-medium ${s.badgeClass} line-clamp-1`,children:s.sub})]})},s.label))}),e.jsx(N,{children:e.jsx(b,{className:"p-4",children:e.jsx("div",{className:"flex flex-wrap items-center gap-3",children:e.jsx(ke,{placeholder:"Proje ara...",value:F,onChange:s=>xe(s.target.value),containerClassName:"flex-1 min-w-[200px] sm:min-w-[250px]"})})})}),e.jsx(N,{children:e.jsx(b,{className:"p-4 sm:p-6",children:e.jsx("div",{className:"space-y-3",children:H.length===0?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:F?"Arama sonucu bulunamadı":"Henüz proje yok"}):H.map(s=>{var i,d;return e.jsxs("div",{className:"flex flex-col gap-3 p-4 rounded-lg border border-border hover:bg-muted/50 transition-colors",children:[e.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-start sm:justify-between",children:[e.jsxs("div",{className:"flex-1 cursor-pointer",onClick:()=>S(`/projects/${s.id}/tasks`),children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(O,{className:"h-5 w-5 text-primary"}),e.jsx("h3",{className:"font-semibold text-foreground",children:s.name}),je(s.status),s.isPrivate&&e.jsxs(y,{variant:"outline",className:"gap-1",children:[e.jsx(L,{className:"h-3 w-3"}),"Gizli"]})]}),s.description&&e.jsx("p",{className:"text-sm text-muted-foreground",children:s.description}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-2",children:["Oluşturulma: ",(d=(i=s.createdAt)==null?void 0:i.toDate)==null?void 0:d.call(i).toLocaleDateString("tr-TR")]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx(x,{variant:"outline",size:"sm",onClick:r=>{if(r.stopPropagation(),!D&&!V){o.error("Görev ekleme yetkiniz yok. Sadece yönetici veya ekip lideri ekleyebilir.");return}A(m=>m===s.id?null:s.id)},disabled:!D&&!V,children:q===s.id?e.jsxs(e.Fragment,{children:[e.jsx(ye,{className:"h-4 w-4 mr-1"}),"Formu Kapat"]}):e.jsxs(e.Fragment,{children:[e.jsx(ae,{className:"h-4 w-4 mr-1"}),"Görev Ekle"]})}),e.jsx(x,{variant:"ghost",size:"sm",onClick:r=>{r.stopPropagation(),fe(s)},children:e.jsx(Ve,{className:"h-4 w-4"})}),e.jsx(x,{variant:"ghost",size:"sm",onClick:r=>{r.stopPropagation(),ge(s)},children:e.jsx(Ke,{className:"h-4 w-4 text-destructive"})})]})]}),q===s.id&&e.jsx(B,{open:!0,onOpenChange:()=>A(null),children:e.jsx(G,{className:"!max-w-[100vw] sm:!max-w-[95vw] !w-[100vw] sm:!w-[95vw] !h-[100vh] sm:!h-[90vh] !max-h-[100vh] sm:!max-h-[90vh] !left-0 sm:!left-[2.5vw] !top-0 sm:!top-[5vh] !right-0 sm:!right-auto !bottom-0 sm:!bottom-auto !translate-x-0 !translate-y-0 overflow-hidden !p-0 gap-0 bg-white flex flex-col !m-0 !rounded-none sm:!rounded-lg !border-0 sm:!border",children:e.jsxs("div",{className:"flex flex-col h-full min-h-0",children:[e.jsx(R,{className:"p-3 sm:p-4 border-b bg-white flex-shrink-0 relative pr-12 sm:pr-16",children:e.jsx(I,{className:"text-lg sm:text-xl font-semibold text-foreground",children:"Yeni Görev"})}),e.jsx("div",{className:"flex-1 overflow-hidden bg-gray-50/50 p-3 sm:p-4 min-h-0",children:e.jsx("div",{className:"max-w-full mx-auto h-full overflow-y-auto",children:e.jsx(Re,{mode:"create",projectId:s.id,defaultStatus:"pending",onCancel:()=>A(null),onSuccess:async r=>{A(null),await new Promise(m=>setTimeout(m,1500)),r?S(`/projects/${s.id}/tasks?highlight=${r}`):j()},className:"border-0 shadow-none p-0"})})})]})})})]},s.id)})})})}),e.jsx(B,{open:ce,onOpenChange:P,children:e.jsx(G,{className:"!max-w-[100vw] sm:!max-w-[95vw] !w-[100vw] sm:!w-[95vw] !h-[100vh] sm:!h-[90vh] !max-h-[100vh] sm:!max-h-[90vh] !left-0 sm:!left-[2.5vw] !top-0 sm:!top-[5vh] !right-0 sm:!right-auto !bottom-0 sm:!bottom-auto !translate-x-0 !translate-y-0 overflow-hidden !p-0 gap-0 bg-white flex flex-col !m-0 !rounded-none sm:!rounded-lg !border-0 sm:!border",children:e.jsxs("div",{className:"flex flex-col h-full min-h-0",children:[e.jsx(R,{className:"p-3 sm:p-4 border-b bg-white flex-shrink-0 relative pr-12 sm:pr-16",children:e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 flex-1 min-w-0",children:[e.jsx("div",{className:"h-8 w-8 sm:h-10 sm:w-10 rounded-lg bg-primary/10 flex items-center justify-center border border-primary/20 flex-shrink-0",children:e.jsx(O,{className:"h-4 w-4 sm:h-5 sm:w-5 text-primary"})}),e.jsx(I,{className:"text-lg sm:text-xl font-semibold text-foreground truncate",children:"Yeni Proje"})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 flex-shrink-0",children:[e.jsxs(x,{variant:"outline",size:"sm",className:"border-primary/20 hover:bg-primary/5 rounded-lg px-3 py-1.5 font-medium text-xs sm:text-sm flex-shrink-0",onClick:()=>P(!1),children:[e.jsx(U,{className:"h-3 w-3 sm:h-4 sm:w-4 mr-1.5 flex-shrink-0"}),"İptal"]}),e.jsxs(x,{variant:"default",size:"sm",className:"bg-primary hover:bg-primary/90 rounded-lg px-3 py-1.5 font-medium text-xs sm:text-sm flex-shrink-0 text-white",onClick:he,children:[e.jsx(re,{className:"h-3 w-3 sm:h-4 sm:w-4 mr-1.5 flex-shrink-0"}),"Oluştur"]})]})]})}),e.jsx("div",{className:"flex-1 overflow-hidden bg-gray-50/50 p-3 sm:p-4 min-h-0",children:e.jsx("div",{className:"max-w-full mx-auto h-full overflow-y-auto",children:e.jsxs(N,{children:[e.jsx($,{children:e.jsx(M,{className:"text-base sm:text-lg",children:"Proje Bilgileri"})}),e.jsxs(b,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"create-name",className:"text-sm sm:text-base",showRequired:!0,children:"Proje Adı"}),e.jsx(Y,{id:"create-name",value:t.name,onChange:s=>c({...t,name:s.target.value}),placeholder:"Proje adı",className:"min-h-[44px] sm:min-h-0",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"create-description",className:"text-sm sm:text-base",children:"Açıklama"}),e.jsx(ee,{id:"create-description",value:t.description,onChange:s=>c({...t,description:s.target.value}),placeholder:"Proje açıklaması",rows:4,className:"min-h-[100px] sm:min-h-[120px]"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"create-status",className:"text-sm sm:text-base",children:"Durum"}),e.jsxs(W,{value:t.status,onValueChange:s=>c({...t,status:s}),children:[e.jsx(X,{id:"create-status",className:"min-h-[44px] sm:min-h-0",children:e.jsx(J,{})}),e.jsxs(Q,{children:[e.jsx(g,{value:"active",children:"Aktif"}),e.jsx(g,{value:"completed",children:"Tamamlandı"}),e.jsx(g,{value:"archived",children:"Arşivlendi"})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2 pt-8",children:[e.jsx(se,{id:"create-private",checked:t.isPrivate,onCheckedChange:s=>c({...t,isPrivate:s})}),e.jsxs(h,{htmlFor:"create-private",className:"text-sm font-normal cursor-pointer text-muted-foreground flex items-center gap-1",children:[e.jsx(L,{className:"h-3 w-3"}),"Gizli Proje"]})]})]}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Gizli projeler sadece oluşturan ve yöneticiler tarafından görülebilir."})]})]})})})]})})}),e.jsx(B,{open:me,onOpenChange:k,children:e.jsx(G,{className:"!max-w-[100vw] sm:!max-w-[95vw] !w-[100vw] sm:!w-[95vw] !h-[100vh] sm:!h-[90vh] !max-h-[100vh] sm:!max-h-[90vh] !left-0 sm:!left-[2.5vw] !top-0 sm:!top-[5vh] !right-0 sm:!right-auto !bottom-0 sm:!bottom-auto !translate-x-0 !translate-y-0 overflow-hidden !p-0 gap-0 bg-white flex flex-col !m-0 !rounded-none sm:!rounded-lg !border-0 sm:!border",children:e.jsxs("div",{className:"flex flex-col h-full min-h-0",children:[e.jsx(R,{className:"p-3 sm:p-4 border-b bg-white flex-shrink-0 relative pr-12 sm:pr-16",children:e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 flex-1 min-w-0",children:[e.jsx("div",{className:"h-8 w-8 sm:h-10 sm:w-10 rounded-lg bg-primary/10 flex items-center justify-center border border-primary/20 flex-shrink-0",children:e.jsx(O,{className:"h-4 w-4 sm:h-5 sm:w-5 text-primary"})}),e.jsx(I,{className:"text-lg sm:text-xl font-semibold text-foreground truncate",children:"Proje Düzenle"})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 flex-shrink-0",children:[e.jsxs(x,{variant:"outline",size:"sm",className:"border-primary/20 hover:bg-primary/5 rounded-lg px-3 py-1.5 font-medium text-xs sm:text-sm flex-shrink-0",onClick:()=>k(!1),children:[e.jsx(U,{className:"h-3 w-3 sm:h-4 sm:w-4 mr-1.5 flex-shrink-0"}),"İptal"]}),e.jsxs(x,{variant:"default",size:"sm",className:"bg-primary hover:bg-primary/90 rounded-lg px-3 py-1.5 font-medium text-xs sm:text-sm flex-shrink-0 text-white",onClick:ue,children:[e.jsx(re,{className:"h-3 w-3 sm:h-4 sm:w-4 mr-1.5 flex-shrink-0"}),"Kaydet"]})]})]})}),e.jsx("div",{className:"flex-1 overflow-hidden bg-gray-50/50 p-3 sm:p-4 min-h-0",children:e.jsx("div",{className:"max-w-full mx-auto h-full overflow-y-auto",children:e.jsxs(N,{children:[e.jsx($,{children:e.jsx(M,{className:"text-base sm:text-lg",children:"Proje Bilgileri"})}),e.jsxs(b,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"edit-name",className:"text-sm sm:text-base",showRequired:!0,children:"Proje Adı"}),e.jsx(Y,{id:"edit-name",value:t.name,onChange:s=>c({...t,name:s.target.value}),placeholder:"Proje adı",className:"min-h-[44px] sm:min-h-0",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"edit-description",className:"text-sm sm:text-base",children:"Açıklama"}),e.jsx(ee,{id:"edit-description",value:t.description,onChange:s=>c({...t,description:s.target.value}),placeholder:"Proje açıklaması",rows:4,className:"min-h-[100px] sm:min-h-[120px]"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"edit-status",className:"text-sm sm:text-base",children:"Durum"}),e.jsxs(W,{value:t.status,onValueChange:s=>c({...t,status:s}),children:[e.jsx(X,{id:"edit-status",className:"min-h-[44px] sm:min-h-0",children:e.jsx(J,{})}),e.jsxs(Q,{children:[e.jsx(g,{value:"active",children:"Aktif"}),e.jsx(g,{value:"completed",children:"Tamamlandı"}),e.jsx(g,{value:"archived",children:"Arşivlendi"})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2 pt-8",children:[e.jsx(se,{id:"edit-private",checked:t.isPrivate,onCheckedChange:s=>c({...t,isPrivate:s})}),e.jsxs(h,{htmlFor:"edit-private",className:"text-sm font-normal cursor-pointer text-muted-foreground flex items-center gap-1",children:[e.jsx(L,{className:"h-3 w-3"}),"Gizli Proje"]})]})]}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Gizli projeler sadece oluşturan ve yöneticiler tarafından görülebilir."})]})]})})})]})})}),e.jsx(ze,{open:de,onOpenChange:z,children:e.jsxs(Fe,{children:[e.jsxs(Ee,{children:[e.jsx(_e,{children:"Projeyi Sil"}),e.jsx(Le,{children:f&&e.jsxs(e.Fragment,{children:[e.jsx("strong",{children:f.name})," projesini silmek istediğinizden emin misiniz? Bu işlem geri alınamaz."]})})]}),e.jsxs(Oe,{children:[e.jsx(Be,{children:"İptal"}),e.jsx(Ge,{onClick:pe,className:"bg-destructive text-destructive-foreground",children:"Sil"})]})]})})]})})};export{xs as default};
