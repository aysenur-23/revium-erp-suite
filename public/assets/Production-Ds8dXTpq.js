var B=(S,L,c)=>new Promise((D,C)=>{var T=o=>{try{d(c.next(o))}catch(u){C(u)}},R=o=>{try{d(c.throw(o))}catch(u){C(u)}},d=o=>o.done?D(o.value):Promise.resolve(o.value).then(T,R);d((c=c.apply(S,L)).next())});import{u as ce,T as E,a as P,j as e,B as y,C as U,b as V,S as H,c as K,d as G,e as Q,f as w}from"./index-BQmY0BmM.js";import{r as a,P as oe,A as xe,a as de,S as ue,T as pe}from"./lucide-react-CAeuRJQk.js";import{g as he,M as J,B as W,d as fe}from"./MainLayout-Dv9j77B5.js";import{S as ge}from"./search-input-DCf0xYml.js";import{T as je,a as Ne,b as z,c as p,d as ye,e as x}from"./table-zhTdMUM_.js";import{C as X}from"./currency-BpxR3_y8.js";import{A as be,a as we,b as Se,c as De,d as Ce,e as Te,f as _e,g as ke}from"./alert-dialog-vDPnsgl6.js";import{C as ve}from"./CreateOrderDialog-C62L0stY.js";import{O as Ae}from"./OrderDetailModal-BnPVxs_W.js";import{L as Oe}from"./loading-state-BC76X596.js";import"./taskService-CI62TrOj.js";import"./CustomerCombobox-LwAUFZox.js";import"./popover-Bq_PZ6uK.js";import"./CreateCustomerDialog-C7Uvoya8.js";const Le=[{value:"planned",label:"Planlanan"},{value:"in_production",label:"Üretimde"},{value:"quality_check",label:"Kalite Kontrol"},{value:"completed",label:"Tamamlandı"},{value:"on_hold",label:"Beklemede"}],Qe=()=>{ce();const[S,L]=a.useState([]),[c,D]=a.useState(!0),[C,T]=a.useState(!1),[R,d]=a.useState(!1),[o,u]=a.useState(!1),[_,k]=a.useState(null),[g,Z]=a.useState(""),[j,ee]=a.useState("created_at"),[N,se]=a.useState("desc"),[h,te]=a.useState("all"),[F,Re]=a.useState(null),[f,v]=a.useState(1),[A,ae]=a.useState(1);a.useEffect(()=>{b()},[j,N,h,g,f]),a.useEffect(()=>{f!==1&&v(1)},[h,j,N]),a.useEffect(()=>{const s=setTimeout(()=>{f!==1&&v(1),b()},300);return()=>clearTimeout(s)},[g]);const b=()=>B(void 0,null,function*(){D(!0);try{const s={};h!=="all"&&(s.status=h);let r=yield he(s);if(g){const i=g.toLocaleLowerCase("tr-TR");r=r.filter(m=>{var l,n,Y,$,q;return((l=m.order_number)==null?void 0:l.toLocaleLowerCase("tr-TR").includes(i))||((n=m.orderNumber)==null?void 0:n.toLocaleLowerCase("tr-TR").includes(i))||((Y=m.product_name)==null?void 0:Y.toLocaleLowerCase("tr-TR").includes(i))||(($=m.customer_name)==null?void 0:$.toLocaleLowerCase("tr-TR").includes(i))||((q=m.customerName)==null?void 0:q.toLocaleLowerCase("tr-TR").includes(i))})}r.sort((i,m)=>{let l,n;return j==="created_at"||j==="priority"?(l=i.createdAt,n=m.createdAt):j==="due_date"?(l=i.dueDate||i.deliveryDate,n=m.dueDate||m.deliveryDate):(l=i.orderNumber||"",n=m.orderNumber||""),l instanceof E&&(l=l.toMillis()),n instanceof E&&(n=n.toMillis()),l instanceof Date&&(l=l.getTime()),n instanceof Date&&(n=n.getTime()),N==="asc"?l>n?1:-1:l<n?1:-1});const O=(f-1)*50,M=O+50;L(r.slice(O,M)),ae(Math.ceil(r.length/50))}catch(s){console.error("Fetch production orders error:",s),P.error(s.message||"Siparişler yüklenirken hata oluştu")}finally{D(!1)}}),le=s=>({planned:"Planlanan",in_production:"Üretimde",quality_check:"Kalite Kontrol",completed:"Tamamlandı",on_hold:"Beklemede"})[s]||s,ne=s=>({planned:"bg-indigo-100 text-indigo-800 border-indigo-300",in_production:"bg-orange-100 text-orange-800 border-orange-300",quality_check:"bg-cyan-100 text-cyan-800 border-cyan-300",completed:"bg-green-100 text-green-800 border-green-300",on_hold:"bg-amber-100 text-amber-800 border-amber-300"})[s]||"bg-gray-100 text-gray-800 border-gray-300",I=s=>{if(!s)return"-";let t=null;if(s instanceof Date)t=s;else if(typeof s=="string")t=new Date(s);else if(s&&typeof s=="object")if("seconds"in s&&typeof s.seconds=="number")t=new Date(s.seconds*1e3);else if("toDate"in s&&typeof s.toDate=="function")try{t=s.toDate()}catch(r){return"-"}else"_seconds"in s&&typeof s._seconds=="number"&&(t=new Date(s._seconds*1e3));if(!t||isNaN(t.getTime()))return"-";try{return t.toLocaleDateString("tr-TR",{day:"2-digit",month:"short",year:"numeric"})}catch(r){return"-"}},re=s=>s==null?{label:"Öncelik: 0",className:"bg-muted text-muted-foreground"}:s>=4?{label:`Öncelik: ${s}`,className:"bg-destructive/15 text-destructive"}:s>=2?{label:`Öncelik: ${s}`,className:"bg-amber-100 text-amber-800"}:{label:`Öncelik: ${s}`,className:"bg-slate-200 text-slate-800"},ie=(s,t)=>{if(s==null)return`${t&&X[t]||"₺"}0,00`;const r=t||"TRY",O=r==="TRY"?"TRY":r,M=r==="TRY"?"tr-TR":"en-US",i=X[r]||"₺";try{return new Intl.NumberFormat(M,{style:"currency",currency:O,minimumFractionDigits:2}).format(s)}catch(m){return`${i}${s.toFixed(2)}`}},me=()=>B(void 0,null,function*(){if(_)try{yield fe(_.id),P.success("Sipariş silindi"),b(),u(!1),k(null)}catch(s){console.error("Delete production order error:",s),P.error(s.message||"Sipariş silinirken hata oluştu")}});return c?e.jsx(J,{children:e.jsx(Oe,{message:"Üretim siparişleri yükleniyor..."})}):e.jsxs(J,{children:[e.jsxs("div",{className:"space-y-3 sm:space-y-4 md:space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-2 sm:gap-3 md:gap-4",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h1",{className:"text-xl sm:text-2xl md:text-3xl font-bold text-foreground",children:"Üretim Siparişleri"}),e.jsx("p",{className:"text-muted-foreground mt-0.5 sm:mt-1 text-xs sm:text-sm",children:"Üretim süreçlerini yönetin"})]}),e.jsxs(y,{className:"gap-1.5 sm:gap-2 w-full sm:w-auto min-h-[44px] sm:min-h-10 text-xs sm:text-sm",onClick:()=>T(!0),children:[e.jsx(oe,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Yeni Sipariş"}),e.jsx("span",{className:"sm:hidden",children:"Yeni"})]})]}),e.jsx(U,{children:e.jsx(V,{className:"p-3 sm:p-4 md:p-6",children:e.jsxs("div",{className:"flex flex-col sm:flex-row items-stretch sm:items-center gap-2 sm:gap-3 md:gap-4",children:[e.jsx("div",{className:"flex-1 min-w-0 w-full sm:w-auto sm:min-w-[200px] md:min-w-[250px]",children:e.jsx(ge,{placeholder:"Sipariş ara...",className:"w-full h-9 sm:h-10 text-xs sm:text-sm",value:g,onChange:s=>Z(s.target.value)})}),e.jsx("div",{className:"w-full sm:w-auto sm:min-w-[160px] md:min-w-[180px]",children:e.jsxs(H,{value:h==="all"?"all":h,onValueChange:s=>te(s),children:[e.jsx(K,{className:"w-full h-9 sm:h-10 text-xs sm:text-sm",children:e.jsx(G,{placeholder:"Durum Filtrele"})}),e.jsxs(Q,{children:[e.jsx(w,{value:"all",children:"Tüm Durumlar"}),Le.map(s=>e.jsx(w,{value:s.value,children:s.label},s.value))]})]})}),e.jsx("div",{className:"w-full sm:w-auto sm:min-w-[160px] md:min-w-[180px]",children:e.jsxs(H,{value:j,onValueChange:s=>ee(s),children:[e.jsx(K,{className:"w-full h-9 sm:h-10 text-xs sm:text-sm",children:e.jsx(G,{placeholder:"Sırala"})}),e.jsxs(Q,{children:[e.jsx(w,{value:"created_at",children:"Tarihe Göre"}),e.jsx(w,{value:"priority",children:"Önceliğe Göre"}),e.jsx(w,{value:"due_date",children:"Termin Tarihine Göre"})]})]})}),e.jsxs(y,{variant:"outline",size:"sm",onClick:()=>se(N==="asc"?"desc":"asc"),className:"h-9 sm:h-10 text-xs sm:text-sm",children:[N==="asc"?e.jsx(xe,{className:"h-3.5 w-3.5 sm:h-4 sm:w-4 sm:mr-2"}):e.jsx(de,{className:"h-3.5 w-3.5 sm:h-4 sm:w-4 sm:mr-2"}),e.jsx("span",{className:"hidden sm:inline",children:N==="asc"?"Artan":"Azalan"})]})]})})}),e.jsx(U,{children:e.jsxs(V,{className:"p-0",children:[e.jsx("div",{className:"overflow-x-auto -mx-4 sm:mx-0 px-4 sm:px-0",children:e.jsx("div",{className:"inline-block min-w-full align-middle",children:e.jsxs(je,{className:"min-w-[1000px] sm:min-w-full",children:[e.jsx(Ne,{children:e.jsxs(z,{children:[e.jsx(p,{className:"text-xs sm:text-sm px-2 sm:px-4",children:"Sipariş No"}),e.jsx(p,{className:"text-xs sm:text-sm px-2 sm:px-4 hidden md:table-cell",children:"Müşteri"}),e.jsx(p,{className:"text-xs sm:text-sm px-2 sm:px-4",children:"Ürün / Miktar"}),e.jsx(p,{className:"text-xs sm:text-sm px-2 sm:px-4 hidden lg:table-cell",children:"Termin"}),e.jsx(p,{className:"text-xs sm:text-sm px-2 sm:px-4",children:"Durum"}),e.jsx(p,{className:"text-xs sm:text-sm px-2 sm:px-4 hidden xl:table-cell",children:"Öncelik"}),e.jsx(p,{className:"text-right text-xs sm:text-sm px-2 sm:px-4",children:"Tutar"}),e.jsx(p,{className:"text-right text-xs sm:text-sm px-2 sm:px-4",children:"İşlemler"})]})}),e.jsxs(ye,{children:[S.map(s=>{const t=re(s.priority);return e.jsxs(z,{className:"cursor-pointer hover:bg-muted/50 transition-colors",onClick:()=>{k(s),d(!0)},children:[e.jsx(x,{className:"font-medium text-xs sm:text-sm px-2 sm:px-4 py-2 sm:py-3",children:e.jsxs("div",{className:"flex flex-col gap-0.5",children:[e.jsx("span",{children:s.order_number||s.orderNumber||"-"}),e.jsx("span",{className:"md:hidden text-[10px] text-muted-foreground",children:s.customer_name||s.customerName||"-"}),e.jsx("span",{className:"lg:hidden text-[10px] text-muted-foreground",children:I(s.due_date||s.dueDate||s.created_at||s.createdAt)})]})}),e.jsx(x,{className:"text-xs sm:text-sm px-2 sm:px-4 py-2 sm:py-3 hidden md:table-cell",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-medium",children:s.customer_name||s.customerName||"-"}),s.customer_company&&e.jsx("span",{className:"text-[10px] sm:text-xs text-muted-foreground",children:s.customer_company})]})}),e.jsx(x,{className:"text-xs sm:text-sm px-2 sm:px-4 py-2 sm:py-3",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-medium",children:s.product_name||s.productName||"-"}),s.quantity&&e.jsxs("span",{className:"text-[10px] sm:text-xs text-muted-foreground",children:[s.quantity," ",s.unit||"Adet"]})]})}),e.jsx(x,{className:"text-xs sm:text-sm px-2 sm:px-4 py-2 sm:py-3 hidden lg:table-cell",children:I(s.due_date||s.dueDate||s.created_at||s.createdAt)}),e.jsx(x,{className:"px-2 sm:px-4 py-2 sm:py-3",children:e.jsx(W,{className:`${ne(s.status)} text-[10px] sm:text-xs`,children:le(s.status)})}),e.jsx(x,{className:"px-2 sm:px-4 py-2 sm:py-3 hidden xl:table-cell",children:e.jsx(W,{className:`${t.className} text-[10px] sm:text-xs`,children:t.label})}),e.jsx(x,{className:"text-right font-semibold text-xs sm:text-sm px-2 sm:px-4 py-2 sm:py-3",children:ie(s.totalAmount||s.total_amount||0,s.currency)}),e.jsx(x,{className:"text-right px-2 sm:px-4 py-2 sm:py-3",children:e.jsxs("div",{className:"flex items-center justify-end gap-1 sm:gap-2",onClick:r=>r.stopPropagation(),children:[e.jsx(y,{variant:"outline",size:"sm",className:"h-8 w-8 sm:h-9 sm:w-9 p-0",onClick:()=>{k(s),d(!0)},disabled:F===s.id,children:e.jsx(ue,{className:"h-3.5 w-3.5 sm:h-4 sm:w-4"})}),e.jsx(y,{variant:"outline",size:"sm",className:"h-8 w-8 sm:h-9 sm:w-9 p-0",onClick:()=>{k(s),u(!0)},disabled:F===s.id,children:e.jsx(pe,{className:"h-3.5 w-3.5 sm:h-4 sm:w-4"})})]})})]},s.id)}),S.length===0&&!c&&e.jsx(z,{children:e.jsx(x,{colSpan:8,className:"text-center py-6 sm:py-8 text-xs sm:text-sm text-muted-foreground",children:g||h!=="all"?"Arama sonucu bulunamadı":"Henüz üretim siparişi bulunmuyor"})})]})]})})}),A>1&&e.jsxs("div",{className:"flex flex-col gap-2 sm:gap-3 px-4 sm:px-6 py-3 sm:py-4 border-t md:flex-row md:items-center md:justify-between",children:[e.jsxs("div",{className:"text-xs sm:text-sm text-muted-foreground text-center md:text-left",children:["Sayfa ",f," / ",A]}),e.jsxs("div",{className:"flex gap-2 justify-center md:justify-end",children:[e.jsx(y,{variant:"outline",size:"sm",className:"h-8 sm:h-9 text-xs sm:text-sm",onClick:()=>v(s=>Math.max(1,s-1)),disabled:f===1||c,children:"Önceki"}),e.jsx(y,{variant:"outline",size:"sm",className:"h-8 sm:h-9 text-xs sm:text-sm",onClick:()=>v(s=>Math.min(A,s+1)),disabled:f===A||c,children:"Sonraki"})]})]})]})})]}),e.jsx(ve,{open:C,onOpenChange:T,onSuccess:b}),_&&e.jsx(Ae,{open:R,onOpenChange:d,order:_,onDelete:()=>{d(!1),u(!0)},onUpdate:b}),e.jsx(be,{open:o,onOpenChange:u,children:e.jsxs(we,{children:[e.jsxs(Se,{children:[e.jsx(De,{children:"Siparişi sil?"}),e.jsx(Ce,{children:"Bu işlem geri alınamaz. Sipariş kalıcı olarak silinecek."})]}),e.jsxs(Te,{children:[e.jsx(_e,{children:"İptal"}),e.jsx(ke,{onClick:me,children:"Sil"})]})]})})]})};export{Qe as default};
