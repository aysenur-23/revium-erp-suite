import{x as l,M as c,E as w,T as u,J as A,G as y,Q as p,H as h,I as g,F as R,a9 as T}from"./index-Xd90qdO9.js";import{m as D}from"./taskService-CQO0i9v5.js";const n="requests",B=async t=>{try{const e={...t,status:"pending",createdAt:p(),updatedAt:p()};return Object.keys(e).forEach(r=>{e[r]===void 0&&delete e[r]}),{id:(await h(l(c,n),e)).id,...e,createdAt:u.now(),updatedAt:u.now()}}catch(e){throw console.error("Create request error:",e),e}},f=async t=>{try{const e=l(c,n);let r=(await w(e)).docs.map(a=>({id:a.id,...a.data()}));return t!=null&&t.isSuperAdmin||(r=r.filter(a=>{const o=(t==null?void 0:t.createdBy)&&a.createdBy===t.createdBy,s=(t==null?void 0:t.assignedTo)&&a.assignedTo===t.assignedTo;return o||s})),r.sort((a,o)=>{const s=a.createdAt instanceof u?a.createdAt.toMillis():0;return(o.createdAt instanceof u?o.createdAt.toMillis():0)-s}),r}catch(e){throw console.error("Get requests error:",e),e}},C=async(t,e,d,r)=>{try{const a={status:e,approvedBy:d,approvedAt:p(),updatedAt:p()};e==="rejected"&&r&&(a.rejectionReason=r),await g(y(c,n,t),a);try{const s=(await R(y(c,n,t))).data();if(s){const i=await T(d),m=e==="approved"?"Talep Onaylandı":"Talep Reddedildi",q=`"${s.title}" talebiniz ${(i==null?void 0:i.fullName)||"Yönetici"} tarafından ${e==="approved"?"onaylandı":"reddedildi"}.`;await D({userId:s.createdBy,type:"system",title:m,message:q,read:!1,relatedId:t})}}catch(o){console.error("Notification error:",o)}}catch(a){throw console.error("Update request status error:",a),a}},N=async t=>{try{await A(y(c,n,t))}catch(e){throw console.error("Delete request error:",e),e}};export{B as c,N as d,f as g,C as u};
