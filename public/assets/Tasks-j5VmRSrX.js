const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/permissions-D79DzJt5.js","assets/rolePermissionsService-CoZ8Qmsy.js","assets/index-Xd90qdO9.js","assets/index-HS3kTX7E.css","assets/toastHelpers-I2G9dhou.js","assets/taskService-CQO0i9v5.js"])))=>i.map(i=>d[i]);
import{a3 as Xs,k as Js,u as Zs,a as et,a5 as st,r as n,b as f,a8 as tt,T as D,j as s,V as rt,B as C,A as at,l as Xe,m as Je,n as oe,C as Z,c as Ze,d as es,e as ee,S as ce,p as de,q as me,s as ue,t as b,a6 as _e,X as lt,o as nt,w as it,i as Ie,g as ot,h as ct,_ as ss}from"./index-Xd90qdO9.js";import{M as ts,D as rs,a as as,b as ls,c as ns,B as A,A as dt,E as mt,G as ut,H as is,I as pt,z as ht,d as xt,T as gt,e as ft,C as ms}from"./MainLayout-DW7UjMSA.js";import{A as vt,a as jt}from"./avatar-KtUT5CWN.js";import{S as yt}from"./search-input-QX7HVhJf.js";import{z as wt,A as bt,c as Nt,b as St,a as pe,B as At,C as kt,t as Tt,u as os,f as Ct}from"./taskService-CQO0i9v5.js";import{g as Dt}from"./requestService-BZtc3QPN.js";import"./alert-dialog-BVp-ELLM.js";import{T as _t}from"./TaskInlineForm-CDqKbM2W.js";import{T as It}from"./TaskBoard-fwyGe4xh.js";import{canCreateTask as Pt}from"./permissions-D79DzJt5.js";import{P as Ft}from"./plus-D9uLCipi.js";import{S as Gt}from"./send-DtcYVw6S.js";import{C as cs}from"./calendar-days-DIIfLF_e.js";import{E as zt}from"./ellipsis-vertical-gVlTlFy-.js";import{T as Rt}from"./trash-2-DlZRXDqX.js";import{F as Bt}from"./folder-DUFwF4S_.js";import{C as Ot}from"./circle-dot-CCfpRgG9.js";import{i as ds,a as Ut}from"./isBefore-CpsBulHW.js";import{s as Lt}from"./format-DuC-NjES.js";import{a as Mt}from"./addDays-b8IynWul.js";import"./storageService-pEqhfEwa.js";import"./driveService-020R8zku.js";import"./checkbox-BX7aNvy5.js";import"./UserMultiSelect-KlPlOKAA.js";import"./popover-BA39Kv9C.js";import"./list-checks-CkcaKLuC.js";import"./user-plus-DWuSLDZe.js";import"./tag-EYbV-h0Y.js";import"./message-square-BAQ_w3zD.js";import"./isToday-C_-qpr0F.js";import"./isSameDay-CmhUF_DM.js";import"./rolePermissionsService-CoZ8Qmsy.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Et=Xs("Flame",[["path",{d:"M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.153.433-2.294 1-3a2.5 2.5 0 0 0 2.5 2.5z",key:"96xj49"}]]),$t=(r,_,d)=>{const V=_.map(F=>{const g=d.find(O=>O.id===F.assignedTo);return g?{id:g.id,full_name:g.fullName||g.displayName,email:g.email}:null}).filter(F=>F!==null);return{id:r.id,title:r.title,description:r.description||null,status:r.status,priority:r.priority,due_date:r.dueDate?r.dueDate instanceof D?r.dueDate.toDate().toISOString():new Date(r.dueDate).toISOString():null,created_at:r.createdAt instanceof D?r.createdAt.toDate().toISOString():new Date(r.createdAt).toISOString(),assignedUsers:V,approvalStatus:r.approvalStatus,createdBy:r.createdBy,projectId:r.projectId,isArchived:r.isArchived,is_archived:r.isArchived}},$=[{value:"pending",label:"Yapılacak",icon:Ot,color:"text-amber-500"},{value:"in_progress",label:"Devam Ediyor",icon:ms,color:"text-blue-500"},{value:"completed",label:"Tamamlandı",icon:Ie,color:"text-emerald-600"},{value:"approved",label:"Onaylandı",icon:Ie,color:"text-green-600"}],Ar=()=>{const{user:r,isSuperAdmin:_}=Js(),{projectId:d}=Zs();et();const[V]=st(),F=V.get("taskId"),g=V.get("type"),O=V.get("filter"),re=V.get("view"),[I,us]=n.useState([]),[Pe,ps]=n.useState([]),[W,hs]=n.useState([]),[Vt,xs]=n.useState([]),[y,gs]=n.useState([]),[Fe,fs]=n.useState([]),[vs,Ge]=n.useState(!0);n.useState(null);const[he,js]=n.useState([]),[ze,ys]=n.useState([]),[ws,bs]=n.useState(0),[Ns,Ss]=n.useState(0);n.useState("pending");const[As,xe]=n.useState(!1),[se,ks]=n.useState("create"),[U,Re]=n.useState(null),[Ts,Cs]=n.useState("pending"),ge=(e,t)=>{if(e==="new"){const a=t&&["pending","in_progress","completed"].includes(t)?t:"pending";ae("create",null,a);return}ae("edit",e)},ae=(e,t,a="pending")=>{ks(e),Re(t||null),Cs(a),xe(!0)},Be=()=>{xe(!1),Re(null)},Ds=async()=>{Be()},[L,Oe]=n.useState(""),[G,M]=n.useState("all"),[q,Ue]=n.useState("created_at"),[Wt,Le]=n.useState(null),[P,z]=n.useState("board"),[S,E]=n.useState("all"),[p,fe]=n.useState(O==="my-tasks"?"my-tasks":"all"),[R,Y]=n.useState(null),[j,H]=n.useState("all"),[_s,ve]=n.useState(!1),[je,Me]=n.useState(null),[K,ye]=n.useState(""),[Ee,$e]=n.useState(!1),[Is,we]=n.useState(!1),[be,Ps]=n.useState(null),[Ne,Fs]=n.useState(new Map),[Ve,Gs]=n.useState([]);n.useEffect(()=>{fe(O==="my-tasks"?"my-tasks":"all")},[O]),n.useEffect(()=>{if(F&&y.length>0){const e=y.find(t=>t.id===F);e&&ge(F,e.status)}},[F,y]),n.useEffect(()=>{re==="board"?z("board"):re==="list"&&z("list")},[re]),n.useEffect(()=>{r&&(g==="general"?H("general"):d?(zs(),H(d)):H("all"),Rs())},[r,d,g]),n.useEffect(()=>{if(!r)return;const t=wt(g==="general"?{projectId:"general"}:O==="my-tasks"?{}:d?{projectId:d}:{},async a=>{try{const l=Date.now(),h=5*60*1e3,c=!he.length||l-ws>h,x=!ze.length||l-Ns>h;let o=he,v=ze;c&&(o=await ot(),js(o),bs(l)),x&&(v=await Nt(),ys(v),Ss(l));const m=await Dt({createdBy:r.id}),w=new Map;(Array.isArray(v)?v:[]).forEach(i=>{i!=null&&i.id&&w.set(i.id,i)}),Fs(w);const ie=(await Promise.allSettled((Array.isArray(v)?v:[]).map(async i=>{var N;if(!(i!=null&&i.id))return null;try{if(((N=i.name)==null?void 0:N.toLowerCase())==="gizli görevler")return null;if(!i.isPrivate||_||r!=null&&r.id&&i.createdBy===r.id)return i;if(r!=null&&r.id)try{const k=await St({projectId:i.id});if(Array.isArray(k)&&k.some(u=>u?!!(u.createdBy===r.id||Array.isArray(u.assignedUsers)&&u.assignedUsers.includes(r.id)):!1))return i;for(const u of k)if(u!=null&&u.id)try{const T=await pe(u.id);if(Array.isArray(T)&&T.some(De=>(De==null?void 0:De.assignedTo)===(r==null?void 0:r.id)))return i}catch{}}catch{}return null}catch(k){return console.error(`Error processing project ${i.id}:`,k),null}}))).filter(i=>i.status==="fulfilled").map(i=>i.value).filter(i=>i!==null);Gs(ie),xs(m);const Ks=(await Promise.all((Array.isArray(a)?a:[]).map(async i=>{if(!(i!=null&&i.id))return null;try{const N=await pe(i.id);return{firebaseTask:i,assignments:Array.isArray(N)?N:[]}}catch(N){return console.error(`Error fetching assignments for task ${i.id}:`,N),{firebaseTask:i,assignments:[]}}}))).filter(i=>i!==null),Ye=[],He=[],Ke=[],Qe=[];Ks.forEach(({firebaseTask:i,assignments:N})=>{if(!i)return;const k=$t(i,Array.isArray(N)?N:[],Array.isArray(o)?o:[]);if(Qe.push(k),i.isArchived){Ke.push(k);return}const u=(Array.isArray(N)?N:[]).filter(T=>(T==null?void 0:T.status)!=="rejected").find(T=>(T==null?void 0:T.assignedTo)===(r==null?void 0:r.id));u&&Ye.push({...k,assignment:{id:u.id,task_id:u.taskId,assigned_to:u.assignedTo,assigned_at:u.assignedAt instanceof D?u.assignedAt.toDate().toISOString():new Date(u.assignedAt).toISOString(),accepted_at:u.acceptedAt instanceof D?u.acceptedAt.toDate().toISOString():u.acceptedAt?new Date(u.acceptedAt).toISOString():null,completed_at:u.completedAt instanceof D?u.completedAt.toDate().toISOString():u.completedAt?new Date(u.completedAt).toISOString():null,rejected_at:u.rejectionReason?new Date().toISOString():void 0,rejection_reason:u.rejectionReason||void 0}}),i.createdBy===r.id&&He.push(k)}),us(Ye),ps(He),hs(Ke),gs(Qe),fs(a),Ge(!1)}catch(l){console.error("Real-time tasks update error:",l),Ge(!1)}});return()=>{t()}},[r,d,g,O,_]);const zs=async()=>{if(d)try{const e=await bt(d);Ps(e)}catch(e){console.error("Fetch project error:",e),f.error(e.message||"Proje yüklenirken hata oluştu")}},Rs=async()=>{if(!r){we(!1);return}try{const e=await tt(),t={id:r.id,email:r.email,emailVerified:r.emailVerified,fullName:r.fullName,displayName:r.fullName,phone:r.phone,dateOfBirth:r.dateOfBirth,role:r.roles,createdAt:D.now(),updatedAt:D.now()},a=await Pt(t,e);we(a)}catch(e){console.error("Permission check error:",e),we(!1)}},Bs=async e=>{Le(e);try{await At(e),f.success("Görev başarıyla silindi")}catch(t){console.error("Delete task error:",t),f.error(t.message||"Görev silinirken hata oluştu")}finally{Le(null)}},Os=async e=>{if(r!=null&&r.id)try{await kt(e,r.id),f.success("Görev arşivlendi")}catch(t){console.error("Archive task error:",t),f.error(t.message||"Görev arşivlenirken hata oluştu")}},Us=async()=>{if(!je||!K.trim()||K.trim().length<20){f.error("Reddetme sebebi en az 20 karakter olmalıdır");return}$e(!0);try{const e=je.task_id;await Tt(e,je.id,K.trim()),f.success("Görev reddedildi"),ve(!1),ye(""),Me(null)}catch(e){console.error("Reject task error:",e),f.error(e.message||"Görev reddedilemedi")}finally{$e(!1)}},Ls=e=>{switch(e){case"completed":return s.jsx(Ie,{className:"h-5 w-5 text-success"});case"in_progress":return s.jsx(ms,{className:"h-5 w-5 text-warning"});default:return s.jsx(ct,{className:"h-5 w-5 text-muted-foreground"})}},We=e=>({pending:"Yapılacak",in_progress:"Devam Ediyor",completed:"Tamamlandı",approved:"Onaylandı"})[e]||e,Ms=e=>{if(!e)return"-";let t;return e instanceof D?t=e.toDate():e instanceof Date?t=e:t=new Date(e),Number.isNaN(t.getTime())?"-":t.toLocaleDateString("tr-TR",{day:"2-digit",month:"short",year:"numeric"})},Q=e=>{if(!e.due_date)return!1;const t=new Date(e.due_date);return ds(t,new Date)&&e.status!=="completed"},te=e=>{if(!e.due_date)return!1;const t=new Date(e.due_date),a=Lt(new Date),l=Mt(a,3);return!Q(e)&&(Ut(t,a)||t.getTime()===a.getTime())&&ds(t,l)&&e.status!=="completed"},Es=e=>{if(!e)return"-";try{return new Date(e).toLocaleDateString("tr-TR",{day:"2-digit",month:"short"})}catch{return e}},$s=e=>e.split(" ").map(t=>t[0]).join("").toUpperCase().slice(0,2),Se=(e,t=!1,a=!1)=>e.filter(l=>{var Ce,ie;if(a){let J=!0;return d?J=l.projectId===d:j==="all"?J=!0:j==="general"?J=l.projectId==="general":J=l.projectId===j,J}const h=L.toLocaleLowerCase("tr-TR"),c=((Ce=l.title)==null?void 0:Ce.toLocaleLowerCase("tr-TR"))||"",x=((ie=l.description)==null?void 0:ie.toLocaleLowerCase("tr-TR"))||"",o=c.includes(h)||x.includes(h),v=G==="all"||l.status===G,m=t?!0:S==="all"||S==="due_soon"&&te(l)||S==="overdue"&&Q(l)||S==="high_priority"&&l.priority>=4;let w=!0;return d?w=l.projectId===d:g==="general"?w=l.projectId==="general":j==="all"?w=!0:j==="general"?w=l.projectId==="general":w=l.projectId===j,o&&v&&m&&w}),Ae=e=>Array.isArray(e)?[...e].sort((t,a)=>q==="priority"?a.priority-t.priority:q==="due_date"?t.due_date?a.due_date?new Date(t.due_date).getTime()-new Date(a.due_date).getTime():-1:1:new Date(a.created_at).getTime()-new Date(t.created_at).getTime()):[],le=n.useMemo(()=>{let e=[];return p==="archived"?e=W:p==="my-tasks"?e=I.map(t=>{const{assignment:a,...l}=t;return l}):g==="general"?e=I.map(t=>{const{assignment:a,...l}=t;return l}):e=y,R&&R!=="all"&&(e=e.filter(t=>R==="active"?t.status!=="completed":R==="completed"?t.status==="completed":R==="risky"?te(t)||Q(t):R==="pending_approval"?t.approvalStatus==="pending":!0)),e},[y,I,W,p,d,g,R]),ne=n.useMemo(()=>{let e=[];if(p==="my-tasks")e=le;else return[];const t=Se(e);return P==="list"?Ae(t):t},[le,L,G,S,q,P,p,j,d,g]);n.useMemo(()=>P!=="list"?[]:Ae(Se(Pe)),[Pe,L,G,S,q,P,R]);const ke=n.useMemo(()=>{let e=[];if(p==="all"||!p&&g!=="general")e=le;else return[];const t=Se(e);return P==="list"?Ae(t):t},[le,L,G,S,q,P,p,d,g,j]),X=n.useMemo(()=>p==="my-tasks"||g==="general"?ne:ke,[p,ne,ke,d,g]),Vs=n.useMemo(()=>{let e=X.filter(a=>{const l=Fe.find(c=>c.id===a.id);return!(a.isArchived===!0||a.is_archived===!0||(l==null?void 0:l.isArchived)===!0)});const t=new Map;return(Array.isArray(e)?e:[]).forEach(a=>{const{assignment:l,...h}=a;t.set(a.id,h)}),Array.from(t.values())},[X,p,Fe]),B=n.useMemo(()=>{let e=[];p==="archived"?e=W:p==="my-tasks"?e=I.map(o=>{const{assignment:v,...m}=o;return m}):g==="general"?e=I.map(o=>{const{assignment:v,...m}=o;return m}):e=y,j&&j!=="all"&&(j==="general"?e=e.filter(o=>o.projectId==="general"||!o.projectId):e=e.filter(o=>o.projectId===j));const t=e.length,a=e.filter(o=>o.status!=="completed").length,l=e.filter(o=>o.status==="completed").length,h=e.filter(o=>te(o)).length,c=e.filter(o=>Q(o)).length,x=e.filter(o=>o.approvalStatus==="pending").length;return{total:t,active:a,completed:l,dueSoon:h,overdue:c,pendingApproval:x}},[y,I,W,p,d,g,j]),Ws=n.useMemo(()=>{let e=[];return p==="archived"?e=W:p==="my-tasks"?e=I.map(t=>{const{assignment:a,...l}=t;return l}):g==="general"?e=I.map(t=>{const{assignment:a,...l}=t;return l}):e=y,j&&j!=="all"&&(j==="general"?e=e.filter(t=>t.projectId==="general"||!t.projectId):e=e.filter(t=>t.projectId===j)),[{id:"all",label:"Tümü",description:"Tüm görevleri göster",count:e.length},{id:"due_soon",label:"Yaklaşan",description:"3 gün içinde termin",count:e.filter(t=>te(t)).length},{id:"overdue",label:"Geciken",description:"Termin geçmiş görevler",count:e.filter(t=>Q(t)).length},{id:"high_priority",label:"Öncelikli",description:"Öncelik 4+",count:e.filter(t=>t.priority>=4).length}]},[y,I,W,p,d,g,j]),Te=(e,t)=>{if(e==="completed"&&t==="approved")return 3;if(e==="completed")return 2;const a=$.findIndex(l=>l.value===e);return a===-1?0:a},qs=e=>{const t=Te(e);return t===-1||t>=$.length-1?null:$[t+1]},qe=async(e,t)=>{if(r)try{const a=y.find(h=>h.id===e);if(!a){f.error("Görev bulunamadı");return}try{const{canPerformSubPermission:h}=await ss(async()=>{const{canPerformSubPermission:o}=await import("./permissions-D79DzJt5.js");return{canPerformSubPermission:o}},__vite__mapDeps([0,1,2,3])),c={id:r.id,email:r.email,emailVerified:r.emailVerified,fullName:r.fullName,displayName:r.fullName,phone:r.phone,dateOfBirth:r.dateOfBirth,role:r.roles||[],createdAt:D.now(),updatedAt:D.now()};if(!await h(c,"tasks","canChangeStatus")&&!_&&a.createdBy!==r.id&&!(await pe(e)).map(w=>w.assignedTo).includes(r.id)){f.error("Durum değiştirme yetkiniz yok");return}}catch(h){console.error("Permission check error:",h)}if(!_&&!(await pe(e)).map(o=>o.assignedTo).includes(r.id)){const{showPermissionErrorToast:o}=await ss(async()=>{const{showPermissionErrorToast:v}=await import("./toastHelpers-I2G9dhou.js");return{showPermissionErrorToast:v}},__vite__mapDeps([4,2,3,5]));o("update","task");return}await os(e,t);const l={pending:"Yapılacak",in_progress:"Devam Ediyor",completed:"Tamamlandı"};f.success(`Görev durumu "${l[t]||t}" olarak güncellendi`)}catch(a){console.error("Update task status error:",a),f.error(a.message||"Durum güncellenemedi")}},Ys=async e=>{if(r)try{await Ct(e,r.id),f.success("Görev onay için yöneticiye gönderildi.")}catch(t){console.error("Request approval error:",t),f.error("Onay isteği gönderilemedi: "+((t==null?void 0:t.message)||"Bilinmeyen hata"))}},Hs=async(e,t)=>{if(r){if(!_){f.error("Sadece yöneticiler durumu geri alabilir.");return}if(t==="approved"){f.error("Onaylandı durumuna geri alınamaz.");return}try{const a=y.find(x=>x.id===e);if(!a){f.error("Görev bulunamadı");return}if(a.approvalStatus==="pending"){f.error("Onay bekleyen görevler geri alınamaz.");return}const l=Te(a.status,a.approvalStatus),h=$.findIndex(x=>x.value===t);if(h===-1){f.error("Geçersiz durum.");return}if(h>=l){f.error("Sadece önceki durumlara geri alabilirsiniz.");return}const c=$[h];await os(e,c.value),f.success(`Görev durumu ${c.label} olarak geri alındı.`)}catch(a){console.error("Revert status error:",a),f.error("Durum geri alınamadı: "+((a==null?void 0:a.message)||"Bilinmeyen hata"))}}};return vs?s.jsx(ts,{children:s.jsx("div",{className:"flex items-center justify-center h-64",children:s.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary"})})}):s.jsx(ts,{disableScroll:!1,children:s.jsxs("div",{className:rt("space-y-2 sm:space-y-3 md:space-y-4",P==="board"?"pb-0":"pb-8"),children:[s.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-2 sm:gap-3 md:gap-4 flex-shrink-0",children:[s.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 min-w-0 flex-1",children:[d&&s.jsx(C,{variant:"ghost",size:"icon",onClick:()=>window.history.back(),className:"h-7 w-7 sm:h-8 sm:w-8 flex-shrink-0",children:s.jsx(at,{className:"h-3.5 w-3.5 sm:h-4 sm:w-4"})}),s.jsxs("div",{className:"min-w-0 flex-1",children:[s.jsx("h1",{className:"text-lg sm:text-xl md:text-2xl lg:text-3xl font-bold text-foreground truncate",children:be?`${be.name} - Görevler`:"Görevler"}),s.jsx("p",{className:"text-muted-foreground mt-0.5 sm:mt-1 text-xs sm:text-sm",children:be?"Proje görevleri":"Görev takibi ve yönetimi"})]})]}),s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx(Xe,{value:P,onValueChange:e=>{z(e)},children:s.jsxs(Je,{children:[s.jsx(oe,{value:"list",children:"Liste"}),s.jsx(oe,{value:"board",children:"Pano"})]})}),Is&&s.jsxs(C,{className:"gap-2",onClick:()=>ae("create"),children:[s.jsx(Ft,{className:"h-4 w-4"}),"Yeni Görev"]})]})]}),s.jsx(rs,{open:As,onOpenChange:xe,children:s.jsx(as,{className:"!max-w-[100vw] sm:!max-w-[95vw] !w-[100vw] sm:!w-[95vw] !h-[100vh] sm:!h-[90vh] !max-h-[100vh] sm:!max-h-[90vh] !left-0 sm:!left-[2.5vw] !top-0 sm:!top-[5vh] !right-0 sm:!right-auto !bottom-0 sm:!bottom-auto !translate-x-0 !translate-y-0 overflow-hidden !p-0 gap-0 bg-white flex flex-col !m-0 !rounded-none sm:!rounded-lg !border-0 sm:!border",children:s.jsxs("div",{className:"flex flex-col h-full min-h-0",children:[s.jsx(ls,{className:"p-3 sm:p-4 border-b bg-white flex-shrink-0",children:s.jsx(ns,{className:"text-lg sm:text-xl font-semibold text-foreground",children:se==="edit"?"Görevi Düzenle":"Yeni Görev"})}),s.jsx("div",{className:"flex-1 overflow-hidden bg-gray-50/50 p-3 sm:p-4 min-h-0",children:s.jsx("div",{className:"max-w-full mx-auto h-full overflow-y-auto",children:s.jsxs("div",{className:"space-y-6",children:[se==="edit"&&U&&(()=>{const e=y.find(c=>c.id===U);if(!e)return null;const t=e.status||"pending",a=Te(t,e.approvalStatus),l=qs(t),h=he.reduce((c,x)=>(c[x.id]=x.fullName||x.email||x.id,c),{});return s.jsxs(Z,{children:[s.jsx(Ze,{className:"space-y-1",children:s.jsxs("div",{className:"flex items-center justify-between gap-3",children:[s.jsxs("div",{children:[s.jsx(es,{className:"text-lg",children:"Görev Durumu"}),s.jsx("p",{className:"text-sm text-muted-foreground",children:t==="completed"&&e.approvalStatus==="approved"?"Görev onaylandı ve tamamlandı.":t==="completed"&&e.approvalStatus==="pending"?"Görev tamamlandı ve onay bekleniyor.":t==="completed"?"Görev tamamlandı. Onaya göndermek için butona tıklayın.":l?`${We(t)} aşamasındasınız. Sıradaki adım: ${l.label}`:"Workflow tamamlandı."})]}),s.jsxs("div",{className:"text-xs text-muted-foreground text-right",children:["Son güncelleyen: ",e.statusUpdatedBy?h[e.statusUpdatedBy]||e.statusUpdatedBy:(r==null?void 0:r.fullName)||"-",s.jsx("br",{}),s.jsx("span",{className:"text-[11px]",children:e.statusUpdatedAt?Ms(e.statusUpdatedAt):""})]})]})}),s.jsx(ee,{className:"p-4 sm:p-6",children:s.jsxs("div",{className:"space-y-4",children:[s.jsx("div",{className:"flex items-center justify-between overflow-x-auto overflow-y-visible pt-2 pb-4",children:$.map((c,x)=>{const o=c.icon,v=x===a,m=x<a,w=_&&x<a&&c.value!=="approved"&&e.approvalStatus!=="pending";return s.jsxs("div",{className:"flex items-center flex-1 min-w-0",children:[s.jsxs("div",{className:"flex flex-col items-center flex-1 min-w-0",children:[s.jsx("div",{onClick:w?()=>Hs(U,c.value):void 0,className:`
                                            w-10 h-10 rounded-full flex items-center justify-center border-2 transition-all relative z-10
                                            ${v?"bg-primary text-primary-foreground border-primary scale-110":""}
                                            ${m?"bg-green-500 text-white border-green-500":""}
                                            ${!v&&!m?"bg-muted border-muted-foreground/20":""}
                                            ${w?"cursor-pointer hover:scale-110 hover:shadow-md":""}
                                          `,title:w?`${c.label} durumuna geri al`:void 0,children:s.jsx(o,{className:`h-5 w-5 ${v||m?"text-white":c.color}`})}),s.jsx("p",{className:`text-xs mt-2 text-center font-medium ${v?"text-primary":m?"text-green-600":"text-muted-foreground"}`,children:c.label})]}),x<$.length-1&&s.jsx("div",{className:`flex-1 h-0.5 mx-2 ${m?"bg-green-500":"bg-muted"}`})]},c.value)})}),t==="completed"&&e.approvalStatus==="approved"?null:t==="completed"&&e.approvalStatus!=="pending"&&e.approvalStatus!=="approved"?s.jsx("div",{className:"flex justify-center pt-4 border-t",children:s.jsxs(C,{onClick:()=>Ys(U),className:"gap-2",children:[s.jsx(Gt,{className:"h-4 w-4"}),"Onaya Gönder"]})}):l&&e.approvalStatus!=="pending"&&e.approvalStatus!=="approved"&&l.value==="completed"?s.jsx("div",{className:"flex justify-center pt-4 border-t",children:s.jsxs(C,{onClick:()=>qe(U,l.value),className:"gap-2",children:[(()=>{const c=l.icon;return s.jsx(c,{className:"h-4 w-4"})})(),l.label," Durumuna Geç"]})}):null]})})]})})(),s.jsx(_t,{mode:se,projectId:d||null,taskId:se==="edit"?U:void 0,defaultStatus:Ts,onCancel:Be,onSuccess:Ds,className:"border-0 shadow-none p-0",showOnlyInMyTasks:p==="my-tasks"},`${se}-${U||"new"}`)]})})})]})})}),s.jsx("div",{className:"grid gap-4 sm:gap-6 grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-5 flex-shrink-0",children:[{label:"Toplam Görev",value:B.total,sub:"Genel yük",badgeClass:"text-primary",filterType:"all",onClick:()=>{M("all"),E("all"),Y("all"),z("list")}},{label:"Aktif",value:B.active,sub:"Devam eden süreçler",badgeClass:"text-amber-600",filterType:"active",onClick:()=>{M("all"),E("all"),Y("active"),z("list")}},{label:"Tamamlanan",value:B.completed,sub:"Kapatılan işler",badgeClass:"text-emerald-600",filterType:"completed",onClick:()=>{M("completed"),E("all"),Y("completed"),z("list")}},{label:"Riskli (Yaklaşan/Geciken)",value:B.dueSoon+B.overdue,sub:`${B.dueSoon} yaklaşan · ${B.overdue} geciken`,badgeClass:"text-destructive",filterType:"risky",onClick:()=>{M("all"),E("all"),Y("risky"),z("list")}},{label:"Onay Bekleyen",value:B.pendingApproval,sub:"Onay için bekleyen görevler",badgeClass:"text-yellow-600",filterType:"pending_approval",onClick:()=>{M("all"),E("all"),Y("pending_approval"),z("list")}}].map(e=>s.jsx(Z,{className:"cursor-pointer hover:shadow-lg transition-all duration-200 hover:border-primary/50 border-2",onClick:e.onClick,children:s.jsxs(ee,{className:"pt-4 pb-4 px-4 sm:pt-6 sm:pb-6 sm:px-6",children:[s.jsx("p",{className:"text-xs sm:text-sm text-muted-foreground mb-2 sm:mb-3 truncate",children:e.label}),s.jsx("div",{className:"text-2xl sm:text-3xl xl:text-4xl font-bold mb-1 sm:mb-2",children:e.value}),s.jsx("p",{className:`text-xs font-medium ${e.badgeClass} line-clamp-2`,children:e.sub})]})},e.label))}),P==="list"?s.jsxs("div",{className:"space-y-2 sm:space-y-3 md:space-y-4",children:[s.jsx(Z,{className:"border-2 relative z-10 overflow-visible",children:s.jsx(ee,{className:"p-4 sm:p-6 overflow-visible",children:s.jsx("div",{className:"flex flex-wrap gap-2 sm:gap-3 md:gap-4",children:Ws.map(e=>s.jsxs(C,{variant:S===e.id?"default":"outline",className:"justify-between w-full sm:w-auto sm:min-w-[180px] min-h-[44px] sm:min-h-0",onClick:()=>E(e.id),children:[s.jsxs("span",{className:"flex items-center gap-2",children:[e.id==="high_priority"?s.jsx(Et,{className:"h-4 w-4"}):s.jsx(cs,{className:"h-4 w-4"}),e.label]}),s.jsx(A,{variant:S===e.id?"secondary":"outline",children:e.count})]},e.id))})})}),s.jsx(Z,{className:"border-2 relative z-10 overflow-visible",children:s.jsx(ee,{className:"p-4 sm:p-6 overflow-visible",children:s.jsxs("div",{className:"flex flex-wrap items-center gap-3 sm:gap-4",children:[s.jsx("div",{className:"flex-1 min-w-[200px] sm:min-w-[250px]",children:s.jsx(yt,{placeholder:"Görev ara...",value:L,onChange:e=>Oe(e.target.value),className:"w-full h-10 min-h-[44px] sm:min-h-0"})}),s.jsx("div",{className:"w-full sm:w-auto sm:min-w-[180px]",children:s.jsxs(ce,{value:G,onValueChange:M,children:[s.jsx(de,{className:"w-full h-10 min-h-[44px] sm:min-h-0",children:s.jsx(me,{placeholder:"Durum filtrele"})}),s.jsxs(ue,{className:"z-[10003]",children:[s.jsx(b,{value:"all",children:"Tüm Durumlar"}),s.jsx(b,{value:"pending",children:"Beklemede"}),s.jsx(b,{value:"in_progress",children:"Devam Ediyor"}),s.jsx(b,{value:"completed",children:"Tamamlandı"})]})]})}),s.jsx("div",{className:"w-full sm:w-auto sm:min-w-[180px]",children:s.jsxs(ce,{value:q,onValueChange:Ue,children:[s.jsx(de,{className:"w-full h-10 min-h-[44px] sm:min-h-0",children:s.jsx(me,{placeholder:"Sırala"})}),s.jsxs(ue,{className:"z-[10003]",children:[s.jsx(b,{value:"created_at",children:"Tarihe Göre"}),s.jsx(b,{value:"priority",children:"Önceliğe Göre"}),s.jsx(b,{value:"due_date",children:"Bitiş Tarihine Göre"})]})]})}),p==="all"&&s.jsx("div",{className:"w-full sm:w-auto sm:min-w-[180px]",children:s.jsxs(ce,{value:j,onValueChange:H,children:[s.jsx(de,{className:"w-full h-10 min-h-[44px] sm:min-h-0",children:s.jsx(me,{placeholder:"Proje Seçiniz"})}),s.jsxs(ue,{className:"z-[10003]",children:[s.jsx(b,{value:"all",children:"Tüm Projeler"}),s.jsx(b,{value:"general",children:"Genel Görevler"}),Ve.filter(e=>{var t,a;return((t=e.name)==null?void 0:t.toLowerCase())!=="genel görevler"&&((a=e.name)==null?void 0:a.toLowerCase())!=="genel"}).map(e=>s.jsx(b,{value:e.id,children:e.isPrivate?s.jsxs("span",{className:"flex items-center gap-2",children:[s.jsx(_e,{className:"h-3 w-3"}),e.name]}):e.name},e.id))]})]})}),s.jsxs(C,{variant:"outline",size:"sm",onClick:()=>{Oe(""),M("all"),Ue("created_at"),E("all"),Y(null),H("all")},className:"h-10 min-h-[44px] sm:min-h-0",children:[s.jsx(lt,{className:"h-4 w-4 mr-2"}),"Temizle"]})]})})}),s.jsxs(Z,{className:"border-2 relative z-0 overflow-visible",children:[s.jsx(Ze,{className:"pb-4 sm:pb-6 px-3 sm:px-4 md:px-6 pt-4 sm:pt-6",children:s.jsxs("div",{className:"space-y-4 sm:flex sm:flex-row sm:items-center sm:justify-between sm:space-y-0",children:[s.jsxs("div",{children:[s.jsxs(es,{className:"text-xl mb-2",children:[p==="archived"?"Arşivlenmiş Görevler":p==="my-tasks"?"Benim Görevlerim":"Tüm Görevler"," ",s.jsxs("span",{className:"text-lg text-muted-foreground font-normal",children:["(",X.length,")"]})]}),s.jsx("p",{className:"text-sm text-muted-foreground",children:p==="my-tasks"?"Bana atanan ve kabul ettiğim görevler":"Tüm projelerdeki görevlerin listesi"})]}),s.jsx(Xe,{value:p,onValueChange:e=>fe(e),className:"w-full sm:w-auto",children:s.jsxs(Je,{className:"w-full flex flex-col sm:flex-row",children:[s.jsxs(oe,{value:"all",className:"flex-1",children:["Tüm Görevler (",ke.length,")"]}),s.jsxs(oe,{value:"my-tasks",className:"flex-1",children:["Benim Görevlerim (",ne.length,")"]})]})})]})}),s.jsxs(ee,{className:"space-y-3 sm:space-y-4 px-3 sm:px-4 md:px-6 pb-4 sm:pb-6 overflow-visible",children:[!1,(Array.isArray(X)?X:[]).map(e=>{var x,o,v;e.assignment;const t=!1,a=!1,l=!1,h=Q(e),c=te(e);return s.jsxs("div",{className:"p-4 sm:p-6 rounded-xl border-2 border-border hover:border-primary/40 hover:bg-primary/5 transition-all duration-200 shadow-sm hover:shadow-md relative",children:[(_||e.createdBy===(r==null?void 0:r.id))&&s.jsx("div",{className:"absolute top-2 right-2 sm:top-4 sm:right-4 z-10",children:s.jsxs(dt,{children:[s.jsx(mt,{asChild:!0,onClick:m=>m.stopPropagation(),children:s.jsx(C,{variant:"ghost",size:"icon",className:"h-8 w-8 opacity-70 hover:opacity-100",children:s.jsx(zt,{className:"h-4 w-4"})})}),s.jsxs(ut,{align:"end",onClick:m=>m.stopPropagation(),children:[s.jsxs(is,{onClick:m=>{m.stopPropagation(),Os(e.id)},className:"cursor-pointer",children:[s.jsx(pt,{className:"h-4 w-4 mr-2"}),"Arşivle"]}),s.jsxs(is,{onClick:m=>{m.stopPropagation(),confirm(`"${e.title}" görevini silmek istediğinize emin misiniz? Bu işlem geri alınamaz.`)&&Bs(e.id)},className:"cursor-pointer text-destructive focus:text-destructive",children:[s.jsx(Rt,{className:"h-4 w-4 mr-2"}),"Sil"]})]})]})}),s.jsxs("div",{className:"flex flex-col gap-5 sm:flex-row sm:items-start sm:justify-between",children:[s.jsxs("div",{className:"flex-1 cursor-pointer",onClick:()=>ge(e.id,e.status),children:[s.jsxs("div",{className:"flex items-start gap-3 mb-3",children:[Ls(e.status),s.jsx("div",{className:"flex-1",children:s.jsxs("div",{className:"flex items-center gap-2 flex-wrap mb-1",children:[s.jsx("h3",{className:"font-semibold text-lg",children:e.title}),e.projectId&&Ne.has(e.projectId)&&s.jsxs(s.Fragment,{children:[s.jsxs(A,{variant:"outline",className:"bg-gradient-to-r from-blue-50 to-indigo-50 text-blue-700 border-blue-300 hover:from-blue-100 hover:to-indigo-100 transition-all shadow-sm",children:[s.jsx(Bt,{className:"h-3 w-3 mr-1.5"}),s.jsx("span",{className:"font-semibold text-xs",children:(x=Ne.get(e.projectId))==null?void 0:x.name})]}),d&&((o=Ne.get(d))==null?void 0:o.isPrivate)&&s.jsxs(A,{variant:"outline",className:"gap-1",children:[s.jsx(_e,{className:"h-3 w-3"}),"Gizli"]})]})]})})]}),e.description&&s.jsx("p",{className:"text-sm text-muted-foreground mt-2 mb-4 line-clamp-2 leading-relaxed",children:e.description}),s.jsxs("div",{className:"flex flex-wrap gap-2 mb-4",children:[s.jsx(A,{variant:"secondary",children:We(e.status)}),s.jsxs(A,{variant:"outline",className:"text-xs",children:["Öncelik ",e.priority]}),c&&s.jsx(A,{className:"bg-amber-100 text-amber-900 border-amber-200",children:"Yaklaşan Termin"}),h&&s.jsx(A,{variant:"destructive",children:"Termin Geçti"}),t,a,l,e.approvalStatus==="pending"&&s.jsx(A,{className:"bg-yellow-100 text-yellow-900 border-yellow-300",children:"Görev Onayı Bekleniyor"}),e.approvalStatus==="approved"&&s.jsx(A,{className:"bg-green-100 text-green-900 border-green-300",children:"Görev Onaylandı"}),e.approvalStatus==="rejected"&&s.jsx(A,{className:"bg-red-100 text-red-900 border-red-300",children:"Görev Onayı Reddedildi"}),e.production_order_number&&s.jsxs(A,{variant:"outline",className:"bg-primary/5 text-primary",children:["Sipariş #",e.production_order_number]})]}),s.jsxs("div",{className:"flex flex-wrap items-center gap-4 mt-4 text-sm text-muted-foreground",children:[e.due_date&&s.jsxs("span",{className:"flex items-center gap-2",children:[s.jsx(cs,{className:"h-4 w-4"}),"Termin: ",Es(e.due_date)]}),!!((v=e.assignedUsers)!=null&&v.length)&&s.jsxs("span",{className:"flex items-center gap-2",children:[s.jsx(nt,{className:"h-4 w-4"}),e.assignedUsers.length," kişi"]})]}),e.assignedUsers&&e.assignedUsers.length>0&&s.jsxs("div",{className:"flex items-center gap-2 mt-4",children:[s.jsx("div",{className:"flex -space-x-2",children:(Array.isArray(e.assignedUsers)?e.assignedUsers.slice(0,4):[]).map(m=>s.jsx(vt,{className:"h-7 w-7 border-2 border-background",children:s.jsx(jt,{className:"text-[11px]",children:$s(m.full_name)})},m.id))}),e.assignedUsers.length>4&&s.jsxs("span",{className:"text-xs text-muted-foreground",children:["+",e.assignedUsers.length-4," daha"]})]})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[e.createdBy===(r==null?void 0:r.id)&&s.jsx(C,{variant:"outline",size:"sm",onClick:m=>{m.stopPropagation(),ae("edit",e.id)},children:"Mini Düzenle"}),!1,t]})]})]},e.id)}),X.length===0&&s.jsx("div",{className:"py-16 text-center text-muted-foreground border-2 border-dashed rounded-xl bg-muted/30",children:s.jsxs("div",{className:"flex flex-col items-center gap-3",children:[s.jsx(ht,{className:"h-12 w-12 text-muted-foreground/50"}),s.jsx("p",{className:"text-base font-medium",children:L||G!=="all"||S!=="all"?"Filtre kriterlerinize uyan görev bulunamadı":p==="my-tasks"?"Henüz size atanan ve kabul ettiğiniz görev yok":"Henüz görev bulunmuyor"}),(L||G!=="all"||S!=="all")&&s.jsx("p",{className:"text-sm text-muted-foreground/70",children:"Filtreleri değiştirerek tekrar deneyin"})]})})]})]})]}):s.jsxs("div",{className:"flex flex-col gap-2 sm:gap-3 md:gap-4",children:[p==="all"&&s.jsx(Z,{className:"border-2 flex-shrink-0",children:s.jsx(ee,{className:"pt-3 sm:pt-4 md:pt-6 pb-3 sm:pb-4 md:pb-6 px-3 sm:px-4 md:px-6",children:s.jsx("div",{className:"grid grid-cols-1 gap-2 sm:gap-3 md:gap-4",children:s.jsx("div",{className:"w-full",children:s.jsxs(ce,{value:j,onValueChange:H,children:[s.jsx(de,{className:"w-full h-9 sm:h-10",children:s.jsx(me,{placeholder:"Proje filtrele"})}),s.jsxs(ue,{children:[s.jsx(b,{value:"all",children:"Tüm Projeler"}),s.jsx(b,{value:"general",children:"Genel Görevler"}),Ve.filter(e=>{var t,a;return((t=e.name)==null?void 0:t.toLowerCase())!=="genel görevler"&&((a=e.name)==null?void 0:a.toLowerCase())!=="genel"}).map(e=>s.jsx(b,{value:e.id,children:e.isPrivate?s.jsxs("span",{className:"flex items-center gap-2",children:[s.jsx(_e,{className:"h-3 w-3"}),e.name]}):e.name},e.id))]})]})})})})}),s.jsx("div",{children:s.jsx(It,{tasks:Vs,onTaskClick:(e,t)=>ge(e,t),onStatusChange:qe,showProjectFilter:p==="all"})})]}),s.jsx(rs,{open:_s,onOpenChange:ve,children:s.jsxs(as,{children:[s.jsxs(ls,{children:[s.jsx(ns,{children:"Görevi Reddet"}),s.jsx(xt,{children:"Görevi reddetmek için lütfen en az 20 karakterlik bir sebep belirtin."})]}),s.jsx("div",{className:"space-y-4",children:s.jsxs("div",{children:[s.jsxs(it,{htmlFor:"rejection_reason",children:["Reddetme Sebebi ",s.jsx("span",{className:"text-destructive",children:"*"})," (En az 20 karakter)"]}),s.jsx(gt,{id:"rejection_reason",value:K,onChange:e=>ye(e.target.value),placeholder:"Görevi neden reddettiğinizi açıklayın (en az 20 karakter)...",rows:4,className:"mt-2"}),s.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[K.length,"/20 karakter"]})]})}),s.jsxs(ft,{children:[s.jsx(C,{variant:"outline",onClick:()=>{ve(!1),ye(""),Me(null)},children:"İptal"}),s.jsx(C,{variant:"destructive",onClick:Us,disabled:Ee||K.trim().length<20,children:Ee?"İşleniyor...":"Reddet"})]})]})})]})})};export{Ar as default};
