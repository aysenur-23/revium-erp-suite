import{a3 as O,r as a,b as f,j as e,B as y,v as D,V as P,a0 as F}from"./index-Xd90qdO9.js";import{x as I,N as z,O as U,Q as V,R as B,U as Q,V as w}from"./MainLayout-DW7UjMSA.js";import{P as T,a as Y,b as A}from"./popover-BA39Kv9C.js";import{C as R}from"./CreateCustomerDialog-Ct1V89iV.js";import{P as j}from"./plus-D9uLCipi.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const G=O("ChevronsUpDown",[["path",{d:"m7 15 5 5 5-5",key:"1hf1tw"}],["path",{d:"m7 9 5-5 5 5",key:"sgt6xg"}]]),H=r=>({id:r.id,name:r.name,company:r.company,phone:r.phone,email:r.email}),$=a.memo(({value:r,onChange:k,placeholder:S="Müşteri seçin..."})=>{const[i,l]=a.useState(!1),[n,C]=a.useState([]),[o,g]=a.useState(!1),[M,m]=a.useState(!1),[N,v]=a.useState(""),h=r||"",c=a.useCallback(async()=>{g(!0);try{const t=(await I()).map(H);C(t)}catch(s){C([]),f.error("Müşteriler yüklenirken hata: "+(s.message||"Bilinmeyen hata"))}finally{g(!1)}},[]);a.useEffect(()=>{c()},[c]),a.useEffect(()=>{i&&n.length===0&&!o&&c()},[i,n.length,o,c]),a.useEffect(()=>{i||v("")},[i]);const x=h?n.find(s=>s.id===h):void 0,u=n.filter(s=>{var d,p,b;const t=N.toLowerCase();return s.name.toLowerCase().includes(t)||((d=s.company)==null?void 0:d.toLowerCase().includes(t))||((p=s.phone)==null?void 0:p.toLowerCase().includes(t))||((b=s.email)==null?void 0:b.toLowerCase().includes(t))}),E=a.useCallback(s=>{const t=s,d=n.find(p=>p.id===t);if(d)try{l(!1),setTimeout(()=>{k(t,d.name)},0)}catch{f.error("Müşteri seçilirken hata oluştu")}else f.error("Müşteri bulunamadı")},[n]),L=()=>{c(),m(!1)};return e.jsxs(e.Fragment,{children:[e.jsxs(T,{open:i,onOpenChange:l,children:[e.jsx(Y,{asChild:!0,children:e.jsxs(y,{variant:"outline",role:"combobox","aria-expanded":i,className:"w-full justify-between min-h-[44px] sm:min-h-0 h-auto py-2 sm:py-1.5",children:[x?e.jsxs("span",{className:"truncate",children:[x.name,x.company&&` - ${x.company}`]}):S,e.jsx(G,{className:"ml-2 h-4 w-4 shrink-0 opacity-50"})]})}),e.jsx(A,{className:"w-[var(--radix-popover-trigger-width)] sm:w-[400px] p-0 !max-h-[400px] !h-auto",align:"start",side:"bottom",sideOffset:4,onOpenAutoFocus:s=>s.preventDefault(),children:e.jsxs(z,{shouldFilter:!1,children:[e.jsx(U,{placeholder:"Müşteri ara (ad, şirket, telefon, e-posta)...",value:N,onValueChange:s=>{v(s)},className:"text-sm"}),e.jsxs(V,{className:"!max-h-[350px] !h-auto",children:[e.jsx(B,{children:o?e.jsxs("div",{className:"flex flex-col items-center justify-center gap-2 py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-primary"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Müşteriler yükleniyor..."})]}):u.length===0&&n.length===0?e.jsxs("div",{className:"flex flex-col items-center gap-3 py-6 px-4",children:[e.jsx("p",{className:"text-sm text-muted-foreground text-center",children:"Henüz müşteri kaydı bulunmuyor"}),e.jsxs(y,{variant:"outline",size:"sm",className:"gap-2 min-h-[44px] sm:min-h-0",onClick:()=>{l(!1),m(!0)},children:[e.jsx(j,{className:"h-4 w-4"}),"Yeni Müşteri Ekle"]})]}):e.jsxs("div",{className:"flex flex-col items-center gap-3 py-6 px-4",children:[e.jsx("p",{className:"text-sm text-muted-foreground text-center",children:"Arama sonucu bulunamadı"}),e.jsxs(y,{variant:"outline",size:"sm",className:"gap-2 min-h-[44px] sm:min-h-0",onClick:()=>{l(!1),m(!0)},children:[e.jsx(j,{className:"h-4 w-4"}),"Yeni Müşteri Ekle"]})]})}),!o&&(u.length>0||n.length>0)&&e.jsxs(Q,{children:[e.jsxs(w,{onSelect:()=>{l(!1),m(!0)},className:"flex items-center gap-2 text-primary cursor-pointer min-h-[44px] sm:min-h-0 hover:bg-primary/5",children:[e.jsx(j,{className:"h-4 w-4 flex-shrink-0"}),e.jsx("span",{className:"font-medium",children:"Yeni Müşteri Ekle"})]}),u.map(s=>e.jsxs(w,{value:s.id,onSelect:()=>{E(s.id)},className:"cursor-pointer min-h-[44px] sm:min-h-0 hover:bg-accent transition-colors",children:[e.jsx(D,{className:P("mr-2 h-4 w-4 flex-shrink-0 transition-opacity",h===s.id?"opacity-100 text-primary":"opacity-0")}),e.jsxs("div",{className:"flex flex-col flex-1 min-w-0",children:[e.jsx("span",{className:"font-medium text-sm truncate",children:s.name}),e.jsxs("div",{className:"flex flex-wrap gap-x-2 gap-y-0.5 text-xs text-muted-foreground mt-0.5",children:[s.company&&e.jsx("span",{className:"truncate max-w-[200px]",title:s.company,children:s.company}),s.phone&&e.jsxs("span",{className:"flex-shrink-0",children:["• ",F(s.phone)]}),s.email&&e.jsxs("span",{className:"truncate max-w-[180px]",title:s.email,children:["• ",s.email]})]})]})]},s.id))]}),o&&e.jsxs("div",{className:"flex flex-col items-center justify-center gap-2 py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-primary"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Müşteriler yükleniyor..."})]})]})]})})]}),e.jsx(R,{open:M,onOpenChange:m,onSuccess:L})]})});$.displayName="CustomerCombobox";export{$ as C,G as a};
