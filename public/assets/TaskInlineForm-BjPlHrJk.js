const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/taskService-CI62TrOj.js","assets/index-BQmY0BmM.js","assets/lucide-react-CAeuRJQk.js","assets/index-YbdY78QJ.css","assets/toastHelpers-DkuKGmwM.js","assets/storageService-BUAGZT8Z.js","assets/driveService-ChwQKMyd.js"])))=>i.map(i=>d[i]);
var ls=Object.defineProperty,os=Object.defineProperties;var cs=Object.getOwnPropertyDescriptors;var Be=Object.getOwnPropertySymbols;var ds=Object.prototype.hasOwnProperty,ms=Object.prototype.propertyIsEnumerable;var Se=(g,d,n)=>d in g?ls(g,d,{enumerable:!0,configurable:!0,writable:!0,value:n}):g[d]=n,ve=(g,d)=>{for(var n in d||(d={}))ds.call(d,n)&&Se(g,n,d[n]);if(Be)for(var n of Be(d))ms.call(d,n)&&Se(g,n,d[n]);return g},ye=(g,d)=>os(g,cs(d));var h=(g,d,n)=>new Promise((te,R)=>{var x=b=>{try{B(n.next(b))}catch(c){R(c)}},ie=b=>{try{B(n.throw(b))}catch(c){R(c)}},B=b=>b.done?te(b.value):Promise.resolve(b.value).then(x,ie);B((n=n.apply(g,d)).next())});import{u as us,h as fs,_ as P,j as s,C as hs,l as Ge,B as j,L as N,I as H,S as gs,c as xs,d as ps,e as vs,f as Re,a as f,k as ys,T as je}from"./index-BQmY0BmM.js";import{uploadTaskAttachment as ks}from"./storageService-BUAGZT8Z.js";import{r as u,m as Oe,X as ke,n as Fe,P as Ve,L as ws,u as js,x as ee,a1 as Ue}from"./lucide-react-CAeuRJQk.js";import{T as bs}from"./MainLayout-Dv9j77B5.js";import{C as se}from"./checkbox-DKBysPlW.js";import{U as Ns}from"./UserMultiSelect-BycFT8u0.js";import{canCreateTask as Ts,canCreateProject as Ps}from"./permissions-gaCIgPOa.js";import{onPermissionCacheChange as _s}from"./rolePermissionsService-BQ7cNajw.js";import{h as Cs,c as As,n as Es,o as Ds,B as Ls,C as zs,D as Is,v as we,w as Bs,x as Ss,y as Gs,E as Rs,z as Me,K as Os,H as qe,G as Fs}from"./taskService-CI62TrOj.js";const Vs=g=>{if(!g)return"";if(g instanceof je)return g.toDate().toISOString().slice(0,10);if(g instanceof Date)return g.toISOString().slice(0,10);try{return new Date(g).toISOString().slice(0,10)}catch(d){return""}},et=({mode:g,projectId:d,taskId:n,defaultStatus:te="pending",onCancel:R,onSuccess:x,className:ie,isInPool:B,showOnlyInMyTasks:b=!1})=>{var ze,Ie;const c=g==="edit",{user:i,isAdmin:_,isSuperAdmin:ae,isTeamLeader:Ke}=us(),[Y,re]=u.useState(""),[ne,le]=u.useState(""),[oe,ce]=u.useState(""),[C,de]=u.useState([]),[E,A]=u.useState([]),[me,W]=u.useState(""),[O,D]=u.useState([]),[ue,$]=u.useState(""),[F,X]=u.useState(""),[He,fe]=u.useState(c),[J,V]=u.useState(!1),[L,Q]=u.useState(null),[be,Ne]=u.useState([]),[Te,Pe]=u.useState(B||!1),[U,S]=u.useState(!1),[T,Ye]=u.useState(!1),[_e,We]=u.useState(void 0),[Us,$e]=u.useState(void 0),[Ce,Xe]=u.useState(void 0),[p,M]=u.useState(d||null),[y,w]=u.useState([]),[Ms,he]=u.useState(!1),[Je,ge]=u.useState(!1),Z=u.useRef(null);u.useMemo(()=>c?"Görevi Düzenle":"Yeni Görev",[c]),u.useMemo(()=>c?"Başlık, açıklama, ekip ve ekleri aynı mini formdan düzenleyin.":"Minimal form ile görevi hızla ekleyin, dosya ve checklist ekleyin.",[c]);const Ae=()=>h(void 0,null,function*(){if(!i){he(!1),ge(!1);return}try{const e=yield ys(),t={id:i.id,email:i.email,emailVerified:i.emailVerified,fullName:i.fullName,displayName:i.fullName,phone:i.phone,dateOfBirth:i.dateOfBirth,role:i.roles,createdAt:null,updatedAt:null},[a,o]=yield Promise.all([Ts(t,e),Ps(t,e)]);he(a),ge(a||o||_)}catch(e){console.error("Permission check error:",e),he(!1),ge(!1)}});u.useEffect(()=>{Ae()},[i,_]),u.useEffect(()=>{if(!i)return;const e=_s(()=>{Ae()});return()=>e()},[i,_]);const z=c&&!_&&(i==null?void 0:i.id)!==Ce,Qe=fs(),xe=()=>{re(""),le(""),ce(""),de([]),A([]),W(""),D([]),$(""),X(""),Q(null),Ne([]),Pe(B||!1),S(!1),M(d||null)},Ee=e=>h(void 0,null,function*(){fe(!0);try{const[t,a,o,m]=yield Promise.all([Cs(e),As(e),Es(e),Ds(e)]);if(!t){f.error("Görev bulunamadı"),R();return}re(t.title),le(t.description||""),ce(Vs(t.dueDate)),We(t.approvalStatus),$e(t.approvalRequestedBy),Xe(t.createdBy),M(t.projectId||null),S(t.isPrivate||!1);const r=a.filter(l=>l.status!=="rejected");if(de(r.map(l=>l.assignedTo)),Ne(a),o.length>0){const l=o[0];Q(l.id),A(l.items.map(v=>({id:v.id,text:v.text,completed:v.completed})))}else A([]),Q(null);D(m.map(l=>({id:l.id,attachmentId:l.id,label:l.name,url:l.driveLink||l.url,type:l.attachmentType==="file"||l.type==="file"?"file":"drive_link"})))}catch(t){console.error("Inline form load error:",t),f.error((t==null?void 0:t.message)||"Görev verileri yüklenemedi")}finally{fe(!1)}});u.useEffect(()=>{c&&n?Ee(n):(xe(),fe(!1))},[c,n]);const G=u.useCallback(()=>h(void 0,null,function*(){try{const{getProjects:e,getProjectById:t}=yield P(()=>h(void 0,null,function*(){const{getProjects:r,getProjectById:l}=yield import("./taskService-CI62TrOj.js").then(v=>v.V);return{getProjects:r,getProjectById:l}}),__vite__mapDeps([0,1,2,3]));if(d&&!c)try{const r=yield t(d);if(!r){w([]);return}if(r.isPrivate){if(ae){w([r]);return}if(i!=null&&i.id&&r.createdBy===i.id){w([r]);return}if(i!=null&&i.id)try{const{getTasks:l,getTaskAssignments:v}=yield P(()=>h(void 0,null,function*(){const{getTasks:k,getTaskAssignments:q}=yield import("./taskService-CI62TrOj.js").then(K=>K.W);return{getTasks:k,getTaskAssignments:q}}),__vite__mapDeps([0,1,2,3])),pe=yield l({projectId:d});for(const k of pe){if(k.createdBy===i.id){w([r]);return}if(k.assignedUsers&&k.assignedUsers.includes(i.id)){w([r]);return}if((yield v(k.id)).some(I=>I.assignedTo===i.id&&(I.status==="accepted"||I.status==="pending"))){w([r]);return}}}catch(l){console.error("Error checking project tasks:",l)}w([]);return}else{w([r]);return}}catch(r){console.error("Proje yüklenemedi",r),w([]);return}const a=yield e({status:"active"});if(d&&!c){const r=a.find(l=>l.id===d);if(r!=null&&r.isPrivate){w([r]);return}}const o=yield Promise.all(a.map(r=>h(void 0,null,function*(){if(d&&!c){const l=a.find(v=>v.id===d);if(l!=null&&l.isPrivate&&r.isPrivate&&r.id!==d)return null}if(!r.isPrivate||ae||i!=null&&i.id&&r.createdBy===i.id)return r;if(i!=null&&i.id)try{const{getTasks:l,getTaskAssignments:v}=yield P(()=>h(void 0,null,function*(){const{getTasks:k,getTaskAssignments:q}=yield import("./taskService-CI62TrOj.js").then(K=>K.W);return{getTasks:k,getTaskAssignments:q}}),__vite__mapDeps([0,1,2,3])),pe=yield l({projectId:r.id});for(const k of pe)if(k.createdBy===i.id||k.assignedUsers&&k.assignedUsers.includes(i.id)||(yield v(k.id)).some(I=>I.assignedTo===i.id&&(I.status==="accepted"||I.status==="pending")))return r}catch(l){console.error("Error checking project tasks:",l)}return null}))),m=Array.from(new Map(o.filter(r=>r!=null&&r.id).map(r=>[r.id,r])).values());w(m)}catch(e){console.error("Projeler yüklenemedi",e)}}),[c,ae,i,d]);u.useEffect(()=>{G()},[G]),u.useEffect(()=>{if(p){const e=y.find(t=>t.id===p);e!=null&&e.isPrivate&&G()}},[p]),u.useEffect(()=>{if(!c&&y.length>0){const e=p||d;if(e){const t=y.find(a=>a.id===e);t!=null&&t.isPrivate&&S(!0)}}},[p,d,y,c]);const De=()=>h(void 0,null,function*(){if(!me.trim())return;if(c&&n&&!(_||(i==null?void 0:i.id)&&C.includes(i.id))){const{showPermissionErrorToast:a}=yield P(()=>h(void 0,null,function*(){const{showPermissionErrorToast:o}=yield import("./toastHelpers-DkuKGmwM.js");return{showPermissionErrorToast:o}}),__vite__mapDeps([4,1,2,3,0]));a("interact","checklist");return}const e={id:`${Date.now()}`,text:me.trim(),completed:!1};if(c&&n&&L)try{yield Ls(n,L,e.text),yield Ee(n),W(""),f.success("Checklist maddesi eklendi");return}catch(t){console.error("Inline checklist add error:",t),f.error((t==null?void 0:t.message)||"Checklist maddesi eklenemedi");return}A(t=>[...t,e]),W("")}),Ze=e=>h(void 0,null,function*(){if(c&&n&&L){const t=E.find(a=>a.id===e);if(!t)return;try{yield zs(n,L,e,!t.completed,i==null?void 0:i.id),A(a=>a.map(o=>o.id===e?ye(ve({},o),{completed:!o.completed}):o))}catch(a){console.error("Inline checklist toggle error:",a),f.error((a==null?void 0:a.message)||"Checklist güncellenemedi")}return}A(t=>t.map(a=>a.id===e?ye(ve({},a),{completed:!a.completed}):a))}),es=e=>h(void 0,null,function*(){if(c&&n&&!(_||(i==null?void 0:i.id)&&C.includes(i.id))){const{showPermissionErrorToast:a}=yield P(()=>h(void 0,null,function*(){const{showPermissionErrorToast:o}=yield import("./toastHelpers-DkuKGmwM.js");return{showPermissionErrorToast:o}}),__vite__mapDeps([4,1,2,3,0]));a("delete","checklist");return}if(c&&n&&L){try{yield Is(n,L,e),A(t=>t.filter(a=>a.id!==e)),f.success("Checklist maddesi silindi")}catch(t){console.error("Inline checklist delete error:",t),f.error((t==null?void 0:t.message)||"Checklist maddesi silinemedi")}return}A(t=>t.filter(a=>a.id!==e))}),Le=()=>h(void 0,null,function*(){if(F.trim()){if(c&&n){if(!(i!=null&&i.id)){f.error("Kullanıcı oturumu bulunamadı");return}try{const e=yield we(n,{name:ue.trim()||"Dosya Linki",url:F.trim(),type:"drive_link",attachmentType:"drive_link",driveLink:F.trim(),size:0,uploadedBy:i.id});D(t=>[...t,{id:e.id,attachmentId:e.id,label:e.name,url:e.driveLink||e.url,type:"drive_link"}]),$(""),X(""),f.success("Link eklendi");return}catch(e){console.error("Inline link add error:",e),f.error((e==null?void 0:e.message)||"Link eklenemedi");return}}D(e=>[...e,{id:`${Date.now()}`,label:ue.trim()||"Dosya Linki",url:F.trim(),type:"drive_link"}]),$(""),X("")}}),ss=e=>h(void 0,null,function*(){var o;const t=(o=e.target.files)==null?void 0:o[0];if(!t)return;if(!c||!n){f.info("Dosya yüklemek için önce görevi oluşturmalısınız.");return}if(!(i!=null&&i.id)){f.error("Kullanıcı oturumu bulunamadı");return}const a=f.loading("Dosya yükleniyor...");try{const m=yield ks(t,n),r=yield we(n,{name:t.name,url:m.url,type:t.type,attachmentType:m.provider==="google_drive"?"drive_link":"file",size:t.size,storageProvider:m.provider,driveLink:m.webViewLink||m.webContentLink||m.url,driveFileId:m.fileId,uploadedBy:i.id});D(l=>[...l,{id:r.id,attachmentId:r.id,label:r.name,url:r.url,type:r.attachmentType==="drive_link"?"drive_link":"file",storageProvider:r.storageProvider,driveFileId:r.driveFileId}]),f.success("Dosya başarıyla yüklendi",{id:a})}catch(m){console.error("File upload error:",m),f.error((m==null?void 0:m.message)||"Dosya yüklenemedi",{id:a})}finally{Z.current&&(Z.current.value="")}}),ts=e=>h(void 0,null,function*(){const t=O.find(a=>a.id===e);if(c&&n&&(t!=null&&t.attachmentId)){try{if(t.storageProvider==="google_drive"&&t.driveFileId){const{deleteFile:a}=yield P(()=>h(void 0,null,function*(){const{deleteFile:o}=yield import("./storageService-BUAGZT8Z.js");return{deleteFile:o}}),__vite__mapDeps([5,1,2,3,6]));yield a(t.url,{provider:"google_drive",fileId:t.driveFileId})}else if(t.type!=="drive_link"){const{deleteFile:a}=yield P(()=>h(void 0,null,function*(){const{deleteFile:o}=yield import("./storageService-BUAGZT8Z.js");return{deleteFile:o}}),__vite__mapDeps([5,1,2,3,6]));yield a(t.url)}yield Bs(n,t.attachmentId),D(a=>a.filter(o=>o.id!==e)),f.success("Ek kaldırıldı")}catch(a){console.error("Inline attachment delete error:",a),f.error((a==null?void 0:a.message)||"Ek kaldırılamadı")}return}D(a=>a.filter(o=>o.id!==e))}),is=e=>h(void 0,null,function*(){if(!(i!=null&&i.id))return;const t=be.filter(m=>m.status!=="rejected").map(m=>m.assignedTo),a=C.filter(m=>!t.includes(m)),o=t.filter(m=>!C.includes(m));a.length===0&&o.length===0||(yield Promise.all(a.map(m=>qe(e,m,i.id))),yield Promise.all(o.map(m=>h(void 0,null,function*(){const r=be.find(l=>l.assignedTo===m&&l.status!=="rejected");r&&(yield Fs(e,r.id,i==null?void 0:i.id))}))))}),as=()=>h(void 0,null,function*(){if(!(!n||!(i!=null&&i.id)))try{yield Ss(n,i.id),f.success("Görev onaylandı ve tamamlandı"),x==null||x(n)}catch(e){f.error("Onaylama işlemi başarısız: "+e.message)}}),rs=()=>h(void 0,null,function*(){if(!(!n||!(i!=null&&i.id)))try{yield Gs(n,i.id),f.success("Görev onayı reddedildi"),x==null||x(n)}catch(e){f.error("Reddetme işlemi başarısız: "+e.message)}}),ns=()=>h(void 0,null,function*(){if(!(i!=null&&i.id)){f.error("Kullanıcı oturumu bulunamadı");return}if(!Y.trim()){f.error("Görev başlığı gereklidir");return}V(!0);try{const e=oe?je.fromDate(new Date(oe)):null;let t=p||d||null;d&&!p&&!T&&(t=d);let a=U;if(t){const r=y.find(l=>l.id===t);r!=null&&r.isPrivate&&!U&&!T&&(a=!0)}if(a){if(!t){f.error("Gizli görevler için bir gizli proje seçmelisiniz. Lütfen önce bir gizli proje oluşturun."),V(!1);return}const r=y.find(l=>l.id===t);if(r&&!r.isPrivate){f.error("Gizli görevler sadece gizli projelere atanabilir. Lütfen bir gizli proje seçin."),V(!1);return}}if((!t||t==="general")&&!U&&!T&&!d){f.error("Lütfen bir proje seçin. Her görevin bir projesi olmalıdır."),V(!1);return}if(c){if(!n)throw new Error("Görev seçilemedi");if(yield Rs(n,{title:Y.trim(),description:ne.trim()||null,dueDate:e,projectId:t||null,isPrivate:a},i.id),yield is(n),!L&&E.length>0)if(_||(i==null?void 0:i.id)&&C.includes(i.id)){const l=yield Me(n,"Checklist",E.map(v=>({text:v.text,completed:!!v.completed,updatedAt:je.now()})));Q(l.id)}else{const{showPermissionErrorToast:l}=yield P(()=>h(void 0,null,function*(){const{showPermissionErrorToast:v}=yield import("./toastHelpers-DkuKGmwM.js");return{showPermissionErrorToast:v}}),__vite__mapDeps([4,1,2,3,0]));l("create","checklist")}f.success("Görev güncellendi"),x==null||x(n);return}const o=yield Os({title:Y.trim(),description:ne.trim()||null,status:te,priority:2,dueDate:e,labels:null,projectId:T?null:t||null,productionOrderId:null,productionProcessId:null,createdBy:i.id,isInPool:Te,poolRequests:[],isPrivate:T?!0:a,onlyInMyTasks:T});if(!(o!=null&&o.id))throw new Error("Görev oluşturulamadı");const m=o.id;if(C.length>0&&(yield Promise.all(C.map(r=>qe(m,r,i.id)))),E.length>0&&(yield Me(m,"Checklist",E.map(r=>({text:r.text})))),O.length>0){const r=O.filter(l=>l.type==="drive_link");r.length>0&&(yield Promise.all(r.map(l=>we(m,{name:l.label,url:l.url,type:"drive_link",attachmentType:"drive_link",driveLink:l.url,size:0,uploadedBy:i.id}))))}f.success("Görev oluşturuldu"),xe(),x==null||x(m)}catch(e){console.error("Task inline form submit error:",e),f.error((e==null?void 0:e.message)||"Görev kaydedilirken hata oluştu")}finally{V(!1)}});return s.jsxs(hs,{className:Ge("w-full border-primary/30 bg-muted/20 p-4 sm:p-6 space-y-4 shadow-sm",ie),children:[s.jsx("div",{className:"flex flex-col gap-2",children:J&&s.jsx("div",{className:"flex justify-end mb-2",children:s.jsx(Oe,{className:"h-5 w-5 animate-spin text-primary"})})}),He?s.jsxs("div",{className:"flex h-32 items-center justify-center text-muted-foreground",children:[s.jsx(Oe,{className:"h-5 w-5 animate-spin mr-2"}),"Form verileri yükleniyor..."]}):s.jsxs(s.Fragment,{children:[_e==="pending"&&s.jsx("div",{className:"mb-4 p-4 bg-yellow-50 border border-yellow-200 rounded-lg",children:s.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4",children:[s.jsxs("div",{children:[s.jsx("h4",{className:"text-sm font-semibold text-yellow-900",children:"Onay Bekliyor"}),s.jsx("p",{className:"text-sm text-yellow-700",children:"Bu görev tamamlandı olarak işaretlendi ve onayınızı bekliyor."})]}),(_||Ke||(i==null?void 0:i.id)&&Ce===i.id)&&s.jsxs("div",{className:"flex gap-2 w-full sm:w-auto",children:[s.jsxs(j,{size:"sm",variant:"outline",className:"flex-1 sm:flex-none border-yellow-300 text-yellow-900 hover:bg-yellow-100",onClick:rs,children:[s.jsx(ke,{className:"h-4 w-4 mr-1"}),"Reddet"]}),s.jsxs(j,{size:"sm",className:"flex-1 sm:flex-none bg-yellow-600 hover:bg-yellow-700 text-white border-none",onClick:as,children:[s.jsx(Fe,{className:"h-4 w-4 mr-1"}),"Onayla"]})]})]})}),s.jsxs("div",{className:"grid gap-3 sm:grid-cols-2",children:[s.jsxs("div",{className:"space-y-2",children:[s.jsx(N,{className:"text-sm sm:text-base",children:"Görev Başlığı *"}),s.jsx(H,{placeholder:"Görev başlığı",value:Y,onChange:e=>re(e.target.value),disabled:z})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(N,{className:"text-sm sm:text-base",children:"Bitiş Tarihi"}),s.jsx(H,{type:"date",value:oe,onChange:e=>ce(e.target.value),disabled:z})]})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsxs(N,{className:"text-sm sm:text-base",children:["Proje ",!b&&s.jsx("span",{className:"text-destructive",children:"*"})]}),s.jsxs(gs,{value:p||"",onValueChange:e=>h(void 0,null,function*(){if(e==="__create_project__"){const a=window.location.pathname,o=window.location.search;Qe("/projects?returnTo="+encodeURIComponent(a+o));return}M(e);const t=y.find(a=>a.id===e);t!=null&&t.isPrivate&&S(!0),G()}),disabled:z||!c&&!Je||T,children:[s.jsx(xs,{children:s.jsx(ps,{placeholder:"Proje seçiniz"})}),s.jsx(vs,{children:(()=>{const e=p?y.find(a=>a.id===p):null;let t=y;return U?(t=y.filter(a=>a.isPrivate),t.length===0&&(e!=null&&e.isPrivate)&&(t=[e])):e!=null&&e.isPrivate&&(t=y.filter(a=>a.isPrivate)),s.jsxs("div",{className:"max-h-[300px] overflow-y-auto overflow-x-hidden scroll-smooth",style:{height:"auto",maxHeight:"300px",scrollPaddingBlock:"10px"},children:[t.map(a=>s.jsx(Re,{value:a.id,children:a.name},a.id)),s.jsx("div",{className:"border-t border-border mt-1 pt-1",children:s.jsxs(Re,{value:"__create_project__",className:"text-primary font-medium cursor-pointer",children:[s.jsx(Ve,{className:"h-4 w-4 mr-2 inline"}),"Yeni Proje Ekle"]})})]})})()})]})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(N,{className:"text-sm sm:text-base",children:"Açıklama"}),s.jsx(bs,{rows:3,placeholder:"Görev açıklaması",value:ne,onChange:e=>le(e.target.value),disabled:z})]}),s.jsxs("div",{className:"space-y-3",children:[s.jsx(N,{className:"text-sm sm:text-base",children:"Görev Üyeleri"}),s.jsx(Ns,{selectedUsers:C,onSelectionChange:de,disabled:z}),s.jsxs("div",{className:"flex flex-col gap-2 pt-2",children:[!c&&s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx(se,{id:"pool-mode",checked:Te,onCheckedChange:e=>Pe(e)}),s.jsx(N,{htmlFor:"pool-mode",className:"text-sm font-normal cursor-pointer text-muted-foreground",children:"Bu görevi Görev Havuzuna gönder (Atama yapılsa bile havuzda görünür)"})]}),b&&!c&&s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx(se,{id:"only-my-tasks-inline",checked:T,onCheckedChange:e=>{Ye(e),e&&(M(null),S(!0))}}),s.jsx(N,{htmlFor:"only-my-tasks-inline",className:"text-sm font-normal cursor-pointer text-muted-foreground",children:'Sadece "Benim Görevlerim" sayfasında göster (Sadece ben görebilirim)'})]}),!T&&s.jsx("div",{className:"flex items-center space-x-2",children:s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx(se,{id:"private-task-inline",checked:U,disabled:p&&((ze=y.find(e=>e.id===p))==null?void 0:ze.isPrivate),onCheckedChange:e=>h(void 0,null,function*(){const t=p?y.find(a=>a.id===p):null;t!=null&&t.isPrivate||(S(e),e&&p&&!(t!=null&&t.isPrivate)&&(M(null),G()))})}),s.jsxs(N,{htmlFor:"private-task-inline",className:Ge("text-sm font-normal text-muted-foreground flex items-center gap-1",p&&((Ie=y.find(e=>e.id===p))!=null&&Ie.isPrivate)?"cursor-default":"cursor-pointer"),children:[s.jsx(ws,{className:"h-3 w-3"}),"Gizli Görev (Sadece atanan kişiler görebilir)"]})]})})]})]}),z&&!_e&&s.jsx("div",{className:"flex justify-end mb-4",children:s.jsxs(j,{variant:"outline",className:"bg-green-50 text-green-700 border-green-200 hover:bg-green-100",onClick:()=>h(void 0,null,function*(){if(!(!n||!(i!=null&&i.id)))try{const{requestTaskApproval:e}=yield P(()=>h(void 0,null,function*(){const{requestTaskApproval:t}=yield import("./taskService-CI62TrOj.js").then(a=>a.W);return{requestTaskApproval:t}}),__vite__mapDeps([0,1,2,3]));yield e(n,i.id),f.success("Görev tamamlandı olarak işaretlendi ve onay için yöneticiye gönderildi."),x==null||x(n)}catch(e){f.error("İşlem başarısız: "+e.message)}}),children:[s.jsx(Fe,{className:"h-4 w-4 mr-2"}),"Görevi Tamamla (Onay İste)"]})}),s.jsxs("div",{className:"space-y-3",children:[s.jsxs(N,{className:"flex items-center gap-2 text-sm sm:text-base",children:[s.jsx(js,{className:"h-4 w-4"}),"Checklist"]}),s.jsxs("div",{className:"flex flex-col gap-2 sm:flex-row",children:[s.jsx(H,{placeholder:"Checklist maddesi",value:me,onChange:e=>W(e.target.value),onKeyDown:e=>{e.key==="Enter"&&(e.preventDefault(),De())},className:"flex-1"}),s.jsx(j,{type:"button",onClick:De,children:s.jsx(Ve,{className:"h-4 w-4"})})]}),E.length>0&&s.jsx("div",{className:"space-y-2",children:E.map(e=>s.jsxs("div",{className:"flex items-center justify-between rounded-md border px-3 py-2",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx(se,{checked:!!e.completed,onCheckedChange:()=>Ze(e.id)}),s.jsx("span",{className:"text-sm",children:e.text})]}),s.jsx(j,{variant:"ghost",size:"sm",onClick:()=>es(e.id),children:s.jsx(ke,{className:"h-4 w-4"})})]},e.id))})]}),s.jsxs("div",{className:"space-y-3",children:[s.jsxs(N,{className:"flex items-center gap-2 text-sm sm:text-base",children:[s.jsx(ee,{className:"h-4 w-4"}),"Ekler (Dosya & Link)"]}),s.jsxs("div",{className:"grid gap-2 sm:grid-cols-3",children:[s.jsx(H,{placeholder:"Link adı",value:ue,onChange:e=>$(e.target.value)}),s.jsx(H,{placeholder:"https://...",className:"sm:col-span-2",value:F,onChange:e=>X(e.target.value),onKeyDown:e=>{e.key==="Enter"&&(e.preventDefault(),Le())}})]}),s.jsxs("div",{className:"flex gap-2",children:[s.jsxs(j,{type:"button",variant:"outline",size:"sm",onClick:Le,children:[s.jsx(Ue,{className:"h-4 w-4 mr-1"}),"Link Ekle"]}),c&&s.jsxs("div",{className:"relative",children:[s.jsx("input",{type:"file",ref:Z,className:"hidden",onChange:ss}),s.jsxs(j,{type:"button",variant:"outline",size:"sm",onClick:()=>{var e;return(e=Z.current)==null?void 0:e.click()},children:[s.jsx(ee,{className:"h-4 w-4 mr-1"}),"Dosya Yükle"]})]}),!c&&s.jsx("div",{title:"Dosya yüklemek için önce görevi oluşturmalısınız",className:"cursor-not-allowed opacity-50",children:s.jsxs(j,{type:"button",variant:"outline",size:"sm",disabled:!0,children:[s.jsx(ee,{className:"h-4 w-4 mr-1"}),"Dosya Yükle"]})})]}),O.length>0&&s.jsx("div",{className:"space-y-2",children:O.map(e=>s.jsxs("div",{className:"flex items-center justify-between rounded-md border px-3 py-2 text-sm",children:[s.jsxs("div",{className:"truncate flex items-center",children:[e.type==="file"?s.jsx(ee,{className:"h-3 w-3 mr-2 text-muted-foreground"}):s.jsx(Ue,{className:"h-3 w-3 mr-2 text-muted-foreground"}),s.jsx("span",{className:"font-medium",children:e.label}),s.jsx("a",{href:e.url,target:"_blank",rel:"noopener noreferrer",className:"text-muted-foreground ml-2 truncate inline-block max-w-[220px] align-middle hover:text-primary hover:underline",children:e.type==="file"?"Dosyayı Aç":e.url})]}),s.jsx(j,{variant:"ghost",size:"sm",onClick:()=>ts(e.id),children:s.jsx(ke,{className:"h-4 w-4"})})]},e.id))})]}),s.jsxs("div",{className:"flex flex-col gap-2 sm:flex-row sm:justify-end",children:[s.jsx(j,{variant:"ghost",onClick:()=>{R(),c||xe()},disabled:J,children:"Vazgeç"}),!z&&s.jsx(j,{onClick:ns,disabled:J,children:J?"Kaydediliyor...":c?"Güncelle":"Görevi Oluştur"})]})]})]})};export{et as T};
