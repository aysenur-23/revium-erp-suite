const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/taskService-CI62TrOj.js","assets/index-BQmY0BmM.js","assets/lucide-react-CAeuRJQk.js","assets/index-YbdY78QJ.css"])))=>i.map(i=>d[i]);
var Bs=Object.defineProperty,Cs=Object.defineProperties;var Es=Object.getOwnPropertyDescriptors;var Ke=Object.getOwnPropertySymbols;var Ss=Object.prototype.hasOwnProperty,As=Object.prototype.propertyIsEnumerable;var Re=(u,f,b)=>f in u?Bs(u,f,{enumerable:!0,configurable:!0,writable:!0,value:b}):u[f]=b,m=(u,f)=>{for(var b in f||(f={}))Ss.call(f,b)&&Re(u,b,f[b]);if(Ke)for(var b of Ke(f))As.call(f,b)&&Re(u,b,f[b]);return u},x=(u,f)=>Cs(u,Es(f));var N=(u,f,b)=>new Promise((ae,re)=>{var o=y=>{try{C(b.next(y))}catch(w){re(w)}},_=y=>{try{C(b.throw(y))}catch(w){re(w)}},C=y=>y.done?ae(y.value):Promise.resolve(y.value).then(o,_);C((b=b.apply(u,f)).next())});import{u as Ts,j as e,S as Q,c as W,d as $,e as X,f as F,B as p,l as ke,L as T,I as Y,a as g,r as Ge,_ as _s,T as Ye}from"./index-BQmY0BmM.js";import{r as i,v as Os,w as Fe,u as Ps,k as Be,M as Ce,e as Ve,E as zs,d as Je,T as qe,o as He,x as Qe,i as Z,l as ee,X as se,P as We,m as te}from"./lucide-react-CAeuRJQk.js";import{S as Ls}from"./search-input-DCf0xYml.js";import{G as Ms,F as Is,f as Us,h as Ks,i as Rs,j as $e,t as Ee,T as Xe,D as Gs,a as Ys,b as Vs,c as Js,e as qs,k as Hs,g as Ze}from"./MainLayout-Dv9j77B5.js";import{a as Qs,E as es,d as Ws,e as $s,c as ss,H as Xs,G as Zs,h as et}from"./taskService-CI62TrOj.js";import{U as ts}from"./UserMultiSelect-BycFT8u0.js";import{f as Se}from"./format-CN3feEER.js";import{i as as}from"./isToday-imnuOj2q.js";import{a as st}from"./addDays-DpNspVkx.js";import{i as tt}from"./isSameDay-CbFR9PGK.js";function at(u){return+Ms(u)<Date.now()}function rt(u){return tt(u,st(Is(u),1))}const rs="taskBoardState_v1",ls="taskBoardFilters_v1",V=[{name:"green",value:"#61BD4F",class:"bg-[#61BD4F]"},{name:"yellow",value:"#F2D600",class:"bg-[#F2D600]"},{name:"orange",value:"#FF9F1A",class:"bg-[#FF9F1A]"},{name:"red",value:"#EB5A46",class:"bg-[#EB5A46]"},{name:"purple",value:"#C377E0",class:"bg-[#C377E0]"},{name:"blue",value:"#0079BF",class:"bg-[#0079BF]"},{name:"sky",value:"#00C2E0",class:"bg-[#00C2E0]"},{name:"lime",value:"#51E898",class:"bg-[#51E898]"},{name:"pink",value:"#FF78CB",class:"bg-[#FF78CB]"},{name:"black",value:"#344563",class:"bg-[#344563]"}],J=[{id:"pending",title:"Yapılacak",taskIds:[]},{id:"in_progress",title:"Devam Ediyor",taskIds:[]},{id:"completed",title:"Tamamlandı",taskIds:[]},{id:"approved",title:"Onaylandı",taskIds:[]}],gt=({tasks:u,onTaskClick:f,onStatusChange:b,showProjectFilter:ae=!0,projectId:re})=>{const{user:o,isAdmin:_,isTeamLeader:C,isSuperAdmin:y}=Ts(),[w,A]=i.useState({columns:J,tasks:{},columnOrder:J.map(t=>t.id)}),[d,le]=i.useState(null),[ie,z]=i.useState(!1),[ne,q]=i.useState(null),[Ae,oe]=i.useState(""),[Te,ce]=i.useState(""),[is,de]=i.useState([]),[L,M]=i.useState([]),[I,R]=i.useState("");i.useState(""),i.useState([]),i.useState(V[0].value);const[ns,lt]=i.useState("");i.useState("none");const[_e,os]=i.useState({members:!0,checklist:!0}),[h,O]=i.useState({title:"",description:"",labels:[],dueDate:"",labelInput:"",labelColor:V[0].value}),[B,U]=i.useState(!1),[cs,ds]=i.useState(!1),[Oe,me]=i.useState(!1),[xe,Pe]=i.useState([]),[G,ue]=i.useState(""),[K,he]=i.useState("all"),[P,pe]=i.useState("all"),[fe,ge]=i.useState("all"),[E,ze]=i.useState([]),[Le,H]=i.useState(!1),[be,ve]=i.useState("none"),[je,ms]=i.useState(new Map),[ye,xs]=i.useState([]);i.useRef({});const us=i.useRef(null),hs=i.useRef(null),ps=i.useRef(null);i.useRef(null),i.useRef(null),i.useRef(null),i.useRef(null),i.useRef(null),i.useEffect(()=>{N(void 0,null,function*(){try{const a=yield Ge();xs(a)}catch(a){console.error("Kullanıcılar yüklenirken hata:",a)}})},[]);const fs=i.useMemo(()=>ye.filter(t=>t.id&&(t.fullName||t.displayName||t.email)).map(t=>({id:t.id,full_name:t.fullName||t.displayName||t.email||"İsimsiz Kullanıcı"})),[ye]),Me=t=>{os(a=>x(m({},a),{[t]:!a[t]}))},we=t=>{const a=t.current;a&&(a.scrollIntoView({behavior:"smooth",block:"center"}),a.classList.add("ring-2","ring-[#0079BF]/40","rounded-xl"),setTimeout(()=>{a.classList.remove("ring-2","ring-[#0079BF]/40","rounded-xl")},900))},gs=t=>{var l;if(!t)return!1;const a=G.toLocaleLowerCase("tr-TR");if(G&&!(t.title.toLocaleLowerCase("tr-TR").includes(a)||(l=t.description)!=null&&l.toLocaleLowerCase("tr-TR").includes(a)))return!1;if(K!=="all"){const s=Array.isArray(t.assignedUsers)&&t.assignedUsers.some(v=>v.id===K),c=t.createdBy===K;if(!s&&!c)return!1}return!(P!=="all"&&(P==="high"&&t.priority<4||P==="medium"&&(t.priority<2||t.priority>3)||P==="low"&&t.priority>=2))};i.useEffect(()=>{const t=localStorage.getItem(rs);if(t)try{const l=JSON.parse(t),s={columns:J.map(c=>x(m({},c),{taskIds:[]})),tasks:l.tasks||{},columnOrder:J.map(c=>c.id)};A(s)}catch(l){}const a=localStorage.getItem(ls);if(a)try{const l=JSON.parse(a);l.boardSearch&&ue(l.boardSearch),l.memberFilter&&he(l.memberFilter),l.priorityFilter&&pe(l.priorityFilter),l.projectFilter&&ge(l.projectFilter)}catch(l){}},[]),i.useEffect(()=>{if(u.length===0){A(t=>x(m({},t),{tasks:{},columns:t.columns.map(a=>x(m({},a),{taskIds:[]}))}));return}A(t=>{const a={},l=J.map(s=>x(m({},s),{taskIds:[]}));return u.forEach(s=>{let c=[];if(s.labels)if(typeof s.labels=="string")try{const r=JSON.parse(s.labels);c=Array.isArray(r)?(Array.isArray(r)?r:[]).map(n=>typeof n=="string"?{name:n,color:V[0].value}:n):[]}catch(r){c=[]}else Array.isArray(s.labels)&&(c=(Array.isArray(s.labels)?s.labels:[]).map(r=>typeof r=="string"?{name:r,color:V[0].value}:r));const v={id:s.id,title:s.title,description:s.description,labels:c,dueDate:s.due_date,createdAt:s.created_at,status:s.status,priority:s.priority||0,projectId:s.projectId||null,assignedUsers:(Array.isArray(s.assignments)?s.assignments:[]).map(r=>({id:r.assigned_to,full_name:r.assigned_to_name||r.assigned_to_email||"Kullanıcı"})),attachments:Array.isArray(s.attachments)?s.attachments.length:typeof s.attachments=="number"?s.attachments:0,comments:0,checklists:[],createdBy:s.createdBy||s.created_by,approvalStatus:s.approvalStatus,linkedProductionOrder:s.production_order_id?{id:s.production_order_id,orderNumber:s.production_order_number,customerName:s.production_order_customer,priority:s.production_order_priority,dueDate:s.production_order_due_date,status:s.production_order_status}:void 0};if(a[s.id]=v,!(s.is_archived||s.isArchived))if(s.status==="completed"&&s.approvalStatus==="approved"){const r=l.find(n=>n.id==="approved");r&&r.taskIds.push(s.id)}else if(s.status==="cancelled"){const r=l.find(n=>n.id==="approved");r&&r.taskIds.push(s.id)}else{const r=l.find(n=>n.id===s.status);r&&r.taskIds.push(s.id)}}),x(m({},t),{tasks:a,columns:l,columnOrder:l.map(s=>s.id)})})},[u,JSON.stringify(u.map(t=>t.id))]),i.useEffect(()=>{localStorage.setItem(rs,JSON.stringify(w))},[w]),i.useEffect(()=>{N(void 0,null,function*(){H(!0);try{const a=yield Ze({status:void 0});ze(a)}catch(a){console.error("Fetch production orders error:",a),g.error("Siparişler yüklenirken hata oluştu")}finally{H(!1)}})},[]),i.useEffect(()=>{N(void 0,null,function*(){try{const a=yield Qs(),l=new Map;a.forEach(s=>{l.set(s.id,s)}),ms(l)}catch(a){console.error("Fetch projects error:",a)}})},[]),i.useEffect(()=>{const t={boardSearch:G,memberFilter:K,priorityFilter:P,projectFilter:fe};localStorage.setItem(ls,JSON.stringify(t))},[G,K,P,fe]);const bs=(t,a)=>N(void 0,null,function*(){var l;try{const c={pending:"in_progress",in_progress:"completed"}[a];if(!c){g.error("Bu aşamadan sonraki aşama bulunamadı");return}const v=w.tasks[t];if(!v)return;if(!(_||C||y)&&!(((l=v.assignedUsers)==null?void 0:l.some(j=>j.id===(o==null?void 0:o.id)))||!1)&&v.createdBy!==(o==null?void 0:o.id)){g.error("Bu görevi taşıma yetkiniz yok. Sadece size atanan görevleri taşıyabilirsiniz.");return}if(c==="completed"&&a==="in_progress"){const n=v.createdBy===(o==null?void 0:o.id);if(!(_||C||y||n)){const{requestTaskApproval:D}=yield _s(()=>N(void 0,null,function*(){const{requestTaskApproval:k}=yield import("./taskService-CI62TrOj.js").then(S=>S.W);return{requestTaskApproval:k}}),__vite__mapDeps([0,1,2,3]));yield D(t,(o==null?void 0:o.id)||""),g.success("Görev tamamlandı olarak işaretlendi ve onay için yöneticiye gönderildi.");return}}yield b(t,c)}catch(s){g.error("Aşama geçişi yapılamadı")}}),vs=()=>{ue(""),he("all"),pe("all"),ge("all")},Ne=()=>N(void 0,null,function*(){H(!0);try{const t=yield Ze({status:void 0});ze(t)}catch(t){console.error("Fetch production orders error:",t),g.error("Siparişler yüklenirken hata oluştu")}finally{H(!1)}});i.useEffect(()=>{ie&&(!Array.isArray(E)||E.length===0)&&Ne()},[ie]),i.useEffect(()=>{ne&&(!Array.isArray(E)||E.length===0)&&Ne()},[ne]),i.useEffect(()=>{var t;d&&ve(((t=d.linkedProductionOrder)==null?void 0:t.id)||"none")},[d]);const js=t=>N(void 0,null,function*(){if(d){U(!0);try{yield es(d.id,{productionOrderId:t||null});const a=t&&Array.isArray(E)&&E.length>0?E.find(c=>c.id===t):null,l=t?{id:t,orderNumber:a==null?void 0:a.order_number,customerName:a==null?void 0:a.customer_name,priority:a==null?void 0:a.priority,dueDate:a==null?void 0:a.due_date,status:a==null?void 0:a.status}:void 0,s=x(m({},d),{linkedProductionOrder:l});le(s),A(c=>x(m({},c),{tasks:x(m({},c.tasks),{[d.id]:s})})),ve(t||"none"),g.success(t?"Sipariş bağlantısı güncellendi":"Bağlantı kaldırıldı")}catch(a){console.error("Link production order error:",a),g.error("Bağlantı güncellenemedi: "+(a.message||"Bilinmeyen hata"))}finally{U(!1)}}}),ys=()=>N(void 0,null,function*(){if(!(!d||!h.title.trim())){U(!0);try{const t=h.dueDate?Ye.fromDate(new Date(h.dueDate)):null,a=h.labels.map(s=>s.name);yield es(d.id,{title:h.title,description:h.description||null,dueDate:t,labels:a.length>0?a:null});const l=x(m({},d),{title:h.title,description:h.description,labels:h.labels,dueDate:h.dueDate});A(s=>x(m({},s),{tasks:x(m({},s.tasks),{[d.id]:l})})),z(!1),le(null),g.success("Kart güncellendi")}catch(t){console.error("Edit task error:",t),g.error("Kart güncellenemedi: "+(t.message||"Bilinmeyen hata"))}finally{U(!1)}}}),De=t=>N(void 0,null,function*(){if(confirm("Bu kartı silmek istediğinize emin misiniz?"))try{yield Ws(t);const a=w.columns.find(l=>l.taskIds.includes(t));a&&A(l=>x(m({},l),{tasks:Object.fromEntries(Object.entries(l.tasks).filter(([s])=>s!==t)),columns:l.columns.map(s=>s.id===a.id?x(m({},s),{taskIds:s.taskIds.filter(c=>c!==t)}):s)})),g.success("Kart silindi")}catch(a){console.error("Delete task error:",a),g.error("Kart silinemedi: "+(a.message||"Bilinmeyen hata"))}}),ws=t=>N(void 0,null,function*(){if(o!=null&&o.id)try{yield $s(t,o.id);const a=w.columns.find(l=>l.taskIds.includes(t));a&&A(l=>x(m({},l),{tasks:Object.fromEntries(Object.entries(l.tasks).filter(([s])=>s!==t)),columns:l.columns.map(s=>s.id===a.id?x(m({},s),{taskIds:s.taskIds.filter(c=>c!==t)}):s)})),g.success("Görev arşivlendi")}catch(a){console.error("Archive task error:",a),g.error("Görev arşivlenemedi: "+(a.message||"Bilinmeyen hata"))}}),Ns=t=>{f(t.id,t.status)},Ds=()=>N(void 0,null,function*(){if(!(!d||!o)){U(!0);try{const t=Array.isArray(d.assignedUsers)?d.assignedUsers.map(n=>n.id):[],a=yield ss(d.id),l=xe.filter(n=>!t.includes(n));for(const n of l)try{yield Xs(d.id,n,o.id)}catch(j){console.error("Assignment error:",j)}const s=t.filter(n=>!xe.includes(n));for(const n of s)try{const j=a.find(D=>D.assignedTo===n);j&&(yield Zs(d.id,j.id,o.id))}catch(j){}g.success("Üyeler güncellendi"),me(!1);const[c,v,r]=yield Promise.all([et(d.id),ss(d.id),Ge()]);if(c){const n=v.map(D=>{const k=r.find(S=>S.id===D.assignedTo);return{id:D.assignedTo,full_name:(k==null?void 0:k.fullName)||(k==null?void 0:k.displayName)||""}}),j=x(m({},d),{assignedUsers:n});le(j),A(D=>x(m({},D),{tasks:x(m({},D.tasks),{[d.id]:j})}))}}catch(t){console.error("Assign members error:",t),g.error("Üye atama hatası: "+(t.message||"Bilinmeyen hata"))}finally{U(!1)}}}),Ie=()=>{h.labelInput.trim()&&!h.labels.some(t=>t.name===h.labelInput.trim())&&O(t=>x(m({},t),{labels:[...t.labels,{name:t.labelInput.trim(),color:t.labelColor}],labelInput:""}))},ks=t=>{O(a=>x(m({},a),{labels:a.labels.filter(l=>l.name!==t)}))},Fs=t=>t.split(" ").map(a=>a[0]).join("").toUpperCase().slice(0,2),Ue=t=>{const a=t instanceof Ye?t.toDate():new Date(t);return at(a)&&!as(a)?{text:Se(a,"dd MMM",{locale:Ee}),className:"bg-[#EC9488] text-white"}:as(a)?{text:"Bugün",className:"bg-[#F5D90A] text-[#172B4D]"}:rt(a)?{text:"Yarın",className:"bg-[#F5D90A] text-[#172B4D]"}:{text:Se(a,"dd MMM",{locale:Ee}),className:"bg-[#DFE1E6] text-[#172B4D]"}};return Os,_e.members,Fe,Ps,_e.checklist,Be,Ce,Te.trim(),e.jsxs("div",{className:"flex flex-col bg-[#F4F5F7] min-h-[500px] rounded-lg border border-[#DFE1E6]",children:[e.jsxs("div",{className:"bg-white border-b border-[#E4E6EA] px-3 sm:px-6 py-3 sm:py-3.5 shadow-sm space-y-3 rounded-t-lg",children:[e.jsx("div",{className:"flex flex-col gap-2 lg:flex-row lg:items-center lg:justify-between",children:e.jsx("div",{className:"flex items-center gap-2 sm:gap-3 flex-wrap text-sm",children:e.jsx("h1",{className:"text-base sm:text-lg font-semibold text-[#172B4D]",children:"Görev Panosu"})})}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 sm:gap-3",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 sm:gap-3 flex-1",children:[e.jsx(Ls,{value:G,onChange:t=>ue(t.target.value),placeholder:"Kart ara...",containerClassName:"flex-1 min-w-0",iconClassName:"text-[#5E6C84]",className:"bg-[#F4F5F7] border-none focus-visible:ring-[#0079BF] text-sm sm:text-base min-h-[44px] sm:min-h-0"}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 sm:gap-3 flex-shrink-0",children:[e.jsxs(Q,{value:K,onValueChange:he,children:[e.jsx(W,{className:"w-full sm:w-[180px] md:w-[200px] bg-[#F4F5F7] border-none focus:ring-[#0079BF] min-h-[44px] sm:min-h-0",children:e.jsx($,{placeholder:"Üye filtresi"})}),e.jsxs(X,{children:[e.jsx(F,{value:"all",children:"Tüm üyeler"}),fs.map(t=>e.jsx(F,{value:t.id,className:"min-h-[44px] sm:min-h-0",children:t.full_name||"İsimsiz kullanıcı"},t.id))]})]}),e.jsxs(Q,{value:P,onValueChange:pe,children:[e.jsx(W,{className:"w-full sm:w-[140px] md:w-[160px] bg-[#F4F5F7] border-none focus:ring-[#0079BF] min-h-[44px] sm:min-h-0",children:e.jsx($,{placeholder:"Öncelik"})}),e.jsxs(X,{children:[e.jsx(F,{value:"all",className:"min-h-[44px] sm:min-h-0",children:"Tümü"}),e.jsx(F,{value:"high",className:"min-h-[44px] sm:min-h-0",children:"Yüksek"}),e.jsx(F,{value:"medium",className:"min-h-[44px] sm:min-h-0",children:"Orta"}),e.jsx(F,{value:"low",className:"min-h-[44px] sm:min-h-0",children:"Düşük"})]})]}),ae&&e.jsxs(Q,{value:fe,onValueChange:ge,children:[e.jsx(W,{className:"w-full sm:w-[180px] md:w-[200px] bg-[#F4F5F7] border-none focus:ring-[#0079BF] min-h-[44px] sm:min-h-0",children:e.jsx($,{placeholder:"Proje Seçiniz"})}),e.jsxs(X,{children:[e.jsx(F,{value:"all",className:"min-h-[44px] sm:min-h-0",children:"Tüm Projeler"}),e.jsx(F,{value:"general",className:"min-h-[44px] sm:min-h-0",children:"Genel Görevler"}),Array.from(je.values()).filter(t=>{var a,l;return((a=t.name)==null?void 0:a.toLowerCase())!=="genel görevler"&&((l=t.name)==null?void 0:l.toLowerCase())!=="genel"}).map(t=>e.jsx(F,{value:t.id,className:"min-h-[44px] sm:min-h-0",children:t.isPrivate?e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(Ve,{className:"h-3 w-3"}),t.name]}):t.name},t.id))]})]})]})]}),e.jsx(p,{variant:"ghost",size:"sm",onClick:vs,className:"text-[#5E6C84] touch-manipulation min-h-[44px] sm:min-h-0 w-full sm:w-auto whitespace-nowrap",children:"Filtreleri Temizle"})]})]}),e.jsx("div",{className:"pb-8 px-2 sm:px-3 md:px-6 pt-3 sm:pt-4 md:pt-6 overflow-x-auto -mx-2 sm:-mx-3 md:-mx-6",draggable:!1,onDragStart:t=>t.preventDefault(),onDragOver:t=>t.preventDefault(),onDrop:t=>t.preventDefault(),children:e.jsx("div",{className:"flex gap-2 sm:gap-3 md:gap-4 pb-6 w-full min-w-max lg:min-w-0 overflow-x-auto",draggable:!1,onDragStart:t=>t.preventDefault(),onDragOver:t=>t.preventDefault(),onDrop:t=>t.preventDefault(),style:{scrollbarWidth:"thin"},children:w.columnOrder.map(t=>{const a=w.columns.find(s=>s.id===t);if(!a)return null;const l=Array.isArray(a.taskIds)?a.taskIds.map(s=>w.tasks[s]).filter(s=>gs(s)):[];return a.title.toLowerCase().includes("tamam")||a.id==="completed"||a.title.toLowerCase().includes("progress"),e.jsxs("div",{draggable:!1,onDragStart:s=>s.preventDefault(),onDragOver:s=>s.preventDefault(),onDrop:s=>s.preventDefault(),className:"flex-shrink-0 w-[260px] sm:w-[280px] md:w-[300px] lg:flex-1 lg:min-w-0 bg-[#EBECF0] rounded-lg p-2 sm:p-3 flex flex-col transition-all shadow-sm",style:{overflow:"visible"},children:[e.jsxs("div",{className:"flex items-center justify-between mb-2 px-2 py-1",children:[e.jsx("h3",{className:"font-semibold text-sm text-[#172B4D] flex-1 px-2 py-1",children:a.title}),e.jsx("div",{className:"flex items-center gap-1",children:e.jsx("span",{className:"text-xs text-[#5E6C84] font-medium px-1.5 py-0.5 bg-white/60 rounded",children:l.length})})]}),e.jsx("div",{className:"space-y-2.5 pr-1",draggable:!1,onDragStart:s=>s.preventDefault(),onDragOver:s=>s.preventDefault(),onDrop:s=>s.preventDefault(),children:l.map((s,c)=>{var v;return e.jsxs("div",{draggable:!1,onDragStart:r=>r.preventDefault(),onDragOver:r=>r.preventDefault(),onDrop:r=>r.preventDefault(),className:"relative group bg-white rounded-[3px] p-3.5 sm:p-4 shadow-[0_1px_0_rgba(9,30,66,0.25)] hover:shadow-[0_2px_4px_rgba(9,30,66,0.15)] transition-all duration-200 cursor-pointer border-0",onClick:()=>Ns(s),children:[(_||C||y||s.createdBy===(o==null?void 0:o.id))&&e.jsx("div",{className:"absolute top-2 right-2 z-10",children:e.jsxs(Us,{children:[e.jsx(Ks,{asChild:!0,onClick:r=>r.stopPropagation(),children:e.jsx(p,{variant:"ghost",size:"icon",className:"h-6 w-6 opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx(zs,{className:"h-3.5 w-3.5"})})}),e.jsxs(Rs,{align:"end",onClick:r=>r.stopPropagation(),children:[e.jsxs($e,{onClick:r=>{r.stopPropagation(),ws(s.id)},className:"cursor-pointer",children:[e.jsx(Je,{className:"h-4 w-4 mr-2"}),"Arşivle"]}),e.jsxs($e,{onClick:r=>{r.stopPropagation(),confirm("Bu görevi kalıcı olarak silmek istediğinize emin misiniz?")&&De(s.id)},className:"cursor-pointer text-destructive focus:text-destructive",children:[e.jsx(qe,{className:"h-4 w-4 mr-2"}),"Sil"]})]})]})}),Array.isArray(s.labels)&&s.labels.length>0&&e.jsx("div",{className:"flex flex-wrap gap-0.5 mb-2.5 -mx-3 -mt-3",children:s.labels.map((r,n)=>e.jsx("div",{className:"h-1.5 rounded-sm flex-1 min-w-[40px]",style:{backgroundColor:r.color},title:r.name},n))}),s.projectId&&je.has(s.projectId)&&e.jsxs("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 border border-blue-200 rounded-[3px] px-2.5 py-1.5 mb-2 text-xs text-blue-700 flex items-center gap-1.5 shadow-sm",children:[e.jsx(Ve,{className:"h-3.5 w-3.5 flex-shrink-0"}),e.jsx("span",{className:"font-semibold truncate",children:(v=je.get(s.projectId))==null?void 0:v.name})]}),s.linkedProductionOrder&&e.jsxs("div",{className:"bg-[#F4F5F7] rounded-[3px] px-2.5 py-2 mb-2 text-xs text-[#5E6C84] flex items-start gap-2",children:[e.jsx(He,{className:"h-4 w-4 text-[#5E6C84]"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-[12px] text-[#172B4D] font-medium",children:s.linkedProductionOrder.orderNumber||"Bağlı sipariş"}),e.jsxs("p",{className:"text-[11px]",children:[s.linkedProductionOrder.customerName||"-",s.linkedProductionOrder.dueDate&&e.jsxs(e.Fragment,{children:[" • ",Se(new Date(s.linkedProductionOrder.dueDate),"dd MMM",{locale:Ee})]})]})]})]}),e.jsx("p",{className:"font-normal text-sm text-[#172B4D] leading-[20px] mb-1.5 break-words",children:s.title}),s.description&&e.jsx("p",{className:"text-xs text-[#5E6C84] line-clamp-2 leading-[16px] mb-2 break-words",children:s.description}),(s.dueDate||s.attachments&&s.attachments>0||s.comments&&s.comments>0||s.checklists&&s.checklists.length>0||s.assignedUsers&&s.assignedUsers.length>0||s.createdBy)&&e.jsxs("div",{className:"flex items-center justify-between mt-2.5 pt-2 border-t border-transparent",children:[e.jsxs("div",{className:"flex items-center gap-1.5 flex-wrap",children:[s.dueDate&&e.jsx("div",{className:ke("flex items-center gap-1 text-[11px] px-1.5 py-0.5 rounded font-medium",Ue(s.dueDate).className),children:Ue(s.dueDate).text}),s.attachments>0&&e.jsxs("div",{className:"flex items-center gap-1 text-[11px] text-[#5E6C84] hover:text-[#172B4D]",children:[e.jsx(Qe,{className:"h-3.5 w-3.5"}),e.jsx("span",{children:s.attachments})]}),s.comments>0&&e.jsxs("div",{className:"flex items-center gap-1 text-[11px] text-[#5E6C84] hover:text-[#172B4D]",children:[e.jsx(Ce,{className:"h-3.5 w-3.5"}),e.jsx("span",{children:s.comments})]}),Array.isArray(s.checklists)&&s.checklists.length>0&&s.checklists.some(r=>r.total>0)&&e.jsxs("div",{className:"flex items-center gap-1 text-[11px] text-[#5E6C84] hover:text-[#172B4D]",children:[e.jsx(Z,{className:"h-3.5 w-3.5"}),e.jsxs("span",{children:[s.checklists.reduce((r,n)=>r+(n.completed||0),0),"/",s.checklists.reduce((r,n)=>r+(n.total||0),0)]})]}),s.createdBy&&(()=>{const r=ye.find(n=>n.id===s.createdBy);return r?e.jsxs("div",{className:"flex items-center gap-1 text-[11px] text-[#5E6C84] hover:text-[#172B4D]",title:`Oluşturan: ${r.fullName||r.displayName||r.email||"Bilinmeyen"}`,children:[e.jsx(ee,{className:"h-3.5 w-3.5"}),e.jsx("span",{className:"truncate max-w-[80px]",children:r.fullName||r.displayName||r.email||"Bilinmeyen"})]}):null})()]}),Array.isArray(s.assignedUsers)&&s.assignedUsers.length>0&&e.jsxs("div",{className:"flex -space-x-1",children:[s.assignedUsers.slice(0,4).map(r=>e.jsx("div",{className:"h-7 w-7 rounded-full bg-[#0079BF] text-white text-[11px] font-semibold flex items-center justify-center border-2 border-white shadow-sm hover:z-10 relative transition-transform hover:scale-110",title:r.full_name,children:Fs(r.full_name)},r.id)),s.assignedUsers.length>4&&e.jsxs("div",{className:"h-7 w-7 rounded-full bg-[#DFE1E6] text-[#172B4D] text-[11px] font-semibold flex items-center justify-center border-2 border-white shadow-sm hover:z-10 relative",children:["+",s.assignedUsers.length-4]})]})]}),(()=>{var k;if(s.status==="completed"&&s.approvalStatus==="approved")return null;const n={pending:"in_progress",in_progress:"completed"}[s.status],j=_||C||y||((k=s.assignedUsers)==null?void 0:k.some(S=>S.id===(o==null?void 0:o.id)))||s.createdBy===(o==null?void 0:o.id);if(!n||!j)return null;const D={in_progress:"Devam Ediyor",completed:"Tamamlandı"};return e.jsx("div",{className:"mt-3 pt-3 border-t border-[#DFE1E6]",onClick:S=>S.stopPropagation(),children:e.jsx(p,{size:"sm",className:"w-full text-xs bg-[#0079BF] hover:bg-[#005A8B] text-white",onClick:S=>{S.stopPropagation(),bs(s.id,s.status)},children:`${D[n]} Aşamasına Geç`})})})()]},s.id)})}),ne===a.id?e.jsxs("div",{className:"mt-3 rounded-lg bg-white border-2 border-[#0079BF]/20 shadow-lg p-4 space-y-4 animate-in fade-in-0 slide-in-from-top-2 duration-200",children:[e.jsxs("div",{className:"space-y-1.5",children:[e.jsxs(T,{className:"text-xs font-semibold text-[#172B4D] flex items-center gap-1.5",children:[e.jsx(He,{className:"h-3.5 w-3.5 text-[#0079BF]"}),"Kart Başlığı ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(Y,{placeholder:"Örn: Yeni özellik geliştir...",value:Ae,onChange:s=>oe(s.target.value),onKeyDown:s=>{s.key==="Escape"?(q(null),oe(""),ce(""),de([]),M([]),R("")):s.key==="Enter"&&!s.shiftKey&&Ae.trim()&&(s.preventDefault(),f("new"),q(null))},autoFocus:!0,disabled:B,className:"h-10 bg-white border-[#DFE1E6] text-[#172B4D] focus-visible:ring-2 focus-visible:ring-[#0079BF] focus-visible:border-[#0079BF] text-sm font-medium placeholder:text-[#5E6C84]"})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsxs(T,{className:"text-xs font-semibold text-[#172B4D] flex items-center gap-1.5",children:[e.jsx(Ce,{className:"h-3.5 w-3.5 text-[#0079BF]"}),"Açıklama"]}),e.jsx(Xe,{placeholder:"Kart hakkında detaylı bilgi ekleyin...",value:Te,onChange:s=>ce(s.target.value),rows:3,disabled:B,className:"bg-white border-[#DFE1E6] text-[#172B4D] focus-visible:ring-2 focus-visible:ring-[#0079BF] focus-visible:border-[#0079BF] resize-none text-sm placeholder:text-[#5E6C84]"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(T,{className:"text-xs font-semibold text-[#172B4D] flex items-center gap-1.5",children:[e.jsx(Z,{className:"h-3.5 w-3.5 text-[#0079BF]"}),"Kontrol Listesi"]}),L.length>0&&e.jsx("div",{className:"space-y-1.5 bg-[#F4F5F7] rounded-md p-2.5 border border-[#DFE1E6]",children:L.map((s,c)=>e.jsxs("div",{className:"flex items-center gap-2.5 text-sm group",children:[e.jsx("input",{type:"checkbox",checked:s.completed,onChange:v=>{const r=[...L];r[c].completed=v.target.checked,M(r)},className:"w-4 h-4 rounded border-[#DFE1E6] text-[#0079BF] focus:ring-2 focus:ring-[#0079BF] cursor-pointer"}),e.jsx("span",{className:ke("flex-1",s.completed?"line-through text-[#5E6C84]":"text-[#172B4D]"),children:s.text}),e.jsx("button",{type:"button",onClick:()=>{M(L.filter((v,r)=>r!==c))},className:"opacity-0 group-hover:opacity-100 text-[#5E6C84] hover:text-[#EB5A46] transition-opacity p-1 rounded hover:bg-[#EB5A46]/10",children:e.jsx(se,{className:"h-3.5 w-3.5"})})]},c))}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Y,{placeholder:"Yeni madde ekle...",value:I,onChange:s=>R(s.target.value),onKeyDown:s=>{s.key==="Enter"&&I.trim()&&(s.preventDefault(),M([...L,{text:I.trim(),completed:!1}]),R(""))},disabled:B,className:"flex-1 h-9 text-xs border-[#DFE1E6] focus-visible:ring-2 focus-visible:ring-[#0079BF]"}),e.jsx(p,{type:"button",size:"sm",onClick:()=>{I.trim()&&(M([...L,{text:I.trim(),completed:!1}]),R(""))},disabled:B||!I.trim(),className:"h-9 px-3 text-xs bg-[#0079BF] hover:bg-[#005A8B] text-white",children:e.jsx(We,{className:"h-3.5 w-3.5"})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(T,{className:"text-xs font-semibold text-[#172B4D] flex items-center gap-1.5",children:[e.jsx(ee,{className:"h-3.5 w-3.5 text-[#0079BF]"}),"Kişi Ata"]}),e.jsx("div",{className:"border border-[#DFE1E6] rounded-md p-2 bg-white",children:e.jsx(ts,{selectedUsers:is,onSelectionChange:de})})]}),e.jsxs("div",{className:"flex items-center gap-2 pt-2 border-t border-[#DFE1E6]",children:[e.jsxs(p,{size:"sm",onClick:()=>{f("new"),q(null)},className:"bg-[#0079BF] hover:bg-[#005A8B] text-white flex-1 font-semibold shadow-md hover:shadow-lg transition-all h-9",children:[e.jsx(Z,{className:"h-4 w-4 mr-1.5"}),"Kart Ekle"]}),e.jsx(p,{size:"sm",variant:"ghost",onClick:()=>{q(null),oe(""),ce(""),de([]),M([]),R("")},className:"text-[#5E6C84] hover:text-[#172B4D] hover:bg-[#F4F5F7] h-9 w-9 p-0",children:e.jsx(se,{className:"h-4 w-4"})})]})]}):e.jsxs("button",{onClick:()=>{if(!_&&!C){g.error("Görev ekleme yetkiniz yok. Sadece yönetici veya ekip lideri ekleyebilir.");return}f("new",a.id)},className:"w-full mt-2 text-left text-sm text-[#5E6C84] hover:text-[#172B4D] hover:bg-white/80 py-2.5 px-3 rounded-md transition-all flex items-center gap-2 font-medium group border border-transparent hover:border-[#DFE1E6] shadow-sm hover:shadow-md",children:[e.jsx("div",{className:"p-1 rounded bg-[#0079BF]/10 group-hover:bg-[#0079BF]/20 transition-colors",children:e.jsx(We,{className:"h-4 w-4 text-[#0079BF] group-hover:text-[#005A8B]"})}),e.jsx("span",{className:"group-hover:font-semibold transition-all",children:"Kart ekle"})]})]},a.id)})})}),d&&e.jsx(Gs,{open:ie,onOpenChange:z,children:e.jsxs(Ys,{className:"max-w-3xl max-h-[90vh] sm:max-h-[90vh] overflow-hidden p-0","aria-describedby":"task-edit-description",children:[e.jsxs(Vs,{className:"sr-only",children:[e.jsx(Js,{children:"Kart Düzenle"}),e.jsx(qs,{id:"task-edit-description",children:"Görev düzenleme"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row h-full",children:[e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 sm:p-6",children:[e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Y,{value:h.title,onChange:t=>O(a=>x(m({},a),{title:t.target.value})),className:"text-xl font-semibold text-[#172B4D] border-none shadow-none p-0 h-auto focus-visible:ring-0 focus-visible:ring-offset-0",placeholder:"Kart başlığı"}),e.jsx(p,{variant:"ghost",size:"icon",onClick:()=>z(!1),className:"text-[#5E6C84] hover:text-[#172B4D] hover:bg-gray-200",children:e.jsx(se,{className:"h-5 w-5"})})]})}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs(T,{className:"text-sm font-semibold text-[#172B4D] mb-2 flex items-center gap-2",children:[e.jsx(Fe,{className:"h-4 w-4"}),"Etiketler"]}),e.jsx("div",{className:"flex flex-wrap gap-2 mb-3",children:h.labels.map((t,a)=>e.jsxs("div",{className:"flex items-center gap-1.5 px-2.5 py-1 rounded text-xs font-semibold text-white cursor-pointer hover:opacity-90 transition-opacity",style:{backgroundColor:t.color},onClick:()=>ks(t.name),children:[e.jsx("span",{children:t.name}),e.jsx(se,{className:"h-3 w-3"})]},a))}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Y,{value:h.labelInput,onChange:t=>O(a=>x(m({},a),{labelInput:t.target.value})),placeholder:"Etiket adı girin...",className:"flex-1 text-sm",onKeyDown:t=>{t.key==="Enter"&&(t.preventDefault(),Ie())}}),e.jsx(p,{type:"button",onClick:Ie,size:"sm",disabled:!h.labelInput.trim(),className:"bg-[#0079BF] hover:bg-[#005A8B] text-white",children:"Ekle"})]}),e.jsx("div",{className:"flex flex-wrap gap-1.5",children:V.map(t=>e.jsx("button",{onClick:()=>O(a=>x(m({},a),{labelColor:t.value})),className:ke("w-8 h-8 rounded border-2 transition-all hover:scale-110",t.class,h.labelColor===t.value?"border-gray-800 scale-110 ring-2 ring-gray-400":"border-gray-300 hover:border-gray-500"),title:t.name},t.name))})]})]}),e.jsxs("div",{children:[e.jsx(T,{className:"text-sm font-semibold text-[#172B4D] mb-2",children:"Açıklama"}),e.jsx(Xe,{value:h.description,onChange:t=>O(a=>x(m({},a),{description:t.target.value})),placeholder:"Daha fazla detay ekleyin...",rows:6,className:"resize-none"})]}),e.jsxs("div",{children:[e.jsxs(T,{className:"text-sm font-semibold text-[#172B4D] mb-2 flex items-center gap-2",children:[e.jsx(Be,{className:"h-4 w-4"}),"Bitiş Tarihi"]}),e.jsx(Y,{type:"date",value:h.dueDate,onChange:t=>O(a=>x(m({},a),{dueDate:t.target.value})),className:"max-w-xs"})]}),Oe&&e.jsxs("div",{children:[e.jsxs(T,{className:"text-sm font-semibold text-[#172B4D] mb-2 flex items-center gap-2",children:[e.jsx(ee,{className:"h-4 w-4"}),"Üyeler"]}),e.jsx(ts,{selectedUsers:xe,onSelectionChange:Pe}),e.jsxs("div",{className:"flex gap-2 mt-3",children:[e.jsx(p,{size:"sm",onClick:Ds,disabled:B,className:"bg-[#0079BF] hover:bg-[#005A8B] text-white font-medium shadow-sm disabled:opacity-50 disabled:cursor-not-allowed",children:B?e.jsx(te,{className:"h-4 w-4 animate-spin"}):"Kaydet"}),e.jsx(p,{size:"sm",variant:"outline",onClick:()=>{var t;me(!1),Pe(((t=d.assignedUsers)==null?void 0:t.map(a=>a.id))||[])},className:"border-[#DFE1E6] text-[#172B4D] hover:bg-[#F4F5F7] font-medium",children:"İptal"})]})]})]})]}),e.jsxs("div",{className:"w-full sm:w-64 border-t sm:border-t-0 sm:border-l border-gray-200 bg-[#F4F5F7] p-4 flex flex-col gap-1 sm:gap-1",children:[e.jsx("div",{className:"text-xs font-semibold text-[#5E6C84] uppercase mb-1 px-2",children:"Eylemler"}),e.jsxs(p,{variant:"ghost",className:"w-full justify-start text-left text-[#172B4D] hover:bg-white/60",onClick:()=>{me(!Oe)},children:[e.jsx(ee,{className:"h-4 w-4 mr-2 text-[#5E6C84]"}),"Üye Ekle"]}),e.jsxs(p,{variant:"ghost",className:"w-full justify-start text-left text-[#172B4D] hover:bg-white/60",onClick:()=>{ds(!cs)},children:[e.jsx(Fe,{className:"h-4 w-4 mr-2 text-[#5E6C84]"}),"Etiketler"]}),e.jsxs(p,{variant:"ghost",className:"w-full justify-start text-left text-[#172B4D] hover:bg-white/60",onClick:()=>{g.info("Checklist özelliği yakında eklenecek. Backend desteği eklendikten sonra aktif olacak.")},children:[e.jsx(Z,{className:"h-4 w-4 mr-2 text-[#5E6C84]"}),"Checklist"]}),e.jsxs(p,{variant:"ghost",className:"w-full justify-start text-left text-[#172B4D] hover:bg-white/60",onClick:()=>{const t=document.querySelector('input[type="date"]');t&&t.focus()},children:[e.jsx(Be,{className:"h-4 w-4 mr-2 text-[#5E6C84]"}),"Tarih"]}),e.jsxs(p,{variant:"ghost",className:"w-full justify-start text-left text-[#172B4D] hover:bg-white/60",onClick:()=>{g.info("Dosya ekleme özelliği yakında eklenecek. Backend desteği eklendikten sonra aktif olacak.")},children:[e.jsx(Qe,{className:"h-4 w-4 mr-2 text-[#5E6C84]"}),"Ek"]}),e.jsx("div",{className:"text-xs font-semibold text-[#5E6C84] uppercase mt-4 px-2",children:"İlişkiler"}),e.jsxs("div",{className:"space-y-2 px-2",children:[e.jsxs(Q,{value:be,onValueChange:ve,children:[e.jsx(W,{className:"bg-white",children:e.jsx($,{placeholder:"Sipariş seç"})}),e.jsxs(X,{children:[e.jsx(F,{value:"none",children:"Bağlı sipariş yok"}),Array.isArray(E)&&E.map(t=>e.jsxs(F,{value:t.id,children:[t.order_number," • ",t.customer_name||"-"]},t.id))]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(p,{size:"sm",onClick:()=>js(be==="none"?null:be),disabled:B,className:"bg-[#0079BF] hover:bg-[#005A8B] text-white flex-1 font-medium shadow-sm disabled:opacity-50 disabled:cursor-not-allowed",children:B?e.jsx(te,{className:"h-4 w-4 animate-spin"}):"Bağla"}),e.jsx(p,{size:"sm",variant:"outline",onClick:Ne,disabled:Le,className:"border-[#DFE1E6] text-[#172B4D] hover:bg-[#F4F5F7] font-medium disabled:opacity-50 disabled:cursor-not-allowed",children:Le?e.jsx(te,{className:"h-4 w-4 animate-spin"}):"Yenile"})]}),d.linkedProductionOrder&&e.jsxs("p",{className:"text-[11px] text-[#5E6C84]",children:["Bağlı: ",d.linkedProductionOrder.orderNumber||d.linkedProductionOrder.id]})]}),e.jsx("div",{className:"border-t border-gray-200 my-2"}),e.jsxs(p,{variant:"ghost",className:"w-full justify-start text-left text-[#172B4D] hover:bg-red-50 hover:text-red-600 font-medium",onClick:()=>{confirm("Bu kartı silmek istediğinize emin misiniz?")&&(De(d.id),z(!1))},children:[e.jsx(Je,{className:"h-4 w-4 mr-2"}),"Arşivle"]}),e.jsxs(p,{variant:"ghost",className:"w-full justify-start text-left text-red-600 hover:bg-red-50 font-medium",onClick:()=>{confirm("Bu kartı kalıcı olarak silmek istediğinize emin misiniz?")&&(De(d.id),z(!1))},children:[e.jsx(qe,{className:"h-4 w-4 mr-2"}),"Sil"]})]})]}),e.jsxs(Hs,{className:"border-t border-gray-200 p-4 bg-white",children:[e.jsx(p,{variant:"outline",onClick:()=>z(!1),className:"border-[#DFE1E6] text-[#172B4D] hover:bg-[#F4F5F7] font-medium",children:"Kapat"}),e.jsxs(p,{onClick:ys,disabled:B||!h.title.trim(),className:"bg-[#0079BF] hover:bg-[#005A8B] text-white font-medium shadow-sm disabled:opacity-50 disabled:cursor-not-allowed",children:[B?e.jsx(te,{className:"h-4 w-4 animate-spin mr-2"}):null,"Kaydet"]})]})]})})]})};export{gt as T};
