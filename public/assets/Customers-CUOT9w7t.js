import{a3 as J,r,j as e,C as O,e as I,B as R,a1 as ce,$ as de,a0 as me,V,k as ue,a as xe,g as pe,b as B,S as he,p as ge,q as fe,s as je,t as L,X as ye,U as be}from"./index-Xd90qdO9.js";import{j as Ne,A as ve,E as we,G as ke,H as X,P as W,B as Ce,x as De,y as Ae,M as q,a6 as Se}from"./MainLayout-DW7UjMSA.js";import{S as Me}from"./search-input-QX7HVhJf.js";import{A as Te,a as Le,b as Oe,c as Ie,d as Re,e as Fe,f as Ee,g as Ue}from"./alert-dialog-BVp-ELLM.js";import{C as ze}from"./CreateCustomerDialog-Ct1V89iV.js";import{C as Be}from"./CustomerDetailModal-D1Gwzqrs.js";import{getSavedReports as Ve}from"./reportService-eZYvGhBr.js";import{D as _e}from"./DetailedValueReportModal-Hb3qQukI.js";import{L as $e}from"./loading-state-CyTUOPV3.js";import{E as He}from"./ellipsis-vertical-gVlTlFy-.js";import{S as Qe}from"./square-pen-zeHrcQ7c.js";import{T as Ye}from"./trash-2-DlZRXDqX.js";import{T as Z}from"./trending-up-DyiN6Ad2.js";import{P as Ge}from"./plus-D9uLCipi.js";import"./taskService-CQO0i9v5.js";import"./save-Bgz0wbo5.js";import"./separator-BNuYyAQ9.js";import"./map-pin-CYdnXw-f.js";import"./download-Bq-rl9Ru.js";import"./message-square-BAQ_w3zD.js";import"./format-DuC-NjES.js";import"./storageService-pEqhfEwa.js";import"./driveService-020R8zku.js";import"./table-CHpYTcky.js";import"./exchangeRateService-Cpnvl6ZU.js";import"./currency-BpxR3_y8.js";import"./chart-column-tcYl_7Fa.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ke=J("Star",[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pe=J("UsersRound",[["path",{d:"M18 21a8 8 0 0 0-16 0",key:"3ypg7q"}],["circle",{cx:"10",cy:"8",r:"5",key:"o932ke"}],["path",{d:"M22 20c0-3.37-2-6.5-4-8a5 5 0 0 0-.45-8.3",key:"10s06x"}]]),ee=r.memo(({customer:s,orders:l,onSelect:x,onDelete:i})=>{const c=l.filter(n=>n.customerId===s.id||n.customer_id===s.id),v=c.length,w=c.reduce((n,F)=>n+(F.totalAmount||0),0),b=v>0;return e.jsx(O,{className:"group hover:shadow-xl transition-all duration-300 cursor-pointer border border-border/60 hover:border-primary/50 flex flex-col h-full overflow-hidden bg-white hover:-translate-y-1",onClick:()=>x(s),children:e.jsxs(I,{className:"p-5 sm:p-6 flex flex-col flex-1 gap-4 sm:gap-5",children:[e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-bold text-base sm:text-lg truncate text-foreground mb-1",title:s.name,children:s.name}),s.company&&e.jsxs("div",{className:"flex items-center gap-1.5 mt-0.5",children:[e.jsx(Ne,{className:"h-3.5 w-3.5 text-muted-foreground flex-shrink-0"}),e.jsx("p",{className:"text-xs sm:text-sm text-muted-foreground truncate",title:s.company,children:s.company})]})]}),e.jsxs(ve,{children:[e.jsx(we,{asChild:!0,children:e.jsx(R,{variant:"ghost",size:"icon",className:"h-8 w-8 opacity-0 group-hover:opacity-100 transition-opacity flex-shrink-0 hover:bg-muted/80 rounded-lg",onClick:n=>n.stopPropagation(),children:e.jsx(He,{className:"h-4 w-4"})})}),e.jsxs(ke,{align:"end",children:[e.jsxs(X,{onClick:n=>{n.stopPropagation(),x(s)},children:[e.jsx(Qe,{className:"mr-2 h-4 w-4"})," Detayları Görüntüle"]}),e.jsxs(X,{className:"text-destructive focus:text-destructive",onClick:n=>{n.stopPropagation(),i(s)},children:[e.jsx(Ye,{className:"mr-2 h-4 w-4"})," Sil"]})]})]})]}),e.jsxs("div",{className:"space-y-2.5 flex-1 min-h-[60px]",children:[s.email&&e.jsxs("div",{className:"flex items-center gap-2.5 text-xs sm:text-sm bg-gradient-to-r from-muted/40 to-muted/30 rounded-lg px-3.5 py-2.5 border border-muted/60 shadow-sm hover:shadow transition-shadow",children:[e.jsx(ce,{className:"h-4 w-4 sm:h-4.5 sm:w-4.5 text-primary flex-shrink-0"}),e.jsx("span",{className:"truncate text-foreground font-medium",title:s.email,children:s.email})]}),s.phone&&e.jsxs("div",{className:"flex items-center gap-2.5 text-xs sm:text-sm bg-gradient-to-r from-muted/40 to-muted/30 rounded-lg px-3.5 py-2.5 border border-muted/60 shadow-sm hover:shadow transition-shadow",children:[e.jsx(de,{className:"h-4 w-4 sm:h-4.5 sm:w-4.5 text-primary flex-shrink-0"}),e.jsx("span",{className:"text-foreground font-medium",children:me(s.phone)})]}),!s.email&&!s.phone&&e.jsx("div",{className:"text-xs sm:text-sm text-muted-foreground italic py-3 text-center bg-muted/20 rounded-lg border border-dashed border-muted",children:"İletişim bilgisi yok"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 pt-4 border-t border-border/60",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1.5",children:[e.jsx(W,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"text-xs sm:text-sm font-medium text-muted-foreground",children:"Sipariş"})]}),e.jsx("span",{className:"text-xl sm:text-2xl font-bold text-foreground",children:v})]}),e.jsxs("div",{className:"flex flex-col items-end",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1.5",children:[e.jsx(Z,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"text-xs sm:text-sm font-medium text-muted-foreground",children:"Toplam"})]}),e.jsxs("span",{className:"text-xl sm:text-2xl font-bold text-foreground",children:["₺",new Intl.NumberFormat("tr-TR",{minimumFractionDigits:0,maximumFractionDigits:0}).format(w)]})]})]}),e.jsx("div",{className:"pt-3 border-t border-border/60",children:e.jsx(Ce,{variant:b?"default":"secondary",className:V("rounded-full px-3 py-1.5 w-full justify-center",b?"bg-emerald-100 text-emerald-700 border-emerald-200":"bg-muted/60 border-muted"),children:b?"Aktif":"Pasif"})})]})})},(s,l)=>s.customer.id===l.customer.id&&s.customer.name===l.customer.name&&s.customer.email===l.customer.email&&s.customer.phone===l.customer.phone&&s.customer.company===l.customer.company&&s.orders.length===l.orders.length&&s.orders.every((x,i)=>{const c=l.orders[i];return x.id===(c==null?void 0:c.id)&&x.totalAmount===(c==null?void 0:c.totalAmount)}));ee.displayName="CustomerCard";const wt=()=>{ue();const s=xe(),[l,x]=r.useState([]),[i,c]=r.useState([]),[v,w]=r.useState(!0),[b,n]=r.useState(!1),[F,_]=r.useState(!1),[te,E]=r.useState(!1),[k,U]=r.useState(null),[p,C]=r.useState(""),[Xe,se]=r.useState({}),[h,D]=r.useState("all"),[ae,$]=r.useState(!1),[A,g]=r.useState(null);r.useEffect(()=>{N()},[]);const N=r.useCallback(async()=>{try{w(!0);const[t,a,d,j]=await Promise.all([De(),pe(),Ve({reportType:"sales_quote"}),Ae()]);c(j);const m={};a.forEach(o=>{m[o.id]=o.fullName||o.displayName||o.email}),se(m);const u={};d.forEach(o=>{var M,K,T,P;const y=o.metadata||{},z=y==null?void 0:y.customerId;if(!z)return;const ie=((K=(M=o.createdAt)==null?void 0:M.toMillis)==null?void 0:K.call(M))||Date.parse(((P=(T=o.createdAt)==null?void 0:T.toDate)==null?void 0:P.call(T))||o.createdAt||""),ne=Number((y==null?void 0:y.grandTotal)||0),Y={id:o.id,title:o.title||"Teklif",date:ie||Date.now(),total:ne,downloadUrl:o.driveLink||o.fileUrl},G=u[z];(!G||Y.date>G.date)&&(u[z]=Y)});const S=t.map(o=>({...o,lastQuote:u[o.id]||null}));x(S)}catch(t){console.error("Fetch customers error:",t),B.error(t.message||"Müşteriler yüklenirken hata oluştu")}finally{w(!1)}},[]),re=async()=>{if(k)try{await Se(k.id),B.success("Müşteri silindi"),N(),E(!1),U(null)}catch(t){console.error("Delete customer error:",t),B.error(t.message||"Müşteri silinirken hata oluştu")}},f=r.useMemo(()=>{const t=l.length,a=i.length,d=i.reduce((m,u)=>m+(u.totalAmount||0),0),j=l.filter(m=>i.filter(S=>S.customerId===m.id||S.customer_id===m.id).length>0).length;return{total:t,totalOrders:a,totalAmount:d,activeCustomers:j}},[l,i]),H=r.useCallback(t=>i.some(a=>a.customerId===t.id||a.customer_id===t.id),[i]),Q=r.useMemo(()=>l.filter(t=>{var d,j,m,u;const a=p.toLocaleLowerCase("tr-TR");return a&&!(((d=t.name)==null?void 0:d.toLocaleLowerCase("tr-TR"))||"").includes(a)&&!(((j=t.email)==null?void 0:j.toLocaleLowerCase("tr-TR"))||"").includes(a)&&!(((m=t.company)==null?void 0:m.toLocaleLowerCase("tr-TR"))||"").includes(a)?!1:h==="needs_contact"?!t.email||!t.phone:h==="vip"?((u=t.tags)==null?void 0:u.includes("vip"))||!1:h==="active"?H(t):!0}).sort((t,a)=>t.updatedAt&&a.updatedAt?a.updatedAt.seconds-t.updatedAt.seconds:0),[l,p,h,i,H]),le=r.useMemo(()=>{var t,a;try{return new Intl.NumberFormat("tr-TR",{style:"currency",currency:"TRY",minimumFractionDigits:2}).format(f.totalAmount)}catch{return`₺${((a=(t=f.totalAmount)==null?void 0:t.toFixed)==null?void 0:a.call(t,2))??"0,00"}`}},[f.totalAmount]),oe=[{key:"total-customers",label:"Toplam Müşteri",value:f.total,icon:Pe,accent:"bg-primary/10 text-primary",description:"Tüm müşteri kayıtları",onClick:()=>{D("all"),C(""),g("total-customers")},isActive:A==="total-customers"},{key:"total-orders",label:"Toplam Sipariş",value:f.totalOrders,icon:W,accent:"bg-emerald-100 text-emerald-700",description:"Sipariş listesine git",onClick:()=>{g("total-orders"),s("/orders")},isActive:A==="total-orders"},{key:"total-amount",label:"Toplam Tutar",value:le,icon:Z,accent:"bg-amber-100 text-amber-700",description:"Raporları görüntüle",onClick:()=>{g("total-amount"),$(!0)},isActive:A==="total-amount"},{key:"active-customers",label:"Aktif Müşteri",value:f.activeCustomers,icon:Ke,accent:"bg-purple-100 text-purple-700",description:"Siparişi olan müşteriler",onClick:()=>{D("active"),g("active-customers")},isActive:A==="active-customers"}];return v?e.jsx(q,{children:e.jsx($e,{message:"Müşteriler yükleniyor..."})}):e.jsxs(q,{children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3 sm:gap-4",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h1",{className:"text-xl sm:text-2xl md:text-3xl font-bold text-foreground",children:"Müşteriler"}),e.jsx("p",{className:"text-muted-foreground mt-0.5 sm:mt-1 text-xs sm:text-sm",children:"Müşteri ve tedarikçi listenizi yönetin"})]}),e.jsxs(R,{className:"gap-2 w-full sm:w-auto min-h-[44px] sm:min-h-0",onClick:()=>n(!0),children:[e.jsx(Ge,{className:"h-4 w-4"}),"Yeni Müşteri"]})]}),e.jsx(O,{className:"border-2",children:e.jsx(I,{className:"pt-6",children:e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:oe.map(t=>{const a=t.icon;return e.jsx(O,{className:V("border-2 border-border/60 shadow-sm cursor-pointer transition-all duration-200 hover:shadow-lg hover:-translate-y-0.5 focus-within:ring-2 focus-within:ring-primary/40",t.isActive&&"border-primary shadow-xl ring-2 ring-primary/20 bg-primary/5"),role:"button",tabIndex:0,onClick:t.onClick,onKeyDown:d=>{(d.key==="Enter"||d.key===" ")&&(d.preventDefault(),t.onClick())},"aria-label":`${t.label} kartı`,children:e.jsxs(I,{className:"p-5 flex items-center gap-4",children:[e.jsx("div",{className:V("h-14 w-14 rounded-2xl flex items-center justify-center shadow-md",t.accent),children:e.jsx(a,{className:"h-6 w-6"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-xs uppercase tracking-wide text-muted-foreground font-semibold",children:t.label}),e.jsx("p",{className:"text-2xl sm:text-3xl font-bold text-foreground mt-1.5",children:t.value}),e.jsx("p",{className:"text-[11px] text-muted-foreground mt-1",children:t.description})]})]})},t.key)})})})}),e.jsx(O,{className:"border-2",children:e.jsx(I,{className:"p-4 sm:p-6",children:e.jsxs("div",{className:"flex flex-wrap items-center gap-3 sm:gap-4",children:[e.jsx("div",{className:"flex-1 min-w-[200px] sm:min-w-[250px]",children:e.jsx(Me,{placeholder:"İsim, e-posta veya şirket ara...",className:"w-full h-10",value:p,onChange:t=>{C(t.target.value),t.target.value===""&&g(null)}})}),e.jsx("div",{className:"w-full sm:w-auto sm:min-w-[180px]",children:e.jsxs(he,{value:h,onValueChange:t=>D(t),children:[e.jsx(ge,{className:"w-full h-10",children:e.jsx(fe,{placeholder:"Filtrele"})}),e.jsxs(je,{children:[e.jsx(L,{value:"all",children:"Tümü"}),e.jsx(L,{value:"needs_contact",children:"Kontak Eksik"}),e.jsx(L,{value:"vip",children:"VIP"}),e.jsx(L,{value:"active",children:"Aktif Müşteriler"})]})]})}),(p||h!=="all")&&e.jsxs(R,{variant:"outline",size:"sm",onClick:()=>{C(""),D("all"),g(null)},className:"h-10",children:[e.jsx(ye,{className:"h-4 w-4 mr-2"}),"Temizle"]})]})})}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 sm:gap-6",children:Q.map(t=>e.jsx(ee,{customer:t,orders:i,onSelect:a=>{U(a),_(!0)},onDelete:a=>{U(a),E(!0)}},t.id))}),Q.length===0&&e.jsxs("div",{className:"text-center py-16 bg-muted/10 rounded-xl border border-dashed border-muted-foreground/20",children:[e.jsx("div",{className:"mx-auto w-12 h-12 bg-muted/50 rounded-full flex items-center justify-center mb-4",children:e.jsx(be,{className:"h-6 w-6 text-muted-foreground"})}),e.jsx("h3",{className:"text-lg font-semibold text-foreground",children:"Müşteri Bulunamadı"}),e.jsx("p",{className:"text-muted-foreground max-w-sm mx-auto mt-2",children:p?`"${p}" aramasıyla eşleşen sonuç yok.`:"Henüz kayıtlı müşteri bulunmuyor. Yeni müşteri ekleyerek başlayın."}),p&&e.jsx(R,{variant:"link",onClick:()=>C(""),className:"mt-2",children:"Aramayı temizle"})]})]}),e.jsx(ze,{open:b,onOpenChange:n,onSuccess:N}),k&&e.jsx(Be,{open:F,onOpenChange:_,customer:k,onUpdate:N,onDelete:N}),e.jsx(Te,{open:te,onOpenChange:E,children:e.jsxs(Le,{children:[e.jsxs(Oe,{children:[e.jsx(Ie,{children:"Müşteriyi sil?"}),e.jsx(Re,{children:"Bu işlem geri alınamaz. Müşteri kalıcı olarak silinecek."})]}),e.jsxs(Fe,{children:[e.jsx(Ee,{children:"İptal"}),e.jsx(Ue,{onClick:re,children:"Sil"})]})]})}),e.jsx(_e,{open:ae,onOpenChange:$,title:"Müşteri Değer Raporu",type:"customers",data:l,orders:i})]})};export{wt as default};
