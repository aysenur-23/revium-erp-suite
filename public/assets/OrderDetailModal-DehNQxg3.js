import{k as We,r as d,b as f,j as s,B as b,X as He,L as we,C as N,c as y,d as _,e as v,w as p,R as D,S as le,p as ce,q as me,s as ue,t as g,U as Se,f as Ye,W as Qe,Y as Xe,Z as Ze,$ as Je,a0 as es,a1 as ss,a2 as ts,T as he,i as as,v as is,g as ns}from"./index-Xd90qdO9.js";import{g as ls,i as cs,D as ms,a as us,b as ds,f as rs,c as hs,d as os,B as De,T as ke,P as Te,C as qe,j as xs,k as ps,u as de,l as gs,m as fs}from"./MainLayout-DW7UjMSA.js";import{b as Ce}from"./taskService-CQO0i9v5.js";import{S as js}from"./square-pen-zeHrcQ7c.js";import{T as Ns}from"./trash-2-DlZRXDqX.js";import{S as ys}from"./save-Bgz0wbo5.js";import{T as _s}from"./truck-CIL1YvLr.js";import{C as vs}from"./circle-dot-CCfpRgG9.js";import{L as bs}from"./list-checks-CkcaKLuC.js";const W=n=>{if(!n)return null;if(typeof n=="string"){const h=new Date(n);return isNaN(h.getTime())?null:h}if(n instanceof Date)return isNaN(n.getTime())?null:n;if(n instanceof he)return n.toDate();if(n&&typeof n=="object"){if("seconds"in n&&typeof n.seconds=="number")return new Date(n.seconds*1e3);if("toDate"in n&&typeof n.toDate=="function")try{return n.toDate()}catch{return null}if("_seconds"in n&&typeof n._seconds=="number")return new Date(n._seconds*1e3)}return null},w=n=>{if(!n)return"-";let h=null;if(n instanceof Date)h=n;else if(n instanceof he)h=n.toDate();else if(typeof n=="string")h=new Date(n);else if(n&&typeof n=="object")if("seconds"in n&&typeof n.seconds=="number")h=new Date(n.seconds*1e3);else if("toDate"in n&&typeof n.toDate=="function")try{h=n.toDate()}catch{return"-"}else"_seconds"in n&&typeof n._seconds=="number"&&(h=new Date(n._seconds*1e3));if(!h||isNaN(h.getTime()))return"-";try{return h.toLocaleDateString("tr-TR",{day:"2-digit",month:"short",year:"numeric"})}catch{return"-"}},E=[{value:"planned",label:"Planlanan",icon:ps,color:"text-muted-foreground"},{value:"in_production",label:"Üretimde",icon:Te,color:"text-blue-500"},{value:"quality_check",label:"Kalite Kontrol",icon:as,color:"text-cyan-500"},{value:"completed",label:"Tamamlandı",icon:is,color:"text-emerald-600"},{value:"on_hold",label:"Beklemede",icon:qe,color:"text-amber-500"}],re=n=>n||"planned",Ps=({open:n,onOpenChange:h,order:e,onEdit:ws,onDelete:oe,onUpdate:H})=>{var ve,be;if(!e)return null;const{user:u,isAdmin:z}=We(),[Y,xe]=d.useState([]),[L,M]=d.useState(!1),[Be,pe]=d.useState(!0),[l,Ae]=d.useState(null),[ge,U]=d.useState(!1),[S,V]=d.useState(re(e==null?void 0:e.status)),[Fe,Pe]=d.useState({}),[K,Q]=d.useState(!1),[X,fe]=d.useState(!1),[I,Oe]=d.useState([]),[Z,je]=d.useState(!1),[i,r]=d.useState({order_number:"",product_name:"",product_id:"",quantity:"",unit:"Adet",customer_id:"",customer_name:"",due_date:"",priority:"0",status:"planned",notes:"",shipping_address:"",shipping_notes:""}),R=(e==null?void 0:e.order_number)||(e==null?void 0:e.orderNumber)||(e==null?void 0:e.id)||"-",G=W((e==null?void 0:e.due_date)||(e==null?void 0:e.dueDate)),J=W((e==null?void 0:e.created_at)||(e==null?void 0:e.createdAt)),$e=W((e==null?void 0:e.updated_at)||(e==null?void 0:e.updatedAt)),ee=(e==null?void 0:e.delivery_address)||(e==null?void 0:e.shippingAddress)||(e==null?void 0:e.shipping_address),se=(e==null?void 0:e.delivery_notes)||(e==null?void 0:e.shippingNotes)||(e==null?void 0:e.shipping_notes),Ee=((ve=u==null?void 0:u.roles)==null?void 0:ve.includes("manager"))||z,ze=(u==null?void 0:u.id)===(e==null?void 0:e.createdBy),te=Ee||z||ze,Le=d.useCallback(async()=>{try{je(!0);const t=await ls();Oe(t)}catch(t){console.error("Fetch products error:",t),f.error("Ürün listesi alınamadı.")}finally{je(!1)}},[]);d.useEffect(()=>{n&&(e!=null&&e.id)&&(Ne(),V(re(e==null?void 0:e.status)),Le())},[n,e==null?void 0:e.id,e==null?void 0:e.status]),d.useEffect(()=>{var t,a,c,m,o,x,j,T,q,B,A,F,P,O,$;if(e&&!K){const ae=((a=(t=e.items)==null?void 0:t[0])==null?void 0:a.productId)||((m=(c=e.items)==null?void 0:c[0])==null?void 0:m.product_id)||e.product_id||"",ie=((x=(o=e.items)==null?void 0:o[0])==null?void 0:x.productName)||((T=(j=e.items)==null?void 0:j[0])==null?void 0:T.product_name)||e.product_name||"",ne=e.due_date?e.due_date instanceof Date?e.due_date.toISOString().split("T")[0]:typeof e.due_date=="string"?new Date(e.due_date).toISOString().split("T")[0]:e.dueDate?e.dueDate instanceof Date?e.dueDate.toISOString().split("T")[0]:typeof e.dueDate=="string"?new Date(e.dueDate).toISOString().split("T")[0]:"":"":"";r({order_number:e.order_number||e.orderNumber||"",product_name:ie,product_id:ae,quantity:((q=e.quantity)==null?void 0:q.toString())||((F=(A=(B=e.items)==null?void 0:B[0])==null?void 0:A.quantity)==null?void 0:F.toString())||"",unit:e.unit||((O=(P=e.items)==null?void 0:P[0])==null?void 0:O.unit)||"Adet",customer_id:e.customer_id||e.customerId||"",customer_name:e.customer_name||e.customerName||"",due_date:ne,priority:(($=e.priority)==null?void 0:$.toString())||"0",status:e.status||"planned",notes:e.notes||"",shipping_address:e.delivery_address||e.shippingAddress||e.shipping_address||"",shipping_notes:e.delivery_notes||e.shippingNotes||e.shipping_notes||""})}},[e,n,K]),d.useEffect(()=>{n&&(async()=>{try{const a=await ns(),c={};a.forEach(m=>{c[m.id]=m.fullName||m.displayName||m.email||"Bilinmeyen"}),Pe(c)}catch(a){console.error("Error loading users:",a)}})()},[n]);const Ne=async()=>{pe(!0);try{if(e.customer_id||e.customerId){const t=e.customer_id||e.customerId;try{const a=await cs(t);Ae(a)}catch(a){console.error("Fetch customer error:",a)}}M(!0);try{const t=await Ce({productionOrderId:e.id});xe(t)}catch(t){console.error("Fetch order tasks error:",t),f.error(t.message||"Görevler yüklenirken hata oluştu")}finally{M(!1)}}catch(t){console.error("Fetch order details error:",t),f.error("Detaylar yüklenirken hata: "+(t.message||"Bilinmeyen hata"))}finally{pe(!1)}},Me=async()=>{M(!0);try{const t=await Ce({productionOrderId:e.id});xe(t)}catch(t){console.error("Fetch order tasks error:",t),f.error(t.message||"Görevler yüklenirken hata oluştu")}finally{M(!1)}},C=t=>({planned:"Planlanan",in_production:"Üretimde",quality_check:"Kalite Kontrol",completed:"Tamamlandı",on_hold:"Beklemede"})[t]||t,Ue=t=>{switch(t){case"completed":return"default";case"in_production":return"secondary";case"quality_check":return"secondary";case"planned":return"outline";case"on_hold":return"outline";default:return"secondary"}},ye=()=>{const t=re(S),a=E.findIndex(c=>c.value===t);return a===-1?0:a},k=()=>{const t=ye();return t===-1||t>=E.length-1||S==="on_hold"?null:E[t+1]},Ve=async t=>{if(!(!(e!=null&&e.id)||!(u!=null&&u.id))){U(!0);try{await de(e.id,{status:t},u.id,z),V(t),f.success(`Sipariş durumu ${C(t)} olarak güncellendi.`)}catch(a){console.error("Order status update error:",a),f.error("Durum güncellenemedi: "+((a==null?void 0:a.message)||"Bilinmeyen hata"))}finally{U(!1)}}},Ke=async t=>{if(!(!(e!=null&&e.id)||!(u!=null&&u.id)||!te)){U(!0);try{await de(e.id,{status:t},u.id,z),V(t),f.success(`Sipariş durumu ${C(t)} olarak güncellendi.`)}catch(a){console.error("Order status revert error:",a),f.error("Durum güncellenemedi: "+((a==null?void 0:a.message)||"Bilinmeyen hata"))}finally{U(!1)}}},Ie=t=>{if(t==="none"||t===""){r(c=>({...c,product_id:""}));return}const a=I.find(c=>c.id===t);a&&r(c=>({...c,product_id:t,product_name:a.name}))},Re=t=>{r(a=>{const c=I.find(o=>o.id===a.product_id),m=c&&c.name===t?a.product_id:"";return{...a,product_name:t,product_id:m}})},_e=async t=>{if(t.preventDefault(),!!(e!=null&&e.id)){fe(!0);try{const a=i.due_date?he.fromDate(new Date(i.due_date)):null,c=Number(i.quantity)||0;await de(e.id,{orderNumber:i.order_number,order_number:i.order_number,customerId:i.customer_id||null,customer_id:i.customer_id||null,customerName:i.customer_name||null,customer_name:i.customer_name||null,dueDate:a,due_date:i.due_date||null,status:i.status,notes:i.notes||null,deliveryAddress:i.shipping_address||null,delivery_address:i.shipping_address||null,shippingAddress:i.shipping_address||null,shipping_address:i.shipping_address||null,deliveryNotes:i.shipping_notes||null,delivery_notes:i.shipping_notes||null,shippingNotes:i.shipping_notes||null,shipping_notes:i.shipping_notes||null,totalQuantity:c,total_quantity:c,itemsCount:1,items_count:1},u==null?void 0:u.id);try{const m=await gs(e.id);m.length>0&&await fs(e.id,m[0].id,{productId:i.product_id||null,product_id:i.product_id||null,productName:i.product_name,product_name:i.product_name,quantity:c})}catch(m){console.warn("Order items güncellenemedi:",m)}f.success("Sipariş başarıyla güncellendi"),Q(!1),V(i.status),H==null||H(),Ne()}catch(a){console.error("Update production order error:",a),f.error(a.message||"Sipariş güncellenirken hata oluştu")}finally{fe(!1)}}};[R&&{label:"Sipariş No",value:R},J&&{label:"Oluşturulma",value:w(J)},G&&{label:"Termin",value:w(G)},e.priority!==void 0&&{label:"Öncelik",value:`${e.priority||0} / 5`}].filter(Boolean);const Ge=[{label:"Sipariş No",value:R},{label:"Ürün",value:e.product_name||e.productName||"-"},{label:"Miktar",value:`${e.quantity||0} ${e.unit||"Adet"}`},{label:"Termin Tarihi",value:w(G)},{label:"Öncelik",value:`${e.priority||0} / 5`},{label:"Durum",value:C(e.status)},{label:"Oluşturma Tarihi",value:w(J)},{label:"Son Güncelleme",value:w($e)}];return s.jsx(ms,{open:n,onOpenChange:h,children:s.jsx(us,{className:"!max-w-[100vw] sm:!max-w-[95vw] !w-[100vw] sm:!w-[95vw] !h-[100vh] sm:!h-[90vh] !max-h-[100vh] sm:!max-h-[90vh] !left-0 sm:!left-[2.5vw] !top-0 sm:!top-[5vh] !right-0 sm:!right-auto !bottom-0 sm:!bottom-auto !translate-x-0 !translate-y-0 overflow-hidden !p-0 gap-0 bg-white flex flex-col !m-0 !rounded-none sm:!rounded-lg !border-0 sm:!border",children:s.jsxs("div",{className:"flex flex-col h-full min-h-0",children:[s.jsx(ds,{className:"p-3 sm:p-4 border-b bg-white flex-shrink-0",children:s.jsxs("div",{className:"flex items-center justify-between gap-3",children:[s.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 flex-1 min-w-0",children:[s.jsx("div",{className:"h-8 w-8 sm:h-10 sm:w-10 rounded-lg bg-primary/10 flex items-center justify-center border border-primary/20 flex-shrink-0",children:s.jsx(rs,{className:"h-4 w-4 sm:h-5 sm:w-5 text-primary"})}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsxs(hs,{className:"text-lg sm:text-xl font-semibold text-foreground truncate",children:["Üretim Siparişi - ",R]}),e.product_name||e.productName?s.jsx(os,{className:"text-xs text-muted-foreground truncate mt-0.5",children:e.product_name||e.productName}):null]})]}),s.jsxs("div",{className:"flex flex-wrap items-center gap-2 flex-shrink-0 relative z-10 pr-10 sm:pr-12",children:[s.jsx(De,{variant:Ue(S),className:"text-xs px-2 sm:px-3 py-1 relative z-10",children:C(S)}),K?s.jsxs("div",{className:"flex gap-2",children:[s.jsxs(b,{variant:"outline",size:"sm",onClick:()=>{var t,a,c,m,o,x,j,T,q,B,A,F,P,O,$;if(Q(!1),e){const ae=((a=(t=e.items)==null?void 0:t[0])==null?void 0:a.productId)||((m=(c=e.items)==null?void 0:c[0])==null?void 0:m.product_id)||e.product_id||"",ie=((x=(o=e.items)==null?void 0:o[0])==null?void 0:x.productName)||((T=(j=e.items)==null?void 0:j[0])==null?void 0:T.product_name)||e.product_name||"",ne=e.due_date?e.due_date instanceof Date?e.due_date.toISOString().split("T")[0]:typeof e.due_date=="string"?new Date(e.due_date).toISOString().split("T")[0]:"":"";r({order_number:e.order_number||e.orderNumber||"",product_name:ie,product_id:ae,quantity:((q=e.quantity)==null?void 0:q.toString())||((F=(A=(B=e.items)==null?void 0:B[0])==null?void 0:A.quantity)==null?void 0:F.toString())||"",unit:e.unit||((O=(P=e.items)==null?void 0:P[0])==null?void 0:O.unit)||"Adet",customer_id:e.customer_id||e.customerId||"",customer_name:e.customer_name||e.customerName||"",due_date:ne,priority:(($=e.priority)==null?void 0:$.toString())||"0",status:e.status||"planned",notes:e.notes||"",shipping_address:e.delivery_address||e.shippingAddress||e.shipping_address||"",shipping_notes:e.delivery_notes||e.shippingNotes||e.shipping_notes||""})}},disabled:X,className:"min-h-[44px] sm:min-h-0",children:[s.jsx(He,{className:"h-4 w-4 mr-2"}),"İptal"]}),s.jsx(b,{size:"sm",onClick:t=>{t.preventDefault();const a=document.getElementById("production-order-edit-form");a?a.requestSubmit():_e(t)},disabled:X,className:"min-h-[44px] sm:min-h-0",children:X?s.jsxs(s.Fragment,{children:[s.jsx(we,{className:"h-4 w-4 mr-2 animate-spin"}),"Kaydediliyor..."]}):s.jsxs(s.Fragment,{children:[s.jsx(ys,{className:"h-4 w-4 mr-2"}),"Kaydet"]})})]}):s.jsxs(s.Fragment,{children:[s.jsxs(b,{variant:"outline",size:"sm",onClick:()=>Q(!0),className:"min-h-[44px] sm:min-h-0",children:[s.jsx(js,{className:"h-4 w-4 mr-2"}),"Düzenle"]}),oe&&s.jsxs(b,{variant:"outline",size:"sm",onClick:oe,className:"min-h-[44px] sm:min-h-0 text-destructive hover:text-destructive",children:[s.jsx(Ns,{className:"h-4 w-4 mr-2"}),"Sil"]})]})]})]})}),s.jsx("div",{className:"flex-1 overflow-hidden bg-gray-50/50 p-3 sm:p-4 min-h-0",children:s.jsx("div",{className:"max-w-full mx-auto h-full overflow-y-auto",children:Be?s.jsx("div",{className:"flex items-center justify-center py-8",children:s.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}):K?s.jsx("form",{id:"production-order-edit-form",onSubmit:_e,className:"space-y-4 sm:space-y-6",children:s.jsxs(N,{children:[s.jsx(y,{children:s.jsx(_,{className:"text-lg",children:"Sipariş Bilgileri"})}),s.jsxs(v,{className:"space-y-4 sm:space-y-6",children:[s.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4",children:[s.jsxs("div",{className:"space-y-2",children:[s.jsx(p,{htmlFor:"order_number",showRequired:!0,children:"Sipariş No"}),s.jsx(D,{id:"order_number",value:i.order_number,onChange:t=>r({...i,order_number:t.target.value}),required:!0,className:"min-h-[44px] sm:min-h-0"})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(p,{htmlFor:"status",children:"Durum"}),s.jsxs(le,{value:i.status,onValueChange:t=>r({...i,status:t}),children:[s.jsx(ce,{className:"min-h-[44px] sm:min-h-0",children:s.jsx(me,{})}),s.jsxs(ue,{children:[s.jsx(g,{value:"planned",children:"Planlanan"}),s.jsx(g,{value:"in_production",children:"Üretimde"}),s.jsx(g,{value:"quality_check",children:"Kalite Kontrol"}),s.jsx(g,{value:"completed",children:"Tamamlandı"}),s.jsx(g,{value:"on_hold",children:"Beklemede"})]})]})]})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(p,{htmlFor:"customer_name",children:"Müşteri Adı"}),s.jsx(D,{id:"customer_name",value:i.customer_name,onChange:t=>r({...i,customer_name:t.target.value}),className:"min-h-[44px] sm:min-h-0"})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(p,{htmlFor:"product_name",showRequired:!0,children:"Ürün Adı"}),s.jsxs("div",{className:"space-y-2",children:[s.jsxs(le,{value:i.product_id||"none",onValueChange:Ie,disabled:Z,children:[s.jsx(ce,{className:"min-h-[44px] sm:min-h-0",children:s.jsx(me,{placeholder:Z?"Ürünler yükleniyor...":"Ürün seçin (Opsiyonel)"})}),s.jsxs(ue,{children:[s.jsx(g,{value:"none",children:"Ürün seçmeden devam et"}),I.map(t=>s.jsx(g,{value:t.id,children:t.name},t.id))]})]}),Z&&s.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[s.jsx(we,{className:"h-4 w-4 animate-spin"})," Ürünler yükleniyor..."]}),s.jsx(D,{id:"product_name",placeholder:"Ürün adı girin (dropdown'dan seçebilir veya elle yazabilirsiniz)",value:i.product_name,onChange:t=>Re(t.target.value),required:!0,className:"min-h-[44px] sm:min-h-0"}),i.product_id&&s.jsxs("p",{className:"text-xs text-muted-foreground flex items-center gap-1",children:[s.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-green-500"}),"Dropdown'dan seçili ürün: ",(be=I.find(t=>t.id===i.product_id))==null?void 0:be.name]})]})]}),s.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4",children:[s.jsxs("div",{className:"space-y-2",children:[s.jsx(p,{htmlFor:"quantity",showRequired:!0,children:"Miktar"}),s.jsx(D,{id:"quantity",type:"number",value:i.quantity,onChange:t=>r({...i,quantity:t.target.value}),required:!0,className:"min-h-[44px] sm:min-h-0"})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(p,{htmlFor:"unit",children:"Birim"}),s.jsxs(le,{value:i.unit,onValueChange:t=>r({...i,unit:t}),children:[s.jsx(ce,{className:"min-h-[44px] sm:min-h-0",children:s.jsx(me,{})}),s.jsxs(ue,{children:[s.jsx(g,{value:"Adet",children:"Adet"}),s.jsx(g,{value:"Kg",children:"Kg"}),s.jsx(g,{value:"Lt",children:"Lt"}),s.jsx(g,{value:"Mt",children:"Mt"}),s.jsx(g,{value:"M2",children:"M²"})]})]})]})]}),s.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4",children:[s.jsxs("div",{className:"space-y-2",children:[s.jsx(p,{htmlFor:"due_date",showRequired:!0,children:"Termin Tarihi"}),s.jsx(D,{id:"due_date",type:"date",value:i.due_date,onChange:t=>r({...i,due_date:t.target.value}),required:!0,className:"min-h-[44px] sm:min-h-0"})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(p,{htmlFor:"priority",children:"Öncelik (0-5)"}),s.jsx(D,{id:"priority",type:"number",min:"0",max:"5",value:i.priority,onChange:t=>r({...i,priority:t.target.value}),className:"min-h-[44px] sm:min-h-0"})]})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(p,{htmlFor:"notes",className:"text-sm sm:text-base",children:"Notlar"}),s.jsx(ke,{id:"notes",value:i.notes,onChange:t=>r({...i,notes:t.target.value}),rows:3,className:"min-h-[44px] sm:min-h-0",placeholder:"Sipariş ile ilgili notlar..."})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(p,{className:"text-sm sm:text-base",children:"Teslimat Bilgileri"}),s.jsxs("div",{className:"space-y-2",children:[s.jsxs("div",{className:"space-y-2",children:[s.jsx(p,{htmlFor:"shipping_address",className:"text-xs text-muted-foreground",children:"Teslimat Adresi"}),s.jsx(D,{id:"shipping_address",value:i.shipping_address,onChange:t=>r({...i,shipping_address:t.target.value}),className:"min-h-[44px] sm:min-h-0",placeholder:"Teslimat adresi..."})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(p,{htmlFor:"shipping_notes",className:"text-xs text-muted-foreground",children:"Teslimat Notları"}),s.jsx(ke,{id:"shipping_notes",value:i.shipping_notes,onChange:t=>r({...i,shipping_notes:t.target.value}),rows:2,className:"min-h-[44px] sm:min-h-0",placeholder:"Teslimat ile ilgili notlar..."})]})]})]})]})]})}):s.jsxs("div",{className:"space-y-4 sm:space-y-6",children:[s.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3 sm:gap-4",children:[s.jsxs(N,{className:"bg-gradient-to-br from-blue-50/80 via-white to-white border-blue-100",children:[s.jsx(y,{className:"pb-2",children:s.jsxs(_,{className:"text-xs sm:text-sm font-medium text-muted-foreground flex items-center gap-2",children:[s.jsx(Te,{className:"h-3 w-3 sm:h-4 sm:w-4"}),"Ürün"]})}),s.jsxs(v,{children:[s.jsx("p",{className:"text-lg sm:text-xl font-semibold text-foreground",children:e.product_name||e.productName||"-"}),s.jsxs("p",{className:"text-xs sm:text-sm text-muted-foreground mt-1",children:[e.quantity||0," ",e.unit||"Adet"]})]})]}),s.jsxs(N,{className:"bg-gradient-to-br from-indigo-50/80 via-white to-white border-indigo-100",children:[s.jsx(y,{className:"pb-2",children:s.jsxs(_,{className:"text-xs sm:text-sm font-medium text-muted-foreground flex items-center gap-2",children:[s.jsx(Se,{className:"h-3 w-3 sm:h-4 sm:w-4"}),"Müşteri"]})}),s.jsxs(v,{children:[s.jsx("p",{className:"text-lg sm:text-xl font-semibold text-foreground",children:e.customer_name||e.customerName||"Belirtilmemiş"}),e.customer_company&&s.jsx("p",{className:"text-xs sm:text-sm text-muted-foreground mt-1",children:e.customer_company})]})]}),s.jsxs(N,{className:"bg-gradient-to-br from-slate-50/80 via-white to-white border-slate-100",children:[s.jsx(y,{className:"pb-2",children:s.jsxs(_,{className:"text-xs sm:text-sm font-medium text-muted-foreground flex items-center gap-2",children:[s.jsx(Ye,{className:"h-3 w-3 sm:h-4 sm:w-4"}),"Termin"]})}),s.jsx(v,{children:s.jsx("p",{className:"text-lg sm:text-xl font-semibold text-foreground",children:w(G)})})]}),s.jsxs(N,{className:"bg-gradient-to-br from-emerald-50/80 via-white to-white border-emerald-100",children:[s.jsx(y,{className:"pb-2",children:s.jsxs(_,{className:"text-xs sm:text-sm font-medium text-muted-foreground flex items-center gap-2",children:[s.jsx(qe,{className:"h-3 w-3 sm:h-4 sm:w-4"}),"Öncelik"]})}),s.jsx(v,{children:s.jsxs("p",{className:"text-lg sm:text-xl font-semibold text-foreground",children:[e.priority||0," / 5"]})})]})]}),s.jsxs(N,{children:[s.jsx(y,{className:"space-y-1",children:s.jsxs("div",{className:"flex items-center justify-between gap-3",children:[s.jsxs("div",{children:[s.jsx(_,{className:"text-lg",children:"Sipariş Durumu"}),s.jsx("p",{className:"text-sm text-muted-foreground",children:k()?`${C(S)} aşamasındasınız. Sıradaki adım: ${k().label}`:S==="on_hold"?"Sipariş beklemede.":"Workflow tamamlandı."})]}),s.jsxs("div",{className:"text-xs text-muted-foreground text-right",children:["Son güncelleyen: ",e!=null&&e.statusUpdatedBy?Fe[e.statusUpdatedBy]||e.statusUpdatedBy:(u==null?void 0:u.fullName)||"-",s.jsx("br",{}),s.jsx("span",{className:"text-[11px]",children:e!=null&&e.statusUpdatedAt?w(e.statusUpdatedAt):""})]})]})}),s.jsx(v,{className:"p-3 sm:p-4 md:p-6",children:s.jsxs("div",{className:"space-y-3 sm:space-y-4",children:[s.jsx("div",{className:"flex items-center justify-between overflow-x-auto overflow-y-visible pt-2 pb-4",children:E.map((t,a)=>{const c=t.icon,m=ye(),o=a===m,x=a<m,j=te&&(x||o)&&t.value!=="on_hold";return s.jsxs("div",{className:"flex items-center flex-1 min-w-0",children:[s.jsxs("div",{className:"flex flex-col items-center flex-1 min-w-0",children:[s.jsxs(Qe,{delayDuration:150,children:[s.jsx(Xe,{asChild:!0,children:s.jsx("div",{className:`
                                        w-10 h-10 rounded-full flex items-center justify-center border-2 transition-all relative z-10
                                        ${o?"bg-primary text-primary-foreground border-primary scale-110":""}
                                        ${x?"bg-green-500 text-white border-green-500":""}
                                        ${!o&&!x?"bg-muted border-muted-foreground/20":""}
                                        ${j?"cursor-pointer hover:scale-105":""}
                                      `,onClick:()=>{j&&a<m&&Ke(t.value)},children:s.jsx(c,{className:`h-5 w-5 ${o||x?"text-white":t.color}`})})}),s.jsx(Ze,{children:j&&a<m?`${t.label} durumuna geri dönmek için tıklayın`:t.label})]}),s.jsx("p",{className:`text-xs mt-2 text-center font-medium ${o?"text-primary":x?"text-green-600":"text-muted-foreground"}`,children:t.label})]}),a<E.length-1&&s.jsx("div",{className:`flex-1 h-0.5 mx-2 ${x?"bg-green-500":"bg-muted"}`})]},t.value)})}),k()&&S!=="on_hold"&&s.jsx("div",{className:"flex justify-center pt-4 border-t",children:s.jsx(b,{onClick:()=>Ve(k().value),disabled:ge||!te,className:"gap-2 min-h-[44px] sm:min-h-0",children:ge?s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"Güncelleniyor..."]}):s.jsxs(s.Fragment,{children:[(()=>{const t=k().icon;return s.jsx(t,{className:"h-4 w-4"})})(),k().label," Durumuna Geç"]})})})]})})]}),s.jsxs("div",{className:"grid gap-4 sm:gap-6 grid-cols-1 lg:grid-cols-2",children:[s.jsxs(N,{children:[s.jsxs(y,{className:"space-y-1",children:[s.jsx(_,{className:"text-lg",children:"Müşteri Bilgileri"}),s.jsx("p",{className:"text-sm text-muted-foreground",children:"İletişim detayları"})]}),s.jsxs(v,{className:"space-y-3 sm:space-y-4",children:[s.jsxs("div",{className:"space-y-2 sm:space-y-3",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(Se,{className:"h-4 w-4 text-muted-foreground"}),s.jsx("span",{className:"font-medium",children:(l==null?void 0:l.name)||(e==null?void 0:e.customerName)||(e==null?void 0:e.customer_name)||"-"})]}),((l==null?void 0:l.company)||(e==null?void 0:e.customerCompany)||(e==null?void 0:e.customer_company))&&s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(xs,{className:"h-4 w-4 text-muted-foreground"}),s.jsx("span",{children:(l==null?void 0:l.company)||(e==null?void 0:e.customerCompany)||(e==null?void 0:e.customer_company)})]}),((l==null?void 0:l.phone)||(e==null?void 0:e.customerPhone)||(e==null?void 0:e.customer_phone))&&s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(Je,{className:"h-4 w-4 text-muted-foreground"}),s.jsx("span",{children:es((l==null?void 0:l.phone)||(e==null?void 0:e.customerPhone)||(e==null?void 0:e.customer_phone))})]}),((l==null?void 0:l.email)||(e==null?void 0:e.customerEmail)||(e==null?void 0:e.customer_email))&&s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(ss,{className:"h-4 w-4 text-muted-foreground"}),s.jsx("span",{children:(l==null?void 0:l.email)||(e==null?void 0:e.customerEmail)||(e==null?void 0:e.customer_email)})]})]}),((l==null?void 0:l.phone)||(l==null?void 0:l.email)||(e==null?void 0:e.customerPhone)||(e==null?void 0:e.customerEmail))&&s.jsxs("div",{className:"flex flex-wrap gap-3 pt-1",children:[((l==null?void 0:l.phone)||(e==null?void 0:e.customerPhone)||(e==null?void 0:e.customer_phone))&&s.jsx(b,{variant:"outline",size:"sm",asChild:!0,className:"min-h-[44px] sm:min-h-0",children:s.jsx("a",{href:`tel:${ts((l==null?void 0:l.phone)||(e==null?void 0:e.customerPhone)||(e==null?void 0:e.customer_phone))}`,children:"Ara"})}),((l==null?void 0:l.email)||(e==null?void 0:e.customerEmail)||(e==null?void 0:e.customer_email))&&s.jsx(b,{variant:"outline",size:"sm",asChild:!0,className:"min-h-[44px] sm:min-h-0",children:s.jsx("a",{href:`mailto:${(l==null?void 0:l.email)||(e==null?void 0:e.customerEmail)||(e==null?void 0:e.customer_email)}`,children:"E-posta Gönder"})})]}),(ee||se)&&s.jsxs("div",{className:"space-y-2 rounded-lg border bg-muted/40 p-3 mt-3",children:[s.jsxs("p",{className:"text-sm font-medium text-muted-foreground flex items-center gap-2",children:[s.jsx(_s,{className:"h-4 w-4"}),"Teslimat Bilgileri"]}),ee&&s.jsx("p",{className:"text-sm",children:ee}),se&&s.jsx("p",{className:"text-xs text-muted-foreground",children:se})]})]})]}),s.jsxs(N,{children:[s.jsx(y,{children:s.jsx(_,{className:"text-lg",children:"Sipariş Bilgileri"})}),s.jsxs(v,{className:"space-y-3 sm:space-y-4",children:[s.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4",children:Ge.map(t=>s.jsxs("div",{className:"rounded-lg border bg-muted/30 px-3 py-2",children:[s.jsx("p",{className:"text-xs text-muted-foreground uppercase tracking-wide",children:t.label}),s.jsx("p",{className:"text-sm font-medium mt-1",children:t.value||"-"})]},t.label))}),(e==null?void 0:e.notes)&&s.jsxs("div",{className:"rounded-lg border bg-muted/20 p-3",children:[s.jsxs("p",{className:"text-sm text-muted-foreground mb-1 flex items-center gap-2",children:[s.jsx(vs,{className:"h-4 w-4"}),"İç Not"]}),s.jsx("p",{className:"text-sm leading-relaxed",children:e.notes})]})]})]})]}),s.jsxs(N,{children:[s.jsx(y,{children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs(_,{className:"text-lg sm:text-xl flex items-center gap-2",children:[s.jsx(bs,{className:"h-4 w-4 sm:h-5 sm:w-5"}),"Bağlı Görevler (",Y.length,")"]}),s.jsx(b,{variant:"outline",size:"sm",onClick:Me,disabled:L,className:"min-h-[44px] sm:min-h-0",children:"Yenile"})]})}),s.jsx(v,{children:s.jsxs("div",{className:"space-y-2",children:[L&&s.jsx("p",{className:"text-sm text-muted-foreground",children:"Görevler yükleniyor..."}),!L&&Y.length===0&&s.jsx("p",{className:"text-sm text-muted-foreground",children:"Bu siparişe bağlı görev bulunmuyor."}),!L&&Y.map(t=>{const a=W(t.due_date||t.dueDate);return s.jsx("div",{className:"p-3 rounded-md border border-border bg-muted/30",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-semibold text-foreground",children:t.title||"-"}),a&&s.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["Termin: ",w(a)]})]}),s.jsx(De,{variant:t.status==="completed"?"default":"secondary",children:t.status||"-"})]})},t.id)})]})})]})]})})})]})})})};export{Ps as O};
