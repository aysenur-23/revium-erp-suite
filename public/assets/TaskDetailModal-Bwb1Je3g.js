const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/taskService-CI62TrOj.js","assets/index-BQmY0BmM.js","assets/lucide-react-CAeuRJQk.js","assets/index-YbdY78QJ.css","assets/storageService-BUAGZT8Z.js","assets/driveService-ChwQKMyd.js","assets/toastHelpers-DkuKGmwM.js","assets/permissions-gaCIgPOa.js","assets/rolePermissionsService-BQ7cNajw.js"])))=>i.map(i=>d[i]);
var _a=Object.defineProperty,Fa=Object.defineProperties;var Aa=Object.getOwnPropertyDescriptors;var ft=Object.getOwnPropertySymbols;var Ba=Object.prototype.hasOwnProperty,Ta=Object.prototype.propertyIsEnumerable;var pt=(l,p,v)=>p in l?_a(l,p,{enumerable:!0,configurable:!0,writable:!0,value:v}):l[p]=v,ae=(l,p)=>{for(var v in p||(p={}))Ba.call(p,v)&&pt(l,v,p[v]);if(ft)for(var v of ft(p))Ta.call(p,v)&&pt(l,v,p[v]);return l},re=(l,p)=>Fa(l,Aa(p));var x=(l,p,v)=>new Promise((m,ye)=>{var w=N=>{try{z(v.next(N))}catch(we){ye(we)}},r=N=>{try{z(v.throw(N))}catch(we){ye(we)}},z=N=>N.done?m(N.value):Promise.resolve(N.value).then(w,r);z((v=v.apply(l,p)).next())});import{u as Sa,h as Ra,r as za,a as c,T as Q,j as e,L as C,I as $,S as vt,c as jt,d as bt,e as yt,f as Fe,l as pe,B as u,s as Ga,t as Pa,v as La,C as H,p as K,q as Y,b as I,_ as T}from"./index-BQmY0BmM.js";import{r as n,o as As,P as ve,t as Oa,L as Ma,M as Bs,u as Ae,X as Be,v as Ts,w as Ss,C as wt,m as je,i as as,x as es,y as Va,n as Nt,c as $a,j as kt,z as Dt,T as ss,B as Ha,l as Ka,k as Ya,E as Ia,G as qa,d as Wa,g as Ja,h as Qa}from"./lucide-react-CAeuRJQk.js";import{D as ie,a as le,b as ne,c as ce,e as de,T as be,B as J,t as Te,k as ts,n as Xa}from"./MainLayout-Dv9j77B5.js";import{A as Za,a as Ua}from"./avatar-CROuoa6p.js";import{h as er,c as sr,l as tr,m as ar,n as rr,o as ir,p as lr,q as nr,u as Rs,f as cr,t as dr,r as or,v as mr,w as xr,x as ur,y as hr,z as Et,A as gr,B as fr,C as pr,D as vr,E as zs,F as Ct,G as jr,H as _t,I as br,J as yr,e as wr,K as Nr}from"./taskService-CI62TrOj.js";import{canViewTask as kr,canEditTask as Dr,canInteractWithTask as Er}from"./permissions-gaCIgPOa.js";import{O as Cr}from"./OrderDetailModal-BnPVxs_W.js";import{P as _r}from"./progress-DCzQFBA2.js";import{U as Ft}from"./UserMultiSelect-BycFT8u0.js";import{f as Se}from"./format-CN3feEER.js";const oe=[{value:"pending",label:"Yapılacak",icon:Ja,color:"text-amber-500"},{value:"in_progress",label:"Devam Ediyor",icon:Qa,color:"text-blue-500"},{value:"completed",label:"Tamamlandı",icon:as,color:"text-emerald-600"},{value:"approved",label:"Onaylandı",icon:as,color:"text-green-600"}],Re=l=>{if(!l)return"-";let p;return l instanceof Q?p=l.toDate():l instanceof Date?p=l:p=new Date(l),Number.isNaN(p.getTime())?"-":p.toLocaleDateString("tr-TR",{day:"2-digit",month:"short",year:"numeric"})},Kr=({taskId:l,open:p,onOpenChange:v,onUpdate:m,initialStatus:ye="pending",projectId:w})=>{var ut,ht,gt;const{user:r,isAdmin:z,isSuperAdmin:N,isTeamLeader:we}=Sa(),At=Ra(),[t,ze]=n.useState(null),[S,Bt]=n.useState([]),[Gs,Ps]=n.useState(!0),[L,Tt]=n.useState(null),[St,Ge]=n.useState(!1),[Rt,Pe]=n.useState(!1),[zt,Le]=n.useState(!1),[me,rs]=n.useState(""),[Oe,is]=n.useState(""),[G,ls]=n.useState(""),[Me,ns]=n.useState(null),[D,E]=n.useState(!1),[Ls,Os]=n.useState(!1),[U,Ms]=n.useState(""),[xe,Ve]=n.useState({}),[Gt,Pt]=n.useState([]),[Fr,O]=n.useState(!1),Lt=n.useRef(null),[Ot,Vs]=n.useState(!1),[$s,Mt]=n.useState(null),[Hs,Ks]=n.useState(!1);n.useState(null);const[Vt,cs]=n.useState(!1),[Ar,$t]=n.useState("file"),[ue,ds]=n.useState(""),[$e,os]=n.useState(""),[Ys,ms]=n.useState(!1),[Is,He]=n.useState(!1),[qs,Ke]=n.useState(!1),[Ws,Ye]=n.useState(!1),[xs,us]=n.useState(""),[Ie,hs]=n.useState(""),[Js,Ht]=n.useState("#61BD4F"),[gs,fs]=n.useState([]),[M,ps]=n.useState(""),[ee,X]=n.useState(!1),[Kt,Yt]=n.useState([]),[Br,It]=n.useState([]);n.useState(""),n.useState(!1),n.useState(!0);const[qe,vs]=n.useState(""),[Qs,js]=n.useState(""),[bs,ys]=n.useState([]),[Z,he]=n.useState([]),[ge,Ne]=n.useState(""),[We,Je]=n.useState([]),[ws,Qe]=n.useState(""),[Xs,Ns]=n.useState("#61BD4F"),[ks,Ds]=n.useState(""),[_,Xe]=n.useState(w||null),[se,ke]=n.useState(!1),[F,P]=n.useState([]),[A,De]=n.useState(!1),[qt,Es]=n.useState(!1),[te,Cs]=n.useState(!1),[q,_s]=n.useState(!1),Zs=n.useRef(null),Us=n.useRef(null),et=n.useRef(null),st=n.useRef(null),tt=n.useRef(null),Wt=n.useRef(null),at=[{name:"green",value:"#61BD4F",class:"bg-[#61BD4F]"},{name:"yellow",value:"#F2D600",class:"bg-[#F2D600]"},{name:"orange",value:"#FF9F1A",class:"bg-[#FF9F1A]"},{name:"red",value:"#EB5A46",class:"bg-[#EB5A46]"},{name:"purple",value:"#C377E0",class:"bg-[#C377E0]"},{name:"blue",value:"#0079BF",class:"bg-[#0079BF]"},{name:"sky",value:"#00C2E0",class:"bg-[#00C2E0]"},{name:"lime",value:"#51E898",class:"bg-[#51E898]"},{name:"pink",value:"#FF78CB",class:"bg-[#FF78CB]"},{name:"black",value:"#344563",class:"bg-[#344563]"}],Ee=s=>{var a;(a=s.current)==null||a.scrollIntoView({behavior:"smooth",block:"start"})};n.useEffect(()=>{p&&l?j():p&&!l&&(vs(""),js(""),ys([]),he([]),Ne(""),Je([]),Qe(""),Ns("#61BD4F"),Ds(""),Xe(w||null),ke(!1),Ps(!1))},[p,l]),n.useEffect(()=>{p&&x(void 0,null,function*(){try{const{getProjects:a,getProjectById:i}=yield T(()=>x(void 0,null,function*(){const{getProjects:o,getProjectById:h}=yield import("./taskService-CI62TrOj.js").then(y=>y.V);return{getProjects:o,getProjectById:h}}),__vite__mapDeps([0,1,2,3]));if(w&&!l)try{const o=yield i(w);if(o.isPrivate){if(z||N){P([o]);return}if(r!=null&&r.id&&o.createdBy===r.id){P([o]);return}if(r!=null&&r.id)try{const{getTasks:h,getTaskAssignments:y}=yield T(()=>x(void 0,null,function*(){const{getTasks:b,getTaskAssignments:V}=yield import("./taskService-CI62TrOj.js").then(g=>g.W);return{getTasks:b,getTaskAssignments:V}}),__vite__mapDeps([0,1,2,3])),R=yield h({projectId:w});for(const b of R){if(b.createdBy===r.id){P([o]);return}if(b.assignedUsers&&b.assignedUsers.includes(r.id)){P([o]);return}if((yield y(b.id)).some(k=>k.assignedTo===r.id&&(k.status==="accepted"||k.status==="pending"))){P([o]);return}}}catch(h){console.error("Error checking project tasks:",h)}P([]);return}else{P([o]);return}}catch(o){console.error("Proje yüklenemedi",o),P([]);return}const d=yield a({status:"active"});if(w&&!l){const o=d.find(h=>h.id===w);if(o!=null&&o.isPrivate){P([o]);return}}const f=yield Promise.all(d.map(o=>x(void 0,null,function*(){if(w&&!l){const h=d.find(y=>y.id===w);if(h!=null&&h.isPrivate&&o.isPrivate&&o.id!==w)return null}if(!o.isPrivate||N||r!=null&&r.id&&o.createdBy===r.id)return o;if(r!=null&&r.id)try{const{getTasks:h,getTaskAssignments:y}=yield T(()=>x(void 0,null,function*(){const{getTasks:b,getTaskAssignments:V}=yield import("./taskService-CI62TrOj.js").then(g=>g.W);return{getTasks:b,getTaskAssignments:V}}),__vite__mapDeps([0,1,2,3])),R=yield h({projectId:o.id});for(const b of R)if(b.createdBy===r.id||b.assignedUsers&&b.assignedUsers.includes(r.id)||(yield y(b.id)).some(k=>k.assignedTo===r.id&&(k.status==="accepted"||k.status==="pending")))return o}catch(h){console.error("Error checking project tasks:",h)}return null})));P(f.filter(o=>o!==null))}catch(a){console.error("Projeler yüklenemedi",a)}})},[p,l,z,N,r==null?void 0:r.id,w]),n.useEffect(()=>{se&&p&&!l&&x(void 0,null,function*(){try{const{getProjects:a}=yield T(()=>x(void 0,null,function*(){const{getProjects:f}=yield import("./taskService-CI62TrOj.js").then(o=>o.V);return{getProjects:f}}),__vite__mapDeps([0,1,2,3])),i=yield a({status:"active"}),d=yield Promise.all(i.map(f=>x(void 0,null,function*(){if(!f.isPrivate)return null;if(N||r!=null&&r.id&&f.createdBy===r.id)return f;if(r!=null&&r.id)try{const{getTasks:o,getTaskAssignments:h}=yield T(()=>x(void 0,null,function*(){const{getTasks:R,getTaskAssignments:b}=yield import("./taskService-CI62TrOj.js").then(V=>V.W);return{getTasks:R,getTaskAssignments:b}}),__vite__mapDeps([0,1,2,3])),y=yield o({projectId:f.id});for(const R of y)if(R.createdBy===r.id||R.assignedUsers&&R.assignedUsers.includes(r.id)||(yield h(R.id)).some(g=>g.assignedTo===r.id&&(g.status==="accepted"||g.status==="pending")))return f}catch(o){console.error("Error checking project tasks:",o)}return null})));P(d.filter(f=>f!==null))}catch(a){console.error("Projeler yüklenemedi",a)}})},[se,p,l,z,N,r==null?void 0:r.id]),n.useEffect(()=>{if(!l&&F.length>0){const s=_||w;if(s){const a=F.find(i=>i.id===s);a!=null&&a.isPrivate&&ke(!0)}}},[_,w,F,l]);const j=()=>x(void 0,null,function*(){try{const[s,a,i,d,f,o,h]=yield Promise.all([er(l),sr(l),za(),tr(l).catch(()=>[]),ar(l).catch(()=>[]),rr(l).catch(()=>[]),ir(l).catch(()=>[])]);if(!s){c.error("Görev bulunamadı");return}let y=[];if(s.labels)if(typeof s.labels=="string")try{const g=JSON.parse(s.labels);y=Array.isArray(g)?g:[]}catch(g){y=[]}else Array.isArray(s.labels)&&(y=s.labels.map(g=>typeof g=="string"?{name:g,color:"#61BD4F"}:g));const R=re(ae({},s),{labels:y,attachments:h,checklists:o,createdBy:s.createdBy,approvalStatus:s.approvalStatus,due_date:s.dueDate?s.dueDate instanceof Q?s.dueDate.toDate().toISOString():new Date(s.dueDate).toISOString():null,created_at:s.createdAt instanceof Q?s.createdAt.toDate().toISOString():new Date(s.createdAt).toISOString()});ze(R),us(s.description||""),ps(s.dueDate?(s.dueDate instanceof Q?s.dueDate.toDate():new Date(s.dueDate)).toISOString().split("T")[0]:"");const b=a.map(g=>{const k=i.find(Ca=>Ca.id===g.assignedTo);return{id:g.assignedTo,assignment_id:g.id,full_name:(k==null?void 0:k.fullName)||(k==null?void 0:k.displayName)||"",email:(k==null?void 0:k.email)||"",accepted_at:g.acceptedAt?g.acceptedAt instanceof Q?g.acceptedAt.toDate().toISOString():new Date(g.acceptedAt).toISOString():null,completed_at:g.completedAt?g.completedAt instanceof Q?g.completedAt.toDate().toISOString():new Date(g.completedAt).toISOString():null,status:g.status,rejection_reason:g.rejectionReason||null,assigned_by:g.assignedBy||null}});Bt(b),fs(b.map(g=>g.id));const V=b.find(g=>g.id===(r==null?void 0:r.id));Tt(V||null),Ve({}),Yt(d),It(f),Pt(o),yield rt(s,b.map(g=>g.id))}catch(s){console.error("Fetch task details error:",s),c.error(s.message||"Görev detayları yüklenirken hata oluştu")}finally{Ps(!1)}}),rt=(s,a)=>x(void 0,null,function*(){if(!s||!r){Es(!1),Cs(!1),_s(!1);return}try{const i=r,[d,f,o]=yield Promise.all([kr(s,i,a),Dr(s,i),Er(s,i,a)]);Es(d),Cs(f),_s(o)}catch(i){console.error("Error checking permissions:",i),Es(!1),Cs(!1),_s(!1)}});n.useEffect(()=>{if(t&&r){const s=S.map(a=>a.id);rt(t,s)}},[t,r,S]);const it=()=>x(void 0,null,function*(){if(t!=null&&t.production_order_id){Ks(!0);try{const s=yield Xa(t.production_order_id);s?(Mt(s),Vs(!0)):c.error("Sipariş bulunamadı")}catch(s){console.error("Get order detail error:",s),c.error(s.message||"Sipariş detayları alınamadı")}finally{Ks(!1)}}}),fe=s=>({pending:"Yapılacak",in_progress:"Devam Ediyor",completed:"Tamamlandı",approved:"Onaylandı",cancelled:"Yapılacak"})[s]||s,[B,Ze]=n.useState((t==null?void 0:t.status)||ye||"pending"),[Ue,W]=n.useState(!1),[Ce,Tr]=n.useState({}),Fs=()=>{if(B==="completed"&&(t==null?void 0:t.approvalStatus)==="approved")return 3;if(B==="completed")return 2;const s=B==="cancelled"?"pending":B,a=oe.findIndex(i=>i.value===s);return a===-1?0:a},_e=()=>{const s=Fs();return s===-1||s>=oe.length-1?null:oe[s+1]},Jt=(s,a)=>({pending:"in_progress",in_progress:"completed"})[s]===a,Qt=s=>x(void 0,null,function*(){if(!(!l||!(r!=null&&r.id))){if(!Jt(B,s)){c.error(`Geçersiz durum geçişi: ${fe(B)} → ${fe(s)}`);return}W(!0);try{yield Rs(l,s),Ze(s),c.success(`Görev durumu ${fe(s)} olarak güncellendi.`),yield j(),m==null||m()}catch(a){console.error("Task status update error:",a),c.error("Durum güncellenemedi: "+((a==null?void 0:a.message)||"Bilinmeyen hata"))}finally{W(!1)}}}),Xt=()=>x(void 0,null,function*(){if(!(!l||!(r!=null&&r.id))){W(!0);try{yield cr(l,r.id),c.success("Görev onay için yöneticiye gönderildi."),yield j(),m==null||m()}catch(s){console.error("Request approval error:",s),c.error("Onay isteği gönderilemedi: "+((s==null?void 0:s.message)||"Bilinmeyen hata"))}finally{W(!1)}}}),Zt=s=>x(void 0,null,function*(){if(!(!l||!(r!=null&&r.id))){if(!z&&!N){c.error("Sadece yöneticiler durumu geri alabilir.");return}W(!0);try{const a=Fs();if((t==null?void 0:t.approvalStatus)==="pending"){c.error("Onay bekleyen görevler geri alınamaz."),W(!1);return}if(s==="approved"){yield Rs(l,"completed");const{updateTask:i}=yield T(()=>x(void 0,null,function*(){const{updateTask:d}=yield import("./taskService-CI62TrOj.js").then(f=>f.W);return{updateTask:d}}),__vite__mapDeps([0,1,2,3]));yield i(l,{approvalStatus:null},r.id),Ze("completed"),c.success("Görev durumu Tamamlandı olarak geri alındı.")}else{const i=oe.findIndex(f=>f.value===s);if(i===-1){c.error("Geçersiz durum."),W(!1);return}if(i>=a){c.error("Sadece önceki durumlara geri alabilirsiniz."),W(!1);return}const d=oe[i];yield Rs(l,d.value),Ze(d.value),c.success(`Görev durumu ${d.label} olarak geri alındı.`)}yield j(),m==null||m()}catch(a){console.error("Revert status error:",a),c.error("Durum geri alınamadı: "+((a==null?void 0:a.message)||"Bilinmeyen hata"))}finally{W(!1)}}});n.useEffect(()=>{t!=null&&t.status&&Ze(t.status)},[t==null?void 0:t.status]);const Ut=()=>x(void 0,null,function*(){if(L){E(!0);try{yield dr(l,L.assignment_id),c.success("Görev kabul edildi"),j(),m==null||m()}catch(s){console.error("Accept task error:",s),c.error(s.message||"Görev kabul edilemedi")}finally{E(!1)}}}),ea=()=>x(void 0,null,function*(){if(!L||!me.trim()||me.trim().length<20){c.error("Reddetme sebebi en az 20 karakter olmalıdır");return}E(!0);try{yield or(l,L.assignment_id,me.trim()),c.success("Görev reddedildi"),Ge(!1),rs(""),j(),m==null||m()}catch(s){console.error("Reject task error:",s),c.error(s.message||"Görev reddedilemedi")}finally{E(!1)}}),sa=()=>x(void 0,null,function*(){if(!l){c.error("Görev bulunamadı");return}if(!ue.trim()||!$e.trim()){c.error("Lütfen Drive linki ve isim girin");return}if(!/^https:\/\/(drive\.google\.com|docs\.google\.com)/.test(ue.trim())){c.error("Geçerli bir Google Drive linki girin");return}Os(!0);try{yield mr(l,{name:$e.trim(),url:ue.trim(),size:0,type:"drive_link",attachmentType:"drive_link",driveLink:ue.trim(),uploadedBy:(r==null?void 0:r.id)||""}),c.success("Drive linki eklendi"),cs(!1),ds(""),os(""),$t("file"),j()}catch(a){c.error(a.message||"Drive linki eklenirken hata oluştu")}finally{Os(!1)}}),ta=s=>x(void 0,null,function*(){try{const{deleteFile:a}=yield T(()=>x(void 0,null,function*(){const{deleteFile:i}=yield import("./storageService-BUAGZT8Z.js");return{deleteFile:i}}),__vite__mapDeps([4,1,2,3,5]));s.storageProvider==="google_drive"&&s.driveFileId?yield a(s.url,{provider:"google_drive",fileId:s.driveFileId}):s.attachmentType!=="drive_link"&&(yield a(s.url)),yield xr(l,s.id),c.success("Dosya silindi"),j()}catch(a){c.error(a.message||"Dosya silinirken hata oluştu")}}),aa=()=>x(void 0,null,function*(){if(!(!(r!=null&&r.id)||!l)){E(!0);try{yield ur(l,r.id),c.success("Görev onaylandı ve kapatıldı"),yield j(),m==null||m()}catch(s){console.error("Approve task error:",s),c.error(s.message||"Görev onaylanamadı")}finally{E(!1)}}}),ra=()=>x(void 0,null,function*(){!(r!=null&&r.id)||!l||Pe(!0)}),ia=()=>x(void 0,null,function*(){if(!(!(r!=null&&r.id)||!l)){if(!Oe.trim()){c.error("Lütfen reddetme nedeni girin");return}E(!0);try{yield hr(l,r.id,Oe.trim()),c.success("Görev onayı reddedildi ve görev panoya döndü"),Pe(!1),is(""),yield j(),m==null||m()}catch(s){console.error("Reject task approval error:",s),c.error(s.message||"Görev onayı reddedilemedi")}finally{E(!1)}}}),lt=()=>x(void 0,null,function*(){if(!(!U.trim()||!r)){if(!q){const{showPermissionErrorToast:s}=yield T(()=>x(void 0,null,function*(){const{showPermissionErrorToast:a}=yield import("./toastHelpers-DkuKGmwM.js");return{showPermissionErrorToast:a}}),__vite__mapDeps([6,1,2,3,0]));s("create","checklist");return}O(!0);try{const s=xe[U]?xe[U].split(`
`).filter(a=>a.trim()):[];yield Et(l,U.trim(),s.map(a=>({text:a.trim()}))),c.success("Checklist eklendi"),Ms(""),Ve({}),yield j()}catch(s){console.error("Add checklist error:",s),c.error(s.message||"Checklist eklenemedi")}finally{O(!1)}}}),la=s=>x(void 0,null,function*(){if(!q){const{showPermissionErrorToast:a}=yield T(()=>x(void 0,null,function*(){const{showPermissionErrorToast:i}=yield import("./toastHelpers-DkuKGmwM.js");return{showPermissionErrorToast:i}}),__vite__mapDeps([6,1,2,3,0]));a("delete","checklist");return}O(!0);try{yield gr(l,s),c.success("Checklist silindi"),yield j()}catch(a){console.error("Delete checklist error:",a),c.error(a.message||"Checklist silinemedi")}finally{O(!1)}}),nt=s=>x(void 0,null,function*(){var i;const a=(i=xe[s])==null?void 0:i.trim();if(a){if(!q){const{showPermissionErrorToast:d}=yield T(()=>x(void 0,null,function*(){const{showPermissionErrorToast:f}=yield import("./toastHelpers-DkuKGmwM.js");return{showPermissionErrorToast:f}}),__vite__mapDeps([6,1,2,3,0]));d("create","checklist");return}O(!0);try{yield fr(l,s,a),c.success("Checklist öğesi eklendi"),Ve(d=>re(ae({},d),{[s]:""})),yield j()}catch(d){console.error("Add checklist item error:",d),c.error(d.message||"Checklist öğesi eklenemedi")}finally{O(!1)}}}),na=(s,a,i)=>x(void 0,null,function*(){if(!(!l||!(r!=null&&r.id))){if(!q){const{showPermissionErrorToast:d}=yield T(()=>x(void 0,null,function*(){const{showPermissionErrorToast:f}=yield import("./toastHelpers-DkuKGmwM.js");return{showPermissionErrorToast:f}}),__vite__mapDeps([6,1,2,3,0]));d("interact","checklist");return}O(!0);try{yield pr(l,s,a,i,r.id),yield j()}catch(d){console.error("Toggle checklist item error:",d),c.error(d.message||"Checklist öğesi güncellenemedi")}finally{O(!1)}}}),ca=(s,a)=>x(void 0,null,function*(){if(!q){const{showPermissionErrorToast:i}=yield T(()=>x(void 0,null,function*(){const{showPermissionErrorToast:d}=yield import("./toastHelpers-DkuKGmwM.js");return{showPermissionErrorToast:d}}),__vite__mapDeps([6,1,2,3,0]));i("delete","checklist");return}O(!0);try{yield vr(l,s,a),c.success("Checklist öğesi silindi"),yield j()}catch(i){console.error("Delete checklist item error:",i),c.error(i.message||"Checklist öğesi silinemedi")}finally{O(!1)}}),da=s=>s.split(" ").map(a=>a[0]).join("").toUpperCase().slice(0,2),oa=()=>x(void 0,null,function*(){X(!0);try{yield zs(l,{description:xs||null}),c.success("Açıklama güncellendi"),ze(re(ae({},t),{description:xs})),ms(!1),m==null||m()}catch(s){console.error("Update description error:",s),c.error(s.message||"Açıklama güncellenemedi")}finally{X(!1)}}),ct=()=>{if(!Ie.trim())return;const s=(t==null?void 0:t.labels)||[],a={name:Ie.trim(),color:Js},i=[...s,a];dt(i),hs("")},ma=s=>{const i=((t==null?void 0:t.labels)||[]).filter(d=>d.name!==s);dt(i)},dt=s=>x(void 0,null,function*(){X(!0);try{const a=s.map(i=>i.name);yield zs(l,{labels:a}),S.length>0&&r&&(yield Promise.all(S.filter(i=>i.id!==r.id&&i.status==="accepted").map(i=>Ct({userId:i.id,type:"task_updated",title:"Görev güncellendi",message:`${r.fullName||r.email||"Bir kullanıcı"} "${t==null?void 0:t.title}" görevinin etiketlerini güncelledi.`,read:!1,relatedId:l})))),c.success("Etiketler güncellendi"),ze(re(ae({},t),{labels:s})),He(!1),m==null||m()}catch(a){console.error("Update labels error:",a),c.error(a.message||"Etiketler güncellenemedi")}finally{X(!1)}}),xa=()=>x(void 0,null,function*(){if(r){try{const{canPerformSubPermission:s}=yield T(()=>x(void 0,null,function*(){const{canPerformSubPermission:d}=yield import("./permissions-gaCIgPOa.js");return{canPerformSubPermission:d}}),__vite__mapDeps([7,8,1,2,3])),a={id:r.id,email:r.email,emailVerified:r.emailVerified,fullName:r.fullName,displayName:r.fullName,phone:r.phone,dateOfBirth:r.dateOfBirth,role:r.roles||[],createdAt:null,updatedAt:null};if(!(yield s(a,"tasks","canAssign"))&&!z&&!N){c.error("Görev atama yetkiniz yok");return}}catch(s){console.error("Permission check error:",s)}X(!0);try{const s=S.map(d=>d.id),a=gs.filter(d=>!s.includes(d)),i=s.filter(d=>!gs.includes(d));for(const d of i){const f=S.find(o=>o.id===d);f&&(yield jr(l,f.assignment_id,r.id))}for(const d of a)yield _t(l,d,r.id);c.success("Üyeler güncellendi"),j(),Ke(!1),m==null||m()}catch(s){console.error("Assign members error:",s),c.error(s.message||"Üyeler güncellenemedi")}finally{X(!1)}}}),ua=()=>x(void 0,null,function*(){X(!0);try{const s=M?Q.fromDate(new Date(M)):null;yield zs(l,{dueDate:s}),r&&(yield br(l,r.id,"updated",`bu kartın bitiş tarihini ${M?Se(new Date(M),"d MMM yyyy HH:mm",{locale:Te}):"kaldırdı"} olarak ayarladı`,{field:"dueDate",oldValue:t.due_date,newValue:M},r.fullName,r.email)),S.length>0&&r&&(yield Promise.all(S.filter(a=>a.id!==r.id&&a.status==="accepted").map(a=>Ct({userId:a.id,type:"task_updated",title:"Görev güncellendi",message:`${r.fullName||r.email||"Bir kullanıcı"} "${t==null?void 0:t.title}" görevinin bitiş tarihini ${M?Se(new Date(M),"d MMM yyyy HH:mm",{locale:Te}):"kaldırdı"}.`,read:!1,relatedId:l})))),c.success("Tarih güncellendi"),ze(re(ae({},t),{due_date:M?`${M}T00:00:00.000Z`:null})),Ye(!1),j(),m==null||m()}catch(s){console.error("Update due date error:",s),c.error(s.message||"Tarih güncellenemedi")}finally{X(!1)}}),ha=()=>{Ke(!0),Ee(tt)},ga=()=>{He(!0),Ee(Zs)},fa=()=>{Ee(st)},pa=()=>{Ye(!0),Ee(Us)},va=()=>{Ee(et),setTimeout(()=>{var s;return(s=Lt.current)==null?void 0:s.click()},180)},ot=()=>{c.info("Sipariş bağlama özelliği üzerinde çalışıyoruz.")},ja=()=>{j(),c.success("Kart güncellendi")},ba=()=>x(void 0,null,function*(){if(!(!(r!=null&&r.id)||!l)){E(!0);try{t!=null&&t.is_archived?(yield yr(l,r.id),c.success("Görev arşivden çıkarıldı")):(yield wr(l,r.id),c.success("Görev arşivlendi")),yield j(),m==null||m()}catch(s){console.error("Archive task error:",s),c.error(s.message||"Görev arşivlenemedi")}finally{E(!1)}}}),ya=()=>{c.info("Silme işlemi için görev listesi üzerinden ilerleyin.")},wa=()=>x(void 0,null,function*(){if(!qe.trim()||!r){c.error("Görev başlığı gereklidir");return}De(!0);try{let s=_||w||null,a=se;if(s){const h=F.find(y=>y.id===s);h!=null&&h.isPrivate&&(se||(a=!0))}if(a){if(!s){c.error("Gizli görevler için bir gizli proje seçmelisiniz. Lütfen önce bir gizli proje oluşturun."),De(!1);return}const h=F.find(y=>y.id===s);if(h&&!h.isPrivate){c.error("Gizli görevler sadece gizli projelere atanabilir. Lütfen bir gizli proje seçin."),De(!1);return}}if((!s||s==="general")&&!se){c.error("Lütfen bir proje seçin. Her görevin bir projesi olmalıdır."),De(!1);return}const i=We.map(h=>h.name),d=ks?Q.fromDate(new Date(ks)):null,o=(yield Nr({title:qe.trim(),description:Qs.trim()||null,status:ye,priority:2,dueDate:d,labels:i.length>0?i:null,projectId:s||null,isPrivate:a,productionOrderId:null,productionProcessId:null,createdBy:r.id})).id;if(bs.length>0)try{yield Promise.all(bs.map(h=>_t(o,h,r.id)))}catch(h){console.error("Assignment error:",h)}if(Z.length>0)try{yield Et(o,"Checklist",Z)}catch(h){console.error("Checklist creation error:",h)}c.success("Görev oluşturuldu"),vs(""),js(""),ys([]),he([]),Ne(""),Je([]),Qe(""),Ns("#61BD4F"),Ds(""),Xe(w||null),ke(!1),m==null||m(),v(!1)}catch(s){console.error("Create task error:",s),c.error(s.message||"Görev oluşturulamadı")}finally{De(!1)}}),mt=()=>{const s=ws.trim();if(s){if(We.some(a=>a.name.toLowerCase()===s.toLowerCase())){c.info("Bu etiket zaten ekli");return}Je(a=>[...a,{name:s,color:Xs}]),Qe("")}},Na=s=>{Je(a=>a.filter(i=>i.name!==s))},ka=[{id:"members",title:"Üye Ekle",description:"Göreve kişi ata",icon:Ts,accent:"bg-[#E8F5FF] text-[#0B69C6]",action:ha},{id:"labels",title:"Etiketler",description:"Renklerle kategorize et",icon:Ss,accent:"bg-[#FFF5D9] text-[#D39B00]",action:ga},{id:"checklist",title:"Checklist",description:"Adım adım ilerle",icon:Ae,accent:"bg-[#EBF8F2] text-[#1B7F5D]",action:fa},{id:"dates",title:"Tarih",description:"Termin planla",icon:wt,accent:"bg-[#F5EBFF] text-[#6F2DBD]",action:pa},{id:"attachments",title:"Ek",description:"Dosya paylaş",icon:es,accent:"bg-[#FFEDEA] text-[#C13828]",action:va}];if(Gs&&l)return e.jsx(ie,{open:p,onOpenChange:v,children:e.jsxs(le,{children:[e.jsxs(ne,{className:"sr-only",children:[e.jsx(ce,{children:"Görev yükleniyor"}),e.jsx(de,{children:"Görev detayları hazırlanıyor"})]}),e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary"})})]})});if(!l)return e.jsx(ie,{open:p,onOpenChange:v,children:e.jsx(le,{className:"!max-w-[100vw] sm:!max-w-[95vw] !w-[100vw] sm:!w-[95vw] !h-[100vh] sm:!h-[90vh] !max-h-[100vh] sm:!max-h-[90vh] !left-0 sm:!left-[2.5vw] !top-0 sm:!top-[5vh] !right-0 sm:!right-auto !bottom-0 sm:!bottom-auto !translate-x-0 !translate-y-0 overflow-hidden !p-0 gap-0 bg-white flex flex-col !m-0 !rounded-none sm:!rounded-lg !border-0 sm:!border","data-task-modal":!0,children:e.jsxs("div",{className:"flex flex-col h-full min-h-0",children:[e.jsxs(ne,{className:"p-3 sm:p-4 border-b bg-white flex-shrink-0",children:[e.jsx(ce,{className:"text-lg sm:text-xl font-semibold text-foreground",children:"Yeni Görev Oluştur"}),e.jsx(de,{className:"sr-only",children:"Yeni görev oluşturmak için formu doldurun"})]}),e.jsx("div",{className:"flex-1 overflow-hidden bg-gray-50/50 p-3 sm:p-4 min-h-0",children:e.jsx("div",{className:"max-w-full mx-auto h-full overflow-y-auto",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs(C,{className:"text-sm sm:text-base font-bold text-[#172B4D] flex items-center gap-2 sm:gap-3",children:[e.jsx(As,{className:"h-4 w-4 sm:h-5 sm:w-5 text-[#0079BF]"}),"Görev Başlığı ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx($,{placeholder:"Örn: Yeni özellik geliştir...",value:qe,onChange:s=>vs(s.target.value),className:"h-11 sm:h-12 bg-white border-2 border-[#DFE1E6] text-[#172B4D] text-base focus:border-[#0079BF] focus:ring-2 focus:ring-[#0079BF]/20",disabled:A,autoFocus:!0})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 sm:gap-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs(C,{className:"text-sm sm:text-base font-bold text-[#172B4D] flex items-center gap-2 sm:gap-3",children:[e.jsx(As,{className:"h-4 w-4 sm:h-5 sm:w-5 text-[#0079BF]"}),"Proje ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsxs(vt,{value:_||"",onValueChange:s=>{if(s==="__create_project__"){At("/projects"),v(!1);return}Xe(s);const a=F.find(i=>i.id===s);a!=null&&a.isPrivate&&ke(!0)},disabled:A,children:[e.jsx(jt,{className:"h-11 sm:h-12 border-2 border-[#DFE1E6] bg-white",children:e.jsx(bt,{placeholder:"Proje seçiniz"})}),e.jsxs(yt,{children:[(()=>{const s=_?F.find(i=>i.id===_):null;let a=F;return se?a=F.filter(i=>i.isPrivate):s!=null&&s.isPrivate&&(a=F.filter(i=>i.isPrivate)),a.map(i=>e.jsx(Fe,{value:i.id,children:i.name},i.id))})(),e.jsx("div",{className:"border-t border-border mt-1 pt-1",children:e.jsxs(Fe,{value:"__create_project__",className:"text-primary font-medium cursor-pointer",children:[e.jsx(ve,{className:"h-4 w-4 mr-2 inline"}),"Yeni Proje Ekle"]})})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs(C,{className:"text-sm sm:text-base font-bold text-[#172B4D] flex items-center gap-2 sm:gap-3",children:[e.jsx(Oa,{className:"h-4 w-4 sm:h-5 sm:w-5 text-[#0079BF]"}),"Gizlilik"]}),e.jsx("div",{className:"flex items-center gap-3 h-12 px-4 border-2 border-[#DFE1E6] rounded-md bg-white",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",id:"private-task",checked:se,disabled:A||_&&((ut=F.find(s=>s.id===_))==null?void 0:ut.isPrivate),onChange:s=>{const a=_?F.find(i=>i.id===_):null;a!=null&&a.isPrivate||(ke(s.target.checked),s.target.checked&&_&&!(a!=null&&a.isPrivate)&&Xe(null))},className:"h-4 w-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),e.jsxs(C,{htmlFor:"private-task",className:pe("text-sm font-medium text-gray-700 flex items-center gap-2",_&&((ht=F.find(s=>s.id===_))!=null&&ht.isPrivate)?"cursor-default":"cursor-pointer"),children:[e.jsx(Ma,{className:"h-4 w-4 text-gray-500"}),"Sadece atanan kişiler görebilir"]})]})})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs(C,{className:"text-base font-bold text-[#172B4D] flex items-center gap-3",children:[e.jsx(Bs,{className:"h-5 w-5 text-[#0079BF]"}),"Açıklama"]}),e.jsx(be,{placeholder:"Görev hakkında detaylı bilgi ekleyin...",value:Qs,onChange:s=>js(s.target.value),rows:5,disabled:A,className:"bg-white border-2 border-[#DFE1E6] text-[#172B4D] resize-none text-base focus:border-[#0079BF] focus:ring-2 focus:ring-[#0079BF]/20"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs(C,{className:"text-base font-bold text-[#172B4D] flex items-center gap-3",children:[e.jsx(Ae,{className:"h-5 w-5 text-[#0079BF]"}),"Kontrol Listesi"]}),Z.length>0&&e.jsx("div",{className:"space-y-3 bg-[#F4F5F7] rounded-xl p-5 border-2 border-[#DFE1E6]",children:Z.map((s,a)=>e.jsxs("div",{className:"flex items-center gap-4 text-sm group p-3 rounded-lg hover:bg-white/50 transition-colors",children:[e.jsx("input",{type:"checkbox",checked:s.completed,onChange:i=>{const d=[...Z];d[a].completed=i.target.checked,he(d)},className:"w-5 h-5 rounded border-2 border-[#DFE1E6] text-[#0079BF] cursor-pointer focus:ring-2 focus:ring-[#0079BF]/20"}),e.jsx("span",{className:pe("flex-1 text-base",s.completed?"line-through text-[#5E6C84]":"text-[#172B4D] font-medium"),children:s.text}),e.jsx("button",{type:"button",onClick:()=>{he(Z.filter((i,d)=>d!==a))},className:"opacity-0 group-hover:opacity-100 text-[#5E6C84] hover:text-[#EB5A46] transition-opacity p-2 rounded-lg hover:bg-[#EB5A46]/10",children:e.jsx(Be,{className:"h-4 w-4"})})]},a))}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx($,{placeholder:"Yeni madde ekle...",value:ge,onChange:s=>Ne(s.target.value),onKeyDown:s=>{s.key==="Enter"&&ge.trim()&&(s.preventDefault(),he([...Z,{text:ge.trim(),completed:!1}]),Ne(""))},disabled:A,className:"flex-1 h-12 border-2 border-[#DFE1E6] focus:border-[#0079BF] focus:ring-2 focus:ring-[#0079BF]/20"}),e.jsx(u,{type:"button",size:"sm",onClick:()=>{ge.trim()&&(he([...Z,{text:ge.trim(),completed:!1}]),Ne(""))},disabled:A||!ge.trim(),className:"h-12 px-6 bg-[#0079BF] hover:bg-[#005A8B] text-white font-semibold shadow-md hover:shadow-lg transition-all",children:e.jsx(ve,{className:"h-5 w-5"})})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs(C,{className:"text-base font-bold text-[#172B4D] flex items-center gap-3",children:[e.jsx(Ts,{className:"h-5 w-5 text-[#0079BF]"}),"Kişi Ata"]}),e.jsx("div",{className:"border-2 border-[#DFE1E6] rounded-xl p-4 bg-white shadow-sm",children:e.jsx(Ft,{selectedUsers:bs,onSelectionChange:ys})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs(C,{className:"text-base font-bold text-[#172B4D] flex items-center gap-3",children:[e.jsx(Ss,{className:"h-5 w-5 text-[#0079BF]"}),"Etiketler"]}),We.length>0&&e.jsx("div",{className:"flex flex-wrap gap-3",children:We.map((s,a)=>e.jsxs("div",{className:"flex items-center gap-2 px-4 py-2 rounded-full text-sm font-semibold text-white cursor-pointer hover:opacity-90 transition-opacity shadow-md",style:{backgroundColor:s.color},onClick:()=>Na(s.name),children:[e.jsx("span",{children:s.name}),e.jsx(Be,{className:"h-3.5 w-3.5"})]},a))}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx($,{value:ws,onChange:s=>Qe(s.target.value),placeholder:"Etiket adı girin...",className:"flex-1 h-12 border-2 border-[#DFE1E6] focus:border-[#0079BF] focus:ring-2 focus:ring-[#0079BF]/20",onKeyDown:s=>{s.key==="Enter"&&(s.preventDefault(),mt())},disabled:A}),e.jsx(u,{type:"button",onClick:mt,size:"sm",disabled:!ws.trim()||A,className:"h-12 px-6 bg-[#0079BF] hover:bg-[#005A8B] text-white font-semibold shadow-md hover:shadow-lg transition-all",children:"Ekle"})]}),e.jsx("div",{className:"flex flex-wrap gap-3",children:at.map(s=>e.jsx("button",{onClick:()=>Ns(s.value),className:pe("w-10 h-10 rounded-xl border-2 transition-all hover:scale-110 shadow-sm",s.class,Xs===s.value?"border-[#172B4D] scale-110 ring-2 ring-[#0079BF] ring-offset-2":"border-[#DFE1E6] hover:border-[#C1C7D0]"),title:s.name,disabled:A},s.name))})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs(C,{className:"text-base font-bold text-[#172B4D] flex items-center gap-3",children:[e.jsx(wt,{className:"h-5 w-5 text-[#0079BF]"}),"Bitiş Tarihi"]}),e.jsx($,{type:"date",value:ks,onChange:s=>Ds(s.target.value),className:"h-12 border-2 border-[#DFE1E6] focus:border-[#0079BF] focus:ring-2 focus:ring-[#0079BF]/20",disabled:A})]}),e.jsxs("div",{className:"flex items-center gap-4 pt-6 border-t-2 border-[#DFE1E6]",children:[e.jsx(u,{onClick:wa,disabled:A||!qe.trim(),className:"bg-[#0079BF] hover:bg-[#005A8B] text-white flex-1 font-bold h-14 text-base shadow-lg hover:shadow-xl transition-all disabled:opacity-50",children:A?e.jsxs(e.Fragment,{children:[e.jsx(je,{className:"h-5 w-5 animate-spin mr-3"}),"Oluşturuluyor..."]}):e.jsxs(e.Fragment,{children:[e.jsx(as,{className:"h-5 w-5 mr-3"}),"Görev Oluştur"]})}),e.jsx(u,{variant:"outline",onClick:()=>v(!1),disabled:A,className:"h-14 px-8 border-2 border-[#DFE1E6] text-[#172B4D] hover:bg-[#F4F5F7] hover:border-[#0079BF] font-semibold transition-all",children:"İptal"})]})]})})})]})})});if(!t)return null;if(!qt)return c.error("Bu görevi görüntüleme yetkiniz yok"),v(!1),null;const Da=[{label:"Atanan Kişiler",value:S.length||0,icon:Ts,helper:"Göreve atanan kullanıcı",accent:"from-blue-50/80 via-white to-white border-blue-100",tooltip:"Bu göreve atanan toplam kullanıcı sayısı"},{label:"Checklist",value:Gt.length||0,icon:Ae,helper:"Kontrol listesi sayısı",accent:"from-indigo-50/80 via-white to-white border-indigo-100",tooltip:"Göreve eklenmiş kontrol listeleri"},{label:"Dosyalar",value:((gt=t==null?void 0:t.attachments)==null?void 0:gt.length)||0,icon:es,helper:"Eklenen dosya sayısı",accent:"from-slate-50/80 via-white to-white border-slate-100",tooltip:"Göreve eklenmiş toplam dosya sayısı"},{label:"Yorumlar",value:Kt.length||0,icon:Bs,helper:"Yorum sayısı",accent:"from-emerald-50/80 via-white to-white border-emerald-100",tooltip:"Göreve eklenmiş toplam yorum sayısı"}],xt=[(t==null?void 0:t.id)&&{label:"Görev ID",value:t.id.substring(0,8)},(t==null?void 0:t.created_at)&&{label:"Oluşturulma",value:Re(new Date(t.created_at))},(t==null?void 0:t.due_date)&&{label:"Termin",value:Re(new Date(t.due_date))},(t==null?void 0:t.priority)&&{label:"Öncelik",value:t.priority.toString()}].filter(Boolean),Ea=s=>{switch(s){case"pending":return"secondary";case"in_progress":return"default";case"completed":return"default";default:return"outline"}};return e.jsxs(e.Fragment,{children:[e.jsx(ie,{open:p,onOpenChange:v,children:e.jsx(le,{className:"!max-w-[100vw] sm:!max-w-[95vw] !w-[100vw] sm:!w-[95vw] !h-[100vh] sm:!h-[90vh] !max-h-[100vh] sm:!max-h-[90vh] !left-0 sm:!left-[2.5vw] !top-0 sm:!top-[5vh] !right-0 sm:!right-auto !bottom-0 sm:!bottom-auto !translate-x-0 !translate-y-0 overflow-hidden !p-0 gap-0 bg-white flex flex-col !m-0 !rounded-none sm:!rounded-lg !border-0 sm:!border","aria-describedby":"task-detail-description","data-task-modal":!0,children:e.jsxs("div",{className:"flex flex-col h-full min-h-0",children:[e.jsx(ne,{className:"p-3 sm:p-4 border-b bg-white flex-shrink-0",children:e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 flex-1 min-w-0",children:[e.jsx("div",{className:"h-8 w-8 sm:h-10 sm:w-10 rounded-lg bg-primary/10 flex items-center justify-center border border-primary/20 flex-shrink-0",children:e.jsx(Va,{className:"h-4 w-4 sm:h-5 sm:w-5 text-primary"})}),e.jsxs(ce,{className:"text-lg sm:text-xl font-semibold text-foreground truncate",children:["Görev Detayı - ",(t==null?void 0:t.title)||"Yeni Görev"]}),e.jsx(de,{className:"sr-only",id:"task-detail-description",children:"Görev detayları ve bilgileri"})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 flex-shrink-0 relative z-10 pr-10 sm:pr-12",children:[(t==null?void 0:t.approvalStatus)==="pending"&&e.jsx(J,{variant:"outline",className:"border-yellow-500 text-yellow-600 bg-yellow-50 text-xs px-2 sm:px-3 py-1 relative z-10",children:"Onay Bekliyor"}),t&&e.jsx(J,{variant:Ea(t.status),className:"text-xs px-2 sm:px-3 py-1 relative z-10",children:fe(t.status)}),(t==null?void 0:t.priority)&&e.jsxs(J,{variant:t.priority>=3?"destructive":"secondary",className:"text-xs px-2 sm:px-3 py-1 relative z-10",children:["Öncelik ",t.priority]})]})]})}),xt.length>0&&e.jsx("div",{className:"px-3 sm:px-6 py-2 sm:py-3 border-b bg-gray-50/50 flex flex-wrap items-center gap-2 flex-shrink-0",children:xt.map(s=>e.jsxs("div",{className:"flex items-center gap-1 rounded-full border bg-muted/40 px-3 py-1.5 text-xs font-medium text-muted-foreground",children:[e.jsxs("span",{className:"text-muted-foreground/70",children:[s.label,":"]}),e.jsx("span",{className:"text-foreground",children:s.value})]},`${s.label}-${s.value}`))}),e.jsx("div",{className:"flex-1 overflow-hidden bg-gray-50/50 p-3 sm:p-4 min-h-0",children:e.jsx("div",{className:"max-w-full mx-auto h-full overflow-y-auto",children:Gs?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}):e.jsxs("div",{className:"space-y-6",children:[(t==null?void 0:t.approvalStatus)==="pending"&&r&&((t.createdBy||t.created_by)===r.id||z||N||we)&&e.jsx("div",{className:"p-4 bg-yellow-50 border border-yellow-200 rounded-lg",children:e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-semibold text-yellow-900",children:"Görev Tamamlanma Onayı Bekliyor"}),e.jsx("p",{className:"text-sm text-yellow-700",children:"Bu görev tamamlandı olarak işaretlendi ve onayınızı bekliyor."})]}),e.jsxs("div",{className:"flex gap-2 w-full sm:w-auto",children:[e.jsxs(u,{size:"sm",variant:"outline",className:"flex-1 sm:flex-none border-yellow-300 text-yellow-900 hover:bg-yellow-100",onClick:ra,disabled:D,children:[e.jsx(Be,{className:"h-4 w-4 mr-1"}),"Reddet"]}),e.jsxs(u,{size:"sm",className:"flex-1 sm:flex-none bg-yellow-600 hover:bg-yellow-700 text-white border-none",onClick:aa,disabled:D,children:[e.jsx(Nt,{className:"h-4 w-4 mr-1"}),"Onayla"]})]})]})}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-4 gap-4 auto-rows-fr",children:Da.map(s=>{const a=s.icon;return e.jsxs(Ga,{delayDuration:150,children:[e.jsx(Pa,{asChild:!0,children:e.jsxs("div",{className:`rounded-2xl border bg-gradient-to-br text-card-foreground p-4 shadow-sm transition hover:shadow-md hover:-translate-y-0.5 h-full ${s.accent}`,children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase tracking-wide text-muted-foreground",children:s.label}),e.jsx("p",{className:"text-2xl font-semibold mt-1 leading-tight",children:s.value})]}),e.jsx("div",{className:"rounded-full border p-2 bg-white/75 shadow-inner shrink-0",children:e.jsx(a,{className:"h-5 w-5 text-primary"})})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-3",children:s.helper})]})}),e.jsx(La,{children:s.tooltip})]},s.label)})}),e.jsxs(H,{children:[e.jsx(K,{className:"space-y-1",children:e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx(Y,{className:"text-lg",children:"Görev Durumu"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:(()=>{if(B==="completed"&&(t==null?void 0:t.approvalStatus)==="approved")return"Görev onaylandı ve tamamlandı.";if(B==="completed"&&(t==null?void 0:t.approvalStatus)==="pending")return"Görev tamamlandı ve onay bekleniyor.";if(B==="completed")return"Görev tamamlandı. Onaya göndermek için butona tıklayın.";const s=B==="cancelled"?"pending":B,a=_e();return a?`${fe(s)} aşamasındasınız. Sıradaki adım: ${a.label}`:"Workflow tamamlandı."})()})]}),e.jsxs("div",{className:"text-xs text-muted-foreground text-right",children:["Son güncelleyen: ",t!=null&&t.statusUpdatedBy?Ce[t.statusUpdatedBy]||t.statusUpdatedBy:(r==null?void 0:r.fullName)||"-",e.jsx("br",{}),e.jsx("span",{className:"text-[11px]",children:t!=null&&t.statusUpdatedAt?Re(t.statusUpdatedAt):""})]})]})}),e.jsx(I,{className:"p-4 sm:p-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex items-center justify-between overflow-x-auto overflow-y-visible pt-2 pb-4",children:oe.map((s,a)=>{const i=s.icon,d=Fs(),f=a===d,o=a<d,h=(z||N)&&a<d&&(t==null?void 0:t.approvalStatus)!=="pending";return e.jsxs("div",{className:"flex items-center flex-1 min-w-0",children:[e.jsxs("div",{className:"flex flex-col items-center flex-1 min-w-0",children:[e.jsx("div",{onClick:h?()=>Zt(s.value):void 0,className:`
                                      w-10 h-10 rounded-full flex items-center justify-center border-2 transition-all relative z-10
                                      ${f?"bg-primary text-primary-foreground border-primary scale-110":""}
                                      ${o?"bg-green-500 text-white border-green-500":""}
                                      ${!f&&!o?"bg-muted border-muted-foreground/20":""}
                                      ${h?"cursor-pointer hover:scale-110 hover:shadow-md":""}
                                    `,title:h?`${s.label} durumuna geri al`:void 0,children:e.jsx(i,{className:`h-5 w-5 ${f||o?"text-white":s.color}`})}),e.jsx("p",{className:`text-xs mt-2 text-center font-medium ${f?"text-primary":o?"text-green-600":"text-muted-foreground"}`,children:s.label})]}),a<oe.length-1&&e.jsx("div",{className:`flex-1 h-0.5 mx-2 ${o?"bg-green-500":"bg-muted"}`})]},s.value)})}),B==="completed"&&(t==null?void 0:t.approvalStatus)==="approved"?null:B==="completed"&&(t==null?void 0:t.approvalStatus)!=="pending"&&(t==null?void 0:t.approvalStatus)!=="approved"?e.jsx("div",{className:"flex justify-center pt-4 border-t",children:e.jsx(u,{onClick:Xt,disabled:Ue,className:"gap-2",children:Ue?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"Gönderiliyor..."]}):e.jsxs(e.Fragment,{children:[e.jsx($a,{className:"h-4 w-4"}),"Onaya Gönder"]})})}):_e()&&(t==null?void 0:t.approvalStatus)!=="pending"&&(t==null?void 0:t.approvalStatus)!=="approved"?e.jsx("div",{className:"flex justify-center pt-4 border-t",children:e.jsx(u,{onClick:()=>Qt(_e().value),disabled:Ue,className:"gap-2",children:Ue?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"Güncelleniyor..."]}):e.jsxs(e.Fragment,{children:[(()=>{const s=_e().icon;return e.jsx(s,{className:"h-4 w-4"})})(),_e().label," Durumuna Geç"]})})}):null,(t==null?void 0:t.approvalStatus)==="rejected"&&(t==null?void 0:t.rejectionReason)&&e.jsx("div",{className:"mt-4 pt-4 border-t",children:e.jsx("div",{className:"p-3 bg-red-50 border border-red-200 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(kt,{className:"h-4 w-4 text-red-600 mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-semibold text-red-900 mb-1",children:"Görev Onayı Reddedildi"}),e.jsx("p",{className:"text-sm text-red-800 whitespace-pre-wrap",children:t.rejectionReason}),t.rejectedBy&&Ce[t.rejectedBy]&&e.jsxs("p",{className:"text-xs text-red-700 mt-2",children:["Reddeden: ",Ce[t.rejectedBy],t.rejectedAt&&e.jsxs("span",{className:"ml-2",children:["• ",Re(t.rejectedAt)]})]})]})]})})})]})})]}),e.jsxs("div",{className:"grid gap-6 lg:grid-cols-2",children:[e.jsxs(H,{ref:Wt,children:[e.jsx(K,{className:"space-y-1",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(Y,{className:"text-lg",children:"Açıklama"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Görev detayları ve notlar"})]}),!Ys&&te&&e.jsxs(u,{variant:"outline",size:"sm",onClick:()=>ms(!0),className:"w-full sm:w-auto",children:[e.jsx(ve,{className:"h-4 w-4 mr-1"}),"Düzenle"]})]})}),e.jsx(I,{className:"space-y-4",children:Ys?e.jsxs("div",{className:"space-y-3",children:[e.jsx(be,{value:xs,onChange:s=>us(s.target.value),placeholder:"Açıklama ekleyin...",rows:6,className:"resize-none"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(u,{size:"sm",onClick:oa,disabled:ee,className:"flex-1 sm:flex-none",children:ee?e.jsx(je,{className:"h-4 w-4 animate-spin"}):"Kaydet"}),e.jsx(u,{size:"sm",variant:"outline",onClick:()=>{ms(!1),us(t.description||"")},children:"İptal"})]})]}):t.description?e.jsx("p",{className:"text-sm whitespace-pre-wrap leading-relaxed",children:t.description}):e.jsx("div",{className:"text-sm text-muted-foreground border border-dashed rounded-lg p-6 text-center bg-muted/30",children:"Henüz açıklama eklenmemiş."})})]}),e.jsxs(H,{children:[e.jsx(K,{className:"space-y-1",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs(Y,{className:"text-lg flex items-center gap-2",children:[e.jsx(Ss,{className:"h-4 w-4"}),"Etiketler"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Görevi kategorize etmek için etiketler"})]}),!Is&&te&&e.jsxs(u,{variant:"outline",size:"sm",onClick:()=>He(!0),children:[e.jsx(ve,{className:"h-4 w-4 mr-1"}),"Düzenle"]})]})}),e.jsx(I,{className:"space-y-4",children:e.jsx("div",{ref:Zs,children:Is?e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex flex-wrap gap-2.5 mb-4",children:t.labels&&t.labels.length>0?t.labels.map((s,a)=>e.jsxs("div",{className:"flex items-center gap-1.5 px-2.5 py-1 rounded-full text-xs font-semibold text-white cursor-pointer hover:opacity-90 transition-opacity",style:{backgroundColor:s.color||"#475569"},onClick:()=>ma(s.name),children:[e.jsx("span",{children:s.name}),e.jsx(Be,{className:"h-3 w-3"})]},`${s.name}-${a}`)):e.jsx("p",{className:"text-sm text-[#5E6C84]",children:"Etiket bulunmuyor."})}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex gap-3",children:[e.jsx($,{value:Ie,onChange:s=>hs(s.target.value),placeholder:"Etiket adı girin...",className:"flex-1 text-sm bg-white border-[#DFE1E6] text-[#172B4D] h-10",onKeyDown:s=>{s.key==="Enter"&&(s.preventDefault(),ct())}}),e.jsx(u,{type:"button",onClick:ct,size:"sm",disabled:!Ie.trim()||ee,className:"bg-[#0079BF] hover:bg-[#005A8B] text-white font-medium h-10 px-4 disabled:opacity-50 disabled:cursor-not-allowed",children:"Ekle"})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:at.map(s=>e.jsx("button",{onClick:()=>Ht(s.value),className:pe("w-8 h-8 rounded border-2 transition-all hover:scale-110",s.class,Js===s.value?"border-[#172B4D] scale-110 ring-2 ring-[#0079BF]":"border-[#DFE1E6] hover:border-[#C1C7D0]"),title:s.name},s.name))})]}),e.jsx("div",{className:"flex gap-2",children:e.jsx(u,{size:"sm",variant:"outline",onClick:()=>{He(!1),hs("")},className:"border-[#DFE1E6] text-[#172B4D] hover:bg-[#F4F5F7] font-medium",children:"Kapat"})})]}):e.jsx("div",{className:"flex flex-wrap gap-2.5",children:t.labels&&t.labels.length>0?t.labels.map((s,a)=>e.jsx("span",{className:"px-4 py-1.5 rounded-full text-xs font-semibold text-white shadow-sm",style:{backgroundColor:s.color||"#475569"},children:s.name},`${s.name}-${a}`)):e.jsx("p",{className:"text-sm text-muted-foreground italic",children:"Etiket bulunmuyor."})})})})]})]}),e.jsxs(H,{ref:et,children:[e.jsx(K,{className:"space-y-1",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsx("div",{children:e.jsxs(Y,{className:"text-lg flex items-center gap-2",children:[e.jsx(es,{className:"h-4 w-4"}),"Ekler"]})})})}),e.jsx(I,{className:"space-y-4",children:t.attachments&&t.attachments.length>0?t.attachments.map(s=>e.jsxs("div",{className:"flex items-center justify-between rounded-xl border border-[#DFE1E6] bg-[#F4F5F7] px-4 py-3 gap-4 hover:bg-[#EBECF0] transition-colors",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"text-sm font-medium text-[#172B4D] truncate",children:s.name}),(s.attachmentType==="drive_link"||s.storageProvider==="google_drive")&&e.jsxs(J,{variant:"outline",className:"text-xs",children:[e.jsx(Dt,{className:"h-3 w-3 mr-1"}),"Drive"]})]}),e.jsxs("p",{className:"text-xs text-[#5E6C84]",children:[s.uploadedAt?Se(s.uploadedAt instanceof Q?s.uploadedAt.toDate():new Date(s.uploadedAt),"dd MMM yyyy, HH:mm",{locale:Te}):"",s.size&&s.size>0&&` • ${(s.size/1024).toFixed(1)} KB`]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("a",{href:s.driveLink||s.url,target:"_blank",rel:"noopener noreferrer",download:s.storageProvider==="google_drive"||s.attachmentType==="drive_link"?void 0:s.name,children:e.jsx(u,{size:"sm",variant:"secondary",className:"bg-white border-[#DFE1E6] text-[#172B4D] hover:bg-[#F4F5F7] font-medium",children:s.storageProvider==="google_drive"||s.attachmentType==="drive_link"?"Aç":"İndir"})}),te&&e.jsx(u,{size:"sm",variant:"ghost",className:"text-[#EB5A46] hover:text-[#C9372C] hover:bg-[#EB5A46]/10",onClick:()=>ta(s),children:e.jsx(ss,{className:"h-4 w-4"})})]})]},s.id)):e.jsxs("div",{className:"text-center py-8 text-muted-foreground text-sm rounded-lg border border-dashed bg-muted/30",children:[e.jsx(es,{className:"h-8 w-8 mx-auto mb-2 text-muted-foreground/50"}),e.jsx("p",{children:"Henüz dosya eklenmemiş"})]})})]}),e.jsxs(H,{children:[e.jsx(K,{className:"space-y-1",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsxs(Y,{className:"text-lg flex items-center gap-2",children:[e.jsx(Ae,{className:"h-4 w-4"}),"Checklistler"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Görev için kontrol listeleri"})]})})}),e.jsxs(I,{children:[e.jsx("div",{ref:st,className:"space-y-4",children:q&&e.jsxs("div",{className:"flex gap-3 flex-1 sm:flex-none",children:[e.jsx($,{value:U,onChange:s=>Ms(s.target.value),placeholder:"Yeni checklist başlığı",className:"flex-1 bg-white border-[#DFE1E6] text-[#172B4D] h-10",onKeyDown:s=>{s.key==="Enter"&&U.trim()&&lt()}}),e.jsxs(u,{size:"sm",onClick:lt,disabled:!U.trim(),className:"gap-1 bg-[#0079BF] hover:bg-[#005A8B] text-white font-medium h-10 px-4 disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(ve,{className:"h-4 w-4"}),"Ekle"]})]})}),e.jsx("div",{className:"space-y-4",children:t.checklists&&t.checklists.length>0?t.checklists.map(s=>{var a;return e.jsxs("div",{className:"border border-[#DFE1E6] rounded-xl p-5 space-y-4 bg-[#F4F5F7] shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm text-[#172B4D]",children:s.title}),e.jsxs("p",{className:"text-xs text-[#5E6C84]",children:[s.completed_items||0,"/",s.total_items||0," tamamlandı"]}),s.total_items?e.jsx(_r,{value:s.total_items>0?(s.completed_items||0)/s.total_items*100:0,className:"h-2 mt-2"}):null]}),q&&e.jsx(u,{variant:"ghost",size:"icon",className:"text-[#5E6C84] hover:text-[#172B4D] hover:bg-white",onClick:()=>la(s.id),children:e.jsx(ss,{className:"h-4 w-4"})})]}),e.jsx("div",{className:"space-y-2.5",children:s.items&&s.items.length>0?s.items.map(i=>e.jsxs("div",{className:"flex items-center gap-3 text-sm p-2.5 rounded-lg hover:bg-white/50 transition-colors",children:[e.jsx("input",{type:"checkbox",checked:!!i.completed,onChange:d=>na(s.id,i.id,d.target.checked),className:"h-4 w-4 accent-[#0079BF] cursor-pointer"}),e.jsx("span",{className:pe("flex-1",i.completed?"line-through text-[#5E6C84]":"text-[#172B4D]"),children:i.text||i.title}),q&&e.jsx(u,{variant:"ghost",size:"icon",className:"h-7 w-7 text-[#5E6C84] hover:text-red-600 hover:bg-red-50",onClick:()=>ca(s.id,i.id),children:e.jsx(ss,{className:"h-3.5 w-3.5"})})]},i.id)):e.jsx("p",{className:"text-xs text-[#5E6C84] italic py-2",children:"Henüz öğe yok."})}),q&&e.jsxs("div",{className:"flex gap-3 pt-2 border-t border-[#DFE1E6]",children:[e.jsx($,{value:xe[s.id]||"",onChange:i=>Ve(d=>re(ae({},d),{[s.id]:i.target.value})),placeholder:"Öğe ekle",className:"flex-1 bg-white border-[#DFE1E6] text-[#172B4D] h-10",onKeyDown:i=>{var d;i.key==="Enter"&&((d=xe[s.id])!=null&&d.trim())&&nt(s.id)}}),e.jsx(u,{size:"sm",variant:"secondary",onClick:()=>nt(s.id),disabled:!((a=xe[s.id])!=null&&a.trim()),className:"bg-white border-[#DFE1E6] text-[#172B4D] hover:bg-[#F4F5F7] font-medium h-10 px-4 disabled:opacity-50 disabled:cursor-not-allowed",children:"Ekle"})]})]},s.id)}):e.jsxs("div",{className:"text-center py-8 text-[#5E6C84] text-sm rounded-xl border border-dashed border-[#DFE1E6] bg-[#F4F5F7]",children:[e.jsx(Ae,{className:"h-8 w-8 mx-auto mb-2 text-[#A5ADBA]"}),e.jsx("p",{children:"Herhangi bir checklist bulunmuyor"})]})})]})]}),L&&L.status==="pending"&&e.jsxs("div",{className:"rounded-2xl border-2 border-blue-200 bg-gradient-to-br from-blue-50 to-blue-100/50 p-6 space-y-4 shadow-sm",children:[e.jsx("div",{className:"font-semibold text-blue-700 text-base",children:"Size Atanan Görev"}),e.jsx("p",{className:"text-sm text-[#172B4D] leading-relaxed",children:"Bu görev size atanmış. Lütfen kabul edin veya reddedin."}),e.jsxs("div",{className:"flex gap-3 flex-wrap",children:[e.jsxs(u,{onClick:Ut,disabled:D,className:"flex-1 bg-emerald-500 hover:bg-emerald-600 text-white font-medium h-11 disabled:opacity-50 disabled:cursor-not-allowed shadow-sm",children:[e.jsx(Nt,{className:"h-4 w-4 mr-2"}),D?"İşleniyor...":"Kabul Et"]}),e.jsxs(u,{variant:"destructive",onClick:()=>Ge(!0),disabled:D,className:"flex-1 font-medium h-11 disabled:opacity-50 disabled:cursor-not-allowed shadow-sm",children:[e.jsx(Be,{className:"h-4 w-4 mr-2"}),"Reddet"]})]})]}),L&&L.status==="rejected"&&L.rejection_reason&&e.jsxs("div",{className:"rounded-2xl border-2 border-red-200 bg-gradient-to-br from-red-50 to-red-100/50 p-6 space-y-3 shadow-sm",children:[e.jsx("div",{className:"font-semibold text-red-700 text-base",children:"Görev Reddedildi"}),e.jsxs("p",{className:"text-sm text-[#172B4D] leading-relaxed",children:[e.jsx("strong",{children:"Reddetme Sebebi:"})," ",L.rejection_reason]})]}),e.jsxs("div",{className:"grid gap-6 lg:grid-cols-2",children:[e.jsxs(H,{ref:tt,children:[e.jsx(K,{className:"space-y-1",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(Y,{className:"text-lg",children:"Görevdeki Kişiler"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Atanan kullanıcılar ve durumları"})]}),!qs&&te&&e.jsxs(u,{variant:"outline",size:"sm",onClick:()=>Ke(!0),className:"w-full sm:w-auto",children:[e.jsx(ve,{className:"h-4 w-4 mr-1"}),"Düzenle"]})]})}),e.jsx(I,{className:"space-y-4",children:qs?e.jsxs("div",{className:"space-y-4",children:[e.jsx(Ft,{selectedUsers:gs,onSelectionChange:fs}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(u,{size:"sm",onClick:xa,disabled:ee,className:"bg-[#0079BF] hover:bg-[#005A8B] text-white font-medium h-10 px-4 disabled:opacity-50 disabled:cursor-not-allowed",children:ee?e.jsx(je,{className:"h-4 w-4 animate-spin"}):"Kaydet"}),e.jsx(u,{size:"sm",variant:"outline",onClick:()=>{Ke(!1),fs(S.map(s=>s.id))},className:"border-[#DFE1E6] text-[#172B4D] hover:bg-[#F4F5F7] font-medium h-10 px-4",children:"İptal"})]})]}):e.jsxs("div",{className:"space-y-3",children:[S.map(s=>e.jsxs("div",{className:"flex items-center gap-4 p-4 rounded-xl border border-[#DFE1E6] bg-[#F4F5F7] hover:bg-[#EBECF0] transition-colors shadow-sm",children:[e.jsx(Za,{children:e.jsx(Ua,{className:"bg-white text-[#172B4D]",children:da(s.full_name)})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium text-[#172B4D]",children:s.full_name}),e.jsx("div",{className:"text-sm text-[#5E6C84]",children:s.email}),s.rejection_reason&&e.jsxs("div",{className:"text-xs text-red-600 mt-1",children:["Reddetme sebebi: ",s.rejection_reason]})]}),s.status==="accepted"&&s.completed_at&&e.jsx(J,{variant:"default",className:"bg-emerald-500 text-white font-medium",children:"Tamamlandı"}),s.status==="accepted"&&!s.completed_at&&e.jsx(J,{variant:"secondary",className:"bg-[#EBECF0] text-[#172B4D] font-medium",children:"Kabul Edildi"}),s.status==="rejected"&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(J,{variant:"destructive",className:"font-medium",children:"Reddedildi"}),s.assigned_by===(r==null?void 0:r.id)&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(u,{size:"sm",variant:"default",className:"h-7 text-xs",onClick:()=>x(void 0,null,function*(){if(!(!l||!s.assignment_id)){E(!0);try{yield lr(l,s.assignment_id),c.success("Görev reddi onaylandı"),yield j(),m==null||m()}catch(a){c.error(a.message||"Red onaylanamadı")}finally{E(!1)}}}),disabled:D,children:[e.jsx(as,{className:"h-3 w-3 mr-1"}),"Reddi Kabul Et"]}),e.jsxs(u,{size:"sm",variant:"outline",className:"h-7 text-xs",onClick:()=>{ns(s),Le(!0)},disabled:D,children:[e.jsx(Ha,{className:"h-3 w-3 mr-1"}),"Reddi Reddet"]})]})]}),s.status==="pending"&&e.jsx(J,{variant:"outline",className:"text-[#172B4D] border-[#DFE1E6] font-medium",children:"Bekliyor"})]},s.id)),S.length===0&&e.jsxs("div",{className:"text-center py-8 text-[#5E6C84] text-sm rounded-xl border border-dashed border-[#DFE1E6] bg-[#F4F5F7]",children:[e.jsx(Ka,{className:"h-8 w-8 mx-auto mb-2 text-[#A5ADBA]"}),e.jsx("p",{children:"Henüz kimse atanmadı"})]})]})})]}),e.jsxs(H,{ref:Us,children:[e.jsx(K,{className:"space-y-1",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(Y,{className:"text-lg",children:"Detaylar"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Tarih ve durum bilgileri"})]}),!Ws&&te&&e.jsxs(u,{variant:"ghost",size:"sm",onClick:()=>Ye(!0),className:"text-[#5E6C84] hover:text-[#172B4D] h-6 px-2 text-xs",children:[e.jsx(Ya,{className:"h-3 w-3 mr-1"}),"Düzenle"]})]})}),e.jsxs(I,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"rounded-lg border bg-muted/30 px-3 py-2",children:[e.jsx("p",{className:"text-xs text-muted-foreground uppercase tracking-wide",children:"Oluşturulma"}),e.jsx("p",{className:"text-sm font-medium mt-1",children:Se(new Date(t.created_at),"dd MMM yyyy HH:mm",{locale:Te})})]}),e.jsxs("div",{className:"rounded-lg border bg-muted/30 px-3 py-2",children:[e.jsx("p",{className:"text-xs text-muted-foreground uppercase tracking-wide",children:"Bitiş"}),Ws?e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx($,{type:"date",value:M,onChange:s=>ps(s.target.value),className:"flex-1 h-8 text-xs"}),e.jsx(u,{size:"sm",onClick:ua,disabled:ee,className:"h-8 px-2",children:ee?e.jsx(je,{className:"h-3 w-3 animate-spin"}):"✓"}),e.jsx(u,{size:"sm",variant:"ghost",onClick:()=>{Ye(!1),ps(t.due_date?t.due_date.split("T")[0]:"")},className:"h-8 px-2",children:"✕"})]}):e.jsx("p",{className:"text-sm font-medium mt-1",children:t.due_date?Se(new Date(t.due_date),"dd MMM yyyy HH:mm",{locale:Te}):"-"})]}),e.jsxs("div",{className:"rounded-lg border bg-muted/30 px-3 py-2",children:[e.jsx("p",{className:"text-xs text-muted-foreground uppercase tracking-wide",children:"Durum"}),e.jsx("p",{className:"text-sm font-medium mt-1",children:fe(t.status)})]})]}),(t==null?void 0:t.approvalStatus)==="rejected"&&(t==null?void 0:t.rejectionReason)&&e.jsx("div",{className:"mt-4 pt-4 border-t",children:e.jsx("div",{className:"p-3 bg-red-50 border border-red-200 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(kt,{className:"h-4 w-4 text-red-600 mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-xs text-muted-foreground uppercase tracking-wide mb-1",children:"Red Nedeni"}),e.jsx("p",{className:"text-sm text-red-800 whitespace-pre-wrap font-medium",children:t.rejectionReason}),t.rejectedBy&&Ce[t.rejectedBy]&&e.jsxs("p",{className:"text-xs text-red-700 mt-2",children:["Reddeden: ",Ce[t.rejectedBy],t.rejectedAt&&e.jsxs("span",{className:"ml-2",children:["• ",Re(t.rejectedAt)]})]})]})]})})})]})]})]}),te&&e.jsxs(H,{children:[e.jsx(K,{className:"space-y-1",children:e.jsxs(Y,{className:"text-lg flex items-center gap-2",children:[e.jsx(Ia,{className:"h-4 w-4"}),"Eylemler"]})}),e.jsx(I,{className:"space-y-4",children:e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3",children:ka.map(s=>{const a=s.icon;return e.jsxs("button",{onClick:s.action,className:"flex items-center gap-3 rounded-xl border border-[#E1E4EA] bg-white px-4 py-3 text-left transition-all hover:-translate-y-0.5 hover:shadow-md hover:border-[#C1C7D0]",children:[e.jsx("div",{className:pe("h-10 w-10 rounded-xl border border-transparent flex items-center justify-center shadow-sm",s.accent),children:e.jsx(a,{className:"h-5 w-5"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-semibold text-[#172B4D] mb-0.5",children:s.title}),e.jsx("p",{className:"text-xs text-[#5E6C84] truncate",children:s.description})]}),e.jsx(qa,{className:"h-4 w-4 text-[#A5ADBA] flex-shrink-0"})]},s.id)})})})]}),e.jsxs(H,{children:[e.jsx(K,{className:"space-y-1",children:e.jsxs(Y,{className:"text-lg flex items-center gap-2",children:[e.jsx(Dt,{className:"h-4 w-4"}),"İlişkiler"]})}),e.jsxs(I,{className:"space-y-4",children:[e.jsxs(vt,{value:t.production_order_id?"linked":"none",onValueChange:s=>{s==="link"&&ot(),s==="linked"&&it()},children:[e.jsx(jt,{className:"border-2 border-[#E1E4EA] text-[#172B4D] bg-white h-12 shadow-sm hover:border-[#0079BF] transition-colors",children:e.jsx(bt,{children:t.production_order_id?`Sipariş #${t.production_order_number||t.production_order_id}`:"Bağlı sipariş yok"})}),e.jsxs(yt,{children:[e.jsx(Fe,{value:"none",children:"Bağlı sipariş yok"}),t.production_order_id&&e.jsxs(Fe,{value:"linked",children:["Sipariş #",t.production_order_number||t.production_order_id]}),e.jsx(Fe,{value:"link",children:"Sipariş bağla"})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(u,{className:"flex-1 bg-[#0079BF] hover:bg-[#005A8B] text-white h-12 font-semibold shadow-md hover:shadow-lg transition-all",onClick:ot,children:"Bağla"}),e.jsx(u,{variant:"outline",className:"flex-1 border-2 border-[#E1E4EA] text-[#172B4D] hover:bg-[#F4F5F7] hover:border-[#0079BF] h-12 font-semibold transition-all",onClick:ja,children:"Yenile"})]}),t.production_order_id&&e.jsxs("div",{className:"mt-4 rounded-xl border border-[#DFE1E6] bg-gradient-to-br from-[#F4F5F7] to-white p-4 space-y-3 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm font-semibold text-[#172B4D]",children:[e.jsx(As,{className:"h-4 w-4"}),"Bağlı Sipariş"]}),e.jsx("p",{className:"text-sm text-[#172B4D] font-medium",children:t.production_order_number||t.production_order_id}),t.production_order_customer&&e.jsx("p",{className:"text-xs text-[#5E6C84]",children:t.production_order_customer}),e.jsx(u,{variant:"outline",size:"sm",className:"w-full border-[#DFE1E6] text-[#172B4D] hover:bg-white font-medium h-10",onClick:it,disabled:Hs,children:Hs?e.jsx(je,{className:"h-4 w-4 animate-spin"}):"Detayları Aç"})]})]})]}),te&&e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsxs(u,{variant:"outline",onClick:ba,disabled:D,className:"gap-2 h-10",children:[e.jsx(Wa,{className:"h-4 w-4"}),t!=null&&t.is_archived?"Arşivden Çıkar":"Arşivle"]}),e.jsxs(u,{variant:"outline",onClick:ya,className:"gap-2 h-10",children:[e.jsx(ss,{className:"h-4 w-4"}),"Sil"]})]}),e.jsxs(H,{children:[e.jsx(K,{className:"space-y-1",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{children:e.jsxs(Y,{className:"text-lg flex items-center gap-2",children:[e.jsx(Bs,{className:"h-4 w-4"}),"Yorumlar ve Etkinlik"]})}),e.jsx(J,{variant:"outline",className:"border-[#DFE1E6] text-[#5E6C84] font-medium",children:"Yakında"})]})}),e.jsxs(I,{className:"space-y-4",children:[e.jsx(be,{placeholder:"Yorum yaz...",className:"bg-white border-[#DFE1E6] text-[#172B4D] resize-none",disabled:!0}),e.jsx("p",{className:"text-xs text-[#5E6C84]",children:"Yorum altyapısı üzerinde çalışıyoruz."})]})]})]})})})]})})}),e.jsx(ie,{open:Vt,onOpenChange:cs,children:e.jsxs(le,{className:"max-w-md",children:[e.jsxs(ne,{children:[e.jsx(ce,{children:"Google Drive Linki Ekle"}),e.jsx(de,{children:"Google Drive'dan bir dosya veya klasör linki ekleyin"})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(C,{htmlFor:"drive-link-name",children:"İsim *"}),e.jsx($,{id:"drive-link-name",value:$e,onChange:s=>os(s.target.value),placeholder:"Örn: Proje Dokümantasyonu",className:"w-full"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(C,{htmlFor:"drive-link",children:"Google Drive Linki *"}),e.jsx($,{id:"drive-link",value:ue,onChange:s=>ds(s.target.value),placeholder:"https://drive.google.com/...",className:"w-full"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Google Drive dosya veya klasör linkini yapıştırın"})]})]}),e.jsxs(ts,{children:[e.jsx(u,{variant:"outline",onClick:()=>{cs(!1),ds(""),os("")},children:"İptal"}),e.jsx(u,{onClick:sa,disabled:Ls||!ue.trim()||!$e.trim(),children:Ls?e.jsxs(e.Fragment,{children:[e.jsx(je,{className:"h-4 w-4 animate-spin mr-2"}),"Ekleniyor..."]}):"Ekle"})]})]})}),e.jsx(ie,{open:St,onOpenChange:Ge,children:e.jsxs(le,{children:[e.jsxs(ne,{children:[e.jsx(ce,{children:"Görevi Reddet"}),e.jsx(de,{children:"Görevi reddetmek için lütfen en az 20 karakterlik bir sebep belirtin."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs(C,{htmlFor:"rejection_reason",children:["Reddetme Sebebi ",e.jsx("span",{className:"text-destructive",children:"*"})," (En az 20 karakter)"]}),e.jsx(be,{id:"rejection_reason",value:me,onChange:s=>rs(s.target.value),placeholder:"Görevi neden reddettiğinizi açıklayın (en az 20 karakter)...",rows:4,className:"mt-2"}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[me.length,"/20 karakter"]})]}),e.jsxs(ts,{children:[e.jsx(u,{variant:"outline",onClick:()=>{Ge(!1),rs("")},children:"İptal"}),e.jsx(u,{variant:"destructive",onClick:ea,disabled:D||me.trim().length<20,children:D?"İşleniyor...":"Reddet"})]})]})]})}),e.jsx(ie,{open:Rt,onOpenChange:Pe,children:e.jsxs(le,{children:[e.jsxs(ne,{children:[e.jsx(ce,{children:"Görev Onayını Reddet"}),e.jsx(de,{children:"Görev onayını reddetmek için lütfen bir not ekleyin. Görev tekrar panoya dönecektir."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs(C,{htmlFor:"rejection_approval_reason",children:["Reddetme Notu ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(be,{id:"rejection_approval_reason",value:Oe,onChange:s=>is(s.target.value),placeholder:"Görev onayını neden reddettiğinizi açıklayın...",rows:4,className:"mt-2"})]}),e.jsxs(ts,{children:[e.jsx(u,{variant:"outline",onClick:()=>{Pe(!1),is("")},children:"İptal"}),e.jsx(u,{variant:"destructive",onClick:ia,disabled:D||!Oe.trim(),children:D?"İşleniyor...":"Reddet"})]})]})]})}),e.jsx(ie,{open:zt,onOpenChange:Le,children:e.jsxs(le,{children:[e.jsxs(ne,{children:[e.jsx(ce,{children:"Görev Reddi Reddet"}),e.jsx(de,{children:"Görev reddi reddedildiğinde görev tekrar atanan kişiye döner. Lütfen en az 20 karakterlik bir sebep belirtin."})]}),e.jsx("div",{className:"space-y-4 py-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(C,{htmlFor:"rejection_rejection_reason",children:"Reddetme Sebebi *"}),e.jsx(be,{id:"rejection_rejection_reason",value:G,onChange:s=>ls(s.target.value),placeholder:"Görev reddi neden reddedildiğini açıklayın (en az 20 karakter)...",rows:4,className:G.length>0&&G.length<20?"border-destructive":""}),G.length>0&&G.length<20&&e.jsxs("p",{className:"text-xs text-destructive",children:["En az ",20-G.length," karakter daha gerekli"]}),G.length>=20&&e.jsxs("p",{className:"text-xs text-muted-foreground",children:[G.length," / 20 karakter"]})]})}),e.jsxs(ts,{children:[e.jsx(u,{variant:"outline",onClick:()=>{Le(!1),ls(""),ns(null)},disabled:D,children:"İptal"}),e.jsx(u,{variant:"destructive",onClick:()=>x(void 0,null,function*(){if(!(!l||!(Me!=null&&Me.assignment_id)||G.trim().length<20)){E(!0);try{yield nr(l,Me.assignment_id,G.trim()),c.success("Görev reddi reddedildi, görev tekrar atanan kişiye döndü"),Le(!1),ls(""),ns(null),yield j(),m==null||m()}catch(s){c.error(s.message||"Red reddedilemedi")}finally{E(!1)}}}),disabled:D||G.trim().length<20,children:D?"Reddediliyor...":"Reddi Reddet"})]})]})}),$s&&e.jsx(Cr,{open:Ot,onOpenChange:Vs,order:$s})]})};export{Kr as T};
