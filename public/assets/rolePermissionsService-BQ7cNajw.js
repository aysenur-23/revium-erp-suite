const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-BQmY0BmM.js","assets/lucide-react-CAeuRJQk.js","assets/index-YbdY78QJ.css"])))=>i.map(i=>d[i]);
var I=Object.defineProperty,Y=Object.defineProperties;var $=Object.getOwnPropertyDescriptors;var U=Object.getOwnPropertySymbols;var H=Object.prototype.hasOwnProperty,N=Object.prototype.propertyIsEnumerable;var x=(e,a,r)=>a in e?I(e,a,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[a]=r,g=(e,a)=>{for(var r in a||(a={}))H.call(a,r)&&x(e,r,a[r]);if(U)for(var r of U(a))N.call(a,r)&&x(e,r,a[r]);return e},C=(e,a)=>Y(e,$(a));var h=(e,a,r)=>new Promise((n,u)=>{var l=s=>{try{t(r.next(s))}catch(i){u(i)}},o=s=>{try{t(r.throw(s))}catch(i){u(i)}},t=s=>s.done?n(s.value):Promise.resolve(s.value).then(l,o);t((r=r.apply(e,a)).next())});import{D as y,U as p,H as b,V as M,O as k,T as w,K as j,Q as B,A as V,_ as q,P as F,G as v,N as G,W as Q}from"./index-BQmY0BmM.js";import"./lucide-react-CAeuRJQk.js";const E="role_permissions",D="roles",_=new Map,T=new Map,A=new Set,re=()=>{_.clear(),A.forEach(e=>e())},ae=e=>(A.add(e),()=>{A.delete(e)}),z=["tasks","users","departments","orders","production_orders","customers","products","projects","audit_logs","role_permissions","raw_materials","warranty"],K=[{id:"super_admin",key:"super_admin",label:"Süper Yönetici",color:"bg-red-500",isSystem:!0},{id:"admin",key:"admin",label:"Yönetici",color:"bg-orange-500",isSystem:!0},{id:"team_leader",key:"team_leader",label:"Ekip Lideri",color:"bg-blue-500",isSystem:!0},{id:"personnel",key:"personnel",label:"Personel",color:"bg-green-500",isSystem:!0}],W=()=>h(void 0,null,function*(){try{const e=y(p,D);if((yield b(e)).empty)for(const r of K)yield M(k(p,D,r.key),r)}catch(e){console.error("Error initializing default roles:",e)}}),J=()=>h(void 0,null,function*(){try{yield W();const e=y(p,D);return(yield b(e)).docs.map(r=>g({id:r.id},r.data()))}catch(e){return console.error("Error getting roles:",e),K}}),ne=e=>h(void 0,null,function*(){try{const a=e.key.toLowerCase().replace(/\s+/g,"_"),r=C(g({},e),{key:a,isSystem:!1});yield M(k(p,D,a),r);const n=y(p,E);for(const u of z){const l={role:a,resource:u,canCreate:!1,canRead:!0,canUpdate:!1,canDelete:!1,createdAt:w.now(),updatedAt:w.now()},o=Object.fromEntries(Object.entries(l).filter(([t,s])=>s!==void 0));yield j(n,o)}}catch(a){throw console.error("Error adding role:",a),new Error(a.message||"Rol eklenemedi")}}),oe=e=>h(void 0,null,function*(){try{const a=yield B(k(p,D,e));if(a.exists()&&a.data().isSystem)throw new Error("Sistem rolleri silinemez");const r=y(p,"users"),n=V(r),u=yield b(n),{writeBatch:l}=yield q(()=>h(void 0,null,function*(){const{writeBatch:d}=yield import("./index-BQmY0BmM.js").then(f=>f.ba);return{writeBatch:d}}),__vite__mapDeps([0,1,2]));let o=l(p),t=0;const s=500;for(const d of u.docs){const R=d.data().role||[];if(R.includes(e)){const S=R.filter(P=>P!==e),O=S.length>0?S:["personnel"];o.update(d.ref,{role:O}),t++,t>=s&&(yield o.commit(),t=0,o=l(p))}}t>0&&(yield o.commit()),yield F(k(p,D,e));const i=y(p,E),m=V(i,v("role","==",e)),c=yield b(m);for(const d of c.docs)yield F(k(p,E,d.id))}catch(a){throw console.error("Error deleting role:",a),new Error(a.message||"Rol silinemedi")}}),X=()=>h(void 0,null,function*(){try{const e=y(p,E),a=yield b(e),r=yield J(),n=a.docs.map(l=>l.data()),u=[];for(const l of r){const o=l.key;for(const t of z)if(!n.some(i=>i.role===o&&i.resource===t)){let i=!1,m=!0,c=!1,d=!1,f={};const R=L(t),S=Object.keys(R);o==="super_admin"||o==="admin"?(i=!0,m=!0,c=!0,d=!0,S.forEach(P=>{f[P]=!0})):o==="team_leader"?(i=t!=="role_permissions",m=!0,c=t!=="role_permissions",d=t!=="role_permissions"&&t!=="audit_logs",t!=="role_permissions"&&S.forEach(P=>{f[P]=!0})):o==="personnel"&&(i=["tasks","production_orders"].includes(t),m=!0,c=["tasks","production_orders"].includes(t),d=!1,t==="tasks"?(f.canEditOwn=!0,f.canDeleteOwn=!0,f.canAddComment=!0,f.canAddAttachment=!0):t==="production_orders"&&(f.canViewSchedule=!0));const O={role:o,resource:t,canCreate:i,canRead:m,canUpdate:c,canDelete:d,createdAt:w.now(),updatedAt:w.now()};Object.keys(f).length>0&&(O.subPermissions=f),u.push(O)}}if(u.length>0)for(const l of u){const o={};for(const[t,s]of Object.entries(l))if(s!==void 0)if(typeof s=="object"&&s!==null&&!(s instanceof w)){const i=Object.fromEntries(Object.entries(s).filter(([m,c])=>c!==void 0));Object.keys(i).length>0&&(o[t]=i)}else o[t]=s;yield j(e,o)}if(a.size===0&&u.length===0){const l=[];for(const o of r){const t=o.key;for(const s of z){const i=L(s),m=Object.keys(i);let c={};if(t==="super_admin"||t==="admin"){m.forEach(f=>{c[f]=!0});const d={role:t,resource:s,canCreate:!0,canRead:!0,canUpdate:!0,canDelete:!0,createdAt:w.now(),updatedAt:w.now()};Object.keys(c).length>0&&(d.subPermissions=c),l.push(d)}else if(t==="team_leader"){s!=="role_permissions"&&m.forEach(f=>{c[f]=!0});const d={role:t,resource:s,canCreate:s!=="role_permissions",canRead:!0,canUpdate:s!=="role_permissions",canDelete:s!=="role_permissions"&&s!=="audit_logs",createdAt:w.now(),updatedAt:w.now()};Object.keys(c).length>0&&(d.subPermissions=c),l.push(d)}else if(t==="personnel"){s==="tasks"?(c.canEditOwn=!0,c.canDeleteOwn=!0,c.canAddComment=!0,c.canAddAttachment=!0):s==="production_orders"&&(c.canViewSchedule=!0);const d={role:t,resource:s,canCreate:["tasks","production_orders"].includes(s),canRead:!0,canUpdate:["tasks","production_orders"].includes(s),canDelete:!1,createdAt:w.now(),updatedAt:w.now()};Object.keys(c).length>0&&(d.subPermissions=c),l.push(d)}else l.push({role:t,resource:s,canCreate:!1,canRead:!0,canUpdate:!1,canDelete:!1,createdAt:w.now(),updatedAt:w.now()})}}for(const o of l){const t={};for(const[s,i]of Object.entries(o))if(i!==void 0)if(typeof i=="object"&&i!==null&&!(i instanceof w)){const m=Object.fromEntries(Object.entries(i).filter(([c,d])=>d!==void 0));Object.keys(m).length>0&&(t[s]=m)}else t[s]=i;yield j(e,t)}}}catch(e){console.error("Error initializing default permissions:",e)}}),Z=()=>h(void 0,null,function*(){try{const e=y(p,E),a=yield b(e);for(const r of a.docs){const n=r.data(),u=L(n.resource),l=Object.keys(u);let o=!1,t=g({},n.subPermissions||{});if((n.role==="super_admin"||n.role==="admin")&&l.length>0?l.forEach(s=>{t[s]!==!0&&(t[s]=!0,o=!0)}):n.role==="team_leader"&&n.resource!=="role_permissions"?(l.length>0&&l.forEach(s=>{t[s]!==!0&&(t[s]=!0,o=!0)}),n.canCreate!==!0&&(o=!0),n.canUpdate!==!0&&(o=!0),n.resource!=="audit_logs"&&n.canDelete!==!0&&(o=!0)):n.role==="personnel"&&(n.resource==="tasks"?["canEditOwn","canDeleteOwn","canAddComment","canAddAttachment"].forEach(i=>{t[i]!==!0&&(t[i]=!0,o=!0)}):n.resource==="production_orders"&&t.canViewSchedule!==!0&&(t.canViewSchedule=!0,o=!0)),o){const s={updatedAt:w.now()};n.role==="team_leader"&&n.resource!=="role_permissions"&&(n.canCreate!==!0&&(s.canCreate=!0),n.canUpdate!==!0&&(s.canUpdate=!0),n.resource!=="audit_logs"&&n.canDelete!==!0&&(s.canDelete=!0)),Object.keys(t).length>0&&(s.subPermissions=t);const i=Object.fromEntries(Object.entries(s).filter(([m,c])=>c!==void 0));yield G(k(p,E,r.id),i)}}}catch(e){console.error("Error updating permissions with sub-permissions:",e)}}),ie=()=>h(void 0,null,function*(){try{yield X(),yield Z();const e=y(p,E);return(yield b(e)).docs.map(r=>g({id:r.id},r.data()))}catch(e){throw console.error("Error getting role permissions:",e),new Error(e.message||"Rol yetkileri yüklenemedi")}}),ce=(e,a,r=!0)=>h(void 0,null,function*(){const n=`${e}:${a}`;try{const u=y(p,E),l=V(u,v("role","==",e),v("resource","==",a));if(!T.has(n)){const s=Q(l,m=>{if(m.empty)_.set(n,null);else{const c=m.docs[0],d=g({id:c.id},c.data());_.set(n,d)}A.forEach(c=>c())},m=>{console.error(`Error listening to permission ${n}:`,m)});T.set(n,s);const i=yield b(l);if(i.empty)_.set(n,null);else{const m=i.docs[0],c=g({id:m.id},m.data());_.set(n,c)}}if(r&&_.has(n))return _.get(n)||null;const o=yield b(l);if(o.empty)return null;const t=o.docs[0];return g({id:t.id},t.data())}catch(u){throw console.error("Error getting permission:",u),new Error(u.message||"Yetki yüklenemedi")}}),L=e=>({tasks:{canAssign:"Görev atama",canChangeStatus:"Durum değiştirme",canAddComment:"Yorum ekleme",canAddAttachment:"Dosya ekleme",canViewAll:"Tüm görevleri görme",canEditOwn:"Kendi görevlerini düzenleme",canDeleteOwn:"Kendi görevlerini silme"},users:{canChangeRole:"Rol değiştirme",canViewSensitiveData:"Hassas verileri görme",canViewAuditLogs:"Denetim kayıtlarını görme"},departments:{canAssignMembers:"Üye atama",canChangeLeader:"Lider değiştirme",canViewAll:"Tüm departmanları görme"},orders:{canApprove:"Onaylama",canCancel:"İptal etme",canExport:"Dışa aktarma",canViewFinancials:"Finansal bilgileri görme",canEditPrice:"Fiyat düzenleme"},production_orders:{canStartProduction:"Üretimi başlatma",canCompleteProduction:"Üretimi tamamlama",canViewSchedule:"Üretim planını görme",canEditSchedule:"Üretim planını düzenleme"},customers:{canViewFinancials:"Finansal bilgileri görme",canEditFinancials:"Finansal bilgileri düzenleme",canExport:"Dışa aktarma",canViewHistory:"Geçmiş kayıtları görme"},products:{canEditPrice:"Fiyat düzenleme",canEditStock:"Stok düzenleme",canViewCost:"Maliyet görme",canEditCost:"Maliyet düzenleme",canExport:"Dışa aktarma"},projects:{canAssignMembers:"Üye atama",canChangeStatus:"Durum değiştirme",canViewAll:"Tüm projeleri görme",canEditBudget:"Bütçe düzenleme"},audit_logs:{canViewAll:"Tüm kayıtları görme",canExport:"Dışa aktarma",canDelete:"Kayıt silme"},role_permissions:{canCreateRoles:"Rol oluşturma",canDeleteRoles:"Rol silme",canEditSystemRoles:"Sistem rollerini düzenleme"},raw_materials:{canEditStock:"Stok düzenleme",canViewCost:"Maliyet görme",canEditCost:"Maliyet düzenleme",canExport:"Dışa aktarma",canViewTransactions:"İşlem geçmişini görme",canCreateTransactions:"Stok işlemi oluşturma"},warranty:{canApprove:"Garanti onaylama",canReject:"Garanti reddetme",canViewFinancials:"Finansal bilgileri görme",canExport:"Dışa aktarma",canViewHistory:"Geçmiş kayıtları görme"}})[e]||{},le=(e,a)=>h(void 0,null,function*(){try{const r=k(p,E,e),n=yield B(r);if(n.exists()){const l=n.data(),o=`${l.role}:${l.resource}`;_.delete(o)}const u=Object.fromEntries(Object.entries(a).filter(([l,o])=>o!==void 0));yield G(r,C(g({},u),{updatedAt:w.now()}))}catch(r){throw console.error("Error updating permission:",r),new Error(r.message||"Yetki güncellenemedi")}});export{ne as addRole,re as clearPermissionCache,oe as deleteRole,ce as getPermission,ie as getRolePermissions,J as getRoles,L as getSubPermissionsForResource,ae as onPermissionCacheChange,le as updatePermission,Z as updatePermissionsWithSubPermissions};
