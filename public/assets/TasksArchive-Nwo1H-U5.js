var oe=Object.defineProperty,xe=Object.defineProperties;var he=Object.getOwnPropertyDescriptors;var J=Object.getOwnPropertySymbols;var ue=Object.prototype.hasOwnProperty,pe=Object.prototype.propertyIsEnumerable;var P=(t,i,r)=>i in t?oe(t,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[i]=r,K=(t,i)=>{for(var r in i||(i={}))ue.call(i,r)&&P(t,r,i[r]);if(J)for(var r of J(i))pe.call(i,r)&&P(t,r,i[r]);return t},R=(t,i)=>xe(t,he(i));var A=(t,i,r)=>new Promise((n,h)=>{var u=o=>{try{g(r.next(o))}catch(d){h(d)}},T=o=>{try{g(r.throw(o))}catch(d){h(d)}},g=o=>o.done?n(o.value):Promise.resolve(o.value).then(u,T);g((r=r.apply(t,i)).next())});import{j as e,l as M,B as N,u as fe,a2 as ge,r as ve,a as p,m as je,C as Ne,p as we,n as be,o as V,b as ye,y as q}from"./index-BQmY0BmM.js";import{r as c,d as X,f as Se,$ as Y,E as ke,X as $,T as Ae}from"./lucide-react-CAeuRJQk.js";import{M as Q,B as Te,f as Ce,h as De,i as Le,j as W,t as Me}from"./MainLayout-Dv9j77B5.js";import{A as Ue,a as Oe}from"./avatar-CROuoa6p.js";import{S as _e}from"./search-input-DCf0xYml.js";import{b as Ee,J as ze,d as Be}from"./taskService-CI62TrOj.js";import{L as Ie}from"./loading-state-BC76X596.js";import{T as Ge}from"./TaskDetailModal-Bwb1Je3g.js";import{A as Fe,a as He,b as Je,c as Pe,d as Ke,e as Re,f as Ve,g as qe}from"./alert-dialog-vDPnsgl6.js";import{f as Xe}from"./format-CN3feEER.js";import"./permissions-gaCIgPOa.js";import"./rolePermissionsService-BQ7cNajw.js";import"./OrderDetailModal-BnPVxs_W.js";import"./progress-DCzQFBA2.js";import"./UserMultiSelect-BycFT8u0.js";import"./popover-Bq_PZ6uK.js";const Z=({icon:t,title:i,description:r,action:n,className:h,variant:u="default"})=>u==="card"?e.jsx("div",{className:M("text-center py-12 bg-muted/30 rounded-lg border border-dashed",h),children:e.jsxs("div",{className:"flex flex-col items-center gap-3",children:[t&&e.jsx("div",{className:"rounded-full bg-muted p-4",children:e.jsx(t,{className:"h-12 w-12 text-muted-foreground/50"})}),e.jsx("p",{className:"text-muted-foreground font-medium text-base",children:i}),r&&e.jsx("p",{className:"text-sm text-muted-foreground/70 max-w-md",children:r}),n&&e.jsx(N,{onClick:n.onClick,variant:"outline",size:"sm",className:"mt-2",children:n.label})]})}):u==="minimal"?e.jsxs("div",{className:M("flex flex-col items-center justify-center py-8 px-4",h),children:[t&&e.jsx(t,{className:"h-10 w-10 text-muted-foreground/50 mb-3"}),e.jsx("p",{className:"text-sm text-muted-foreground font-medium",children:i}),r&&e.jsx("p",{className:"text-xs text-muted-foreground/70 mt-1 text-center max-w-sm",children:r}),n&&e.jsx(N,{onClick:n.onClick,variant:"outline",size:"sm",className:"mt-3",children:n.label})]}):e.jsxs("div",{className:M("flex flex-col items-center justify-center py-12 px-4",h),children:[t&&e.jsx("div",{className:"mb-4 rounded-full bg-muted p-4",children:e.jsx(t,{className:"h-8 w-8 text-muted-foreground"})}),e.jsx("h3",{className:"text-lg font-semibold text-foreground mb-2",children:i}),r&&e.jsx("p",{className:"text-sm text-muted-foreground text-center max-w-md mb-4",children:r}),n&&e.jsx(N,{onClick:n.onClick,variant:"outline",size:"sm",children:n.label})]}),U="taskBoardState_v1",hs=()=>{const{user:t,isAdmin:i,isTeamLeader:r}=fe(),[n,h]=c.useState([]),[u,T]=c.useState([]),[g,o]=c.useState(!0),[d,ee]=c.useState(""),[se,ae]=c.useState("tasks"),[Ye,te]=c.useState({}),[w,O]=c.useState(null),[re,C]=c.useState(!1),[_,E]=c.useState(null);if(!i&&!r)return e.jsx(ge,{to:"/",replace:!0});c.useEffect(()=>{v()},[]);const v=()=>A(void 0,null,function*(){var s;if(t){o(!0);try{const m=(yield Ee()).filter(l=>l.isArchived===!0),f=yield ve(),x={};f.forEach(l=>{x[l.id]=l.fullName||l.displayName||l.email}),te(x);const me=m.map(l=>{var j,b,y,S,z,B,k,I,G,F;return{id:l.id,title:l.title,description:l.description||null,status:l.status,priority:l.priority||3,due_date:((y=(b=(j=l.dueDate)==null?void 0:j.toDate)==null?void 0:b.call(j))==null?void 0:y.toISOString())||null,created_at:((B=(z=(S=l.createdAt)==null?void 0:S.toDate)==null?void 0:z.call(S))==null?void 0:B.toISOString())||new Date().toISOString(),updated_at:((G=(I=(k=l.updatedAt)==null?void 0:k.toDate)==null?void 0:I.call(k))==null?void 0:G.toISOString())||new Date().toISOString(),project_id:l.projectId||null,is_archived:l.isArchived,assignedUsers:((F=l.assignedUsers)==null?void 0:F.map(H=>({id:H,full_name:x[H]||"Bilinmeyen"})))||[]}});h(me);try{const l=localStorage.getItem(U);if(l){const b=((s=JSON.parse(l).columns)==null?void 0:s.filter(y=>y.isArchived===!0))||[];T(b)}}catch(l){console.error("Error loading archived lists:",l)}}catch(a){console.error("Fetch archive data error:",a),p.error(a.message||"Arşiv verileri yüklenirken hata oluştu")}finally{o(!1)}}}),le=s=>A(void 0,null,function*(){if(t!=null&&t.id)try{yield ze(s,t.id),p.success("Görev arşivden çıkarıldı"),yield v()}catch(a){console.error("Unarchive task error:",a),p.error(a.message||"Görev arşivden çıkarılamadı")}}),ie=()=>A(void 0,null,function*(){if(!(!_||!(t!=null&&t.id)))try{yield Be(_,t.id),p.success("Görev silindi"),C(!1),E(null),yield v()}catch(s){console.error("Delete task error:",s),p.error(s.message||"Görev silinemedi")}}),ne=(s,a)=>{O(s)},de=()=>{O(null)},ce=s=>{try{const a=localStorage.getItem(U);if(a){const m=JSON.parse(a),f=m.columns.map(x=>x.id===s?R(K({},x),{isArchived:!1}):x);m.columns=f,localStorage.setItem(U,JSON.stringify(m)),p.success("Liste arşivden çıkarıldı"),v()}}catch(a){console.error("Error unarchiving list:",a),p.error("Liste arşivden çıkarılamadı")}},D=c.useMemo(()=>{if(!d)return n;const s=d.toLowerCase();return n.filter(a=>{var m,f;return a.title.toLowerCase().includes(s)||((m=a.description)==null?void 0:m.toLowerCase().includes(s))||((f=a.assignedUsers)==null?void 0:f.some(x=>x.full_name.toLowerCase().includes(s)))})},[n,d]),L=c.useMemo(()=>{if(!d)return u;const s=d.toLowerCase();return u.filter(a=>{var m;return(m=a.title)==null?void 0:m.toLowerCase().includes(s)})},[u,d]);return g?e.jsx(Q,{children:e.jsx(Ie,{message:"Arşiv yükleniyor..."})}):e.jsx(Q,{children:e.jsxs("div",{className:"space-y-3 sm:space-y-4 md:space-y-6",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-xl sm:text-2xl md:text-3xl font-bold text-foreground flex items-center gap-1.5 sm:gap-2",children:[e.jsx(X,{className:"h-5 w-5 sm:h-6 sm:w-6 md:h-7 md:w-7"}),"Arşiv"]}),e.jsx("p",{className:"text-muted-foreground mt-0.5 sm:mt-1 text-xs sm:text-sm",children:"Arşivlenmiş görevler ve listeler"})]}),e.jsx(je,{value:se,onValueChange:s=>ae(s),className:"w-full",children:e.jsxs(Ne,{children:[e.jsx(we,{className:"p-3 sm:p-4 md:p-6",children:e.jsxs("div",{className:"flex flex-col sm:flex-row items-stretch sm:items-center justify-between gap-2 sm:gap-3 md:gap-4",children:[e.jsx("div",{className:"flex-1 min-w-0 w-full sm:w-auto",children:e.jsx(_e,{placeholder:"Arşivde ara...",value:d,onChange:s=>ee(s.target.value),className:"w-full h-9 sm:h-10 text-xs sm:text-sm"})}),e.jsxs(be,{className:"w-full sm:w-auto",children:[e.jsxs(V,{value:"tasks",className:"gap-1 sm:gap-2 flex-1 sm:flex-initial min-h-[44px] sm:min-h-0 text-xs sm:text-sm",children:[e.jsx(Se,{className:"h-3.5 w-3.5 sm:h-4 sm:w-4 flex-shrink-0"}),e.jsx("span",{children:"Görevler"}),e.jsxs("span",{className:"ml-1",children:["(",D.length,")"]})]}),e.jsxs(V,{value:"lists",className:"gap-1 sm:gap-2 flex-1 sm:flex-initial min-h-[44px] sm:min-h-0 text-xs sm:text-sm",children:[e.jsx(Y,{className:"h-3.5 w-3.5 sm:h-4 sm:w-4 flex-shrink-0"}),e.jsx("span",{children:"Listeler"}),e.jsxs("span",{className:"ml-1",children:["(",L.length,")"]})]})]})]})}),e.jsxs(ye,{className:"p-3 sm:p-4 md:p-6",children:[e.jsx(q,{value:"tasks",className:"mt-0",children:D.length===0?e.jsx(Z,{icon:X,title:d?"Arama sonucu bulunamadı":"Henüz arşivlenmiş görev yok",description:d?"Farklı bir arama terimi deneyin":"Arşivlenmiş görevler burada görünecek",variant:"card"}):e.jsx("div",{className:"space-y-3",children:D.map(s=>e.jsx("div",{className:"p-3 sm:p-4 rounded-lg border bg-card hover:shadow-md transition-shadow cursor-pointer",onClick:()=>ne(s.id,s.status),children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-start sm:justify-between gap-3 sm:gap-4",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-start gap-2 sm:gap-3 mb-2",children:[e.jsx("h3",{className:"font-semibold text-sm sm:text-base flex-1 break-words",children:s.title}),e.jsxs(Te,{variant:"outline",className:"flex-shrink-0 self-start sm:self-auto",children:[s.status==="pending"&&"Beklemede",s.status==="in_progress"&&"Devam Ediyor",s.status==="completed"&&"Tamamlandı",s.status==="cancelled"&&"İptal"]})]}),s.description&&e.jsx("p",{className:"text-xs sm:text-sm text-muted-foreground mb-3 line-clamp-2 break-words",children:s.description}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:flex-wrap sm:items-center gap-2 sm:gap-4 text-xs text-muted-foreground",children:[s.due_date&&e.jsx("span",{className:"whitespace-nowrap",children:Xe(new Date(s.due_date),"d MMMM yyyy",{locale:Me})}),s.assignedUsers&&s.assignedUsers.length>0&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"hidden sm:inline",children:"Atananlar:"}),e.jsxs("div",{className:"flex -space-x-2",children:[s.assignedUsers.slice(0,3).map(a=>e.jsx(Ue,{className:"h-6 w-6 border-2 border-background",children:e.jsx(Oe,{className:"text-xs",children:a.full_name.charAt(0).toUpperCase()})},a.id)),s.assignedUsers.length>3&&e.jsxs("div",{className:"h-6 w-6 rounded-full border-2 border-background bg-muted flex items-center justify-center text-xs",children:["+",s.assignedUsers.length-3]})]})]})]})]}),e.jsx("div",{className:"flex items-center gap-2 flex-shrink-0",onClick:a=>a.stopPropagation(),children:e.jsxs(Ce,{children:[e.jsx(De,{asChild:!0,children:e.jsx(N,{variant:"ghost",size:"icon",className:"h-8 w-8 opacity-70 hover:opacity-100",children:e.jsx(ke,{className:"h-4 w-4"})})}),e.jsxs(Le,{align:"end",children:[e.jsxs(W,{onClick:a=>{a.stopPropagation(),le(s.id)},className:"cursor-pointer",children:[e.jsx($,{className:"h-4 w-4 mr-2"}),"Arşivden Çıkar"]}),e.jsxs(W,{onClick:a=>{a.stopPropagation(),E(s.id),C(!0)},className:"cursor-pointer text-destructive focus:text-destructive",children:[e.jsx(Ae,{className:"h-4 w-4 mr-2"}),"Sil"]})]})]})})]})},s.id))})}),e.jsx(q,{value:"lists",className:"mt-0",children:L.length===0?e.jsx(Z,{icon:Y,title:d?"Arama sonucu bulunamadı":"Henüz arşivlenmiş liste yok",description:d?"Farklı bir arama terimi deneyin":"Arşivlenmiş listeler burada görünecek",variant:"card"}):e.jsx("div",{className:"space-y-3",children:L.map(s=>{var a;return e.jsx("div",{className:"p-3 sm:p-4 rounded-lg border bg-card hover:shadow-md transition-shadow",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 sm:gap-4",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-semibold text-sm sm:text-base mb-1 break-words",children:s.title}),e.jsxs("p",{className:"text-xs sm:text-sm text-muted-foreground",children:[((a=s.taskIds)==null?void 0:a.length)||0," görev"]})]}),e.jsxs(N,{variant:"outline",size:"sm",onClick:()=>ce(s.id),className:"flex-shrink-0 w-full sm:w-auto min-h-[44px] sm:min-h-0",children:[e.jsx($,{className:"h-4 w-4 mr-2"}),e.jsx("span",{className:"hidden sm:inline",children:"Arşivden Çıkar"}),e.jsx("span",{className:"sm:hidden",children:"Çıkar"})]})]})},s.id)})})})]})]})}),w&&(()=>{const s=n.find(a=>a.id===w);return e.jsx(Ge,{taskId:w,open:!!w,onOpenChange:a=>{a||de()},onUpdate:()=>{v()},initialStatus:(s==null?void 0:s.status)||"pending"})})(),e.jsx(Fe,{open:re,onOpenChange:C,children:e.jsxs(He,{children:[e.jsxs(Je,{children:[e.jsx(Pe,{children:"Görevi Sil"}),e.jsx(Ke,{children:"Bu görevi silmek istediğinize emin misiniz? Bu işlem geri alınamaz ve görev kalıcı olarak silinecektir."})]}),e.jsxs(Re,{children:[e.jsx(Ve,{children:"İptal"}),e.jsx(qe,{onClick:ie,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Sil"})]})]})})]})})};export{hs as default};
