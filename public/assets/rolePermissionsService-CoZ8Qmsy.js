const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-Xd90qdO9.js","assets/index-HS3kTX7E.css"])))=>i.map(i=>d[i]);
import{x as u,y as o,E as w,ac as P,G as h,H as E,T as c,F as V,z as _,_ as x,J as b,D,I as F}from"./index-Xd90qdO9.js";const f="role_permissions",R="roles",k=["tasks","users","departments","orders","production_orders","customers","products","projects","audit_logs","role_permissions"],z=[{id:"super_admin",key:"super_admin",label:"Süper Yönetici",color:"bg-red-500",isSystem:!0},{id:"admin",key:"admin",label:"Yönetici",color:"bg-orange-500",isSystem:!0},{id:"team_leader",key:"team_leader",label:"Ekip Lideri",color:"bg-blue-500",isSystem:!0},{id:"personnel",key:"personnel",label:"Personel",color:"bg-green-500",isSystem:!0}],T=async()=>{try{const e=u(o,R);if((await w(e)).empty)for(const s of z)await P(h(o,R,s.key),s)}catch(e){console.error("Error initializing default roles:",e)}},v=async()=>{try{await T();const e=u(o,R);return(await w(e)).docs.map(s=>({id:s.id,...s.data()}))}catch(e){return console.error("Error getting roles:",e),z}},I=async e=>{try{const t=e.key.toLowerCase().replace(/\s+/g,"_"),s={...e,key:t,isSystem:!1};await P(h(o,R,t),s);const p=u(o,f);for(const l of k)await E(p,{role:t,resource:l,canCreate:!1,canRead:!0,canUpdate:!1,canDelete:!1,createdAt:c.now(),updatedAt:c.now()})}catch(t){throw console.error("Error adding role:",t),new Error(t.message||"Rol eklenemedi")}},M=async e=>{try{const t=await V(h(o,R,e));if(t.exists()&&t.data().isSystem)throw new Error("Sistem rolleri silinemez");const s=u(o,"users"),p=_(s),l=await w(p),{writeBatch:a}=await x(async()=>{const{writeBatch:d}=await import("./index-Xd90qdO9.js").then(S=>S.by);return{writeBatch:d}},__vite__mapDeps([0,1]));let n=a(o),r=0;const i=500;for(const d of l.docs){const A=d.data().role||[];if(A.includes(e)){const C=A.filter(O=>O!==e),L=C.length>0?C:["personnel"];n.update(d.ref,{role:L}),r++,r>=i&&(await n.commit(),r=0,n=a(o))}}r>0&&await n.commit(),await b(h(o,R,e));const m=u(o,f),g=_(m,D("role","==",e)),y=await w(g);for(const d of y.docs)await b(h(o,f,d.id))}catch(t){throw console.error("Error deleting role:",t),new Error(t.message||"Rol silinemedi")}},B=async()=>{try{const e=u(o,f),t=await w(e),s=await v(),p=t.docs.map(a=>a.data()),l=[];for(const a of s){const n=a.key;for(const r of k)if(!p.some(m=>m.role===n&&m.resource===r)){let m=!1,g=!0,y=!1,d=!1;n==="super_admin"||n==="admin"?(m=!0,g=!0,y=!0,d=!0):n==="team_leader"?(m=r!=="role_permissions",g=!0,y=r!=="role_permissions",d=r!=="role_permissions"&&r!=="audit_logs"):n==="personnel"&&(m=["tasks","production_orders"].includes(r),g=!0,y=["tasks","production_orders"].includes(r),d=!1),l.push({role:n,resource:r,canCreate:m,canRead:g,canUpdate:y,canDelete:d,createdAt:c.now(),updatedAt:c.now()})}}if(l.length>0)for(const a of l)await E(e,a);if(t.size===0&&l.length===0){const a=[];for(const n of s){const r=n.key;for(const i of k)r==="super_admin"||r==="admin"?a.push({role:r,resource:i,canCreate:!0,canRead:!0,canUpdate:!0,canDelete:!0,createdAt:c.now(),updatedAt:c.now()}):r==="team_leader"?a.push({role:r,resource:i,canCreate:i!=="role_permissions",canRead:!0,canUpdate:i!=="role_permissions",canDelete:i!=="role_permissions"&&i!=="audit_logs",createdAt:c.now(),updatedAt:c.now()}):r==="personnel"?a.push({role:r,resource:i,canCreate:["tasks","production_orders"].includes(i),canRead:!0,canUpdate:["tasks","production_orders"].includes(i),canDelete:!1,createdAt:c.now(),updatedAt:c.now()}):a.push({role:r,resource:i,canCreate:!1,canRead:!0,canUpdate:!1,canDelete:!1,createdAt:c.now(),updatedAt:c.now()})}for(const n of a)await E(e,n)}}catch(e){console.error("Error initializing default permissions:",e)}},Y=async()=>{try{await B();const e=u(o,f);return(await w(e)).docs.map(s=>({id:s.id,...s.data()}))}catch(e){throw console.error("Error getting role permissions:",e),new Error(e.message||"Rol yetkileri yüklenemedi")}},j=async(e,t)=>{try{const s=u(o,f),p=_(s,D("role","==",e),D("resource","==",t)),l=await w(p);if(l.empty)return null;const a=l.docs[0];return{id:a.id,...a.data()}}catch(s){throw console.error("Error getting permission:",s),new Error(s.message||"Yetki yüklenemedi")}},q=e=>({tasks:{canAssign:"Görev atama",canChangeStatus:"Durum değiştirme",canAddComment:"Yorum ekleme",canAddAttachment:"Dosya ekleme",canViewAll:"Tüm görevleri görme",canEditOwn:"Kendi görevlerini düzenleme",canDeleteOwn:"Kendi görevlerini silme"},users:{canChangeRole:"Rol değiştirme",canViewSensitiveData:"Hassas verileri görme",canViewAuditLogs:"Denetim kayıtlarını görme"},departments:{canAssignMembers:"Üye atama",canChangeLeader:"Lider değiştirme",canViewAll:"Tüm departmanları görme"},orders:{canApprove:"Onaylama",canCancel:"İptal etme",canExport:"Dışa aktarma",canViewFinancials:"Finansal bilgileri görme",canEditPrice:"Fiyat düzenleme"},production_orders:{canStartProduction:"Üretimi başlatma",canCompleteProduction:"Üretimi tamamlama",canViewSchedule:"Üretim planını görme",canEditSchedule:"Üretim planını düzenleme"},customers:{canViewFinancials:"Finansal bilgileri görme",canEditFinancials:"Finansal bilgileri düzenleme",canExport:"Dışa aktarma",canViewHistory:"Geçmiş kayıtları görme"},products:{canEditPrice:"Fiyat düzenleme",canEditStock:"Stok düzenleme",canViewCost:"Maliyet görme",canEditCost:"Maliyet düzenleme",canExport:"Dışa aktarma"},projects:{canAssignMembers:"Üye atama",canChangeStatus:"Durum değiştirme",canViewAll:"Tüm projeleri görme",canEditBudget:"Bütçe düzenleme"},audit_logs:{canViewAll:"Tüm kayıtları görme",canExport:"Dışa aktarma",canDelete:"Kayıt silme"},role_permissions:{canCreateRoles:"Rol oluşturma",canDeleteRoles:"Rol silme",canEditSystemRoles:"Sistem rollerini düzenleme"}})[e]||{},G=async(e,t)=>{try{const s=h(o,f,e);await F(s,{...t,updatedAt:c.now()})}catch(s){throw console.error("Error updating permission:",s),new Error(s.message||"Yetki güncellenemedi")}};export{I as addRole,M as deleteRole,j as getPermission,Y as getRolePermissions,v as getRoles,q as getSubPermissionsForResource,G as updatePermission};
