var ts=Object.defineProperty,as=Object.defineProperties;var rs=Object.getOwnPropertyDescriptors;var We=Object.getOwnPropertySymbols;var ls=Object.prototype.hasOwnProperty,ns=Object.prototype.propertyIsEnumerable;var Qe=(f,g,t)=>g in f?ts(f,g,{enumerable:!0,configurable:!0,writable:!0,value:t}):f[g]=t,h=(f,g)=>{for(var t in g||(g={}))ls.call(g,t)&&Qe(f,t,g[t]);if(We)for(var t of We(g))ns.call(g,t)&&Qe(f,t,g[t]);return f},u=(f,g)=>as(f,rs(g));var C=(f,g,t)=>new Promise((R,N)=>{var D=S=>{try{M(t.next(S))}catch(P){N(P)}},w=S=>{try{M(t.throw(S))}catch(P){N(P)}},M=S=>S.done?R(S.value):Promise.resolve(S.value).then(D,w);M((t=t.apply(f,g)).next())});import{u as is,r as xe,a as k,j as e,B as A,C as G,p as we,q as Se,b as W,L as p,I as v,S as U,c as I,d as V,e as Y,f as d,m as cs,n as os,o as ze,y as Re,h as ds,l as $,at as Ne,s as ke,t as ye,v as be}from"./index-BQmY0BmM.js";import{r as c,o as Q,X as Ee,m as me,I as Xe,S as Je,T as Le,P as Ze,ai as ms,q as xs,s as hs,j as us,p as ps,l as js}from"./lucide-react-CAeuRJQk.js";import{D as Ue,a as Ie,b as Ve,c as Ye,e as qe,T as Ce,n as gs,p as fs,l as vs,B as Me,t as Ns,a0 as ks,M as ys}from"./MainLayout-Dv9j77B5.js";import{S as bs}from"./search-input-DCf0xYml.js";import{P as ws}from"./progress-DCzQFBA2.js";import{createRawMaterial as Ss,updateRawMaterial as Cs,getMaterialTransactions as Ms,deleteRawMaterial as es,getRawMaterials as Ps}from"./materialService-BHW8dEom.js";import{handleErrorToast as Ds}from"./toastHelpers-DkuKGmwM.js";import{D as Pe,a as ss,C as ne}from"./currency-BpxR3_y8.js";import{T as He,a as Ke,b as le,c as y,d as Oe,e as b}from"./table-zhTdMUM_.js";import{getRawMaterialRecipes as Ts,deleteRecipeItem as As,addRecipeItem as Fs}from"./recipeService-B644vMa2.js";import{f as _s}from"./format-CN3feEER.js";import{D as Bs}from"./DetailedValueReportModal-BRj7dqdh.js";import{L as zs}from"./loading-state-BC76X596.js";import{A as Rs,a as Ls,b as Hs,c as Ks,d as Os,e as Es,f as Us,g as Is}from"./alert-dialog-vDPnsgl6.js";import"./taskService-CI62TrOj.js";import"./exchangeRateService-Ba2gZPdu.js";const Vs=({open:f,onOpenChange:g,onSuccess:t})=>{const{user:R}=is(),[N,D]=c.useState(!1),[w,M]=c.useState([]),[S,P]=c.useState(!1),[r,o]=c.useState({name:"",sku:"",category:"other",stock:"0",min_stock:"0",max_stock:"",unit:"Adet",unitPrice:"0",totalPrice:"0",currency:Pe,brand:"",link:"",supplier:"",purchasedBy:"",location:"",description:""});c.useEffect(()=>{f&&X()},[f]);const X=()=>C(void 0,null,function*(){P(!0);try{const a=yield xe();M(a)}catch(a){console.error("Error fetching users:",a),k.error("Kullanıcılar yüklenirken hata oluştu")}finally{P(!1)}}),_=a=>C(void 0,null,function*(){a&&a.preventDefault(),D(!0);try{if(!R){k.error("Oturumunuz sona erdi. Lütfen tekrar giriş yapın."),D(!1);return}yield Ss({name:r.name,code:r.sku||null,unit:r.unit,currentStock:parseInt(r.stock)||0,minStock:parseInt(r.min_stock)||0,maxStock:r.max_stock?parseInt(r.max_stock):null,unitPrice:parseFloat(r.unitPrice)||null,totalPrice:parseFloat(r.totalPrice)||null,currency:r.currency,currencies:[r.currency],brand:r.brand||null,link:r.link||null,supplier:r.supplier||null,purchasedBy:r.purchasedBy||null,location:r.location||null,description:r.description||null,notes:r.description||null}),k.success("Hammadde başarıyla eklendi"),t(),g(!1),o({name:"",sku:"",category:"other",stock:"0",min_stock:"0",max_stock:"",unit:"Adet",unitPrice:"0",totalPrice:"0",currency:Pe,brand:"",link:"",supplier:"",purchasedBy:"",location:"",description:""})}catch(B){Ds(B,"Hammadde eklenirken hata oluştu")}finally{D(!1)}});return e.jsx(Ue,{open:f,onOpenChange:g,children:e.jsx(Ie,{className:"!max-w-[100vw] sm:!max-w-[95vw] !w-[100vw] sm:!w-[95vw] !h-[100vh] sm:!h-[90vh] !max-h-[100vh] sm:!max-h-[90vh] !left-0 sm:!left-[2.5vw] !top-0 sm:!top-[5vh] !right-0 sm:!right-auto !bottom-0 sm:!bottom-auto !translate-x-0 !translate-y-0 overflow-hidden !p-0 gap-0 bg-white flex flex-col !m-0 !rounded-none sm:!rounded-lg !border-0 sm:!border",children:e.jsxs("div",{className:"flex flex-col h-full min-h-0",children:[e.jsx(Ve,{className:"p-3 sm:p-4 border-b bg-white flex-shrink-0 relative pr-12 sm:pr-16",children:e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 flex-1 min-w-0",children:[e.jsx("div",{className:"h-8 w-8 sm:h-10 sm:w-10 rounded-lg bg-primary/10 flex items-center justify-center border border-primary/20 flex-shrink-0",children:e.jsx(Q,{className:"h-4 w-4 sm:h-5 sm:w-5 text-primary"})}),e.jsx(Ye,{className:"text-lg sm:text-xl font-semibold text-foreground truncate",children:"Yeni Hammadde Ekle"}),e.jsx(qe,{className:"sr-only",children:"Yeni hammadde eklemek için formu doldurun"})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 flex-shrink-0",children:[e.jsxs(A,{variant:"outline",size:"sm",className:"border-primary/20 hover:bg-primary/5 rounded-lg px-3 py-1.5 font-medium text-xs sm:text-sm flex-shrink-0",onClick:()=>g(!1),disabled:N,children:[e.jsx(Ee,{className:"h-3 w-3 sm:h-4 sm:w-4 mr-1.5 flex-shrink-0"}),"İptal"]}),e.jsxs(A,{variant:"default",size:"sm",className:"bg-primary hover:bg-primary/90 rounded-lg px-3 py-1.5 font-medium text-xs sm:text-sm flex-shrink-0 text-white",onClick:_,disabled:N,children:[N?e.jsx(me,{className:"h-3 w-3 sm:h-4 sm:w-4 mr-1.5 flex-shrink-0 animate-spin"}):e.jsx(Xe,{className:"h-3 w-3 sm:h-4 sm:w-4 mr-1.5 flex-shrink-0"}),"Kaydet"]})]})]})}),e.jsx("div",{className:"flex-1 overflow-hidden bg-gray-50/50 p-3 sm:p-4 min-h-0",children:e.jsx("div",{className:"max-w-full mx-auto h-full overflow-y-auto",children:e.jsx("form",{onSubmit:a=>{a.preventDefault(),_(a)},className:"space-y-4 sm:space-y-6",children:e.jsxs(G,{children:[e.jsx(we,{children:e.jsx(Se,{className:"text-lg sm:text-xl",children:"Temel Bilgiler"})}),e.jsxs(W,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"name",className:"text-sm sm:text-base",children:"Hammadde Adı"}),e.jsx(v,{id:"name",value:r.name,onChange:a=>o(u(h({},r),{name:a.target.value})),className:"min-h-[44px] sm:min-h-0",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"sku",className:"text-sm sm:text-base",children:"Stok Kodu"}),e.jsx(v,{id:"sku",value:r.sku,onChange:a=>o(u(h({},r),{sku:a.target.value})),className:"min-h-[44px] sm:min-h-0",required:!0})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"description",className:"text-sm sm:text-base",children:"Açıklama"}),e.jsx(Ce,{id:"description",value:r.description,onChange:a=>o(u(h({},r),{description:a.target.value})),className:"min-h-[80px] sm:min-h-[100px] resize-none",placeholder:"Hammadde hakkında açıklama yazın..."})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"category",className:"text-sm sm:text-base",children:"Kategori"}),e.jsxs(U,{value:r.category,onValueChange:a=>o(u(h({},r),{category:a})),children:[e.jsx(I,{className:"min-h-[44px] sm:min-h-0",children:e.jsx(V,{})}),e.jsxs(Y,{children:[e.jsx(d,{value:"chemical",children:"Kimyasal"}),e.jsx(d,{value:"metal",children:"Metal"}),e.jsx(d,{value:"plastic",children:"Plastik"}),e.jsx(d,{value:"electronic",children:"Elektronik"}),e.jsx(d,{value:"packaging",children:"Ambalaj"}),e.jsx(d,{value:"other",children:"Diğer"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"unit",className:"text-sm sm:text-base",children:"Birim"}),e.jsxs(U,{value:r.unit,onValueChange:a=>o(u(h({},r),{unit:a})),children:[e.jsx(I,{className:"min-h-[44px] sm:min-h-0",children:e.jsx(V,{placeholder:"Birim seçin"})}),e.jsxs(Y,{children:[e.jsx(d,{value:"Adet",children:"Adet"}),e.jsx(d,{value:"Kg",children:"Kg"}),e.jsx(d,{value:"Gram",children:"Gram"}),e.jsx(d,{value:"Litre",children:"Litre"}),e.jsx(d,{value:"Metre",children:"Metre"}),e.jsx(d,{value:"Cm",children:"Cm"}),e.jsx(d,{value:"M²",children:"M²"}),e.jsx(d,{value:"M³",children:"M³"}),e.jsx(d,{value:"Paket",children:"Paket"}),e.jsx(d,{value:"Kutu",children:"Kutu"}),e.jsx(d,{value:"Palet",children:"Palet"}),e.jsx(d,{value:"Ton",children:"Ton"})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 sm:gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"stock",className:"text-sm sm:text-base",children:"Mevcut Stok"}),e.jsx(v,{id:"stock",type:"number",step:"1",min:"0",value:r.stock,onChange:a=>o(u(h({},r),{stock:a.target.value})),className:"min-h-[44px] sm:min-h-0",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"min_stock",className:"text-sm sm:text-base",children:"Minimum Stok"}),e.jsx(v,{id:"min_stock",type:"number",step:"1",min:"0",value:r.min_stock,onChange:a=>o(u(h({},r),{min_stock:a.target.value})),className:"min-h-[44px] sm:min-h-0",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"max_stock",className:"text-sm sm:text-base",children:"Maksimum Stok"}),e.jsx(v,{id:"max_stock",type:"number",step:"1",min:"0",value:r.max_stock,onChange:a=>o(u(h({},r),{max_stock:a.target.value})),className:"min-h-[44px] sm:min-h-0"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{className:"text-sm sm:text-base",children:"Para Birimi"}),e.jsxs(U,{value:r.currency,onValueChange:a=>o(u(h({},r),{currency:a})),children:[e.jsx(I,{className:"min-h-[44px] sm:min-h-0",children:e.jsx(V,{})}),e.jsx(Y,{children:ss.map(a=>e.jsx(d,{value:a.value,children:a.label},a.value))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(p,{htmlFor:"unitPrice",className:"text-sm sm:text-base",children:["Birim Fiyat (",ne[r.currency],")"]}),e.jsx(v,{id:"unitPrice",type:"number",step:"0.01",min:"0",value:r.unitPrice,onChange:a=>o(u(h({},r),{unitPrice:a.target.value})),className:"min-h-[44px] sm:min-h-0"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(p,{htmlFor:"totalPrice",className:"text-sm sm:text-base",children:["Toplam Fiyat (",ne[r.currency],")"]}),e.jsx(v,{id:"totalPrice",type:"number",step:"0.01",min:"0",value:r.totalPrice,onChange:a=>o(u(h({},r),{totalPrice:a.target.value})),className:"min-h-[44px] sm:min-h-0"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"brand",className:"text-sm sm:text-base",children:"Marka"}),e.jsx(v,{id:"brand",value:r.brand,onChange:a=>o(u(h({},r),{brand:a.target.value})),className:"min-h-[44px] sm:min-h-0",placeholder:"Örn: Bosch, Samsung, vb."})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"link",className:"text-sm sm:text-base",children:"Link"}),e.jsx(v,{id:"link",type:"url",value:r.link,onChange:a=>o(u(h({},r),{link:a.target.value})),className:"min-h-[44px] sm:min-h-0",placeholder:"https://..."})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"supplier",className:"text-sm sm:text-base",children:"Tedarikçi"}),e.jsx(v,{id:"supplier",value:r.supplier,onChange:a=>o(u(h({},r),{supplier:a.target.value})),className:"min-h-[44px] sm:min-h-0"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"purchasedBy",className:"text-sm sm:text-base",children:"Satın Alan Kişi"}),e.jsxs(U,{value:r.purchasedBy||"none",onValueChange:a=>o(u(h({},r),{purchasedBy:a==="none"?"":a})),disabled:S,children:[e.jsx(I,{className:"min-h-[44px] sm:min-h-0",children:e.jsx(V,{placeholder:S?"Yükleniyor...":"Kişi seçin"})}),e.jsxs(Y,{children:[e.jsx(d,{value:"none",children:"Satın Alan Kişi Yok"}),w.map(a=>e.jsx(d,{value:a.id,children:a.fullName||a.displayName||a.email||"İsimsiz Kullanıcı"},a.id))]})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"location",className:"text-sm sm:text-base",children:"Hammadde Konumu"}),e.jsx(v,{id:"location",value:r.location,onChange:a=>o(u(h({},r),{location:a.target.value})),className:"min-h-[44px] sm:min-h-0",placeholder:"Örn: Depo A, Raf 3, vb."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"description",className:"text-sm sm:text-base",children:"Açıklama"}),e.jsx(Ce,{id:"description",value:r.description,onChange:a=>o(u(h({},r),{description:a.target.value})),rows:3,className:"min-h-[44px] sm:min-h-0"})]})]})]})})})})]})})})},Ys=({open:f,onOpenChange:g,material:t,onSuccess:R})=>{const[N,D]=c.useState(!1),[w,M]=c.useState([]),[S,P]=c.useState(!1),[r,o]=c.useState({name:"",sku:"",category:"other",stock:"0",min_stock:"0",max_stock:"",unit:"Adet",unitPrice:"0",totalPrice:"0",currency:Pe,brand:"",link:"",supplier:"",purchasedBy:"",location:"",description:""});c.useEffect(()=>{f&&X()},[f]);const X=()=>C(void 0,null,function*(){P(!0);try{const a=yield xe();M(a)}catch(a){console.error("Error fetching users:",a),k.error("Kullanıcılar yüklenirken hata oluştu")}finally{P(!1)}});c.useEffect(()=>{var a,B,K,H,L;t&&o({name:t.name||"",sku:t.code||"",category:"other",stock:((a=t.currentStock)==null?void 0:a.toString())||"0",min_stock:((B=t.minStock)==null?void 0:B.toString())||"0",max_stock:((K=t.maxStock)==null?void 0:K.toString())||"",unit:t.unit||"Adet",unitPrice:((H=t.unitPrice)==null?void 0:H.toString())||"0",totalPrice:((L=t.totalPrice)==null?void 0:L.toString())||"0",currency:t.currencies&&t.currencies.length>0?t.currencies[0]:t.currency||Pe,brand:t.brand||"",link:t.link||"",supplier:t.supplier||"",purchasedBy:t.purchasedBy||"",location:t.location||"",description:t.description||t.notes||""})},[t]);const _=a=>C(void 0,null,function*(){a&&a.preventDefault(),D(!0);try{yield Cs(t.id,{name:r.name,code:r.sku||null,unit:r.unit,currentStock:parseInt(r.stock)||0,minStock:parseInt(r.min_stock)||0,maxStock:r.max_stock?parseInt(r.max_stock):null,unitPrice:parseFloat(r.unitPrice)||null,totalPrice:parseFloat(r.totalPrice)||null,currency:r.currency,currencies:[r.currency],brand:r.brand||null,link:r.link||null,supplier:r.supplier||null,purchasedBy:r.purchasedBy||null,location:r.location||null,description:r.description||null,notes:r.description||null}),k.success("Hammadde başarıyla güncellendi"),R()}catch(B){console.error("Update material error:",B),k.error(B.message||"Hammadde güncellenirken hata oluştu")}finally{D(!1)}});return e.jsx(Ue,{open:f,onOpenChange:g,children:e.jsx(Ie,{className:"!max-w-[100vw] sm:!max-w-[95vw] !w-[100vw] sm:!w-[95vw] !h-[100vh] sm:!h-[90vh] !max-h-[100vh] sm:!max-h-[90vh] !left-0 sm:!left-[2.5vw] !top-0 sm:!top-[5vh] !right-0 sm:!right-auto !bottom-0 sm:!bottom-auto !translate-x-0 !translate-y-0 overflow-hidden !p-0 gap-0 bg-white flex flex-col !m-0 !rounded-none sm:!rounded-lg !border-0 sm:!border",children:e.jsxs("div",{className:"flex flex-col h-full min-h-0",children:[e.jsx(Ve,{className:"p-3 sm:p-4 border-b bg-white flex-shrink-0 relative pr-12 sm:pr-16",children:e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 flex-1 min-w-0",children:[e.jsx("div",{className:"h-8 w-8 sm:h-10 sm:w-10 rounded-lg bg-primary/10 flex items-center justify-center border border-primary/20 flex-shrink-0",children:e.jsx(Q,{className:"h-4 w-4 sm:h-5 sm:w-5 text-primary"})}),e.jsx(Ye,{className:"text-lg sm:text-xl font-semibold text-foreground truncate",children:"Hammadde Düzenle"}),e.jsx(qe,{className:"sr-only",children:"Hammadde bilgilerini düzenleyin"})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 flex-shrink-0",children:[e.jsxs(A,{variant:"outline",size:"sm",className:"border-primary/20 hover:bg-primary/5 rounded-lg px-3 py-1.5 font-medium text-xs sm:text-sm flex-shrink-0",onClick:()=>g(!1),disabled:N,children:[e.jsx(Ee,{className:"h-3 w-3 sm:h-4 sm:w-4 mr-1.5 flex-shrink-0"}),"İptal"]}),e.jsxs(A,{variant:"default",size:"sm",className:"bg-primary hover:bg-primary/90 rounded-lg px-3 py-1.5 font-medium text-xs sm:text-sm flex-shrink-0 text-white",onClick:_,disabled:N,children:[N?e.jsx(me,{className:"h-3 w-3 sm:h-4 sm:w-4 mr-1.5 flex-shrink-0 animate-spin"}):e.jsx(Xe,{className:"h-3 w-3 sm:h-4 sm:w-4 mr-1.5 flex-shrink-0"}),"Kaydet"]})]})]})}),e.jsx("div",{className:"flex-1 overflow-hidden bg-gray-50/50 p-3 sm:p-4 min-h-0",children:e.jsx("div",{className:"max-w-full mx-auto h-full overflow-y-auto",children:e.jsx("form",{onSubmit:a=>{a.preventDefault(),_(a)},className:"space-y-4 sm:space-y-6",children:e.jsxs(G,{children:[e.jsx(we,{children:e.jsx(Se,{className:"text-lg sm:text-xl",children:"Temel Bilgiler"})}),e.jsxs(W,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"name",className:"text-sm sm:text-base",children:"Hammadde Adı"}),e.jsx(v,{id:"name",value:r.name,onChange:a=>o(u(h({},r),{name:a.target.value})),className:"min-h-[44px] sm:min-h-0",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"sku",className:"text-sm sm:text-base",children:"Stok Kodu"}),e.jsx(v,{id:"sku",value:r.sku,onChange:a=>o(u(h({},r),{sku:a.target.value})),className:"min-h-[44px] sm:min-h-0",required:!0})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"description",className:"text-sm sm:text-base",children:"Açıklama"}),e.jsx(Ce,{id:"description",value:r.description,onChange:a=>o(u(h({},r),{description:a.target.value})),className:"min-h-[80px] sm:min-h-[100px] resize-none",placeholder:"Hammadde hakkında açıklama yazın..."})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"category",className:"text-sm sm:text-base",children:"Kategori"}),e.jsxs(U,{value:r.category,onValueChange:a=>o(u(h({},r),{category:a})),children:[e.jsx(I,{className:"min-h-[44px] sm:min-h-0",children:e.jsx(V,{})}),e.jsxs(Y,{children:[e.jsx(d,{value:"chemical",children:"Kimyasal"}),e.jsx(d,{value:"metal",children:"Metal"}),e.jsx(d,{value:"plastic",children:"Plastik"}),e.jsx(d,{value:"electronic",children:"Elektronik"}),e.jsx(d,{value:"packaging",children:"Ambalaj"}),e.jsx(d,{value:"other",children:"Diğer"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"unit",className:"text-sm sm:text-base",children:"Birim"}),e.jsxs(U,{value:r.unit,onValueChange:a=>o(u(h({},r),{unit:a})),children:[e.jsx(I,{className:"min-h-[44px] sm:min-h-0",children:e.jsx(V,{placeholder:"Birim seçin"})}),e.jsxs(Y,{children:[e.jsx(d,{value:"Adet",children:"Adet"}),e.jsx(d,{value:"Kg",children:"Kg"}),e.jsx(d,{value:"Gram",children:"Gram"}),e.jsx(d,{value:"Litre",children:"Litre"}),e.jsx(d,{value:"Metre",children:"Metre"}),e.jsx(d,{value:"Cm",children:"Cm"}),e.jsx(d,{value:"M²",children:"M²"}),e.jsx(d,{value:"M³",children:"M³"}),e.jsx(d,{value:"Paket",children:"Paket"}),e.jsx(d,{value:"Kutu",children:"Kutu"}),e.jsx(d,{value:"Palet",children:"Palet"}),e.jsx(d,{value:"Ton",children:"Ton"})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 sm:gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"stock",className:"text-sm sm:text-base",children:"Mevcut Stok"}),e.jsx(v,{id:"stock",type:"number",step:"1",min:"0",value:r.stock,onChange:a=>o(u(h({},r),{stock:a.target.value})),className:"min-h-[44px] sm:min-h-0",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"min_stock",className:"text-sm sm:text-base",children:"Minimum Stok"}),e.jsx(v,{id:"min_stock",type:"number",step:"1",min:"0",value:r.min_stock,onChange:a=>o(u(h({},r),{min_stock:a.target.value})),className:"min-h-[44px] sm:min-h-0",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"max_stock",className:"text-sm sm:text-base",children:"Maksimum Stok"}),e.jsx(v,{id:"max_stock",type:"number",step:"1",min:"0",value:r.max_stock,onChange:a=>o(u(h({},r),{max_stock:a.target.value})),className:"min-h-[44px] sm:min-h-0"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{className:"text-sm sm:text-base",children:"Para Birimi"}),e.jsxs(U,{value:r.currency,onValueChange:a=>o(u(h({},r),{currency:a})),children:[e.jsx(I,{className:"min-h-[44px] sm:min-h-0",children:e.jsx(V,{})}),e.jsx(Y,{children:ss.map(a=>e.jsx(d,{value:a.value,children:a.label},a.value))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(p,{htmlFor:"unitPrice",className:"text-sm sm:text-base",children:["Birim Fiyat (",ne[r.currency],")"]}),e.jsx(v,{id:"unitPrice",type:"number",step:"0.01",min:"0",value:r.unitPrice,onChange:a=>o(u(h({},r),{unitPrice:a.target.value})),className:"min-h-[44px] sm:min-h-0"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(p,{htmlFor:"totalPrice",className:"text-sm sm:text-base",children:["Toplam Fiyat (",ne[r.currency],")"]}),e.jsx(v,{id:"totalPrice",type:"number",step:"0.01",min:"0",value:r.totalPrice,onChange:a=>o(u(h({},r),{totalPrice:a.target.value})),className:"min-h-[44px] sm:min-h-0"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"brand",className:"text-sm sm:text-base",children:"Marka"}),e.jsx(v,{id:"brand",value:r.brand,onChange:a=>o(u(h({},r),{brand:a.target.value})),className:"min-h-[44px] sm:min-h-0",placeholder:"Örn: Bosch, Samsung, vb."})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"link",className:"text-sm sm:text-base",children:"Link"}),e.jsx(v,{id:"link",type:"url",value:r.link,onChange:a=>o(u(h({},r),{link:a.target.value})),className:"min-h-[44px] sm:min-h-0",placeholder:"https://..."})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"supplier",className:"text-sm sm:text-base",children:"Tedarikçi"}),e.jsx(v,{id:"supplier",value:r.supplier,onChange:a=>o(u(h({},r),{supplier:a.target.value})),className:"min-h-[44px] sm:min-h-0"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"purchasedBy",className:"text-sm sm:text-base",children:"Satın Alan Kişi"}),e.jsxs(U,{value:r.purchasedBy||"none",onValueChange:a=>o(u(h({},r),{purchasedBy:a==="none"?"":a})),disabled:S,children:[e.jsx(I,{className:"min-h-[44px] sm:min-h-0",children:e.jsx(V,{placeholder:S?"Yükleniyor...":"Kişi seçin"})}),e.jsxs(Y,{children:[e.jsx(d,{value:"none",children:"Satın Alan Kişi Yok"}),w.map(a=>e.jsx(d,{value:a.id,children:a.fullName||a.displayName||a.email||"İsimsiz Kullanıcı"},a.id))]})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"location",className:"text-sm sm:text-base",children:"Hammadde Konumu"}),e.jsx(v,{id:"location",value:r.location,onChange:a=>o(u(h({},r),{location:a.target.value})),className:"min-h-[44px] sm:min-h-0",placeholder:"Örn: Depo A, Raf 3, vb."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"description",className:"text-sm sm:text-base",children:"Açıklama"}),e.jsx(Ce,{id:"description",value:r.description,onChange:a=>o(u(h({},r),{description:a.target.value})),rows:3,className:"min-h-[44px] sm:min-h-0"})]})]})]})})})})]})})})},qs=({open:f,onOpenChange:g,material:t,onEdit:R,onDelete:N})=>{const[D,w]=c.useState(!1),[M,S]=c.useState([]),[P,r]=c.useState(!1),[o,X]=c.useState("details"),[_,a]=c.useState([]),[B,K]=c.useState(!1),[H,L]=c.useState(""),[q,se]=c.useState(""),[he,ie]=c.useState([]),[te,ce]=c.useState(!1),[ue,oe]=c.useState([]),[J,O]=c.useState(!1),[ae,pe]=c.useState({}),[je,Z]=c.useState({}),De=()=>C(void 0,null,function*(){var s,l;if(confirm("Bu hammaddeyi silmek istediğinizden emin misiniz?")){w(!0);try{yield es(t.id),k.success("Hammadde başarıyla silindi"),N()}catch(i){k.error("Hata: "+(((l=(s=i.response)==null?void 0:s.data)==null?void 0:l.message)||i.message))}finally{w(!1)}}}),Te=s=>({chemical:"Kimyasal",metal:"Metal",plastic:"Plastik",electronic:"Elektronik",packaging:"Ambalaj",other:"Diğer"})[s]||s,de=(s,l)=>s===0?{label:"Tükendi",variant:"destructive"}:s<l?{label:"Düşük",variant:"secondary"}:{label:"Normal",variant:"default"};c.useEffect(()=>{f&&(t!=null&&t.id)&&o==="recipes"&&(ee(),re()),f&&(t!=null&&t.id)&&o==="transactions"&&Ae(),f&&E()},[f,t==null?void 0:t.id,o]);const E=()=>C(void 0,null,function*(){if(!(he.length>0&&Object.keys(je).length>0)){ce(!0);try{const s=yield xe();ie(s);const l={};s.forEach(i=>{l[i.id]=i.fullName||i.displayName||i.email||"Bilinmeyen"}),Z(l)}catch(s){console.error("Error fetching users:",s)}finally{ce(!1)}}}),Ae=()=>C(void 0,null,function*(){if(t!=null&&t.id){O(!0);try{const s=yield Ms(t.id);s.sort((n,m)=>{var F,z,fe,ve,$e,Ge;const x=((z=(F=n.createdAt)==null?void 0:F.toMillis)==null?void 0:z.call(F))||((fe=n.createdAt)==null?void 0:fe.seconds)*1e3||0;return((($e=(ve=m.createdAt)==null?void 0:ve.toMillis)==null?void 0:$e.call(ve))||((Ge=m.createdAt)==null?void 0:Ge.seconds)*1e3||0)-x}),oe(s);const l=s.filter(n=>n.relatedOrderId).map(n=>n.relatedOrderId).filter((n,m,x)=>x.indexOf(n)===m),i=yield Promise.all(l.map(n=>C(void 0,null,function*(){try{const m=yield gs(n);if(!m)return null;let x;try{const T=yield fs(n);T.length>0&&(x=T[0].productName||T[0].product_name||void 0)}catch(T){const F=s.filter(z=>z.relatedOrderId===n);if(F.length>0&&F[0].reason){const z=F[0].reason.match(/-\s*(.+?)\s*\(/);z&&(x=z[1])}}return{orderId:n,orderNumber:m.orderNumber||m.order_number||n,productName:x}}catch(m){return null}}))),j={};i.forEach(n=>{n&&(j[n.orderId]={orderNumber:n.orderNumber,productName:n.productName})}),pe(j)}catch(s){console.error("İşlemler yüklenirken hata:",s),k.error(s.message||"İşlemler yüklenirken hata oluştu"),oe([])}finally{O(!1)}}}),Fe=s=>{if(!s)return"-";try{const l=s.toDate?s.toDate():new Date(s);return _s(l,"dd MMMM yyyy HH:mm",{locale:Ns})}catch(l){return"-"}},re=()=>C(void 0,null,function*(){K(!0);try{const s=yield vs();a(s)}catch(s){console.error("Fetch products error:",s),k.error("Ürün listesi alınamadı.")}finally{K(!1)}}),ee=()=>C(void 0,null,function*(){if(t!=null&&t.id){r(!0);try{const s=yield Ts(t.id);S(s)}catch(s){k.error("Reçeteler yüklenemedi: "+s.message)}finally{r(!1)}}}),_e=s=>C(void 0,null,function*(){if(confirm("Bu reçeteyi silmek istediğinizden emin misiniz?"))try{yield As(s),k.success("Reçete silindi"),ee()}catch(l){k.error("Hata: "+l.message)}}),Be=()=>C(void 0,null,function*(){if(!H||!q||!(t!=null&&t.id)){k.error("Lütfen ürün ve miktar seçin");return}const s=parseFloat(q);if(isNaN(s)||s<=0){k.error("Geçerli bir miktar girin");return}r(!0);try{yield Fs(H,t.id,s),k.success("Reçete eklendi"),ee(),L(""),se("")}catch(l){k.error("Hata: "+l.message)}finally{r(!1)}});if(!t)return null;const ge=de(t.currentStock||t.stock||0,t.minStock||t.min_stock||0);return e.jsx(e.Fragment,{children:e.jsx(Ue,{open:f,onOpenChange:g,children:e.jsx(Ie,{className:"!max-w-[100vw] sm:!max-w-[95vw] !w-[100vw] sm:!w-[95vw] !h-[100vh] sm:!h-[90vh] !max-h-[100vh] sm:!max-h-[90vh] !left-0 sm:!left-[2.5vw] !top-0 sm:!top-[5vh] !right-0 sm:!right-auto !bottom-0 sm:!bottom-auto !translate-x-0 !translate-y-0 overflow-hidden !p-0 gap-0 bg-white flex flex-col !m-0 !rounded-none sm:!rounded-lg !border-0 sm:!border",children:e.jsxs("div",{className:"flex flex-col h-full min-h-0",children:[e.jsx(Ve,{className:"p-3 sm:p-4 border-b bg-white flex-shrink-0",children:e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 flex-1 min-w-0",children:[e.jsx("div",{className:"h-8 w-8 sm:h-10 sm:w-10 rounded-lg bg-primary/10 flex items-center justify-center border border-primary/20 flex-shrink-0",children:e.jsx(Q,{className:"h-4 w-4 sm:h-5 sm:w-5 text-primary"})}),e.jsx(Ye,{className:"text-lg sm:text-xl font-semibold text-foreground truncate",children:t.name}),e.jsx(qe,{className:"sr-only",children:"Hammadde detayları ve bilgileri"})]}),e.jsx("div",{className:"flex flex-wrap gap-2 flex-shrink-0 relative z-10 pr-10 sm:pr-12",children:e.jsx(Me,{variant:ge.variant,className:"text-xs px-2 sm:px-3 py-1 relative z-10",children:ge.label})})]})}),e.jsx("div",{className:"flex-1 overflow-hidden bg-gray-50/50 p-3 sm:p-4 min-h-0",children:e.jsx("div",{className:"max-w-full mx-auto h-full overflow-y-auto",children:e.jsxs(cs,{value:o,onValueChange:X,className:"w-full",children:[e.jsxs(os,{className:"grid w-full grid-cols-3 mb-4 sm:mb-6 min-h-[44px] sm:min-h-0 overflow-hidden",children:[e.jsx(ze,{value:"details",className:"text-sm sm:text-base whitespace-nowrap overflow-hidden text-ellipsis",children:"Detaylar"}),e.jsx(ze,{value:"recipes",className:"text-sm sm:text-base whitespace-nowrap overflow-hidden text-ellipsis",children:"Reçete"}),e.jsx(ze,{value:"transactions",className:"text-sm sm:text-base whitespace-nowrap overflow-hidden text-ellipsis",children:"Stok Hareketleri"})]}),e.jsxs(Re,{value:"details",className:"space-y-4 sm:space-y-6 mt-0",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-1",children:"Stok Kodu"}),e.jsx("p",{className:"font-medium",children:t.code||t.sku||"-"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-1",children:"Kategori"}),e.jsx("p",{className:"font-medium",children:Te(t.category||"other")})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-1",children:"Mevcut Stok"}),e.jsxs("p",{className:"font-medium text-lg",children:[t.currentStock!==void 0?t.currentStock:t.stock||0," ",t.unit||"Adet"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-1",children:"Minimum Stok"}),e.jsxs("p",{className:"font-medium",children:[t.minStock!==void 0?t.minStock:t.min_stock||0," ",t.unit||"Adet"]})]}),t.maxStock!==void 0&&t.maxStock!==null||t.max_stock?e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-1",children:"Maksimum Stok"}),e.jsxs("p",{className:"font-medium",children:[t.maxStock!==void 0?t.maxStock:t.max_stock||0," ",t.unit||"Adet"]})]}):null,t.unitPrice!==void 0||t.cost?e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-1",children:"Birim Fiyat"}),e.jsx("p",{className:"font-medium",children:(()=>{const s=t.unitPrice!==void 0&&t.unitPrice!==null?t.unitPrice:t.cost!==void 0&&t.cost!==null?t.cost:0,l=t.currency||(t.currencies&&t.currencies.length>0?t.currencies[0]:"TRY");return`${ne[l]||"₺"}${(s||0).toFixed(2)}`})()})]}):null,t.totalPrice!==void 0&&t.totalPrice!==null?e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-1",children:"Toplam Fiyat"}),e.jsx("p",{className:"font-medium",children:(()=>{const s=t.currency||(t.currencies&&t.currencies.length>0?t.currencies[0]:"TRY");return`${ne[s]||"₺"}${(t.totalPrice||0).toFixed(2)}`})()})]}):null,t.brand?e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-1",children:"Marka"}),e.jsx("p",{className:"font-medium",children:t.brand})]}):null,t.link?e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-1",children:"Link"}),e.jsx("a",{href:t.link,target:"_blank",rel:"noopener noreferrer",className:"font-medium text-primary hover:underline break-all",children:t.link})]}):null,t.supplier?e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-1",children:"Tedarikçi"}),e.jsx("p",{className:"font-medium",children:t.supplier})]}):null,t.purchasedBy?e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-1",children:"Satın Alan Kişi"}),e.jsx("p",{className:"font-medium",children:(()=>{const s=he.find(l=>l.id===t.purchasedBy);return s?s.fullName||s.displayName||s.email||"İsimsiz Kullanıcı":"Yükleniyor..."})()})]}):null,t.location?e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-1",children:"Hammadde Konumu"}),e.jsx("p",{className:"font-medium",children:t.location})]}):null]}),(t.notes||t.description)&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-1",children:"Açıklama"}),e.jsx("p",{className:"text-sm",children:t.notes||t.description||""})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 sm:gap-3 pt-4 border-t",children:[e.jsxs(A,{variant:"outline",onClick:R,className:"min-h-[44px] sm:min-h-0",children:[e.jsx(Je,{className:"mr-2 h-4 w-4"}),"Düzenle"]}),e.jsxs(A,{variant:"destructive",onClick:De,disabled:D,className:"min-h-[44px] sm:min-h-0",children:[e.jsx(Le,{className:"mr-2 h-4 w-4"}),D?"Siliniyor...":"Sil"]})]})]}),e.jsx(Re,{value:"recipes",className:"space-y-4 sm:space-y-6 mt-0",children:e.jsxs(G,{children:[e.jsx(we,{children:e.jsx(Se,{className:"text-lg sm:text-xl",children:"Reçete Yönetimi"})}),e.jsxs(W,{className:"space-y-6",children:[e.jsxs("div",{className:"rounded-lg border bg-muted/30 p-4 sm:p-6",children:[e.jsx("h3",{className:"text-sm sm:text-base font-semibold mb-4",children:"Yeni Reçete Ekle"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-3 sm:gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"product-select",className:"text-sm sm:text-base",children:"Ürün"}),e.jsxs(U,{value:H,onValueChange:L,disabled:B,children:[e.jsx(I,{id:"product-select",className:"min-h-[44px] sm:min-h-0",children:e.jsx(V,{placeholder:"Ürün seçin"})}),e.jsx(Y,{children:_.map(s=>e.jsxs(d,{value:s.id,children:[s.name," ",s.sku?`(${s.sku})`:""]},s.id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"quantity-input",className:"text-sm sm:text-base",children:"Miktar"}),e.jsx(v,{id:"quantity-input",type:"number",step:"0.01",min:"0.01",value:q,onChange:s=>se(s.target.value),placeholder:"Miktar",className:"min-h-[44px] sm:min-h-0"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{className:"text-sm sm:text-base opacity-0",children:"Ekle"}),e.jsxs(A,{onClick:Be,disabled:P||!H||!q,className:"w-full min-h-[44px] sm:min-h-0",children:[P?e.jsx(me,{className:"mr-2 h-4 w-4 animate-spin"}):e.jsx(Ze,{className:"mr-2 h-4 w-4"}),"Ekle"]})]})]})]}),P?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(me,{className:"h-6 w-6 animate-spin text-muted-foreground"})}):M.length===0?e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(Q,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{className:"text-sm sm:text-base",children:"Bu hammadde henüz hiçbir üründe kullanılmamış"})]}):e.jsx("div",{className:"rounded-lg border bg-white overflow-hidden",children:e.jsxs(He,{children:[e.jsx(Ke,{children:e.jsxs(le,{children:[e.jsx(y,{className:"text-sm sm:text-base",children:"Ürün Adı"}),e.jsx(y,{className:"text-sm sm:text-base",children:"Stok Kodu"}),e.jsx(y,{className:"text-sm sm:text-base",children:"Miktar"}),e.jsx(y,{className:"text-sm sm:text-base text-right",children:"İşlemler"})]})}),e.jsx(Oe,{children:M.map(s=>{const l=s.product;return e.jsxs(le,{children:[e.jsx(b,{className:"font-medium",children:(l==null?void 0:l.name)||"Silinmiş Ürün"}),e.jsx(b,{className:"text-muted-foreground font-mono text-xs sm:text-sm",children:(l==null?void 0:l.sku)||"-"}),e.jsxs(b,{children:[e.jsx("span",{className:"font-medium",children:s.quantityPerUnit}),e.jsx("span",{className:"text-sm text-muted-foreground ml-1",children:t.unit||"Adet"})]}),e.jsx(b,{className:"text-right",children:e.jsx(A,{variant:"ghost",size:"sm",onClick:()=>_e(s.id),className:"h-8 w-8 p-0 text-destructive hover:text-destructive min-h-[44px] sm:min-h-0",children:e.jsx(Le,{className:"h-4 w-4"})})})]},s.id)})})]})})]})]})}),e.jsx(Re,{value:"transactions",className:"space-y-4 sm:space-y-6 mt-0",children:e.jsxs(G,{children:[e.jsx(we,{children:e.jsx(Se,{className:"text-lg sm:text-xl",children:"Stok Hareketleri"})}),e.jsx(W,{children:J?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(me,{className:"h-6 w-6 animate-spin text-muted-foreground"})}):ue.length===0?e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(Q,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{className:"text-sm sm:text-base",children:"Henüz stok hareketi yapılmamış"})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(He,{children:[e.jsx(Ke,{children:e.jsxs(le,{children:[e.jsx(y,{children:"Tarih"}),e.jsx(y,{children:"İşlem Türü"}),e.jsx(y,{className:"text-right",children:"Miktar"}),e.jsx(y,{children:"Sipariş"}),e.jsx(y,{children:"Ürün"}),e.jsx(y,{children:"Kullanıcı"}),e.jsx(y,{children:"Açıklama"})]})}),e.jsx(Oe,{children:ue.map(s=>{const l=s.relatedOrderId?ae[s.relatedOrderId]:null,i=je[s.createdBy]||"Bilinmeyen";return e.jsxs(le,{children:[e.jsx(b,{className:"text-sm whitespace-nowrap",children:Fe(s.createdAt)}),e.jsx(b,{children:e.jsx(Me,{variant:s.type==="in"?"default":"destructive",children:s.type==="in"?"Giriş":"Çıkış"})}),e.jsxs(b,{className:`text-right font-medium whitespace-nowrap ${s.type==="in"?"text-green-600":"text-red-600"}`,children:[s.type==="in"?"+":"-",s.quantity]}),e.jsx(b,{className:"text-sm",children:l?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium",children:l.orderNumber}),s.relatedOrderId&&e.jsx(A,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0",onClick:()=>{window.open(`/production?orderId=${s.relatedOrderId}`,"_blank")},title:"Siparişi aç",children:e.jsx(ms,{className:"h-3 w-3"})})]}):"-"}),e.jsx(b,{className:"text-sm",children:(l==null?void 0:l.productName)||"-"}),e.jsx(b,{className:"text-sm",children:i}),e.jsx(b,{className:"text-sm max-w-xs truncate",title:s.reason,children:s.reason||"-"})]},s.id)})})]})})})]})})]})})})]})})})})},dt=()=>{ds();const f=ks(),g=c.useRef(null),[t,R]=c.useState([]),[N,D]=c.useState(""),[w,M]=c.useState("all"),[S,P]=c.useState(!1),[r,o]=c.useState(!1),[X,_]=c.useState(!1),[a,B]=c.useState(null),[K,H]=c.useState(!0),[L,q]=c.useState(1),[se]=c.useState(50),[he,ie]=c.useState(!1),[te,ce]=c.useState(null),[ue,oe]=c.useState(!1),[J,O]=c.useState(null),[ae,pe]=c.useState([]);c.useEffect(()=>{C(void 0,null,function*(){yield je(),yield Z()})},[]);const je=()=>C(void 0,null,function*(){try{const s=yield xe();pe(s)}catch(s){console.error("Error fetching users:",s)}}),Z=()=>C(void 0,null,function*(){H(!0);try{const s=yield Ps();let l=ae;l.length===0&&(l=yield xe(),pe(l));const i=s.map(j=>{const n=l.find(m=>m.id===j.createdBy);return u(h({},j),{created_by_name:n&&(n.fullName||n.displayName||n.email)||"-"})});R(i)}catch(s){console.error("Fetch materials error:",s),k.error(s.message||"Hammaddeler yüklenirken hata oluştu"),R([])}finally{H(!1)}});c.useEffect(()=>{if(ae.length>0&&t.length>0){const s=t.map(i=>{const j=ae.find(n=>n.id===i.createdBy);return u(h({},i),{created_by_name:j&&(j.fullName||j.displayName||j.email)||"-"})});s.some((i,j)=>{var n;return i.created_by_name!==((n=t[j])==null?void 0:n.created_by_name)})&&R(s)}},[ae.length]);const De=(s,l)=>{const i=Number(s)||0,j=Number(l)||0;return isNaN(i)||isNaN(j)?{label:"Bilinmiyor",variant:"outline",color:"text-gray-600",bgColor:"bg-gray-50"}:i===0?{label:"Tükendi",variant:"destructive",color:"text-red-600",bgColor:"bg-red-50"}:i<j?{label:"Düşük",variant:"secondary",color:"text-yellow-600",bgColor:"bg-yellow-50"}:{label:"Normal",variant:"default",color:"text-green-600",bgColor:"bg-green-50"}},Te=(s,l)=>{const i=Number(s)||0,j=Number(l)||0,n=i===0,m=i>0&&i<j;return{isOut:n,isLow:m,isNormal:!n&&!m}},de=c.useMemo(()=>Array.isArray(t)?t.filter(s=>{var x,T;const l=Number(s.currentStock!==void 0?s.currentStock:s.stock)||0,i=Number(s.minStock!==void 0?s.minStock:s.min_stock)||0,{isLow:j,isOut:n,isNormal:m}=Te(l,i);if(w==="low"&&!j||w==="out"&&!n||w==="normal"&&!m)return!1;if(N){const F=N.toLowerCase(),z=((x=s.name)==null?void 0:x.toLowerCase().includes(F))||!1,fe=((T=s.sku||s.code)==null?void 0:T.toLowerCase().includes(F))||!1;if(!z&&!fe)return!1}return!0}):[],[t,N,w]),E=c.useMemo(()=>{if(!Array.isArray(t))return{total:0,lowStock:0,outOfStock:0,normalStock:0,totalValue:0};const s=t.length,l=t.filter(m=>{const x=Number(m.currentStock!==void 0?m.currentStock:m.stock)||0,T=Number(m.minStock!==void 0?m.minStock:m.min_stock)||0;return!isNaN(x)&&!isNaN(T)&&x<T&&x>0}).length,i=t.filter(m=>{const x=Number(m.currentStock!==void 0?m.currentStock:m.stock)||0;return!isNaN(x)&&x===0}).length,j=s-l-i,n=t.reduce((m,x)=>{const T=Number(x.currentStock!==void 0?x.currentStock:x.stock)||0,F=Number(x.unitPrice!==void 0?x.unitPrice:x.cost)||0,z=T*F;return m+(isNaN(z)?0:z)},0);return{total:s,lowStock:l,outOfStock:i,normalStock:j,totalValue:n}},[t]),Ae=c.useMemo(()=>{var s,l,i;try{return`₺${new Intl.NumberFormat("tr-TR",{minimumFractionDigits:0,maximumFractionDigits:0}).format(E.totalValue||0)}`}catch(j){return`₺${(i=(l=(s=E.totalValue)==null?void 0:s.toFixed)==null?void 0:l.call(s,0))!=null?i:"0"}`}},[E.totalValue]),Fe=[{key:"total-materials",label:"Toplam Hammadde",value:E.total,accent:"bg-blue-100 text-blue-700",icon:Q,description:"Tüm kayıtlar",onClick:()=>{M("all"),D(""),O("total-materials")},isActive:J==="total-materials"},{key:"normal-stock",label:"Normal Stok",value:E.normalStock,accent:"bg-green-100 text-green-700",icon:xs,description:"Stok seviyesi yeterli",onClick:()=>{M("normal"),O("normal-stock")},isActive:J==="normal-stock"},{key:"low-stock",label:"Düşük Stok",value:E.lowStock,accent:"bg-yellow-100 text-yellow-700",icon:hs,description:"Min seviyenin altında",onClick:()=>{M("low"),O("low-stock")},isActive:J==="low-stock"},{key:"out-stock",label:"Tükenen",value:E.outOfStock,accent:"bg-red-100 text-red-700",icon:us,description:"Stoğu sıfırlananlar",onClick:()=>{M("out"),O("out-stock")},isActive:J==="out-stock"},{key:"total-value",label:"Toplam Değer",value:Ae,accent:"bg-purple-100 text-purple-700",icon:ps,description:"Detaylı raporlar",onClick:()=>{O("total-value"),oe(!0)},isActive:J==="total-value"}],re=Math.ceil(de.length/se),ee=de.slice((L-1)*se,L*se),_e=s=>{ce(s),ie(!0)},Be=()=>C(void 0,null,function*(){if(te)try{yield es(te.id),k.success("Hammadde silindi"),Z(),ie(!1),ce(null)}catch(s){console.error("Delete material error:",s),k.error(s.message||"Hammadde silinirken hata oluştu")}});c.useEffect(()=>{q(1)},[N,w]),c.useEffect(()=>{if(!f||K)return;let s,l,i=null;const j=()=>{if(!g.current||typeof window=="undefined")return;const m=g.current.querySelector("table");if(!m)return;const x=m.scrollWidth,T=g.current.clientWidth;x>T+10&&f.closeSidebar()};s=setTimeout(j,300),typeof ResizeObserver!="undefined"&&g.current&&(i=new ResizeObserver(()=>{clearTimeout(l),l=setTimeout(j,150)}),i.observe(g.current));const n=()=>{clearTimeout(l),l=setTimeout(j,150)};return window.addEventListener("resize",n),()=>{clearTimeout(s),clearTimeout(l),window.removeEventListener("resize",n),i&&i.disconnect()}},[ee,f,K]);const ge=(s,l,i)=>{const j=Number(s)||0,n=Number(l)||0,m=i?Number(i)||0:void 0;if(isNaN(j)||isNaN(n))return 0;if(m&&!isNaN(m)&&m>0){const x=j/m*100;return isNaN(x)?0:Math.min(100,Math.max(0,x))}if(n>0){const x=j/(n*2)*100;return isNaN(x)?0:Math.min(100,Math.max(0,x))}return j>0?50:0};return e.jsx(ys,{children:e.jsxs("div",{className:"space-y-3 sm:space-y-4 md:space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3 sm:gap-4",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h1",{className:"text-xl sm:text-2xl md:text-3xl font-bold text-foreground break-words",children:"Hammadde Yönetimi"}),e.jsx("p",{className:"text-muted-foreground mt-0.5 sm:mt-1 text-xs sm:text-sm",children:"Hammadde stoklarını yönetin ve takip edin"})]}),e.jsxs(A,{className:"gap-1.5 sm:gap-2 w-full sm:w-auto min-h-[44px] sm:min-h-10 text-xs sm:text-sm",onClick:()=>P(!0),children:[e.jsx(Ze,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Yeni Hammadde"}),e.jsx("span",{className:"sm:hidden",children:"Yeni"})]})]}),e.jsx(G,{className:"overflow-hidden",children:e.jsx(W,{className:"pt-4 sm:pt-6 overflow-hidden",children:e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-3 sm:gap-4",children:Fe.map(s=>{const l=s.icon;return e.jsx(G,{className:$("border border-border/60 shadow-none cursor-pointer transition-all hover:shadow-md focus-within:ring-2 focus-within:ring-primary/40 h-full flex flex-col",s.isActive&&"border-primary shadow-lg ring-2 ring-primary/20"),role:"button",tabIndex:0,onClick:s.onClick,onKeyDown:i=>{(i.key==="Enter"||i.key===" ")&&(i.preventDefault(),s.onClick())},"aria-label":`${s.label} kartı`,children:e.jsxs(W,{className:"p-3 sm:p-4 flex items-center gap-2 sm:gap-4 flex-1",children:[e.jsx("div",{className:$("h-10 w-10 sm:h-12 sm:w-12 rounded-xl sm:rounded-2xl flex items-center justify-center flex-shrink-0",s.accent),children:e.jsx(l,{className:"h-4 w-4 sm:h-5 sm:w-5"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-[10px] sm:text-xs uppercase tracking-wide text-muted-foreground truncate",children:s.label}),e.jsx("p",{className:"text-lg sm:text-xl md:text-2xl font-bold text-foreground mt-0.5 sm:mt-1 truncate",children:s.value}),e.jsx("p",{className:"text-[10px] sm:text-[11px] text-muted-foreground mt-0.5 hidden sm:block",children:s.description})]})]})},s.key)})})})}),e.jsx(G,{children:e.jsx(W,{className:"p-3 sm:p-4 md:p-6",children:e.jsxs("div",{className:"flex flex-col sm:flex-row items-stretch sm:items-center gap-2 sm:gap-3 md:gap-4",children:[e.jsx("div",{className:"flex-1 min-w-0 w-full sm:w-auto sm:min-w-[200px] md:min-w-[250px]",children:e.jsx(bs,{placeholder:"Ara (isim, stok kodu)...",className:"w-full h-9 sm:h-10 text-xs sm:text-sm",value:N,onChange:s=>D(s.target.value)})}),(N||w!=="all")&&e.jsxs(A,{variant:"outline",size:"sm",onClick:()=>{D(""),M("all"),O(null)},className:"h-9 sm:h-10 text-xs sm:text-sm",children:[e.jsx(Ee,{className:"h-3.5 w-3.5 sm:h-4 sm:w-4 sm:mr-2"}),e.jsx("span",{className:"hidden sm:inline",children:"Temizle"})]})]})})}),e.jsx(G,{className:"overflow-hidden",children:e.jsx(W,{className:"p-0 overflow-hidden",children:K?e.jsx(zs,{message:"Hammaddeler yükleniyor..."}):ee.length===0?e.jsx("div",{className:"text-center py-12 bg-muted/30 rounded-lg border border-dashed",children:e.jsxs("div",{className:"flex flex-col items-center gap-3",children:[e.jsx("div",{className:"rounded-full bg-muted p-4",children:e.jsx(Q,{className:"h-12 w-12 text-muted-foreground/50"})}),e.jsx("p",{className:"text-muted-foreground font-medium text-base",children:N||w!=="all"?"Arama sonucu bulunamadı":"Henüz hammadde bulunmuyor"}),e.jsx("p",{className:"text-sm text-muted-foreground/70 max-w-md",children:N||w!=="all"?"Filtreleri değiştirerek tekrar deneyin":"Yeni hammadde eklemek için yukarıdaki butona tıklayın"})]})}):e.jsxs(e.Fragment,{children:[e.jsx("div",{ref:g,className:"w-full overflow-hidden",children:e.jsxs(He,{className:"w-full table-fixed border-collapse",children:[e.jsx(Ke,{children:e.jsxs(le,{children:[e.jsx(y,{className:"w-[25%] sm:w-[20%]",children:"Hammadde"}),e.jsx(y,{className:"w-[15%] whitespace-nowrap hidden md:table-cell",children:"Stok Kodu"}),e.jsx(y,{className:"w-[10%] text-right whitespace-nowrap hidden xl:table-cell",children:"Stok Durumu"}),e.jsx(y,{className:"w-[15%] sm:w-[12%] text-right whitespace-nowrap",children:"Mevcut"}),e.jsx(y,{className:"w-[15%] whitespace-nowrap hidden lg:table-cell",children:"Ekleyen"}),e.jsx(y,{className:"w-[10%] whitespace-nowrap hidden lg:table-cell",children:"Durum"}),e.jsx(y,{className:"w-[20%] sm:w-[15%] text-right whitespace-nowrap",children:"İşlemler"})]})}),e.jsx(Oe,{children:ee.map(s=>{const l=Number(s.currentStock!==void 0?s.currentStock:s.stock)||0,i=Number(s.minStock!==void 0?s.minStock:s.min_stock)||0,j=s.maxStock!==void 0?s.maxStock:s.max_stock,n=De(l,i),m=ge(l,i,j);return e.jsxs(le,{className:$("cursor-pointer hover:bg-muted/50 transition-colors",n.bgColor),onClick:()=>{B(s),_(!0)},children:[e.jsx(b,{className:"font-medium",children:e.jsxs("div",{className:"flex flex-col gap-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-1.5 min-w-0",children:[e.jsx(Q,{className:"h-3.5 w-3.5 sm:h-4 sm:w-4 text-muted-foreground flex-shrink-0"}),e.jsx(Ne,{children:e.jsxs(ke,{children:[e.jsx(ye,{asChild:!0,children:e.jsx("span",{className:"truncate text-xs sm:text-sm",title:s.name,children:s.name})}),e.jsx(be,{children:e.jsx("p",{children:s.name})})]})})]}),e.jsx("div",{className:"flex items-center gap-1.5 md:hidden flex-wrap",children:e.jsx(Me,{variant:n.variant,className:$("font-medium text-[10px] px-1 py-0",n.variant==="destructive"&&"bg-red-500 hover:bg-red-600 text-white",n.variant==="secondary"&&"bg-yellow-500 hover:bg-yellow-600 text-white",n.variant==="default"&&"bg-green-500 hover:bg-green-600 text-white"),children:n.label})}),e.jsx("span",{className:"text-[10px] text-muted-foreground md:hidden font-mono",children:s.sku||s.code||"-"})]})}),e.jsx(b,{className:"hidden md:table-cell",children:e.jsx("span",{className:"text-xs text-muted-foreground font-mono bg-muted px-1.5 py-0.5 rounded truncate block",children:s.sku||s.code||"-"})}),e.jsx(b,{className:"text-right whitespace-nowrap hidden xl:table-cell",children:e.jsxs("div",{className:"flex flex-col items-end gap-0.5",children:[e.jsx(ws,{value:m,className:$("h-1.5 w-16",n.variant==="destructive"&&"[&>div]:bg-red-500",n.variant==="secondary"&&"[&>div]:bg-yellow-500",n.variant==="default"&&"[&>div]:bg-green-500")}),e.jsxs("span",{className:$("text-[10px] font-medium",n.color),children:[isNaN(m)?"0":m.toFixed(0),"%"]})]})}),e.jsx(b,{className:"text-right font-semibold whitespace-nowrap",children:e.jsx("div",{className:"flex flex-col items-end gap-0.5",children:e.jsxs("span",{className:$(n.color,"text-xs sm:text-sm"),children:[l," ",s.unit]})})}),e.jsx(b,{className:"hidden lg:table-cell",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(js,{className:"h-3 w-3 text-muted-foreground flex-shrink-0"}),e.jsx(Ne,{children:e.jsxs(ke,{children:[e.jsx(ye,{asChild:!0,children:e.jsx("span",{className:"text-xs truncate",title:s.created_by_name||"-",children:s.created_by_name||"-"})}),s.created_by_name&&e.jsx(be,{children:e.jsx("p",{children:s.created_by_name})})]})})]})}),e.jsx(b,{className:"hidden lg:table-cell",children:e.jsx(Me,{variant:n.variant,className:$("font-medium text-xs px-1.5 py-0.5",n.variant==="destructive"&&"bg-red-500 hover:bg-red-600 text-white",n.variant==="secondary"&&"bg-yellow-500 hover:bg-yellow-600 text-white",n.variant==="default"&&"bg-green-500 hover:bg-green-600 text-white"),children:n.label})}),e.jsx(b,{className:"text-right whitespace-nowrap",onClick:x=>x.stopPropagation(),children:e.jsxs("div",{className:"flex items-center justify-end gap-1 flex-wrap",children:[e.jsx(Ne,{children:e.jsxs(ke,{children:[e.jsx(ye,{asChild:!0,children:e.jsx(A,{variant:"outline",size:"sm",className:"h-7 w-7 sm:h-8 sm:w-8 p-0",onClick:x=>{x.stopPropagation(),B(s),o(!0)},children:e.jsx(Je,{className:"h-3.5 w-3.5"})})}),e.jsx(be,{children:e.jsx("p",{children:"Düzenle"})})]})}),e.jsx(Ne,{children:e.jsxs(ke,{children:[e.jsx(ye,{asChild:!0,children:e.jsx(A,{variant:"outline",size:"sm",className:"h-7 w-7 sm:h-8 sm:w-8 p-0 text-destructive hover:text-destructive hover:bg-destructive/10",onClick:x=>{x.stopPropagation(),_e(s)},children:e.jsx(Le,{className:"h-3.5 w-3.5"})})}),e.jsx(be,{children:e.jsx("p",{children:"Sil"})})]})})]})})]},s.id)})})]})}),re>1&&e.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-between gap-3 p-4 border-t",children:[e.jsxs("div",{className:"text-xs sm:text-sm text-muted-foreground text-center sm:text-left",children:["Toplam ",de.length," hammadde gösteriliyor"]}),e.jsxs("div",{className:"flex items-center gap-2 w-full sm:w-auto justify-center sm:justify-end",children:[e.jsx(A,{variant:"outline",size:"sm",onClick:()=>q(s=>Math.max(1,s-1)),disabled:L===1,children:"Önceki"}),e.jsxs("span",{className:"text-sm text-muted-foreground px-3",children:["Sayfa ",L," / ",re]}),e.jsx(A,{variant:"outline",size:"sm",onClick:()=>q(s=>Math.min(re,s+1)),disabled:L===re,children:"Sonraki"})]})]})]})})}),e.jsx(Vs,{open:S,onOpenChange:P,onSuccess:Z}),a&&e.jsxs(e.Fragment,{children:[e.jsx(Ys,{open:r,onOpenChange:o,material:a,onSuccess:()=>{Z(),o(!1)}}),e.jsx(qs,{open:X,onOpenChange:_,material:a,onEdit:()=>{_(!1),o(!0)},onDelete:()=>{Z(),_(!1)}})]}),e.jsx(Rs,{open:he,onOpenChange:ie,children:e.jsxs(Ls,{children:[e.jsxs(Hs,{children:[e.jsx(Ks,{children:"Hammadde Sil"}),e.jsxs(Os,{children:['"',te==null?void 0:te.name,'" hammaddesini silmek istediğinize emin misiniz? Bu işlem geri alınamaz.']})]}),e.jsxs(Es,{children:[e.jsx(Us,{children:"İptal"}),e.jsx(Is,{onClick:Be,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Sil"})]})]})}),e.jsx(Bs,{open:ue,onOpenChange:oe,title:"Hammadde Değer Raporu",type:"rawMaterials",data:t})]})})};export{dt as default};
