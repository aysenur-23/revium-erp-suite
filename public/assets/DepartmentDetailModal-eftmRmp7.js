import{k as Ee,r as o,as as $e,ak as pe,b as fe,j as e,L as ge,C as w,e as T,S as ie,p as de,q as ce,s as me,t as L,B as je,a7 as Ae,at as Le,a8 as Ce,g as ke,au as Me,c as X,d as Z,o as be,a1 as Be}from"./index-Xd90qdO9.js";import{B as v,W as Ne,w as C,D as Oe,a as Re,b as Pe,j as _e,c as He,d as Ue,C as ze,z as ye}from"./MainLayout-DW7UjMSA.js";import{S as Fe}from"./search-input-QX7HVhJf.js";import{D as Ve}from"./download-Bq-rl9Ru.js";import{f as D}from"./format-DuC-NjES.js";import{P as Ge}from"./progress-DSBhhNxd.js";import{S as oe}from"./skeleton-DkPhyqEs.js";import{T as Ye,a as Ie,b as ve,c as U,d as Ke,e as z}from"./table-CHpYTcky.js";import{b as Je}from"./taskService-CQO0i9v5.js";import{T as qe}from"./trending-up-DyiN6Ad2.js";const F={CREATE:{color:"bg-green-500",label:"Oluşturma",verb:"oluşturdu",short:"Yeni kayıt"},UPDATE:{color:"bg-blue-500",label:"Güncelleme",verb:"güncelledi",short:"Güncelleme"},DELETE:{color:"bg-red-500",label:"Silme",verb:"sildi",short:"Silme"}},V={tasks:"Görevler",user_roles:"Kullanıcı Rolleri",departments:"Departmanlar",production_orders:"Üretim Siparişleri",production_processes:"Üretim Süreçleri",profiles:"Profiller",notifications:"Bildirimler",shared_files:"Paylaşılan Dosyalar",task_assignments:"Görev Atamaları",role_permissions:"Rol Yetkileri",orders:"Siparişler",customers:"Müşteriler",products:"Ürünler",projects:"Projeler",reports:"Raporlar"},ue={tasks:"Görevler",orders:"Siparişler",customers:"Müşteriler",products:"Ürünler",production_orders:"Üretim Siparişleri",user_roles:"Kullanıcı Yönetimi",departments:"Departmanlar",profiles:"Profil Ayarları",notifications:"Bildirimler",shared_files:"Paylaşılan Dosyalar",task_assignments:"Görev Atamaları",role_permissions:"Rol Yetkileri",projects:"Projeler",reports:"Raporlar"},G={title:"Başlık",description:"Açıklama",status:"Durum",priority:"Öncelik",dueDate:"Bitiş Tarihi",assignedTo:"Atanan",createdBy:"Oluşturan",updatedAt:"Güncellenme Tarihi",customerId:"Müşteri",customerName:"Müşteri Adı",totalAmount:"Toplam Tutar",subtotal:"Ara Toplam",discountTotal:"İndirim",taxAmount:"KDV",grandTotal:"Genel Toplam",orderNumber:"Sipariş Numarası",deliveryDate:"Teslimat Tarihi",name:"İsim",email:"E-posta",phone:"Telefon",company:"Şirket",address:"Adres",role:"Rol",fullName:"Ad Soyad",department:"Departman",isActive:"Aktif",isArchived:"Arşivlendi",approvalStatus:"Onay Durumu",rejectionReason:"Red Nedeni",approvedBy:"Onaylayan",rejectedBy:"Reddeden",approvedAt:"Onay Tarihi",rejectedAt:"Red Tarihi",isInPool:"Görev Havuzunda",poolRequests:"Havuz İstekleri",reportType:"Rapor Tipi",startDate:"Başlangıç Tarihi",endDate:"Bitiş Tarihi"},ee={pending:"Beklemede",in_progress:"Devam Ediyor",completed:"Tamamlandı",cancelled:"İptal Edildi",confirmed:"Onaylandı",shipped:"Kargoda",delivered:"Teslim Edildi",on_hold:"Beklemede",draft:"Taslak",approved:"Onaylandı",rejected:"Reddedildi",none:"Yok",active:"Aktif",inactive:"Pasif",true:"Evet",false:"Hayır"},ls=({mode:j="admin",userId:E})=>{const{user:N,isAdmin:u,isTeamLeader:Y}=Ee(),[M,se]=o.useState([]),[f,I]=o.useState(!0),[B,K]=o.useState(""),[g,J]=o.useState("all"),[S,k]=o.useState("all"),[te,re]=o.useState(new Set),[i,$]=o.useState(100),[ae,q]=o.useState(!1),[y,R]=o.useState(null),[x,P]=o.useState([]),[b,_]=o.useState("all"),[ne,W]=o.useState(new Set);o.useEffect(()=>{(async()=>{if(N!=null&&N.id)try{const[t,l]=await Promise.all([Ce(),ke()]);if(P(t),Y&&!u){const r=t.filter(n=>n.managerId===N.id).map(n=>n.id),d=new Set(l.filter(n=>!!(n.approvedTeams&&n.approvedTeams.some(A=>r.includes(A))||n.pendingTeams&&n.pendingTeams.some(A=>r.includes(A))||n.departmentId&&r.includes(n.departmentId))).map(n=>n.id));W(d),_("all")}else if(u&&b!=="all")if(t.find(r=>r.id===b)){const r=new Set(l.filter(d=>!!(d.approvedTeams&&d.approvedTeams.includes(b)||d.pendingTeams&&d.pendingTeams.includes(b)||d.departmentId===b)).map(d=>d.id));W(r)}else W(new Set);else W(new Set)}catch(t){console.error("Error loading departments:",t)}})()},[N,u,Y,b]);const xe=o.useCallback(async()=>{I(!0);try{let s=[],t=null;if(j==="team"&&E){const l=await $e(E);s=l.logs,t=l.teamInfo,R(t)}else j==="personal"&&E?(s=await pe({userId:E}),R(null)):(s=await pe({limit:i,action:g!=="all"?g:void 0,tableName:S!=="all"?S:void 0}),ne.size>0&&(s=s.filter(l=>ne.has(l.userId))),R(null),q(s.length===i));se(s)}catch(s){const t=s instanceof Error?s.message:"Bilinmeyen hata";fe.error("Loglar yüklenemedi: "+t)}finally{I(!1)}},[j,E,g,S,i,ne]),we=o.useCallback(()=>{$(s=>s+100)},[]);o.useEffect(()=>{$(100)},[g,S,j,E]),o.useEffect(()=>{xe()},[xe]);const he=s=>{re(t=>{const l=new Set(t);return l.has(s)?l.delete(s):l.add(s),l})},Te=()=>{const s=["Tarih","Kullanıcı","İşlem","Tablo","Detaylar"],t=H.map(d=>[D(d.createdAt.toDate(),"dd.MM.yyyy HH:mm",{locale:C}),d.userName||"Sistem",d.action,V[d.tableName]||d.tableName,d.action==="CREATE"?"Yeni kayıt":d.action==="UPDATE"?"Güncelleme":"Silme"]),l=[s.join(","),...t.map(d=>d.map(n=>`"${n}"`).join(","))].join(`
`),a=new Blob(["\uFEFF"+l],{type:"text/csv;charset=utf-8;"}),r=document.createElement("a");r.href=URL.createObjectURL(a),r.download=`audit_logs_${D(new Date,"yyyyMMdd_HHmmss")}.csv`,r.click(),fe.success("Log'lar CSV olarak indirildi")},le=(s,t)=>!s||!t?[]:Object.keys(t).filter(l=>{const a=s[l],r=t[l];return JSON.stringify(a)!==JSON.stringify(r)}),O=(s,t)=>s==null?"Yok":typeof s=="boolean"?s?"Evet":"Hayır":s instanceof Date?D(s,"dd.MM.yyyy HH:mm",{locale:C}):typeof s=="object"&&s.toDate?D(s.toDate(),"dd.MM.yyyy HH:mm",{locale:C}):typeof s=="object"?Array.isArray(s)?s.length>0?`${s.length} öğe`:"Boş":JSON.stringify(s):t==="status"&&ee[String(s)]||t==="approvalStatus"&&ee[String(s)]?ee[String(s)]:String(s),Q=(s,t)=>s?t==="orders"&&s.orderNumber?s.orderNumber:t==="tasks"&&s.title?s.title:t==="customers"&&s.name||t==="products"&&s.name||t==="projects"&&s.name?s.name:t==="reports"&&s.title?s.title:t==="task_assignments"&&s.taskTitle?s.taskTitle:s.name?s.name:s.title?s.title:s.id?String(s.id):null:null,Se=s=>{const t=s.userName||(s.userEmail?s.userEmail.split("@")[0]:null)||"Sistem",l=ue[s.tableName]||V[s.tableName]||s.tableName,a=F[s.action],r=Q(s.newData||s.oldData,s.tableName)||Q(s.oldData,s.tableName),d=(a==null?void 0:a.verb)||"işlem yaptı";let n=`${t}, ${l} bölümünde ${(a==null?void 0:a.short.toLowerCase())||"bir işlem"} yaptı.`;if(s.action==="UPDATE"&&s.oldData&&s.newData){le(s.oldData,s.newData);const c=De(s.oldData,s.newData,s.tableName,r);if(r)if(c.length>0){const m=c[0];if(n=`${t}, "${r}" ${m}.`,c.length>1){const p=c.slice(1).join(", ");n+=` Ayrıca ${p}.`}}else n=`${t}, "${r}" kaydını ${d}.`;else c.length>0?(n=`${t}, ${l} bölümünde ${c[0]}.`,c.length>1&&(n+=` Ayrıca ${c.slice(1).join(", ")}.`)):n=`${t}, ${l} bölümünde bir kaydı ${d}.`}else r&&(n=`${t}, ${l} bölümünde "${r}" kaydını ${d}.`);const A=D(s.createdAt.toDate(),"dd MMMM yyyy, HH:mm",{locale:C}),h=[s.userEmail?`E-posta: ${s.userEmail}`:null,r?`İsim: ${r}`:null].filter(Boolean);return{description:n,timestamp:A,metaLine:h.join(" • ")}},De=(s,t,l,a)=>{if(!s||!t)return[];const r=[];return le(s,t).forEach(n=>{const A=G[n]||n,h=O(s[n],n),c=O(t[n],n);if(n==="status"&&l==="tasks"){const m=a||s.title||t.title||"görev";r.push(`"${m}" görevinin durumunu "${h}"'den "${c}"'e değiştirdi`)}else if(n==="status"&&l==="orders"){const m=a||s.orderNumber||t.orderNumber||"sipariş";r.push(`"${m}" siparişinin durumunu "${h}"'den "${c}"'e değiştirdi`)}else if(n==="status"&&l==="production_orders"){const m=a||s.orderNumber||t.orderNumber||"üretim siparişi";r.push(`"${m}" üretim siparişinin durumunu "${h}"'den "${c}"'e değiştirdi`)}else if(n==="approvalStatus"){const m=a||s.title||t.title||"",p=m?`"${m}" görevinin `:"";c==="Onaylandı"?r.push(`${p}onay durumunu "Beklemede"den "Onaylandı"ya güncelledi`):c==="Reddedildi"?r.push(`${p}onay durumunu "Beklemede"den "Reddedildi"ye güncelledi`):r.push(`${p}onay durumunu "${h}"'den "${c}"'e değiştirdi`)}else if(n==="rejectionReason"){const m=a||s.title||t.title||"",p=m?`"${m}" görevi için `:"";r.push(`${p}red nedeni ekledi: "${c}"`)}else if(n==="title"&&l==="tasks")r.push(`görev başlığını "${h}"'den "${c}"'e değiştirdi`);else if(n==="description"&&l==="tasks"){const m=a||s.title||t.title||"",p=m?`"${m}" `:"";r.push(`${p}görev açıklamasını güncelledi`)}else if(n==="priority"&&l==="tasks"){const m=a||s.title||t.title||"",p=m?`"${m}" görevinin `:"";r.push(`${p}önceliği "${h}"'den "${c}"'e değiştirdi`)}else if(n==="dueDate"&&l==="tasks"){const m=a||s.title||t.title||"",p=m?`"${m}" görevinin `:"";r.push(`${p}bitiş tarihini "${h}"'den "${c}"'e değiştirdi`)}else if(n==="role")r.push(`rolünü "${h}"'den "${c}"'e değiştirdi`);else if(n==="assignedTo"||n==="assignedUsers"){const m=a||s.title||t.title||"",p=l==="tasks"&&m?`"${m}" görevinin `:"";r.push(`${p}atanan kişiyi "${h}"'den "${c}"'e değiştirdi`)}else if(n==="totalAmount"||n==="grandTotal"||n==="subtotal"){const m=typeof h=="string"?h:`₺${h}`,p=typeof c=="string"?c:`₺${c}`;r.push(`${A} ${m}'den ${p}'e güncelledi`)}else n==="name"&&(l==="customers"||l==="products"||l==="projects")?r.push(`${l==="customers"?"müşteri":l==="products"?"ürün":"proje"} adını "${h}"'den "${c}"'e değiştirdi`):n==="orderNumber"&&l==="orders"?r.push(`sipariş numarasını "${h}"'den "${c}"'e değiştirdi`):r.push(`${A} "${h}"'den "${c}"'e değiştirdi`)}),r},H=o.useMemo(()=>{const s=B.trim().toLowerCase();return M.filter(t=>{var d,n;const l=s===""||t.action.toLowerCase().includes(s)||t.tableName.toLowerCase().includes(s)||((d=t.userName)==null?void 0:d.toLowerCase().includes(s))||((n=t.userEmail)==null?void 0:n.toLowerCase().includes(s))||JSON.stringify(t.oldData??{}).toLowerCase().includes(s)||JSON.stringify(t.newData??{}).toLowerCase().includes(s),a=g==="all"||t.action===g,r=S==="all"||t.tableName===S;return l&&a&&r})},[M,B,g,S]);return f?e.jsx("div",{className:"flex items-center justify-center p-8",children:e.jsx(ge,{className:"h-8 w-8 animate-spin text-primary"})}):e.jsxs("div",{className:"space-y-6",children:[u&&j==="admin"&&e.jsx(w,{children:e.jsx(T,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("label",{className:"text-sm font-medium",children:"Ekip Seç:"}),e.jsxs(ie,{value:b,onValueChange:_,children:[e.jsx(de,{className:"w-full sm:w-[250px]",children:e.jsx(ce,{placeholder:"Ekip seçiniz"})}),e.jsxs(me,{children:[e.jsx(L,{value:"all",children:"Tüm Ekipler"}),x.map(s=>e.jsx(L,{value:s.id,children:s.name},s.id))]})]})]})})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:j==="team"?"Ekip Logları":j==="personal"?"Kişisel Loglar":"Sistem Logları"}),e.jsx("p",{className:"text-muted-foreground",children:j==="team"?"Yönettiğiniz ekiplerdeki üyelerin ve sizin işlem geçmişiniz":j==="personal"?"Kendi işlem geçmişiniz":"Sistemdeki tüm kullanıcıların tüm işlemlerinin detaylı kaydı"}),j==="team"&&y&&!u&&e.jsx(w,{className:"bg-gradient-to-br from-blue-50/50 to-transparent border-blue-200",children:e.jsx(T,{className:"p-4",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs(v,{variant:"outline",className:"text-xs",children:[y.managedTeams.length," Ekip Yönetiliyor"]}),e.jsxs(v,{variant:"outline",className:"text-xs",children:[y.teamMembers.length," Ekip Üyesi"]}),e.jsxs(v,{variant:"outline",className:"text-xs",children:[M.length," Log Kaydı"]})]}),y.managedTeams.length>0&&e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"font-medium text-foreground",children:"Yönettiğiniz Ekipler:"})," ",e.jsx("span",{className:"text-muted-foreground",children:y.managedTeams.map(s=>s.name).join(", ")})]}),y.teamMembers.length>0&&e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"font-medium text-foreground",children:"Ekip Üyeleri:"})," ",e.jsx("span",{className:"text-muted-foreground",children:y.teamMembers.map(s=>s.name).join(", ")})]}),y.teamMembers.length===0&&y.managedTeams.length>0&&e.jsxs("div",{className:"text-sm text-yellow-700 bg-yellow-100 p-3 rounded-lg border border-yellow-200",children:[e.jsx("span",{className:"font-medium",children:"⚠️ Bilgi:"})," Yönettiğiniz ekiplerde henüz üye bulunmuyor. Üyeler eklendiğinde ve işlem yaptığında logları burada görebilirsiniz."]}),y.managedTeams.length===0&&e.jsxs("div",{className:"text-sm text-blue-700 bg-blue-100 p-3 rounded-lg border border-blue-200",children:[e.jsx("span",{className:"font-medium",children:"ℹ️ Bilgi:"})," Henüz yönettiğiniz bir ekip bulunmuyor. Ekip lideri olarak atandığınızda, o ekipteki üyelerin loglarını burada görebilirsiniz."]})]})})})]}),e.jsx(w,{children:e.jsxs(T,{className:"pt-6 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"text-sm text-muted-foreground",children:[H.length," kayıt bulundu"]}),e.jsxs(je,{onClick:Te,variant:"outline",size:"sm",children:[e.jsx(Ve,{className:"h-4 w-4 mr-2"}),"CSV İndir"]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsx(Fe,{placeholder:"İçerikte ara...",value:B,onChange:s=>K(s.target.value),containerClassName:"flex-1"}),e.jsxs(ie,{value:g,onValueChange:J,children:[e.jsx(de,{className:"w-full sm:w-[180px]",children:e.jsx(ce,{})}),e.jsxs(me,{children:[e.jsx(L,{value:"all",children:"Tüm İşlemler"}),e.jsx(L,{value:"CREATE",children:"Oluşturma"}),e.jsx(L,{value:"UPDATE",children:"Güncelleme"}),e.jsx(L,{value:"DELETE",children:"Silme"})]})]}),e.jsxs(ie,{value:S,onValueChange:k,children:[e.jsx(de,{className:"w-full sm:w-[180px]",children:e.jsx(ce,{})}),e.jsxs(me,{children:[e.jsx(L,{value:"all",children:"Tüm Tablolar"}),Object.entries(V).map(([s,t])=>e.jsx(L,{value:s,children:t},s))]})]})]}),e.jsxs("div",{className:"space-y-4",children:[H.length===0?e.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[e.jsx(Ne,{className:"h-12 w-12 mx-auto mb-3 opacity-20"}),e.jsx("p",{children:"Hiç log bulunamadı"})]}):H.map(s=>{const t=te.has(s.id),l=s.action==="UPDATE"?le(s.oldData,s.newData):[];return e.jsx(w,{className:"hover:shadow-md transition-shadow",children:e.jsxs(T,{className:"p-4",children:[e.jsx("div",{className:"cursor-pointer select-none",onClick:a=>{a.stopPropagation(),he(s.id)},onKeyDown:a=>{(a.key==="Enter"||a.key===" ")&&(a.preventDefault(),a.stopPropagation(),he(s.id))},role:"button",tabIndex:0,"aria-expanded":t,"aria-label":t?"Log detaylarını kapat":"Log detaylarını aç",children:(()=>{const a=Se(s);return e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-wrap",children:[e.jsx(v,{className:F[s.action].color,onClick:r=>r.stopPropagation(),children:F[s.action].label}),e.jsx(v,{variant:"outline",className:"text-xs",onClick:r=>r.stopPropagation(),children:ue[s.tableName]||V[s.tableName]||s.tableName}),e.jsx("span",{className:"text-xs text-muted-foreground",children:a.timestamp})]}),e.jsx("p",{className:"text-sm text-foreground leading-relaxed font-medium",children:a.description}),a.metaLine&&e.jsx("p",{className:"text-xs text-muted-foreground",children:a.metaLine}),s.action==="UPDATE"&&l.length>0&&e.jsxs("div",{className:"flex flex-wrap gap-1 mt-2",onClick:r=>r.stopPropagation(),children:[l.slice(0,5).map(r=>e.jsx(v,{variant:"secondary",className:"text-xs pointer-events-none",children:G[r]||r},r)),l.length>5&&e.jsxs(v,{variant:"secondary",className:"text-xs pointer-events-none",children:["+",l.length-5," daha"]})]})]}),e.jsx("div",{className:"flex-shrink-0",children:t?e.jsx(Ae,{className:"h-5 w-5 text-muted-foreground"}):e.jsx(Le,{className:"h-5 w-5 text-muted-foreground"})})]})})()}),t&&e.jsxs("div",{className:"mt-4 pt-4 border-t space-y-4",children:[e.jsxs("div",{className:"bg-gradient-to-r from-blue-50/50 to-purple-50/50 dark:from-blue-950/20 dark:to-purple-950/20 rounded-lg p-4 border border-blue-200/50 dark:border-blue-800/50",children:[e.jsxs("h4",{className:"font-semibold text-sm mb-3 flex items-center gap-2",children:[e.jsx(Ne,{className:"h-4 w-4"}),"Genel Bilgiler"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-xs font-medium text-muted-foreground uppercase tracking-wide",children:"Kullanıcı"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-8 w-8 rounded-full bg-gradient-to-br from-blue-500 to-purple-500 flex items-center justify-center text-white font-semibold text-xs",children:(s.userName||s.userEmail||"S").charAt(0).toUpperCase()}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-semibold text-sm",children:s.userName||(s.userEmail?s.userEmail.split("@")[0]:"Sistem")}),s.userEmail&&e.jsx("span",{className:"text-xs text-muted-foreground",children:s.userEmail})]})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-xs font-medium text-muted-foreground uppercase tracking-wide",children:"Kayıt Bilgileri"}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:ue[s.tableName]||V[s.tableName]||s.tableName}),(()=>{const a=Q(s.newData||s.oldData,s.tableName)||Q(s.oldData,s.tableName);return a?e.jsx("span",{className:"font-semibold text-sm mt-1",children:a}):null})()]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-xs font-medium text-muted-foreground uppercase tracking-wide",children:"İşlem Tipi"}),e.jsx("div",{children:e.jsx(v,{className:F[s.action].color,children:F[s.action].label})})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-xs font-medium text-muted-foreground uppercase tracking-wide",children:"Tarih & Saat"}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-semibold text-sm",children:D(s.createdAt.toDate(),"dd MMMM yyyy",{locale:C})}),e.jsx("span",{className:"text-xs text-muted-foreground",children:D(s.createdAt.toDate(),"HH:mm:ss",{locale:C})})]})]})]})]}),s.action==="UPDATE"&&s.oldData&&s.newData&&l.length>0&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("h4",{className:"font-semibold text-sm flex items-center gap-2",children:[e.jsx("div",{className:"h-1.5 w-1.5 rounded-full bg-blue-500"}),"Değişiklik Detayları",e.jsxs(v,{variant:"outline",className:"ml-auto text-xs",children:[l.length," alan değiştirildi"]})]}),e.jsx("div",{className:"space-y-3",children:l.map(a=>{const r=G[a]||a,d=O(s.oldData[a],a),n=O(s.newData[a],a);return e.jsxs("div",{className:"bg-gradient-to-r from-red-50/50 to-green-50/50 dark:from-red-950/20 dark:to-green-950/20 rounded-lg p-4 border border-red-200/50 dark:border-red-800/50 hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"font-semibold text-sm mb-2 flex items-center gap-2",children:[e.jsx("div",{className:"h-2 w-2 rounded-full bg-blue-500"}),r]}),e.jsxs("div",{className:"flex items-center gap-3 text-sm",children:[e.jsxs("div",{className:"flex-1 bg-white dark:bg-gray-900 rounded-md p-2 border border-red-200 dark:border-red-800",children:[e.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:"Eski Değer"}),e.jsx("span",{className:"text-red-600 dark:text-red-400 line-through font-medium",children:d})]}),e.jsx("div",{className:"text-muted-foreground text-lg",children:"→"}),e.jsxs("div",{className:"flex-1 bg-white dark:bg-gray-900 rounded-md p-2 border border-green-200 dark:border-green-800",children:[e.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:"Yeni Değer"}),e.jsx("span",{className:"text-green-600 dark:text-green-400 font-semibold",children:n})]})]})]},a)})})]}),s.action==="CREATE"&&s.newData&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("h4",{className:"font-semibold text-sm flex items-center gap-2",children:[e.jsx("div",{className:"h-1.5 w-1.5 rounded-full bg-green-500"}),"Oluşturulan Bilgiler",e.jsxs(v,{variant:"outline",className:"ml-auto text-xs bg-green-50 dark:bg-green-950/20 border-green-200 dark:border-green-800",children:[Object.keys(s.newData).length," alan"]})]}),e.jsxs("div",{className:"bg-gradient-to-r from-green-50/50 to-emerald-50/50 dark:from-green-950/20 dark:to-emerald-950/20 rounded-lg p-4 border border-green-200/50 dark:border-green-800/50",children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:Object.entries(s.newData).slice(0,12).map(([a,r])=>{const d=G[a]||a,n=O(r,a);return e.jsxs("div",{className:"bg-white dark:bg-gray-900 rounded-md p-3 border border-green-200/50 dark:border-green-800/50",children:[e.jsx("div",{className:"text-xs font-medium text-muted-foreground mb-1 uppercase tracking-wide",children:d}),e.jsx("div",{className:"text-sm font-medium text-foreground break-words",children:n})]},a)})}),Object.keys(s.newData).length>12&&e.jsxs("div",{className:"mt-3 text-center text-xs text-muted-foreground italic bg-white dark:bg-gray-900 rounded-md p-2 border border-green-200/50 dark:border-green-800/50",children:["+",Object.keys(s.newData).length-12," alan daha..."]})]})]}),s.action==="DELETE"&&s.oldData&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("h4",{className:"font-semibold text-sm flex items-center gap-2",children:[e.jsx("div",{className:"h-1.5 w-1.5 rounded-full bg-red-500"}),"Silinen Bilgiler",e.jsxs(v,{variant:"outline",className:"ml-auto text-xs bg-red-50 dark:bg-red-950/20 border-red-200 dark:border-red-800",children:[Object.keys(s.oldData).length," alan"]})]}),e.jsxs("div",{className:"bg-gradient-to-r from-red-50/50 to-rose-50/50 dark:from-red-950/20 dark:to-rose-950/20 rounded-lg p-4 border border-red-200/50 dark:border-red-800/50",children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:Object.entries(s.oldData).slice(0,12).map(([a,r])=>{const d=G[a]||a,n=O(r,a);return e.jsxs("div",{className:"bg-white dark:bg-gray-900 rounded-md p-3 border border-red-200/50 dark:border-red-800/50 opacity-75",children:[e.jsx("div",{className:"text-xs font-medium text-muted-foreground mb-1 uppercase tracking-wide",children:d}),e.jsx("div",{className:"text-sm font-medium text-red-600 dark:text-red-400 break-words line-through",children:n})]},a)})}),Object.keys(s.oldData).length>12&&e.jsxs("div",{className:"mt-3 text-center text-xs text-muted-foreground italic bg-white dark:bg-gray-900 rounded-md p-2 border border-red-200/50 dark:border-red-800/50",children:["+",Object.keys(s.oldData).length-12," alan daha..."]})]})]})]})]})},s.id)}),ae&&j==="admin"&&!f&&e.jsx("div",{className:"flex justify-center mt-6",children:e.jsxs(je,{onClick:we,variant:"outline",className:"gap-2",children:[e.jsx(ge,{className:"h-4 w-4"}),"Daha Fazla Yükle (",i," / ",H.length,")"]})})]})]})})]})},is=({open:j,onOpenChange:E,departmentId:N})=>{const[u,Y]=o.useState(null),[M,se]=o.useState([]),[f,I]=o.useState([]),[B,K]=o.useState(!0),[g,J]=o.useState(null);o.useEffect(()=>{j&&N&&S()},[j,N]);const S=async()=>{K(!0);try{const[i,$,ae]=await Promise.all([Me(N),ke(),Je()]);if(Y(i),i.managerId){const x=$.find(P=>P.id===i.managerId&&!P.deleted);J(x||null)}else J(null);const q=$.filter(x=>!!(x.departmentId===N||x.approvedTeams&&x.approvedTeams.includes(N)||x.pendingTeams&&x.pendingTeams.includes(N)));se(q);const y=new Set(q.map(x=>x.id)),R=ae.filter(x=>!!(x.productionProcessId===N||x.assignedUsers&&Array.isArray(x.assignedUsers)&&x.assignedUsers.some(b=>{if(typeof b=="string")return y.has(b);if(b&&typeof b=="object"){const _=b.id||b.assignedTo||b.userId;return _&&y.has(_)}return!1})||x.createdBy&&y.has(x.createdBy)));I(R)}catch(i){console.error("Error fetching department details:",i)}finally{K(!1)}},k={totalMembers:M.length,activeTasks:f.filter(i=>i.status!=="completed"&&i.status!=="cancelled").length,completedTasks:f.filter(i=>i.status==="completed").length,pendingTasks:f.filter(i=>i.status==="pending").length,inProgressTasks:f.filter(i=>i.status==="in_progress").length,completionRate:f.length>0?f.filter(i=>i.status==="completed").length/f.length*100:0},te=i=>{switch(i){case"completed":return"bg-green-500";case"in_progress":return"bg-blue-500";case"pending":return"bg-yellow-500";case"cancelled":return"bg-red-500";default:return"bg-gray-500"}},re=i=>{switch(i){case"completed":return"Tamamlandı";case"in_progress":return"Devam Ediyor";case"pending":return"Beklemede";case"cancelled":return"İptal Edildi";default:return i}};return e.jsx(Oe,{open:j,onOpenChange:E,children:e.jsx(Re,{className:"!max-w-[100vw] sm:!max-w-[95vw] !w-[100vw] sm:!w-[95vw] !h-[100vh] sm:!h-[90vh] !max-h-[100vh] sm:!max-h-[90vh] !left-0 sm:!left-[2.5vw] !top-0 sm:!top-[5vh] !right-0 sm:!right-auto !bottom-0 sm:!bottom-auto !translate-x-0 !translate-y-0 overflow-hidden !p-0 gap-0 bg-white flex flex-col !m-0 !rounded-none sm:!rounded-lg !border-0 sm:!border",children:e.jsxs("div",{className:"flex flex-col h-full min-h-0",children:[e.jsx(Pe,{className:"p-3 sm:p-4 border-b bg-white flex-shrink-0",children:e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3",children:[e.jsx("div",{className:"h-8 w-8 sm:h-10 sm:w-10 rounded-lg bg-primary/10 flex items-center justify-center border border-primary/20 flex-shrink-0",children:e.jsx(_e,{className:"h-4 w-4 sm:h-5 sm:w-5 text-primary"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx(He,{className:"text-lg sm:text-xl font-semibold text-foreground truncate",children:B?"Yükleniyor...":(u==null?void 0:u.name)||"Departman Detayları"}),(u==null?void 0:u.description)&&e.jsx(Ue,{className:"text-xs text-muted-foreground truncate mt-0.5",children:u.description})]})]})}),e.jsx("div",{className:"flex-1 overflow-hidden bg-gray-50/50 p-3 sm:p-4 min-h-0",children:e.jsx("div",{className:"max-w-full mx-auto h-full overflow-y-auto",children:B?e.jsxs("div",{className:"space-y-4",children:[e.jsx(oe,{className:"h-32 w-full"}),e.jsx(oe,{className:"h-64 w-full"}),e.jsx(oe,{className:"h-64 w-full"})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs(w,{children:[e.jsx(X,{children:e.jsx(Z,{className:"text-lg",children:"Genel Bilgiler"})}),e.jsx(T,{className:"space-y-3 sm:space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium text-muted-foreground",children:"Departman Adı"}),e.jsx("p",{className:"text-base font-semibold mt-1",children:u==null?void 0:u.name})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium text-muted-foreground",children:"Yönetici"}),e.jsx("p",{className:"text-base font-semibold mt-1",children:g?g.fullName||g.email:"Atanmamış"}),(g==null?void 0:g.email)&&e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:g.email})]}),(u==null?void 0:u.description)&&e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("span",{className:"text-sm font-medium text-muted-foreground",children:"Açıklama"}),e.jsx("p",{className:"text-sm mt-1",children:u.description})]})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3 sm:gap-4",children:[e.jsx(w,{className:"bg-gradient-to-br from-blue-50 to-blue-100/50 border-blue-200",children:e.jsx(T,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-blue-700",children:"Toplam Üye"}),e.jsx("p",{className:"text-2xl font-bold text-blue-900 mt-1",children:k.totalMembers})]}),e.jsx(be,{className:"h-8 w-8 text-blue-600"})]})})}),e.jsx(w,{className:"bg-gradient-to-br from-yellow-50 to-yellow-100/50 border-yellow-200",children:e.jsx(T,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-yellow-700",children:"Aktif Görevler"}),e.jsx("p",{className:"text-2xl font-bold text-yellow-900 mt-1",children:k.activeTasks})]}),e.jsx(ze,{className:"h-8 w-8 text-yellow-600"})]})})}),e.jsx(w,{className:"bg-gradient-to-br from-green-50 to-green-100/50 border-green-200",children:e.jsx(T,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-green-700",children:"Tamamlanan"}),e.jsx("p",{className:"text-2xl font-bold text-green-900 mt-1",children:k.completedTasks})]}),e.jsx(ye,{className:"h-8 w-8 text-green-600"})]})})}),e.jsx(w,{className:"bg-gradient-to-br from-purple-50 to-purple-100/50 border-purple-200",children:e.jsx(T,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-purple-700",children:"Tamamlanma Oranı"}),e.jsxs("p",{className:"text-2xl font-bold text-purple-900 mt-1",children:[k.completionRate.toFixed(0),"%"]})]}),e.jsx(qe,{className:"h-8 w-8 text-purple-600"})]})})})]}),e.jsxs(w,{children:[e.jsx(X,{children:e.jsx(Z,{className:"text-lg",children:"Görev Tamamlanma Durumu"})}),e.jsxs(T,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"font-medium",children:"Genel İlerleme"}),e.jsxs("span",{className:"text-muted-foreground",children:[k.completionRate.toFixed(1),"%"]})]}),e.jsx(Ge,{value:k.completionRate,className:"h-3"})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Bekleyen:"}),e.jsx("span",{className:"ml-2 font-semibold",children:k.pendingTasks})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Devam Eden:"}),e.jsx("span",{className:"ml-2 font-semibold",children:k.inProgressTasks})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Tamamlanan:"}),e.jsx("span",{className:"ml-2 font-semibold",children:k.completedTasks})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Toplam:"}),e.jsx("span",{className:"ml-2 font-semibold",children:f.length})]})]})]})]}),e.jsxs(w,{children:[e.jsx(X,{children:e.jsxs(Z,{className:"text-lg flex items-center gap-2",children:[e.jsx(be,{className:"h-5 w-5"}),"Ekip Üyeleri (",k.totalMembers,")"]})}),e.jsx(T,{children:M.length>0?e.jsx("div",{className:"space-y-3",children:M.map(i=>{var $;return e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg bg-muted/50 hover:bg-muted transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-10 w-10 rounded-full bg-gradient-to-br from-primary to-primary/60 flex items-center justify-center text-white font-semibold",children:(i.fullName||i.email).charAt(0).toUpperCase()}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:i.fullName||i.email}),e.jsx("div",{className:"flex items-center gap-2 text-xs text-muted-foreground mt-1",children:i.email&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Be,{className:"h-3 w-3"}),i.email]})})]})]}),e.jsx(v,{variant:"outline",children:($=i.approvedTeams)!=null&&$.includes(N)?"Onaylı":"Beklemede"})]},i.id)})}):e.jsx("p",{className:"text-center text-muted-foreground py-4",children:"Bu departmanda henüz üye bulunmuyor"})})]}),e.jsxs(w,{children:[e.jsx(X,{children:e.jsxs(Z,{className:"text-lg flex items-center gap-2",children:[e.jsx(ye,{className:"h-5 w-5"}),"Görevler (",f.length,")"]})}),e.jsx(T,{children:f.length>0?e.jsxs("div",{className:"overflow-x-auto",children:[e.jsxs(Ye,{children:[e.jsx(Ie,{children:e.jsxs(ve,{children:[e.jsx(U,{children:"Başlık"}),e.jsx(U,{children:"Durum"}),e.jsx(U,{children:"Öncelik"}),e.jsx(U,{children:"Oluşturulma"}),e.jsx(U,{children:"Bitiş Tarihi"})]})}),e.jsx(Ke,{children:f.slice(0,10).map(i=>e.jsxs(ve,{children:[e.jsx(z,{className:"font-medium",children:i.title}),e.jsx(z,{children:e.jsx(v,{className:te(i.status),children:re(i.status)})}),e.jsx(z,{children:e.jsx(v,{variant:"outline",children:i.priority||"Normal"})}),e.jsx(z,{className:"text-sm text-muted-foreground",children:i.createdAt?D(i.createdAt.toDate(),"dd MMM yyyy",{locale:C}):"-"}),e.jsx(z,{className:"text-sm text-muted-foreground",children:i.dueDate?D(i.dueDate.toDate(),"dd MMM yyyy",{locale:C}):"-"})]},i.id))})]}),f.length>10&&e.jsxs("p",{className:"text-center text-sm text-muted-foreground mt-4",children:["+",f.length-10," görev daha..."]})]}):e.jsx("p",{className:"text-center text-muted-foreground py-4",children:"Bu departmanda henüz görev bulunmuyor"})})]})]})})})]})})})};export{ls as A,is as D};
