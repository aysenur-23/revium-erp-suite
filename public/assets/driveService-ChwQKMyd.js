var d=(e,a,t)=>new Promise((n,s)=>{var o=i=>{try{l(t.next(i))}catch(p){s(p)}},r=i=>{try{l(t.throw(i))}catch(p){s(p)}},l=i=>i.done?n(i.value):Promise.resolve(i.value).then(o,r);l((t=t.apply(e,a)).next())});import{X as m,a0 as w,a1 as D}from"./index-BQmY0BmM.js";const f="revium_drive_token",y="revium_drive_token_expiry",B=()=>d(void 0,null,function*(){var n;if(!((n=m)!=null&&n.currentUser))throw new Error("Kullanıcı giriş yapmamış. Lütfen önce giriş yapın.");if(!m.currentUser.providerData.some(s=>s.providerId==="google.com")){const s=new w;s.addScope("https://www.googleapis.com/auth/drive.file");try{const o=yield D(m,s),r=w.credentialFromResult(o);if(!(r!=null&&r.accessToken))throw new Error("Google Drive erişim token'ı alınamadı");return b(r.accessToken,3600),r.accessToken}catch(o){throw console.error("Google token alma hatası:",o),o.code==="auth/popup-closed-by-user"?new Error("Google bağlantısı iptal edildi."):new Error((o==null?void 0:o.message)||"Google token alınamadı")}}const t=I();if(!t){const s=new w;s.addScope("https://www.googleapis.com/auth/drive.file");try{const o=yield D(m,s),r=w.credentialFromResult(o);if(!(r!=null&&r.accessToken))throw new Error("Google Drive erişim token'ı alınamadı");return b(r.accessToken,3600),r.accessToken}catch(o){throw console.error("Google token alma hatası:",o),o.code==="auth/popup-closed-by-user"?new Error("Google bağlantısı iptal edildi."):new Error((o==null?void 0:o.message)||"Google token alınamadı")}}return t}),b=(e,a)=>{const t=Date.now()+a*1e3;localStorage.setItem(f,e),localStorage.setItem(y,t.toString())},I=()=>{const e=localStorage.getItem(f),a=localStorage.getItem(y);return!e||!a?null:Date.now()>parseInt(a,10)?(localStorage.removeItem(f),localStorage.removeItem(y),null):e},S=()=>d(void 0,null,function*(){const e=I();return e||(yield B())}),N=()=>d(void 0,null,function*(){try{if(!m)throw new Error("Firebase Authentication başlatılmamış");const e=new w;e.addScope("https://www.googleapis.com/auth/drive.file");const a=yield D(m,e),t=w.credentialFromResult(a);if(!(t!=null&&t.accessToken))throw new Error("Google Drive erişim token'ı alınamadı");return b(t.accessToken,3600),!0}catch(e){throw console.error("Drive authorization error:",e),e.code==="auth/popup-closed-by-user"?new Error("Google bağlantısı iptal edildi."):new Error((e==null?void 0:e.message)||"Google Drive yetkilendirmesi başarısız oldu")}}),O=()=>d(void 0,null,function*(){var e;try{return I()?!0:(e=m)!=null&&e.currentUser?m.currentUser.providerData.some(n=>n.providerId==="google.com"):!1}catch(a){return!1}}),R=()=>d(void 0,null,function*(){try{localStorage.removeItem(f),localStorage.removeItem(y)}catch(e){console.error("Drive revoke error:",e)}}),j=(t,...n)=>d(void 0,[t,...n],function*(e,a={}){var s;try{const o=yield S(),r=e instanceof File?e:new File([e],a.fileName||"file",{type:e.type}),l={name:a.fileName||r.name,mimeType:r.type||"application/octet-stream"};a.folderId?l.parents=[a.folderId]:a.type==="task"||a.type,a.metadata&&(l.properties=a.metadata);const i="----WebKitFormBoundary"+Math.random().toString(36).substring(2),p=`\r
--`+i+`\r
`,L=`\r
--`+i+"--",F=`Content-Type: application/json; charset=UTF-8\r
\r
${JSON.stringify(l)}`,z=`Content-Type: ${r.type||"application/octet-stream"}\r
\r
`,P=yield r.arrayBuffer(),x=new Uint8Array(P),h=new TextEncoder,T=[h.encode(p),h.encode(F),h.encode(p),h.encode(z),x,h.encode(L)],A=T.reduce((c,g)=>c+g.length,0),E=new Uint8Array(A);let G=0;for(const c of T)E.set(c,G),G+=c.length;const _=new Blob([E],{type:`multipart/related; boundary=${i}`}),u=yield fetch("https://www.googleapis.com/upload/drive/v3/files?uploadType=multipart&fields=id,webViewLink,webContentLink",{method:"POST",headers:{Authorization:`Bearer ${o}`,"Content-Type":`multipart/related; boundary=${i}`},body:_});if(!u.ok){let g=((s=(yield u.json().catch(()=>({}))).error)==null?void 0:s.message)||"Dosya yükleme başarısız oldu";throw u.status===401?(localStorage.removeItem(f),localStorage.removeItem(y),g="Yetkilendirme hatası. Lütfen tekrar deneyin."):u.status===403?g="Google Drive izni yok. Lütfen yetkilendirme yapın.":u.status===507&&(g="Google Drive depolama kotası dolmuş."),new Error(g)}const k=yield u.json();if(!k.id)throw new Error("Dosya yükleme başarısız oldu");const v=k.id;if(a.makePublic!==!1)try{yield fetch(`https://www.googleapis.com/drive/v3/files/${v}/permissions`,{method:"POST",headers:{Authorization:`Bearer ${o}`,"Content-Type":"application/json"},body:JSON.stringify({role:"reader",type:"anyone"})})}catch(c){console.warn("Public permission eklenemedi:",c)}const $=k.webViewLink||`https://drive.google.com/file/d/${v}/view`;return{success:!0,fileId:v,webViewLink:$,webContentLink:k.webContentLink}}catch(o){console.error("Drive upload error:",o);let r="Google Drive yüklemesi başarısız oldu";throw o!=null&&o.message?r=o.message:typeof o=="string"&&(r=o),r.includes("auth")||r.includes("unauthorized")||r.includes("401")?r="Google Drive yetkilendirmesi gerekli. Lütfen Google ile giriş yapın.":r.includes("quota")||r.includes("storage")||r.includes("507")?r="Google Drive depolama kotası dolmuş. Lütfen depolama alanını kontrol edin.":r.includes("403")&&(r="Google Drive izni yok. Lütfen Google ile giriş yapın."),new Error(r)}}),M=e=>d(void 0,null,function*(){var a;if(!e||e.trim()==="")throw new Error("Geçerli bir Drive dosya ID'si gerekli");try{const t=yield S(),n=yield fetch(`https://www.googleapis.com/drive/v3/files/${e}`,{method:"DELETE",headers:{Authorization:`Bearer ${t}`}});if(!n.ok){let o=((a=(yield n.json().catch(()=>({}))).error)==null?void 0:a.message)||"Drive dosyası silinemedi";throw n.status===401&&(localStorage.removeItem(f),localStorage.removeItem(y),o="Yetkilendirme hatası. Lütfen tekrar deneyin."),new Error(o)}}catch(t){console.error("Drive delete error:",t);let n="Drive dosyası silinemedi";throw t!=null&&t.message?n=t.message:typeof t=="string"&&(n=t),new Error(n)}});export{N as a,M as d,O as i,R as r,j as u};
