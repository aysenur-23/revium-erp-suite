var U=Object.defineProperty,q=Object.defineProperties;var R=Object.getOwnPropertyDescriptors;var v=Object.getOwnPropertySymbols;var T=Object.prototype.hasOwnProperty,E=Object.prototype.propertyIsEnumerable;var x=(e,c,o)=>c in e?U(e,c,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[c]=o,h=(e,c)=>{for(var o in c||(c={}))T.call(c,o)&&x(e,o,c[o]);if(v)for(var o of v(c))E.call(c,o)&&x(e,o,c[o]);return e},S=(e,c)=>q(e,R(c));var l=(e,c,o)=>new Promise((a,t)=>{var n=s=>{try{r(o.next(s))}catch(M){t(M)}},i=s=>{try{r(o.throw(s))}catch(M){t(M)}},r=s=>s.done?a(s.value):Promise.resolve(s.value).then(n,i);r((o=o.apply(e,c)).next())});import{A as P,D as y,E as d,F as _,H as B,T as k,X as u,P as b,O as A,M as I,Q as O,K as g,J as f,N as G}from"./index-BQmY0BmM.js";import{S as w,T as m}from"./taskService-CI62TrOj.js";import"./lucide-react-CAeuRJQk.js";const K=(e=!1)=>l(void 0,null,function*(){var c,o;try{let a;e?a=P(y(d,"rawMaterials"),_("createdAt","desc")):a=P(y(d,"rawMaterials"),_("createdAt","desc"));const t=yield B(a),n=[];for(const i of t.docs){const r=i.data();if(!r||typeof r!="object"||!e&&(r.deleted===!0||r.isDeleted===!0))continue;const s={id:i.id,name:r.name||"",code:r.code||r.sku||null,sku:r.sku||r.code||null,category:r.category||"other",unit:r.unit||"Adet",currentStock:r.currentStock!==void 0?r.currentStock:r.stock||0,stock:r.stock!==void 0?r.stock:r.currentStock||0,minStock:r.minStock!==void 0?r.minStock:r.min_stock||0,min_stock:r.min_stock!==void 0?r.min_stock:r.minStock||0,maxStock:r.maxStock!==void 0?r.maxStock:r.max_stock||null,max_stock:r.max_stock!==void 0?r.max_stock:r.maxStock||null,cost:r.cost!==void 0?r.cost:r.unitPrice||null,unitPrice:r.unitPrice!==void 0?r.unitPrice:r.cost||null,totalPrice:r.totalPrice!==void 0?r.totalPrice:null,brand:r.brand||null,link:r.link||null,purchasedBy:r.purchasedBy||null,location:r.location||null,currency:r.currency||null,currencies:r.currencies||null,notes:r.notes||null,description:r.description||null,createdBy:r.createdBy||null,createdAt:r.createdAt||k.now(),updatedAt:r.updatedAt||k.now()};n.push(s)}return n}catch(a){throw console.error("Get raw materials error:",a),w(a)?m(a,{operation:"read",collection:"rawMaterials",userId:(o=(c=u)==null?void 0:c.currentUser)==null?void 0:o.uid}):a}}),p=e=>l(void 0,null,function*(){var c,o;try{const a=yield O(A(d,"rawMaterials",e));if(!a.exists())return null;const t=a.data();return{id:a.id,name:t.name||"",code:t.code||t.sku||null,sku:t.sku||t.code||null,category:t.category||"other",unit:t.unit||"Adet",currentStock:t.currentStock!==void 0?t.currentStock:t.stock||0,stock:t.stock!==void 0?t.stock:t.currentStock||0,minStock:t.minStock!==void 0?t.minStock:t.min_stock||0,min_stock:t.min_stock!==void 0?t.min_stock:t.minStock||0,maxStock:t.maxStock!==void 0?t.maxStock:t.max_stock||null,max_stock:t.max_stock!==void 0?t.max_stock:t.maxStock||null,cost:t.cost!==void 0?t.cost:t.unitPrice||null,unitPrice:t.unitPrice!==void 0?t.unitPrice:t.cost||null,totalPrice:t.totalPrice!==void 0?t.totalPrice:null,brand:t.brand||null,link:t.link||null,purchasedBy:t.purchasedBy||null,location:t.location||null,currency:t.currency||null,currencies:t.currencies||null,notes:t.notes||null,description:t.description||null,createdBy:t.createdBy||null,createdAt:t.createdAt||k.now(),updatedAt:t.updatedAt||k.now()}}catch(a){throw console.error("Get raw material by id error:",a),w(a)?m(a,{operation:"read",collection:"rawMaterials",documentId:e,userId:(o=(c=u)==null?void 0:c.currentUser)==null?void 0:o.uid}):a}}),N=e=>l(void 0,null,function*(){var c,o,a,t;try{const n=(o=(c=u)==null?void 0:c.currentUser)==null?void 0:o.uid,i=yield g(y(d,"rawMaterials"),S(h({},e),{createdBy:n||e.createdBy||null,createdAt:f(),updatedAt:f()})),r=yield p(i.id);if(!r)throw new Error("Hammade oluşturulamadı");return n&&(yield I("CREATE","raw_materials",i.id,n,null,r)),r}catch(n){throw console.error("Create raw material error:",n),w(n)?m(n,{operation:"create",collection:"rawMaterials",userId:(t=(a=u)==null?void 0:a.currentUser)==null?void 0:t.uid,data:e}):n}}),C=(e,c,o)=>l(void 0,null,function*(){var a,t;try{const n=yield p(e);yield G(A(d,"rawMaterials",e),S(h({},c),{updatedAt:f()}));const i=yield p(e);o&&(yield I("UPDATE","raw_materials",e,o,n,i))}catch(n){throw console.error("Update raw material error:",n),w(n)?m(n,{operation:"update",collection:"rawMaterials",documentId:e,userId:o||((t=(a=u)==null?void 0:a.currentUser)==null?void 0:t.uid),data:c}):n}}),Q=(e,c)=>l(void 0,null,function*(){var o,a;try{const t=yield p(e);yield b(A(d,"rawMaterials",e))}catch(t){throw console.error("Delete raw material error:",t),w(t)?m(t,{operation:"delete",collection:"rawMaterials",documentId:e,userId:(a=(o=u)==null?void 0:o.currentUser)==null?void 0:a.uid}):t}}),X=(e,c=!1)=>l(void 0,null,function*(){try{const o=e.materialId,a=yield g(y(d,"rawMaterials",o,"transactions"),S(h({},e),{createdAt:f()}));if(!c){const t=yield p(o);if(t){const n=e.type==="in"?t.currentStock+e.quantity:t.currentStock-e.quantity;yield C(o,{currentStock:n})}}return{id:a.id,materialId:e.materialId,type:e.type,quantity:e.quantity,reason:e.reason,relatedOrderId:e.relatedOrderId||null,createdBy:e.createdBy,createdAt:k.now()}}catch(o){throw console.error("Add material transaction error:",o),w(o)?m(o,{operation:"create",collection:"rawMaterials/transactions",userId:e.createdBy,data:e}):o}}),z=e=>l(void 0,null,function*(){var c,o;try{return(yield B(y(d,"rawMaterials",e,"transactions"))).docs.map(t=>{const n=t.data();return{id:t.id,materialId:n.materialId||"",type:n.type||"out",quantity:n.quantity||0,reason:n.reason||"",relatedOrderId:n.relatedOrderId||null,createdAt:n.createdAt||k.now(),createdBy:n.createdBy||""}})}catch(a){throw console.error("Get material transactions error:",a),w(a)?m(a,{operation:"read",collection:"rawMaterials/transactions",userId:(o=(c=u)==null?void 0:c.currentUser)==null?void 0:o.uid}):a}});export{X as addMaterialTransaction,N as createRawMaterial,Q as deleteRawMaterial,z as getMaterialTransactions,p as getRawMaterialById,K as getRawMaterials,C as updateRawMaterial};
