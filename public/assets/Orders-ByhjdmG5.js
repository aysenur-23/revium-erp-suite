import{a3 as Se,k as Ze,r,b as f,j as e,B as N,X as Je,v as qe,W as Be,Y as Oe,Z as Me,C as Y,c as ne,d as ie,e as I,U as ea,$ as aa,a0 as sa,a1 as ta,a2 as la,i as na,g as ia,S as $e,p as Pe,q as Re,s as ze,t as p,T as Ee}from"./index-Xd90qdO9.js";import{f as Le,l as Ke,i as Ye,D as ca,a as ma,b as ra,c as ua,B as he,j as oa,k as xa,C as da,P as ha,a7 as pa,a8 as Ve,u as Ue,a9 as ga,aa as fa,ab as ja,M as Fe,a5 as ya}from"./MainLayout-DW7UjMSA.js";import{S as ba}from"./search-input-QX7HVhJf.js";import{T as Ie,a as Ge,b as re,c as y,d as He,e as j}from"./table-CHpYTcky.js";import{A as Na,a as va,b as wa,c as ka,d as Sa,e as Ca,f as Ta,g as Da}from"./alert-dialog-BVp-ELLM.js";import{C as _a,a as Aa}from"./CreateOrderDialog-Di2tky-V.js";import{S as Ba}from"./separator-BNuYyAQ9.js";import{C as ke}from"./currency-BpxR3_y8.js";import{T as Qe}from"./truck-CIL1YvLr.js";import{C as Oa}from"./circle-dot-CCfpRgG9.js";import{T as We}from"./trash-2-DlZRXDqX.js";import{S as Xe}from"./square-pen-zeHrcQ7c.js";import{C as Ma}from"./CustomerDetailModal-D1Gwzqrs.js";import{L as $a}from"./loading-state-CyTUOPV3.js";import{P as Pa}from"./plus-D9uLCipi.js";import{A as Ra,a as za}from"./arrow-up-CYB1EkPb.js";import"./taskService-CQO0i9v5.js";import"./CustomerCombobox-B9g9riZZ.js";import"./popover-BA39Kv9C.js";import"./CreateCustomerDialog-Ct1V89iV.js";import"./save-Bgz0wbo5.js";import"./isSameDay-CmhUF_DM.js";import"./format-DuC-NjES.js";import"./subDays-BSPI1LCX.js";import"./addDays-b8IynWul.js";import"./isBefore-CpsBulHW.js";import"./reportService-eZYvGhBr.js";import"./storageService-pEqhfEwa.js";import"./driveService-020R8zku.js";import"./trending-up-DyiN6Ad2.js";import"./map-pin-CYdnXw-f.js";import"./download-Bq-rl9Ru.js";import"./message-square-BAQ_w3zD.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ea=Se("ChartNoAxesColumn",[["line",{x1:"18",x2:"18",y1:"20",y2:"10",key:"1xfpm4"}],["line",{x1:"12",x2:"12",y1:"20",y2:"4",key:"be30l9"}],["line",{x1:"6",x2:"6",y1:"20",y2:"14",key:"1r4le6"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const La=Se("NotebookPen",[["path",{d:"M13.4 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-7.4",key:"re6nr2"}],["path",{d:"M2 6h4",key:"aawbzj"}],["path",{d:"M2 10h4",key:"l0bgd4"}],["path",{d:"M2 14h4",key:"1gsvsf"}],["path",{d:"M2 18h4",key:"1bu2t1"}],["path",{d:"M21.378 5.626a1 1 0 1 0-3.004-3.004l-5.01 5.012a2 2 0 0 0-.506.854l-.837 2.87a.5.5 0 0 0 .62.62l2.87-.837a2 2 0 0 0 .854-.506z",key:"pqwjuv"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Va=Se("PackageCheck",[["path",{d:"m16 16 2 2 4-4",key:"gfu2re"}],["path",{d:"M21 10V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l2-1.14",key:"e7tb2h"}],["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}],["polyline",{points:"3.29 7 12 12 20.71 7",key:"ousv84"}],["line",{x1:"12",x2:"12",y1:"22",y2:"12",key:"a4e8g8"}]]),ce=[{value:"draft",label:"Taslak",icon:xa,color:"text-muted-foreground"},{value:"pending",label:"Beklemede",icon:da,color:"text-amber-500"},{value:"confirmed",label:"Onaylandı",icon:na,color:"text-emerald-500"},{value:"in_production",label:"Üretimde",icon:ha,color:"text-blue-500"},{value:"completed",label:"Tamamlandı",icon:qe,color:"text-emerald-600"},{value:"shipped",label:"Kargoda",icon:Qe,color:"text-sky-500"},{value:"delivered",label:"Teslim Edildi",icon:Va,color:"text-primary"}],we=i=>i?i==="in_progress"?"in_production":i:"draft",me=i=>i?typeof i=="string"||i instanceof Date?i:i!=null&&i.seconds?new Date(i.seconds*1e3):i??null:null,L=(i,_)=>{const a=typeof i=="number"?i:Number(i)||0,w=_||"TRY",k=w==="TRY"?"TRY":w,m=w==="TRY"?"tr-TR":"en-US",h=ke[w]||"₺";try{return new Intl.NumberFormat(m,{style:"currency",currency:k,minimumFractionDigits:2}).format(a)}catch{return`${h}${a.toFixed(2)}`}},K=i=>{if(!i)return"-";const _=i instanceof Date?i:new Date(i);return Number.isNaN(_.getTime())?"-":_.toLocaleDateString("tr-TR",{day:"2-digit",month:"short",year:"numeric"})},Ua=({open:i,onOpenChange:_,order:a,onEdit:w,onDelete:k})=>{var xe,Ce,Te,De,_e,Ae;const{user:m,isAdmin:h}=Ze(),[V,P]=r.useState([]),[l,R]=r.useState(null),[pe,A]=r.useState(!0),[G,S]=r.useState(!1),[B,z]=r.useState(we(a==null?void 0:a.status)),[E,U]=r.useState(a==null?void 0:a.approvalStatus),[O,ge]=r.useState({}),M=(a==null?void 0:a.order_number)||(a==null?void 0:a.orderNumber)||(a==null?void 0:a.id),H=me((a==null?void 0:a.order_date)||(a==null?void 0:a.orderDate)),Q=me((a==null?void 0:a.delivery_date)||(a==null?void 0:a.deliveryDate)),Z=me((a==null?void 0:a.due_date)||(a==null?void 0:a.dueDate)),J=me((a==null?void 0:a.created_at)||(a==null?void 0:a.createdAt)),fe=me((a==null?void 0:a.updated_at)||(a==null?void 0:a.updatedAt)),je=(a==null?void 0:a.payment_terms)||(a==null?void 0:a.paymentTerms)||"-",ee=(a==null?void 0:a.delivery_address)||(a==null?void 0:a.shippingAddress)||(a==null?void 0:a.shipping_address),ae=(a==null?void 0:a.delivery_notes)||(a==null?void 0:a.shippingNotes)||(a==null?void 0:a.shipping_notes),b=(a==null?void 0:a.currency)||"TRY",ye=V.reduce((s,n)=>s+(Number(n.quantity)||0),0),se=V.reduce((s,n)=>s+(Number(n.discount)||0),0),te=Number((a==null?void 0:a.subtotal)??(a==null?void 0:a.totalAmount)??(a==null?void 0:a.total)??0),t=Number((a==null?void 0:a.tax)??(a==null?void 0:a.taxAmount)??0),d=Number((a==null?void 0:a.total)??(a==null?void 0:a.totalAmount)??te+t-se),g=((xe=m==null?void 0:m.roles)==null?void 0:xe.includes("manager"))||h,C=(m==null?void 0:m.id)===(a==null?void 0:a.createdBy),ue=g||h,$=g||h||C,le=[{label:"Kalem Sayısı",value:V.length||0,icon:Le,helper:"Siparişe bağlı ürün",accent:"from-blue-50/80 via-white to-white border-blue-100",tooltip:"Bu siparişe eklenmiş toplam satır sayısı"},{label:"Toplam Miktar",value:ye,icon:Ea,helper:"Siparişteki toplam adet",accent:"from-indigo-50/80 via-white to-white border-indigo-100",tooltip:"Ürün miktarlarının toplamı"},{label:"Ara Toplam",value:L((a==null?void 0:a.subtotal)??(a==null?void 0:a.total)??0,b),icon:_a,helper:"Vergi & indirim öncesi",accent:"from-slate-50/80 via-white to-white border-slate-100",tooltip:"KDV ve indirim uygulanmadan önceki tutar"},{label:"İndirim",value:se?`-${L(se,b)}`:"-",icon:La,helper:"Ürün bazlı indirim",accent:"from-emerald-50/80 via-white to-white border-emerald-100",tooltip:"Kalemlere uygulanan toplam indirim"}],be=[{label:"Sipariş No",value:M},{label:"Sipariş Tarihi",value:K(H)},{label:"Teslimat Tarihi",value:K(Q)},{label:"Son Ödeme",value:K(Z)},{label:"Para Birimi",value:b},{label:"Ödeme Şartı",value:je},{label:"Oluşturan",value:a!=null&&a.createdBy?O[a.createdBy]||((Ce=a==null?void 0:a.creator)==null?void 0:Ce.full_name)||"-":((Te=a==null?void 0:a.creator)==null?void 0:Te.full_name)||"-"},{label:"Son Güncelleme",value:K(fe)}],c=[M&&{label:"Sipariş No",value:M},J&&{label:"Oluşturulma",value:K(J)},Z&&{label:"Son Ödeme",value:K(Z)},b&&{label:"Para Birimi",value:b}].filter(Boolean);r.useEffect(()=>{a!=null&&a.id&&i&&(o(),U(a.approvalStatus))},[a,i]),r.useEffect(()=>{i&&(async()=>{try{const n=await ia(),T={};n.forEach(q=>{T[q.id]=q.fullName||q.displayName||q.email||"Bilinmeyen"}),ge(T)}catch(n){console.error("Error loading users:",n)}})()},[i]),r.useEffect(()=>{z(we(a==null?void 0:a.status))},[a==null?void 0:a.status]);const o=async()=>{A(!0);try{const s=await Ke(a.id);if(P(s),a.customer_id||a.customerId){const n=a.customer_id||a.customerId,T=await Ye(n);R(T)}}catch(s){console.error("Fetch order details error:",s),f.error("Detaylar yüklenirken hata: "+(s.message||"Bilinmeyen hata"))}finally{A(!1)}},x=s=>{switch(s){case"draft":return"outline";case"pending":return"secondary";case"confirmed":return"default";case"in_production":case"in_progress":return"secondary";case"completed":return"default";case"shipped":return"secondary";case"delivered":return"default";case"cancelled":return"destructive";default:return"outline"}},u=s=>({draft:"Taslak",pending:"Beklemede",confirmed:"Onaylandı",in_production:"Üretimde",in_progress:"Üretimde",completed:"Tamamlandı",shipped:"Kargoda",delivered:"Teslim Edildi",cancelled:"İptal"})[s]||s,F=()=>{const s=we(B),n=ce.findIndex(T=>T.value===s);return n===-1?0:n},D=()=>{const s=F();return s===-1||s>=ce.length-1?null:ce[s+1]},Ne=async s=>{if(!(!(a!=null&&a.id)||!(m!=null&&m.id))){S(!0);try{if(s==="completed"){if(!(h||g||C)){await pa(a.id,m.id),U("pending"),f.success("Sipariş tamamlandı olarak işaretlendi ve onay için yöneticiye gönderildi."),S(!1);return}await Ve(a.id,m.id),z("completed"),U("approved"),f.success(`Sipariş durumu ${u("completed")} olarak güncellendi.`),S(!1);return}await Ue(a.id,{status:s},m.id,h),z(s),f.success(`Sipariş durumu ${u(s)} olarak güncellendi.`)}catch(n){console.error("Order status update error:",n),f.error("Durum güncellenemedi: "+((n==null?void 0:n.message)||"Bilinmeyen hata"))}finally{S(!1)}}},oe=async()=>{if(!(!(a!=null&&a.id)||!(m!=null&&m.id)))try{await Ve(a.id,m.id),z("completed"),U("approved"),f.success("Sipariş onayı kabul edildi.")}catch(s){f.error("Onaylama başarısız: "+s.message)}},W=async()=>{if(!(!(a!=null&&a.id)||!(m!=null&&m.id)))try{await ga(a.id,m.id),z("in_production"),U("rejected"),f.success("Sipariş onayı reddedildi.")}catch(s){f.error("Reddetme başarısız: "+s.message)}},v=async s=>{if(!(!(a!=null&&a.id)||!(m!=null&&m.id)||!h&&!g)){S(!0);try{await Ue(a.id,{status:s},m.id,h),z(s),f.success(`Sipariş durumu ${u(s)} olarak güncellendi.`)}catch(n){console.error("Order status revert error:",n),f.error("Durum güncellenemedi: "+((n==null?void 0:n.message)||"Bilinmeyen hata"))}finally{S(!1)}}};return e.jsx(ca,{open:i,onOpenChange:_,children:e.jsx(ma,{className:"!max-w-[100vw] sm:!max-w-[95vw] !w-[100vw] sm:!w-[95vw] !h-[100vh] sm:!h-[90vh] !max-h-[100vh] sm:!max-h-[90vh] !left-0 sm:!left-[2.5vw] !top-0 sm:!top-[5vh] !right-0 sm:!right-auto !bottom-0 sm:!bottom-auto !translate-x-0 !translate-y-0 overflow-hidden !p-0 gap-0 bg-white flex flex-col !m-0 !rounded-none sm:!rounded-lg !border-0 sm:!border",children:e.jsxs("div",{className:"flex flex-col h-full min-h-0",children:[e.jsx(ra,{className:"p-3 sm:p-4 border-b bg-white flex-shrink-0",children:e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 flex-1 min-w-0",children:[e.jsx("div",{className:"h-8 w-8 sm:h-10 sm:w-10 rounded-lg bg-primary/10 flex items-center justify-center border border-primary/20 flex-shrink-0",children:e.jsx(Le,{className:"h-4 w-4 sm:h-5 sm:w-5 text-primary"})}),e.jsxs(ua,{className:"text-lg sm:text-xl font-semibold text-foreground truncate",children:["Sipariş Detayı - ",M]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 flex-shrink-0 relative z-10 pr-10 sm:pr-12",children:[E==="pending"&&e.jsx(he,{variant:"outline",className:"border-yellow-500 text-yellow-600 bg-yellow-50 text-xs px-2 sm:px-3 py-1 relative z-10",children:"Onay Bekliyor"}),e.jsx(he,{variant:x(B),className:"text-xs px-2 sm:px-3 py-1 relative z-10",children:u(B)})]})]})}),c.length>0&&e.jsx("div",{className:"px-3 sm:px-4 py-2 border-b bg-gray-50/50 flex flex-wrap items-center gap-2 flex-shrink-0",children:c.map(s=>e.jsxs("div",{className:"flex items-center gap-1 rounded-full border bg-muted/40 px-3 py-1.5 text-xs font-medium text-muted-foreground",children:[e.jsxs("span",{className:"text-muted-foreground/70",children:[s.label,":"]}),e.jsx("span",{className:"text-foreground",children:s.value})]},`${s.label}-${s.value}`))}),e.jsx("div",{className:"flex-1 overflow-hidden bg-gray-50/50 p-3 sm:p-4 min-h-0",children:e.jsx("div",{className:"max-w-full mx-auto h-full overflow-y-auto",children:pe?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}):e.jsxs("div",{className:"space-y-6",children:[E==="pending"&&e.jsx("div",{className:"p-4 bg-yellow-50 border border-yellow-200 rounded-lg",children:e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-semibold text-yellow-900",children:"Sipariş Tamamlanma Onayı Bekliyor"}),e.jsx("p",{className:"text-sm text-yellow-700",children:"Bu sipariş tamamlandı olarak işaretlendi ve onayınızı bekliyor."})]}),$&&e.jsxs("div",{className:"flex gap-2 w-full sm:w-auto",children:[e.jsxs(N,{size:"sm",variant:"outline",className:"flex-1 sm:flex-none border-yellow-300 text-yellow-900 hover:bg-yellow-100",onClick:W,children:[e.jsx(Je,{className:"h-4 w-4 mr-1"}),"Reddet"]}),e.jsxs(N,{size:"sm",className:"flex-1 sm:flex-none bg-yellow-600 hover:bg-yellow-700 text-white border-none",onClick:oe,children:[e.jsx(qe,{className:"h-4 w-4 mr-1"}),"Onayla"]})]})]})}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-4 gap-4 auto-rows-fr",children:le.map(s=>{const n=s.icon;return e.jsxs(Be,{delayDuration:150,children:[e.jsx(Oe,{asChild:!0,children:e.jsxs("div",{className:`rounded-2xl border bg-gradient-to-br text-card-foreground p-4 shadow-sm transition hover:shadow-md hover:-translate-y-0.5 h-full ${s.accent}`,children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase tracking-wide text-muted-foreground",children:s.label}),e.jsx("p",{className:"text-2xl font-semibold mt-1 leading-tight",children:s.value})]}),e.jsx("div",{className:"rounded-full border p-2 bg-white/75 shadow-inner shrink-0",children:e.jsx(n,{className:"h-5 w-5 text-primary"})})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-3",children:s.helper})]})}),e.jsx(Me,{children:s.tooltip})]},s.label)})}),e.jsxs(Y,{children:[e.jsx(ne,{className:"space-y-1",children:e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx(ie,{className:"text-lg",children:"Sipariş Durumu"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:D()?`${u(B)} aşamasındasınız. Sıradaki adım: ${D().label}`:"Workflow tamamlandı."})]}),e.jsxs("div",{className:"text-xs text-muted-foreground text-right",children:["Son güncelleyen: ",a!=null&&a.statusUpdatedBy?O[a.statusUpdatedBy]||a.statusUpdatedBy:(m==null?void 0:m.fullName)||"-",e.jsx("br",{}),e.jsx("span",{className:"text-[11px]",children:a!=null&&a.statusUpdatedAt?K(a.statusUpdatedAt):""})]})]})}),e.jsx(I,{className:"p-3 sm:p-4 md:p-6",children:e.jsxs("div",{className:"space-y-3 sm:space-y-4",children:[e.jsx("div",{className:"flex items-center justify-between overflow-x-auto overflow-y-visible pt-2 pb-4",children:ce.map((s,n)=>{const T=s.icon,q=F(),de=n===q,X=n<q,ve=(h||g)&&X&&s.value!=="cancelled"&&E!=="pending";return e.jsxs("div",{className:"flex items-center flex-1 min-w-0",children:[e.jsxs("div",{className:"flex flex-col items-center flex-1 min-w-0",children:[e.jsxs(Be,{delayDuration:150,children:[e.jsx(Oe,{asChild:!0,children:e.jsx("div",{className:`
                                    w-10 h-10 rounded-full flex items-center justify-center border-2 transition-all relative z-10
                                    ${de?"bg-primary text-primary-foreground border-primary scale-110":""}
                                    ${X?"bg-green-500 text-white border-green-500":""}
                                    ${!de&&!X?"bg-muted border-muted-foreground/20":""}
                                    ${ve?"cursor-pointer hover:scale-105 hover:ring-2 hover:ring-primary/50":""}
                                  `,onClick:()=>{ve&&v(s.value)},children:e.jsx(T,{className:`h-5 w-5 ${de||X?"text-white":s.color}`})})}),e.jsx(Me,{children:ve?`${s.label} durumuna geri dönmek için tıklayın`:s.label})]}),e.jsx("p",{className:`text-xs mt-2 text-center font-medium ${de?"text-primary":X?"text-green-600":"text-muted-foreground"}`,children:s.label})]}),n<ce.length-1&&e.jsx("div",{className:`flex-1 h-0.5 mx-2 ${X?"bg-green-500":"bg-muted"}`})]},s.value)})}),D()&&B!=="delivered"&&B!=="cancelled"&&E!=="pending"&&e.jsx("div",{className:"flex justify-center pt-4 border-t",children:e.jsx(N,{onClick:()=>Ne(D().value),disabled:G,className:"gap-2",children:G?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"Güncelleniyor..."]}):e.jsxs(e.Fragment,{children:[(()=>{const s=D().icon;return e.jsx(s,{className:"h-4 w-4"})})(),D().label," Durumuna Geç"]})})})]})})]}),e.jsxs("div",{className:"grid gap-4 sm:gap-6 grid-cols-1 lg:grid-cols-2",children:[e.jsxs(Y,{children:[e.jsxs(ne,{className:"space-y-1",children:[e.jsx(ie,{className:"text-lg",children:"Müşteri Bilgileri"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"İletişim ve teslimat detayları"})]}),e.jsxs(I,{className:"space-y-3 sm:space-y-4",children:[e.jsxs("div",{className:"space-y-2 sm:space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ea,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"font-medium",children:(l==null?void 0:l.name)||(a==null?void 0:a.customerName)||(a==null?void 0:a.customer_name)||"-"})]}),((l==null?void 0:l.company)||(a==null?void 0:a.customerCompany))&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(oa,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{children:(l==null?void 0:l.company)||(a==null?void 0:a.customerCompany)||(a==null?void 0:a.customer_company)})]}),((l==null?void 0:l.phone)||(a==null?void 0:a.customerPhone))&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(aa,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{children:sa((l==null?void 0:l.phone)||(a==null?void 0:a.customerPhone)||(a==null?void 0:a.customer_phone))})]}),((l==null?void 0:l.email)||(a==null?void 0:a.customerEmail))&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ta,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{children:(l==null?void 0:l.email)||(a==null?void 0:a.customerEmail)||(a==null?void 0:a.customer_email)})]})]}),((l==null?void 0:l.phone)||(l==null?void 0:l.email)||(a==null?void 0:a.customerPhone)||(a==null?void 0:a.customerEmail))&&e.jsxs("div",{className:"flex flex-wrap gap-3 pt-1",children:[((l==null?void 0:l.phone)||(a==null?void 0:a.customerPhone))&&e.jsx(N,{variant:"outline",size:"sm",asChild:!0,children:e.jsx("a",{href:`tel:${la((l==null?void 0:l.phone)||(a==null?void 0:a.customerPhone)||(a==null?void 0:a.customer_phone))}`,children:"Ara"})}),((l==null?void 0:l.email)||(a==null?void 0:a.customerEmail))&&e.jsx(N,{variant:"outline",size:"sm",asChild:!0,children:e.jsx("a",{href:`mailto:${(l==null?void 0:l.email)||(a==null?void 0:a.customerEmail)||(a==null?void 0:a.customer_email)}`,children:"E-posta Gönder"})})]}),(ee||ae)&&e.jsxs("div",{className:"space-y-2 rounded-lg border bg-muted/40 p-3",children:[e.jsxs("p",{className:"text-sm font-medium text-muted-foreground flex items-center gap-2",children:[e.jsx(Qe,{className:"h-4 w-4"}),"Teslimat Bilgileri"]}),ee&&e.jsx("p",{className:"text-sm",children:ee}),ae&&e.jsx("p",{className:"text-xs text-muted-foreground",children:ae})]})]})]}),e.jsxs(Y,{children:[e.jsx(ne,{children:e.jsx(ie,{className:"text-lg",children:"Sipariş Bilgileri"})}),e.jsxs(I,{className:"space-y-3 sm:space-y-4",children:[e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4",children:be.map(s=>e.jsxs("div",{className:"rounded-lg border bg-muted/30 px-3 py-2",children:[e.jsx("p",{className:"text-xs text-muted-foreground uppercase tracking-wide",children:s.label}),e.jsx("p",{className:"text-sm font-medium mt-1",children:s.value||"-"})]},s.label))}),(a==null?void 0:a.notes)&&e.jsxs("div",{className:"rounded-lg border bg-muted/20 p-3",children:[e.jsxs("p",{className:"text-sm text-muted-foreground mb-1 flex items-center gap-2",children:[e.jsx(Oa,{className:"h-4 w-4"}),"İç Not"]}),e.jsx("p",{className:"text-sm leading-relaxed",children:a.notes})]})]})]})]}),e.jsxs(Y,{children:[e.jsx(ne,{children:e.jsx(ie,{className:"text-lg",children:"Ürünler"})}),e.jsx(I,{className:"p-4 sm:p-6",children:V.length?e.jsx("div",{className:"rounded-lg border",children:e.jsxs(Ie,{children:[e.jsx(Ge,{children:e.jsxs(re,{children:[e.jsx(y,{children:"Ürün"}),e.jsx(y,{children:"SKU"}),e.jsx(y,{children:"Kategori"}),e.jsx(y,{className:"text-right",children:"Miktar"}),e.jsx(y,{className:"text-right",children:"Birim Fiyat"}),e.jsx(y,{className:"text-right",children:"İndirim"}),e.jsx(y,{className:"text-right",children:"Toplam"})]})}),e.jsx(He,{children:V.map(s=>{var n,T;return e.jsxs(re,{children:[e.jsx(j,{className:"font-medium",children:((n=s.products)==null?void 0:n.name)||s.productName||s.product_name||"-"}),e.jsx(j,{children:((T=s.products)==null?void 0:T.sku)||"-"}),e.jsx(j,{children:s.category||"-"}),e.jsx(j,{className:"text-right",children:s.quantity}),e.jsx(j,{className:"text-right",children:L(s.unit_price??s.unitPrice,b)}),e.jsx(j,{className:"text-right text-destructive",children:s.discount?`-${L(s.discount,b)}`:"-"}),e.jsx(j,{className:"text-right font-semibold",children:L(s.total,b)})]},s.id)})})]})}):e.jsx("div",{className:"text-center text-sm text-muted-foreground py-6",children:"Bu siparişe ait ürün bulunamadı."})})]}),e.jsxs(Y,{children:[e.jsx(ne,{children:e.jsx(ie,{className:"text-lg",children:"Finansal Özet"})}),e.jsx(I,{className:"p-4 sm:p-6",children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Ara Toplam:"}),e.jsx("span",{children:L(te,b)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"KDV:"}),e.jsx("span",{children:L(t,b)})]}),e.jsx(Ba,{}),e.jsxs("div",{className:"flex justify-between font-bold text-lg",children:[e.jsx("span",{children:"Genel Toplam:"}),e.jsx("span",{children:L(d,b)})]})]})})]}),((a==null?void 0:a.createdBy)&&O[a.createdBy]||((De=a==null?void 0:a.creator)==null?void 0:De.full_name))&&e.jsxs("p",{className:"text-xs text-muted-foreground text-right",children:["Siparişi ekleyen: ",e.jsx("span",{className:"font-medium",children:a!=null&&a.createdBy?O[a.createdBy]||((_e=a==null?void 0:a.creator)==null?void 0:_e.full_name)||"Bilinmeyen":((Ae=a==null?void 0:a.creator)==null?void 0:Ae.full_name)||"Bilinmeyen"})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[ue&&k&&e.jsxs(N,{variant:"outline",onClick:k,className:"gap-2 h-10",children:[e.jsx(We,{className:"h-4 w-4"}),"Sil"]}),w&&e.jsxs(N,{onClick:w,className:"gap-2 h-10 bg-primary hover:bg-primary/90 text-white",children:[e.jsx(Xe,{className:"h-4 w-4"}),"Düzenle"]})]})]})})})]})})})},Ns=()=>{fa();const[i,_]=r.useState([]),[a,w]=r.useState(!0),[k,m]=r.useState(""),[h,V]=r.useState("all"),[P,l]=r.useState("order_date"),[R,pe]=r.useState("desc"),[A,G]=r.useState(1),[S,B]=r.useState(1),[z,E]=r.useState(!1),[U,O]=r.useState(!1),[ge,M]=r.useState(!1),[H,Q]=r.useState(null),[Z,J]=r.useState(!1),[fe,je]=r.useState(null);r.useEffect(()=>{const t={};h!=="all"&&(t.status=h);const d=ja(t,async g=>{try{if(!Array.isArray(g)){_([]),B(1),w(!1);return}let $=(await Promise.allSettled(g.map(async c=>{if(!(c!=null&&c.id))return null;try{if(c.totalAmount||c.total_amount)return c;try{const o=await Ke(c.id),x=(Array.isArray(o)?o:[]).reduce((W,v)=>{if(!v)return W;const xe=v.total||(v.unitPrice||v.unit_price||0)*(v.quantity||0)-(v.discount||0);return W+xe},0),u=(Array.isArray(o)?o:[]).reduce((W,v)=>W+((v==null?void 0:v.quantity)||0),0),F=c.taxRate||c.tax_rate||0,D=x,Ne=D*(F/100),oe=D+Ne;return{...c,totalAmount:oe,total_amount:oe,totalQuantity:u,total_quantity:u,subtotal:D}}catch(o){return console.error(`Order ${c.id} items yüklenemedi:`,o),c}}catch(o){return console.error(`Error processing order ${c.id}:`,o),c}}))).filter(c=>c.status==="fulfilled"&&c.value!==null).map(c=>c.value);if(k){const c=k.toLocaleLowerCase("tr-TR");$=$.filter(o=>{var x,u,F;return((x=o.orderNumber)==null?void 0:x.toLocaleLowerCase("tr-TR").includes(c))||((u=o.customerName)==null?void 0:u.toLocaleLowerCase("tr-TR").includes(c))||((F=o.customerCompany)==null?void 0:F.toLocaleLowerCase("tr-TR").includes(c))})}$.sort((c,o)=>{let x,u;return P==="order_date"?(x=c.orderDate||c.createdAt,u=o.orderDate||o.createdAt):P==="total"?(x=c.totalAmount||0,u=o.totalAmount||0):P==="priority"?(x=c.priority??0,u=o.priority??0):(x=c.orderNumber||"",u=o.orderNumber||""),x instanceof Ee&&(x=x.toMillis()),u instanceof Ee&&(u=u.toMillis()),x instanceof Date&&(x=x.getTime()),u instanceof Date&&(u=u.getTime()),R==="asc"?x>u?1:-1:x<u?1:-1});const le=(A-1)*50,be=le+50;_($.slice(le,be)),B(Math.ceil($.length/50)),w(!1)}catch(C){console.error("Real-time orders update error:",C),w(!1)}});return()=>{d()}},[h,P,R,k,A]);const ee=async t=>{if(t)try{const d=await Ye(t);d?(je(d),J(!0)):f.error("Müşteri bulunamadı")}catch(d){console.error("Get customer error:",d),f.error(d.message||"Müşteri bilgileri alınamadı")}};r.useEffect(()=>{A!==1&&G(1)},[h,P,R,k]);const ae=t=>({draft:"Taslak",pending:"Beklemede",confirmed:"Onaylandı",planned:"Planlanan",in_production:"Üretimde",in_progress:"Üretimde",quality_check:"Kalite Kontrol",on_hold:"Beklemede",completed:"Tamamlandı",shipped:"Kargoda",delivered:"Teslim Edildi",cancelled:"İptal"})[t]||t,b=t=>({draft:"bg-gray-100 text-gray-800 border-gray-300",pending:"bg-yellow-100 text-yellow-800 border-yellow-300",confirmed:"bg-blue-100 text-blue-800 border-blue-300",planned:"bg-indigo-100 text-indigo-800 border-indigo-300",in_production:"bg-orange-100 text-orange-800 border-orange-300",in_progress:"bg-orange-100 text-orange-800 border-orange-300",quality_check:"bg-cyan-100 text-cyan-800 border-cyan-300",on_hold:"bg-amber-100 text-amber-800 border-amber-300",completed:"bg-green-100 text-green-800 border-green-300",shipped:"bg-purple-100 text-purple-800 border-purple-300",delivered:"bg-emerald-100 text-emerald-800 border-emerald-300",cancelled:"bg-red-100 text-red-800 border-red-300"})[t]||"bg-gray-100 text-gray-800 border-gray-300",ye=async()=>{if(H)try{await ya(H.id),f.success("Sipariş silindi"),M(!1),Q(null)}catch(t){console.error("Delete order error:",t),f.error(t.message||"Sipariş silinirken hata oluştu")}},se=(t,d)=>{if(t==null)return`${d&&ke[d]||"₺"}0,00`;const g=d||"TRY",C=g==="TRY"?"TRY":g,ue=g==="TRY"?"tr-TR":"en-US",$=ke[g]||"₺";try{return new Intl.NumberFormat(ue,{style:"currency",currency:C,minimumFractionDigits:2}).format(t)}catch{return`${$}${t.toFixed(2)}`}},te=t=>t==null?{label:"Öncelik: 0",className:"bg-muted text-muted-foreground"}:t>=4?{label:`Öncelik: ${t}`,className:"bg-destructive/15 text-destructive"}:t>=2?{label:`Öncelik: ${t}`,className:"bg-amber-100 text-amber-800"}:{label:`Öncelik: ${t}`,className:"bg-slate-200 text-slate-800"};return a?e.jsx(Fe,{children:e.jsx($a,{message:"Siparişler yükleniyor..."})}):e.jsxs(Fe,{children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3 sm:gap-4",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h1",{className:"text-xl sm:text-2xl md:text-3xl font-bold text-foreground",children:"Siparişler"}),e.jsx("p",{className:"text-muted-foreground mt-0.5 sm:mt-1 text-xs sm:text-sm",children:"Sipariş takibi ve yönetimi"})]}),e.jsxs(N,{className:"gap-2 w-full sm:w-auto min-h-[44px] sm:min-h-0",onClick:()=>E(!0),children:[e.jsx(Pa,{className:"h-4 w-4"}),"Yeni Sipariş"]})]}),e.jsx(Y,{children:e.jsx(I,{className:"p-4 sm:p-6",children:e.jsxs("div",{className:"flex flex-wrap items-center gap-3 sm:gap-4",children:[e.jsx("div",{className:"flex-1 min-w-[200px] sm:min-w-[250px]",children:e.jsx(ba,{placeholder:"Sipariş ara...",className:"w-full h-10",value:k,onChange:t=>m(t.target.value)})}),e.jsx("div",{className:"w-full sm:w-auto sm:min-w-[180px]",children:e.jsxs($e,{value:h,onValueChange:V,children:[e.jsx(Pe,{className:"w-full h-10",children:e.jsx(Re,{placeholder:"Durum Filtrele"})}),e.jsxs(ze,{children:[e.jsx(p,{value:"all",children:"Tüm Durumlar"}),e.jsx(p,{value:"draft",children:"Taslak"}),e.jsx(p,{value:"pending",children:"Beklemede"}),e.jsx(p,{value:"confirmed",children:"Onaylandı"}),e.jsx(p,{value:"planned",children:"Planlanan"}),e.jsx(p,{value:"in_production",children:"Üretimde"}),e.jsx(p,{value:"in_progress",children:"Üretimde"}),e.jsx(p,{value:"quality_check",children:"Kalite Kontrol"}),e.jsx(p,{value:"on_hold",children:"Beklemede"}),e.jsx(p,{value:"completed",children:"Tamamlandı"}),e.jsx(p,{value:"shipped",children:"Kargoda"}),e.jsx(p,{value:"delivered",children:"Teslim Edildi"}),e.jsx(p,{value:"cancelled",children:"İptal"})]})]})}),e.jsx("div",{className:"w-full sm:w-auto sm:min-w-[180px]",children:e.jsxs($e,{value:P,onValueChange:l,children:[e.jsx(Pe,{className:"w-full h-10",children:e.jsx(Re,{placeholder:"Sırala"})}),e.jsxs(ze,{children:[e.jsx(p,{value:"order_date",children:"Tarihe Göre"}),e.jsx(p,{value:"total",children:"Tutara Göre"}),e.jsx(p,{value:"priority",children:"Önceliğe Göre"}),e.jsx(p,{value:"order_number",children:"Sipariş No"})]})]})}),e.jsxs(N,{variant:"outline",size:"sm",onClick:()=>pe(R==="asc"?"desc":"asc"),className:"h-10",children:[R==="asc"?e.jsx(Ra,{className:"h-4 w-4 mr-2"}):e.jsx(za,{className:"h-4 w-4 mr-2"}),R==="asc"?"Artan":"Azalan"]})]})})}),e.jsx(Y,{children:e.jsxs(I,{className:"p-0",children:[e.jsx("div",{className:"overflow-x-auto -mx-4 sm:mx-0",children:e.jsxs(Ie,{className:"min-w-[800px]",children:[e.jsx(Ge,{children:e.jsxs(re,{children:[e.jsx(y,{children:"Sipariş No"}),e.jsx(y,{children:"Müşteri"}),e.jsx(y,{children:"Tarih"}),e.jsx(y,{children:"Durum"}),e.jsx(y,{children:"Öncelik"}),e.jsx(y,{className:"text-right",children:"Tutar"}),e.jsx(y,{className:"text-right",children:"İşlemler"})]})}),e.jsxs(He,{children:[i.map(t=>{var d,g;return e.jsxs(re,{className:"cursor-pointer",onClick:()=>{Q(t),O(!0)},children:[e.jsx(j,{className:"font-medium",children:t.order_number}),e.jsx(j,{children:e.jsxs("button",{type:"button",className:"text-left hover:text-primary focus:outline-none",onClick:C=>{C.stopPropagation(),ee(t.customer_id)},children:[t.customer_name||((d=t.customers)==null?void 0:d.name),t.customer_company&&e.jsxs("span",{className:"text-muted-foreground",children:[" - ",t.customer_company]}),((g=t.customers)==null?void 0:g.company)&&e.jsxs("span",{className:"text-muted-foreground",children:[" - ",t.customers.company]})]})}),e.jsx(j,{children:t.order_date?new Date(t.order_date).toLocaleDateString("tr-TR"):"-"}),e.jsx(j,{children:e.jsx(he,{className:b(t.status),children:ae(t.status)})}),e.jsx(j,{children:e.jsx(he,{className:te(t.priority||0).className,children:te(t.priority||0).label})}),e.jsx(j,{className:"text-right font-semibold",children:se(t.totalAmount||t.total_amount||0,t.currency)}),e.jsx(j,{className:"text-right",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",onClick:C=>C.stopPropagation(),children:[e.jsx(N,{variant:"outline",size:"sm",onClick:()=>{Q(t),O(!0)},children:e.jsx(Xe,{className:"h-4 w-4"})}),e.jsx(N,{variant:"outline",size:"sm",onClick:()=>{Q(t),M(!0)},children:e.jsx(We,{className:"h-4 w-4"})})]})})]},t.id)}),i.length===0&&!a&&e.jsx(re,{children:e.jsx(j,{colSpan:6,className:"text-center py-8 text-muted-foreground",children:k||h!=="all"?"Arama sonucu bulunamadı":"Henüz sipariş bulunmuyor"})})]})]})}),S>1&&e.jsxs("div",{className:"flex flex-col gap-3 mt-4 md:flex-row md:items-center md:justify-between",children:[e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Sayfa ",A," / ",S]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(N,{variant:"outline",size:"sm",onClick:()=>G(t=>Math.max(1,t-1)),disabled:A===1||a,children:"Önceki"}),e.jsx(N,{variant:"outline",size:"sm",onClick:()=>G(t=>Math.min(S,t+1)),disabled:A===S||a,children:"Sonraki"})]})]})]})})]}),e.jsx(Aa,{open:z,onOpenChange:E,onSuccess:()=>{E(!1)}}),H&&e.jsx(Ua,{open:U,onOpenChange:O,order:H,onEdit:()=>{},onDelete:()=>{O(!1),M(!0)}}),e.jsx(Ma,{open:Z,onOpenChange:J,customer:fe}),e.jsx(Na,{open:ge,onOpenChange:M,children:e.jsxs(va,{children:[e.jsxs(wa,{children:[e.jsx(ka,{children:"Siparişi sil?"}),e.jsx(Sa,{children:"Bu işlem geri alınamaz. Sipariş ve bağlı ürünler kalıcı olarak silinecek."})]}),e.jsxs(Ca,{children:[e.jsx(Ta,{children:"İptal"}),e.jsx(Da,{onClick:ye,children:"Sil"})]})]})})]})};export{Ns as default};
