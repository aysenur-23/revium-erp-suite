const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/taskService-CQO0i9v5.js","assets/index-Xd90qdO9.js","assets/index-HS3kTX7E.css"])))=>i.map(i=>d[i]);
import{k as ys,r as i,j as e,f as ve,S as Y,p as q,q as J,s as Q,t as b,B as x,V as je,i as H,U as W,w as k,R as M,X as $,b as u,L as X,g as Pe,_ as ws,T as ze}from"./index-Xd90qdO9.js";import{S as Ns}from"./search-input-QX7HVhJf.js";import{t as Ds,o as ks,A as Fs,E as Bs,G as Cs,H as Le,I as Me,P as Ie,w as ye,T as Ue,D as Es,a as Ss,b as As,c as Ts,d as _s,e as Os,y as Ke}from"./MainLayout-DW7UjMSA.js";import{c as Ps,P as Re,B as zs,C as Ls,a as Ge,R as Ms,Q as Is,g as Us}from"./taskService-CQO0i9v5.js";import{P as Ve,U as Ye}from"./UserMultiSelect-KlPlOKAA.js";import{U as Ks}from"./user-plus-DWuSLDZe.js";import{T as we}from"./tag-EYbV-h0Y.js";import{L as Rs}from"./list-checks-CkcaKLuC.js";import{M as Ne}from"./message-square-BAQ_w3zD.js";import{F as qe}from"./folder-DUFwF4S_.js";import{E as Gs}from"./ellipsis-vertical-gVlTlFy-.js";import{T as Je}from"./trash-2-DlZRXDqX.js";import{f as De}from"./format-DuC-NjES.js";import{P as Qe}from"./plus-D9uLCipi.js";import{i as He}from"./isToday-C_-qpr0F.js";import{a as Vs}from"./addDays-b8IynWul.js";import{i as Ys}from"./isSameDay-CmhUF_DM.js";function qs(j){return+Ds(j)<Date.now()}function Js(j){return Ys(j,Vs(ks(j),1))}const We="taskBoardState_v1",$e="taskBoardFilters_v1",I=[{name:"green",value:"#61BD4F",class:"bg-[#61BD4F]"},{name:"yellow",value:"#F2D600",class:"bg-[#F2D600]"},{name:"orange",value:"#FF9F1A",class:"bg-[#FF9F1A]"},{name:"red",value:"#EB5A46",class:"bg-[#EB5A46]"},{name:"purple",value:"#C377E0",class:"bg-[#C377E0]"},{name:"blue",value:"#0079BF",class:"bg-[#0079BF]"},{name:"sky",value:"#00C2E0",class:"bg-[#00C2E0]"},{name:"lime",value:"#51E898",class:"bg-[#51E898]"},{name:"pink",value:"#FF78CB",class:"bg-[#FF78CB]"},{name:"black",value:"#344563",class:"bg-[#344563]"}],U=[{id:"pending",title:"Yapılacak",taskIds:[]},{id:"in_progress",title:"Devam Ediyor",taskIds:[]},{id:"completed",title:"Tamamlandı",taskIds:[]},{id:"approved",title:"Onaylandı",taskIds:[]}],ut=({tasks:j,onTaskClick:K,onStatusChange:Xe,showProjectFilter:Ze=!0,projectId:Qs})=>{const{user:o,isAdmin:_,isTeamLeader:O,isSuperAdmin:R}=ys(),[N,D]=i.useState({columns:U,tasks:{},columnOrder:U.map(t=>t.id)}),[c,Z]=i.useState(null),[ee,C]=i.useState(!1),[se,G]=i.useState(null),[ke,te]=i.useState(""),[Fe,ae]=i.useState(""),[es,re]=i.useState([]),[E,S]=i.useState([]),[A,P]=i.useState("");i.useState(""),i.useState([]),i.useState(I[0].value);const[ss,Hs]=i.useState("");i.useState("none");const[Be,ts]=i.useState({members:!0,checklist:!0}),[m,F]=i.useState({title:"",description:"",labels:[],dueDate:"",labelInput:"",labelColor:I[0].value}),[v,T]=i.useState(!1),[as,rs]=i.useState(!1),[Ce,le]=i.useState(!1),[ie,Ee]=i.useState([]),[z,ne]=i.useState(""),[L,oe]=i.useState("all"),[B,ce]=i.useState("all"),[de,me]=i.useState("all"),[y,Se]=i.useState([]),[Ae,V]=i.useState(!1),[xe,ue]=i.useState("none"),[he,ls]=i.useState(new Map),[pe,is]=i.useState([]);i.useRef({});const ns=i.useRef(null),os=i.useRef(null),cs=i.useRef(null);i.useRef(null),i.useRef(null),i.useRef(null),i.useRef(null),i.useRef(null),i.useEffect(()=>{(async()=>{try{const a=await Pe();is(a)}catch(a){console.error("Kullanıcılar yüklenirken hata:",a)}})()},[]);const ds=i.useMemo(()=>pe.filter(t=>t.id&&(t.fullName||t.displayName||t.email)).map(t=>({id:t.id,full_name:t.fullName||t.displayName||t.email||"İsimsiz Kullanıcı"})),[pe]),Te=t=>{ts(a=>({...a,[t]:!a[t]}))},fe=t=>{const a=t.current;a&&(a.scrollIntoView({behavior:"smooth",block:"center"}),a.classList.add("ring-2","ring-[#0079BF]/40","rounded-xl"),setTimeout(()=>{a.classList.remove("ring-2","ring-[#0079BF]/40","rounded-xl")},900))},ms=t=>{var l;if(!t)return!1;const a=z.toLocaleLowerCase("tr-TR");return!(z&&!(t.title.toLocaleLowerCase("tr-TR").includes(a)||(l=t.description)!=null&&l.toLocaleLowerCase("tr-TR").includes(a))||L!=="all"&&(!Array.isArray(t.assignedUsers)||!t.assignedUsers.some(s=>s.id===L))||B!=="all"&&(B==="high"&&t.priority<4||B==="medium"&&(t.priority<2||t.priority>3)||B==="low"&&t.priority>=2))};i.useEffect(()=>{const t=localStorage.getItem(We);if(t)try{const l=JSON.parse(t),s={columns:U.map(d=>({...d,taskIds:[]})),tasks:l.tasks||{},columnOrder:U.map(d=>d.id)};D(s)}catch{}const a=localStorage.getItem($e);if(a)try{const l=JSON.parse(a);l.boardSearch&&ne(l.boardSearch),l.memberFilter&&oe(l.memberFilter),l.priorityFilter&&ce(l.priorityFilter),l.projectFilter&&me(l.projectFilter)}catch{}},[]),i.useEffect(()=>{if(j.length===0){D(t=>({...t,tasks:{},columns:t.columns.map(a=>({...a,taskIds:[]}))}));return}D(t=>{const a={},l=U.map(s=>({...s,taskIds:[]}));return j.forEach(s=>{let d=[];if(s.labels)if(typeof s.labels=="string")try{const r=JSON.parse(s.labels);d=Array.isArray(r)?(Array.isArray(r)?r:[]).map(n=>typeof n=="string"?{name:n,color:I[0].value}:n):[]}catch{d=[]}else Array.isArray(s.labels)&&(d=(Array.isArray(s.labels)?s.labels:[]).map(r=>typeof r=="string"?{name:r,color:I[0].value}:r));const h={id:s.id,title:s.title,description:s.description,labels:d,dueDate:s.due_date,createdAt:s.created_at,status:s.status,priority:s.priority||0,projectId:s.projectId||null,assignedUsers:(Array.isArray(s.assignments)?s.assignments:[]).map(r=>({id:r.assigned_to,full_name:r.assigned_to_name||r.assigned_to_email||"Kullanıcı"})),attachments:Array.isArray(s.attachments)?s.attachments.length:typeof s.attachments=="number"?s.attachments:0,comments:0,checklists:[],createdBy:s.createdBy||s.created_by,approvalStatus:s.approvalStatus,linkedProductionOrder:s.production_order_id?{id:s.production_order_id,orderNumber:s.production_order_number,customerName:s.production_order_customer,priority:s.production_order_priority,dueDate:s.production_order_due_date,status:s.production_order_status}:void 0};if(a[s.id]=h,!(s.is_archived||s.isArchived))if(s.status==="completed"&&s.approvalStatus==="approved"){const r=l.find(n=>n.id==="approved");r&&r.taskIds.push(s.id)}else if(s.status==="cancelled"){const r=l.find(n=>n.id==="approved");r&&r.taskIds.push(s.id)}else{const r=l.find(n=>n.id===s.status);r&&r.taskIds.push(s.id)}}),{...t,tasks:a,columns:l,columnOrder:l.map(s=>s.id)}})},[j,JSON.stringify(j.map(t=>t.id))]),i.useEffect(()=>{localStorage.setItem(We,JSON.stringify(N))},[N]),i.useEffect(()=>{(async()=>{V(!0);try{const a=await Ke({status:void 0});Se(a)}catch(a){console.error("Fetch production orders error:",a),u.error("Siparişler yüklenirken hata oluştu")}finally{V(!1)}})()},[]),i.useEffect(()=>{(async()=>{try{const a=await Ps(),l=new Map;a.forEach(s=>{l.set(s.id,s)}),ls(l)}catch(a){console.error("Fetch projects error:",a)}})()},[]),i.useEffect(()=>{const t={boardSearch:z,memberFilter:L,priorityFilter:B,projectFilter:de};localStorage.setItem($e,JSON.stringify(t))},[z,L,B,de]);const xs=async(t,a)=>{var l;try{const d={pending:"in_progress",in_progress:"completed"}[a];if(!d){u.error("Bu aşamadan sonraki aşama bulunamadı");return}const h=N.tasks[t];if(!h)return;if(!(_||O||R)&&!(((l=h.assignedUsers)==null?void 0:l.some(p=>p.id===(o==null?void 0:o.id)))||!1)&&h.createdBy!==(o==null?void 0:o.id)){u.error("Bu görevi taşıma yetkiniz yok. Sadece size atanan görevleri taşıyabilirsiniz.");return}if(d==="completed"&&a==="in_progress"){const n=h.createdBy===(o==null?void 0:o.id);if(!(_||O||R||n)){const{requestTaskApproval:f}=await ws(async()=>{const{requestTaskApproval:g}=await import("./taskService-CQO0i9v5.js").then(w=>w.W);return{requestTaskApproval:g}},__vite__mapDeps([0,1,2]));await f(t,(o==null?void 0:o.id)||""),u.success("Görev tamamlandı olarak işaretlendi ve onay için yöneticiye gönderildi.");return}}await Xe(t,d)}catch{u.error("Aşama geçişi yapılamadı")}},us=()=>{ne(""),oe("all"),ce("all"),me("all")},ge=async()=>{V(!0);try{const t=await Ke({status:void 0});Se(t)}catch(t){console.error("Fetch production orders error:",t),u.error("Siparişler yüklenirken hata oluştu")}finally{V(!1)}};i.useEffect(()=>{ee&&(!Array.isArray(y)||y.length===0)&&ge()},[ee]),i.useEffect(()=>{se&&(!Array.isArray(y)||y.length===0)&&ge()},[se]),i.useEffect(()=>{var t;c&&ue(((t=c.linkedProductionOrder)==null?void 0:t.id)||"none")},[c]);const hs=async t=>{if(c){T(!0);try{await Re(c.id,{productionOrderId:t||null});const a=t&&Array.isArray(y)&&y.length>0?y.find(d=>d.id===t):null,l=t?{id:t,orderNumber:a==null?void 0:a.order_number,customerName:a==null?void 0:a.customer_name,priority:a==null?void 0:a.priority,dueDate:a==null?void 0:a.due_date,status:a==null?void 0:a.status}:void 0,s={...c,linkedProductionOrder:l};Z(s),D(d=>({...d,tasks:{...d.tasks,[c.id]:s}})),ue(t||"none"),u.success(t?"Sipariş bağlantısı güncellendi":"Bağlantı kaldırıldı")}catch(a){console.error("Link production order error:",a),u.error("Bağlantı güncellenemedi: "+(a.message||"Bilinmeyen hata"))}finally{T(!1)}}},ps=async()=>{if(!(!c||!m.title.trim())){T(!0);try{const t=m.dueDate?ze.fromDate(new Date(m.dueDate)):null,a=m.labels.map(s=>s.name);await Re(c.id,{title:m.title,description:m.description||null,dueDate:t,labels:a.length>0?a:null});const l={...c,title:m.title,description:m.description,labels:m.labels,dueDate:m.dueDate};D(s=>({...s,tasks:{...s.tasks,[c.id]:l}})),C(!1),Z(null),u.success("Kart güncellendi")}catch(t){console.error("Edit task error:",t),u.error("Kart güncellenemedi: "+(t.message||"Bilinmeyen hata"))}finally{T(!1)}}},be=async t=>{if(confirm("Bu kartı silmek istediğinize emin misiniz?"))try{await zs(t);const a=N.columns.find(l=>l.taskIds.includes(t));a&&D(l=>({...l,tasks:Object.fromEntries(Object.entries(l.tasks).filter(([s])=>s!==t)),columns:l.columns.map(s=>s.id===a.id?{...s,taskIds:s.taskIds.filter(d=>d!==t)}:s)})),u.success("Kart silindi")}catch(a){console.error("Delete task error:",a),u.error("Kart silinemedi: "+(a.message||"Bilinmeyen hata"))}},fs=async t=>{if(o!=null&&o.id)try{await Ls(t,o.id);const a=N.columns.find(l=>l.taskIds.includes(t));a&&D(l=>({...l,tasks:Object.fromEntries(Object.entries(l.tasks).filter(([s])=>s!==t)),columns:l.columns.map(s=>s.id===a.id?{...s,taskIds:s.taskIds.filter(d=>d!==t)}:s)})),u.success("Görev arşivlendi")}catch(a){console.error("Archive task error:",a),u.error("Görev arşivlenemedi: "+(a.message||"Bilinmeyen hata"))}},gs=t=>{K(t.id,t.status)},bs=async()=>{if(!(!c||!o)){T(!0);try{const t=Array.isArray(c.assignedUsers)?c.assignedUsers.map(n=>n.id):[],a=await Ge(c.id),l=ie.filter(n=>!t.includes(n));for(const n of l)try{await Ms(c.id,n,o.id)}catch(p){console.error("Assignment error:",p)}const s=t.filter(n=>!ie.includes(n));for(const n of s)try{const p=a.find(f=>f.assignedTo===n);p&&await Is(c.id,p.id,o.id)}catch{}u.success("Üyeler güncellendi"),le(!1);const[d,h,r]=await Promise.all([Us(c.id),Ge(c.id),Pe()]);if(d){const n=h.map(f=>{const g=r.find(w=>w.id===f.assignedTo);return{id:f.assignedTo,full_name:(g==null?void 0:g.fullName)||(g==null?void 0:g.displayName)||""}}),p={...c,assignedUsers:n};Z(p),D(f=>({...f,tasks:{...f.tasks,[c.id]:p}}))}}catch(t){console.error("Assign members error:",t),u.error("Üye atama hatası: "+(t.message||"Bilinmeyen hata"))}finally{T(!1)}}},_e=()=>{m.labelInput.trim()&&!m.labels.some(t=>t.name===m.labelInput.trim())&&F(t=>({...t,labels:[...t.labels,{name:t.labelInput.trim(),color:t.labelColor}],labelInput:""}))},vs=t=>{F(a=>({...a,labels:a.labels.filter(l=>l.name!==t)}))},js=t=>t.split(" ").map(a=>a[0]).join("").toUpperCase().slice(0,2),Oe=t=>{const a=t instanceof ze?t.toDate():new Date(t);return qs(a)&&!He(a)?{text:De(a,"dd MMM",{locale:ye}),className:"bg-[#EC9488] text-white"}:He(a)?{text:"Bugün",className:"bg-[#F5D90A] text-[#172B4D]"}:Js(a)?{text:"Yarın",className:"bg-[#F5D90A] text-[#172B4D]"}:{text:De(a,"dd MMM",{locale:ye}),className:"bg-[#DFE1E6] text-[#172B4D]"}};return Ks,Be.members,we,Rs,Be.checklist,ve,Ne,Fe.trim(),e.jsxs("div",{className:"flex flex-col bg-[#F4F5F7] min-h-[500px] rounded-lg border border-[#DFE1E6]",children:[e.jsxs("div",{className:"bg-white border-b border-[#E4E6EA] px-3 sm:px-6 py-3 sm:py-3.5 shadow-sm space-y-3 rounded-t-lg",children:[e.jsx("div",{className:"flex flex-col gap-2 lg:flex-row lg:items-center lg:justify-between",children:e.jsx("div",{className:"flex items-center gap-2 sm:gap-3 flex-wrap text-sm",children:e.jsx("h1",{className:"text-base sm:text-lg font-semibold text-[#172B4D]",children:"Görev Panosu"})})}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 sm:gap-3",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 sm:gap-3 flex-1",children:[e.jsx(Ns,{value:z,onChange:t=>ne(t.target.value),placeholder:"Kart ara...",containerClassName:"flex-1 min-w-0",iconClassName:"text-[#5E6C84]",className:"bg-[#F4F5F7] border-none focus-visible:ring-[#0079BF] text-sm sm:text-base min-h-[44px] sm:min-h-0"}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 sm:gap-3 flex-shrink-0",children:[e.jsxs(Y,{value:L,onValueChange:oe,children:[e.jsx(q,{className:"w-full sm:w-[180px] md:w-[200px] bg-[#F4F5F7] border-none focus:ring-[#0079BF] min-h-[44px] sm:min-h-0",children:e.jsx(J,{placeholder:"Üye filtresi"})}),e.jsxs(Q,{children:[e.jsx(b,{value:"all",children:"Tüm üyeler"}),ds.map(t=>e.jsx(b,{value:t.id,className:"min-h-[44px] sm:min-h-0",children:t.full_name||"İsimsiz kullanıcı"},t.id))]})]}),e.jsxs(Y,{value:B,onValueChange:ce,children:[e.jsx(q,{className:"w-full sm:w-[140px] md:w-[160px] bg-[#F4F5F7] border-none focus:ring-[#0079BF] min-h-[44px] sm:min-h-0",children:e.jsx(J,{placeholder:"Öncelik"})}),e.jsxs(Q,{children:[e.jsx(b,{value:"all",className:"min-h-[44px] sm:min-h-0",children:"Tümü"}),e.jsx(b,{value:"high",className:"min-h-[44px] sm:min-h-0",children:"Yüksek"}),e.jsx(b,{value:"medium",className:"min-h-[44px] sm:min-h-0",children:"Orta"}),e.jsx(b,{value:"low",className:"min-h-[44px] sm:min-h-0",children:"Düşük"})]})]}),Ze&&e.jsxs(Y,{value:de,onValueChange:me,children:[e.jsx(q,{className:"w-full sm:w-[180px] md:w-[200px] bg-[#F4F5F7] border-none focus:ring-[#0079BF] min-h-[44px] sm:min-h-0",children:e.jsx(J,{placeholder:"Proje Seçiniz"})}),e.jsxs(Q,{children:[e.jsx(b,{value:"all",className:"min-h-[44px] sm:min-h-0",children:"Tüm Projeler"}),e.jsx(b,{value:"general",className:"min-h-[44px] sm:min-h-0",children:"Genel Görevler"}),Array.from(he.values()).filter(t=>{var a,l;return((a=t.name)==null?void 0:a.toLowerCase())!=="genel görevler"&&((l=t.name)==null?void 0:l.toLowerCase())!=="genel"}).map(t=>e.jsx(b,{value:t.id,className:"min-h-[44px] sm:min-h-0",children:t.isPrivate?e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(qe,{className:"h-3 w-3"}),t.name]}):t.name},t.id))]})]})]})]}),e.jsx(x,{variant:"ghost",size:"sm",onClick:us,className:"text-[#5E6C84] touch-manipulation min-h-[44px] sm:min-h-0 w-full sm:w-auto whitespace-nowrap",children:"Filtreleri Temizle"})]})]}),e.jsx("div",{className:"pb-8 px-2 sm:px-3 md:px-6 pt-3 sm:pt-4 md:pt-6 overflow-x-auto -mx-2 sm:-mx-3 md:-mx-6",draggable:!1,onDragStart:t=>t.preventDefault(),onDragOver:t=>t.preventDefault(),onDrop:t=>t.preventDefault(),children:e.jsx("div",{className:"flex gap-2 sm:gap-3 md:gap-4 pb-6 w-full min-w-max lg:min-w-0 overflow-x-auto",draggable:!1,onDragStart:t=>t.preventDefault(),onDragOver:t=>t.preventDefault(),onDrop:t=>t.preventDefault(),style:{scrollbarWidth:"thin"},children:N.columnOrder.map(t=>{const a=N.columns.find(s=>s.id===t);if(!a)return null;const l=Array.isArray(a.taskIds)?a.taskIds.map(s=>N.tasks[s]).filter(s=>ms(s)):[];return a.title.toLowerCase().includes("tamam")||a.id==="completed"||a.title.toLowerCase().includes("progress"),e.jsxs("div",{draggable:!1,onDragStart:s=>s.preventDefault(),onDragOver:s=>s.preventDefault(),onDrop:s=>s.preventDefault(),className:"flex-shrink-0 w-[260px] sm:w-[280px] md:w-[300px] lg:flex-1 lg:min-w-0 bg-[#EBECF0] rounded-lg p-2 sm:p-3 flex flex-col transition-all shadow-sm",style:{overflow:"visible"},children:[e.jsxs("div",{className:"flex items-center justify-between mb-2 px-2 py-1",children:[e.jsx("h3",{className:"font-semibold text-sm text-[#172B4D] flex-1 px-2 py-1",children:a.title}),e.jsx("div",{className:"flex items-center gap-1",children:e.jsx("span",{className:"text-xs text-[#5E6C84] font-medium px-1.5 py-0.5 bg-white/60 rounded",children:l.length})})]}),e.jsx("div",{className:"space-y-2.5 pr-1",draggable:!1,onDragStart:s=>s.preventDefault(),onDragOver:s=>s.preventDefault(),onDrop:s=>s.preventDefault(),children:l.map((s,d)=>{var h;return e.jsxs("div",{draggable:!1,onDragStart:r=>r.preventDefault(),onDragOver:r=>r.preventDefault(),onDrop:r=>r.preventDefault(),className:"relative group bg-white rounded-[3px] p-3.5 sm:p-4 shadow-[0_1px_0_rgba(9,30,66,0.25)] hover:shadow-[0_2px_4px_rgba(9,30,66,0.15)] transition-all duration-200 cursor-pointer border-0",onClick:()=>gs(s),children:[(_||O||R||s.createdBy===(o==null?void 0:o.id))&&e.jsx("div",{className:"absolute top-2 right-2 z-10",children:e.jsxs(Fs,{children:[e.jsx(Bs,{asChild:!0,onClick:r=>r.stopPropagation(),children:e.jsx(x,{variant:"ghost",size:"icon",className:"h-6 w-6 opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx(Gs,{className:"h-3.5 w-3.5"})})}),e.jsxs(Cs,{align:"end",onClick:r=>r.stopPropagation(),children:[e.jsxs(Le,{onClick:r=>{r.stopPropagation(),fs(s.id)},className:"cursor-pointer",children:[e.jsx(Me,{className:"h-4 w-4 mr-2"}),"Arşivle"]}),e.jsxs(Le,{onClick:r=>{r.stopPropagation(),confirm("Bu görevi kalıcı olarak silmek istediğinize emin misiniz?")&&be(s.id)},className:"cursor-pointer text-destructive focus:text-destructive",children:[e.jsx(Je,{className:"h-4 w-4 mr-2"}),"Sil"]})]})]})}),Array.isArray(s.labels)&&s.labels.length>0&&e.jsx("div",{className:"flex flex-wrap gap-0.5 mb-2.5 -mx-3 -mt-3",children:s.labels.map((r,n)=>e.jsx("div",{className:"h-1.5 rounded-sm flex-1 min-w-[40px]",style:{backgroundColor:r.color},title:r.name},n))}),s.projectId&&he.has(s.projectId)&&e.jsxs("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 border border-blue-200 rounded-[3px] px-2.5 py-1.5 mb-2 text-xs text-blue-700 flex items-center gap-1.5 shadow-sm",children:[e.jsx(qe,{className:"h-3.5 w-3.5 flex-shrink-0"}),e.jsx("span",{className:"font-semibold truncate",children:(h=he.get(s.projectId))==null?void 0:h.name})]}),s.linkedProductionOrder&&e.jsxs("div",{className:"bg-[#F4F5F7] rounded-[3px] px-2.5 py-2 mb-2 text-xs text-[#5E6C84] flex items-start gap-2",children:[e.jsx(Ie,{className:"h-4 w-4 text-[#5E6C84]"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-[12px] text-[#172B4D] font-medium",children:s.linkedProductionOrder.orderNumber||"Bağlı sipariş"}),e.jsxs("p",{className:"text-[11px]",children:[s.linkedProductionOrder.customerName||"-",s.linkedProductionOrder.dueDate&&e.jsxs(e.Fragment,{children:[" • ",De(new Date(s.linkedProductionOrder.dueDate),"dd MMM",{locale:ye})]})]})]})]}),e.jsx("p",{className:"font-normal text-sm text-[#172B4D] leading-[20px] mb-1.5 break-words",children:s.title}),s.description&&e.jsx("p",{className:"text-xs text-[#5E6C84] line-clamp-2 leading-[16px] mb-2 break-words",children:s.description}),(s.dueDate||s.attachments&&s.attachments>0||s.comments&&s.comments>0||s.checklists&&s.checklists.length>0||s.assignedUsers&&s.assignedUsers.length>0||s.createdBy)&&e.jsxs("div",{className:"flex items-center justify-between mt-2.5 pt-2 border-t border-transparent",children:[e.jsxs("div",{className:"flex items-center gap-1.5 flex-wrap",children:[s.dueDate&&e.jsx("div",{className:je("flex items-center gap-1 text-[11px] px-1.5 py-0.5 rounded font-medium",Oe(s.dueDate).className),children:Oe(s.dueDate).text}),s.attachments>0&&e.jsxs("div",{className:"flex items-center gap-1 text-[11px] text-[#5E6C84] hover:text-[#172B4D]",children:[e.jsx(Ve,{className:"h-3.5 w-3.5"}),e.jsx("span",{children:s.attachments})]}),s.comments>0&&e.jsxs("div",{className:"flex items-center gap-1 text-[11px] text-[#5E6C84] hover:text-[#172B4D]",children:[e.jsx(Ne,{className:"h-3.5 w-3.5"}),e.jsx("span",{children:s.comments})]}),Array.isArray(s.checklists)&&s.checklists.length>0&&s.checklists.some(r=>r.total>0)&&e.jsxs("div",{className:"flex items-center gap-1 text-[11px] text-[#5E6C84] hover:text-[#172B4D]",children:[e.jsx(H,{className:"h-3.5 w-3.5"}),e.jsxs("span",{children:[s.checklists.reduce((r,n)=>r+(n.completed||0),0),"/",s.checklists.reduce((r,n)=>r+(n.total||0),0)]})]}),s.createdBy&&(()=>{const r=pe.find(n=>n.id===s.createdBy);return r?e.jsxs("div",{className:"flex items-center gap-1 text-[11px] text-[#5E6C84] hover:text-[#172B4D]",title:`Oluşturan: ${r.fullName||r.displayName||r.email||"Bilinmeyen"}`,children:[e.jsx(W,{className:"h-3.5 w-3.5"}),e.jsx("span",{className:"truncate max-w-[80px]",children:r.fullName||r.displayName||r.email||"Bilinmeyen"})]}):null})()]}),Array.isArray(s.assignedUsers)&&s.assignedUsers.length>0&&e.jsxs("div",{className:"flex -space-x-1",children:[s.assignedUsers.slice(0,4).map(r=>e.jsx("div",{className:"h-7 w-7 rounded-full bg-[#0079BF] text-white text-[11px] font-semibold flex items-center justify-center border-2 border-white shadow-sm hover:z-10 relative transition-transform hover:scale-110",title:r.full_name,children:js(r.full_name)},r.id)),s.assignedUsers.length>4&&e.jsxs("div",{className:"h-7 w-7 rounded-full bg-[#DFE1E6] text-[#172B4D] text-[11px] font-semibold flex items-center justify-center border-2 border-white shadow-sm hover:z-10 relative",children:["+",s.assignedUsers.length-4]})]})]}),(()=>{var g;if(s.status==="completed"&&s.approvalStatus==="approved")return null;const n={pending:"in_progress",in_progress:"completed"}[s.status],p=_||O||R||((g=s.assignedUsers)==null?void 0:g.some(w=>w.id===(o==null?void 0:o.id)))||s.createdBy===(o==null?void 0:o.id);if(!n||!p)return null;const f={in_progress:"Devam Ediyor",completed:"Tamamlandı"};return e.jsx("div",{className:"mt-3 pt-3 border-t border-[#DFE1E6]",onClick:w=>w.stopPropagation(),children:e.jsx(x,{size:"sm",className:"w-full text-xs bg-[#0079BF] hover:bg-[#005A8B] text-white",onClick:w=>{w.stopPropagation(),xs(s.id,s.status)},children:`${f[n]} Aşamasına Geç`})})})()]},s.id)})}),se===a.id?e.jsxs("div",{className:"mt-3 rounded-lg bg-white border-2 border-[#0079BF]/20 shadow-lg p-4 space-y-4 animate-in fade-in-0 slide-in-from-top-2 duration-200",children:[e.jsxs("div",{className:"space-y-1.5",children:[e.jsxs(k,{className:"text-xs font-semibold text-[#172B4D] flex items-center gap-1.5",children:[e.jsx(Ie,{className:"h-3.5 w-3.5 text-[#0079BF]"}),"Kart Başlığı ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(M,{placeholder:"Örn: Yeni özellik geliştir...",value:ke,onChange:s=>te(s.target.value),onKeyDown:s=>{s.key==="Escape"?(G(null),te(""),ae(""),re([]),S([]),P("")):s.key==="Enter"&&!s.shiftKey&&ke.trim()&&(s.preventDefault(),K("new"),G(null))},autoFocus:!0,disabled:v,className:"h-10 bg-white border-[#DFE1E6] text-[#172B4D] focus-visible:ring-2 focus-visible:ring-[#0079BF] focus-visible:border-[#0079BF] text-sm font-medium placeholder:text-[#5E6C84]"})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsxs(k,{className:"text-xs font-semibold text-[#172B4D] flex items-center gap-1.5",children:[e.jsx(Ne,{className:"h-3.5 w-3.5 text-[#0079BF]"}),"Açıklama"]}),e.jsx(Ue,{placeholder:"Kart hakkında detaylı bilgi ekleyin...",value:Fe,onChange:s=>ae(s.target.value),rows:3,disabled:v,className:"bg-white border-[#DFE1E6] text-[#172B4D] focus-visible:ring-2 focus-visible:ring-[#0079BF] focus-visible:border-[#0079BF] resize-none text-sm placeholder:text-[#5E6C84]"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(k,{className:"text-xs font-semibold text-[#172B4D] flex items-center gap-1.5",children:[e.jsx(H,{className:"h-3.5 w-3.5 text-[#0079BF]"}),"Kontrol Listesi"]}),E.length>0&&e.jsx("div",{className:"space-y-1.5 bg-[#F4F5F7] rounded-md p-2.5 border border-[#DFE1E6]",children:E.map((s,d)=>e.jsxs("div",{className:"flex items-center gap-2.5 text-sm group",children:[e.jsx("input",{type:"checkbox",checked:s.completed,onChange:h=>{const r=[...E];r[d].completed=h.target.checked,S(r)},className:"w-4 h-4 rounded border-[#DFE1E6] text-[#0079BF] focus:ring-2 focus:ring-[#0079BF] cursor-pointer"}),e.jsx("span",{className:je("flex-1",s.completed?"line-through text-[#5E6C84]":"text-[#172B4D]"),children:s.text}),e.jsx("button",{type:"button",onClick:()=>{S(E.filter((h,r)=>r!==d))},className:"opacity-0 group-hover:opacity-100 text-[#5E6C84] hover:text-[#EB5A46] transition-opacity p-1 rounded hover:bg-[#EB5A46]/10",children:e.jsx($,{className:"h-3.5 w-3.5"})})]},d))}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(M,{placeholder:"Yeni madde ekle...",value:A,onChange:s=>P(s.target.value),onKeyDown:s=>{s.key==="Enter"&&A.trim()&&(s.preventDefault(),S([...E,{text:A.trim(),completed:!1}]),P(""))},disabled:v,className:"flex-1 h-9 text-xs border-[#DFE1E6] focus-visible:ring-2 focus-visible:ring-[#0079BF]"}),e.jsx(x,{type:"button",size:"sm",onClick:()=>{A.trim()&&(S([...E,{text:A.trim(),completed:!1}]),P(""))},disabled:v||!A.trim(),className:"h-9 px-3 text-xs bg-[#0079BF] hover:bg-[#005A8B] text-white",children:e.jsx(Qe,{className:"h-3.5 w-3.5"})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(k,{className:"text-xs font-semibold text-[#172B4D] flex items-center gap-1.5",children:[e.jsx(W,{className:"h-3.5 w-3.5 text-[#0079BF]"}),"Kişi Ata"]}),e.jsx("div",{className:"border border-[#DFE1E6] rounded-md p-2 bg-white",children:e.jsx(Ye,{selectedUsers:es,onSelectionChange:re})})]}),e.jsxs("div",{className:"flex items-center gap-2 pt-2 border-t border-[#DFE1E6]",children:[e.jsxs(x,{size:"sm",onClick:()=>{K("new"),G(null)},className:"bg-[#0079BF] hover:bg-[#005A8B] text-white flex-1 font-semibold shadow-md hover:shadow-lg transition-all h-9",children:[e.jsx(H,{className:"h-4 w-4 mr-1.5"}),"Kart Ekle"]}),e.jsx(x,{size:"sm",variant:"ghost",onClick:()=>{G(null),te(""),ae(""),re([]),S([]),P("")},className:"text-[#5E6C84] hover:text-[#172B4D] hover:bg-[#F4F5F7] h-9 w-9 p-0",children:e.jsx($,{className:"h-4 w-4"})})]})]}):e.jsxs("button",{onClick:()=>{if(!_&&!O){u.error("Görev ekleme yetkiniz yok. Sadece yönetici veya ekip lideri ekleyebilir.");return}K("new",a.id)},className:"w-full mt-2 text-left text-sm text-[#5E6C84] hover:text-[#172B4D] hover:bg-white/80 py-2.5 px-3 rounded-md transition-all flex items-center gap-2 font-medium group border border-transparent hover:border-[#DFE1E6] shadow-sm hover:shadow-md",children:[e.jsx("div",{className:"p-1 rounded bg-[#0079BF]/10 group-hover:bg-[#0079BF]/20 transition-colors",children:e.jsx(Qe,{className:"h-4 w-4 text-[#0079BF] group-hover:text-[#005A8B]"})}),e.jsx("span",{className:"group-hover:font-semibold transition-all",children:"Kart ekle"})]})]},a.id)})})}),c&&e.jsx(Es,{open:ee,onOpenChange:C,children:e.jsxs(Ss,{className:"max-w-3xl max-h-[90vh] sm:max-h-[90vh] overflow-hidden p-0","aria-describedby":"task-edit-description",children:[e.jsxs(As,{className:"sr-only",children:[e.jsx(Ts,{children:"Kart Düzenle"}),e.jsx(_s,{id:"task-edit-description",children:"Görev düzenleme"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row h-full",children:[e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 sm:p-6",children:[e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(M,{value:m.title,onChange:t=>F(a=>({...a,title:t.target.value})),className:"text-xl font-semibold text-[#172B4D] border-none shadow-none p-0 h-auto focus-visible:ring-0 focus-visible:ring-offset-0",placeholder:"Kart başlığı"}),e.jsx(x,{variant:"ghost",size:"icon",onClick:()=>C(!1),className:"text-[#5E6C84] hover:text-[#172B4D] hover:bg-gray-200",children:e.jsx($,{className:"h-5 w-5"})})]})}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs(k,{className:"text-sm font-semibold text-[#172B4D] mb-2 flex items-center gap-2",children:[e.jsx(we,{className:"h-4 w-4"}),"Etiketler"]}),e.jsx("div",{className:"flex flex-wrap gap-2 mb-3",children:m.labels.map((t,a)=>e.jsxs("div",{className:"flex items-center gap-1.5 px-2.5 py-1 rounded text-xs font-semibold text-white cursor-pointer hover:opacity-90 transition-opacity",style:{backgroundColor:t.color},onClick:()=>vs(t.name),children:[e.jsx("span",{children:t.name}),e.jsx($,{className:"h-3 w-3"})]},a))}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(M,{value:m.labelInput,onChange:t=>F(a=>({...a,labelInput:t.target.value})),placeholder:"Etiket adı girin...",className:"flex-1 text-sm",onKeyDown:t=>{t.key==="Enter"&&(t.preventDefault(),_e())}}),e.jsx(x,{type:"button",onClick:_e,size:"sm",disabled:!m.labelInput.trim(),className:"bg-[#0079BF] hover:bg-[#005A8B] text-white",children:"Ekle"})]}),e.jsx("div",{className:"flex flex-wrap gap-1.5",children:I.map(t=>e.jsx("button",{onClick:()=>F(a=>({...a,labelColor:t.value})),className:je("w-8 h-8 rounded border-2 transition-all hover:scale-110",t.class,m.labelColor===t.value?"border-gray-800 scale-110 ring-2 ring-gray-400":"border-gray-300 hover:border-gray-500"),title:t.name},t.name))})]})]}),e.jsxs("div",{children:[e.jsx(k,{className:"text-sm font-semibold text-[#172B4D] mb-2",children:"Açıklama"}),e.jsx(Ue,{value:m.description,onChange:t=>F(a=>({...a,description:t.target.value})),placeholder:"Daha fazla detay ekleyin...",rows:6,className:"resize-none"})]}),e.jsxs("div",{children:[e.jsxs(k,{className:"text-sm font-semibold text-[#172B4D] mb-2 flex items-center gap-2",children:[e.jsx(ve,{className:"h-4 w-4"}),"Bitiş Tarihi"]}),e.jsx(M,{type:"date",value:m.dueDate,onChange:t=>F(a=>({...a,dueDate:t.target.value})),className:"max-w-xs"})]}),Ce&&e.jsxs("div",{children:[e.jsxs(k,{className:"text-sm font-semibold text-[#172B4D] mb-2 flex items-center gap-2",children:[e.jsx(W,{className:"h-4 w-4"}),"Üyeler"]}),e.jsx(Ye,{selectedUsers:ie,onSelectionChange:Ee}),e.jsxs("div",{className:"flex gap-2 mt-3",children:[e.jsx(x,{size:"sm",onClick:bs,disabled:v,className:"bg-[#0079BF] hover:bg-[#005A8B] text-white font-medium shadow-sm disabled:opacity-50 disabled:cursor-not-allowed",children:v?e.jsx(X,{className:"h-4 w-4 animate-spin"}):"Kaydet"}),e.jsx(x,{size:"sm",variant:"outline",onClick:()=>{var t;le(!1),Ee(((t=c.assignedUsers)==null?void 0:t.map(a=>a.id))||[])},className:"border-[#DFE1E6] text-[#172B4D] hover:bg-[#F4F5F7] font-medium",children:"İptal"})]})]})]})]}),e.jsxs("div",{className:"w-full sm:w-64 border-t sm:border-t-0 sm:border-l border-gray-200 bg-[#F4F5F7] p-4 flex flex-col gap-1 sm:gap-1",children:[e.jsx("div",{className:"text-xs font-semibold text-[#5E6C84] uppercase mb-1 px-2",children:"Eylemler"}),e.jsxs(x,{variant:"ghost",className:"w-full justify-start text-left text-[#172B4D] hover:bg-white/60",onClick:()=>{le(!Ce)},children:[e.jsx(W,{className:"h-4 w-4 mr-2 text-[#5E6C84]"}),"Üye Ekle"]}),e.jsxs(x,{variant:"ghost",className:"w-full justify-start text-left text-[#172B4D] hover:bg-white/60",onClick:()=>{rs(!as)},children:[e.jsx(we,{className:"h-4 w-4 mr-2 text-[#5E6C84]"}),"Etiketler"]}),e.jsxs(x,{variant:"ghost",className:"w-full justify-start text-left text-[#172B4D] hover:bg-white/60",onClick:()=>{u.info("Checklist özelliği yakında eklenecek. Backend desteği eklendikten sonra aktif olacak.")},children:[e.jsx(H,{className:"h-4 w-4 mr-2 text-[#5E6C84]"}),"Checklist"]}),e.jsxs(x,{variant:"ghost",className:"w-full justify-start text-left text-[#172B4D] hover:bg-white/60",onClick:()=>{const t=document.querySelector('input[type="date"]');t&&t.focus()},children:[e.jsx(ve,{className:"h-4 w-4 mr-2 text-[#5E6C84]"}),"Tarih"]}),e.jsxs(x,{variant:"ghost",className:"w-full justify-start text-left text-[#172B4D] hover:bg-white/60",onClick:()=>{u.info("Dosya ekleme özelliği yakında eklenecek. Backend desteği eklendikten sonra aktif olacak.")},children:[e.jsx(Ve,{className:"h-4 w-4 mr-2 text-[#5E6C84]"}),"Ek"]}),e.jsx("div",{className:"text-xs font-semibold text-[#5E6C84] uppercase mt-4 px-2",children:"İlişkiler"}),e.jsxs("div",{className:"space-y-2 px-2",children:[e.jsxs(Y,{value:xe,onValueChange:ue,children:[e.jsx(q,{className:"bg-white",children:e.jsx(J,{placeholder:"Sipariş seç"})}),e.jsxs(Q,{children:[e.jsx(b,{value:"none",children:"Bağlı sipariş yok"}),Array.isArray(y)&&y.map(t=>e.jsxs(b,{value:t.id,children:[t.order_number," • ",t.customer_name||"-"]},t.id))]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(x,{size:"sm",onClick:()=>hs(xe==="none"?null:xe),disabled:v,className:"bg-[#0079BF] hover:bg-[#005A8B] text-white flex-1 font-medium shadow-sm disabled:opacity-50 disabled:cursor-not-allowed",children:v?e.jsx(X,{className:"h-4 w-4 animate-spin"}):"Bağla"}),e.jsx(x,{size:"sm",variant:"outline",onClick:ge,disabled:Ae,className:"border-[#DFE1E6] text-[#172B4D] hover:bg-[#F4F5F7] font-medium disabled:opacity-50 disabled:cursor-not-allowed",children:Ae?e.jsx(X,{className:"h-4 w-4 animate-spin"}):"Yenile"})]}),c.linkedProductionOrder&&e.jsxs("p",{className:"text-[11px] text-[#5E6C84]",children:["Bağlı: ",c.linkedProductionOrder.orderNumber||c.linkedProductionOrder.id]})]}),e.jsx("div",{className:"border-t border-gray-200 my-2"}),e.jsxs(x,{variant:"ghost",className:"w-full justify-start text-left text-[#172B4D] hover:bg-red-50 hover:text-red-600 font-medium",onClick:()=>{confirm("Bu kartı silmek istediğinize emin misiniz?")&&(be(c.id),C(!1))},children:[e.jsx(Me,{className:"h-4 w-4 mr-2"}),"Arşivle"]}),e.jsxs(x,{variant:"ghost",className:"w-full justify-start text-left text-red-600 hover:bg-red-50 font-medium",onClick:()=>{confirm("Bu kartı kalıcı olarak silmek istediğinize emin misiniz?")&&(be(c.id),C(!1))},children:[e.jsx(Je,{className:"h-4 w-4 mr-2"}),"Sil"]})]})]}),e.jsxs(Os,{className:"border-t border-gray-200 p-4 bg-white",children:[e.jsx(x,{variant:"outline",onClick:()=>C(!1),className:"border-[#DFE1E6] text-[#172B4D] hover:bg-[#F4F5F7] font-medium",children:"Kapat"}),e.jsxs(x,{onClick:ps,disabled:v||!m.title.trim(),className:"bg-[#0079BF] hover:bg-[#005A8B] text-white font-medium shadow-sm disabled:opacity-50 disabled:cursor-not-allowed",children:[v?e.jsx(X,{className:"h-4 w-4 animate-spin mr-2"}):null,"Kaydet"]})]})]})})]})};export{ut as T};
