const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/permissions-gaCIgPOa.js","assets/rolePermissionsService-BQ7cNajw.js","assets/index-BQmY0BmM.js","assets/lucide-react-CAeuRJQk.js","assets/index-YbdY78QJ.css","assets/toastHelpers-DkuKGmwM.js","assets/taskService-CI62TrOj.js"])))=>i.map(i=>d[i]);
var ot=Object.defineProperty,ct=Object.defineProperties;var dt=Object.getOwnPropertyDescriptors;var me=Object.getOwnPropertySymbols;var rs=Object.prototype.hasOwnProperty,as=Object.prototype.propertyIsEnumerable;var ts=(r,u,i)=>u in r?ot(r,u,{enumerable:!0,configurable:!0,writable:!0,value:i}):r[u]=i,ls=(r,u)=>{for(var i in u||(u={}))rs.call(u,i)&&ts(r,i,u[i]);if(me)for(var i of me(u))as.call(u,i)&&ts(r,i,u[i]);return r},ns=(r,u)=>ct(r,dt(u));var M=(r,u)=>{var i={};for(var b in r)rs.call(r,b)&&u.indexOf(b)<0&&(i[b]=r[b]);if(r!=null&&me)for(var b of me(r))u.indexOf(b)<0&&as.call(r,b)&&(i[b]=r[b]);return i};var S=(r,u,i)=>new Promise((b,D)=>{var g=N=>{try{B(i.next(N))}catch(le){D(le)}},z=N=>{try{B(i.throw(N))}catch(le){D(le)}},B=N=>N.done?b(N.value):Promise.resolve(N.value).then(g,z);B((i=i.apply(r,u)).next())});import{u as mt,g as ut,h as ht,i as pt,a as v,k as is,T as C,j as s,l as xt,B as F,m as os,n as cs,o as ue,C as re,p as ds,q as ms,b as ae,S as he,c as pe,d as xe,e as ge,f as k,L as gt,r as ft,_ as us}from"./index-BQmY0BmM.js";import{r as n,b as vt,P as jt,c as yt,F as wt,C as hs,L as Fe,X as bt,E as Nt,d as St,T as At,e as kt,U as Tt,f as Ct,g as Dt,h as Ss,i as ze,j as Pt}from"./lucide-react-CAeuRJQk.js";import{M as ps,D as xs,a as gs,b as fs,c as vs,e as js,B as G,f as _t,h as It,i as Gt,j as ys,T as Ft,k as zt}from"./MainLayout-Dv9j77B5.js";import{A as Ot,a as Bt}from"./avatar-CROuoa6p.js";import{S as Rt}from"./search-input-DCf0xYml.js";import{s as Ut,g as Lt,a as Et,b as Mt,c as fe,d as $t,e as Vt,r as Wt,u as ws,f as Yt}from"./taskService-CI62TrOj.js";import{g as qt}from"./requestService-BTFAUymV.js";import"./alert-dialog-vDPnsgl6.js";import{T as Ht}from"./TaskInlineForm-BjPlHrJk.js";import{T as Kt}from"./TaskBoard-BI6dI0L7.js";import{canCreateTask as bs}from"./permissions-gaCIgPOa.js";import{onPermissionCacheChange as Qt}from"./rolePermissionsService-BQ7cNajw.js";import{i as Ns,a as Xt}from"./isBefore-DY2_5hKP.js";import{s as Jt}from"./format-CN3feEER.js";import{a as Zt}from"./addDays-DpNspVkx.js";import"./storageService-BUAGZT8Z.js";import"./driveService-ChwQKMyd.js";import"./checkbox-DKBysPlW.js";import"./UserMultiSelect-BycFT8u0.js";import"./popover-Bq_PZ6uK.js";import"./isToday-imnuOj2q.js";import"./isSameDay-CbFR9PGK.js";const er=(r,u,i)=>{const b=u.map(D=>{const g=i.find(z=>z.id===D.assignedTo);return g?{id:g.id,full_name:g.fullName||g.displayName,email:g.email}:null}).filter(D=>D!==null);return{id:r.id,title:r.title,description:r.description||null,status:r.status,priority:r.priority,due_date:r.dueDate?r.dueDate instanceof C?r.dueDate.toDate().toISOString():new Date(r.dueDate).toISOString():null,created_at:r.createdAt instanceof C?r.createdAt.toDate().toISOString():new Date(r.createdAt).toISOString(),assignedUsers:b,approvalStatus:r.approvalStatus,createdBy:r.createdBy,projectId:r.projectId,isArchived:r.isArchived,is_archived:r.isArchived}},q=[{value:"pending",label:"Yapılacak",icon:Dt,color:"text-amber-500"},{value:"in_progress",label:"Devam Ediyor",icon:Ss,color:"text-blue-500"},{value:"completed",label:"Tamamlandı",icon:ze,color:"text-emerald-600"},{value:"approved",label:"Onaylandı",icon:ze,color:"text-green-600"}],Tr=()=>{const{user:r,isSuperAdmin:u}=mt(),{projectId:i}=ut();ht();const[b]=pt(),D=b.get("taskId"),g=b.get("type"),z=b.get("filter"),B=b.get("view"),[N,le]=n.useState([]),[Oe,As]=n.useState([]),[H,ks]=n.useState([]),[sr,Ts]=n.useState([]),[A,Cs]=n.useState([]),[Be,Ds]=n.useState([]),[Ps,Re]=n.useState(!0);n.useState(null);const[ve,_s]=n.useState([]),[Ue,Is]=n.useState([]),[Gs,Fs]=n.useState(0),[zs,Os]=n.useState(0);n.useState("pending");const[Bs,je]=n.useState(!1),[K,Rs]=n.useState("create"),[$,Le]=n.useState(null),[Us,Ls]=n.useState("pending"),ye=(e,t)=>{if(e==="new"){const a=t&&["pending","in_progress","completed"].includes(t)?t:"pending";ie("create",null,a);return}ie("edit",e)},ie=(e,t,a="pending")=>{Rs(e),Le(t||null),Ls(a),je(!0)},Ee=()=>{je(!1),Le(null)},Es=()=>S(void 0,null,function*(){Ee()}),[V,Me]=n.useState(""),[R,W]=n.useState("all"),[Q,$e]=n.useState("created_at"),[tr,Ve]=n.useState(null),[O,U]=n.useState("board"),[P,Y]=n.useState("all"),[p,we]=n.useState(z==="my-tasks"?"my-tasks":"all"),[L,X]=n.useState(null),[w,J]=n.useState("all"),[Ms,be]=n.useState(!1),[Ne,We]=n.useState(null),[Z,Se]=n.useState(""),[Ye,qe]=n.useState(!1),[$s,Ae]=n.useState(!1),[ke,Vs]=n.useState(null),[Te,Ws]=n.useState(new Map),[He,Ys]=n.useState([]);n.useEffect(()=>{we(z==="my-tasks"?"my-tasks":"all")},[z]),n.useEffect(()=>{if(D&&A.length>0){const e=A.find(t=>t.id===D);e&&ye(D,e.status)}},[D,A]),n.useEffect(()=>{B==="board"?U("board"):B==="list"&&U("list")},[B]),n.useEffect(()=>{r&&(g==="general"?J("general"):i?(qs(),J(i)):J("all"),Ke())},[r,i,g]),n.useEffect(()=>{if(!r)return;const t=Ut(g==="general"?{projectId:"general"}:z==="my-tasks"?{}:i?{projectId:i}:{},a=>S(void 0,null,function*(){try{const l=Date.now(),c=5*60*1e3,m=!ve.length||l-Gs>c,f=!Ue.length||l-zs>c;let d=ve,j=Ue;m&&(d=yield ft(),_s(d),Fs(l)),f&&(j=yield Et(),Is(j),Os(l));const x=yield qt({createdBy:r.id}),y=new Map;(Array.isArray(j)?j:[]).forEach(o=>{o!=null&&o.id&&y.set(o.id,o)}),Ws(y);const de=(yield Promise.allSettled((Array.isArray(j)?j:[]).map(o=>S(void 0,null,function*(){var T;if(!(o!=null&&o.id))return null;try{if(((T=o.name)==null?void 0:T.toLowerCase())==="gizli görevler")return null;if(!o.isPrivate||u||r!=null&&r.id&&o.createdBy===r.id)return o;if(r!=null&&r.id)try{const _=yield Mt({projectId:o.id});if(Array.isArray(_)&&_.some(h=>h?!!(h.createdBy===r.id||Array.isArray(h.assignedUsers)&&h.assignedUsers.includes(r.id)):!1))return o;for(const h of _)if(h!=null&&h.id)try{const I=yield fe(h.id);if(Array.isArray(I)&&I.some(Ge=>(Ge==null?void 0:Ge.assignedTo)===(r==null?void 0:r.id)))return o}catch(I){}}catch(_){}return null}catch(_){return console.error(`Error processing project ${o.id}:`,_),null}})))).filter(o=>o.status==="fulfilled").map(o=>o.value).filter(o=>o!==null);Ys(de),Ts(x);const nt=(yield Promise.all((Array.isArray(a)?a:[]).map(o=>S(void 0,null,function*(){if(!(o!=null&&o.id))return null;try{const T=yield fe(o.id);return{firebaseTask:o,assignments:Array.isArray(T)?T:[]}}catch(T){return console.error(`Error fetching assignments for task ${o.id}:`,T),{firebaseTask:o,assignments:[]}}})))).filter(o=>o!==null),Je=[],Ze=[],es=[],ss=[];nt.forEach(({firebaseTask:o,assignments:T})=>{if(!o)return;const _=er(o,Array.isArray(T)?T:[],Array.isArray(d)?d:[]);if(ss.push(_),o.isArchived){es.push(_);return}const h=(Array.isArray(T)?T:[]).filter(I=>(I==null?void 0:I.status)!=="rejected").find(I=>(I==null?void 0:I.assignedTo)===(r==null?void 0:r.id));h&&Je.push(ns(ls({},_),{assignment:{id:h.id,task_id:h.taskId,assigned_to:h.assignedTo,assigned_at:h.assignedAt instanceof C?h.assignedAt.toDate().toISOString():new Date(h.assignedAt).toISOString(),accepted_at:h.acceptedAt instanceof C?h.acceptedAt.toDate().toISOString():h.acceptedAt?new Date(h.acceptedAt).toISOString():null,completed_at:h.completedAt instanceof C?h.completedAt.toDate().toISOString():h.completedAt?new Date(h.completedAt).toISOString():null,rejected_at:h.rejectionReason?new Date().toISOString():void 0,rejection_reason:h.rejectionReason||void 0}})),o.createdBy===r.id&&Ze.push(_)}),le(Je),As(Ze),ks(es),Cs(ss),Ds(a),Re(!1)}catch(l){console.error("Real-time tasks update error:",l),Re(!1)}}));return()=>{t()}},[r,i,g,z,u]);const qs=()=>S(void 0,null,function*(){if(i)try{const e=yield Lt(i);Vs(e)}catch(e){console.error("Fetch project error:",e),v.error(e.message||"Proje yüklenirken hata oluştu")}}),Ke=()=>S(void 0,null,function*(){if(!r){Ae(!1);return}try{const e=yield is(),t={id:r.id,email:r.email,emailVerified:r.emailVerified,fullName:r.fullName,displayName:r.fullName,phone:r.phone,dateOfBirth:r.dateOfBirth,role:r.roles,createdAt:C.now(),updatedAt:C.now()},a=yield bs(t,e);Ae(a)}catch(e){console.error("Permission check error:",e),Ae(!1)}});n.useEffect(()=>{if(!r)return;const e=Qt(()=>{Ke()});return()=>e()},[r]);const Hs=e=>S(void 0,null,function*(){Ve(e);try{yield $t(e),v.success("Görev başarıyla silindi")}catch(t){console.error("Delete task error:",t),v.error(t.message||"Görev silinirken hata oluştu")}finally{Ve(null)}}),Ks=e=>S(void 0,null,function*(){if(r!=null&&r.id)try{yield Vt(e,r.id),v.success("Görev arşivlendi")}catch(t){console.error("Archive task error:",t),v.error(t.message||"Görev arşivlenirken hata oluştu")}}),Qs=()=>S(void 0,null,function*(){if(!Ne||!Z.trim()||Z.trim().length<20){v.error("Reddetme sebebi en az 20 karakter olmalıdır");return}qe(!0);try{const e=Ne.task_id;yield Wt(e,Ne.id,Z.trim()),v.success("Görev reddedildi"),be(!1),Se(""),We(null)}catch(e){console.error("Reject task error:",e),v.error(e.message||"Görev reddedilemedi")}finally{qe(!1)}}),Xs=e=>{switch(e){case"completed":return s.jsx(ze,{className:"h-5 w-5 text-success"});case"in_progress":return s.jsx(Ss,{className:"h-5 w-5 text-warning"});default:return s.jsx(Pt,{className:"h-5 w-5 text-muted-foreground"})}},Qe=e=>({pending:"Yapılacak",in_progress:"Devam Ediyor",completed:"Tamamlandı",approved:"Onaylandı"})[e]||e,Js=e=>{if(!e)return"-";let t;return e instanceof C?t=e.toDate():e instanceof Date?t=e:t=new Date(e),Number.isNaN(t.getTime())?"-":t.toLocaleDateString("tr-TR",{day:"2-digit",month:"short",year:"numeric"})},ee=e=>{if(!e.due_date)return!1;const t=new Date(e.due_date);return Ns(t,new Date)&&e.status!=="completed"},ne=e=>{if(!e.due_date)return!1;const t=new Date(e.due_date),a=Jt(new Date),l=Zt(a,3);return!ee(e)&&(Xt(t,a)||t.getTime()===a.getTime())&&Ns(t,l)&&e.status!=="completed"},Zs=e=>{if(!e)return"-";try{return new Date(e).toLocaleDateString("tr-TR",{day:"2-digit",month:"short"})}catch(t){return e}},et=e=>e.split(" ").map(t=>t[0]).join("").toUpperCase().slice(0,2),Ce=(e,t=!1,a=!1)=>e.filter(l=>{var Ie,de;if(a){let te=!0;return i?te=l.projectId===i:w==="all"?te=!0:w==="general"?te=l.projectId==="general":te=l.projectId===w,te}const c=V.toLocaleLowerCase("tr-TR"),m=((Ie=l.title)==null?void 0:Ie.toLocaleLowerCase("tr-TR"))||"",f=((de=l.description)==null?void 0:de.toLocaleLowerCase("tr-TR"))||"",d=m.includes(c)||f.includes(c),j=R==="all"||l.status===R,x=t?!0:P==="all"||P==="due_soon"&&ne(l)||P==="overdue"&&ee(l)||P==="high_priority"&&l.priority>=4;let y=!0;return i?y=l.projectId===i:g==="general"?y=l.projectId==="general":w==="all"?y=!0:w==="general"?y=l.projectId==="general":y=l.projectId===w,d&&j&&x&&y}),De=e=>Array.isArray(e)?[...e].sort((t,a)=>Q==="priority"?a.priority-t.priority:Q==="due_date"?t.due_date?a.due_date?new Date(t.due_date).getTime()-new Date(a.due_date).getTime():-1:1:new Date(a.created_at).getTime()-new Date(t.created_at).getTime()):[],oe=n.useMemo(()=>{let e=[];return p==="archived"?e=H:p==="my-tasks"?e=N.map(t=>{const c=t,{assignment:a}=c;return M(c,["assignment"])}):g==="general"?e=N.map(t=>{const c=t,{assignment:a}=c;return M(c,["assignment"])}):e=A,L&&L!=="all"&&(e=e.filter(t=>L==="active"?t.status!=="completed":L==="completed"?t.status==="completed":L==="risky"?ne(t)||ee(t):L==="pending_approval"?t.approvalStatus==="pending":!0)),e},[A,N,H,p,i,g,L]),ce=n.useMemo(()=>{let e=[];if(p==="my-tasks")e=oe;else return[];const t=Ce(e);return O==="list"?De(t):t},[oe,V,R,P,Q,O,p,w,i,g]);n.useMemo(()=>O!=="list"?[]:De(Ce(Oe)),[Oe,V,R,P,Q,O,L]);const Pe=n.useMemo(()=>{let e=[];if(p==="all"||!p&&g!=="general")e=oe;else return[];const t=Ce(e);return O==="list"?De(t):t},[oe,V,R,P,Q,O,p,i,g,w]),se=n.useMemo(()=>p==="my-tasks"||g==="general"?ce:Pe,[p,ce,Pe,i,g]),st=n.useMemo(()=>{let e=se.filter(a=>{const l=Be.find(m=>m.id===a.id);return!(a.isArchived===!0||a.is_archived===!0||(l==null?void 0:l.isArchived)===!0)});const t=new Map;return(Array.isArray(e)?e:[]).forEach(a=>{const m=a,{assignment:l}=m,c=M(m,["assignment"]);t.set(a.id,c)}),Array.from(t.values())},[se,p,Be]),E=n.useMemo(()=>{let e=[];p==="archived"?e=H:p==="my-tasks"?e=N.map(d=>{const y=d,{assignment:j}=y;return M(y,["assignment"])}):g==="general"?e=N.map(d=>{const y=d,{assignment:j}=y;return M(y,["assignment"])}):e=A,w&&w!=="all"&&(w==="general"?e=e.filter(d=>d.projectId==="general"||!d.projectId):e=e.filter(d=>d.projectId===w));const t=e.length,a=e.filter(d=>d.status!=="completed").length,l=e.filter(d=>d.status==="completed").length,c=e.filter(d=>ne(d)).length,m=e.filter(d=>ee(d)).length,f=e.filter(d=>d.approvalStatus==="pending").length;return{total:t,active:a,completed:l,dueSoon:c,overdue:m,pendingApproval:f}},[A,N,H,p,i,g,w]),tt=n.useMemo(()=>{let e=[];return p==="archived"?e=H:p==="my-tasks"?e=N.map(t=>{const c=t,{assignment:a}=c;return M(c,["assignment"])}):g==="general"?e=N.map(t=>{const c=t,{assignment:a}=c;return M(c,["assignment"])}):e=A,w&&w!=="all"&&(w==="general"?e=e.filter(t=>t.projectId==="general"||!t.projectId):e=e.filter(t=>t.projectId===w)),[{id:"all",label:"Tümü",description:"Tüm görevleri göster",count:e.length},{id:"due_soon",label:"Yaklaşan",description:"3 gün içinde termin",count:e.filter(t=>ne(t)).length},{id:"overdue",label:"Geciken",description:"Termin geçmiş görevler",count:e.filter(t=>ee(t)).length},{id:"high_priority",label:"Öncelikli",description:"Öncelik 4+",count:e.filter(t=>t.priority>=4).length}]},[A,N,H,p,i,g,w]),_e=(e,t)=>{if(e==="completed"&&t==="approved")return 3;if(e==="completed")return 2;const a=q.findIndex(l=>l.value===e);return a===-1?0:a},rt=e=>{const t=_e(e);return t===-1||t>=q.length-1?null:q[t+1]},Xe=(e,t)=>S(void 0,null,function*(){if(r)try{const a=A.find(c=>c.id===e);if(!a){v.error("Görev bulunamadı");return}try{const{canPerformSubPermission:c}=yield us(()=>S(void 0,null,function*(){const{canPerformSubPermission:d}=yield import("./permissions-gaCIgPOa.js");return{canPerformSubPermission:d}}),__vite__mapDeps([0,1,2,3,4])),m={id:r.id,email:r.email,emailVerified:r.emailVerified,fullName:r.fullName,displayName:r.fullName,phone:r.phone,dateOfBirth:r.dateOfBirth,role:r.roles||[],createdAt:C.now(),updatedAt:C.now()};if(!(yield c(m,"tasks","canChangeStatus"))&&!u&&a.createdBy!==r.id&&!(yield fe(e)).map(y=>y.assignedTo).includes(r.id)){v.error("Durum değiştirme yetkiniz yok");return}}catch(c){console.error("Permission check error:",c)}if(!u&&!(yield fe(e)).map(d=>d.assignedTo).includes(r.id)){const{showPermissionErrorToast:d}=yield us(()=>S(void 0,null,function*(){const{showPermissionErrorToast:j}=yield import("./toastHelpers-DkuKGmwM.js");return{showPermissionErrorToast:j}}),__vite__mapDeps([5,2,3,4,6]));d("update","task");return}yield ws(e,t);const l={pending:"Yapılacak",in_progress:"Devam Ediyor",completed:"Tamamlandı"};v.success(`Görev durumu "${l[t]||t}" olarak güncellendi`)}catch(a){console.error("Update task status error:",a),v.error(a.message||"Durum güncellenemedi")}}),at=e=>S(void 0,null,function*(){if(r)try{yield Yt(e,r.id),v.success("Görev onay için yöneticiye gönderildi.")}catch(t){console.error("Request approval error:",t),v.error("Onay isteği gönderilemedi: "+((t==null?void 0:t.message)||"Bilinmeyen hata"))}}),lt=(e,t)=>S(void 0,null,function*(){if(r){if(!u){v.error("Sadece yöneticiler durumu geri alabilir.");return}if(t==="approved"){v.error("Onaylandı durumuna geri alınamaz.");return}try{const a=A.find(f=>f.id===e);if(!a){v.error("Görev bulunamadı");return}if(a.approvalStatus==="pending"){v.error("Onay bekleyen görevler geri alınamaz.");return}const l=_e(a.status,a.approvalStatus),c=q.findIndex(f=>f.value===t);if(c===-1){v.error("Geçersiz durum.");return}if(c>=l){v.error("Sadece önceki durumlara geri alabilirsiniz.");return}const m=q[c];yield ws(e,m.value),v.success(`Görev durumu ${m.label} olarak geri alındı.`)}catch(a){console.error("Revert status error:",a),v.error("Durum geri alınamadı: "+((a==null?void 0:a.message)||"Bilinmeyen hata"))}}});return Ps?s.jsx(ps,{children:s.jsx("div",{className:"flex items-center justify-center h-64",children:s.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary"})})}):s.jsx(ps,{disableScroll:!1,children:s.jsxs("div",{className:xt("space-y-2 sm:space-y-3 md:space-y-4",O==="board"?"pb-0":"pb-8"),children:[s.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-2 sm:gap-3 md:gap-4 flex-shrink-0",children:[s.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 min-w-0 flex-1",children:[i&&s.jsx(F,{variant:"ghost",size:"icon",onClick:()=>window.history.back(),className:"h-7 w-7 sm:h-8 sm:w-8 flex-shrink-0",children:s.jsx(vt,{className:"h-3.5 w-3.5 sm:h-4 sm:w-4"})}),s.jsxs("div",{className:"min-w-0 flex-1",children:[s.jsx("h1",{className:"text-lg sm:text-xl md:text-2xl lg:text-3xl font-bold text-foreground truncate",children:ke?`${ke.name} - Görevler`:"Görevler"}),s.jsx("p",{className:"text-muted-foreground mt-0.5 sm:mt-1 text-xs sm:text-sm",children:ke?"Proje görevleri":"Görev takibi ve yönetimi"})]})]}),s.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 w-full sm:w-auto",children:[s.jsx(os,{value:O,onValueChange:e=>{U(e)},children:s.jsxs(cs,{className:"h-9 sm:h-10",children:[s.jsx(ue,{value:"list",className:"text-xs sm:text-sm min-h-[44px] sm:min-h-0",children:"Liste"}),s.jsx(ue,{value:"board",className:"text-xs sm:text-sm min-h-[44px] sm:min-h-0",children:"Pano"})]})}),$s&&s.jsxs(F,{className:"gap-1.5 sm:gap-2 flex-1 sm:flex-initial min-h-[44px] sm:min-h-10 text-xs sm:text-sm",onClick:()=>S(void 0,null,function*(){if(r)try{const e=yield is(),t={id:r.id,email:r.email,emailVerified:r.emailVerified,fullName:r.fullName,displayName:r.fullName,phone:r.phone,dateOfBirth:r.dateOfBirth,role:r.roles,createdAt:C.now(),updatedAt:C.now()};if(!(yield bs(t,e))){v.error("Görev oluşturma yetkiniz yok");return}ie("create")}catch(e){console.error("Permission check error:",e),v.error("Yetki kontrolü yapılamadı")}}),children:[s.jsx(jt,{className:"h-4 w-4"}),s.jsx("span",{className:"hidden sm:inline",children:"Yeni Görev"}),s.jsx("span",{className:"sm:hidden",children:"Yeni"})]})]})]}),s.jsx(xs,{open:Bs,onOpenChange:je,children:s.jsx(gs,{className:"!max-w-[100vw] sm:!max-w-[95vw] !w-[100vw] sm:!w-[95vw] !h-[100vh] sm:!h-[90vh] !max-h-[100vh] sm:!max-h-[90vh] !left-0 sm:!left-[2.5vw] !top-0 sm:!top-[5vh] !right-0 sm:!right-auto !bottom-0 sm:!bottom-auto !translate-x-0 !translate-y-0 overflow-hidden !p-0 gap-0 bg-white flex flex-col !m-0 !rounded-none sm:!rounded-lg !border-0 sm:!border",children:s.jsxs("div",{className:"flex flex-col h-full min-h-0",children:[s.jsxs(fs,{className:"p-3 sm:p-4 border-b bg-white flex-shrink-0",children:[s.jsx(vs,{className:"text-lg sm:text-xl font-semibold text-foreground",children:K==="edit"?"Görevi Düzenle":"Yeni Görev"}),s.jsx(js,{className:"sr-only",children:K==="edit"?"Görev bilgilerini düzenleyin":"Yeni görev oluşturun"})]}),s.jsx("div",{className:"flex-1 overflow-hidden bg-gray-50/50 p-3 sm:p-4 min-h-0",children:s.jsx("div",{className:"max-w-full mx-auto h-full overflow-y-auto",children:s.jsxs("div",{className:"space-y-6",children:[K==="edit"&&$&&(()=>{const e=A.find(m=>m.id===$);if(!e)return null;const t=e.status||"pending",a=_e(t,e.approvalStatus),l=rt(t),c=ve.reduce((m,f)=>(m[f.id]=f.fullName||f.email||f.id,m),{});return s.jsxs(re,{children:[s.jsx(ds,{className:"space-y-1",children:s.jsxs("div",{className:"flex items-center justify-between gap-3",children:[s.jsxs("div",{children:[s.jsx(ms,{className:"text-lg",children:"Görev Durumu"}),s.jsx("p",{className:"text-sm text-muted-foreground",children:t==="completed"&&e.approvalStatus==="approved"?"Görev onaylandı ve tamamlandı.":t==="completed"&&e.approvalStatus==="pending"?"Görev tamamlandı ve onay bekleniyor.":t==="completed"?"Görev tamamlandı. Onaya göndermek için butona tıklayın.":l?`${Qe(t)} aşamasındasınız. Sıradaki adım: ${l.label}`:"Workflow tamamlandı."})]}),s.jsxs("div",{className:"text-xs text-muted-foreground text-right",children:["Son güncelleyen: ",e.statusUpdatedBy?c[e.statusUpdatedBy]||e.statusUpdatedBy:(r==null?void 0:r.fullName)||"-",s.jsx("br",{}),s.jsx("span",{className:"text-[11px]",children:e.statusUpdatedAt?Js(e.statusUpdatedAt):""})]})]})}),s.jsx(ae,{className:"p-4 sm:p-6",children:s.jsxs("div",{className:"space-y-4",children:[s.jsx("div",{className:"flex items-center justify-between overflow-x-auto overflow-y-visible pt-2 pb-4",children:q.map((m,f)=>{const d=m.icon,j=f===a,x=f<a,y=u&&f<a&&m.value!=="approved"&&e.approvalStatus!=="pending";return s.jsxs("div",{className:"flex items-center flex-1 min-w-0",children:[s.jsxs("div",{className:"flex flex-col items-center flex-1 min-w-0",children:[s.jsx("div",{onClick:y?()=>lt($,m.value):void 0,className:`
                                            w-10 h-10 rounded-full flex items-center justify-center border-2 transition-all relative z-10
                                            ${j?"bg-primary text-primary-foreground border-primary scale-110":""}
                                            ${x?"bg-green-500 text-white border-green-500":""}
                                            ${!j&&!x?"bg-muted border-muted-foreground/20":""}
                                            ${y?"cursor-pointer hover:scale-110 hover:shadow-md":""}
                                          `,title:y?`${m.label} durumuna geri al`:void 0,children:s.jsx(d,{className:`h-5 w-5 ${j||x?"text-white":m.color}`})}),s.jsx("p",{className:`text-xs mt-2 text-center font-medium ${j?"text-primary":x?"text-green-600":"text-muted-foreground"}`,children:m.label})]}),f<q.length-1&&s.jsx("div",{className:`flex-1 h-0.5 mx-2 ${x?"bg-green-500":"bg-muted"}`})]},m.value)})}),t==="completed"&&e.approvalStatus==="approved"?null:t==="completed"&&e.approvalStatus!=="pending"&&e.approvalStatus!=="approved"?s.jsx("div",{className:"flex justify-center pt-4 border-t",children:s.jsxs(F,{onClick:()=>at($),className:"gap-2",children:[s.jsx(yt,{className:"h-4 w-4"}),"Onaya Gönder"]})}):l&&e.approvalStatus!=="pending"&&e.approvalStatus!=="approved"&&l.value==="completed"?s.jsx("div",{className:"flex justify-center pt-4 border-t",children:s.jsxs(F,{onClick:()=>Xe($,l.value),className:"gap-2",children:[(()=>{const m=l.icon;return s.jsx(m,{className:"h-4 w-4"})})(),l.label," Durumuna Geç"]})}):null]})})]})})(),s.jsx(Ht,{mode:K,projectId:i||null,taskId:K==="edit"?$:void 0,defaultStatus:Us,onCancel:Ee,onSuccess:Es,className:"border-0 shadow-none p-0",showOnlyInMyTasks:p==="my-tasks"},`${K}-${$||"new"}`)]})})})]})})}),s.jsx("div",{className:"grid gap-3 sm:gap-4 md:gap-5 lg:gap-6 grid-cols-2 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 flex-shrink-0",children:[{label:"Toplam Görev",value:E.total,sub:"Genel yük",badgeClass:"text-primary",filterType:"all",onClick:()=>{W("all"),Y("all"),X("all"),U("list")}},{label:"Aktif",value:E.active,sub:"Devam eden süreçler",badgeClass:"text-amber-600",filterType:"active",onClick:()=>{W("all"),Y("all"),X("active"),U("list")}},{label:"Tamamlanan",value:E.completed,sub:"Kapatılan işler",badgeClass:"text-emerald-600",filterType:"completed",onClick:()=>{W("completed"),Y("all"),X("completed"),U("list")}},{label:"Riskli (Yaklaşan/Geciken)",value:E.dueSoon+E.overdue,sub:`${E.dueSoon} yaklaşan · ${E.overdue} geciken`,badgeClass:"text-destructive",filterType:"risky",onClick:()=>{W("all"),Y("all"),X("risky"),U("list")}},{label:"Onay Bekleyen",value:E.pendingApproval,sub:"Onay için bekleyen görevler",badgeClass:"text-yellow-600",filterType:"pending_approval",onClick:()=>{W("all"),Y("all"),X("pending_approval"),U("list")}}].map(e=>s.jsx(re,{className:"cursor-pointer hover:shadow-lg transition-all duration-200 hover:border-primary/50 border-2",onClick:e.onClick,children:s.jsxs(ae,{className:"pt-2 pb-2 px-2.5 sm:pt-3 sm:pb-3 sm:px-3 md:pt-4 md:pb-4 md:px-4",children:[s.jsx("p",{className:"text-[10px] sm:text-xs text-muted-foreground mb-1 sm:mb-1.5 truncate",children:e.label}),s.jsx("div",{className:"text-lg sm:text-xl md:text-2xl font-bold mb-0.5 sm:mb-1",children:e.value}),s.jsx("p",{className:`text-[10px] sm:text-xs font-medium ${e.badgeClass} line-clamp-2 hidden sm:block`,children:e.sub})]})},e.label))}),O==="list"?s.jsxs("div",{className:"space-y-2 sm:space-y-3 md:space-y-4",children:[s.jsx(re,{className:"border-2 relative z-10 overflow-visible",children:s.jsx(ae,{className:"p-3 sm:p-4 md:p-6 overflow-visible",children:s.jsx("div",{className:"flex flex-wrap gap-2 sm:gap-3 md:gap-4",children:tt.map(e=>s.jsxs(F,{variant:P===e.id?"default":"outline",className:"justify-between w-full sm:w-auto sm:min-w-[160px] md:min-w-[180px] min-h-[44px] sm:min-h-10 text-xs sm:text-sm",onClick:()=>Y(e.id),children:[s.jsxs("span",{className:"flex items-center gap-1.5 sm:gap-2",children:[e.id==="high_priority"?s.jsx(wt,{className:"h-3.5 w-3.5 sm:h-4 sm:w-4"}):s.jsx(hs,{className:"h-3.5 w-3.5 sm:h-4 sm:w-4"}),s.jsx("span",{className:"truncate",children:e.label})]}),s.jsx(G,{variant:P===e.id?"secondary":"outline",className:"text-[10px] sm:text-xs ml-1",children:e.count})]},e.id))})})}),s.jsx(re,{className:"border-2 relative z-10 overflow-visible",children:s.jsx(ae,{className:"p-3 sm:p-4 md:p-6 overflow-visible",children:s.jsxs("div",{className:"flex flex-col sm:flex-row items-stretch sm:items-center gap-2 sm:gap-3 md:gap-4",children:[s.jsx("div",{className:"flex-1 min-w-0 w-full sm:w-auto sm:min-w-[200px] md:min-w-[250px]",children:s.jsx(Rt,{placeholder:"Görev ara...",value:V,onChange:e=>Me(e.target.value),className:"w-full h-9 sm:h-10 min-h-[44px] sm:min-h-0 text-xs sm:text-sm"})}),s.jsx("div",{className:"w-full sm:w-auto sm:min-w-[160px] md:min-w-[180px]",children:s.jsxs(he,{value:R,onValueChange:W,children:[s.jsx(pe,{className:"w-full h-9 sm:h-10 min-h-[44px] sm:min-h-0 text-xs sm:text-sm",children:s.jsx(xe,{placeholder:"Durum filtrele"})}),s.jsxs(ge,{className:"z-[10003]",children:[s.jsx(k,{value:"all",children:"Tüm Durumlar"}),s.jsx(k,{value:"pending",children:"Beklemede"}),s.jsx(k,{value:"in_progress",children:"Devam Ediyor"}),s.jsx(k,{value:"completed",children:"Tamamlandı"})]})]})}),s.jsx("div",{className:"w-full sm:w-auto sm:min-w-[160px] md:min-w-[180px]",children:s.jsxs(he,{value:Q,onValueChange:$e,children:[s.jsx(pe,{className:"w-full h-9 sm:h-10 min-h-[44px] sm:min-h-0 text-xs sm:text-sm",children:s.jsx(xe,{placeholder:"Sırala"})}),s.jsxs(ge,{className:"z-[10003]",children:[s.jsx(k,{value:"created_at",children:"Tarihe Göre"}),s.jsx(k,{value:"priority",children:"Önceliğe Göre"}),s.jsx(k,{value:"due_date",children:"Bitiş Tarihine Göre"})]})]})}),p==="all"&&s.jsx("div",{className:"w-full sm:w-auto sm:min-w-[160px] md:min-w-[180px]",children:s.jsxs(he,{value:w,onValueChange:J,children:[s.jsx(pe,{className:"w-full h-9 sm:h-10 min-h-[44px] sm:min-h-0 text-xs sm:text-sm",children:s.jsx(xe,{placeholder:"Proje Seçiniz"})}),s.jsxs(ge,{className:"z-[10003]",children:[s.jsx(k,{value:"all",children:"Tüm Projeler"}),s.jsx(k,{value:"general",children:"Genel Görevler"}),He.filter(e=>{var t,a;return((t=e.name)==null?void 0:t.toLowerCase())!=="genel görevler"&&((a=e.name)==null?void 0:a.toLowerCase())!=="genel"}).map(e=>s.jsx(k,{value:e.id,children:e.isPrivate?s.jsxs("span",{className:"flex items-center gap-2",children:[s.jsx(Fe,{className:"h-3 w-3"}),e.name]}):e.name},e.id))]})]})}),s.jsxs(F,{variant:"outline",size:"sm",onClick:()=>{Me(""),W("all"),$e("created_at"),Y("all"),X(null),J("all")},className:"h-9 sm:h-10 min-h-[44px] sm:min-h-0 text-xs sm:text-sm",children:[s.jsx(bt,{className:"h-3.5 w-3.5 sm:h-4 sm:w-4 sm:mr-2"}),s.jsx("span",{className:"hidden sm:inline",children:"Temizle"})]})]})})}),s.jsxs(re,{className:"border-2 relative z-0 overflow-visible",children:[s.jsx(ds,{className:"pb-3 sm:pb-4 md:pb-6 px-3 sm:px-4 md:px-6 pt-3 sm:pt-4 md:pt-6",children:s.jsxs("div",{className:"space-y-3 sm:space-y-4 sm:flex sm:flex-row sm:items-center sm:justify-between sm:space-y-0",children:[s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsxs(ms,{className:"text-base sm:text-lg md:text-xl mb-1 sm:mb-2",children:[p==="archived"?"Arşivlenmiş Görevler":p==="my-tasks"?"Benim Görevlerim":"Tüm Görevler"," ",s.jsxs("span",{className:"text-sm sm:text-base md:text-lg text-muted-foreground font-normal",children:["(",se.length,")"]})]}),s.jsx("p",{className:"text-xs sm:text-sm text-muted-foreground",children:p==="my-tasks"?"Bana atanan ve kabul ettiğim görevler":"Tüm projelerdeki görevlerin listesi"})]}),s.jsx(os,{value:p,onValueChange:e=>we(e),className:"w-full sm:w-auto",children:s.jsxs(cs,{className:"w-full flex flex-col sm:flex-row h-auto",children:[s.jsxs(ue,{value:"all",className:"flex-1 min-h-[44px] sm:min-h-0 text-xs sm:text-sm",children:["Tüm Görevler (",Pe.length,")"]}),s.jsxs(ue,{value:"my-tasks",className:"flex-1 min-h-[44px] sm:min-h-0 text-xs sm:text-sm",children:["Benim Görevlerim (",ce.length,")"]})]})})]})}),s.jsxs(ae,{className:"space-y-3 sm:space-y-4 px-3 sm:px-4 md:px-6 pb-4 sm:pb-6 overflow-visible",children:[!1,(Array.isArray(se)?se:[]).map(e=>{var f,d,j;e.assignment;const t=!1,a=!1,l=!1,c=ee(e),m=ne(e);return s.jsxs("div",{className:"p-4 sm:p-6 rounded-xl border-2 border-border hover:border-primary/40 hover:bg-primary/5 transition-all duration-200 shadow-sm hover:shadow-md relative",children:[(u||e.createdBy===(r==null?void 0:r.id))&&s.jsx("div",{className:"absolute top-2 right-2 sm:top-4 sm:right-4 z-10",children:s.jsxs(_t,{children:[s.jsx(It,{asChild:!0,onClick:x=>x.stopPropagation(),children:s.jsx(F,{variant:"ghost",size:"icon",className:"h-8 w-8 opacity-70 hover:opacity-100",children:s.jsx(Nt,{className:"h-4 w-4"})})}),s.jsxs(Gt,{align:"end",onClick:x=>x.stopPropagation(),children:[s.jsxs(ys,{onClick:x=>{x.stopPropagation(),Ks(e.id)},className:"cursor-pointer",children:[s.jsx(St,{className:"h-4 w-4 mr-2"}),"Arşivle"]}),s.jsxs(ys,{onClick:x=>{x.stopPropagation(),confirm(`"${e.title}" görevini silmek istediğinize emin misiniz? Bu işlem geri alınamaz.`)&&Hs(e.id)},className:"cursor-pointer text-destructive focus:text-destructive",children:[s.jsx(At,{className:"h-4 w-4 mr-2"}),"Sil"]})]})]})}),s.jsxs("div",{className:"flex flex-col gap-5 sm:flex-row sm:items-start sm:justify-between",children:[s.jsxs("div",{className:"flex-1 cursor-pointer",onClick:()=>ye(e.id,e.status),children:[s.jsxs("div",{className:"flex items-start gap-3 mb-3",children:[Xs(e.status),s.jsx("div",{className:"flex-1",children:s.jsxs("div",{className:"flex items-center gap-2 flex-wrap mb-1",children:[s.jsx("h3",{className:"font-semibold text-lg",children:e.title}),e.projectId&&Te.has(e.projectId)&&s.jsxs(s.Fragment,{children:[s.jsxs(G,{variant:"outline",className:"bg-gradient-to-r from-blue-50 to-indigo-50 text-blue-700 border-blue-300 hover:from-blue-100 hover:to-indigo-100 transition-all shadow-sm",children:[s.jsx(kt,{className:"h-3 w-3 mr-1.5"}),s.jsx("span",{className:"font-semibold text-xs",children:(f=Te.get(e.projectId))==null?void 0:f.name})]}),i&&((d=Te.get(i))==null?void 0:d.isPrivate)&&s.jsxs(G,{variant:"outline",className:"gap-1",children:[s.jsx(Fe,{className:"h-3 w-3"}),"Gizli"]})]})]})})]}),e.description&&s.jsx("p",{className:"text-sm text-muted-foreground mt-2 mb-4 line-clamp-2 leading-relaxed",children:e.description}),s.jsxs("div",{className:"flex flex-wrap gap-2 mb-4",children:[s.jsx(G,{variant:"secondary",children:Qe(e.status)}),s.jsxs(G,{variant:"outline",className:"text-xs",children:["Öncelik ",e.priority]}),m&&s.jsx(G,{className:"bg-amber-100 text-amber-900 border-amber-200",children:"Yaklaşan Termin"}),c&&s.jsx(G,{variant:"destructive",children:"Termin Geçti"}),t,a,l,e.approvalStatus==="pending"&&s.jsx(G,{className:"bg-yellow-100 text-yellow-900 border-yellow-300",children:"Görev Onayı Bekleniyor"}),e.approvalStatus==="approved"&&s.jsx(G,{className:"bg-green-100 text-green-900 border-green-300",children:"Görev Onaylandı"}),e.approvalStatus==="rejected"&&s.jsx(G,{className:"bg-red-100 text-red-900 border-red-300",children:"Görev Onayı Reddedildi"}),e.production_order_number&&s.jsxs(G,{variant:"outline",className:"bg-primary/5 text-primary",children:["Sipariş #",e.production_order_number]})]}),s.jsxs("div",{className:"flex flex-wrap items-center gap-4 mt-4 text-sm text-muted-foreground",children:[e.due_date&&s.jsxs("span",{className:"flex items-center gap-2",children:[s.jsx(hs,{className:"h-4 w-4"}),"Termin: ",Zs(e.due_date)]}),!!((j=e.assignedUsers)!=null&&j.length)&&s.jsxs("span",{className:"flex items-center gap-2",children:[s.jsx(Tt,{className:"h-4 w-4"}),e.assignedUsers.length," kişi"]})]}),e.assignedUsers&&e.assignedUsers.length>0&&s.jsxs("div",{className:"flex items-center gap-2 mt-4",children:[s.jsx("div",{className:"flex -space-x-2",children:(Array.isArray(e.assignedUsers)?e.assignedUsers.slice(0,4):[]).map(x=>s.jsx(Ot,{className:"h-7 w-7 border-2 border-background",children:s.jsx(Bt,{className:"text-[11px]",children:et(x.full_name)})},x.id))}),e.assignedUsers.length>4&&s.jsxs("span",{className:"text-xs text-muted-foreground",children:["+",e.assignedUsers.length-4," daha"]})]})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[e.createdBy===(r==null?void 0:r.id)&&s.jsx(F,{variant:"outline",size:"sm",onClick:x=>{x.stopPropagation(),ie("edit",e.id)},children:"Mini Düzenle"}),!1,t]})]})]},e.id)}),se.length===0&&s.jsx("div",{className:"py-16 text-center text-muted-foreground border-2 border-dashed rounded-xl bg-muted/30",children:s.jsxs("div",{className:"flex flex-col items-center gap-3",children:[s.jsx(Ct,{className:"h-12 w-12 text-muted-foreground/50"}),s.jsx("p",{className:"text-base font-medium",children:V||R!=="all"||P!=="all"?"Filtre kriterlerinize uyan görev bulunamadı":p==="my-tasks"?"Henüz size atanan ve kabul ettiğiniz görev yok":"Henüz görev bulunmuyor"}),(V||R!=="all"||P!=="all")&&s.jsx("p",{className:"text-sm text-muted-foreground/70",children:"Filtreleri değiştirerek tekrar deneyin"})]})})]})]})]}):s.jsxs("div",{className:"flex flex-col gap-2 sm:gap-3 md:gap-4",children:[p==="all"&&s.jsx(re,{className:"border-2 flex-shrink-0",children:s.jsx(ae,{className:"pt-3 sm:pt-4 md:pt-6 pb-3 sm:pb-4 md:pb-6 px-3 sm:px-4 md:px-6",children:s.jsx("div",{className:"grid grid-cols-1 gap-2 sm:gap-3 md:gap-4",children:s.jsx("div",{className:"w-full",children:s.jsxs(he,{value:w,onValueChange:J,children:[s.jsx(pe,{className:"w-full h-9 sm:h-10",children:s.jsx(xe,{placeholder:"Proje filtrele"})}),s.jsxs(ge,{children:[s.jsx(k,{value:"all",children:"Tüm Projeler"}),s.jsx(k,{value:"general",children:"Genel Görevler"}),He.filter(e=>{var t,a;return((t=e.name)==null?void 0:t.toLowerCase())!=="genel görevler"&&((a=e.name)==null?void 0:a.toLowerCase())!=="genel"}).map(e=>s.jsx(k,{value:e.id,children:e.isPrivate?s.jsxs("span",{className:"flex items-center gap-2",children:[s.jsx(Fe,{className:"h-3 w-3"}),e.name]}):e.name},e.id))]})]})})})})}),s.jsx("div",{children:s.jsx(Kt,{tasks:st,onTaskClick:(e,t)=>ye(e,t),onStatusChange:Xe,showProjectFilter:p==="all"})})]}),s.jsx(xs,{open:Ms,onOpenChange:be,children:s.jsxs(gs,{children:[s.jsxs(fs,{children:[s.jsx(vs,{children:"Görevi Reddet"}),s.jsx(js,{children:"Görevi reddetmek için lütfen en az 20 karakterlik bir sebep belirtin."})]}),s.jsx("div",{className:"space-y-4",children:s.jsxs("div",{children:[s.jsxs(gt,{htmlFor:"rejection_reason",children:["Reddetme Sebebi ",s.jsx("span",{className:"text-destructive",children:"*"})," (En az 20 karakter)"]}),s.jsx(Ft,{id:"rejection_reason",value:Z,onChange:e=>Se(e.target.value),placeholder:"Görevi neden reddettiğinizi açıklayın (en az 20 karakter)...",rows:4,className:"mt-2"}),s.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[Z.length,"/20 karakter"]})]})}),s.jsxs(zt,{children:[s.jsx(F,{variant:"outline",onClick:()=>{be(!1),Se(""),We(null)},children:"İptal"}),s.jsx(F,{variant:"destructive",onClick:Qs,disabled:Ye||Z.trim().length<20,children:Ye?"İşleniyor...":"Reddet"})]})]})})]})})};export{Tr as default};
