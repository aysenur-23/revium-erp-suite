var k=(t,g,m)=>new Promise((p,d)=>{var D=r=>{try{v(m.next(r))}catch(o){d(o)}},n=r=>{try{v(m.throw(r))}catch(o){d(o)}},v=r=>r.done?p(r.value):Promise.resolve(r.value).then(D,n);v((m=m.apply(t,g)).next())});import{u as me,j as e,B,C as P,p as U,q as G,b as $,L as f,S as J,c as W,d as Z,e as q,f as w,I as F,r as de,a as u,T as re,m as oe,n as xe,o as ee,y as se}from"./index-BQmY0BmM.js";import{r as i,Q as he,X as ue,m as te,I as pe,P as je,i as ne,B as ce,T as fe,h as ge}from"./lucide-react-CAeuRJQk.js";import{D as ve,a as ye,b as Ne,c as be,e as we,T as Te,M as De,t as I,B as ae}from"./MainLayout-Dv9j77B5.js";import{T as Ce,a as Se,b as le,c as T,d as ke,e as h}from"./table-zhTdMUM_.js";import{c as Be,g as Ae,d as Me,u as Re}from"./requestService-BTFAUymV.js";import{a as ze}from"./currency-BpxR3_y8.js";import{A as Oe,a as Ye,b as Le,c as Ee,d as _e,e as He,f as Fe,g as Ie}from"./alert-dialog-vDPnsgl6.js";import{f as V}from"./format-CN3feEER.js";import"./taskService-CI62TrOj.js";const Ve=({open:t,onOpenChange:g,onSuccess:m})=>{const{user:p}=me(),[d,D]=i.useState(!1),[n,v]=i.useState("purchase"),[r,o]=i.useState(""),[A,M]=i.useState(""),[R,L]=i.useState(""),[y,E]=i.useState("TRY"),[z,C]=i.useState(""),[S,O]=i.useState(""),[x,N]=i.useState(""),[K,Y]=i.useState([]);i.useEffect(()=>{t&&k(void 0,null,function*(){try{const X=(yield de()).filter(b=>!b||!b.role?!1:(Array.isArray(b.role)?b.role:[b.role]).some(a=>a==="admin"||a==="super_admin"||a==="team_leader"||typeof a=="string"&&(a.includes("admin")||a.includes("team_leader"))));Y(X)}catch(j){console.error("Yöneticiler yüklenemedi",j),u.error("Yöneticiler yüklenirken hata oluştu: "+(j.message||"Bilinmeyen hata")),Y([])}})},[t]);const _=l=>k(void 0,null,function*(){if(l&&l.preventDefault(),!!p){if(!r.trim()||!A.trim()||!x){u.error("Lütfen gerekli alanları doldurun.");return}D(!0);try{yield Be({type:n,title:r,description:A,amount:R?parseFloat(R):void 0,currency:R?y:void 0,createdBy:p.id,assignedTo:x,startDate:z?re.fromDate(new Date(z)):void 0,endDate:S?re.fromDate(new Date(S)):void 0}),u.success("Talep başarıyla oluşturuldu"),m==null||m(),g(!1),o(""),M(""),L(""),C(""),O(""),N("")}catch(j){console.error("Request creation error:",j),u.error("Talep oluşturulamadı: "+j.message)}finally{D(!1)}}});return e.jsx(ve,{open:t,onOpenChange:g,children:e.jsx(ye,{className:"!max-w-[100vw] sm:!max-w-[95vw] !w-[100vw] sm:!w-[95vw] !h-[100vh] sm:!h-[90vh] !max-h-[100vh] sm:!max-h-[90vh] !left-0 sm:!left-[2.5vw] !top-0 sm:!top-[5vh] !right-0 sm:!right-auto !bottom-0 sm:!bottom-auto !translate-x-0 !translate-y-0 overflow-hidden !p-0 gap-0 bg-white flex flex-col !m-0 !rounded-none sm:!rounded-lg !border-0 sm:!border",children:e.jsxs("div",{className:"flex flex-col h-full min-h-0",children:[e.jsx(Ne,{className:"p-3 sm:p-4 border-b bg-white flex-shrink-0 relative pr-12 sm:pr-16",children:e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 flex-1 min-w-0",children:[e.jsx("div",{className:"h-8 w-8 sm:h-10 sm:w-10 rounded-lg bg-primary/10 flex items-center justify-center border border-primary/20 flex-shrink-0",children:e.jsx(he,{className:"h-4 w-4 sm:h-5 sm:w-5 text-primary"})}),e.jsx(be,{className:"text-lg sm:text-xl font-semibold text-foreground truncate",children:"Yeni Talep Oluştur"}),e.jsx(we,{className:"sr-only",children:"Yeni talep oluşturun"})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 flex-shrink-0",children:[e.jsxs(B,{variant:"outline",size:"sm",className:"border-primary/20 hover:bg-primary/5 rounded-lg px-3 py-1.5 font-medium text-xs sm:text-sm flex-shrink-0",onClick:()=>g(!1),disabled:d,children:[e.jsx(ue,{className:"h-3 w-3 sm:h-4 sm:w-4 mr-1.5 flex-shrink-0"}),"İptal"]}),e.jsxs(B,{variant:"default",size:"sm",className:"bg-primary hover:bg-primary/90 rounded-lg px-3 py-1.5 font-medium text-xs sm:text-sm flex-shrink-0 text-white",onClick:_,disabled:d,children:[d?e.jsx(te,{className:"h-3 w-3 sm:h-4 sm:w-4 mr-1.5 flex-shrink-0 animate-spin"}):e.jsx(pe,{className:"h-3 w-3 sm:h-4 sm:w-4 mr-1.5 flex-shrink-0"}),"Oluştur"]})]})]})}),e.jsx("div",{className:"flex-1 overflow-hidden bg-gray-50/50 p-3 sm:p-4 min-h-0",children:e.jsx("div",{className:"max-w-full mx-auto h-full overflow-y-auto",children:e.jsx("form",{onSubmit:_,className:"space-y-4 sm:space-y-6",children:e.jsxs(P,{children:[e.jsx(U,{children:e.jsx(G,{className:"text-base sm:text-lg",children:"Talep Bilgileri"})}),e.jsxs($,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(f,{className:"text-sm sm:text-base",children:["Kime (Yönetici Seçimi) ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(J,{value:x,onValueChange:N,children:[e.jsx(W,{className:"min-h-[44px] sm:min-h-0",children:e.jsx(Z,{placeholder:"Yönetici seçin"})}),e.jsx(q,{children:K.map(l=>e.jsxs(w,{value:l.id,children:[l.fullName||l.displayName||l.email," (",l.role.includes("super_admin")?"Yönetici":l.role.includes("team_leader")?"Ekip Lideri":"Admin",")"]},l.id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{className:"text-sm sm:text-base",children:"Talep Türü"}),e.jsxs(J,{value:n,onValueChange:v,children:[e.jsx(W,{className:"min-h-[44px] sm:min-h-0",children:e.jsx(Z,{})}),e.jsxs(q,{children:[e.jsx(w,{value:"purchase",children:"Satın Alma Talebi"}),e.jsx(w,{value:"leave",children:"İzin Talebi"}),e.jsx(w,{value:"advance",children:"Avans Talebi"}),e.jsx(w,{value:"expense",children:"Masraf Bildirimi"}),e.jsx(w,{value:"other",children:"Diğer"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(f,{className:"text-sm sm:text-base",children:["Başlık ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(F,{placeholder:"Talebinizi özetleyin...",value:r,onChange:l=>o(l.target.value),className:"min-h-[44px] sm:min-h-0",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(f,{className:"text-sm sm:text-base",children:["Açıklama ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(Te,{placeholder:"Detaylı açıklama...",value:A,onChange:l=>M(l.target.value),rows:4,className:"min-h-[100px] sm:min-h-[120px]",required:!0})]}),(n==="purchase"||n==="advance"||n==="expense")&&e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-3 sm:gap-4",children:[e.jsxs("div",{className:"sm:col-span-2 space-y-2",children:[e.jsx(f,{className:"text-sm sm:text-base",children:"Tutar"}),e.jsx(F,{type:"number",placeholder:"0.00",value:R,onChange:l=>L(l.target.value),min:"0",step:"0.01",className:"min-h-[44px] sm:min-h-0"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{className:"text-sm sm:text-base",children:"Para Birimi"}),e.jsxs(J,{value:y,onValueChange:E,children:[e.jsx(W,{className:"min-h-[44px] sm:min-h-0",children:e.jsx(Z,{})}),e.jsx(q,{children:ze.map(l=>e.jsx(w,{value:l.value,children:l.label},l.value))})]})]})]}),n==="leave"&&e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{className:"text-sm sm:text-base",children:"Başlangıç Tarihi"}),e.jsx(F,{type:"date",value:z,onChange:l=>C(l.target.value),className:"min-h-[44px] sm:min-h-0"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{className:"text-sm sm:text-base",children:"Bitiş Tarihi"}),e.jsx(F,{type:"date",value:S,onChange:l=>O(l.target.value),className:"min-h-[44px] sm:min-h-0"})]})]})]})]})})})})]})})})},qe=()=>{const{user:t,isAdmin:g,isTeamLeader:m,isSuperAdmin:p}=me(),[d,D]=i.useState([]),[n,v]=i.useState({}),[r,o]=i.useState(!0),[A,M]=i.useState(!1),[R,L]=i.useState("my_requests"),[y,E]=i.useState(null),[z,C]=i.useState(!1),[S,O]=i.useState(null),x=g||m,N=()=>k(void 0,null,function*(){if(t){o(!0);try{const a={isSuperAdmin:p,createdBy:t.id,assignedTo:t.id},c=yield Ae(a);D(c);const s=yield de(),ie={};s.forEach(Q=>ie[Q.id]=Q.fullName||Q.email),v(ie)}catch(a){console.error("Fetch requests error:",a),u.error("Talepler yüklenirken hata oluştu")}finally{o(!1)}}});i.useEffect(()=>{t&&N()},[t]);const K=d.filter(a=>a.createdBy===(t==null?void 0:t.id)),Y=x?d.filter(a=>(a.assignedTo===(t==null?void 0:t.id)||p)&&a.status==="pending"):[],_=x?d.filter(a=>(a.assignedTo===(t==null?void 0:t.id)||p)&&a.status!=="pending"):[],l=(a,c)=>k(void 0,null,function*(){if(t){E(a);try{let s="";c==="rejected"&&(s=prompt("Reddetme sebebi (isteğe bağlı):")||""),yield Re(a,c,t.id,s),u.success(c==="approved"?"Talep onaylandı":"Talep reddedildi"),N()}catch(s){console.error("Update status error:",s),u.error("İşlem başarısız")}finally{E(null)}}}),j=()=>k(void 0,null,function*(){if(S)try{yield Me(S),u.success("Talep silindi"),C(!1),O(null),N()}catch(a){u.error("Silme işlemi başarısız")}}),X=a=>{switch(a){case"approved":return e.jsxs(ae,{className:"bg-emerald-500 hover:bg-emerald-600",children:[e.jsx(ne,{className:"w-3 h-3 mr-1"})," Onaylandı"]});case"rejected":return e.jsxs(ae,{variant:"destructive",children:[e.jsx(ce,{className:"w-3 h-3 mr-1"})," Reddedildi"]});default:return e.jsxs(ae,{variant:"secondary",className:"bg-yellow-100 text-yellow-800 hover:bg-yellow-200",children:[e.jsx(ge,{className:"w-3 h-3 mr-1"})," Bekliyor"]})}},b=a=>({leave:"İzin",purchase:"Satın Alma",advance:"Avans",expense:"Masraf",other:"Diğer"})[a]||a,H=(a,c=!1)=>e.jsx("div",{className:"rounded-md border overflow-x-auto -mx-4 sm:mx-0",children:e.jsx("div",{className:"inline-block min-w-full align-middle px-4 sm:px-0",children:e.jsxs(Ce,{className:"min-w-[600px]",children:[e.jsx(Se,{children:e.jsxs(le,{children:[e.jsx(T,{children:"Tür"}),e.jsx(T,{children:"Başlık"}),e.jsx(T,{children:"Talep Eden"}),e.jsx(T,{children:"Tarih"}),e.jsx(T,{children:"Tutar/Detay"}),e.jsx(T,{children:"Durum"}),c&&e.jsx(T,{className:"text-right",children:"İşlemler"})]})}),e.jsx(ke,{children:a.length===0?e.jsx(le,{children:e.jsx(h,{colSpan:c?7:6,className:"text-center py-8 text-muted-foreground",children:"Kayıt bulunamadı"})}):a.map(s=>e.jsxs(le,{children:[e.jsx(h,{className:"font-medium",children:b(s.type)}),e.jsx(h,{children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{children:s.title}),e.jsx("span",{className:"text-xs text-muted-foreground truncate max-w-[200px]",children:s.description})]})}),e.jsx(h,{children:n[s.createdBy]||"Bilinmiyor"}),e.jsx(h,{children:s.createdAt instanceof Object?V(s.createdAt.toDate(),"d MMM yyyy",{locale:I}):"-"}),e.jsxs(h,{children:[s.amount?`${s.amount} ${s.currency}`:"-",s.startDate&&e.jsxs("div",{className:"text-xs text-muted-foreground",children:[V(s.startDate.toDate(),"d MMM",{locale:I}),s.endDate?` - ${V(s.endDate.toDate(),"d MMM",{locale:I})}`:""]})]}),e.jsx(h,{children:e.jsxs("div",{className:"flex flex-col gap-1.5",children:[X(s.status),s.rejectionReason&&e.jsx("span",{className:"text-xs text-red-600 font-medium max-w-[150px]",children:s.rejectionReason}),s.approvedBy&&e.jsxs("div",{className:"flex flex-col gap-0.5 mt-1",children:[e.jsxs("span",{className:"text-xs font-medium text-emerald-700",children:["Onaylayan: ",n[s.approvedBy]||"Bilinmiyor"]}),s.approvedAt&&e.jsx("span",{className:"text-[10px] text-muted-foreground",children:s.approvedAt instanceof Object?V(s.approvedAt.toDate(),"d MMM yyyy HH:mm",{locale:I}):"-"})]})]})}),c&&e.jsx(h,{className:"text-right",children:e.jsx("div",{className:"flex justify-end gap-2",children:s.status==="pending"&&e.jsxs(e.Fragment,{children:[e.jsx(B,{size:"sm",className:"bg-emerald-600 hover:bg-emerald-700 text-white min-h-[44px] min-w-[44px] sm:min-h-0 sm:min-w-0 sm:h-8 sm:w-8 p-0",onClick:()=>l(s.id,"approved"),disabled:!!y,children:y===s.id?e.jsx(te,{className:"w-4 h-4 animate-spin"}):e.jsx(ne,{className:"w-4 h-4"})}),e.jsx(B,{size:"sm",variant:"destructive",className:"min-h-[44px] min-w-[44px] sm:min-h-0 sm:min-w-0 sm:h-8 sm:w-8 p-0",onClick:()=>l(s.id,"rejected"),disabled:!!y,children:y===s.id?e.jsx(te,{className:"w-4 h-4 animate-spin"}):e.jsx(ce,{className:"w-4 h-4"})})]})})}),!c&&s.createdBy===(t==null?void 0:t.id)&&s.status==="pending"&&e.jsx(h,{className:"text-right",children:e.jsx(B,{size:"sm",variant:"ghost",className:"h-8 w-8 p-0 text-muted-foreground hover:text-destructive",onClick:()=>{O(s.id),C(!0)},children:e.jsx(fe,{className:"w-4 h-4"})})})]},s.id))})]})})});return e.jsx(De,{children:e.jsxs("div",{className:"space-y-3 sm:space-y-4 md:space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3 sm:gap-4",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h1",{className:"text-xl sm:text-2xl md:text-3xl font-bold tracking-tight",children:"Talep Yönetimi"}),e.jsx("p",{className:"text-muted-foreground mt-0.5 sm:mt-1 text-xs sm:text-sm",children:"İzin, satın alma ve diğer taleplerinizi yönetin."})]}),e.jsxs(B,{onClick:()=>M(!0),className:"w-full sm:w-auto min-h-[44px] sm:min-h-10 gap-1.5 sm:gap-2 text-xs sm:text-sm",children:[e.jsx(je,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Yeni Talep"}),e.jsx("span",{className:"sm:hidden",children:"Yeni"})]})]}),e.jsxs(oe,{defaultValue:"my_requests",onValueChange:L,className:"w-full",children:[e.jsx("div",{className:"overflow-x-auto pb-2 -mx-4 px-4 sm:mx-0 sm:px-0 sm:pb-0",children:e.jsxs(xe,{className:"w-full sm:w-auto",children:[e.jsx(ee,{value:"my_requests",className:"min-h-[44px] sm:min-h-0",children:"Taleplerim"}),x&&e.jsxs(ee,{value:"incoming",className:"min-h-[44px] sm:min-h-0",children:["Gelen Talepler (",Y.length,")"]}),x&&e.jsx(ee,{value:"history",className:"min-h-[44px] sm:min-h-0",children:"Talep Geçmişi"})]})}),e.jsx(se,{value:"my_requests",className:"mt-4",children:e.jsxs(P,{children:[e.jsx(U,{children:e.jsx(G,{children:"Taleplerim"})}),e.jsx($,{children:H(K)})]})}),x&&e.jsxs(e.Fragment,{children:[e.jsx(se,{value:"incoming",className:"mt-3 sm:mt-4",children:e.jsxs(P,{children:[e.jsx(U,{children:e.jsx(G,{children:"Onay Bekleyen Talepler"})}),e.jsx($,{children:H(Y,!0)})]})}),e.jsx(se,{value:"history",className:"mt-3 sm:mt-4",children:e.jsxs(P,{children:[e.jsx(U,{children:e.jsx(G,{children:"Tüm Talep Geçmişi"})}),e.jsx($,{children:H(_,!1)})]})})]})]}),e.jsx(Ve,{open:A,onOpenChange:M,onSuccess:N}),e.jsx(Oe,{open:z,onOpenChange:C,children:e.jsxs(Ye,{children:[e.jsxs(Le,{children:[e.jsx(Ee,{children:"Emin misiniz?"}),e.jsx(_e,{children:"Bu talebi silmek istediğinize emin misiniz? Bu işlem geri alınamaz."})]}),e.jsxs(He,{children:[e.jsx(Fe,{children:"İptal"}),e.jsx(Ie,{onClick:j,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Sil"})]})]})})]})})};export{qe as default};
