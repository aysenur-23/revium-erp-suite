import{u as M,a as B,r as d,g as O,b as x,T as n,j as e,B as H,A as E,C as u,c as h,d as p,e as j,f,U as G,h as L,i as z}from"./index-Xd90qdO9.js";import{M as N,B as c,C as F}from"./MainLayout-DW7UjMSA.js";import{A as K,a as R}from"./avatar-KtUT5CWN.js";import{S as U}from"./separator-BNuYyAQ9.js";import{g as q,a as J}from"./taskService-CQO0i9v5.js";import{f as g}from"./format-DuC-NjES.js";const $=()=>{const{id:l}=M(),o=B(),[s,v]=d.useState(null),[m,y]=d.useState([]),[b,k]=d.useState(!0);d.useEffect(()=>{l&&S()},[l]);const S=async()=>{if(l)try{const[a,i,_]=await Promise.all([q(l),J(l),O()]);if(!a){x.error("Görev bulunamadı"),o("/tasks");return}const C={...a,due_date:a.dueDate?a.dueDate instanceof n?a.dueDate.toDate().toISOString():new Date(a.dueDate).toISOString():null,created_at:a.createdAt instanceof n?a.createdAt.toDate().toISOString():new Date(a.createdAt).toISOString()};v(C);const T=i.map(t=>{const r=_.find(I=>I.id===t.assignedTo);return{id:t.assignedTo,full_name:(r==null?void 0:r.fullName)||(r==null?void 0:r.displayName)||"",email:(r==null?void 0:r.email)||"",accepted_at:t.acceptedAt?t.acceptedAt instanceof n?t.acceptedAt.toDate().toISOString():new Date(t.acceptedAt).toISOString():null,completed_at:t.completedAt?t.completedAt instanceof n?t.completedAt.toDate().toISOString():new Date(t.completedAt).toISOString():null}});y(T)}catch(a){console.error("Fetch task details error:",a),x.error("Görev detayları yüklenirken hata: "+(a.message||"Bilinmeyen hata")),o("/tasks")}finally{k(!1)}},A=a=>{switch(a){case"completed":return e.jsx(z,{className:"h-6 w-6 text-success"});case"in_progress":return e.jsx(F,{className:"h-6 w-6 text-warning"});default:return e.jsx(L,{className:"h-6 w-6 text-muted-foreground"})}},w=a=>({pending:"Beklemede",in_progress:"Devam Ediyor",completed:"Tamamlandı",cancelled:"İptal"})[a]||a,D=a=>a.split(" ").map(i=>i[0]).join("").toUpperCase().slice(0,2);return b?e.jsx(N,{children:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary"})})}):s?e.jsx(N,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(H,{variant:"ghost",size:"icon",onClick:()=>o("/tasks"),children:e.jsx(E,{className:"h-5 w-5"})}),e.jsx("div",{className:"flex-1",children:e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Görev Detayı"})})]}),e.jsxs("div",{className:"grid gap-6 md:grid-cols-3",children:[e.jsx("div",{className:"md:col-span-2 space-y-6",children:e.jsxs(u,{children:[e.jsx(h,{children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[A(s.status),e.jsx(p,{className:"text-2xl",children:s.title})]}),e.jsxs(c,{variant:s.priority>=3?"destructive":"secondary",children:["Öncelik ",s.priority]})]})}),e.jsxs(j,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Durum"}),e.jsx(c,{variant:"outline",children:w(s.status)})]}),s.description&&e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Açıklama"}),e.jsx("p",{className:"text-muted-foreground",children:s.description})]}),e.jsx(U,{}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"font-semibold mb-2 flex items-center gap-2",children:[e.jsx(f,{className:"h-4 w-4"}),"Oluşturulma Tarihi"]}),e.jsx("p",{className:"text-muted-foreground",children:g(new Date(s.created_at),"dd MMMM yyyy HH:mm")})]}),s.due_date&&e.jsxs("div",{children:[e.jsxs("h3",{className:"font-semibold mb-2 flex items-center gap-2",children:[e.jsx(f,{className:"h-4 w-4"}),"Bitiş Tarihi"]}),e.jsx("p",{className:"text-muted-foreground",children:g(new Date(s.due_date),"dd MMMM yyyy HH:mm")})]})]})]})]})}),e.jsx("div",{children:e.jsxs(u,{children:[e.jsx(h,{children:e.jsxs(p,{className:"flex items-center gap-2",children:[e.jsx(G,{className:"h-5 w-5"}),"Görevdeki Kişiler (",m.length,")"]})}),e.jsx(j,{children:e.jsxs("div",{className:"space-y-3",children:[m.map(a=>e.jsxs("div",{className:"flex items-center gap-3 p-3 rounded-lg border border-border",children:[e.jsx(K,{children:e.jsx(R,{children:D(a.full_name)})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium truncate",children:a.full_name}),e.jsx("div",{className:"text-sm text-muted-foreground truncate",children:a.email}),e.jsxs("div",{className:"mt-1",children:[a.completed_at&&e.jsx(c,{variant:"default",className:"bg-success text-xs",children:"Tamamlandı"}),a.accepted_at&&!a.completed_at&&e.jsx(c,{variant:"secondary",className:"text-xs",children:"Kabul Edildi"}),!a.accepted_at&&e.jsx(c,{variant:"outline",className:"text-xs",children:"Bekliyor"})]})]})]},a.id)),m.length===0&&e.jsx("p",{className:"text-center py-4 text-muted-foreground text-sm",children:"Henüz kimse atanmadı"})]})})]})})]})]})}):null};export{$ as default};
