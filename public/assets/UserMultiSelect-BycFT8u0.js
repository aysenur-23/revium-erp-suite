const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/toastHelpers-DkuKGmwM.js","assets/index-BQmY0BmM.js","assets/lucide-react-CAeuRJQk.js","assets/index-YbdY78QJ.css","assets/taskService-CI62TrOj.js"])))=>i.map(i=>d[i]);
var g=(t,c,l)=>new Promise((i,u)=>{var x=n=>{try{m(l.next(n))}catch(o){u(o)}},h=n=>{try{m(l.throw(n))}catch(o){u(o)}},m=n=>n.done?i(n.value):Promise.resolve(n.value).then(x,h);m((l=l.apply(t,c)).next())});import{r as _,_ as P,a as b,j as a,B as A,l as p}from"./index-BQmY0BmM.js";import{r as d,U as E,a2 as L,n as B,X as K}from"./lucide-react-CAeuRJQk.js";import{C as S,x as T,y as O,z,A as I,E as $,B as D}from"./MainLayout-Dv9j77B5.js";import{P as F,a as M,b as R}from"./popover-Bq_PZ6uK.js";import{A as U,a as V}from"./avatar-CROuoa6p.js";const Q=({selectedUsers:t,onSelectionChange:c,disabled:l})=>{const[i,u]=d.useState([]),[x,h]=d.useState(!1),[m,n]=d.useState(!0),[o,v]=d.useState("");d.useEffect(()=>{y()},[]);const y=()=>g(void 0,null,function*(){try{n(!0);const r=(yield _()).filter(s=>s.id&&(s.fullName||s.displayName||s.email)).map(s=>({id:s.id,full_name:s.fullName||s.displayName||s.email||"İsimsiz Kullanıcı",email:s.email||"",department_id:s.departmentId||null}));u(r)}catch(e){const r=e.message||"Bilinmeyen hata";if(r.includes("permission")||r.includes("permissions")){const{showPermissionErrorToast:s}=yield P(()=>g(void 0,null,function*(){const{showPermissionErrorToast:C}=yield import("./toastHelpers-DkuKGmwM.js");return{showPermissionErrorToast:C}}),__vite__mapDeps([0,1,2,3,4]));s("read","user")}else r.includes("network")||r.includes("unavailable")?b.error("İnternet bağlantısı hatası. Lütfen bağlantınızı kontrol edin."):b.error("Kullanıcılar yüklenirken hata oluştu: "+r);u([])}finally{n(!1)}}),f=d.useMemo(()=>{if(!o.trim())return i;const e=o.trim().toLowerCase();return i.filter(r=>r.full_name&&r.full_name.toLowerCase().includes(e)||r.email&&r.email.toLowerCase().includes(e))},[i,o]),j=e=>{t.includes(e)?c(t.filter(r=>r!==e)):c([...t,e])},N=e=>{c(t.filter(r=>r!==e))},w=()=>!i||i.length===0?[]:i.filter(e=>e&&e.id&&t.includes(e.id)).map(e=>e.full_name||"İsimsiz Kullanıcı"),k=e=>e.split(" ").map(r=>r[0]).join("").toUpperCase().slice(0,2);return a.jsxs("div",{className:"space-y-2",children:[a.jsxs(F,{open:x,onOpenChange:e=>!l&&h(e),children:[a.jsx(M,{asChild:!0,children:a.jsxs(A,{variant:"outline",className:"w-full justify-between h-11 border-2 hover:border-primary/50 transition-colors",disabled:l,children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(E,{className:"h-4 w-4 text-muted-foreground"}),a.jsx("span",{className:"text-sm font-medium",children:t.length>0?`${t.length} kullanıcı seçildi`:"Kullanıcı seçin"})]}),a.jsx(L,{className:p("h-4 w-4 text-muted-foreground transition-transform duration-200",x&&"transform rotate-180")})]})}),a.jsx(R,{className:"w-[90vw] sm:w-[400px] p-0 shadow-lg border-2",side:"bottom",align:"start",sideOffset:4,onOpenAutoFocus:e=>e.preventDefault(),collisionPadding:16,avoidCollisions:!1,children:a.jsxs(S,{shouldFilter:!1,className:"rounded-lg",children:[a.jsx("div",{className:"border-b px-3 py-2.5 bg-transparent",children:a.jsx(T,{placeholder:"Kullanıcı ara...",value:o,onValueChange:e=>v(e),className:"border-0 focus:ring-0 bg-transparent"})}),a.jsxs(O,{className:"max-h-[300px] overflow-y-auto overflow-x-hidden scroll-smooth",style:{height:"var(--cmdk-list-height)",maxHeight:"300px",scrollPaddingBlock:"10px"},children:[a.jsx(z,{className:"py-6 text-center text-sm text-muted-foreground",children:m?"Yükleniyor...":f.length===0?o?"Arama sonucu bulunamadı.":"Kullanıcı bulunamadı.":"Arama sonucu bulunamadı."}),!m&&f.length>0&&a.jsx(I,{children:f.map(e=>a.jsxs($,{value:`${e.id}-${e.full_name}-${e.email}`,onSelect:()=>{j(e.id)},className:p("flex items-center gap-3 cursor-pointer px-3 py-2.5 rounded-md mx-1 my-0.5 transition-colors","hover:bg-accent hover:text-accent-foreground",t.includes(e.id)&&"bg-primary/10"),children:[a.jsx("div",{className:p("flex h-5 w-5 items-center justify-center rounded border-2 shrink-0 pointer-events-none transition-all",t.includes(e.id)?"bg-primary border-primary text-primary-foreground":"border-muted-foreground/30 bg-background"),children:t.includes(e.id)&&a.jsx(B,{className:"h-3.5 w-3.5 stroke-[3]"})}),a.jsx(U,{className:"h-8 w-8 shrink-0 border-2 border-background shadow-sm",children:a.jsx(V,{className:"text-xs font-semibold bg-gradient-to-br from-primary/20 to-primary/10 text-primary",children:k(e.full_name)})}),a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsx("div",{className:"text-sm font-medium truncate",children:e.full_name}),a.jsx("div",{className:"text-xs text-muted-foreground truncate",children:e.email})]})]},e.id))}),m&&a.jsxs("div",{className:"p-6 text-sm text-muted-foreground text-center",children:[a.jsx("div",{className:"inline-block h-4 w-4 animate-spin rounded-full border-2 border-primary border-t-transparent"}),a.jsx("span",{className:"ml-2",children:"Yükleniyor..."})]})]})]})})]}),t.length>0&&a.jsx("div",{className:"flex flex-wrap gap-2 pt-1",children:w().map((e,r)=>{const s=t[r];return s?a.jsxs(D,{variant:"secondary",className:"gap-1.5 px-3 py-1.5 text-sm font-medium bg-primary/10 text-primary border-primary/20 hover:bg-primary/20 transition-colors",children:[a.jsx("span",{className:"truncate max-w-[120px] sm:max-w-none",children:e}),a.jsx(K,{className:p("h-3.5 w-3.5 shrink-0 rounded-full hover:bg-primary/20 p-0.5 transition-colors",!l&&"cursor-pointer"),onClick:()=>!l&&N(s)})]},s):null})})]})};export{Q as U};
