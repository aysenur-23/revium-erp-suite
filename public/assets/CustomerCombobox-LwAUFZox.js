var E=(r,j,c)=>new Promise((o,m)=>{var t=n=>{try{l(c.next(n))}catch(d){m(d)}},f=n=>{try{l(c.throw(n))}catch(d){m(d)}},l=n=>n.done?o(n.value):Promise.resolve(n.value).then(t,f);l((c=c.apply(r,j)).next())});import{a as N,j as e,B as b,l as P,w as D}from"./index-BQmY0BmM.js";import{r as a,_ as z,P as v,n as F}from"./lucide-react-CAeuRJQk.js";import{w as I,C as A,x as B,y as T,z as Y,A as Q,E as M}from"./MainLayout-Dv9j77B5.js";import{P as U,a as V,b as G}from"./popover-Bq_PZ6uK.js";import{C as H}from"./CreateCustomerDialog-C7Uvoya8.js";const R=r=>({id:r.id,name:r.name,company:r.company,phone:r.phone,email:r.email}),_=a.memo(({value:r,onChange:j,placeholder:c="Müşteri seçin..."})=>{const[o,m]=a.useState(!1),[t,f]=a.useState([]),[l,n]=a.useState(!1),[d,x]=a.useState(!1),[w,k]=a.useState(""),C=r||"",p=a.useCallback(()=>E(void 0,null,function*(){n(!0);try{const i=(yield I()).map(R);f(i)}catch(s){f([]),N.error("Müşteriler yüklenirken hata: "+(s.message||"Bilinmeyen hata"))}finally{n(!1)}}),[]);a.useEffect(()=>{p()},[p]),a.useEffect(()=>{o&&t.length===0&&!l&&p()},[o,t.length,l,p]),a.useEffect(()=>{o||k("")},[o]);const y=C?t.find(s=>s.id===C):void 0,g=t.filter(s=>{var h,u,S;const i=w.toLowerCase();return s.name.toLowerCase().includes(i)||((h=s.company)==null?void 0:h.toLowerCase().includes(i))||((u=s.phone)==null?void 0:u.toLowerCase().includes(i))||((S=s.email)==null?void 0:S.toLowerCase().includes(i))}),L=a.useCallback(s=>{const i=s,h=t.find(u=>u.id===i);if(h)try{m(!1),setTimeout(()=>{j(i,h.name)},0)}catch(u){N.error("Müşteri seçilirken hata oluştu")}else N.error("Müşteri bulunamadı")},[t]),O=()=>{p(),x(!1)};return e.jsxs(e.Fragment,{children:[e.jsxs(U,{open:o,onOpenChange:m,children:[e.jsx(V,{asChild:!0,children:e.jsxs(b,{variant:"outline",role:"combobox","aria-expanded":o,className:"w-full justify-between min-h-[44px] sm:min-h-0 h-auto py-2 sm:py-1.5",children:[y?e.jsxs("span",{className:"truncate",children:[y.name,y.company&&` - ${y.company}`]}):c,e.jsx(z,{className:"ml-2 h-4 w-4 shrink-0 opacity-50"})]})}),e.jsx(G,{className:"w-[var(--radix-popover-trigger-width)] sm:w-[400px] p-0 !max-h-[400px] !h-auto",align:"start",side:"bottom",sideOffset:4,onOpenAutoFocus:s=>s.preventDefault(),children:e.jsxs(A,{shouldFilter:!1,children:[e.jsx(B,{placeholder:"Müşteri ara (ad, şirket, telefon, e-posta)...",value:w,onValueChange:s=>{k(s)},className:"text-sm"}),e.jsxs(T,{className:"!max-h-[350px] !h-auto",children:[e.jsx(Y,{children:l?e.jsxs("div",{className:"flex flex-col items-center justify-center gap-2 py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-primary"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Müşteriler yükleniyor..."})]}):g.length===0&&t.length===0?e.jsxs("div",{className:"flex flex-col items-center gap-3 py-6 px-4",children:[e.jsx("p",{className:"text-sm text-muted-foreground text-center",children:"Henüz müşteri kaydı bulunmuyor"}),e.jsxs(b,{variant:"outline",size:"sm",className:"gap-2 min-h-[44px] sm:min-h-0",onClick:()=>{m(!1),x(!0)},children:[e.jsx(v,{className:"h-4 w-4"}),"Yeni Müşteri Ekle"]})]}):e.jsxs("div",{className:"flex flex-col items-center gap-3 py-6 px-4",children:[e.jsx("p",{className:"text-sm text-muted-foreground text-center",children:"Arama sonucu bulunamadı"}),e.jsxs(b,{variant:"outline",size:"sm",className:"gap-2 min-h-[44px] sm:min-h-0",onClick:()=>{m(!1),x(!0)},children:[e.jsx(v,{className:"h-4 w-4"}),"Yeni Müşteri Ekle"]})]})}),!l&&(g.length>0||t.length>0)&&e.jsxs(Q,{children:[e.jsxs(M,{onSelect:()=>{m(!1),x(!0)},className:"flex items-center gap-2 text-primary cursor-pointer min-h-[44px] sm:min-h-0 hover:bg-primary/5",children:[e.jsx(v,{className:"h-4 w-4 flex-shrink-0"}),e.jsx("span",{className:"font-medium",children:"Yeni Müşteri Ekle"})]}),g.map(s=>e.jsxs(M,{value:s.id,onSelect:()=>{L(s.id)},className:"cursor-pointer min-h-[44px] sm:min-h-0 hover:bg-accent transition-colors",children:[e.jsx(F,{className:P("mr-2 h-4 w-4 flex-shrink-0 transition-opacity",C===s.id?"opacity-100 text-primary":"opacity-0")}),e.jsxs("div",{className:"flex flex-col flex-1 min-w-0",children:[e.jsx("span",{className:"font-medium text-sm truncate",children:s.name}),e.jsxs("div",{className:"flex flex-wrap gap-x-2 gap-y-0.5 text-xs text-muted-foreground mt-0.5",children:[s.company&&e.jsx("span",{className:"truncate max-w-[200px]",title:s.company,children:s.company}),s.phone&&e.jsxs("span",{className:"flex-shrink-0",children:["• ",D(s.phone)]}),s.email&&e.jsxs("span",{className:"truncate max-w-[180px]",title:s.email,children:["• ",s.email]})]})]})]},s.id))]}),l&&e.jsxs("div",{className:"flex flex-col items-center justify-center gap-2 py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-primary"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Müşteriler yükleniyor..."})]})]})]})})]}),e.jsx(H,{open:d,onOpenChange:x,onSuccess:O})]})});_.displayName="CustomerCombobox";export{_ as C};
