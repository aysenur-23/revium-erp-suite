var ue=Object.defineProperty,pe=Object.defineProperties;var he=Object.getOwnPropertyDescriptors;var P=Object.getOwnPropertySymbols;var ge=Object.prototype.hasOwnProperty,fe=Object.prototype.propertyIsEnumerable;var W=(t,a,r)=>a in t?ue(t,a,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[a]=r,Z=(t,a)=>{for(var r in a||(a={}))ge.call(a,r)&&W(t,r,a[r]);if(P)for(var r of P(a))fe.call(a,r)&&W(t,r,a[r]);return t},q=(t,a)=>pe(t,he(a));var B=(t,a,r)=>new Promise((m,d)=>{var j=o=>{try{u(r.next(o))}catch(h){d(h)}},w=o=>{try{u(r.throw(o))}catch(h){d(h)}},u=o=>o.done?m(o.value):Promise.resolve(o.value).then(j,w);u((r=r.apply(t,a)).next())});import{j as e,C as I,b as R,B as F,w as je,l as V,u as we,h as be,r as ye,a as _,S as Ne,c as ve,d as Ce,e as ke,f as L}from"./index-BQmY0BmM.js";import{r as i,J as De,E as Ae,S as Se,T as Me,N as Te,K as Oe,o as te,q as ae,a8 as Le,a9 as Ie,P as Re,X as Fe,l as Ee}from"./lucide-react-CAeuRJQk.js";import{f as Ue,h as ze,i as Be,j as ee,B as _e,w as Ve,g as Ye,M as se,v as Ke}from"./MainLayout-Dv9j77B5.js";import{S as Qe}from"./search-input-DCf0xYml.js";import{A as $e,a as He,b as Ge,c as Je,d as Xe,e as Pe,f as We,g as Ze}from"./alert-dialog-vDPnsgl6.js";import{C as qe}from"./CreateCustomerDialog-C7Uvoya8.js";import{C as es}from"./CustomerDetailModal-DKJKtFVM.js";import{getSavedReports as ss}from"./reportService-yUgxtgcG.js";import{D as ts}from"./DetailedValueReportModal-BRj7dqdh.js";import{L as as}from"./loading-state-BC76X596.js";import"./taskService-CI62TrOj.js";import"./separator-C1rUq6WW.js";import"./format-CN3feEER.js";import"./storageService-BUAGZT8Z.js";import"./driveService-ChwQKMyd.js";import"./table-zhTdMUM_.js";import"./exchangeRateService-Ba2gZPdu.js";import"./currency-BpxR3_y8.js";const re=i.memo(({customer:t,orders:a,onSelect:r,onDelete:m})=>{const d=a.filter(o=>o.customerId===t.id||o.customer_id===t.id),j=d.length,w=d.reduce((o,h)=>o+(h.totalAmount||0),0),u=j>0;return e.jsx(I,{className:"group hover:shadow-xl transition-all duration-300 cursor-pointer border border-border/60 hover:border-primary/50 flex flex-col h-full overflow-hidden bg-white hover:-translate-y-1",onClick:()=>r(t),children:e.jsxs(R,{className:"p-3 sm:p-4 md:p-5 lg:p-6 flex flex-col flex-1 gap-3 sm:gap-4 md:gap-5",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2 sm:gap-3",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-bold text-sm sm:text-base md:text-lg truncate text-foreground mb-0.5 sm:mb-1",title:t.name,children:t.name}),t.company&&e.jsxs("div",{className:"flex items-center gap-1 sm:gap-1.5 mt-0.5",children:[e.jsx(De,{className:"h-3 w-3 sm:h-3.5 sm:w-3.5 text-muted-foreground flex-shrink-0"}),e.jsx("p",{className:"text-[10px] sm:text-xs md:text-sm text-muted-foreground truncate",title:t.company,children:t.company})]})]}),e.jsxs(Ue,{children:[e.jsx(ze,{asChild:!0,children:e.jsx(F,{variant:"ghost",size:"icon",className:"h-7 w-7 sm:h-8 sm:w-8 opacity-0 group-hover:opacity-100 transition-opacity flex-shrink-0 hover:bg-muted/80 rounded-lg",onClick:o=>o.stopPropagation(),children:e.jsx(Ae,{className:"h-3.5 w-3.5 sm:h-4 sm:w-4"})})}),e.jsxs(Be,{align:"end",children:[e.jsxs(ee,{onClick:o=>{o.stopPropagation(),r(t)},children:[e.jsx(Se,{className:"mr-2 h-4 w-4"})," Detayları Görüntüle"]}),e.jsxs(ee,{className:"text-destructive focus:text-destructive",onClick:o=>{o.stopPropagation(),m(t)},children:[e.jsx(Me,{className:"mr-2 h-4 w-4"})," Sil"]})]})]})]}),e.jsxs("div",{className:"space-y-2 sm:space-y-2.5 flex-1 min-h-[60px]",children:[t.email&&e.jsxs("div",{className:"flex items-center gap-2 sm:gap-2.5 text-[10px] sm:text-xs md:text-sm bg-gradient-to-r from-muted/40 to-muted/30 rounded-lg px-2.5 sm:px-3 md:px-3.5 py-2 sm:py-2.5 border border-muted/60 shadow-sm hover:shadow transition-shadow",children:[e.jsx(Te,{className:"h-3.5 w-3.5 sm:h-4 sm:w-4 text-primary flex-shrink-0"}),e.jsx("span",{className:"truncate text-foreground font-medium",title:t.email,children:t.email})]}),t.phone&&e.jsxs("div",{className:"flex items-center gap-2 sm:gap-2.5 text-[10px] sm:text-xs md:text-sm bg-gradient-to-r from-muted/40 to-muted/30 rounded-lg px-2.5 sm:px-3 md:px-3.5 py-2 sm:py-2.5 border border-muted/60 shadow-sm hover:shadow transition-shadow",children:[e.jsx(Oe,{className:"h-3.5 w-3.5 sm:h-4 sm:w-4 text-primary flex-shrink-0"}),e.jsx("span",{className:"text-foreground font-medium",children:je(t.phone)})]}),!t.email&&!t.phone&&e.jsx("div",{className:"text-[10px] sm:text-xs md:text-sm text-muted-foreground italic py-2 sm:py-3 text-center bg-muted/20 rounded-lg border border-dashed border-muted",children:"İletişim bilgisi yok"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 sm:gap-4 pt-3 sm:pt-4 border-t border-border/60",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{className:"flex items-center gap-1.5 sm:gap-2 mb-1 sm:mb-1.5",children:[e.jsx(te,{className:"h-3.5 w-3.5 sm:h-4 sm:w-4 text-muted-foreground"}),e.jsx("span",{className:"text-[10px] sm:text-xs md:text-sm font-medium text-muted-foreground",children:"Sipariş"})]}),e.jsx("span",{className:"text-lg sm:text-xl md:text-2xl font-bold text-foreground",children:j})]}),e.jsxs("div",{className:"flex flex-col items-end",children:[e.jsxs("div",{className:"flex items-center gap-1.5 sm:gap-2 mb-1 sm:mb-1.5",children:[e.jsx(ae,{className:"h-3.5 w-3.5 sm:h-4 sm:w-4 text-muted-foreground"}),e.jsx("span",{className:"text-[10px] sm:text-xs md:text-sm font-medium text-muted-foreground",children:"Toplam"})]}),e.jsxs("span",{className:"text-lg sm:text-xl md:text-2xl font-bold text-foreground",children:["₺",new Intl.NumberFormat("tr-TR",{minimumFractionDigits:0,maximumFractionDigits:0}).format(w)]})]})]}),e.jsx("div",{className:"pt-2 sm:pt-3 border-t border-border/60",children:e.jsx(_e,{variant:u?"default":"secondary",className:V("rounded-full px-2.5 sm:px-3 py-1 sm:py-1.5 w-full justify-center text-[10px] sm:text-xs",u?"bg-emerald-100 text-emerald-700 border-emerald-200":"bg-muted/60 border-muted"),children:u?"Aktif":"Pasif"})})]})})},(t,a)=>t.customer.id===a.customer.id&&t.customer.name===a.customer.name&&t.customer.email===a.customer.email&&t.customer.phone===a.customer.phone&&t.customer.company===a.customer.company&&t.orders.length===a.orders.length&&t.orders.every((r,m)=>{const d=a.orders[m];return r.id===(d==null?void 0:d.id)&&r.totalAmount===(d==null?void 0:d.totalAmount)}));re.displayName="CustomerCard";const Cs=()=>{we();const t=be(),[a,r]=i.useState([]),[m,d]=i.useState([]),[j,w]=i.useState(!0),[u,o]=i.useState(!1),[h,Y]=i.useState(!1),[le,E]=i.useState(!1),[k,U]=i.useState(null),[g,D]=i.useState(""),[rs,oe]=i.useState({}),[b,A]=i.useState("all"),[ie,K]=i.useState(!1),[S,y]=i.useState(null);i.useEffect(()=>{C()},[]);const C=i.useCallback(()=>B(void 0,null,function*(){try{w(!0);const[s,l,c,f]=yield Promise.all([Ve(),ye(),ss({reportType:"sales_quote"}),Ye()]);d(f);const x={};l.forEach(n=>{x[n.id]=n.fullName||n.displayName||n.email}),oe(x);const p={};c.forEach(n=>{var T,J,O,X;const v=n.metadata||{},z=v==null?void 0:v.customerId;if(!z)return;const ce=((J=(T=n.createdAt)==null?void 0:T.toMillis)==null?void 0:J.call(T))||Date.parse(((X=(O=n.createdAt)==null?void 0:O.toDate)==null?void 0:X.call(O))||n.createdAt||""),xe=Number((v==null?void 0:v.grandTotal)||0),H={id:n.id,title:n.title||"Teklif",date:ce||Date.now(),total:xe,downloadUrl:n.driveLink||n.fileUrl},G=p[z];(!G||H.date>G.date)&&(p[z]=H)});const M=s.map(n=>q(Z({},n),{lastQuote:p[n.id]||null}));r(M)}catch(s){console.error("Fetch customers error:",s),_.error(s.message||"Müşteriler yüklenirken hata oluştu")}finally{w(!1)}}),[]),ne=()=>B(void 0,null,function*(){if(k)try{yield Ke(k.id),_.success("Müşteri silindi"),C(),E(!1),U(null)}catch(s){console.error("Delete customer error:",s),_.error(s.message||"Müşteri silinirken hata oluştu")}}),N=i.useMemo(()=>{const s=a.length,l=m.length,c=m.reduce((x,p)=>x+(p.totalAmount||0),0),f=a.filter(x=>m.filter(M=>M.customerId===x.id||M.customer_id===x.id).length>0).length;return{total:s,totalOrders:l,totalAmount:c,activeCustomers:f}},[a,m]),Q=i.useCallback(s=>m.some(l=>l.customerId===s.id||l.customer_id===s.id),[m]),$=i.useMemo(()=>a.filter(s=>{var c,f,x,p;const l=g.toLocaleLowerCase("tr-TR");return l&&!(((c=s.name)==null?void 0:c.toLocaleLowerCase("tr-TR"))||"").includes(l)&&!(((f=s.email)==null?void 0:f.toLocaleLowerCase("tr-TR"))||"").includes(l)&&!(((x=s.company)==null?void 0:x.toLocaleLowerCase("tr-TR"))||"").includes(l)?!1:b==="needs_contact"?!s.email||!s.phone:b==="vip"?((p=s.tags)==null?void 0:p.includes("vip"))||!1:b==="active"?Q(s):!0}).sort((s,l)=>s.updatedAt&&l.updatedAt?l.updatedAt.seconds-s.updatedAt.seconds:0),[a,g,b,m,Q]),me=i.useMemo(()=>{var s,l,c;try{return new Intl.NumberFormat("tr-TR",{style:"currency",currency:"TRY",minimumFractionDigits:2}).format(N.totalAmount)}catch(f){return`₺${(c=(l=(s=N.totalAmount)==null?void 0:s.toFixed)==null?void 0:l.call(s,2))!=null?c:"0,00"}`}},[N.totalAmount]),de=[{key:"total-customers",label:"Toplam Müşteri",value:N.total,icon:Le,accent:"bg-primary/10 text-primary",description:"Tüm müşteri kayıtları",onClick:()=>{A("all"),D(""),y("total-customers")},isActive:S==="total-customers"},{key:"total-orders",label:"Toplam Sipariş",value:N.totalOrders,icon:te,accent:"bg-emerald-100 text-emerald-700",description:"Sipariş listesine git",onClick:()=>{y("total-orders"),t("/orders")},isActive:S==="total-orders"},{key:"total-amount",label:"Toplam Tutar",value:me,icon:ae,accent:"bg-amber-100 text-amber-700",description:"Raporları görüntüle",onClick:()=>{y("total-amount"),K(!0)},isActive:S==="total-amount"},{key:"active-customers",label:"Aktif Müşteri",value:N.activeCustomers,icon:Ie,accent:"bg-purple-100 text-purple-700",description:"Siparişi olan müşteriler",onClick:()=>{A("active"),y("active-customers")},isActive:S==="active-customers"}];return j?e.jsx(se,{children:e.jsx(as,{message:"Müşteriler yükleniyor..."})}):e.jsxs(se,{children:[e.jsxs("div",{className:"space-y-3 sm:space-y-4 md:space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-2 sm:gap-3 md:gap-4",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h1",{className:"text-xl sm:text-2xl md:text-3xl font-bold text-foreground",children:"Müşteriler"}),e.jsx("p",{className:"text-muted-foreground mt-0.5 sm:mt-1 text-xs sm:text-sm",children:"Müşteri ve tedarikçi listenizi yönetin"})]}),e.jsxs(F,{className:"gap-1.5 sm:gap-2 w-full sm:w-auto min-h-[44px] sm:min-h-10 text-xs sm:text-sm",onClick:()=>o(!0),children:[e.jsx(Re,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Yeni Müşteri"}),e.jsx("span",{className:"sm:hidden",children:"Yeni"})]})]}),e.jsx(I,{className:"border-2",children:e.jsx(R,{className:"p-4 sm:p-5 md:pt-6",children:e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3 sm:gap-4",children:de.map(s=>{const l=s.icon;return e.jsx(I,{className:V("border-2 border-border/60 shadow-sm cursor-pointer transition-all duration-200 hover:shadow-lg hover:-translate-y-0.5 focus-within:ring-2 focus-within:ring-primary/40",s.isActive&&"border-primary shadow-xl ring-2 ring-primary/20 bg-primary/5"),role:"button",tabIndex:0,onClick:s.onClick,onKeyDown:c=>{(c.key==="Enter"||c.key===" ")&&(c.preventDefault(),s.onClick())},"aria-label":`${s.label} kartı`,children:e.jsxs(R,{className:"p-3 sm:p-4 md:p-5 flex items-center gap-2 sm:gap-3 md:gap-4",children:[e.jsx("div",{className:V("h-10 w-10 sm:h-12 sm:w-12 md:h-14 md:w-14 rounded-xl sm:rounded-2xl flex items-center justify-center shadow-md flex-shrink-0",s.accent),children:e.jsx(l,{className:"h-4 w-4 sm:h-5 sm:w-5 md:h-6 md:w-6"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-[10px] sm:text-xs uppercase tracking-wide text-muted-foreground font-semibold",children:s.label}),e.jsx("p",{className:"text-xl sm:text-2xl md:text-3xl font-bold text-foreground mt-1 sm:mt-1.5",children:s.value}),e.jsx("p",{className:"text-[10px] sm:text-[11px] text-muted-foreground mt-0.5 sm:mt-1 hidden sm:block",children:s.description})]})]})},s.key)})})})}),e.jsx(I,{className:"border-2",children:e.jsx(R,{className:"p-3 sm:p-4 md:p-6",children:e.jsxs("div",{className:"flex flex-col sm:flex-row items-stretch sm:items-center gap-2 sm:gap-3 md:gap-4",children:[e.jsx("div",{className:"flex-1 min-w-0 w-full sm:w-auto sm:min-w-[200px] md:min-w-[250px]",children:e.jsx(Qe,{placeholder:"İsim, e-posta veya şirket ara...",className:"w-full h-9 sm:h-10 text-xs sm:text-sm",value:g,onChange:s=>{D(s.target.value),s.target.value===""&&y(null)}})}),e.jsx("div",{className:"w-full sm:w-auto sm:min-w-[160px] md:min-w-[180px]",children:e.jsxs(Ne,{value:b,onValueChange:s=>A(s),children:[e.jsx(ve,{className:"w-full h-9 sm:h-10 text-xs sm:text-sm",children:e.jsx(Ce,{placeholder:"Filtrele"})}),e.jsxs(ke,{children:[e.jsx(L,{value:"all",children:"Tümü"}),e.jsx(L,{value:"needs_contact",children:"Kontak Eksik"}),e.jsx(L,{value:"vip",children:"VIP"}),e.jsx(L,{value:"active",children:"Aktif Müşteriler"})]})]})}),(g||b!=="all")&&e.jsxs(F,{variant:"outline",size:"sm",onClick:()=>{D(""),A("all"),y(null)},className:"h-9 sm:h-10 text-xs sm:text-sm",children:[e.jsx(Fe,{className:"h-3.5 w-3.5 sm:h-4 sm:w-4 sm:mr-2"}),e.jsx("span",{className:"hidden sm:inline",children:"Temizle"})]})]})})}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-3 sm:gap-4 md:gap-5 lg:gap-6",children:$.map(s=>e.jsx(re,{customer:s,orders:m,onSelect:l=>{U(l),Y(!0)},onDelete:l=>{U(l),E(!0)}},s.id))}),$.length===0&&e.jsxs("div",{className:"text-center py-8 sm:py-12 md:py-16 bg-muted/10 rounded-xl border border-dashed border-muted-foreground/20 px-4",children:[e.jsx("div",{className:"mx-auto w-10 h-10 sm:w-12 sm:h-12 bg-muted/50 rounded-full flex items-center justify-center mb-3 sm:mb-4",children:e.jsx(Ee,{className:"h-5 w-5 sm:h-6 sm:w-6 text-muted-foreground"})}),e.jsx("h3",{className:"text-base sm:text-lg font-semibold text-foreground",children:"Müşteri Bulunamadı"}),e.jsx("p",{className:"text-xs sm:text-sm text-muted-foreground max-w-sm mx-auto mt-2",children:g?`"${g}" aramasıyla eşleşen sonuç yok.`:"Henüz kayıtlı müşteri bulunmuyor. Yeni müşteri ekleyerek başlayın."}),g&&e.jsx(F,{variant:"link",onClick:()=>D(""),className:"mt-2 text-xs sm:text-sm",children:"Aramayı temizle"})]})]}),e.jsx(qe,{open:u,onOpenChange:o,onSuccess:C}),k&&e.jsx(es,{open:h,onOpenChange:Y,customer:k,onUpdate:C,onDelete:C}),e.jsx($e,{open:le,onOpenChange:E,children:e.jsxs(He,{children:[e.jsxs(Ge,{children:[e.jsx(Je,{children:"Müşteriyi sil?"}),e.jsx(Xe,{children:"Bu işlem geri alınamaz. Müşteri kalıcı olarak silinecek."})]}),e.jsxs(Pe,{children:[e.jsx(We,{children:"İptal"}),e.jsx(Ze,{onClick:ne,children:"Sil"})]})]})}),e.jsx(ts,{open:ie,onOpenChange:K,title:"Müşteri Değer Raporu",type:"customers",data:a,orders:m})]})};export{Cs as default};
