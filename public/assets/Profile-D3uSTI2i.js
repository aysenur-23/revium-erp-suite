var Z=Object.defineProperty,ee=Object.defineProperties;var se=Object.getOwnPropertyDescriptors;var _=Object.getOwnPropertySymbols;var te=Object.prototype.hasOwnProperty,ae=Object.prototype.propertyIsEnumerable;var B=(t,l,i)=>l in t?Z(t,l,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[l]=i,F=(t,l)=>{for(var i in l||(l={}))te.call(l,i)&&B(t,i,l[i]);if(_)for(var i of _(l))ae.call(l,i)&&B(t,i,l[i]);return t},H=(t,l)=>ee(t,se(l));var C=(t,l,i)=>new Promise((g,r)=>{var m=c=>{try{f(i.next(c))}catch(b){r(b)}},A=c=>{try{f(i.throw(c))}catch(b){r(b)}},f=c=>c.done?g(c.value):Promise.resolve(c.value).then(m,A);f((i=i.apply(t,l)).next())});import{u as J,h as re,j as e,C as o,p as L,q as T,B as le,b as p,a3 as ie,a as R,T as ce}from"./index-BQmY0BmM.js";import{B as S,I as M,t as z,M as de}from"./MainLayout-Dv9j77B5.js";import{A as ne,a as oe}from"./avatar-CROuoa6p.js";import{r as k,ag as $,q as O,i as me,h as E,B as Y,W as xe,ah as ue,l as he,N as pe,t as ge}from"./lucide-react-CAeuRJQk.js";import{T as K,a as q,b as D,c as u,d as W,e as h}from"./table-zhTdMUM_.js";import{S as X}from"./skeleton-jcdN6-ik.js";import{b as je,c as be}from"./taskService-CI62TrOj.js";import{g as fe}from"./pdfGenerator-CpYttanq.js";import{f as Ne}from"./formatLastLogin-BEZSaV0P.js";import"./isSameDay-CbFR9PGK.js";import"./format-CN3feEER.js";import"./subDays-DIU4Ell8.js";import"./addDays-DpNspVkx.js";import"./isToday-imnuOj2q.js";const ve={pending:"Beklemede",accepted:"Kabul edildi",rejected:"Reddedildi",completed:"Tamamlandı",in_progress:"Devam ediyor"},P=t=>t?(t instanceof Date?t:new Date(t)).toLocaleString("tr-TR"):"-",we=()=>{const{user:t}=J(),l=re(),[i,g]=k.useState(!0),[r,m]=k.useState([]),[A,f]=k.useState([]);k.useEffect(()=>{if(!(t!=null&&t.id))return;C(void 0,null,function*(){g(!0);try{const d=(yield je()).slice(0,500),n=10,j=[];for(let x=0;x<d.length;x+=n){const I=d.slice(x,x+n),w=yield Promise.all(I.map(y=>C(void 0,null,function*(){try{return(yield be(y.id)).filter(G=>G.assignedTo===t.id).map(G=>H(F({},G),{taskId:y.id,taskTitle:y.title,taskStatus:y.status}))}catch(U){return console.error(`Error fetching assignments for task ${y.id}:`,U),[]}})));j.push(...w.flat())}m(j);const v=yield ie({userId:t.id,limit:200}).catch(()=>[]);f(v)}catch(a){console.error("User personal insights error:",a),R.error((a==null?void 0:a.message)||"Profil istatistikleri alınamadı")}finally{g(!1)}})},[t==null?void 0:t.id]);const c=k.useMemo(()=>({total:r.length,accepted:r.filter(a=>a.status==="accepted").length,rejected:r.filter(a=>a.status==="rejected").length,completed:r.filter(a=>a.status==="completed").length,pending:r.filter(a=>a.status==="pending").length,active:r.filter(a=>["pending","accepted"].includes(a.status)).length}),[r]),b=r.filter(s=>s.status==="rejected"&&s.rejectionReason&&s.rejectionReason.trim().length>0),Q=()=>C(void 0,null,function*(){if(t)try{const s=yield fe({userName:t.fullName||t.email,userEmail:t.email,total:c.total,accepted:c.accepted,rejected:c.rejected,pending:c.pending,completed:c.completed,active:c.active,assignments:r.map(n=>{var j;return{taskTitle:n.taskTitle,status:n.status,assignedAt:n.assignedAt.toDate(),completedAt:((j=n.completedAt)==null?void 0:j.toDate())||null}})}),a=URL.createObjectURL(s),d=document.createElement("a");d.href=a,d.download=`kullanici-istatistikleri-${t.fullName||t.email}-${new Date().toISOString().split("T")[0]}.pdf`,document.body.appendChild(d),d.click(),document.body.removeChild(d),URL.revokeObjectURL(a),R.success("PDF raporu indirildi")}catch(s){console.error("PDF export error:",s),R.error("PDF oluşturulurken hata: "+s.message)}});if(!t)return null;if(i)return e.jsxs("div",{className:"space-y-4",children:[e.jsx(X,{className:"h-32"}),e.jsx(X,{className:"h-48"})]});const N=s=>{l(`/tasks${s?`?filter=${s}`:""}`)},V=[{label:"Toplam Görev",value:c.total,icon:$,color:"primary",gradient:"from-primary/10 via-primary/5 to-white",borderColor:"border-primary/20",onClick:()=>N()},{label:"Aktif Görev",value:c.active,icon:O,color:"blue",gradient:"from-blue-50 via-blue-10 to-white",borderColor:"border-blue-200",onClick:()=>N("active")},{label:"Tamamlanan",value:c.completed,icon:me,color:"emerald",gradient:"from-emerald-50 via-emerald-10 to-white",borderColor:"border-emerald-200",onClick:()=>N("completed")},{label:"Bekleyen",value:c.pending,icon:E,color:"amber",gradient:"from-amber-50 via-amber-10 to-white",borderColor:"border-amber-200",onClick:()=>N("pending")},{label:"Reddedilen",value:c.rejected,icon:Y,color:"red",gradient:"from-red-50 via-red-10 to-white",borderColor:"border-red-200",onClick:()=>N("rejected")}];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(o,{className:"border-2 shadow-lg",children:[e.jsx(L,{className:"pb-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(T,{className:"text-xl sm:text-2xl font-bold flex items-center gap-2",children:[e.jsx("div",{className:"h-8 w-8 rounded-lg bg-primary/10 flex items-center justify-center",children:e.jsx(O,{className:"h-5 w-5 text-primary"})}),"Görev İstatistiklerim"]}),e.jsxs(le,{size:"sm",variant:"outline",onClick:Q,className:"gap-2",children:[e.jsx(xe,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"PDF İndir"})]})]})}),e.jsx(p,{children:e.jsx("div",{className:"grid gap-4 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-5",children:V.map(s=>{const a=s.icon,d=()=>{switch(s.color){case"primary":return"bg-primary/10";case"blue":return"bg-blue-500/10";case"emerald":return"bg-emerald-500/10";case"amber":return"bg-amber-500/10";case"red":return"bg-red-500/10";default:return"bg-primary/10"}},n=()=>{switch(s.color){case"primary":return"text-primary";case"blue":return"text-blue-600";case"emerald":return"text-emerald-600";case"amber":return"text-amber-600";case"red":return"text-red-600";default:return"text-primary"}};return e.jsx(o,{className:`bg-gradient-to-br ${s.gradient} border-2 ${s.borderColor} hover:shadow-xl transition-all duration-300 cursor-pointer group hover:-translate-y-1`,onClick:s.onClick,children:e.jsxs(p,{className:"p-3 sm:p-4",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsx("div",{className:`h-8 w-8 rounded-lg ${d()} flex items-center justify-center flex-shrink-0`,children:e.jsx(a,{className:`h-4 w-4 ${n()}`})}),e.jsx(ue,{className:"h-3.5 w-3.5 text-muted-foreground opacity-0 group-hover:opacity-100 transition-opacity"})]}),e.jsx("p",{className:"text-[10px] sm:text-xs text-muted-foreground uppercase tracking-wide mb-1.5 font-medium",children:s.label}),e.jsx("p",{className:"text-2xl sm:text-3xl font-bold text-foreground",children:s.value})]})},s.label)})})})]}),e.jsxs(o,{className:"border-2 shadow-lg",children:[e.jsx(L,{className:"bg-gradient-to-r from-gray-50 to-white border-b",children:e.jsxs(T,{className:"text-xl sm:text-2xl font-bold flex items-center gap-2",children:[e.jsx("div",{className:"h-8 w-8 rounded-lg bg-primary/10 flex items-center justify-center",children:e.jsx($,{className:"h-5 w-5 text-primary"})}),"Görevlerim"]})}),e.jsx(p,{className:"space-y-4",children:r.length===0?e.jsxs("div",{className:"text-center text-muted-foreground py-12",children:[e.jsx($,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{className:"text-sm font-medium",children:"Henüz size atanan görev bulunmuyor."})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(K,{children:[e.jsx(q,{children:e.jsxs(D,{children:[e.jsx(u,{children:"Görev"}),e.jsx(u,{children:"Durum"}),e.jsx(u,{children:"Atama"}),e.jsx(u,{children:"Kabul"}),e.jsx(u,{children:"Tamamlanma"})]})}),e.jsx(W,{children:r.map(s=>{var a,d;return e.jsxs(D,{className:"cursor-pointer hover:bg-muted/50 transition-colors",onClick:()=>l(`/tasks?taskId=${s.taskId}`),children:[e.jsx(h,{className:"font-medium",children:s.taskTitle}),e.jsx(h,{children:e.jsx(S,{variant:s.status==="rejected"?"destructive":s.status==="accepted"?"default":s.status==="completed"?"secondary":"outline",children:ve[s.status]||s.status})}),e.jsx(h,{className:"text-sm text-muted-foreground",children:P((d=(a=s.assignedAt)==null?void 0:a.toDate)==null?void 0:d.call(a))}),e.jsx(h,{className:"text-sm text-muted-foreground",children:s.acceptedAt?P(s.acceptedAt.toDate()):"-"}),e.jsx(h,{className:"text-sm text-muted-foreground",children:s.completedAt?P(s.completedAt.toDate()):"-"})]},`${s.taskId}-${s.id}`)})})]})})})]}),b.length>0&&e.jsxs(o,{className:"border-2 shadow-lg",children:[e.jsx(L,{className:"bg-gradient-to-r from-red-50/50 to-white border-b",children:e.jsxs(T,{className:"text-xl sm:text-2xl font-bold flex items-center gap-2",children:[e.jsx("div",{className:"h-8 w-8 rounded-lg bg-red-500/10 flex items-center justify-center",children:e.jsx(Y,{className:"h-5 w-5 text-red-600"})}),"Reddetme Notlarım"]})}),e.jsx(p,{className:"space-y-4",children:b.map(s=>e.jsxs("div",{className:"rounded-lg border-2 border-red-200 bg-red-50/30 hover:bg-red-50/50 p-4 space-y-2 transition-colors cursor-pointer",onClick:()=>l(`/tasks?taskId=${s.taskId}`),children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"font-medium text-sm text-foreground",children:s.taskTitle}),e.jsx("span",{className:"text-xs text-muted-foreground",children:s.assignedAt?M(s.assignedAt.toDate(),{addSuffix:!0,locale:z}):"-"})]}),e.jsx("p",{className:"text-sm text-foreground whitespace-pre-line leading-relaxed",children:s.rejectionReason})]},`${s.taskId}-${s.id}`))})]}),e.jsxs(o,{className:"border-2 shadow-lg",children:[e.jsx(L,{className:"bg-gradient-to-r from-gray-50 to-white border-b",children:e.jsxs(T,{className:"text-xl sm:text-2xl font-bold flex items-center gap-2",children:[e.jsx("div",{className:"h-8 w-8 rounded-lg bg-primary/10 flex items-center justify-center",children:e.jsx(E,{className:"h-5 w-5 text-primary"})}),"İşlem Geçmişim"]})}),e.jsx(p,{className:"space-y-4",children:A.length===0?e.jsxs("div",{className:"text-center text-muted-foreground py-12",children:[e.jsx(E,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{className:"text-sm font-medium",children:"Henüz işlem kaydı bulunmuyor."})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(K,{children:[e.jsx(q,{children:e.jsxs(D,{children:[e.jsx(u,{children:"İşlem"}),e.jsx(u,{children:"Bölüm"}),e.jsx(u,{children:"Açıklama"}),e.jsx(u,{children:"Tarih"})]})}),e.jsx(W,{children:A.slice(0,20).map(s=>{const a={CREATE:"Oluşturuldu",UPDATE:"Güncellendi",DELETE:"Silindi"},d={tasks:"Görevler",users:"Kullanıcılar",departments:"Departmanlar",orders:"Siparişler",production_orders:"Üretim Siparişleri",customers:"Müşteriler",products:"Ürünler",projects:"Projeler",audit_logs:"Loglar",role_permissions:"Yetkiler",raw_materials:"Hammaddeler",materials:"Malzemeler",user_logins:"Giriş Kayıtları"},n=a[s.action]||s.action,j=d[s.tableName]||s.tableName;let v=s.recordId?`Kayıt ID: ${s.recordId.slice(0,8)}...`:"Bilinmiyor";if(s.tableName==="user_logins"){const x=s.metadata;if(x&&typeof x=="object"&&"method"in x){const I={EMAIL:"E-posta ile giriş",GOOGLE:"Google ile giriş"},w=x.method;v=w?I[w]||`Giriş (${w})`:"Sistem girişi"}else v="Sistem girişi"}return e.jsxs(D,{className:"hover:bg-muted/30 transition-colors",children:[e.jsx(h,{children:e.jsx(S,{variant:s.action==="DELETE"?"destructive":s.action==="UPDATE"?"secondary":(s.tableName==="user_logins","default"),children:s.tableName==="user_logins"?"Giriş Yapıldı":n})}),e.jsx(h,{className:"font-medium",children:j}),e.jsx(h,{className:"text-sm text-muted-foreground",children:v}),e.jsx(h,{className:"text-sm text-muted-foreground",children:s.createdAt?M(s.createdAt.toDate(),{addSuffix:!0,locale:z}):"-"})]},s.id)})})]})})})]})]})},_e=()=>{var i,g;const{user:t}=J(),l=r=>r?r.split(" ").map(m=>m[0]).join("").toUpperCase().slice(0,2):"U";return e.jsx(de,{children:e.jsxs("div",{className:"space-y-4 sm:space-y-6 md:space-y-8",children:[t&&e.jsx(o,{className:"border-0 shadow-lg bg-gradient-to-br from-primary/10 via-primary/5 to-background overflow-hidden",children:e.jsx("div",{className:"p-6 sm:p-8 md:p-10",children:e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center gap-4 sm:gap-6",children:[e.jsx(ne,{className:"h-20 w-20 sm:h-24 sm:w-24 md:h-28 md:w-28 border-4 border-background shadow-lg",children:e.jsx(oe,{className:"text-2xl sm:text-3xl md:text-4xl font-bold bg-primary text-primary-foreground",children:l(t.fullName||t.email)})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h1",{className:"text-2xl sm:text-3xl md:text-4xl font-bold text-foreground mb-2",children:t.fullName||t.email}),e.jsx("p",{className:"text-muted-foreground text-sm sm:text-base mb-3 break-all",children:t.email}),e.jsx("div",{className:"flex flex-wrap gap-2",children:((i=t.roles)!=null&&i.length?t.roles:["personnel"]).map(r=>{const m={super_admin:"Süper Yönetici",admin:"Yönetici",team_leader:"Ekip Lideri",personnel:"Personel",viewer:"Görüntüleyici"};return e.jsx(S,{variant:"secondary",className:"text-xs sm:text-sm px-3 py-1",children:m[r]||r},r)})})]})]})})}),t&&e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 sm:gap-6",children:[e.jsx(o,{className:"hover:shadow-lg transition-all duration-300 border-l-4 border-l-primary",children:e.jsx(p,{className:"p-4 sm:p-6",children:e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"h-10 w-10 rounded-lg bg-primary/10 flex items-center justify-center",children:e.jsx(he,{className:"h-5 w-5 text-primary"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-xs text-muted-foreground uppercase tracking-wide",children:"Ad Soyad"}),e.jsx("p",{className:"text-base sm:text-lg font-semibold truncate",children:t.fullName||"-"})]})]})})}),e.jsx(o,{className:"hover:shadow-lg transition-all duration-300 border-l-4 border-l-blue-500",children:e.jsx(p,{className:"p-4 sm:p-6",children:e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"h-10 w-10 rounded-lg bg-blue-500/10 flex items-center justify-center",children:e.jsx(pe,{className:"h-5 w-5 text-blue-500"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-xs text-muted-foreground uppercase tracking-wide",children:"E-posta"}),e.jsx("p",{className:"text-base sm:text-lg font-semibold truncate break-all",children:t.email||"-"})]})]})})}),e.jsx(o,{className:"hover:shadow-lg transition-all duration-300 border-l-4 border-l-purple-500",children:e.jsx(p,{className:"p-4 sm:p-6",children:e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"h-10 w-10 rounded-lg bg-purple-500/10 flex items-center justify-center",children:e.jsx(ge,{className:"h-5 w-5 text-purple-500"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-xs text-muted-foreground uppercase tracking-wide",children:"Rol"}),e.jsx("div",{className:"flex flex-wrap gap-1.5 mt-1",children:((g=t.roles)!=null&&g.length?t.roles:["personnel"]).slice(0,2).map(r=>{const m={super_admin:"Süper Yönetici",admin:"Yönetici",team_leader:"Ekip Lideri",personnel:"Personel",viewer:"Görüntüleyici"};return e.jsx(S,{variant:"secondary",className:"text-xs",children:m[r]||r},r)})})]})]})})}),e.jsx(o,{className:"hover:shadow-lg transition-all duration-300 border-l-4 border-l-emerald-500",children:e.jsx(p,{className:"p-4 sm:p-6",children:e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"h-10 w-10 rounded-lg bg-emerald-500/10 flex items-center justify-center",children:e.jsx(E,{className:"h-5 w-5 text-emerald-500"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-xs text-muted-foreground uppercase tracking-wide",children:"Son Giriş"}),e.jsx("p",{className:"text-base sm:text-lg font-semibold",children:t.lastLoginAt?Ne((t.lastLoginAt instanceof ce||t.lastLoginAt&&typeof t.lastLoginAt=="object"&&"toDate"in t.lastLoginAt,t.lastLoginAt)):"Hiç giriş yapmamış"})]})]})})})]}),e.jsx(we,{})]})})};export{_e as default};
