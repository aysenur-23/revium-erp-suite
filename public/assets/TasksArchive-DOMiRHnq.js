import{j as e,V as T,B as v,k as le,r as l,ai as ne,g as de,b as m,l as ce,C as oe,c as me,m as xe,n as G,e as he,aj as F,X as H}from"./index-Xd90qdO9.js";import{M as J,I as P,z as ue,F as V,B as pe,A as fe,E as ge,G as ve,H as K,w as je}from"./MainLayout-DW7UjMSA.js";import{A as Ne,a as we}from"./avatar-KtUT5CWN.js";import{S as be}from"./search-input-QX7HVhJf.js";import{b as Se,D as ye,B as ke}from"./taskService-CQO0i9v5.js";import{L as Ae}from"./loading-state-CyTUOPV3.js";import{T as Te}from"./TaskDetailModal-DYo7pzLX.js";import{A as Ce,a as De,b as Le,c as Me,d as Ue,e as Ee,f as Oe,g as _e}from"./alert-dialog-BVp-ELLM.js";import{E as ze}from"./ellipsis-vertical-gVlTlFy-.js";import{T as Be}from"./trash-2-DlZRXDqX.js";import{f as Ie}from"./format-DuC-NjES.js";import"./permissions-D79DzJt5.js";import"./rolePermissionsService-CoZ8Qmsy.js";import"./OrderDetailModal-DehNQxg3.js";import"./square-pen-zeHrcQ7c.js";import"./save-Bgz0wbo5.js";import"./truck-CIL1YvLr.js";import"./circle-dot-CCfpRgG9.js";import"./list-checks-CkcaKLuC.js";import"./progress-DSBhhNxd.js";import"./UserMultiSelect-KlPlOKAA.js";import"./popover-BA39Kv9C.js";import"./plus-D9uLCipi.js";import"./message-square-BAQ_w3zD.js";import"./user-plus-DWuSLDZe.js";import"./tag-EYbV-h0Y.js";import"./calendar-days-DIIfLF_e.js";import"./send-DtcYVw6S.js";const R=({icon:t,title:u,description:o,action:i,className:p,variant:x="default"})=>x==="card"?e.jsx("div",{className:T("text-center py-12 bg-muted/30 rounded-lg border border-dashed",p),children:e.jsxs("div",{className:"flex flex-col items-center gap-3",children:[t&&e.jsx("div",{className:"rounded-full bg-muted p-4",children:e.jsx(t,{className:"h-12 w-12 text-muted-foreground/50"})}),e.jsx("p",{className:"text-muted-foreground font-medium text-base",children:u}),o&&e.jsx("p",{className:"text-sm text-muted-foreground/70 max-w-md",children:o}),i&&e.jsx(v,{onClick:i.onClick,variant:"outline",size:"sm",className:"mt-2",children:i.label})]})}):x==="minimal"?e.jsxs("div",{className:T("flex flex-col items-center justify-center py-8 px-4",p),children:[t&&e.jsx(t,{className:"h-10 w-10 text-muted-foreground/50 mb-3"}),e.jsx("p",{className:"text-sm text-muted-foreground font-medium",children:u}),o&&e.jsx("p",{className:"text-xs text-muted-foreground/70 mt-1 text-center max-w-sm",children:o}),i&&e.jsx(v,{onClick:i.onClick,variant:"outline",size:"sm",className:"mt-3",children:i.label})]}):e.jsxs("div",{className:T("flex flex-col items-center justify-center py-12 px-4",p),children:[t&&e.jsx("div",{className:"mb-4 rounded-full bg-muted p-4",children:e.jsx(t,{className:"h-8 w-8 text-muted-foreground"})}),e.jsx("h3",{className:"text-lg font-semibold text-foreground mb-2",children:u}),o&&e.jsx("p",{className:"text-sm text-muted-foreground text-center max-w-md mb-4",children:o}),i&&e.jsx(v,{onClick:i.onClick,variant:"outline",size:"sm",children:i.label})]}),C="taskBoardState_v1",us=()=>{const{user:t,isAdmin:u,isTeamLeader:o}=le(),[i,p]=l.useState([]),[x,q]=l.useState([]),[X,D]=l.useState(!0),[n,Y]=l.useState(""),[Q,W]=l.useState("tasks"),[Ge,Z]=l.useState({}),[j,L]=l.useState(null),[$,y]=l.useState(!1),[M,U]=l.useState(null);if(!u&&!o)return e.jsx(ne,{to:"/",replace:!0});l.useEffect(()=>{f()},[]);const f=async()=>{var s;if(t){D(!0);try{const d=(await Se()).filter(r=>r.isArchived===!0),h=await de(),c={};h.forEach(r=>{c[r.id]=r.fullName||r.displayName||r.email}),Z(c);const ie=d.map(r=>{var g,N,w,b,E,O,S,_,z,B;return{id:r.id,title:r.title,description:r.description||null,status:r.status,priority:r.priority||3,due_date:((w=(N=(g=r.dueDate)==null?void 0:g.toDate)==null?void 0:N.call(g))==null?void 0:w.toISOString())||null,created_at:((O=(E=(b=r.createdAt)==null?void 0:b.toDate)==null?void 0:E.call(b))==null?void 0:O.toISOString())||new Date().toISOString(),updated_at:((z=(_=(S=r.updatedAt)==null?void 0:S.toDate)==null?void 0:_.call(S))==null?void 0:z.toISOString())||new Date().toISOString(),project_id:r.projectId||null,is_archived:r.isArchived,assignedUsers:((B=r.assignedUsers)==null?void 0:B.map(I=>({id:I,full_name:c[I]||"Bilinmeyen"})))||[]}});p(ie);try{const r=localStorage.getItem(C);if(r){const N=((s=JSON.parse(r).columns)==null?void 0:s.filter(w=>w.isArchived===!0))||[];q(N)}}catch(r){console.error("Error loading archived lists:",r)}}catch(a){console.error("Fetch archive data error:",a),m.error(a.message||"Arşiv verileri yüklenirken hata oluştu")}finally{D(!1)}}},ee=async s=>{if(t!=null&&t.id)try{await ye(s,t.id),m.success("Görev arşivden çıkarıldı"),await f()}catch(a){console.error("Unarchive task error:",a),m.error(a.message||"Görev arşivden çıkarılamadı")}},se=async()=>{if(!(!M||!(t!=null&&t.id)))try{await ke(M,t.id),m.success("Görev silindi"),y(!1),U(null),await f()}catch(s){console.error("Delete task error:",s),m.error(s.message||"Görev silinemedi")}},ae=(s,a)=>{L(s)},re=()=>{L(null)},te=s=>{try{const a=localStorage.getItem(C);if(a){const d=JSON.parse(a),h=d.columns.map(c=>c.id===s?{...c,isArchived:!1}:c);d.columns=h,localStorage.setItem(C,JSON.stringify(d)),m.success("Liste arşivden çıkarıldı"),f()}}catch(a){console.error("Error unarchiving list:",a),m.error("Liste arşivden çıkarılamadı")}},k=l.useMemo(()=>{if(!n)return i;const s=n.toLowerCase();return i.filter(a=>{var d,h;return a.title.toLowerCase().includes(s)||((d=a.description)==null?void 0:d.toLowerCase().includes(s))||((h=a.assignedUsers)==null?void 0:h.some(c=>c.full_name.toLowerCase().includes(s)))})},[i,n]),A=l.useMemo(()=>{if(!n)return x;const s=n.toLowerCase();return x.filter(a=>{var d;return(d=a.title)==null?void 0:d.toLowerCase().includes(s)})},[x,n]);return X?e.jsx(J,{children:e.jsx(Ae,{message:"Arşiv yükleniyor..."})}):e.jsx(J,{children:e.jsxs("div",{className:"space-y-4 sm:space-y-6",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-xl sm:text-2xl md:text-3xl font-bold text-foreground flex items-center gap-2",children:[e.jsx(P,{className:"h-6 w-6 sm:h-7 sm:w-7"}),"Arşiv"]}),e.jsx("p",{className:"text-muted-foreground mt-1 text-xs sm:text-sm",children:"Arşivlenmiş görevler ve listeler"})]}),e.jsx(ce,{value:Q,onValueChange:s=>W(s),className:"w-full",children:e.jsxs(oe,{children:[e.jsx(me,{children:e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4",children:[e.jsx("div",{className:"flex-1 w-full sm:w-auto",children:e.jsx(be,{placeholder:"Arşivde ara...",value:n,onChange:s=>Y(s.target.value),className:"w-full"})}),e.jsxs(xe,{className:"w-full sm:w-auto",children:[e.jsxs(G,{value:"tasks",className:"gap-1 sm:gap-2 flex-1 sm:flex-initial min-h-[44px] sm:min-h-0",children:[e.jsx(ue,{className:"h-4 w-4 flex-shrink-0"}),e.jsx("span",{className:"hidden sm:inline",children:"Görevler"}),e.jsx("span",{className:"sm:hidden",children:"Görevler"}),e.jsxs("span",{className:"ml-1",children:["(",k.length,")"]})]}),e.jsxs(G,{value:"lists",className:"gap-1 sm:gap-2 flex-1 sm:flex-initial min-h-[44px] sm:min-h-0",children:[e.jsx(V,{className:"h-4 w-4 flex-shrink-0"}),e.jsx("span",{className:"hidden sm:inline",children:"Listeler"}),e.jsx("span",{className:"sm:hidden",children:"Listeler"}),e.jsxs("span",{className:"ml-1",children:["(",A.length,")"]})]})]})]})}),e.jsxs(he,{children:[e.jsx(F,{value:"tasks",className:"mt-0",children:k.length===0?e.jsx(R,{icon:P,title:n?"Arama sonucu bulunamadı":"Henüz arşivlenmiş görev yok",description:n?"Farklı bir arama terimi deneyin":"Arşivlenmiş görevler burada görünecek",variant:"card"}):e.jsx("div",{className:"space-y-3",children:k.map(s=>e.jsx("div",{className:"p-3 sm:p-4 rounded-lg border bg-card hover:shadow-md transition-shadow cursor-pointer",onClick:()=>ae(s.id,s.status),children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-start sm:justify-between gap-3 sm:gap-4",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-start gap-2 sm:gap-3 mb-2",children:[e.jsx("h3",{className:"font-semibold text-sm sm:text-base flex-1 break-words",children:s.title}),e.jsxs(pe,{variant:"outline",className:"flex-shrink-0 self-start sm:self-auto",children:[s.status==="pending"&&"Beklemede",s.status==="in_progress"&&"Devam Ediyor",s.status==="completed"&&"Tamamlandı",s.status==="cancelled"&&"İptal"]})]}),s.description&&e.jsx("p",{className:"text-xs sm:text-sm text-muted-foreground mb-3 line-clamp-2 break-words",children:s.description}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:flex-wrap sm:items-center gap-2 sm:gap-4 text-xs text-muted-foreground",children:[s.due_date&&e.jsx("span",{className:"whitespace-nowrap",children:Ie(new Date(s.due_date),"d MMMM yyyy",{locale:je})}),s.assignedUsers&&s.assignedUsers.length>0&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"hidden sm:inline",children:"Atananlar:"}),e.jsxs("div",{className:"flex -space-x-2",children:[s.assignedUsers.slice(0,3).map(a=>e.jsx(Ne,{className:"h-6 w-6 border-2 border-background",children:e.jsx(we,{className:"text-xs",children:a.full_name.charAt(0).toUpperCase()})},a.id)),s.assignedUsers.length>3&&e.jsxs("div",{className:"h-6 w-6 rounded-full border-2 border-background bg-muted flex items-center justify-center text-xs",children:["+",s.assignedUsers.length-3]})]})]})]})]}),e.jsx("div",{className:"flex items-center gap-2 flex-shrink-0",onClick:a=>a.stopPropagation(),children:e.jsxs(fe,{children:[e.jsx(ge,{asChild:!0,children:e.jsx(v,{variant:"ghost",size:"icon",className:"h-8 w-8 opacity-70 hover:opacity-100",children:e.jsx(ze,{className:"h-4 w-4"})})}),e.jsxs(ve,{align:"end",children:[e.jsxs(K,{onClick:a=>{a.stopPropagation(),ee(s.id)},className:"cursor-pointer",children:[e.jsx(H,{className:"h-4 w-4 mr-2"}),"Arşivden Çıkar"]}),e.jsxs(K,{onClick:a=>{a.stopPropagation(),U(s.id),y(!0)},className:"cursor-pointer text-destructive focus:text-destructive",children:[e.jsx(Be,{className:"h-4 w-4 mr-2"}),"Sil"]})]})]})})]})},s.id))})}),e.jsx(F,{value:"lists",className:"mt-0",children:A.length===0?e.jsx(R,{icon:V,title:n?"Arama sonucu bulunamadı":"Henüz arşivlenmiş liste yok",description:n?"Farklı bir arama terimi deneyin":"Arşivlenmiş listeler burada görünecek",variant:"card"}):e.jsx("div",{className:"space-y-3",children:A.map(s=>{var a;return e.jsx("div",{className:"p-3 sm:p-4 rounded-lg border bg-card hover:shadow-md transition-shadow",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 sm:gap-4",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-semibold text-sm sm:text-base mb-1 break-words",children:s.title}),e.jsxs("p",{className:"text-xs sm:text-sm text-muted-foreground",children:[((a=s.taskIds)==null?void 0:a.length)||0," görev"]})]}),e.jsxs(v,{variant:"outline",size:"sm",onClick:()=>te(s.id),className:"flex-shrink-0 w-full sm:w-auto min-h-[44px] sm:min-h-0",children:[e.jsx(H,{className:"h-4 w-4 mr-2"}),e.jsx("span",{className:"hidden sm:inline",children:"Arşivden Çıkar"}),e.jsx("span",{className:"sm:hidden",children:"Çıkar"})]})]})},s.id)})})})]})]})}),j&&(()=>{const s=i.find(a=>a.id===j);return e.jsx(Te,{taskId:j,open:!!j,onOpenChange:a=>{a||re()},onUpdate:()=>{f()},initialStatus:(s==null?void 0:s.status)||"pending"})})(),e.jsx(Ce,{open:$,onOpenChange:y,children:e.jsxs(De,{children:[e.jsxs(Le,{children:[e.jsx(Me,{children:"Görevi Sil"}),e.jsx(Ue,{children:"Bu görevi silmek istediğinize emin misiniz? Bu işlem geri alınamaz ve görev kalıcı olarak silinecektir."})]}),e.jsxs(Ee,{children:[e.jsx(Oe,{children:"İptal"}),e.jsx(_e,{onClick:se,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Sil"})]})]})})]})})};export{us as default};
