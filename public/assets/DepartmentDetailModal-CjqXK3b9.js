var Z=(j,E,p)=>new Promise((x,R)=>{var C=w=>{try{h(p.next(w))}catch($){R($)}},_=w=>{try{h(p.throw(w))}catch($){R($)}},h=w=>w.done?x(w.value):Promise.resolve(w.value).then(C,_);h((p=p.apply(j,E)).next())});import{u as Be,ab as Oe,a3 as fe,a as ge,j as e,C as S,b as D,S as de,c as ce,d as me,e as oe,f as B,B as je,k as Re,r as Te,ac as Pe,p as ee,q as se}from"./index-BQmY0BmM.js";import{r as u,m as be,W as _e,Q as Ne,a0 as He,a2 as Ue,J as ze,U as ye,h as Fe,f as ve,q as Ge,N as Ie}from"./lucide-react-CAeuRJQk.js";import{B as k,t as O,w as Ve,l as Ye,D as Ke,a as Je,b as qe,c as Qe,e as ke}from"./MainLayout-Dv9j77B5.js";import{S as We}from"./search-input-DCf0xYml.js";import{f as L}from"./format-CN3feEER.js";import{P as Xe}from"./progress-DCzQFBA2.js";import{S as ue}from"./skeleton-jcdN6-ik.js";import{T as Ze,a as es,b as we,c as G,d as ss,e as I}from"./table-zhTdMUM_.js";import{b as ts}from"./taskService-CI62TrOj.js";const V={CREATE:{color:"bg-green-500",label:"Oluşturma",verb:"oluşturdu",short:"Yeni kayıt"},UPDATE:{color:"bg-blue-500",label:"Güncelleme",verb:"güncelledi",short:"Güncelleme"},DELETE:{color:"bg-red-500",label:"Silme",verb:"sildi",short:"Silme"}},Y={tasks:"Görevler",user_roles:"Kullanıcı Rolleri",departments:"Departmanlar",production_orders:"Üretim Siparişleri",production_processes:"Üretim Süreçleri",profiles:"Profiller",notifications:"Bildirimler",shared_files:"Paylaşılan Dosyalar",task_assignments:"Görev Atamaları",role_permissions:"Rol Yetkileri",orders:"Siparişler",customers:"Müşteriler",products:"Ürünler",projects:"Projeler",reports:"Raporlar",warranty:"Garanti"},xe={tasks:"Görevler",orders:"Siparişler",customers:"Müşteriler",products:"Ürünler",production_orders:"Üretim Siparişleri",user_roles:"Kullanıcı Yönetimi",departments:"Departmanlar",profiles:"Profil Ayarları",notifications:"Bildirimler",shared_files:"Paylaşılan Dosyalar",task_assignments:"Görev Atamaları",role_permissions:"Rol Yetkileri",projects:"Projeler",reports:"Raporlar",warranty:"Satış Sonrası Takip"},K={title:"Başlık",description:"Açıklama",status:"Durum",priority:"Öncelik",dueDate:"Bitiş Tarihi",assignedTo:"Atanan",createdBy:"Oluşturan",updatedAt:"Güncellenme Tarihi",customerId:"Müşteri",customerName:"Müşteri Adı",totalAmount:"Toplam Tutar",subtotal:"Ara Toplam",discountTotal:"İndirim",taxAmount:"KDV",grandTotal:"Genel Toplam",orderNumber:"Sipariş Numarası",deliveryDate:"Teslimat Tarihi",name:"İsim",email:"E-posta",phone:"Telefon",company:"Şirket",address:"Adres",role:"Rol",fullName:"Ad Soyad",department:"Departman",isActive:"Aktif",isArchived:"Arşivlendi",approvalStatus:"Onay Durumu",rejectionReason:"Red Nedeni",approvedBy:"Onaylayan",rejectedBy:"Reddeden",approvedAt:"Onay Tarihi",rejectedAt:"Red Tarihi",isInPool:"Görev Havuzunda",poolRequests:"Havuz İstekleri",reportType:"Rapor Tipi",startDate:"Başlangıç Tarihi",endDate:"Bitiş Tarihi"},te={pending:"Beklemede",in_progress:"Devam Ediyor",completed:"Tamamlandı",cancelled:"İptal Edildi",confirmed:"Onaylandı",shipped:"Kargoda",delivered:"Teslim Edildi",on_hold:"Beklemede",draft:"Taslak",approved:"Onaylandı",rejected:"Reddedildi",none:"Yok",active:"Aktif",inactive:"Pasif",true:"Evet",false:"Hayır"},xs=({mode:j="admin",userId:E})=>{const{user:p,isAdmin:x,isTeamLeader:R}=Be(),[C,_]=u.useState([]),[h,w]=u.useState(!0),[$,J]=u.useState(""),[N,q]=u.useState("all"),[A,T]=u.useState("all"),[re,ae]=u.useState(new Set),[l,M]=u.useState(100),[ne,Q]=u.useState(!1),[v,H]=u.useState(null),[g,U]=u.useState([]),[y,z]=u.useState("all"),[ie,W]=u.useState(new Set),[Se,De]=u.useState([]),[Ee,$e]=u.useState([]);u.useEffect(()=>{Z(void 0,null,function*(){if(p!=null&&p.id)try{const[t,i,r,a]=yield Promise.all([Re(),Te(),Ve(),Ye()]);if(U(t),De(r),$e(a),R&&!x){const n=t.filter(d=>d.managerId===p.id).map(d=>d.id),f=new Set(i.filter(d=>!!(d.approvedTeams&&d.approvedTeams.some(c=>n.includes(c))||d.pendingTeams&&d.pendingTeams.some(c=>n.includes(c))||d.departmentId&&n.includes(d.departmentId))).map(d=>d.id));W(f),z("all")}else if(x&&y!=="all")if(t.find(n=>n.id===y)){const n=new Set(i.filter(f=>!!(f.approvedTeams&&f.approvedTeams.includes(y)||f.pendingTeams&&f.pendingTeams.includes(y)||f.departmentId===y)).map(f=>f.id));W(n)}else W(new Set);else W(new Set)}catch(t){console.error("Error loading departments:",t)}})},[p,x,R,y]);const he=u.useCallback(()=>Z(void 0,null,function*(){w(!0);try{let s=[],t=null;if(j==="team"&&E){const i=yield Oe(E);s=i.logs,t=i.teamInfo,H(t)}else j==="personal"&&E?(s=yield fe({userId:E}),H(null)):(s=yield fe({limit:l,action:N!=="all"?N:void 0,tableName:A!=="all"?A:void 0}),ie.size>0&&(s=s.filter(i=>ie.has(i.userId))),H(null),Q(s.length===l));_(s)}catch(s){const t=s instanceof Error?s.message:"Bilinmeyen hata";ge.error("Loglar yüklenemedi: "+t)}finally{w(!1)}}),[j,E,N,A,l,ie]),Ae=u.useCallback(()=>{M(s=>s+100)},[]);u.useEffect(()=>{M(100)},[N,A,j,E]),u.useEffect(()=>{he()},[he]);const pe=s=>{ae(t=>{const i=new Set(t);return i.has(s)?i.delete(s):i.add(s),i})},Ce=()=>{const s=["Tarih","Kullanıcı","İşlem","Tablo","Detaylar"],t=F.map(m=>[L(m.createdAt.toDate(),"dd.MM.yyyy HH:mm",{locale:O}),m.userName||"Sistem",m.action,Y[m.tableName]||m.tableName,m.action==="CREATE"?"Yeni kayıt":m.action==="UPDATE"?"Güncelleme":"Silme"]),i=[s.join(","),...t.map(m=>m.map(n=>`"${n}"`).join(","))].join(`
`),r=new Blob(["\uFEFF"+i],{type:"text/csv;charset=utf-8;"}),a=document.createElement("a");a.href=URL.createObjectURL(r),a.download=`audit_logs_${L(new Date,"yyyyMMdd_HHmmss")}.csv`,a.click(),ge.success("Log'lar CSV olarak indirildi")},le=(s,t)=>!s||!t?[]:Object.keys(t).filter(i=>{const r=s[i],a=t[i];return JSON.stringify(r)!==JSON.stringify(a)}),P=(s,t)=>s==null?"Yok":typeof s=="boolean"?s?"Evet":"Hayır":s instanceof Date?L(s,"dd.MM.yyyy HH:mm",{locale:O}):typeof s=="object"&&s.toDate?L(s.toDate(),"dd.MM.yyyy HH:mm",{locale:O}):typeof s=="object"?Array.isArray(s)?s.length>0?`${s.length} öğe`:"Boş":JSON.stringify(s):t==="status"&&te[String(s)]||t==="approvalStatus"&&te[String(s)]?te[String(s)]:String(s),X=(s,t)=>{if(!s)return null;if(t==="orders"&&s.orderNumber)return s.orderNumber;if(t==="tasks"&&s.title)return s.title;if(t==="customers"&&s.name||t==="products"&&s.name||t==="projects"&&s.name)return s.name;if(t==="reports"&&s.title)return s.title;if(t==="task_assignments"&&s.taskTitle)return s.taskTitle;if(t==="warranty"){const i=s.customerId,r=s.productId,a=i?Se.find(d=>d.id===i):null,m=r?Ee.find(d=>d.id===r):null,n=(a==null?void 0:a.name)||"Bilinmeyen Müşteri",f=(m==null?void 0:m.name)||"Bilinmeyen Ürün";return`${n} - ${f}`}return s.name?s.name:s.title?s.title:s.id?String(s.id):null},Le=s=>{const t=s.userName||(s.userEmail?s.userEmail.split("@")[0]:null)||"Sistem",i=xe[s.tableName]||Y[s.tableName]||s.tableName,r=V[s.action],a=X(s.newData||s.oldData,s.tableName)||X(s.oldData,s.tableName),m=(r==null?void 0:r.verb)||"işlem yaptı";let n=`${t}, ${i} bölümünde ${(r==null?void 0:r.short.toLowerCase())||"bir işlem"} yaptı.`;if(s.action==="UPDATE"&&s.oldData&&s.newData){le(s.oldData,s.newData);const c=Me(s.oldData,s.newData,s.tableName,a);if(a)if(c.length>0){const o=c[0];if(n=`${t}, "${a}" ${o}.`,c.length>1){const b=c.slice(1).join(", ");n+=` Ayrıca ${b}.`}}else n=`${t}, "${a}" kaydını ${m}.`;else c.length>0?(n=`${t}, ${i} bölümünde ${c[0]}.`,c.length>1&&(n+=` Ayrıca ${c.slice(1).join(", ")}.`)):n=`${t}, ${i} bölümünde bir kaydı ${m}.`}else a&&(n=`${t}, ${i} bölümünde "${a}" kaydını ${m}.`);const f=L(s.createdAt.toDate(),"dd MMMM yyyy, HH:mm",{locale:O}),d=[s.userEmail?`E-posta: ${s.userEmail}`:null,a?`İsim: ${a}`:null].filter(Boolean);return{description:n,timestamp:f,metaLine:d.join(" • ")}},Me=(s,t,i,r)=>{if(!s||!t)return[];const a=[];return le(s,t).forEach(n=>{const f=K[n]||n,d=P(s[n],n),c=P(t[n],n);if(n==="status"&&i==="tasks"){const o=r||s.title||t.title||"görev";a.push(`"${o}" görevinin durumunu "${d}"'den "${c}"'e değiştirdi`)}else if(n==="status"&&i==="orders"){const o=r||s.orderNumber||t.orderNumber||"sipariş";a.push(`"${o}" siparişinin durumunu "${d}"'den "${c}"'e değiştirdi`)}else if(n==="status"&&i==="production_orders"){const o=r||s.orderNumber||t.orderNumber||"üretim siparişi";a.push(`"${o}" üretim siparişinin durumunu "${d}"'den "${c}"'e değiştirdi`)}else if(n==="approvalStatus"){const o=r||s.title||t.title||"",b=o?`"${o}" görevinin `:"";c==="Onaylandı"?a.push(`${b}onay durumunu "Beklemede"den "Onaylandı"ya güncelledi`):c==="Reddedildi"?a.push(`${b}onay durumunu "Beklemede"den "Reddedildi"ye güncelledi`):a.push(`${b}onay durumunu "${d}"'den "${c}"'e değiştirdi`)}else if(n==="rejectionReason"){const o=r||s.title||t.title||"",b=o?`"${o}" görevi için `:"";a.push(`${b}red nedeni ekledi: "${c}"`)}else if(n==="title"&&i==="tasks")a.push(`görev başlığını "${d}"'den "${c}"'e değiştirdi`);else if(n==="description"&&i==="tasks"){const o=r||s.title||t.title||"",b=o?`"${o}" `:"";a.push(`${b}görev açıklamasını güncelledi`)}else if(n==="priority"&&i==="tasks"){const o=r||s.title||t.title||"",b=o?`"${o}" görevinin `:"";a.push(`${b}önceliği "${d}"'den "${c}"'e değiştirdi`)}else if(n==="dueDate"&&i==="tasks"){const o=r||s.title||t.title||"",b=o?`"${o}" görevinin `:"";a.push(`${b}bitiş tarihini "${d}"'den "${c}"'e değiştirdi`)}else if(n==="role")a.push(`rolünü "${d}"'den "${c}"'e değiştirdi`);else if(n==="assignedTo"||n==="assignedUsers"){const o=r||s.title||t.title||"",b=i==="tasks"&&o?`"${o}" görevinin `:"";a.push(`${b}atanan kişiyi "${d}"'den "${c}"'e değiştirdi`)}else if(n==="totalAmount"||n==="grandTotal"||n==="subtotal"){const o=typeof d=="string"?d:`₺${d}`,b=typeof c=="string"?c:`₺${c}`;a.push(`${f} ${o}'den ${b}'e güncelledi`)}else n==="name"&&(i==="customers"||i==="products"||i==="projects")?a.push(`${i==="customers"?"müşteri":i==="products"?"ürün":"proje"} adını "${d}"'den "${c}"'e değiştirdi`):n==="orderNumber"&&i==="orders"?a.push(`sipariş numarasını "${d}"'den "${c}"'e değiştirdi`):a.push(`${f} "${d}"'den "${c}"'e değiştirdi`)}),a},F=u.useMemo(()=>{const s=$.trim().toLowerCase();return C.filter(t=>{var m,n,f,d;const i=s===""||t.action.toLowerCase().includes(s)||t.tableName.toLowerCase().includes(s)||((m=t.userName)==null?void 0:m.toLowerCase().includes(s))||((n=t.userEmail)==null?void 0:n.toLowerCase().includes(s))||JSON.stringify((f=t.oldData)!=null?f:{}).toLowerCase().includes(s)||JSON.stringify((d=t.newData)!=null?d:{}).toLowerCase().includes(s),r=N==="all"||t.action===N,a=A==="all"||t.tableName===A;return i&&r&&a})},[C,$,N,A]);return h?e.jsx("div",{className:"flex items-center justify-center p-8",children:e.jsx(be,{className:"h-8 w-8 animate-spin text-primary"})}):e.jsxs("div",{className:"space-y-6",children:[x&&j==="admin"&&e.jsx(S,{children:e.jsx(D,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("label",{className:"text-sm font-medium",children:"Ekip Seç:"}),e.jsxs(de,{value:y,onValueChange:z,children:[e.jsx(ce,{className:"w-full sm:w-[250px]",children:e.jsx(me,{placeholder:"Ekip seçiniz"})}),e.jsxs(oe,{children:[e.jsx(B,{value:"all",children:"Tüm Ekipler"}),g.map(s=>e.jsx(B,{value:s.id,children:s.name},s.id))]})]})]})})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl sm:text-2xl font-bold",children:j==="team"?"Ekip Logları":j==="personal"?"Kişisel Loglar":"Sistem Logları"}),e.jsx("p",{className:"text-sm sm:text-base text-muted-foreground mt-1 sm:mt-2",children:j==="team"?"Yönettiğiniz ekiplerdeki üyelerin ve sizin işlem geçmişiniz":j==="personal"?"Kendi işlem geçmişiniz":"Sistemdeki tüm kullanıcıların tüm işlemlerinin detaylı kaydı"}),j==="team"&&v&&!x&&e.jsx(S,{className:"bg-gradient-to-br from-blue-50/50 to-transparent border-blue-200",children:e.jsx(D,{className:"p-4",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs(k,{variant:"outline",className:"text-xs",children:[v.managedTeams.length," Ekip Yönetiliyor"]}),e.jsxs(k,{variant:"outline",className:"text-xs",children:[v.teamMembers.length," Ekip Üyesi"]}),e.jsxs(k,{variant:"outline",className:"text-xs",children:[C.length," Log Kaydı"]})]}),v.managedTeams.length>0&&e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"font-medium text-foreground",children:"Yönettiğiniz Ekipler:"})," ",e.jsx("span",{className:"text-muted-foreground",children:v.managedTeams.map(s=>s.name).join(", ")})]}),v.teamMembers.length>0&&e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"font-medium text-foreground",children:"Ekip Üyeleri:"})," ",e.jsx("span",{className:"text-muted-foreground",children:v.teamMembers.map(s=>s.name).join(", ")})]}),v.teamMembers.length===0&&v.managedTeams.length>0&&e.jsxs("div",{className:"text-sm text-yellow-700 bg-yellow-100 p-3 rounded-lg border border-yellow-200",children:[e.jsx("span",{className:"font-medium",children:"⚠️ Bilgi:"})," Yönettiğiniz ekiplerde henüz üye bulunmuyor. Üyeler eklendiğinde ve işlem yaptığında logları burada görebilirsiniz."]}),v.managedTeams.length===0&&e.jsxs("div",{className:"text-sm text-blue-700 bg-blue-100 p-3 rounded-lg border border-blue-200",children:[e.jsx("span",{className:"font-medium",children:"ℹ️ Bilgi:"})," Henüz yönettiğiniz bir ekip bulunmuyor. Ekip lideri olarak atandığınızda, o ekipteki üyelerin loglarını burada görebilirsiniz."]})]})})})]}),e.jsx(S,{children:e.jsxs(D,{className:"pt-4 sm:pt-6 space-y-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3 sm:gap-4 mb-4",children:[e.jsxs("div",{className:"text-xs sm:text-sm text-muted-foreground",children:[F.length," kayıt bulundu"]}),e.jsxs(je,{onClick:Ce,variant:"outline",size:"sm",className:"w-full sm:w-auto min-h-[44px] sm:min-h-0",children:[e.jsx(_e,{className:"h-4 w-4 sm:mr-2"}),e.jsx("span",{className:"text-xs sm:text-sm",children:"CSV İndir"})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 sm:gap-4",children:[e.jsx(We,{placeholder:"İçerikte ara...",value:$,onChange:s=>J(s.target.value),containerClassName:"flex-1"}),e.jsxs(de,{value:N,onValueChange:q,children:[e.jsx(ce,{className:"w-full sm:w-[180px] min-h-[44px] sm:min-h-0",children:e.jsx(me,{})}),e.jsxs(oe,{children:[e.jsx(B,{value:"all",children:"Tüm İşlemler"}),e.jsx(B,{value:"CREATE",children:"Oluşturma"}),e.jsx(B,{value:"UPDATE",children:"Güncelleme"}),e.jsx(B,{value:"DELETE",children:"Silme"})]})]}),e.jsxs(de,{value:A,onValueChange:T,children:[e.jsx(ce,{className:"w-full sm:w-[180px] min-h-[44px] sm:min-h-0",children:e.jsx(me,{})}),e.jsxs(oe,{children:[e.jsx(B,{value:"all",children:"Tüm Tablolar"}),Object.entries(Y).map(([s,t])=>e.jsx(B,{value:s,children:t},s))]})]})]}),e.jsxs("div",{className:"space-y-4",children:[F.length===0?e.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[e.jsx(Ne,{className:"h-12 w-12 mx-auto mb-3 opacity-20"}),e.jsx("p",{children:"Hiç log bulunamadı"})]}):F.map(s=>{const t=re.has(s.id),i=s.action==="UPDATE"?le(s.oldData,s.newData):[];return e.jsx(S,{className:"hover:shadow-md transition-shadow",children:e.jsxs(D,{className:"p-3 sm:p-4",children:[e.jsx("div",{className:"cursor-pointer select-none",onClick:r=>{r.stopPropagation(),pe(s.id)},onKeyDown:r=>{(r.key==="Enter"||r.key===" ")&&(r.preventDefault(),r.stopPropagation(),pe(s.id))},role:"button",tabIndex:0,"aria-expanded":t,"aria-label":t?"Log detaylarını kapat":"Log detaylarını aç",children:(()=>{const r=Le(s);return e.jsxs("div",{className:"flex items-start justify-between gap-2 sm:gap-4",children:[e.jsxs("div",{className:"flex-1 space-y-2 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 flex-wrap",children:[e.jsx(k,{className:`${V[s.action].color} text-xs sm:text-sm`,onClick:a=>a.stopPropagation(),children:V[s.action].label}),e.jsx(k,{variant:"outline",className:"text-xs",onClick:a=>a.stopPropagation(),children:xe[s.tableName]||Y[s.tableName]||s.tableName}),e.jsx("span",{className:"text-xs text-muted-foreground whitespace-nowrap",children:r.timestamp})]}),e.jsx("p",{className:"text-xs sm:text-sm text-foreground leading-relaxed font-medium",children:r.description}),r.metaLine&&e.jsx("p",{className:"text-xs text-muted-foreground",children:r.metaLine}),s.action==="UPDATE"&&i.length>0&&e.jsxs("div",{className:"flex flex-wrap gap-1 mt-2",onClick:a=>a.stopPropagation(),children:[i.slice(0,5).map(a=>e.jsx(k,{variant:"secondary",className:"text-xs pointer-events-none",children:K[a]||a},a)),i.length>5&&e.jsxs(k,{variant:"secondary",className:"text-xs pointer-events-none",children:["+",i.length-5," daha"]})]})]}),e.jsx("div",{className:"flex-shrink-0",children:t?e.jsx(He,{className:"h-5 w-5 text-muted-foreground"}):e.jsx(Ue,{className:"h-5 w-5 text-muted-foreground"})})]})})()}),t&&e.jsxs("div",{className:"mt-4 pt-4 border-t space-y-4",children:[e.jsxs("div",{className:"bg-gradient-to-r from-blue-50/50 to-purple-50/50 dark:from-blue-950/20 dark:to-purple-950/20 rounded-lg p-4 border border-blue-200/50 dark:border-blue-800/50",children:[e.jsxs("h4",{className:"font-semibold text-sm mb-3 flex items-center gap-2",children:[e.jsx(Ne,{className:"h-4 w-4"}),"Genel Bilgiler"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-xs font-medium text-muted-foreground uppercase tracking-wide",children:"Kullanıcı"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-8 w-8 rounded-full bg-gradient-to-br from-blue-500 to-purple-500 flex items-center justify-center text-white font-semibold text-xs",children:(s.userName||s.userEmail||"S").charAt(0).toUpperCase()}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-semibold text-sm",children:s.userName||(s.userEmail?s.userEmail.split("@")[0]:"Sistem")}),s.userEmail&&e.jsx("span",{className:"text-xs text-muted-foreground",children:s.userEmail})]})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-xs font-medium text-muted-foreground uppercase tracking-wide",children:"Kayıt Bilgileri"}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:xe[s.tableName]||Y[s.tableName]||s.tableName}),(()=>{const r=X(s.newData||s.oldData,s.tableName)||X(s.oldData,s.tableName);return r?e.jsx("span",{className:"font-semibold text-sm mt-1",children:r}):null})()]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-xs font-medium text-muted-foreground uppercase tracking-wide",children:"İşlem Tipi"}),e.jsx("div",{children:e.jsx(k,{className:V[s.action].color,children:V[s.action].label})})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-xs font-medium text-muted-foreground uppercase tracking-wide",children:"Tarih & Saat"}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-semibold text-sm",children:L(s.createdAt.toDate(),"dd MMMM yyyy",{locale:O})}),e.jsx("span",{className:"text-xs text-muted-foreground",children:L(s.createdAt.toDate(),"HH:mm:ss",{locale:O})})]})]})]})]}),s.action==="UPDATE"&&s.oldData&&s.newData&&i.length>0&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("h4",{className:"font-semibold text-sm flex items-center gap-2",children:[e.jsx("div",{className:"h-1.5 w-1.5 rounded-full bg-blue-500"}),"Değişiklik Detayları",e.jsxs(k,{variant:"outline",className:"ml-auto text-xs",children:[i.length," alan değiştirildi"]})]}),e.jsx("div",{className:"space-y-3",children:i.map(r=>{const a=K[r]||r,m=P(s.oldData[r],r),n=P(s.newData[r],r);return e.jsxs("div",{className:"bg-gradient-to-r from-red-50/50 to-green-50/50 dark:from-red-950/20 dark:to-green-950/20 rounded-lg p-4 border border-red-200/50 dark:border-red-800/50 hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"font-semibold text-sm mb-2 flex items-center gap-2",children:[e.jsx("div",{className:"h-2 w-2 rounded-full bg-blue-500"}),a]}),e.jsxs("div",{className:"flex items-center gap-3 text-sm",children:[e.jsxs("div",{className:"flex-1 bg-white dark:bg-gray-900 rounded-md p-2 border border-red-200 dark:border-red-800",children:[e.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:"Eski Değer"}),e.jsx("span",{className:"text-red-600 dark:text-red-400 line-through font-medium",children:m})]}),e.jsx("div",{className:"text-muted-foreground text-lg",children:"→"}),e.jsxs("div",{className:"flex-1 bg-white dark:bg-gray-900 rounded-md p-2 border border-green-200 dark:border-green-800",children:[e.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:"Yeni Değer"}),e.jsx("span",{className:"text-green-600 dark:text-green-400 font-semibold",children:n})]})]})]},r)})})]}),s.action==="CREATE"&&s.newData&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("h4",{className:"font-semibold text-sm flex items-center gap-2",children:[e.jsx("div",{className:"h-1.5 w-1.5 rounded-full bg-green-500"}),"Oluşturulan Bilgiler",e.jsxs(k,{variant:"outline",className:"ml-auto text-xs bg-green-50 dark:bg-green-950/20 border-green-200 dark:border-green-800",children:[Object.keys(s.newData).length," alan"]})]}),e.jsxs("div",{className:"bg-gradient-to-r from-green-50/50 to-emerald-50/50 dark:from-green-950/20 dark:to-emerald-950/20 rounded-lg p-4 border border-green-200/50 dark:border-green-800/50",children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:Object.entries(s.newData).slice(0,12).map(([r,a])=>{const m=K[r]||r,n=P(a,r);return e.jsxs("div",{className:"bg-white dark:bg-gray-900 rounded-md p-3 border border-green-200/50 dark:border-green-800/50",children:[e.jsx("div",{className:"text-xs font-medium text-muted-foreground mb-1 uppercase tracking-wide",children:m}),e.jsx("div",{className:"text-sm font-medium text-foreground break-words",children:n})]},r)})}),Object.keys(s.newData).length>12&&e.jsxs("div",{className:"mt-3 text-center text-xs text-muted-foreground italic bg-white dark:bg-gray-900 rounded-md p-2 border border-green-200/50 dark:border-green-800/50",children:["+",Object.keys(s.newData).length-12," alan daha..."]})]})]}),s.action==="DELETE"&&s.oldData&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("h4",{className:"font-semibold text-sm flex items-center gap-2",children:[e.jsx("div",{className:"h-1.5 w-1.5 rounded-full bg-red-500"}),"Silinen Bilgiler",e.jsxs(k,{variant:"outline",className:"ml-auto text-xs bg-red-50 dark:bg-red-950/20 border-red-200 dark:border-red-800",children:[Object.keys(s.oldData).length," alan"]})]}),e.jsxs("div",{className:"bg-gradient-to-r from-red-50/50 to-rose-50/50 dark:from-red-950/20 dark:to-rose-950/20 rounded-lg p-4 border border-red-200/50 dark:border-red-800/50",children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:Object.entries(s.oldData).slice(0,12).map(([r,a])=>{const m=K[r]||r,n=P(a,r);return e.jsxs("div",{className:"bg-white dark:bg-gray-900 rounded-md p-3 border border-red-200/50 dark:border-red-800/50 opacity-75",children:[e.jsx("div",{className:"text-xs font-medium text-muted-foreground mb-1 uppercase tracking-wide",children:m}),e.jsx("div",{className:"text-sm font-medium text-red-600 dark:text-red-400 break-words line-through",children:n})]},r)})}),Object.keys(s.oldData).length>12&&e.jsxs("div",{className:"mt-3 text-center text-xs text-muted-foreground italic bg-white dark:bg-gray-900 rounded-md p-2 border border-red-200/50 dark:border-red-800/50",children:["+",Object.keys(s.oldData).length-12," alan daha..."]})]})]})]})]})},s.id)}),ne&&j==="admin"&&!h&&e.jsx("div",{className:"flex justify-center mt-6",children:e.jsxs(je,{onClick:Ae,variant:"outline",className:"gap-2",children:[e.jsx(be,{className:"h-4 w-4"}),"Daha Fazla Yükle (",l," / ",F.length,")"]})})]})]})})]})},hs=({open:j,onOpenChange:E,departmentId:p})=>{const[x,R]=u.useState(null),[C,_]=u.useState([]),[h,w]=u.useState([]),[$,J]=u.useState(!0),[N,q]=u.useState(null);u.useEffect(()=>{j&&p&&A()},[j,p]);const A=()=>Z(void 0,null,function*(){J(!0);try{const[l,M,ne]=yield Promise.all([Pe(p),Te(),ts()]);if(R(l),l.managerId){const g=M.find(U=>U.id===l.managerId&&!U.deleted);q(g||null)}else q(null);const Q=M.filter(g=>!!(g.departmentId===p||g.approvedTeams&&g.approvedTeams.includes(p)||g.pendingTeams&&g.pendingTeams.includes(p)));_(Q);const v=new Set(Q.map(g=>g.id)),H=ne.filter(g=>!!(g.productionProcessId===p||g.assignedUsers&&Array.isArray(g.assignedUsers)&&g.assignedUsers.some(y=>{if(typeof y=="string")return v.has(y);if(y&&typeof y=="object"){const z=y.id||y.assignedTo||y.userId;return z&&v.has(z)}return!1})||g.createdBy&&v.has(g.createdBy)));w(H)}catch(l){console.error("Error fetching department details:",l)}finally{J(!1)}}),T={totalMembers:C.length,activeTasks:h.filter(l=>l.status!=="completed"&&l.status!=="cancelled").length,completedTasks:h.filter(l=>l.status==="completed").length,pendingTasks:h.filter(l=>l.status==="pending").length,inProgressTasks:h.filter(l=>l.status==="in_progress").length,completionRate:h.length>0?h.filter(l=>l.status==="completed").length/h.length*100:0},re=l=>{switch(l){case"completed":return"bg-green-500";case"in_progress":return"bg-blue-500";case"pending":return"bg-yellow-500";case"cancelled":return"bg-red-500";default:return"bg-gray-500"}},ae=l=>{switch(l){case"completed":return"Tamamlandı";case"in_progress":return"Devam Ediyor";case"pending":return"Beklemede";case"cancelled":return"İptal Edildi";default:return l}};return e.jsx(Ke,{open:j,onOpenChange:E,children:e.jsx(Je,{className:"!max-w-[100vw] sm:!max-w-[95vw] !w-[100vw] sm:!w-[95vw] !h-[100vh] sm:!h-[90vh] !max-h-[100vh] sm:!max-h-[90vh] !left-0 sm:!left-[2.5vw] !top-0 sm:!top-[5vh] !right-0 sm:!right-auto !bottom-0 sm:!bottom-auto !translate-x-0 !translate-y-0 overflow-hidden !p-0 gap-0 bg-white flex flex-col !m-0 !rounded-none sm:!rounded-lg !border-0 sm:!border",children:e.jsxs("div",{className:"flex flex-col h-full min-h-0",children:[e.jsx(qe,{className:"p-3 sm:p-4 border-b bg-white flex-shrink-0",children:e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3",children:[e.jsx("div",{className:"h-8 w-8 sm:h-10 sm:w-10 rounded-lg bg-primary/10 flex items-center justify-center border border-primary/20 flex-shrink-0",children:e.jsx(ze,{className:"h-4 w-4 sm:h-5 sm:w-5 text-primary"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx(Qe,{className:"text-lg sm:text-xl font-semibold text-foreground truncate",children:$?"Yükleniyor...":(x==null?void 0:x.name)||"Departman Detayları"}),x!=null&&x.description?e.jsx(ke,{className:"text-xs text-muted-foreground truncate mt-0.5",children:x.description}):e.jsx(ke,{className:"sr-only",children:"Departman detayları ve bilgileri"})]})]})}),e.jsx("div",{className:"flex-1 overflow-hidden bg-gray-50/50 p-3 sm:p-4 min-h-0",children:e.jsx("div",{className:"max-w-full mx-auto h-full overflow-y-auto",children:$?e.jsxs("div",{className:"space-y-4",children:[e.jsx(ue,{className:"h-32 w-full"}),e.jsx(ue,{className:"h-64 w-full"}),e.jsx(ue,{className:"h-64 w-full"})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs(S,{children:[e.jsx(ee,{children:e.jsx(se,{className:"text-lg",children:"Genel Bilgiler"})}),e.jsx(D,{className:"space-y-3 sm:space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium text-muted-foreground",children:"Departman Adı"}),e.jsx("p",{className:"text-base font-semibold mt-1",children:x==null?void 0:x.name})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium text-muted-foreground",children:"Yönetici"}),e.jsx("p",{className:"text-base font-semibold mt-1",children:N?N.fullName||N.email:"Atanmamış"}),(N==null?void 0:N.email)&&e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:N.email})]}),(x==null?void 0:x.description)&&e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("span",{className:"text-sm font-medium text-muted-foreground",children:"Açıklama"}),e.jsx("p",{className:"text-sm mt-1",children:x.description})]})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3 sm:gap-4",children:[e.jsx(S,{className:"bg-gradient-to-br from-blue-50 to-blue-100/50 border-blue-200",children:e.jsx(D,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-blue-700",children:"Toplam Üye"}),e.jsx("p",{className:"text-2xl font-bold text-blue-900 mt-1",children:T.totalMembers})]}),e.jsx(ye,{className:"h-8 w-8 text-blue-600"})]})})}),e.jsx(S,{className:"bg-gradient-to-br from-yellow-50 to-yellow-100/50 border-yellow-200",children:e.jsx(D,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-yellow-700",children:"Aktif Görevler"}),e.jsx("p",{className:"text-2xl font-bold text-yellow-900 mt-1",children:T.activeTasks})]}),e.jsx(Fe,{className:"h-8 w-8 text-yellow-600"})]})})}),e.jsx(S,{className:"bg-gradient-to-br from-green-50 to-green-100/50 border-green-200",children:e.jsx(D,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-green-700",children:"Tamamlanan"}),e.jsx("p",{className:"text-2xl font-bold text-green-900 mt-1",children:T.completedTasks})]}),e.jsx(ve,{className:"h-8 w-8 text-green-600"})]})})}),e.jsx(S,{className:"bg-gradient-to-br from-purple-50 to-purple-100/50 border-purple-200",children:e.jsx(D,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-purple-700",children:"Tamamlanma Oranı"}),e.jsxs("p",{className:"text-2xl font-bold text-purple-900 mt-1",children:[T.completionRate.toFixed(0),"%"]})]}),e.jsx(Ge,{className:"h-8 w-8 text-purple-600"})]})})})]}),e.jsxs(S,{children:[e.jsx(ee,{children:e.jsx(se,{className:"text-lg",children:"Görev Tamamlanma Durumu"})}),e.jsxs(D,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"font-medium",children:"Genel İlerleme"}),e.jsxs("span",{className:"text-muted-foreground",children:[T.completionRate.toFixed(1),"%"]})]}),e.jsx(Xe,{value:T.completionRate,className:"h-3"})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Bekleyen:"}),e.jsx("span",{className:"ml-2 font-semibold",children:T.pendingTasks})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Devam Eden:"}),e.jsx("span",{className:"ml-2 font-semibold",children:T.inProgressTasks})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Tamamlanan:"}),e.jsx("span",{className:"ml-2 font-semibold",children:T.completedTasks})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Toplam:"}),e.jsx("span",{className:"ml-2 font-semibold",children:h.length})]})]})]})]}),e.jsxs(S,{children:[e.jsx(ee,{children:e.jsxs(se,{className:"text-lg flex items-center gap-2",children:[e.jsx(ye,{className:"h-5 w-5"}),"Ekip Üyeleri (",T.totalMembers,")"]})}),e.jsx(D,{children:C.length>0?e.jsx("div",{className:"space-y-3",children:C.map(l=>{var M;return e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg bg-muted/50 hover:bg-muted transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-10 w-10 rounded-full bg-gradient-to-br from-primary to-primary/60 flex items-center justify-center text-white font-semibold",children:(l.fullName||l.email).charAt(0).toUpperCase()}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:l.fullName||l.email}),e.jsx("div",{className:"flex items-center gap-2 text-xs text-muted-foreground mt-1",children:l.email&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Ie,{className:"h-3 w-3"}),l.email]})})]})]}),e.jsx(k,{variant:"outline",children:(M=l.approvedTeams)!=null&&M.includes(p)?"Onaylı":"Beklemede"})]},l.id)})}):e.jsx("p",{className:"text-center text-muted-foreground py-4",children:"Bu departmanda henüz üye bulunmuyor"})})]}),e.jsxs(S,{children:[e.jsx(ee,{children:e.jsxs(se,{className:"text-lg flex items-center gap-2",children:[e.jsx(ve,{className:"h-5 w-5"}),"Görevler (",h.length,")"]})}),e.jsx(D,{children:h.length>0?e.jsxs("div",{className:"overflow-x-auto",children:[e.jsxs(Ze,{children:[e.jsx(es,{children:e.jsxs(we,{children:[e.jsx(G,{children:"Başlık"}),e.jsx(G,{children:"Durum"}),e.jsx(G,{children:"Öncelik"}),e.jsx(G,{children:"Oluşturulma"}),e.jsx(G,{children:"Bitiş Tarihi"})]})}),e.jsx(ss,{children:h.slice(0,10).map(l=>e.jsxs(we,{children:[e.jsx(I,{className:"font-medium",children:l.title}),e.jsx(I,{children:e.jsx(k,{className:re(l.status),children:ae(l.status)})}),e.jsx(I,{children:e.jsx(k,{variant:"outline",children:l.priority||"Normal"})}),e.jsx(I,{className:"text-sm text-muted-foreground",children:l.createdAt?L(l.createdAt.toDate(),"dd MMM yyyy",{locale:O}):"-"}),e.jsx(I,{className:"text-sm text-muted-foreground",children:l.dueDate?L(l.dueDate.toDate(),"dd MMM yyyy",{locale:O}):"-"})]},l.id))})]}),h.length>10&&e.jsxs("p",{className:"text-center text-sm text-muted-foreground mt-4",children:["+",h.length-10," görev daha..."]})]}):e.jsx("p",{className:"text-center text-muted-foreground py-4",children:"Bu departmanda henüz görev bulunmuyor"})})]})]})})})]})})})};export{xs as A,hs as D};
