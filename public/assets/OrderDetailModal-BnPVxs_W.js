var es=Object.defineProperty,ss=Object.defineProperties;var ts=Object.getOwnPropertyDescriptors;var Te=Object.getOwnPropertySymbols;var as=Object.prototype.hasOwnProperty,is=Object.prototype.propertyIsEnumerable;var qe=(a,c,e)=>c in a?es(a,c,{enumerable:!0,configurable:!0,writable:!0,value:e}):a[c]=e,p=(a,c)=>{for(var e in c||(c={}))as.call(c,e)&&qe(a,e,c[e]);if(Te)for(var e of Te(c))is.call(c,e)&&qe(a,e,c[e]);return a},x=(a,c)=>ss(a,ts(c));var D=(a,c,e)=>new Promise((je,F)=>{var P=j=>{try{S(e.next(j))}catch(A){F(A)}},d=j=>{try{S(e.throw(j))}catch(A){F(A)}},S=j=>j.done?je(j.value):Promise.resolve(j.value).then(P,d);S((e=e.apply(a,c)).next())});import{u as ns,a as y,j as s,B as k,C as _,p as b,q as v,b as w,L as f,I as B,S as he,c as oe,d as re,e as pe,f as C,s as ls,t as cs,v as ms,w as us,x as ds,T as fe,r as hs}from"./index-BQmY0BmM.js";import{r as o,H as os,S as rs,T as ps,X as xs,m as Be,I as gs,o as $e,l as Ae,k as fs,h as ze,J as js,K as ys,N as Ns,O as _s,g as bs,u as vs,y as ws,i as Ss,n as Ds}from"./lucide-react-CAeuRJQk.js";import{l as ks,o as Cs,D as Ts,a as qs,b as Bs,c as As,e as Oe,B as Fe,T as Pe,u as xe,p as Os,q as Fs,r as Ps}from"./MainLayout-Dv9j77B5.js";import{b as Ee}from"./taskService-CI62TrOj.js";const ee=a=>{if(!a)return null;if(typeof a=="string"){const c=new Date(a);return isNaN(c.getTime())?null:c}if(a instanceof Date)return isNaN(a.getTime())?null:a;if(a instanceof fe)return a.toDate();if(a&&typeof a=="object"){if("seconds"in a&&typeof a.seconds=="number")return new Date(a.seconds*1e3);if("toDate"in a&&typeof a.toDate=="function")try{return a.toDate()}catch(c){return null}if("_seconds"in a&&typeof a._seconds=="number")return new Date(a._seconds*1e3)}return null},T=a=>{if(!a)return"-";let c=null;if(a instanceof Date)c=a;else if(a instanceof fe)c=a.toDate();else if(typeof a=="string")c=new Date(a);else if(a&&typeof a=="object")if("seconds"in a&&typeof a.seconds=="number")c=new Date(a.seconds*1e3);else if("toDate"in a&&typeof a.toDate=="function")try{c=a.toDate()}catch(e){return"-"}else"_seconds"in a&&typeof a._seconds=="number"&&(c=new Date(a._seconds*1e3));if(!c||isNaN(c.getTime()))return"-";try{return c.toLocaleDateString("tr-TR",{day:"2-digit",month:"short",year:"numeric"})}catch(e){return"-"}},R=[{value:"planned",label:"Planlanan",icon:ws,color:"text-muted-foreground"},{value:"in_production",label:"Üretimde",icon:$e,color:"text-blue-500"},{value:"quality_check",label:"Kalite Kontrol",icon:Ss,color:"text-cyan-500"},{value:"completed",label:"Tamamlandı",icon:Ds,color:"text-emerald-600"},{value:"on_hold",label:"Beklemede",icon:ze,color:"text-amber-500"}],ge=a=>a||"planned",Is=({open:a,onOpenChange:c,order:e,onEdit:je,onDelete:F,onUpdate:P})=>{var ke,Ce;if(!e)return null;const{user:d,isAdmin:S}=ns(),[j,A]=o.useState([]),[G,H]=o.useState(!1),[Le,ye]=o.useState(!0),[l,Me]=o.useState(null),[Ne,W]=o.useState(!1),[q,J]=o.useState(ge(e==null?void 0:e.status)),[_e,Ie]=o.useState({}),[Q,se]=o.useState(!1),[te,be]=o.useState(!1),[X,Ve]=o.useState([]),[ae,ve]=o.useState(!1),[n,r]=o.useState({order_number:"",product_name:"",product_id:"",quantity:"",unit:"Adet",customer_id:"",customer_name:"",due_date:"",priority:"0",status:"planned",notes:"",shipping_address:"",shipping_notes:""}),Y=(e==null?void 0:e.order_number)||(e==null?void 0:e.orderNumber)||(e==null?void 0:e.id)||"-",Z=ee((e==null?void 0:e.due_date)||(e==null?void 0:e.dueDate)),ie=ee((e==null?void 0:e.created_at)||(e==null?void 0:e.createdAt)),Ke=ee((e==null?void 0:e.updated_at)||(e==null?void 0:e.updatedAt)),ne=(e==null?void 0:e.delivery_address)||(e==null?void 0:e.shippingAddress)||(e==null?void 0:e.shipping_address),le=(e==null?void 0:e.delivery_notes)||(e==null?void 0:e.shippingNotes)||(e==null?void 0:e.shipping_notes),Ue=((ke=d==null?void 0:d.roles)==null?void 0:ke.includes("manager"))||S,Re=(d==null?void 0:d.id)===(e==null?void 0:e.createdBy),ce=Ue||S||Re,Ge=o.useCallback(()=>D(void 0,null,function*(){try{ve(!0);const t=yield ks();Ve(t)}catch(t){console.error("Fetch products error:",t),y.error("Ürün listesi alınamadı.")}finally{ve(!1)}}),[]);o.useEffect(()=>{a&&(e!=null&&e.id)&&(we(),J(ge(e==null?void 0:e.status)),Ge())},[a,e==null?void 0:e.id,e==null?void 0:e.status]),o.useEffect(()=>{var t,i,m,u,h,g,N,$,z,L,M,I,V,K,U;if(e&&!Q){const me=((i=(t=e.items)==null?void 0:t[0])==null?void 0:i.productId)||((u=(m=e.items)==null?void 0:m[0])==null?void 0:u.product_id)||e.product_id||"",ue=((g=(h=e.items)==null?void 0:h[0])==null?void 0:g.productName)||(($=(N=e.items)==null?void 0:N[0])==null?void 0:$.product_name)||e.product_name||"",de=e.due_date?e.due_date instanceof Date?e.due_date.toISOString().split("T")[0]:typeof e.due_date=="string"?new Date(e.due_date).toISOString().split("T")[0]:e.dueDate?e.dueDate instanceof Date?e.dueDate.toISOString().split("T")[0]:typeof e.dueDate=="string"?new Date(e.dueDate).toISOString().split("T")[0]:"":"":"";r({order_number:e.order_number||e.orderNumber||"",product_name:ue,product_id:me,quantity:((z=e.quantity)==null?void 0:z.toString())||((I=(M=(L=e.items)==null?void 0:L[0])==null?void 0:M.quantity)==null?void 0:I.toString())||"",unit:e.unit||((K=(V=e.items)==null?void 0:V[0])==null?void 0:K.unit)||"Adet",customer_id:e.customer_id||e.customerId||"",customer_name:e.customer_name||e.customerName||"",due_date:de,priority:((U=e.priority)==null?void 0:U.toString())||"0",status:e.status||"planned",notes:e.notes||"",shipping_address:e.delivery_address||e.shippingAddress||e.shipping_address||"",shipping_notes:e.delivery_notes||e.shippingNotes||e.shipping_notes||""})}},[e,a,Q]),o.useEffect(()=>{a&&D(void 0,null,function*(){try{const i=yield hs(),m={};i.forEach(u=>{m[u.id]=u.fullName||u.displayName||u.email||"Bilinmeyen"}),Ie(m)}catch(i){console.error("Error loading users:",i)}})},[a]);const we=()=>D(void 0,null,function*(){ye(!0);try{if(e.customer_id||e.customerId){const t=e.customer_id||e.customerId;try{const i=yield Cs(t);Me(i)}catch(i){console.error("Fetch customer error:",i)}}H(!0);try{const t=yield Ee({productionOrderId:e.id});A(t)}catch(t){console.error("Fetch order tasks error:",t),y.error(t.message||"Görevler yüklenirken hata oluştu")}finally{H(!1)}}catch(t){console.error("Fetch order details error:",t),y.error("Detaylar yüklenirken hata: "+(t.message||"Bilinmeyen hata"))}finally{ye(!1)}}),He=()=>D(void 0,null,function*(){H(!0);try{const t=yield Ee({productionOrderId:e.id});A(t)}catch(t){console.error("Fetch order tasks error:",t),y.error(t.message||"Görevler yüklenirken hata oluştu")}finally{H(!1)}}),E=t=>({planned:"Planlanan",in_production:"Üretimde",quality_check:"Kalite Kontrol",completed:"Tamamlandı",on_hold:"Beklemede"})[t]||t,We=t=>{switch(t){case"completed":return"default";case"in_production":return"secondary";case"quality_check":return"secondary";case"planned":return"outline";case"on_hold":return"outline";default:return"secondary"}},Se=()=>{const t=ge(q),i=R.findIndex(m=>m.value===t);return i===-1?0:i},O=()=>{const t=Se();return t===-1||t>=R.length-1||q==="on_hold"?null:R[t+1]},Je=t=>D(void 0,null,function*(){if(!(!(e!=null&&e.id)||!(d!=null&&d.id))){W(!0);try{yield xe(e.id,{status:t},d.id,S),J(t),y.success(`Sipariş durumu ${E(t)} olarak güncellendi.`)}catch(i){console.error("Order status update error:",i),y.error("Durum güncellenemedi: "+((i==null?void 0:i.message)||"Bilinmeyen hata"))}finally{W(!1)}}}),Qe=t=>D(void 0,null,function*(){if(!(!(e!=null&&e.id)||!(d!=null&&d.id)||!ce)){W(!0);try{yield xe(e.id,{status:t},d.id,S),J(t),y.success(`Sipariş durumu ${E(t)} olarak güncellendi.`)}catch(i){console.error("Order status revert error:",i),y.error("Durum güncellenemedi: "+((i==null?void 0:i.message)||"Bilinmeyen hata"))}finally{W(!1)}}}),Xe=t=>{if(t==="none"||t===""){r(m=>x(p({},m),{product_id:""}));return}const i=X.find(m=>m.id===t);i&&r(m=>x(p({},m),{product_id:t,product_name:i.name}))},Ye=t=>{r(i=>{const m=X.find(h=>h.id===i.product_id),u=m&&m.name===t?i.product_id:"";return x(p({},i),{product_name:t,product_id:u})})},De=t=>D(void 0,null,function*(){if(t.preventDefault(),!!(e!=null&&e.id)){be(!0);try{const i=n.due_date?fe.fromDate(new Date(n.due_date)):null,m=Number(n.quantity)||0;yield xe(e.id,{orderNumber:n.order_number,order_number:n.order_number,customerId:n.customer_id||null,customer_id:n.customer_id||null,customerName:n.customer_name||null,customer_name:n.customer_name||null,dueDate:i,due_date:n.due_date||null,status:n.status,notes:n.notes||null,deliveryAddress:n.shipping_address||null,delivery_address:n.shipping_address||null,shippingAddress:n.shipping_address||null,shipping_address:n.shipping_address||null,deliveryNotes:n.shipping_notes||null,delivery_notes:n.shipping_notes||null,shippingNotes:n.shipping_notes||null,shipping_notes:n.shipping_notes||null,totalQuantity:m,total_quantity:m,itemsCount:1,items_count:1},d==null?void 0:d.id);try{const u=yield Os(e.id);u.length>0&&(yield Fs(e.id,u[0].id,{productId:n.product_id||null,product_id:n.product_id||null,productName:n.product_name,product_name:n.product_name,quantity:m}))}catch(u){console.warn("Order items güncellenemedi:",u)}y.success("Sipariş başarıyla güncellendi"),se(!1),J(n.status),P==null||P(),we()}catch(i){console.error("Update production order error:",i),y.error(i.message||"Sipariş güncellenirken hata oluştu")}finally{be(!1)}}});[Y&&{label:"Sipariş No",value:Y},ie&&{label:"Oluşturulma",value:T(ie)},Z&&{label:"Termin",value:T(Z)},e.priority!==void 0&&{label:"Öncelik",value:`${e.priority||0} / 5`}].filter(Boolean);const Ze=[{label:"Sipariş No",value:Y},{label:"Ürün",value:e.product_name||e.productName||"-"},{label:"Miktar",value:`${e.quantity||0} ${e.unit||"Adet"}`},{label:"Termin Tarihi",value:T(Z)},{label:"Öncelik",value:`${e.priority||0} / 5`},{label:"Durum",value:E(e.status)},{label:"Oluşturan",value:e!=null&&e.createdBy&&_e[e.createdBy]||"-"},{label:"Oluşturma Tarihi",value:T(ie)},{label:"Son Güncelleme",value:T(Ke)}];return s.jsx(Ts,{open:a,onOpenChange:c,children:s.jsx(qs,{className:"!max-w-[100vw] sm:!max-w-[95vw] !w-[100vw] sm:!w-[95vw] !h-[100vh] sm:!h-[90vh] !max-h-[100vh] sm:!max-h-[90vh] !left-0 sm:!left-[2.5vw] !top-0 sm:!top-[5vh] !right-0 sm:!right-auto !bottom-0 sm:!bottom-auto !translate-x-0 !translate-y-0 overflow-hidden !p-0 gap-0 bg-white flex flex-col !m-0 !rounded-none sm:!rounded-lg !border-0 sm:!border",children:s.jsxs("div",{className:"flex flex-col h-full min-h-0",children:[s.jsx(Bs,{className:"p-3 sm:p-4 border-b bg-white flex-shrink-0",children:s.jsxs("div",{className:"flex items-center justify-between gap-3",children:[s.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 flex-1 min-w-0",children:[s.jsx("div",{className:"h-8 w-8 sm:h-10 sm:w-10 rounded-lg bg-primary/10 flex items-center justify-center border border-primary/20 flex-shrink-0",children:s.jsx(os,{className:"h-4 w-4 sm:h-5 sm:w-5 text-primary"})}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsxs(As,{className:"text-lg sm:text-xl font-semibold text-foreground truncate",children:["Üretim Siparişi - ",Y]}),e.product_name||e.productName?s.jsx(Oe,{className:"text-xs text-muted-foreground truncate mt-0.5",children:e.product_name||e.productName}):s.jsx(Oe,{className:"sr-only",children:"Üretim siparişi detayları"})]})]}),s.jsxs("div",{className:"flex flex-wrap items-center gap-2 flex-shrink-0 relative z-10 pr-10 sm:pr-12",children:[s.jsx(Fe,{variant:We(q),className:"text-xs px-2 sm:px-3 py-1 relative z-10",children:E(q)}),Q?s.jsxs("div",{className:"flex gap-2",children:[s.jsxs(k,{variant:"outline",size:"sm",onClick:()=>{var t,i,m,u,h,g,N,$,z,L,M,I,V,K,U;if(se(!1),e){const me=((i=(t=e.items)==null?void 0:t[0])==null?void 0:i.productId)||((u=(m=e.items)==null?void 0:m[0])==null?void 0:u.product_id)||e.product_id||"",ue=((g=(h=e.items)==null?void 0:h[0])==null?void 0:g.productName)||(($=(N=e.items)==null?void 0:N[0])==null?void 0:$.product_name)||e.product_name||"",de=e.due_date?e.due_date instanceof Date?e.due_date.toISOString().split("T")[0]:typeof e.due_date=="string"?new Date(e.due_date).toISOString().split("T")[0]:"":"";r({order_number:e.order_number||e.orderNumber||"",product_name:ue,product_id:me,quantity:((z=e.quantity)==null?void 0:z.toString())||((I=(M=(L=e.items)==null?void 0:L[0])==null?void 0:M.quantity)==null?void 0:I.toString())||"",unit:e.unit||((K=(V=e.items)==null?void 0:V[0])==null?void 0:K.unit)||"Adet",customer_id:e.customer_id||e.customerId||"",customer_name:e.customer_name||e.customerName||"",due_date:de,priority:((U=e.priority)==null?void 0:U.toString())||"0",status:e.status||"planned",notes:e.notes||"",shipping_address:e.delivery_address||e.shippingAddress||e.shipping_address||"",shipping_notes:e.delivery_notes||e.shippingNotes||e.shipping_notes||""})}},disabled:te,className:"min-h-[44px] sm:min-h-0",children:[s.jsx(xs,{className:"h-4 w-4 mr-2"}),"İptal"]}),s.jsx(k,{size:"sm",onClick:t=>{t.preventDefault();const i=document.getElementById("production-order-edit-form");i?i.requestSubmit():De(t)},disabled:te,className:"min-h-[44px] sm:min-h-0",children:te?s.jsxs(s.Fragment,{children:[s.jsx(Be,{className:"h-4 w-4 mr-2 animate-spin"}),"Kaydediliyor..."]}):s.jsxs(s.Fragment,{children:[s.jsx(gs,{className:"h-4 w-4 mr-2"}),"Kaydet"]})})]}):s.jsxs(s.Fragment,{children:[s.jsxs(k,{variant:"outline",size:"sm",onClick:()=>se(!0),className:"min-h-[44px] sm:min-h-0",children:[s.jsx(rs,{className:"h-4 w-4 mr-2"}),"Düzenle"]}),F&&s.jsxs(k,{variant:"outline",size:"sm",onClick:F,className:"min-h-[44px] sm:min-h-0 text-destructive hover:text-destructive",children:[s.jsx(ps,{className:"h-4 w-4 mr-2"}),"Sil"]})]})]})]})}),s.jsx("div",{className:"flex-1 overflow-hidden bg-gray-50/50 p-3 sm:p-4 min-h-0",children:s.jsx("div",{className:"max-w-full mx-auto h-full overflow-y-auto",children:Le?s.jsx("div",{className:"flex items-center justify-center py-8",children:s.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}):Q?s.jsx("form",{id:"production-order-edit-form",onSubmit:De,className:"space-y-4 sm:space-y-6",children:s.jsxs(_,{children:[s.jsx(b,{children:s.jsx(v,{className:"text-lg",children:"Sipariş Bilgileri"})}),s.jsxs(w,{className:"space-y-4 sm:space-y-6",children:[s.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4",children:[s.jsxs("div",{className:"space-y-2",children:[s.jsx(f,{htmlFor:"order_number",showRequired:!0,children:"Sipariş No"}),s.jsx(B,{id:"order_number",value:n.order_number,onChange:t=>r(x(p({},n),{order_number:t.target.value})),required:!0,className:"min-h-[44px] sm:min-h-0"})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(f,{htmlFor:"status",children:"Durum"}),s.jsxs(he,{value:n.status,onValueChange:t=>r(x(p({},n),{status:t})),children:[s.jsx(oe,{className:"min-h-[44px] sm:min-h-0",children:s.jsx(re,{})}),s.jsx(pe,{children:(()=>{const t=(e==null?void 0:e.status)||"planned",i=Ps(t),m={planned:"Planlanan",in_production:"Üretimde",quality_check:"Kalite Kontrol",completed:"Tamamlandı",on_hold:"Beklemede",pending:"Beklemede",cancelled:"İptal Edildi"};return[...new Set([t,...i])].map(h=>s.jsx(C,{value:h,children:m[h]||h},h))})()})]})]})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(f,{htmlFor:"customer_name",children:"Müşteri Adı"}),s.jsx(B,{id:"customer_name",value:n.customer_name,onChange:t=>r(x(p({},n),{customer_name:t.target.value})),className:"min-h-[44px] sm:min-h-0"})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(f,{htmlFor:"product_name",showRequired:!0,children:"Ürün Adı"}),s.jsxs("div",{className:"space-y-2",children:[s.jsxs(he,{value:n.product_id||"none",onValueChange:Xe,disabled:ae,children:[s.jsx(oe,{className:"min-h-[44px] sm:min-h-0",children:s.jsx(re,{placeholder:ae?"Ürünler yükleniyor...":"Ürün seçin (Opsiyonel)"})}),s.jsxs(pe,{children:[s.jsx(C,{value:"none",children:"Ürün seçmeden devam et"}),X.map(t=>s.jsx(C,{value:t.id,children:t.name},t.id))]})]}),ae&&s.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[s.jsx(Be,{className:"h-4 w-4 animate-spin"})," Ürünler yükleniyor..."]}),s.jsx(B,{id:"product_name",placeholder:"Ürün adı girin (dropdown'dan seçebilir veya elle yazabilirsiniz)",value:n.product_name,onChange:t=>Ye(t.target.value),required:!0,className:"min-h-[44px] sm:min-h-0"}),n.product_id&&s.jsxs("p",{className:"text-xs text-muted-foreground flex items-center gap-1",children:[s.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-green-500"}),"Dropdown'dan seçili ürün: ",(Ce=X.find(t=>t.id===n.product_id))==null?void 0:Ce.name]})]})]}),s.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4",children:[s.jsxs("div",{className:"space-y-2",children:[s.jsx(f,{htmlFor:"quantity",showRequired:!0,children:"Miktar"}),s.jsx(B,{id:"quantity",type:"number",value:n.quantity,onChange:t=>r(x(p({},n),{quantity:t.target.value})),required:!0,className:"min-h-[44px] sm:min-h-0"})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(f,{htmlFor:"unit",children:"Birim"}),s.jsxs(he,{value:n.unit,onValueChange:t=>r(x(p({},n),{unit:t})),children:[s.jsx(oe,{className:"min-h-[44px] sm:min-h-0",children:s.jsx(re,{})}),s.jsxs(pe,{children:[s.jsx(C,{value:"Adet",children:"Adet"}),s.jsx(C,{value:"Kg",children:"Kg"}),s.jsx(C,{value:"Lt",children:"Lt"}),s.jsx(C,{value:"Mt",children:"Mt"}),s.jsx(C,{value:"M2",children:"M²"})]})]})]})]}),s.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4",children:[s.jsxs("div",{className:"space-y-2",children:[s.jsx(f,{htmlFor:"due_date",showRequired:!0,children:"Termin Tarihi"}),s.jsx(B,{id:"due_date",type:"date",value:n.due_date,onChange:t=>r(x(p({},n),{due_date:t.target.value})),required:!0,className:"min-h-[44px] sm:min-h-0"})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(f,{htmlFor:"priority",children:"Öncelik (0-5)"}),s.jsx(B,{id:"priority",type:"number",min:"0",max:"5",value:n.priority,onChange:t=>r(x(p({},n),{priority:t.target.value})),className:"min-h-[44px] sm:min-h-0"})]})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(f,{htmlFor:"notes",className:"text-sm sm:text-base",children:"Notlar"}),s.jsx(Pe,{id:"notes",value:n.notes,onChange:t=>r(x(p({},n),{notes:t.target.value})),rows:3,className:"min-h-[44px] sm:min-h-0",placeholder:"Sipariş ile ilgili notlar..."})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(f,{className:"text-sm sm:text-base",children:"Teslimat Bilgileri"}),s.jsxs("div",{className:"space-y-2",children:[s.jsxs("div",{className:"space-y-2",children:[s.jsx(f,{htmlFor:"shipping_address",className:"text-xs text-muted-foreground",children:"Teslimat Adresi"}),s.jsx(B,{id:"shipping_address",value:n.shipping_address,onChange:t=>r(x(p({},n),{shipping_address:t.target.value})),className:"min-h-[44px] sm:min-h-0",placeholder:"Teslimat adresi..."})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(f,{htmlFor:"shipping_notes",className:"text-xs text-muted-foreground",children:"Teslimat Notları"}),s.jsx(Pe,{id:"shipping_notes",value:n.shipping_notes,onChange:t=>r(x(p({},n),{shipping_notes:t.target.value})),rows:2,className:"min-h-[44px] sm:min-h-0",placeholder:"Teslimat ile ilgili notlar..."})]})]})]})]})]})}):s.jsxs("div",{className:"space-y-4 sm:space-y-6",children:[s.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3 sm:gap-4",children:[s.jsxs(_,{className:"bg-gradient-to-br from-blue-50/80 via-white to-white border-blue-100",children:[s.jsx(b,{className:"pb-2",children:s.jsxs(v,{className:"text-xs sm:text-sm font-medium text-muted-foreground flex items-center gap-2",children:[s.jsx($e,{className:"h-3 w-3 sm:h-4 sm:w-4"}),"Ürün"]})}),s.jsxs(w,{children:[s.jsx("p",{className:"text-lg sm:text-xl font-semibold text-foreground",children:e.product_name||e.productName||"-"}),s.jsxs("p",{className:"text-xs sm:text-sm text-muted-foreground mt-1",children:[e.quantity||0," ",e.unit||"Adet"]})]})]}),s.jsxs(_,{className:"bg-gradient-to-br from-indigo-50/80 via-white to-white border-indigo-100",children:[s.jsx(b,{className:"pb-2",children:s.jsxs(v,{className:"text-xs sm:text-sm font-medium text-muted-foreground flex items-center gap-2",children:[s.jsx(Ae,{className:"h-3 w-3 sm:h-4 sm:w-4"}),"Müşteri"]})}),s.jsxs(w,{children:[s.jsx("p",{className:"text-lg sm:text-xl font-semibold text-foreground",children:e.customer_name||e.customerName||"Belirtilmemiş"}),e.customer_company&&s.jsx("p",{className:"text-xs sm:text-sm text-muted-foreground mt-1",children:e.customer_company})]})]}),s.jsxs(_,{className:"bg-gradient-to-br from-slate-50/80 via-white to-white border-slate-100",children:[s.jsx(b,{className:"pb-2",children:s.jsxs(v,{className:"text-xs sm:text-sm font-medium text-muted-foreground flex items-center gap-2",children:[s.jsx(fs,{className:"h-3 w-3 sm:h-4 sm:w-4"}),"Termin"]})}),s.jsx(w,{children:s.jsx("p",{className:"text-lg sm:text-xl font-semibold text-foreground",children:T(Z)})})]}),s.jsxs(_,{className:"bg-gradient-to-br from-emerald-50/80 via-white to-white border-emerald-100",children:[s.jsx(b,{className:"pb-2",children:s.jsxs(v,{className:"text-xs sm:text-sm font-medium text-muted-foreground flex items-center gap-2",children:[s.jsx(ze,{className:"h-3 w-3 sm:h-4 sm:w-4"}),"Öncelik"]})}),s.jsx(w,{children:s.jsxs("p",{className:"text-lg sm:text-xl font-semibold text-foreground",children:[e.priority||0," / 5"]})})]})]}),s.jsxs(_,{children:[s.jsx(b,{className:"space-y-1",children:s.jsxs("div",{className:"flex items-center justify-between gap-3",children:[s.jsxs("div",{children:[s.jsx(v,{className:"text-lg",children:"Sipariş Durumu"}),s.jsx("p",{className:"text-sm text-muted-foreground",children:O()?`${E(q)} aşamasındasınız. Sıradaki adım: ${O().label}`:q==="on_hold"?"Sipariş beklemede.":"Workflow tamamlandı."})]}),s.jsxs("div",{className:"text-xs text-muted-foreground text-right",children:["Son güncelleyen: ",e!=null&&e.statusUpdatedBy?_e[e.statusUpdatedBy]||e.statusUpdatedBy:(d==null?void 0:d.fullName)||"-",s.jsx("br",{}),s.jsx("span",{className:"text-[11px]",children:e!=null&&e.statusUpdatedAt?T(e.statusUpdatedAt):""})]})]})}),s.jsx(w,{className:"p-3 sm:p-4 md:p-6",children:s.jsxs("div",{className:"space-y-3 sm:space-y-4",children:[s.jsx("div",{className:"flex items-center justify-between overflow-x-auto overflow-y-visible pt-2 pb-4",children:R.map((t,i)=>{const m=t.icon,u=Se(),h=i===u,g=i<u,N=ce&&(g||h)&&t.value!=="on_hold";return s.jsxs("div",{className:"flex items-center flex-1 min-w-0",children:[s.jsxs("div",{className:"flex flex-col items-center flex-1 min-w-0",children:[s.jsxs(ls,{delayDuration:150,children:[s.jsx(cs,{asChild:!0,children:s.jsx("div",{className:`
                                        w-10 h-10 rounded-full flex items-center justify-center border-2 transition-all relative z-10
                                        ${h?"bg-primary text-primary-foreground border-primary scale-110":""}
                                        ${g?"bg-green-500 text-white border-green-500":""}
                                        ${!h&&!g?"bg-muted border-muted-foreground/20":""}
                                        ${N?"cursor-pointer hover:scale-105":""}
                                      `,onClick:()=>{N&&i<u&&Qe(t.value)},children:s.jsx(m,{className:`h-5 w-5 ${h||g?"text-white":t.color}`})})}),s.jsx(ms,{children:N&&i<u?`${t.label} durumuna geri dönmek için tıklayın`:t.label})]}),s.jsx("p",{className:`text-xs mt-2 text-center font-medium ${h?"text-primary":g?"text-green-600":"text-muted-foreground"}`,children:t.label})]}),i<R.length-1&&s.jsx("div",{className:`flex-1 h-0.5 mx-2 ${g?"bg-green-500":"bg-muted"}`})]},t.value)})}),O()&&q!=="on_hold"&&s.jsx("div",{className:"flex justify-center pt-4 border-t",children:s.jsx(k,{onClick:()=>Je(O().value),disabled:Ne||!ce,className:"gap-2 min-h-[44px] sm:min-h-0",children:Ne?s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"Güncelleniyor..."]}):s.jsxs(s.Fragment,{children:[(()=>{const t=O().icon;return s.jsx(t,{className:"h-4 w-4"})})(),O().label," Durumuna Geç"]})})})]})})]}),s.jsxs("div",{className:"grid gap-4 sm:gap-6 grid-cols-1 lg:grid-cols-2",children:[s.jsxs(_,{children:[s.jsxs(b,{className:"space-y-1",children:[s.jsx(v,{className:"text-lg",children:"Müşteri Bilgileri"}),s.jsx("p",{className:"text-sm text-muted-foreground",children:"İletişim detayları"})]}),s.jsxs(w,{className:"space-y-3 sm:space-y-4",children:[s.jsxs("div",{className:"space-y-2 sm:space-y-3",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(Ae,{className:"h-4 w-4 text-muted-foreground"}),s.jsx("span",{className:"font-medium",children:(l==null?void 0:l.name)||(e==null?void 0:e.customerName)||(e==null?void 0:e.customer_name)||"-"})]}),((l==null?void 0:l.company)||(e==null?void 0:e.customerCompany)||(e==null?void 0:e.customer_company))&&s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(js,{className:"h-4 w-4 text-muted-foreground"}),s.jsx("span",{children:(l==null?void 0:l.company)||(e==null?void 0:e.customerCompany)||(e==null?void 0:e.customer_company)})]}),((l==null?void 0:l.phone)||(e==null?void 0:e.customerPhone)||(e==null?void 0:e.customer_phone))&&s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(ys,{className:"h-4 w-4 text-muted-foreground"}),s.jsx("span",{children:us((l==null?void 0:l.phone)||(e==null?void 0:e.customerPhone)||(e==null?void 0:e.customer_phone))})]}),((l==null?void 0:l.email)||(e==null?void 0:e.customerEmail)||(e==null?void 0:e.customer_email))&&s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(Ns,{className:"h-4 w-4 text-muted-foreground"}),s.jsx("span",{children:(l==null?void 0:l.email)||(e==null?void 0:e.customerEmail)||(e==null?void 0:e.customer_email)})]})]}),((l==null?void 0:l.phone)||(l==null?void 0:l.email)||(e==null?void 0:e.customerPhone)||(e==null?void 0:e.customerEmail))&&s.jsxs("div",{className:"flex flex-wrap gap-3 pt-1",children:[((l==null?void 0:l.phone)||(e==null?void 0:e.customerPhone)||(e==null?void 0:e.customer_phone))&&s.jsx(k,{variant:"outline",size:"sm",asChild:!0,className:"min-h-[44px] sm:min-h-0",children:s.jsx("a",{href:`tel:${ds((l==null?void 0:l.phone)||(e==null?void 0:e.customerPhone)||(e==null?void 0:e.customer_phone))}`,children:"Ara"})}),((l==null?void 0:l.email)||(e==null?void 0:e.customerEmail)||(e==null?void 0:e.customer_email))&&s.jsx(k,{variant:"outline",size:"sm",className:"min-h-[44px] sm:min-h-0",onClick:()=>{const t=(l==null?void 0:l.email)||(e==null?void 0:e.customerEmail)||(e==null?void 0:e.customer_email);t&&window.open(`https://mail.google.com/mail/?view=cm&fs=1&to=${encodeURIComponent(t)}`,"_blank")},children:"E-posta Gönder"})]}),(ne||le)&&s.jsxs("div",{className:"space-y-2 rounded-lg border bg-muted/40 p-3 mt-3",children:[s.jsxs("p",{className:"text-sm font-medium text-muted-foreground flex items-center gap-2",children:[s.jsx(_s,{className:"h-4 w-4"}),"Teslimat Bilgileri"]}),ne&&s.jsx("p",{className:"text-sm",children:ne}),le&&s.jsx("p",{className:"text-xs text-muted-foreground",children:le})]})]})]}),s.jsxs(_,{children:[s.jsx(b,{children:s.jsx(v,{className:"text-lg",children:"Sipariş Bilgileri"})}),s.jsxs(w,{className:"space-y-3 sm:space-y-4",children:[s.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4",children:Ze.map(t=>s.jsxs("div",{className:"rounded-lg border bg-muted/30 px-3 py-2",children:[s.jsx("p",{className:"text-xs text-muted-foreground uppercase tracking-wide",children:t.label}),s.jsx("p",{className:"text-sm font-medium mt-1",children:t.value||"-"})]},t.label))}),(e==null?void 0:e.notes)&&s.jsxs("div",{className:"rounded-lg border bg-muted/20 p-3",children:[s.jsxs("p",{className:"text-sm text-muted-foreground mb-1 flex items-center gap-2",children:[s.jsx(bs,{className:"h-4 w-4"}),"İç Not"]}),s.jsx("p",{className:"text-sm leading-relaxed",children:e.notes})]})]})]})]}),s.jsxs(_,{children:[s.jsx(b,{children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs(v,{className:"text-lg sm:text-xl flex items-center gap-2",children:[s.jsx(vs,{className:"h-4 w-4 sm:h-5 sm:w-5"}),"Bağlı Görevler (",j.length,")"]}),s.jsx(k,{variant:"outline",size:"sm",onClick:He,disabled:G,className:"min-h-[44px] sm:min-h-0",children:"Yenile"})]})}),s.jsx(w,{children:s.jsxs("div",{className:"space-y-2",children:[G&&s.jsx("p",{className:"text-sm text-muted-foreground",children:"Görevler yükleniyor..."}),!G&&j.length===0&&s.jsx("p",{className:"text-sm text-muted-foreground",children:"Bu siparişe bağlı görev bulunmuyor."}),!G&&j.map(t=>{const i=ee(t.due_date||t.dueDate);return s.jsx("div",{className:"p-3 rounded-md border border-border bg-muted/30",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-semibold text-foreground",children:t.title||"-"}),i&&s.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["Termin: ",T(i)]})]}),s.jsx(Fe,{variant:t.status==="completed"?"default":"secondary",children:t.status||"-"})]})},t.id)})]})})]})]})})})]})})})};export{Is as O};
