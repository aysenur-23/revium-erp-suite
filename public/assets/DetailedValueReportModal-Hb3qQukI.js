import{r as F,j as e,C as y,c as Y,d as p,e as b,K as $,i as ce,h as ne}from"./index-Xd90qdO9.js";import{D as oe,a as ie,b as ue,c as me,S as xe,P as de,B as z}from"./MainLayout-DW7UjMSA.js";import{T as A,a as M,b as N,c as n,d as V,e as o}from"./table-CHpYTcky.js";import{D as L,c as _}from"./exchangeRateService-Cpnvl6ZU.js";import{C as he}from"./currency-BpxR3_y8.js";import{C as je}from"./chart-column-tcYl_7Fa.js";import{T as U}from"./trending-up-DyiN6Ad2.js";const Ye=({open:I,onOpenChange:G,title:W,type:c,data:x,orders:g=[]})=>{const[i,D]=F.useState(null),[q,C]=F.useState(!0);F.useEffect(()=>{I&&(c==="customers"&&g&&g.length>0||c!=="customers"&&x.length>0)?(C(!0),(async()=>{if(c==="customers"){if(!Array.isArray(g)||g.length===0){D({totalValue:0,totalValueTRY:0,byCategory:[],byCurrency:[],byStatus:[],topItems:[],averageCost:0}),C(!1);return}let t=0,a=0;const T=new Map,m=new Map;for(const l of g){const r=Number(l.totalAmount)||0,w=l.currency||"TRY";let j=r;if(w!=="TRY")try{j=await _(r,w)}catch{j=r}t+=r,a+=j;const v=l.customerId||l.customer_id;if(v){const E=x.find(le=>le.id===v),re=(E==null?void 0:E.name)||"Bilinmeyen Müşteri",k=T.get(v)||{name:re,orderCount:0,totalAmount:0,totalAmountTRY:0};k.orderCount+=1,k.totalAmount+=r,k.totalAmountTRY+=j,T.set(v,k)}const S=m.get(w)||{count:0,value:0,valueTRY:0};S.count+=1,S.value+=r,S.valueTRY+=j,m.set(w,S)}const R=Array.from(T.entries()).map(([l,r])=>({category:r.name,count:r.orderCount,value:r.totalAmount,valueTRY:r.totalAmountTRY})).sort((l,r)=>r.valueTRY-l.valueTRY).slice(0,10),u=Array.from(m.entries()).map(([l,r])=>({currency:l,count:r.count,value:r.value,valueTRY:r.valueTRY})).sort((l,r)=>r.valueTRY-l.valueTRY),h=g.length>0?g.reduce((l,r)=>l+(Number(r.totalAmount)||0),0)/g.length:0;D({totalValue:t,totalValueTRY:a,byCategory:R,byCurrency:u,byStatus:[],topItems:R.map(l=>({name:l.category,value:l.value,valueTRY:l.valueTRY,stock:l.count,cost:h,currency:"TRY",category:"Müşteri"})),averageCost:h}),C(!1);return}if(!Array.isArray(x)||x.length===0){D({totalValue:0,totalValueTRY:0,byCategory:[],byCurrency:[],byStatus:[],topItems:[],averageCost:0}),C(!1);return}let d=0,H=0;const B=new Map,K=new Map,P=new Map,O=[];for(const t of x){let a=0,T=0,m="TRY",R="Diğer",u=0;if(c==="rawMaterials")a=Number(t.currentStock!==void 0?t.currentStock:t.stock)||0,T=Number(t.unitPrice!==void 0?t.unitPrice:t.cost)||0,m=t.currency||"TRY",R=t.category||"Diğer",u=a*T;else if(c==="products")a=Number(t.stock)||0,T=Number(t.price)||0,m=t.currency||"TRY",R=t.category||"Diğer",u=a*T;else if(c==="customers")continue;let h=u;if(m!=="TRY")try{h=await _(u,m)}catch{h=u}d+=u,H+=h;const l=B.get(R)||{count:0,value:0,valueTRY:0};l.count+=1,l.value+=u,l.valueTRY+=h,B.set(R,l);const r=K.get(m)||{count:0,value:0,valueTRY:0};r.count+=1,r.value+=u,r.valueTRY+=h,K.set(m,r);const w=Number(t.minStock!==void 0?t.minStock:t.min_stock)||0;let j="normal";a===0?j="tükenen":a<w&&(j="düşük");const v=P.get(j)||{count:0,value:0,valueTRY:0};v.count+=1,v.value+=u,v.valueTRY+=h,P.set(j,v),O.push({name:t.name||"İsimsiz",value:u,valueTRY:h,stock:a,cost:T,currency:m,category:R})}const Z=Array.from(B.entries()).map(([t,a])=>({category:t,count:a.count,value:a.value,valueTRY:a.valueTRY})).sort((t,a)=>a.valueTRY-t.valueTRY),ee=Array.from(K.entries()).map(([t,a])=>({currency:t,count:a.count,value:a.value,valueTRY:a.valueTRY})).sort((t,a)=>a.valueTRY-t.valueTRY),se=Array.from(P.entries()).map(([t,a])=>({status:t,count:a.count,value:a.value,valueTRY:a.valueTRY})).sort((t,a)=>a.valueTRY-t.valueTRY),te=O.sort((t,a)=>a.valueTRY-t.valueTRY).slice(0,10),ae=x.length>0?x.reduce((t,a)=>t+(Number(a.unitPrice!==void 0?a.unitPrice:a.cost)||0),0)/x.length:0;D({totalValue:d,totalValueTRY:H,byCategory:Z,byCurrency:ee,byStatus:se,topItems:te,averageCost:ae}),C(!1)})()):(D(null),C(!1))},[I,x,g,c]);const f=(s,d="TRY")=>{try{return new Intl.NumberFormat("tr-TR",{style:"currency",currency:d,minimumFractionDigits:2}).format(s)}catch{return`${he[d]||"₺"}${s.toFixed(2)}`}},J=s=>({normal:"Normal Stok",düşük:"Düşük Stok",tükenen:"Tükenen"})[s]||s,Q=s=>s==="normal"?ce:s==="düşük"?$:ne,X=s=>s==="normal"?"bg-green-100 text-green-700":s==="düşük"?"bg-yellow-100 text-yellow-700":"bg-red-100 text-red-700";return e.jsx(oe,{open:I,onOpenChange:G,children:e.jsxs(ie,{className:"max-w-5xl w-[95vw] sm:w-[90vw] max-h-[90vh] flex flex-col p-0 !overflow-hidden",children:[e.jsx(ue,{className:"p-3 sm:p-4 border-b bg-white flex-shrink-0",children:e.jsx(me,{className:"text-lg sm:text-xl font-semibold text-foreground",children:W})}),e.jsx(xe,{className:"flex-1 min-h-0",children:e.jsx("div",{className:"p-3 sm:p-4 space-y-4",children:q?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}):i?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 xs:grid-cols-2 sm:grid-cols-3 gap-3 sm:gap-4",children:[e.jsxs(y,{children:[e.jsx(Y,{className:"pb-3",children:e.jsxs(p,{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(L,{className:"h-4 w-4 text-primary"}),"Toplam Değer (TRY)"]})}),e.jsxs(b,{children:[e.jsx("div",{className:"text-xl sm:text-2xl font-bold break-words",children:f(i.totalValueTRY,"TRY")}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Tüm para birimleri TRY'ye çevrildi"})]})]}),e.jsxs(y,{children:[e.jsx(Y,{className:"pb-3",children:e.jsxs(p,{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(de,{className:"h-4 w-4 text-primary"}),"Ortalama Birim Maliyet"]})}),e.jsxs(b,{children:[e.jsx("div",{className:"text-xl sm:text-2xl font-bold break-words",children:f(i.averageCost,"TRY")}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Tüm hammaddelerin ortalaması"})]})]}),e.jsxs(y,{children:[e.jsx(Y,{className:"pb-3",children:e.jsxs(p,{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(je,{className:"h-4 w-4 text-primary"}),"Toplam Kayıt"]})}),e.jsxs(b,{children:[e.jsx("div",{className:"text-xl sm:text-2xl font-bold",children:x.length}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Toplam hammadde sayısı"})]})]})]}),i.byCategory.length>0&&e.jsxs(y,{children:[e.jsx(Y,{children:e.jsxs(p,{className:"text-lg flex items-center gap-2",children:[e.jsx(U,{className:"h-5 w-5"}),"Kategori Bazında Değer Dağılımı"]})}),e.jsx(b,{children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(A,{children:[e.jsx(M,{children:e.jsxs(N,{children:[e.jsx(n,{children:"Kategori"}),e.jsx(n,{className:"text-right",children:"Kayıt Sayısı"}),e.jsx(n,{className:"text-right",children:"Toplam Değer (TRY)"}),e.jsx(n,{className:"text-right",children:"Oran"})]})}),e.jsx(V,{children:i.byCategory.map(s=>e.jsxs(N,{children:[e.jsx(o,{className:"font-medium",children:s.category}),e.jsx(o,{className:"text-right",children:s.count}),e.jsx(o,{className:"text-right font-semibold",children:f(s.valueTRY,"TRY")}),e.jsx(o,{className:"text-right",children:i.totalValueTRY>0?`${(s.valueTRY/i.totalValueTRY*100).toFixed(1)}%`:"0%"})]},s.category))})]})})})]}),i.byCurrency.length>0&&e.jsxs(y,{children:[e.jsx(Y,{children:e.jsxs(p,{className:"text-base sm:text-lg flex items-center gap-2",children:[e.jsx(L,{className:"h-4 w-4 sm:h-5 sm:w-5"}),"Para Birimi Bazında Değer Dağılımı"]})}),e.jsx(b,{children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(A,{children:[e.jsx(M,{children:e.jsxs(N,{children:[e.jsx(n,{children:"Para Birimi"}),e.jsx(n,{className:"text-right",children:"Kayıt Sayısı"}),e.jsx(n,{className:"text-right",children:"Orijinal Değer"}),e.jsx(n,{className:"text-right",children:"TRY Karşılığı"})]})}),e.jsx(V,{children:i.byCurrency.map(s=>e.jsxs(N,{children:[e.jsx(o,{className:"font-medium",children:e.jsx(z,{variant:"outline",children:s.currency})}),e.jsx(o,{className:"text-right",children:s.count}),e.jsx(o,{className:"text-right",children:f(s.value,s.currency)}),e.jsx(o,{className:"text-right font-semibold",children:f(s.valueTRY,"TRY")})]},s.currency))})]})})})]}),i.byStatus.length>0&&e.jsxs(y,{children:[e.jsx(Y,{children:e.jsxs(p,{className:"text-base sm:text-lg flex items-center gap-2",children:[e.jsx($,{className:"h-4 w-4 sm:h-5 sm:w-5"}),"Stok Durumuna Göre Değer Dağılımı"]})}),e.jsx(b,{children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(A,{children:[e.jsx(M,{children:e.jsxs(N,{children:[e.jsx(n,{children:"Stok Durumu"}),e.jsx(n,{className:"text-right",children:"Kayıt Sayısı"}),e.jsx(n,{className:"text-right",children:"Toplam Değer (TRY)"}),e.jsx(n,{className:"text-right",children:"Oran"})]})}),e.jsx(V,{children:i.byStatus.map(s=>{const d=Q(s.status);return e.jsxs(N,{children:[e.jsx(o,{className:"font-medium",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(d,{className:`h-4 w-4 ${X(s.status).split(" ")[1]}`}),J(s.status)]})}),e.jsx(o,{className:"text-right",children:s.count}),e.jsx(o,{className:"text-right font-semibold",children:f(s.valueTRY,"TRY")}),e.jsx(o,{className:"text-right",children:i.totalValueTRY>0?`${(s.valueTRY/i.totalValueTRY*100).toFixed(1)}%`:"0%"})]},s.status)})})]})})})]}),i.topItems.length>0&&e.jsxs(y,{children:[e.jsx(Y,{children:e.jsxs(p,{className:"text-base sm:text-lg flex items-center gap-2",children:[e.jsx(U,{className:"h-4 w-4 sm:h-5 sm:w-5"}),e.jsxs("span",{className:"break-words",children:[c==="rawMaterials"&&"En Değerli Hammaddeler (Top 10)",c==="products"&&"En Değerli Ürünler (Top 10)",c==="customers"&&"En Değerli Müşteriler (Top 10)"]})]})}),e.jsx(b,{children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(A,{children:[e.jsx(M,{children:e.jsxs(N,{children:[e.jsx(n,{children:c==="customers"?"Müşteri":c==="products"?"Ürün":"Hammadde"}),e.jsx(n,{children:c==="customers"?"Sipariş Sayısı":"Kategori"}),c!=="customers"&&e.jsx(n,{className:"text-right",children:"Stok"}),c!=="customers"&&e.jsxs(n,{className:"text-right",children:["Birim ",c==="products"?"Fiyat":"Maliyet"]}),e.jsx(n,{className:"text-right",children:"Toplam Değer (TRY)"})]})}),e.jsx(V,{children:i.topItems.map((s,d)=>e.jsxs(N,{children:[e.jsx(o,{className:"font-medium",children:s.name}),e.jsx(o,{children:c==="customers"?e.jsx("span",{children:s.stock}):e.jsx(z,{variant:"outline",children:s.category})}),c!=="customers"&&e.jsx(o,{className:"text-right",children:s.stock}),c!=="customers"&&e.jsx(o,{className:"text-right",children:f(s.cost,s.currency)}),e.jsx(o,{className:"text-right font-semibold",children:f(s.valueTRY,"TRY")})]},d))})]})})})]})]}):e.jsx("div",{className:"text-center text-muted-foreground py-12",children:"Veri bulunamadı"})})})]})})};export{Ye as D};
