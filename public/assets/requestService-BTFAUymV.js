var T=Object.defineProperty,D=Object.defineProperties;var E=Object.getOwnPropertyDescriptors;var h=Object.getOwnPropertySymbols;var S=Object.prototype.hasOwnProperty,B=Object.prototype.propertyIsEnumerable;var g=(t,e,a)=>e in t?T(t,e,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[e]=a,l=(t,e)=>{for(var a in e||(e={}))S.call(e,a)&&g(t,a,e[a]);if(h)for(var a of h(e))B.call(e,a)&&g(t,a,e[a]);return t},w=(t,e)=>D(t,E(e));var u=(t,e,a)=>new Promise((o,r)=>{var s=n=>{try{d(a.next(n))}catch(i){r(i)}},c=n=>{try{d(a.throw(n))}catch(i){r(i)}},d=n=>n.done?o(n.value):Promise.resolve(n.value).then(s,c);d((a=a.apply(t,e)).next())});import{D as R,E as p,H as N,T as m,P as O,O as A,J as q,K as C,N as f,Q as j,R as v}from"./index-BQmY0BmM.js";import{F as U}from"./taskService-CI62TrOj.js";const y="requests",Q=t=>u(void 0,null,function*(){try{const e=w(l({},t),{status:"pending",createdAt:q(),updatedAt:q()});Object.keys(e).forEach(o=>{e[o]===void 0&&delete e[o]});const a=yield C(R(p,y),e);return w(l({id:a.id},e),{createdAt:m.now(),updatedAt:m.now()})}catch(e){throw console.error("Create request error:",e),e}}),b=t=>u(void 0,null,function*(){try{const e=R(p,y);let o=(yield N(e)).docs.map(r=>l({id:r.id},r.data()));return t!=null&&t.isSuperAdmin||(o=o.filter(r=>{const s=(t==null?void 0:t.createdBy)&&r.createdBy===t.createdBy,c=(t==null?void 0:t.assignedTo)&&r.assignedTo===t.assignedTo;return s||c})),o.sort((r,s)=>{const c=r.createdAt instanceof m?r.createdAt.toMillis():0;return(s.createdAt instanceof m?s.createdAt.toMillis():0)-c}),o}catch(e){throw console.error("Get requests error:",e),e}}),x=(t,e,a,o)=>u(void 0,null,function*(){try{const r={status:e,approvedBy:a,approvedAt:q(),updatedAt:q()};e==="rejected"&&o&&(r.rejectionReason=o),yield f(A(p,y,t),r);try{const c=(yield j(A(p,y,t))).data();if(c){const d=yield v(a),n=e==="approved"?"Talep Onaylandı":"Talep Reddedildi",i=`"${c.title}" talebiniz ${(d==null?void 0:d.fullName)||"Yönetici"} tarafından ${e==="approved"?"onaylandı":"reddedildi"}.`;yield U({userId:c.createdBy,type:"system",title:n,message:i,read:!1,relatedId:t})}}catch(s){console.error("Notification error:",s)}}catch(r){throw console.error("Update request status error:",r),r}}),z=t=>u(void 0,null,function*(){try{yield O(A(p,y,t))}catch(e){throw console.error("Delete request error:",e),e}});export{Q as c,z as d,b as g,x as u};
