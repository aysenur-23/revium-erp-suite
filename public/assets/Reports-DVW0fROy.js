const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/reportService-yUgxtgcG.js","assets/index-BQmY0BmM.js","assets/lucide-react-CAeuRJQk.js","assets/index-YbdY78QJ.css","assets/storageService-BUAGZT8Z.js","assets/driveService-ChwQKMyd.js"])))=>i.map(i=>d[i]);
var Be=Object.defineProperty,Ye=Object.defineProperties;var $e=Object.getOwnPropertyDescriptors;var ze=Object.getOwnPropertySymbols;var Ge=Object.prototype.hasOwnProperty,Ve=Object.prototype.propertyIsEnumerable;var _e=(P,L,v)=>L in P?Be(P,L,{enumerable:!0,configurable:!0,writable:!0,value:v}):P[L]=v,U=(P,L)=>{for(var v in L||(L={}))Ge.call(L,v)&&_e(P,v,L[v]);if(ze)for(var v of ze(L))Ve.call(L,v)&&_e(P,v,L[v]);return P},q=(P,L)=>Ye(P,$e(L));var O=(P,L,v)=>new Promise((E,R)=>{var x=b=>{try{m(v.next(b))}catch(o){R(o)}},D=b=>{try{m(v.throw(b))}catch(o){R(o)}},m=b=>b.done?E(b.value):Promise.resolve(b.value).then(x,D);m((v=v.apply(P,L)).next())});import{u as ue,a as k,j as e,C as F,p as _,q as M,b as I,L as $,B as T,I as K,T as ke,_ as he,ax as Me,S as Ke,c as He,d as Qe,e as We,f as Le,ay as Xe}from"./index-BQmY0BmM.js";import{r as y,W as ce,h as Te,k as Re,q as pe,o as Se,U as De,al as Ee,i as Je,v as Ze,D as et,af as tt,ae as st,am as at,an as Ue,I as rt,X as it,P as qe,T as nt,Q as Oe}from"./lucide-react-CAeuRJQk.js";import{g as Ce,p as Pe,D as ge,a as fe,b as be,c as ye,e as je,S as Ne,B as xe,w as Ie,l as lt,n as ot,M as ct}from"./MainLayout-Dv9j77B5.js";import{a as dt,b as mt,c as xt,d as ut,e as ht}from"./pdfGenerator-CpYttanq.js";import{T as re,a as ie,b as G,c as w,d as ne,e as S}from"./table-zhTdMUM_.js";import{c as we}from"./exchangeRateService-Ba2gZPdu.js";import{getRawMaterials as pt}from"./materialService-BHW8dEom.js";import{C as gt}from"./CustomerCombobox-LwAUFZox.js";import{D as ft,a as bt,C as oe}from"./currency-BpxR3_y8.js";import"./taskService-CI62TrOj.js";import"./popover-Bq_PZ6uK.js";import"./CreateCustomerDialog-C7Uvoya8.js";const yt=({open:P,onOpenChange:L})=>{const{user:v}=ue(),[E,R]=y.useState(!1),[x,D]=y.useState(""),[m,b]=y.useState(""),[o,i]=y.useState(null),z=t=>{if(t.createdAt instanceof ke)return t.createdAt.toDate();if(t.created_at){const s=new Date(t.created_at);if(!Number.isNaN(s.getTime()))return s}return new Date},Q=t=>{var s,r,d,j;return(j=(d=(r=(s=t.total)!=null?s:t.totalAmount)!=null?r:t.total_amount)!=null?d:t.subtotal)!=null?j:0},X=t=>{var s;return(s=t.quantity)!=null?s:0},V=t=>{var r,d;return typeof t.total=="number"?t.total:((d=(r=t.unit_price)!=null?r:t.unitPrice)!=null?d:0)*X(t)},H=y.useCallback(()=>O(void 0,null,function*(){if(!x||!m){i(null);return}R(!0);try{const s=(yield Ce()).filter(u=>{const n=z(u).toISOString().split("T")[0];return n>=x&&n<=m}),r=s.reduce((u,a)=>u+Q(a),0),d=s.length,j=new Set(s.map(u=>u.customerId).filter(Boolean)).size,l=new Map,f=s.map(u=>O(void 0,null,function*(){try{return yield Pe(u.id)}catch(a){return console.error("Get order items error:",a),[]}}));(yield Promise.all(f)).flat().forEach(u=>{const a=u.product_name||u.productName||"Bilinmeyen";l.has(a)||l.set(a,{name:a,quantity:0,revenue:0});const n=l.get(a);n&&(n.quantity+=X(u),n.revenue+=V(u))});const de=Array.from(l.values()).sort((u,a)=>a.revenue-u.revenue).slice(0,10),B={totalRevenue:r,totalOrders:d,activeCustomers:j,orders:s,topProducts:de,avgOrderValue:d>0?r/d:0};i(B)}catch(t){console.error("Fetch report data error:",t),k.error("Veri yüklenirken hata oluştu")}finally{R(!1)}}),[x,m]);y.useEffect(()=>{if(x&&m){const t=setTimeout(()=>{H()},500);return()=>clearTimeout(t)}},[x,m,H]);const c=()=>O(void 0,null,function*(){if(!x||!m){k.error("Lütfen tarih aralığı seçin");return}if(!o){k.error("Lütfen önce rapor verilerini yükleyin");return}R(!0);try{const t=yield dt(o,x,m),s=URL.createObjectURL(t),r=document.createElement("a");r.href=s;const d=new Date().toISOString().split("T")[0];r.download=`Satis-Raporu-${x}-${m}-${d}.pdf`,document.body.appendChild(r),r.click(),document.body.removeChild(r),setTimeout(()=>URL.revokeObjectURL(s),100),k.success("Rapor indiriliyor..."),R(!1),O(void 0,null,function*(){try{const{saveReport:j}=yield he(()=>O(void 0,null,function*(){const{saveReport:f}=yield import("./reportService-yUgxtgcG.js");return{saveReport:f}}),__vite__mapDeps([0,1,2,3,4,5])),l=`Satış Raporu - ${x} / ${m}`;yield j("sales",l,t,(v==null?void 0:v.id)||"",{startDate:x,endDate:m,metadata:{totalRevenue:o.totalRevenue,totalOrders:o.totalOrders,activeCustomers:o.activeCustomers}}),k.success("Rapor buluta yedeklendi.")}catch(j){console.warn("Rapor buluta kaydedilemedi (CORS/Yetki):",j)}})}catch(t){console.error("Generate sales report error:",t);const s=t instanceof Error?t.message:"Rapor oluşturulamadı";k.error("Hata: "+s),R(!1)}});return e.jsx(ge,{open:P,onOpenChange:L,children:e.jsxs(fe,{className:"w-full max-w-[98vw] md:max-w-6xl max-h-[95vh] flex flex-col p-0 overflow-hidden",children:[e.jsxs(be,{className:"px-4 sm:px-6 pt-4 sm:pt-6 pb-4 border-b bg-gradient-to-r from-primary/5 to-transparent flex-shrink-0",children:[e.jsxs(ye,{className:"text-lg sm:text-xl font-bold flex items-center gap-2",children:[e.jsx("div",{className:"h-8 w-8 rounded-lg bg-primary/10 flex items-center justify-center",children:e.jsx(ce,{className:"h-4 w-4 text-primary"})}),"Satış Raporu Oluştur"]}),e.jsx(je,{className:"text-xs sm:text-sm text-muted-foreground mt-1",children:"Tarih aralığı seçerek detaylı satış raporu oluşturun ve PDF olarak indirin"})]}),e.jsx(Ne,{className:"flex-1 min-h-0",children:e.jsxs("div",{className:"w-full p-4 sm:p-6 space-y-4 sm:space-y-6",children:[e.jsxs(F,{className:"bg-gradient-to-br from-gray-50/50 to-white border-2",children:[e.jsx(_,{className:"pb-3",children:e.jsx(M,{className:"text-sm font-semibold text-muted-foreground",children:"Tarih Aralığı Seçimi"})}),e.jsxs(I,{children:[e.jsxs("div",{className:"mb-4",children:[e.jsx($,{className:"text-xs font-medium text-muted-foreground mb-2 block",children:"Hızlı Seçim"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs(T,{type:"button",variant:"outline",size:"sm",onClick:()=>{const t=new Date,s=new Date(t);s.setDate(t.getDate()-7),D(s.toISOString().split("T")[0]),b(t.toISOString().split("T")[0])},className:"text-xs",children:[e.jsx(Te,{className:"h-3 w-3 mr-1"}),"Son 7 Gün"]}),e.jsxs(T,{type:"button",variant:"outline",size:"sm",onClick:()=>{const t=new Date,s=new Date(t);s.setDate(t.getDate()-30),D(s.toISOString().split("T")[0]),b(t.toISOString().split("T")[0])},className:"text-xs",children:[e.jsx(Re,{className:"h-3 w-3 mr-1"}),"Son 30 Gün"]}),e.jsx(T,{type:"button",variant:"outline",size:"sm",onClick:()=>{const t=new Date,s=new Date(t.getFullYear(),t.getMonth(),1);D(s.toISOString().split("T")[0]),b(t.toISOString().split("T")[0])},className:"text-xs",children:"Bu Ay"}),e.jsx(T,{type:"button",variant:"outline",size:"sm",onClick:()=>{const t=new Date,s=new Date(t.getFullYear(),t.getMonth()-1,1),r=new Date(t.getFullYear(),t.getMonth(),0);D(s.toISOString().split("T")[0]),b(r.toISOString().split("T")[0])},className:"text-xs",children:"Geçen Ay"}),e.jsx(T,{type:"button",variant:"outline",size:"sm",onClick:()=>{const t=new Date,s=new Date(t.getFullYear(),0,1);D(s.toISOString().split("T")[0]),b(t.toISOString().split("T")[0])},className:"text-xs",children:"Bu Yıl"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx($,{className:"text-sm font-medium",children:"Başlangıç Tarihi"}),e.jsx(K,{type:"date",value:x,onChange:t=>D(t.target.value),className:"border-2 focus:border-primary"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx($,{className:"text-sm font-medium",children:"Bitiş Tarihi"}),e.jsx(K,{type:"date",value:m,onChange:t=>b(t.target.value),className:"border-2 focus:border-primary"})]})]})]})]}),o&&e.jsxs("div",{className:"space-y-6 border-t pt-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"text-lg font-bold flex items-center gap-2",children:[e.jsx("div",{className:"h-2 w-2 rounded-full bg-primary"}),"Rapor Önizlemesi"]}),e.jsxs(xe,{variant:"outline",className:"text-xs",children:[x," - ",m]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs(F,{className:"bg-gradient-to-br from-primary/10 via-white to-white border-primary/20 hover:shadow-lg transition-all duration-300",children:[e.jsx(_,{className:"pb-3",children:e.jsxs(M,{className:"text-sm font-semibold text-muted-foreground flex items-center gap-2",children:[e.jsx(pe,{className:"h-4 w-4 text-primary"}),"Toplam Gelir"]})}),e.jsxs(I,{children:[e.jsxs("p",{className:"text-3xl font-bold text-primary",children:["₺",o.totalRevenue.toLocaleString("tr-TR",{minimumFractionDigits:2,maximumFractionDigits:2})]}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["Ortalama: ₺",o.avgOrderValue.toLocaleString("tr-TR",{minimumFractionDigits:2,maximumFractionDigits:2})]})]})]}),e.jsxs(F,{className:"bg-gradient-to-br from-blue-50 via-white to-white border-blue-200 hover:shadow-lg transition-all duration-300",children:[e.jsx(_,{className:"pb-3",children:e.jsxs(M,{className:"text-sm font-semibold text-muted-foreground flex items-center gap-2",children:[e.jsx(Se,{className:"h-4 w-4 text-blue-500"}),"Toplam Sipariş"]})}),e.jsxs(I,{children:[e.jsx("p",{className:"text-3xl font-bold text-blue-600",children:o.totalOrders}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Tarih aralığında"})]})]}),e.jsxs(F,{className:"bg-gradient-to-br from-green-50 via-white to-white border-green-200 hover:shadow-lg transition-all duration-300",children:[e.jsx(_,{className:"pb-3",children:e.jsxs(M,{className:"text-sm font-semibold text-muted-foreground flex items-center gap-2",children:[e.jsx(De,{className:"h-4 w-4 text-green-500"}),"Aktif Müşteri"]})}),e.jsxs(I,{children:[e.jsx("p",{className:"text-3xl font-bold text-green-600",children:o.activeCustomers}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Sipariş veren müşteri"})]})]})]}),e.jsxs(F,{className:"border-2 shadow-sm",children:[e.jsx(_,{className:"bg-gradient-to-r from-gray-50 to-white border-b",children:e.jsxs(M,{className:"text-lg font-bold flex items-center gap-2",children:[e.jsx("div",{className:"h-1 w-1 rounded-full bg-primary"}),"Sipariş Durumu Dağılımı"]})}),e.jsx(I,{className:"p-0",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(re,{children:[e.jsx(ie,{children:e.jsxs(G,{className:"bg-gray-50/50",children:[e.jsx(w,{className:"font-semibold",children:"Durum"}),e.jsx(w,{className:"text-right font-semibold",children:"Sipariş Sayısı"}),e.jsx(w,{className:"text-right font-semibold",children:"Toplam Tutar"}),e.jsx(w,{className:"text-right font-semibold",children:"Oran"})]})}),e.jsx(ne,{children:(()=>{const t=new Map;o.orders.forEach(d=>{const j=d.status||"Bilinmeyen",l=Q(d);t.has(j)||t.set(j,{count:0,total:0});const f=t.get(j);f.count+=1,f.total+=l});const s={draft:"Taslak",pending:"Beklemede",confirmed:"Onaylandı",in_production:"Üretimde",completed:"Tamamlandı",shipped:"Kargoda",delivered:"Teslim Edildi",cancelled:"İptal"},r=o.orders.length;return Array.from(t.entries()).sort((d,j)=>j[1].count-d[1].count).map(([d,j])=>e.jsxs(G,{className:"hover:bg-gray-50/50 transition-colors",children:[e.jsx(S,{className:"font-medium",children:s[d]||d}),e.jsx(S,{className:"text-right font-semibold",children:j.count}),e.jsxs(S,{className:"text-right font-semibold text-primary",children:["₺",j.total.toLocaleString("tr-TR",{minimumFractionDigits:2,maximumFractionDigits:2})]}),e.jsxs(S,{className:"text-right font-semibold text-muted-foreground",children:[r>0?(j.count/r*100).toFixed(1):0,"%"]})]},d))})()})]})})})]}),e.jsxs(F,{className:"border-2 shadow-sm",children:[e.jsx(_,{className:"bg-gradient-to-r from-gray-50 to-white border-b",children:e.jsxs(M,{className:"text-lg font-bold flex items-center gap-2",children:[e.jsx("div",{className:"h-1 w-1 rounded-full bg-primary"}),"En Çok Satan Ürünler"]})}),e.jsx(I,{className:"p-0",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(re,{children:[e.jsx(ie,{children:e.jsxs(G,{className:"bg-gray-50/50",children:[e.jsx(w,{className:"font-semibold",children:"Sıra"}),e.jsx(w,{className:"font-semibold",children:"Ürün Adı"}),e.jsx(w,{className:"text-right font-semibold",children:"Adet"}),e.jsx(w,{className:"text-right font-semibold",children:"Gelir"})]})}),e.jsx(ne,{children:o.topProducts.slice(0,10).map((t,s)=>e.jsxs(G,{className:"hover:bg-gray-50/50 transition-colors",children:[e.jsxs(S,{className:"font-medium text-muted-foreground",children:["#",s+1]}),e.jsx(S,{className:"font-medium",children:t.name}),e.jsx(S,{className:"text-right font-semibold",children:t.quantity}),e.jsxs(S,{className:"text-right font-semibold text-primary",children:["₺",t.revenue.toLocaleString("tr-TR",{minimumFractionDigits:2,maximumFractionDigits:2})]})]},s))})]})})})]})]}),E&&!o&&e.jsx(F,{className:"border-2 border-dashed",children:e.jsx(I,{className:"py-12",children:e.jsxs("div",{className:"flex flex-col items-center justify-center gap-3",children:[e.jsx("div",{className:"h-8 w-8 border-4 border-primary border-t-transparent rounded-full animate-spin"}),e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Veriler yükleniyor..."})]})})}),e.jsx("div",{className:"flex gap-3 pt-2",children:e.jsxs(T,{onClick:c,disabled:E||!o,size:"lg",className:"flex-1 bg-gradient-to-r from-primary to-primary/90 hover:from-primary/90 hover:to-primary shadow-lg",children:[e.jsx(ce,{className:"mr-2 h-4 w-4"}),E?"PDF Oluşturuluyor...":o?"PDF İndir":"Tarih Aralığı Seçin"]})})]})})]})})},jt=({open:P,onOpenChange:L})=>{const{user:v}=ue(),[E,R]=y.useState(!1),[x,D]=y.useState(""),[m,b]=y.useState(""),[o,i]=y.useState(null),z={planned:"Planlandı",in_production:"Üretimde",quality_check:"Kalite Kontrol",completed:"Tamamlandı",on_hold:"Beklemede"},Q=t=>{if(t.createdAt instanceof ke)return t.createdAt.toDate();if(t.created_at){const s=new Date(t.created_at);if(!Number.isNaN(s.getTime()))return s}return new Date},X=t=>typeof t.quantity=="number"?t.quantity:t.itemsCount?t.itemsCount:t.totalQuantity?t.totalQuantity:0,V=t=>t&&["planned","in_production","quality_check","completed","on_hold"].includes(t)?t:null,H=y.useCallback(()=>O(void 0,null,function*(){if(!x||!m){i(null);return}R(!0);try{const s=(yield Ce()).filter(B=>{const a=Q(B).toISOString().split("T")[0];return a>=x&&a<=m}),r=(s==null?void 0:s.length)||0,d=(s==null?void 0:s.filter(B=>B.status==="completed").length)||0,j=r>0?d/r*100:0,l={planned:0,in_production:0,quality_check:0,completed:0,on_hold:0};s==null||s.forEach(B=>{const u=V(B.status);u&&(l[u]+=1)});const f=new Map;s==null||s.forEach(B=>{const u=B.product_name||B.customerName||"Bilinmeyen";f.has(u)||f.set(u,{name:u,quantity:0,orders:0});const a=f.get(u);a&&(a.quantity+=X(B),a.orders+=1)});const W=Array.from(f.values()).sort((B,u)=>u.quantity-B.quantity).slice(0,10);i({totalOrders:r,completed:d,completionRate:j,statusDistribution:l,topProducts:W})}catch(t){console.error("Fetch report data error:",t),k.error("Veri yüklenirken hata oluştu")}finally{R(!1)}}),[x,m]);y.useEffect(()=>{if(x&&m){const t=setTimeout(()=>{H()},500);return()=>clearTimeout(t)}},[x,m,H]);const c=()=>O(void 0,null,function*(){if(!x||!m){k.error("Lütfen tarih aralığı seçin");return}if(!o){k.error("Lütfen önce rapor verilerini yükleyin");return}R(!0);try{const t=yield mt(o,x,m),s=URL.createObjectURL(t),r=document.createElement("a");r.href=s;const d=new Date().toISOString().split("T")[0];r.download=`Uretim-Raporu-${x}-${m}-${d}.pdf`,document.body.appendChild(r),r.click(),document.body.removeChild(r),setTimeout(()=>URL.revokeObjectURL(s),100),k.success("Rapor indiriliyor..."),R(!1),O(void 0,null,function*(){try{const{saveReport:j}=yield he(()=>O(void 0,null,function*(){const{saveReport:f}=yield import("./reportService-yUgxtgcG.js");return{saveReport:f}}),__vite__mapDeps([0,1,2,3,4,5])),l=`Üretim Raporu - ${x} / ${m}`;yield j("production",l,t,(v==null?void 0:v.id)||"",{startDate:x,endDate:m,metadata:{totalOrders:o.totalOrders,statusDistribution:o.statusDistribution}}),k.success("Rapor buluta yedeklendi.")}catch(j){console.warn("Rapor buluta kaydedilemedi (CORS/Yetki):",j)}})}catch(t){const s=t instanceof Error?t.message:"Bilinmeyen hata";k.error("Hata: "+s)}finally{R(!1)}});return e.jsx(ge,{open:P,onOpenChange:L,children:e.jsxs(fe,{className:"w-full max-w-[98vw] md:max-w-6xl max-h-[95vh] flex flex-col p-0 overflow-hidden",children:[e.jsxs(be,{className:"px-4 sm:px-6 pt-4 sm:pt-6 pb-4 border-b bg-gradient-to-r from-blue-500/5 to-transparent flex-shrink-0",children:[e.jsxs(ye,{className:"text-lg sm:text-xl font-bold flex items-center gap-2",children:[e.jsx("div",{className:"h-8 w-8 rounded-lg bg-blue-500/10 flex items-center justify-center",children:e.jsx(Ee,{className:"h-4 w-4 text-blue-600"})}),"Üretim Raporu Oluştur"]}),e.jsx(je,{className:"text-xs sm:text-sm text-muted-foreground mt-1",children:"Tarih aralığı seçerek detaylı üretim raporu oluşturun ve PDF olarak indirin"})]}),e.jsx(Ne,{className:"flex-1 min-h-0",children:e.jsxs("div",{className:"w-full p-4 sm:p-6 space-y-4 sm:space-y-6",children:[e.jsxs(F,{className:"bg-gradient-to-br from-gray-50/50 to-white border-2",children:[e.jsx(_,{className:"pb-3",children:e.jsx(M,{className:"text-sm font-semibold text-muted-foreground",children:"Tarih Aralığı Seçimi"})}),e.jsxs(I,{children:[e.jsxs("div",{className:"mb-4",children:[e.jsx($,{className:"text-xs font-medium text-muted-foreground mb-2 block",children:"Hızlı Seçim"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs(T,{type:"button",variant:"outline",size:"sm",onClick:()=>{const t=new Date,s=new Date(t);s.setDate(t.getDate()-7),D(s.toISOString().split("T")[0]),b(t.toISOString().split("T")[0])},className:"text-xs",children:[e.jsx(Te,{className:"h-3 w-3 mr-1"}),"Son 7 Gün"]}),e.jsxs(T,{type:"button",variant:"outline",size:"sm",onClick:()=>{const t=new Date,s=new Date(t);s.setDate(t.getDate()-30),D(s.toISOString().split("T")[0]),b(t.toISOString().split("T")[0])},className:"text-xs",children:[e.jsx(Re,{className:"h-3 w-3 mr-1"}),"Son 30 Gün"]}),e.jsx(T,{type:"button",variant:"outline",size:"sm",onClick:()=>{const t=new Date,s=new Date(t.getFullYear(),t.getMonth(),1);D(s.toISOString().split("T")[0]),b(t.toISOString().split("T")[0])},className:"text-xs",children:"Bu Ay"}),e.jsx(T,{type:"button",variant:"outline",size:"sm",onClick:()=>{const t=new Date,s=new Date(t.getFullYear(),t.getMonth()-1,1),r=new Date(t.getFullYear(),t.getMonth(),0);D(s.toISOString().split("T")[0]),b(r.toISOString().split("T")[0])},className:"text-xs",children:"Geçen Ay"}),e.jsx(T,{type:"button",variant:"outline",size:"sm",onClick:()=>{const t=new Date,s=new Date(t.getFullYear(),0,1);D(s.toISOString().split("T")[0]),b(t.toISOString().split("T")[0])},className:"text-xs",children:"Bu Yıl"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx($,{className:"text-sm font-medium",children:"Başlangıç Tarihi"}),e.jsx(K,{type:"date",value:x,onChange:t=>D(t.target.value),className:"border-2 focus:border-primary"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx($,{className:"text-sm font-medium",children:"Bitiş Tarihi"}),e.jsx(K,{type:"date",value:m,onChange:t=>b(t.target.value),className:"border-2 focus:border-primary"})]})]})]})]}),E&&!o&&e.jsx(F,{className:"border-2 border-dashed",children:e.jsx(I,{className:"py-12",children:e.jsxs("div",{className:"flex flex-col items-center justify-center gap-3",children:[e.jsx("div",{className:"h-8 w-8 border-4 border-primary border-t-transparent rounded-full animate-spin"}),e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Veriler yükleniyor..."})]})})}),o&&e.jsxs("div",{className:"space-y-6 border-t pt-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"text-lg font-bold flex items-center gap-2",children:[e.jsx("div",{className:"h-2 w-2 rounded-full bg-primary"}),"Rapor Önizlemesi"]}),e.jsxs(xe,{variant:"outline",className:"text-xs",children:[x," - ",m]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs(F,{className:"bg-gradient-to-br from-blue-50 via-white to-white border-blue-200 hover:shadow-lg transition-all duration-300",children:[e.jsx(_,{className:"pb-3",children:e.jsxs(M,{className:"text-sm font-semibold text-muted-foreground flex items-center gap-2",children:[e.jsx(Ee,{className:"h-4 w-4 text-blue-500"}),"Toplam Sipariş"]})}),e.jsxs(I,{children:[e.jsx("p",{className:"text-3xl font-bold text-blue-600",children:o.totalOrders}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Tarih aralığında"})]})]}),e.jsxs(F,{className:"bg-gradient-to-br from-green-50 via-white to-white border-green-200 hover:shadow-lg transition-all duration-300",children:[e.jsx(_,{className:"pb-3",children:e.jsxs(M,{className:"text-sm font-semibold text-muted-foreground flex items-center gap-2",children:[e.jsx(Je,{className:"h-4 w-4 text-green-500"}),"Tamamlanan"]})}),e.jsxs(I,{children:[e.jsx("p",{className:"text-3xl font-bold text-green-600",children:o.completed}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Başarıyla tamamlandı"})]})]}),e.jsxs(F,{className:"bg-gradient-to-br from-primary/10 via-white to-white border-primary/20 hover:shadow-lg transition-all duration-300",children:[e.jsx(_,{className:"pb-3",children:e.jsxs(M,{className:"text-sm font-semibold text-muted-foreground flex items-center gap-2",children:[e.jsx(pe,{className:"h-4 w-4 text-primary"}),"Tamamlanma Oranı"]})}),e.jsxs(I,{children:[e.jsxs("p",{className:"text-3xl font-bold text-primary",children:[o.completionRate.toFixed(1),"%"]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Başarı oranı"})]})]})]}),e.jsxs(F,{className:"border-2 shadow-sm",children:[e.jsx(_,{className:"bg-gradient-to-r from-gray-50 to-white border-b",children:e.jsxs(M,{className:"text-lg font-bold flex items-center gap-2",children:[e.jsx("div",{className:"h-1 w-1 rounded-full bg-primary"}),"Durum Dağılımı"]})}),e.jsx(I,{className:"p-0",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(re,{children:[e.jsx(ie,{children:e.jsxs(G,{className:"bg-gray-50/50",children:[e.jsx(w,{className:"font-semibold",children:"Durum"}),e.jsx(w,{className:"text-right font-semibold",children:"Sipariş Sayısı"}),e.jsx(w,{className:"text-right font-semibold",children:"Oran"})]})}),e.jsx(ne,{children:Object.entries(o.statusDistribution).filter(([t,s])=>s>0).sort((t,s)=>s[1]-t[1]).map(([t,s])=>{const r=o.totalOrders>0?(s/o.totalOrders*100).toFixed(1):"0";return e.jsxs(G,{className:"hover:bg-gray-50/50 transition-colors",children:[e.jsx(S,{className:"font-medium",children:z[t]}),e.jsx(S,{className:"text-right font-semibold",children:s}),e.jsxs(S,{className:"text-right font-semibold text-muted-foreground",children:[r,"%"]})]},t)})})]})})})]}),e.jsxs(F,{className:"border-2 shadow-sm",children:[e.jsx(_,{className:"bg-gradient-to-r from-gray-50 to-white border-b",children:e.jsxs(M,{className:"text-lg font-bold flex items-center gap-2",children:[e.jsx("div",{className:"h-1 w-1 rounded-full bg-primary"}),"En Çok Üretilen Ürünler"]})}),e.jsx(I,{className:"p-0",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(re,{children:[e.jsx(ie,{children:e.jsxs(G,{className:"bg-gray-50/50",children:[e.jsx(w,{className:"font-semibold",children:"Sıra"}),e.jsx(w,{className:"font-semibold",children:"Ürün Adı"}),e.jsx(w,{className:"text-right font-semibold",children:"Miktar"}),e.jsx(w,{className:"text-right font-semibold",children:"Sipariş Sayısı"})]})}),e.jsx(ne,{children:o.topProducts.slice(0,10).map((t,s)=>e.jsxs(G,{className:"hover:bg-gray-50/50 transition-colors",children:[e.jsxs(S,{className:"font-medium text-muted-foreground",children:["#",s+1]}),e.jsx(S,{className:"font-medium",children:t.name}),e.jsx(S,{className:"text-right font-semibold",children:t.quantity}),e.jsx(S,{className:"text-right font-semibold text-primary",children:t.orders})]},s))})]})})})]})]}),e.jsx("div",{className:"flex gap-3 pt-2",children:e.jsxs(T,{onClick:c,disabled:E||!o,size:"lg",className:"flex-1 bg-gradient-to-r from-primary to-primary/90 hover:from-primary/90 hover:to-primary shadow-lg",children:[e.jsx(ce,{className:"mr-2 h-4 w-4"}),E?"PDF Oluşturuluyor...":o?"PDF İndir":"Tarih Aralığı Seçin"]})})]})})]})})},Nt=({open:P,onOpenChange:L})=>{const{user:v}=ue(),[E,R]=y.useState(!1),[x,D]=y.useState(""),[m,b]=y.useState(""),[o,i]=y.useState(null),z=c=>{if(c.createdAt instanceof ke)return c.createdAt.toDate();if(c.created_at){const t=new Date(c.created_at);if(!Number.isNaN(t.getTime()))return t}return new Date},Q=(c,t,s)=>{const r=typeof c=="string"?c:c.toISOString().split("T")[0];return r>=t&&r<=s},X=c=>{var t,s,r,d;return(d=(r=(s=(t=c.total)!=null?t:c.totalAmount)!=null?s:c.total_amount)!=null?r:c.subtotal)!=null?d:0},V=y.useCallback(()=>O(void 0,null,function*(){if(!x||!m){i(null);return}R(!0);try{const[c,t]=yield Promise.all([Ie(),Ce()]),s=t.filter(u=>{const n=z(u).toISOString().split("T")[0];return n>=x&&n<=m}),r=c.map(u=>{const a=s.filter(n=>n.customerId===u.id||n.customer_id===u.id);return q(U({},u),{orders:a})}),d=(r==null?void 0:r.length)||0,j=(r==null?void 0:r.filter(u=>{if(!u.createdAt)return!1;const a=u.createdAt.toDate().toISOString().split("T")[0];return a>=x&&a<=m}).length)||0,l=(r==null?void 0:r.filter(u=>{var a;return(a=u.orders)==null?void 0:a.some(n=>{const h=n.order_date||n.created_at||z(n).toISOString().split("T")[0];return Q(h,x,m)})}).length)||0,f=(r==null?void 0:r.map(u=>{var h,p,g;const a=((h=u.orders)==null?void 0:h.filter(Y=>{const J=Y.order_date||Y.created_at||z(Y).toISOString().split("T")[0];return Q(J,x,m)}))||[],n=a.reduce((Y,J)=>Y+X(J),0);return{name:(g=(p=u.name)!=null?p:u.company)!=null?g:"Bilinmeyen",orders:a.length,total:n}}))||[],W=f.filter(u=>u.orders>0).sort((u,a)=>a.total-u.total).slice(0,10),de={high:f.filter(u=>u.total>5e4).length,medium:f.filter(u=>u.total>=1e4&&u.total<=5e4).length,low:f.filter(u=>u.total<1e4&&u.total>0).length};i({totalCustomers:d,activeCustomers:l,newCustomers:j,topCustomers:W,segments:de})}catch(c){console.error("Fetch report data error:",c),k.error("Veri yüklenirken hata oluştu")}finally{R(!1)}}),[x,m]);y.useEffect(()=>{if(x&&m){const c=setTimeout(()=>{V()},500);return()=>clearTimeout(c)}},[x,m,V]);const H=()=>O(void 0,null,function*(){if(!x||!m){k.error("Lütfen tarih aralığı seçin");return}if(!o){k.error("Lütfen önce rapor verilerini yükleyin");return}R(!0);try{const c=yield xt(o,x,m),t=URL.createObjectURL(c),s=document.createElement("a");s.href=t;const r=new Date().toISOString().split("T")[0];s.download=`Musteri-Raporu-${x}-${m}-${r}.pdf`,document.body.appendChild(s),s.click(),document.body.removeChild(s),setTimeout(()=>URL.revokeObjectURL(t),100),k.success("Rapor indiriliyor..."),R(!1),O(void 0,null,function*(){try{const{saveReport:d}=yield he(()=>O(void 0,null,function*(){const{saveReport:l}=yield import("./reportService-yUgxtgcG.js");return{saveReport:l}}),__vite__mapDeps([0,1,2,3,4,5])),j=`Müşteri Raporu - ${x} / ${m}`;yield d("customer",j,c,(v==null?void 0:v.id)||"",{startDate:x,endDate:m,metadata:{totalCustomers:o.totalCustomers,activeCustomers:o.activeCustomers}}),k.success("Rapor buluta yedeklendi.")}catch(d){console.warn("Rapor buluta kaydedilemedi (CORS/Yetki):",d)}})}catch(c){const t=c instanceof Error?c.message:"Bilinmeyen hata";k.error("Hata: "+t),R(!1)}});return e.jsx(ge,{open:P,onOpenChange:L,children:e.jsxs(fe,{className:"w-full max-w-[98vw] md:max-w-6xl max-h-[95vh] flex flex-col p-0 overflow-hidden",children:[e.jsxs(be,{className:"px-4 sm:px-6 pt-4 sm:pt-6 pb-4 border-b bg-gradient-to-r from-purple-500/5 to-transparent flex-shrink-0",children:[e.jsxs(ye,{className:"text-lg sm:text-xl font-bold flex items-center gap-2",children:[e.jsx("div",{className:"h-8 w-8 rounded-lg bg-purple-500/10 flex items-center justify-center",children:e.jsx(De,{className:"h-4 w-4 text-purple-600"})}),"Müşteri Raporu Oluştur"]}),e.jsx(je,{className:"text-xs sm:text-sm text-muted-foreground mt-1",children:"Tarih aralığı seçerek detaylı müşteri raporu oluşturun ve PDF olarak indirin"})]}),e.jsx(Ne,{className:"flex-1 min-h-0",children:e.jsxs("div",{className:"w-full p-4 sm:p-6 space-y-4 sm:space-y-6",children:[e.jsxs(F,{className:"bg-gradient-to-br from-gray-50/50 to-white border-2",children:[e.jsx(_,{className:"pb-3",children:e.jsx(M,{className:"text-sm font-semibold text-muted-foreground",children:"Tarih Aralığı Seçimi"})}),e.jsxs(I,{children:[e.jsxs("div",{className:"mb-4",children:[e.jsx($,{className:"text-xs font-medium text-muted-foreground mb-2 block",children:"Hızlı Seçim"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs(T,{type:"button",variant:"outline",size:"sm",onClick:()=>{const c=new Date,t=new Date(c);t.setDate(c.getDate()-7),D(t.toISOString().split("T")[0]),b(c.toISOString().split("T")[0])},className:"text-xs",children:[e.jsx(Te,{className:"h-3 w-3 mr-1"}),"Son 7 Gün"]}),e.jsxs(T,{type:"button",variant:"outline",size:"sm",onClick:()=>{const c=new Date,t=new Date(c);t.setDate(c.getDate()-30),D(t.toISOString().split("T")[0]),b(c.toISOString().split("T")[0])},className:"text-xs",children:[e.jsx(Re,{className:"h-3 w-3 mr-1"}),"Son 30 Gün"]}),e.jsx(T,{type:"button",variant:"outline",size:"sm",onClick:()=>{const c=new Date,t=new Date(c.getFullYear(),c.getMonth(),1);D(t.toISOString().split("T")[0]),b(c.toISOString().split("T")[0])},className:"text-xs",children:"Bu Ay"}),e.jsx(T,{type:"button",variant:"outline",size:"sm",onClick:()=>{const c=new Date,t=new Date(c.getFullYear(),c.getMonth()-1,1),s=new Date(c.getFullYear(),c.getMonth(),0);D(t.toISOString().split("T")[0]),b(s.toISOString().split("T")[0])},className:"text-xs",children:"Geçen Ay"}),e.jsx(T,{type:"button",variant:"outline",size:"sm",onClick:()=>{const c=new Date,t=new Date(c.getFullYear(),0,1);D(t.toISOString().split("T")[0]),b(c.toISOString().split("T")[0])},className:"text-xs",children:"Bu Yıl"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx($,{className:"text-sm font-medium",children:"Başlangıç Tarihi"}),e.jsx(K,{type:"date",value:x,onChange:c=>D(c.target.value),className:"border-2 focus:border-primary"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx($,{className:"text-sm font-medium",children:"Bitiş Tarihi"}),e.jsx(K,{type:"date",value:m,onChange:c=>b(c.target.value),className:"border-2 focus:border-primary"})]})]})]})]}),E&&!o&&e.jsx(F,{className:"border-2 border-dashed",children:e.jsx(I,{className:"py-12",children:e.jsxs("div",{className:"flex flex-col items-center justify-center gap-3",children:[e.jsx("div",{className:"h-8 w-8 border-4 border-primary border-t-transparent rounded-full animate-spin"}),e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Veriler yükleniyor..."})]})})}),o&&e.jsxs("div",{className:"space-y-6 border-t pt-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"text-lg font-bold flex items-center gap-2",children:[e.jsx("div",{className:"h-2 w-2 rounded-full bg-primary"}),"Rapor Önizlemesi"]}),e.jsxs(xe,{variant:"outline",className:"text-xs",children:[x," - ",m]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs(F,{className:"bg-gradient-to-br from-purple-50 via-white to-white border-purple-200 hover:shadow-lg transition-all duration-300",children:[e.jsx(_,{className:"pb-3",children:e.jsxs(M,{className:"text-sm font-semibold text-muted-foreground flex items-center gap-2",children:[e.jsx(De,{className:"h-4 w-4 text-purple-500"}),"Toplam Müşteri"]})}),e.jsxs(I,{children:[e.jsx("p",{className:"text-3xl font-bold text-purple-600",children:o.totalCustomers}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Tüm müşteriler"})]})]}),e.jsxs(F,{className:"bg-gradient-to-br from-green-50 via-white to-white border-green-200 hover:shadow-lg transition-all duration-300",children:[e.jsx(_,{className:"pb-3",children:e.jsxs(M,{className:"text-sm font-semibold text-muted-foreground flex items-center gap-2",children:[e.jsx(pe,{className:"h-4 w-4 text-green-500"}),"Aktif Müşteri"]})}),e.jsxs(I,{children:[e.jsx("p",{className:"text-3xl font-bold text-green-600",children:o.activeCustomers}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Sipariş veren müşteri"})]})]}),e.jsxs(F,{className:"bg-gradient-to-br from-blue-50 via-white to-white border-blue-200 hover:shadow-lg transition-all duration-300",children:[e.jsx(_,{className:"pb-3",children:e.jsxs(M,{className:"text-sm font-semibold text-muted-foreground flex items-center gap-2",children:[e.jsx(Ze,{className:"h-4 w-4 text-blue-500"}),"Yeni Müşteri"]})}),e.jsxs(I,{children:[e.jsx("p",{className:"text-3xl font-bold text-blue-600",children:o.newCustomers}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Tarih aralığında"})]})]})]}),e.jsxs(F,{className:"border-2 shadow-sm",children:[e.jsx(_,{className:"bg-gradient-to-r from-gray-50 to-white border-b",children:e.jsxs(M,{className:"text-lg font-bold flex items-center gap-2",children:[e.jsx("div",{className:"h-1 w-1 rounded-full bg-primary"}),"Müşteri Segmentasyonu"]})}),e.jsx(I,{className:"p-0",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(re,{children:[e.jsx(ie,{children:e.jsxs(G,{className:"bg-gray-50/50",children:[e.jsx(w,{className:"font-semibold",children:"Segment"}),e.jsx(w,{className:"text-right font-semibold",children:"Müşteri Sayısı"}),e.jsx(w,{className:"text-right font-semibold",children:"Oran"})]})}),e.jsx(ne,{children:(()=>{const c=o.segments.high+o.segments.medium+o.segments.low;return[{label:"Yüksek Değerli (>₺50K)",value:o.segments.high},{label:"Orta Değerli (₺10K-₺50K)",value:o.segments.medium},{label:"Düşük Değerli (<₺10K)",value:o.segments.low}].map((s,r)=>{const d=c>0?(s.value/c*100).toFixed(1):"0";return e.jsxs(G,{className:"hover:bg-gray-50/50 transition-colors",children:[e.jsx(S,{className:"font-medium",children:s.label}),e.jsx(S,{className:"text-right font-semibold",children:s.value}),e.jsxs(S,{className:"text-right font-semibold text-muted-foreground",children:[d,"%"]})]},r)})})()})]})})})]}),e.jsxs(F,{className:"border-2 shadow-sm",children:[e.jsx(_,{className:"bg-gradient-to-r from-gray-50 to-white border-b",children:e.jsxs(M,{className:"text-lg font-bold flex items-center gap-2",children:[e.jsx("div",{className:"h-1 w-1 rounded-full bg-primary"}),"En Değerli Müşteriler"]})}),e.jsx(I,{className:"p-0",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(re,{children:[e.jsx(ie,{children:e.jsxs(G,{className:"bg-gray-50/50",children:[e.jsx(w,{className:"font-semibold",children:"Sıra"}),e.jsx(w,{className:"font-semibold",children:"Müşteri"}),e.jsx(w,{className:"text-right font-semibold",children:"Sipariş Sayısı"}),e.jsx(w,{className:"text-right font-semibold",children:"Toplam Harcama"})]})}),e.jsx(ne,{children:o.topCustomers.slice(0,10).map((c,t)=>e.jsxs(G,{className:"hover:bg-gray-50/50 transition-colors",children:[e.jsxs(S,{className:"font-medium text-muted-foreground",children:["#",t+1]}),e.jsx(S,{className:"font-medium",children:c.name}),e.jsx(S,{className:"text-right font-semibold",children:c.orders}),e.jsxs(S,{className:"text-right font-semibold text-primary",children:["₺",c.total.toLocaleString("tr-TR",{minimumFractionDigits:2,maximumFractionDigits:2})]})]},t))})]})})})]})]}),e.jsx("div",{className:"flex gap-3 pt-2",children:e.jsxs(T,{onClick:H,disabled:E||!o,size:"lg",className:"flex-1 bg-gradient-to-r from-primary to-primary/90 hover:from-primary/90 hover:to-primary shadow-lg",children:[e.jsx(ce,{className:"mr-2 h-4 w-4"}),E?"PDF Oluşturuluyor...":o?"PDF İndir":"Tarih Aralığı Seçin"]})})]})})]})})},vt=({open:P,onOpenChange:L})=>{const{user:v}=ue(),[E,R]=y.useState(!1),[x,D]=y.useState(""),[m,b]=y.useState(""),[o,i]=y.useState(null),z=t=>{if(t.createdAt instanceof ke)return t.createdAt.toDate();if(t.created_at){const s=new Date(t.created_at);if(!Number.isNaN(s.getTime()))return s}return new Date},Q=t=>t.order_date?new Date(t.order_date).toISOString().slice(0,7):t.created_at?new Date(t.created_at).toISOString().slice(0,7):z(t).toISOString().slice(0,7),X=t=>{var s,r,d,j;return(j=(d=(r=(s=t.total)!=null?s:t.totalAmount)!=null?r:t.total_amount)!=null?d:t.subtotal)!=null?j:0},V=t=>{var s,r,d;return(d=(r=(s=t.cost)!=null?s:t.unit_price)!=null?r:t.unitPrice)!=null?d:0},H=y.useCallback(()=>O(void 0,null,function*(){if(!x||!m){i(null);return}R(!0);try{const s=(yield Ce()).filter(N=>{const A=z(N).toISOString().split("T")[0];return A>=x&&A<=m}),r=yield Promise.all(s.map(N=>O(void 0,null,function*(){try{const C=yield Pe(N.id);return q(U({},N),{order_items:C})}catch(C){return console.error("Get order items error:",C),q(U({},N),{order_items:[]})}}))),d=(r==null?void 0:r.reduce((N,C)=>N+X(C),0))||0,j=yield pt(),l=new Map(j.map(N=>[N.id,N]));let f=0;const W=(r==null?void 0:r.flatMap(N=>{var C;return((C=N.order_items)==null?void 0:C.map(A=>O(void 0,null,function*(){const te=V(A);let me=te;if(A.currency&&A.currency!=="TRY")try{me=yield we(te,A.currency)}catch(Z){console.warn(`Exchange rate conversion failed for ${A.currency}, using original value`)}if(A.raw_material_id&&l.has(A.raw_material_id)){const Z=l.get(A.raw_material_id);if(Z.unitPrice){let le=Z.unitPrice;if(Z.currency&&Z.currency!=="TRY")try{le=yield we(Z.unitPrice,Z.currency)}catch(ae){console.warn(`Exchange rate conversion failed for material ${Z.currency}, using original value`)}me+=le*(A.quantity||1)}}return me*A.quantity})))||[]}))||[];f=(yield Promise.all(W)).reduce((N,C)=>N+C,0);const B=d-f,u=d>0?B/d*100:0,a=new Map,n=(r==null?void 0:r.map(N=>O(void 0,null,function*(){var le;const C=Q(N),A=X(N),te=((le=N.order_items)==null?void 0:le.map(ae=>O(void 0,null,function*(){const ve=V(ae);let Ae=ve;if(ae.currency&&ae.currency!=="TRY")try{Ae=yield we(ve,ae.currency)}catch(St){console.warn("Exchange rate conversion failed, using original value")}return Ae*ae.quantity})))||[],Z=(yield Promise.all(te)).reduce((ae,ve)=>ae+ve,0);return{month:C,revenue:A,cost:Z}})))||[];(yield Promise.all(n)).forEach(({month:N,revenue:C,cost:A})=>{a.has(N)||a.set(N,{revenue:0,cost:0});const te=a.get(N);te.revenue+=C,te.cost+=A});const p=Array.from(a.entries()).map(([N,C])=>({month:N,revenue:C.revenue,cost:C.cost,profit:C.revenue-C.cost})).sort((N,C)=>N.month.localeCompare(C.month)),g=new Map,Y=(r==null?void 0:r.flatMap(N=>{var C;return((C=N.order_items)==null?void 0:C.map(A=>O(void 0,null,function*(){var le;const te=A.product_name||"Bilinmeyen",me=V(A);let Z=me;if(A.currency&&A.currency!=="TRY")try{Z=yield we(me,A.currency)}catch(ae){console.warn("Exchange rate conversion failed, using original value")}return{productName:te,revenue:(le=A.total)!=null?le:0,cost:Z*A.quantity}})))||[]}))||[];(yield Promise.all(Y)).forEach(({productName:N,revenue:C,cost:A})=>{g.has(N)||g.set(N,{name:N,revenue:0,cost:0});const te=g.get(N);te.revenue+=C,te.cost+=A});const se=Array.from(g.values()).map(N=>q(U({},N),{profit:N.revenue-N.cost})).sort((N,C)=>C.profit-N.profit).slice(0,10);i({totalRevenue:d,totalCost:f,grossProfit:B,profitMargin:u,monthlyTrend:p,topProfitableProducts:se})}catch(t){console.error("Fetch report data error:",t),k.error("Veri yüklenirken hata oluştu")}finally{R(!1)}}),[x,m]);y.useEffect(()=>{if(x&&m){const t=setTimeout(()=>{H()},500);return()=>clearTimeout(t)}},[x,m,H]);const c=()=>O(void 0,null,function*(){if(!x||!m){k.error("Lütfen tarih aralığı seçin");return}if(!o){k.error("Lütfen önce rapor verilerini yükleyin");return}R(!0);try{const t=yield ut(o,x,m),s=URL.createObjectURL(t),r=document.createElement("a");r.href=s;const d=new Date().toISOString().split("T")[0];r.download=`Mali-Rapor-${x}-${m}-${d}.pdf`,document.body.appendChild(r),r.click(),document.body.removeChild(r),setTimeout(()=>URL.revokeObjectURL(s),100),k.success("Rapor indiriliyor..."),R(!1),O(void 0,null,function*(){try{const{saveReport:j}=yield he(()=>O(void 0,null,function*(){const{saveReport:f}=yield import("./reportService-yUgxtgcG.js");return{saveReport:f}}),__vite__mapDeps([0,1,2,3,4,5])),l=`Mali Rapor - ${x} / ${m}`;yield j("financial",l,t,(v==null?void 0:v.id)||"",{startDate:x,endDate:m,metadata:{totalRevenue:o.totalRevenue,grossProfit:o.grossProfit}}),k.success("Rapor buluta yedeklendi.")}catch(j){console.warn("Rapor buluta kaydedilemedi (CORS/Yetki):",j)}})}catch(t){const s=t instanceof Error?t.message:"Bilinmeyen hata";k.error("Hata: "+s),R(!1)}});return e.jsx(ge,{open:P,onOpenChange:L,children:e.jsxs(fe,{className:"w-full max-w-[98vw] md:max-w-6xl max-h-[95vh] flex flex-col p-0 overflow-hidden",children:[e.jsxs(be,{className:"px-4 sm:px-6 pt-4 sm:pt-6 pb-4 border-b bg-gradient-to-r from-emerald-500/5 to-transparent flex-shrink-0",children:[e.jsxs(ye,{className:"text-lg sm:text-xl font-bold flex items-center gap-2",children:[e.jsx("div",{className:"h-8 w-8 rounded-lg bg-emerald-500/10 flex items-center justify-center",children:e.jsx(et,{className:"h-4 w-4 text-emerald-600"})}),"Mali Rapor Oluştur"]}),e.jsx(je,{className:"text-xs sm:text-sm text-muted-foreground mt-1",children:"Tarih aralığı seçerek detaylı mali rapor oluşturun ve PDF olarak indirin"})]}),e.jsx(Ne,{className:"flex-1 min-h-0",children:e.jsxs("div",{className:"w-full p-4 sm:p-6 space-y-4 sm:space-y-6",children:[e.jsxs(F,{className:"bg-gradient-to-br from-gray-50/50 to-white border-2",children:[e.jsx(_,{className:"pb-3",children:e.jsx(M,{className:"text-sm font-semibold text-muted-foreground",children:"Tarih Aralığı Seçimi"})}),e.jsxs(I,{children:[e.jsxs("div",{className:"mb-4",children:[e.jsx($,{className:"text-xs font-medium text-muted-foreground mb-2 block",children:"Hızlı Seçim"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs(T,{type:"button",variant:"outline",size:"sm",onClick:()=>{const t=new Date,s=new Date(t);s.setDate(t.getDate()-7),D(s.toISOString().split("T")[0]),b(t.toISOString().split("T")[0])},className:"text-xs",children:[e.jsx(Te,{className:"h-3 w-3 mr-1"}),"Son 7 Gün"]}),e.jsxs(T,{type:"button",variant:"outline",size:"sm",onClick:()=>{const t=new Date,s=new Date(t);s.setDate(t.getDate()-30),D(s.toISOString().split("T")[0]),b(t.toISOString().split("T")[0])},className:"text-xs",children:[e.jsx(Re,{className:"h-3 w-3 mr-1"}),"Son 30 Gün"]}),e.jsx(T,{type:"button",variant:"outline",size:"sm",onClick:()=>{const t=new Date,s=new Date(t.getFullYear(),t.getMonth(),1);D(s.toISOString().split("T")[0]),b(t.toISOString().split("T")[0])},className:"text-xs",children:"Bu Ay"}),e.jsx(T,{type:"button",variant:"outline",size:"sm",onClick:()=>{const t=new Date,s=new Date(t.getFullYear(),t.getMonth()-1,1),r=new Date(t.getFullYear(),t.getMonth(),0);D(s.toISOString().split("T")[0]),b(r.toISOString().split("T")[0])},className:"text-xs",children:"Geçen Ay"}),e.jsx(T,{type:"button",variant:"outline",size:"sm",onClick:()=>{const t=new Date,s=new Date(t.getFullYear(),0,1);D(s.toISOString().split("T")[0]),b(t.toISOString().split("T")[0])},className:"text-xs",children:"Bu Yıl"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx($,{className:"text-sm font-medium",children:"Başlangıç Tarihi"}),e.jsx(K,{type:"date",value:x,onChange:t=>D(t.target.value),className:"border-2 focus:border-primary"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx($,{className:"text-sm font-medium",children:"Bitiş Tarihi"}),e.jsx(K,{type:"date",value:m,onChange:t=>b(t.target.value),className:"border-2 focus:border-primary"})]})]})]})]}),E&&!o&&e.jsx(F,{className:"border-2 border-dashed",children:e.jsx(I,{className:"py-12",children:e.jsxs("div",{className:"flex flex-col items-center justify-center gap-3",children:[e.jsx("div",{className:"h-8 w-8 border-4 border-primary border-t-transparent rounded-full animate-spin"}),e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Veriler yükleniyor..."})]})})}),o&&e.jsxs("div",{className:"space-y-6 border-t pt-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"text-lg font-bold flex items-center gap-2",children:[e.jsx("div",{className:"h-2 w-2 rounded-full bg-primary"}),"Rapor Önizlemesi"]}),e.jsxs(xe,{variant:"outline",className:"text-xs",children:[x," - ",m]})]}),e.jsxs("div",{className:"grid grid-cols-4 gap-4",children:[e.jsxs(F,{className:"bg-gradient-to-br from-green-50 via-white to-white border-green-200 hover:shadow-lg transition-all duration-300",children:[e.jsx(_,{className:"pb-3",children:e.jsxs(M,{className:"text-sm font-semibold text-muted-foreground flex items-center gap-2",children:[e.jsx(pe,{className:"h-4 w-4 text-green-500"}),"Toplam Gelir"]})}),e.jsxs(I,{children:[e.jsxs("p",{className:"text-3xl font-bold text-green-600",children:["₺",o.totalRevenue.toFixed(2)]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Toplam ciro"})]})]}),e.jsxs(F,{className:"bg-gradient-to-br from-red-50 via-white to-white border-red-200 hover:shadow-lg transition-all duration-300",children:[e.jsx(_,{className:"pb-3",children:e.jsxs(M,{className:"text-sm font-semibold text-muted-foreground flex items-center gap-2",children:[e.jsx(tt,{className:"h-4 w-4 text-red-500"}),"Toplam Gider"]})}),e.jsxs(I,{children:[e.jsxs("p",{className:"text-3xl font-bold text-red-600",children:["₺",o.totalCost.toFixed(2)]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Toplam maliyet"})]})]}),e.jsxs(F,{className:"bg-gradient-to-br from-emerald-50 via-white to-white border-emerald-200 hover:shadow-lg transition-all duration-300",children:[e.jsx(_,{className:"pb-3",children:e.jsxs(M,{className:"text-sm font-semibold text-muted-foreground flex items-center gap-2",children:[e.jsx(st,{className:"h-4 w-4 text-emerald-500"}),"Brüt Kar"]})}),e.jsxs(I,{children:[e.jsxs("p",{className:"text-3xl font-bold text-emerald-600",children:["₺",o.grossProfit.toFixed(2)]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Net kar"})]})]}),e.jsxs(F,{className:"bg-gradient-to-br from-primary/10 via-white to-white border-primary/20 hover:shadow-lg transition-all duration-300",children:[e.jsx(_,{className:"pb-3",children:e.jsxs(M,{className:"text-sm font-semibold text-muted-foreground flex items-center gap-2",children:[e.jsx(at,{className:"h-4 w-4 text-primary"}),"Kar Marjı"]})}),e.jsxs(I,{children:[e.jsxs("p",{className:"text-3xl font-bold text-primary",children:[o.profitMargin.toFixed(1),"%"]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Karlılık oranı"})]})]})]}),e.jsxs(F,{className:"border-2 shadow-sm",children:[e.jsx(_,{className:"bg-gradient-to-r from-gray-50 to-white border-b",children:e.jsxs(M,{className:"text-lg font-bold flex items-center gap-2",children:[e.jsx("div",{className:"h-1 w-1 rounded-full bg-primary"}),"Aylık Gelir-Gider-Kar Trendi"]})}),e.jsx(I,{className:"p-0",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(re,{children:[e.jsx(ie,{children:e.jsxs(G,{className:"bg-gray-50/50",children:[e.jsx(w,{className:"font-semibold",children:"Ay"}),e.jsx(w,{className:"text-right font-semibold",children:"Gelir"}),e.jsx(w,{className:"text-right font-semibold",children:"Gider"}),e.jsx(w,{className:"text-right font-semibold",children:"Kar"})]})}),e.jsx(ne,{children:o.monthlyTrend.map((t,s)=>{const[r,d]=t.month.split("-"),l={"01":"Ocak","02":"Şubat","03":"Mart","04":"Nisan","05":"Mayıs","06":"Haziran","07":"Temmuz","08":"Ağustos","09":"Eylül",10:"Ekim",11:"Kasım",12:"Aralık"}[d]||d;return e.jsxs(G,{className:"hover:bg-gray-50/50 transition-colors",children:[e.jsxs(S,{className:"font-medium",children:[l," ",r]}),e.jsxs(S,{className:"text-right font-semibold text-green-600",children:["₺",t.revenue.toLocaleString("tr-TR",{minimumFractionDigits:2,maximumFractionDigits:2})]}),e.jsxs(S,{className:"text-right font-semibold text-red-600",children:["₺",t.cost.toLocaleString("tr-TR",{minimumFractionDigits:2,maximumFractionDigits:2})]}),e.jsxs(S,{className:"text-right font-semibold text-emerald-600",children:["₺",t.profit.toLocaleString("tr-TR",{minimumFractionDigits:2,maximumFractionDigits:2})]})]},s)})})]})})})]}),e.jsxs(F,{className:"border-2 shadow-sm",children:[e.jsx(_,{className:"bg-gradient-to-r from-gray-50 to-white border-b",children:e.jsxs(M,{className:"text-lg font-bold flex items-center gap-2",children:[e.jsx("div",{className:"h-1 w-1 rounded-full bg-primary"}),"En Karlı Ürünler"]})}),e.jsx(I,{className:"p-0",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(re,{children:[e.jsx(ie,{children:e.jsxs(G,{className:"bg-gray-50/50",children:[e.jsx(w,{className:"font-semibold",children:"Sıra"}),e.jsx(w,{className:"font-semibold",children:"Ürün"}),e.jsx(w,{className:"text-right font-semibold",children:"Gelir"}),e.jsx(w,{className:"text-right font-semibold",children:"Gider"}),e.jsx(w,{className:"text-right font-semibold",children:"Kar"})]})}),e.jsx(ne,{children:o.topProfitableProducts.slice(0,10).map((t,s)=>e.jsxs(G,{className:"hover:bg-gray-50/50 transition-colors",children:[e.jsxs(S,{className:"font-medium text-muted-foreground",children:["#",s+1]}),e.jsx(S,{className:"font-medium",children:t.name}),e.jsxs(S,{className:"text-right font-semibold text-green-600",children:["₺",t.revenue.toLocaleString("tr-TR",{minimumFractionDigits:2,maximumFractionDigits:2})]}),e.jsxs(S,{className:"text-right font-semibold text-red-600",children:["₺",t.cost.toLocaleString("tr-TR",{minimumFractionDigits:2,maximumFractionDigits:2})]}),e.jsxs(S,{className:"text-right font-semibold text-emerald-600",children:["₺",t.profit.toLocaleString("tr-TR",{minimumFractionDigits:2,maximumFractionDigits:2})]})]},s))})]})})})]})]}),e.jsx("div",{className:"flex gap-3 pt-2",children:e.jsxs(T,{onClick:c,disabled:E||!o,size:"lg",className:"flex-1 bg-gradient-to-r from-primary to-primary/90 hover:from-primary/90 hover:to-primary shadow-lg",children:[e.jsx(ce,{className:"mr-2 h-4 w-4"}),E?"PDF Oluşturuluyor...":o?"PDF İndir":"Tarih Aralığı Seçin"]})})]})})]})})},Fe=[{productId:null,productName:"",quantity:1,unitPrice:0,discount:0,total:0,isManual:!1}],wt=({open:P,onOpenChange:L,orderId:v})=>{const E=new Date,R=E.toISOString().split("T")[0],x=new Date(E);x.setDate(E.getDate()+7);const D=x.toISOString().split("T")[0],{user:m}=ue(),[b,o]=y.useState(!1),[i,z]=y.useState({quoteNumber:`REV-${new Date().getFullYear()}${String(new Date().getMonth()+1).padStart(2,"0")}-${String(Math.floor(Math.random()*1e3)).padStart(3,"0")}`,quoteDate:R,validUntil:D,customerId:"",customerName:"",customerCompany:"",customerAddress:"",customerPhone:"",customerEmail:"",currency:ft,taxRate:20,items:Fe,terms:["Nakliye ücreti fiyata dahil değildir.","Cihaz, imalat hatalarına karşı 2 yıl garanti kapsamındadır.","Üretim süresi, %50 peşin ödeme alındıktan sonra 10 iş günüdür."]}),[Q,X]=y.useState([]),[V,H]=y.useState([]),c=y.useCallback(()=>O(void 0,null,function*(){try{const a=yield Ie();X(a)}catch(a){console.error("Fetch customers error:",a)}}),[]),t=y.useCallback(()=>O(void 0,null,function*(){try{const a=yield lt();H(a)}catch(a){console.error("Fetch products error:",a)}}),[]),s=y.useCallback(()=>O(void 0,null,function*(){if(v)try{const[a,n]=yield Promise.all([ot(v),Pe(v)]);a&&z(h=>q(U({},h),{customerId:a.customerId||a.customer_id||"",customerName:a.customerName||a.customer_name||"",customerCompany:a.customerCompany||a.customer_company||"",items:n&&n.length>0?n.map(p=>({productId:p.productId||p.product_id||null,productName:p.productName||p.product_name||"",quantity:p.quantity||1,unitPrice:p.unitPrice||p.unit_price||0,discount:p.discount||0,total:p.total||0,isManual:!p.product_id})):Fe}))}catch(a){}}),[v]);y.useEffect(()=>{if(P)if(c(),t(),v)s();else{const a=new Date,n=a.toISOString().split("T")[0],h=new Date(a);h.setDate(a.getDate()+7);const p=h.toISOString().split("T")[0];z(g=>q(U({},g),{quoteNumber:`REV-${a.getFullYear()}${String(a.getMonth()+1).padStart(2,"0")}-${String(Math.floor(Math.random()*1e3)).padStart(3,"0")}`,quoteDate:n,validUntil:p,customerId:"",customerName:"",customerCompany:"",customerAddress:"",customerPhone:"",customerEmail:"",items:Fe})),o(!1)}},[P,v]);const r=a=>{const n=Number(a);return isNaN(n)||!isFinite(n)?0:n},d=y.useMemo(()=>{const a=(Array.isArray(i.items)?i.items:[]).reduce((J,se)=>{const ee=r(se.quantity),N=r(se.unitPrice),C=r(se.discount||0),A=ee*N-C;return J+A},0),n=r(a),h=r(i.taxRate||20),p=n*(h/100),g=n+r(p),Y=(Array.isArray(i.items)?i.items:[]).reduce((J,se)=>J+r(se.discount||0),0);return{subtotal:n,tax:r(p),grandTotal:r(g),totalDiscount:r(Y)}},[i.items,i.taxRate]),j=(Array.isArray(i.items)?i.items:[]).some(a=>(a.discount||0)>0),l=(a,n,h)=>{z(p=>{const g=[...p.items];if(n==="productId")if(h==="manual")g[a]=q(U({},g[a]),{productId:null,productName:"",unitPrice:0,isManual:!0});else if(h){const ee=V.find(N=>N.id===h);ee&&(g[a]=q(U({},g[a]),{productId:ee.id,productName:ee.name,unitPrice:ee.price||0,isManual:!1}),ee.price&&ee.price>0?k.success(`Ürün fiyatı otomatik olarak eklendi: ${ee.price.toFixed(2)} ${oe[i.currency]||i.currency}`):k.info("Bu ürün için fiyat tanımlı değil, lütfen manuel olarak girin"))}else g[a]=q(U({},g[a]),{productId:null,productName:"",unitPrice:0,isManual:!1});else{const ee=n==="productName"?h:Number(h)||0;g[a]=q(U({},g[a]),{[n]:ee})}const Y=r(g[a].quantity),J=r(g[a].unitPrice),se=r(g[a].discount||0);return g[a].total=r(Y*J-se),q(U({},p),{items:g})})},f=()=>{z(a=>q(U({},a),{items:[...a.items,{productId:null,productName:"",quantity:1,unitPrice:0,discount:0,total:0,isManual:!1}]}))},W=a=>{Array.isArray(i.items)&&i.items.length>1&&z(n=>q(U({},n),{items:n.items.filter((h,p)=>p!==a)}))},de=y.useCallback((a,n)=>{const h=Q.find(p=>p.id===a);Ie().then(p=>{const g=p.find(Y=>Y.id===a);z(Y=>q(U({},Y),{customerId:a||"",customerName:(g==null?void 0:g.name)||n||"",customerCompany:(g==null?void 0:g.company)||(h==null?void 0:h.company)||"",customerAddress:(g==null?void 0:g.address)||"",customerPhone:(g==null?void 0:g.phone)||"",customerEmail:(g==null?void 0:g.email)||""}))}).catch(()=>{z(p=>q(U({},p),{customerId:a||"",customerName:(h==null?void 0:h.name)||n||"",customerCompany:(h==null?void 0:h.company)||""}))})},[Q]),B=a=>{if(!a||a.trim()==="")return"-";try{const n=new Date(a);if(isNaN(n.getTime())||!isFinite(n.getTime()))return console.warn("Geçersiz tarih:",a),"-";const h=["Ocak","Şubat","Mart","Nisan","Mayıs","Haziran","Temmuz","Ağustos","Eylül","Ekim","Kasım","Aralık"],p=n.getDate(),g=n.getMonth(),Y=n.getFullYear();if(isNaN(p)||isNaN(g)||isNaN(Y)||g<0||g>11||p<1||p>31||Y<1900||Y>2100)return console.warn("Geçersiz tarih bileşenleri:",{day:p,monthIndex:g,year:Y}),"-";const J=h[g];return J?`${p} ${J} ${Y}`:(console.warn("Geçersiz ay indeksi:",g),"-")}catch(n){return console.error("Tarih formatlama hatası:",n,a),"-"}},u=()=>O(void 0,null,function*(){if(!i.customerCompany&&!i.customerName){k.error("Lütfen müşteri bilgisini girin.");return}if(!Array.isArray(i.items)||i.items.length===0||i.items.every(a=>!a.productName)){k.error("Lütfen en az bir ürün ekleyin.");return}try{const a=yield ht({quoteNumber:i.quoteNumber,quoteDate:B(i.quoteDate),validUntil:B(i.validUntil),customerName:i.customerName,customerCompany:i.customerCompany,customerAddress:i.customerAddress||void 0,customerPhone:i.customerPhone||void 0,customerEmail:i.customerEmail||void 0,projectName:"",deliveryTerms:"",paymentTerms:"",notes:"",currency:i.currency,taxRate:i.taxRate,discountRate:0,items:Array.isArray(i.items)?i.items.filter(p=>p.productName&&p.productName.trim()!=="").map(p=>({description:p.productName||"-",quantity:p.quantity||0,unitPrice:p.unitPrice||0,discount:p.discount||0})):[],totals:q(U({},d),{discount:d.totalDiscount}),terms:i.terms}),n=URL.createObjectURL(a),h=document.createElement("a");h.href=n,h.download=`Satis-Teklifi-${i.quoteNumber}.pdf`,h.click(),URL.revokeObjectURL(n),k.success("Teklif PDF hazırlandı");try{const{saveReport:p}=yield he(()=>O(void 0,null,function*(){const{saveReport:g}=yield import("./reportService-yUgxtgcG.js");return{saveReport:g}}),__vite__mapDeps([0,1,2,3,4,5]));yield p("sales_quote",`Teklif ${i.quoteNumber}`,a,(m==null?void 0:m.id)||"anonymous",{metadata:{customerId:i.customerId||null,customerName:i.customerCompany||i.customerName||"Bilinmiyor",currency:i.currency,grandTotal:Number(d.grandTotal)||0,subtotal:Number(d.subtotal)||0,tax:Number(d.tax)||0,discount:Number(d.totalDiscount)||0}})}catch(p){console.warn("Teklif raporu kaydedilemedi (PDF indirme başarılı):",p)}}catch(a){const n=a instanceof Error?a.message:"Bilinmeyen hata";k.error("PDF oluşturulamadı: "+n)}});return e.jsx(ge,{open:P,onOpenChange:L,children:e.jsxs(fe,{className:"w-full max-w-[98vw] md:max-w-6xl max-h-[95vh] flex flex-col p-0 overflow-hidden bg-gradient-to-br from-background via-background to-muted/20",children:[e.jsx(be,{className:"px-4 sm:px-6 pt-4 sm:pt-6 pb-4 border-b bg-gradient-to-r from-primary/5 via-primary/10 to-primary/5 backdrop-blur-sm flex-shrink-0",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-10 w-10 rounded-xl bg-gradient-to-br from-primary/20 to-primary/10 backdrop-blur-sm flex items-center justify-center border border-primary/20",children:e.jsx(Se,{className:"h-5 w-5 text-primary"})}),e.jsxs("div",{children:[e.jsx(ye,{className:"text-xl sm:text-2xl font-bold bg-gradient-to-r from-foreground to-foreground/80 bg-clip-text text-transparent",children:"Satış Teklif Formu"}),e.jsx(je,{className:"text-xs sm:text-sm text-muted-foreground mt-1",children:"Teklif formunu düzenleyip PDF olarak indirebilirsiniz"})]})]}),!b&&e.jsxs(T,{onClick:()=>o(!0),variant:"outline",size:"sm",className:"shadow-sm hover:shadow-md transition-all duration-200 hover:scale-105",children:[e.jsx(Ue,{className:"h-4 w-4 mr-2"}),"Düzenle"]})]})}),e.jsx(Ne,{className:"flex-1 min-h-0",children:e.jsx("div",{className:"w-full p-4 sm:p-6 flex justify-center bg-gradient-to-br from-muted/20 via-background to-muted/10",children:e.jsxs("div",{className:"w-full max-w-[820px] space-y-4 sm:space-y-6",children:[b&&e.jsxs("div",{className:"space-y-4 p-5 bg-gradient-to-br from-primary/5 via-white to-white rounded-xl border-2 border-primary/20 shadow-lg backdrop-blur-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4 pb-4 border-b border-primary/10",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-8 w-8 rounded-lg bg-primary/10 flex items-center justify-center",children:e.jsx(Ue,{className:"h-4 w-4 text-primary"})}),e.jsx("h3",{className:"font-semibold text-lg text-foreground",children:"Form Bilgilerini Düzenle"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(T,{onClick:()=>o(!1),variant:"default",size:"sm",className:"bg-gradient-to-r from-primary to-primary/90 hover:from-primary/90 hover:to-primary shadow-md hover:shadow-lg transition-all duration-200",children:[e.jsx(rt,{className:"h-4 w-4 mr-2"}),"Kaydet"]}),e.jsx(T,{onClick:()=>o(!1),variant:"ghost",size:"sm",className:"hover:bg-destructive/10 hover:text-destructive transition-colors",children:e.jsx(it,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx($,{className:"text-sm font-medium text-foreground/80",children:"Teklif No"}),e.jsx(K,{value:i.quoteNumber,onChange:a=>z(n=>q(U({},n),{quoteNumber:a.target.value})),className:"border-primary/20 focus:border-primary focus:ring-primary/20 transition-all"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx($,{className:"text-sm font-medium text-foreground/80",children:"Tarih"}),e.jsx(K,{type:"date",value:i.quoteDate,onChange:a=>z(n=>q(U({},n),{quoteDate:a.target.value})),className:"border-primary/20 focus:border-primary focus:ring-primary/20 transition-all"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx($,{className:"text-sm font-medium text-foreground/80",children:"Geçerlilik Tarihi"}),e.jsx(K,{type:"date",value:i.validUntil,onChange:a=>z(n=>q(U({},n),{validUntil:a.target.value})),className:"border-primary/20 focus:border-primary focus:ring-primary/20 transition-all"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx($,{className:"text-sm font-medium text-foreground/80",children:"Müşteri"}),e.jsx("div",{className:"border-primary/20 rounded-md",children:e.jsx(gt,{value:i.customerId||"",onChange:de,placeholder:"Müşteri seçin..."})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx($,{className:"text-sm font-medium text-foreground/80",children:"Para Birimi"}),e.jsx("select",{className:"w-full rounded-md border border-primary/20 bg-background px-3 py-2 text-sm focus:border-primary focus:ring-2 focus:ring-primary/20 transition-all",value:i.currency,onChange:a=>z(n=>q(U({},n),{currency:a.target.value})),children:bt.map(a=>e.jsx("option",{value:a.value,children:a.label},a.value))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx($,{className:"text-sm font-medium text-foreground/80",children:"KDV (%)"}),e.jsx(K,{type:"number",min:"0",max:"100",value:i.taxRate,onChange:a=>z(n=>q(U({},n),{taxRate:Number(a.target.value)})),className:"border-primary/20 focus:border-primary focus:ring-primary/20 transition-all"})]})]})]}),e.jsxs("div",{className:"bg-white border-2 border-gray-200 rounded-xl shadow-xl relative overflow-hidden transition-all duration-300 hover:shadow-2xl",style:{minWidth:"720px",maxWidth:"794px",width:"794px",padding:"32px",margin:"0 auto"},children:[e.jsxs("div",{className:"absolute top-0 left-0 w-full h-full pointer-events-none overflow-hidden",children:[e.jsx("div",{className:"absolute top-8 left-8 w-40 h-32 bg-gray-400 transform rotate-12",style:{opacity:.02}}),e.jsx("div",{className:"absolute top-16 left-16 w-28 h-24 bg-gray-400 transform -rotate-12",style:{opacity:.02}}),e.jsx("div",{className:"absolute top-4 left-48 w-20 h-16 bg-gray-400 transform rotate-45",style:{opacity:.02}})]}),e.jsxs("div",{className:"flex justify-between items-start mb-8 relative z-10",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h2",{className:"text-[28px] font-bold mb-4 text-black leading-tight",style:{letterSpacing:"0.5px",lineHeight:"1.15",fontWeight:700},children:"SATIŞ TEKLİF FORMU"}),e.jsxs("div",{className:"space-y-0.5",children:[e.jsx("p",{className:"text-sm font-semibold text-black mb-0.5",style:{fontWeight:600},children:"Müşteri"}),e.jsx("p",{className:"text-sm text-gray-700 leading-relaxed",style:{lineHeight:"1.4",fontSize:"14px"},children:i.customerCompany||i.customerName||"Müşteri seçin"})]})]}),e.jsxs("div",{className:"text-right flex-shrink-0 ml-12",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2.5",children:[e.jsx("img",{src:Me,alt:"REVIUM",className:"h-10 w-10 object-contain"}),e.jsx("span",{className:"text-2xl font-bold text-black",style:{fontWeight:700},children:"REVIUM"})]}),e.jsxs("div",{className:"text-[10px] text-gray-600 space-y-[1px] leading-tight",style:{fontSize:"10px",lineHeight:"1.2"},children:[e.jsx("p",{children:"Fevzi Çakmak Mah. Milenyum Cad. No:81"}),e.jsx("p",{children:"Karatay/KONYA"}),e.jsx("p",{children:"info@reviumtech.com"}),e.jsx("p",{children:"+90 (551) 829-1613"})]})]})]}),e.jsx("div",{className:"mb-8 text-sm relative z-10 flex justify-end",children:e.jsxs("div",{className:"text-right space-y-1",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold text-black",style:{fontWeight:600,fontSize:"14px"},children:"Tarih:"})," ",e.jsx("span",{className:"text-gray-700",style:{fontSize:"14px"},children:B(i.quoteDate)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold text-black",style:{fontWeight:600,fontSize:"14px"},children:"Geçerlilik Tarihi:"})," ",e.jsx("span",{className:"text-gray-700",style:{fontSize:"14px"},children:B(i.validUntil)})]})]})}),e.jsxs("div",{className:"mb-8 relative z-10",children:[e.jsx("div",{className:"border border-gray-300 rounded-none overflow-hidden",children:e.jsxs(re,{className:"border-collapse m-0",children:[e.jsx(ie,{children:e.jsxs(G,{className:"border-0",children:[e.jsx(w,{className:"w-12 text-black font-bold border border-gray-300 bg-gray-100 py-2.5 px-3 text-left text-xs",style:{fontWeight:700,backgroundColor:"#f3f4f6"},children:"No"}),e.jsx(w,{className:"text-black font-bold border border-gray-300 bg-gray-100 py-2.5 px-3 text-left text-xs",style:{fontWeight:700,backgroundColor:"#f3f4f6"},children:"Ürün Adı"}),e.jsx(w,{className:"w-24 text-black font-bold border border-gray-300 bg-gray-100 py-2.5 px-3 text-center text-xs",style:{fontWeight:700,backgroundColor:"#f3f4f6"},children:"Adet"}),e.jsx(w,{className:"w-32 text-black font-bold border border-gray-300 bg-gray-100 py-2.5 px-3 text-right text-xs",style:{fontWeight:700,backgroundColor:"#f3f4f6"},children:"Birim Fiyat"}),j&&e.jsx(w,{className:"w-28 text-black font-bold border border-gray-300 bg-gray-100 py-2.5 px-3 text-right text-xs",style:{fontWeight:700,backgroundColor:"#f3f4f6"},children:"İskonto"}),e.jsx(w,{className:"w-32 text-black font-bold border border-gray-300 bg-gray-100 py-2.5 px-3 text-right text-xs",style:{fontWeight:700,backgroundColor:"#f3f4f6"},children:"Toplam"}),b&&e.jsx(w,{className:"w-12 border border-gray-300 bg-gray-100 py-3 px-3"})]})}),e.jsx(ne,{children:(Array.isArray(i.items)?i.items:[]).map((a,n)=>e.jsxs(G,{className:"border-0",children:[e.jsx(S,{className:"border border-gray-300 text-left py-2.5 px-3 text-xs",children:n+1}),e.jsx(S,{className:"min-w-[300px] border border-gray-300 py-2.5 px-3 text-xs",children:b?a.isManual?e.jsxs("div",{className:"space-y-2",children:[e.jsx(K,{value:a.productName,onChange:h=>l(n,"productName",h.target.value),placeholder:"Ürün adı",className:"h-8 text-xs border-primary/20 focus:border-primary focus:ring-primary/20 transition-all"}),e.jsxs(T,{type:"button",variant:"outline",size:"sm",onClick:()=>l(n,"productId",""),className:"h-7 text-xs border-primary/30 hover:border-primary hover:bg-primary/5 transition-all",children:[e.jsx(Se,{className:"h-3 w-3 mr-1"}),"Kayıtlı Ürün Seç"]})]}):e.jsx("div",{className:"space-y-2",children:e.jsxs(Ke,{value:a.productId||"",onValueChange:h=>{l(n,"productId",h)},children:[e.jsx(He,{className:"h-8 text-xs border-primary/20 focus:border-primary focus:ring-primary/20",children:e.jsx(Qe,{placeholder:"Ürün seçin veya manuel ekleyin"})}),e.jsxs(We,{className:"max-h-[60vh] sm:max-h-80",children:[V.length>0?V.map(h=>e.jsx(Le,{value:h.id,className:"hover:bg-primary/5",children:e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsx("span",{children:h.name}),h.sku&&e.jsx(xe,{variant:"outline",className:"ml-2 text-xs border-primary/20",children:h.sku})]})},h.id)):e.jsx("div",{className:"px-2 py-4 text-center text-xs text-muted-foreground",children:"Ürün bulunamadı"}),e.jsx(Xe,{}),e.jsxs(Le,{value:"manual",className:"text-primary font-medium text-xs hover:bg-primary/10",children:[e.jsx(qe,{className:"h-3 w-3 inline mr-1"}),"Manuel Ürün Ekle"]})]})]})}):e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium",children:a.productName||"-"}),a.isManual&&e.jsx(xe,{variant:"outline",className:"text-xs border-primary/30 text-primary bg-primary/5",children:"Manuel"})]})}),e.jsx(S,{className:"border border-gray-300 text-center py-2.5 px-3 text-xs",children:b?e.jsx(K,{type:"number",min:"1",value:a.quantity,onChange:h=>l(n,"quantity",h.target.value),className:"border-primary/20 focus:border-primary focus:ring-primary/20 h-8 w-20 text-center text-xs transition-all"}):e.jsx("span",{className:"font-medium",children:a.quantity})}),e.jsx(S,{className:"border border-gray-300 text-right py-2.5 px-3 text-xs",children:b?e.jsx(K,{type:"number",min:"0",step:"0.01",value:a.unitPrice,onChange:h=>l(n,"unitPrice",h.target.value),className:"border-primary/20 focus:border-primary focus:ring-primary/20 h-8 w-28 text-right text-xs transition-all"}):e.jsxs("span",{className:"font-medium",children:[oe[i.currency]||i.currency,(a.unitPrice||0).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})]})}),j&&e.jsx(S,{className:"border border-gray-300 text-right py-2.5 px-3 text-xs",children:b?e.jsx(K,{type:"number",min:"0",step:"0.01",value:a.discount||0,onChange:h=>l(n,"discount",h.target.value),className:"border-primary/20 focus:border-primary focus:ring-primary/20 h-8 w-24 text-right text-xs transition-all",placeholder:"0.00"}):(a.discount||0)>0?e.jsxs("span",{className:"text-red-600 font-medium",children:["-",oe[i.currency]||i.currency,(a.discount||0).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})]}):e.jsx("span",{className:"text-muted-foreground",children:"-"})}),e.jsx(S,{className:"font-semibold text-right border border-gray-300 py-2.5 px-3 text-xs",children:e.jsxs("span",{className:"text-foreground",children:[oe[i.currency]||i.currency,(a.total||0).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})]})}),b&&e.jsx(S,{className:"border border-gray-300 py-3 px-3",children:e.jsx(T,{type:"button",variant:"ghost",size:"icon",onClick:()=>W(n),disabled:!Array.isArray(i.items)||i.items.length===1,className:"h-7 w-7 hover:bg-destructive/10 hover:text-destructive transition-colors disabled:opacity-30",children:e.jsx(nt,{className:"h-3.5 w-3.5"})})})]},n))})]})}),b&&e.jsxs(T,{type:"button",variant:"outline",size:"sm",onClick:f,className:"mt-3 border-primary/30 hover:border-primary hover:bg-primary/5 transition-all duration-200 shadow-sm hover:shadow-md",children:[e.jsx(qe,{className:"h-4 w-4 mr-2"}),"Satır Ekle"]})]}),e.jsxs("div",{className:"grid grid-cols-2 mb-6 relative z-10",style:{gap:"64px"},children:[e.jsx("div",{className:"space-y-2",children:b?e.jsx("div",{className:"space-y-3",children:(Array.isArray(i.terms)?i.terms:[]).map((a,n)=>e.jsx(K,{value:a,onChange:h=>{const p=[...i.terms];p[n]=h.target.value,z(g=>q(U({},g),{terms:p}))},className:"text-sm border-primary/20 focus:border-primary focus:ring-primary/20 transition-all",placeholder:`Şart ${n+1}`},n))}):e.jsx("ul",{className:"list-disc list-inside space-y-2.5 text-sm text-gray-700 leading-relaxed",style:{paddingLeft:"1.25rem",lineHeight:"1.5"},children:(Array.isArray(i.terms)?i.terms:[]).map((a,n)=>e.jsx("li",{className:"hover:text-foreground transition-colors",style:{marginBottom:"0.5rem",fontSize:"14px"},children:a},n))})}),e.jsxs("div",{className:"space-y-2.5 text-right",children:[d.totalDiscount>0&&e.jsxs("div",{className:"flex justify-between items-center mb-2.5 p-2 rounded-md hover:bg-muted/30 transition-colors",children:[e.jsx("span",{className:"text-sm text-foreground/80",style:{fontSize:"14px"},children:"Toplam İskonto:"}),e.jsxs("span",{className:"font-semibold text-red-600 text-sm",style:{fontSize:"14px",fontWeight:600},children:["-",oe[i.currency]||i.currency,(d.totalDiscount||0).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})]})]}),e.jsxs("div",{className:"flex justify-between items-center mb-2.5 p-2 rounded-md hover:bg-muted/30 transition-colors",children:[e.jsx("span",{className:"text-sm text-foreground/80",style:{fontSize:"14px"},children:"Ara Toplam:"}),e.jsxs("span",{className:"font-semibold text-foreground text-sm",style:{fontSize:"14px",fontWeight:600},children:[oe[i.currency]||i.currency,(d.subtotal||0).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})]})]}),e.jsxs("div",{className:"flex justify-between items-center mb-2.5 p-2 rounded-md hover:bg-muted/30 transition-colors",children:[e.jsxs("span",{className:"text-sm text-foreground/80",style:{fontSize:"14px"},children:["KDV (%",i.taxRate,"):"]}),e.jsxs("span",{className:"font-semibold text-foreground text-sm",style:{fontSize:"14px",fontWeight:600},children:[oe[i.currency]||i.currency,(d.tax||0).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})]})]}),e.jsxs("div",{className:"flex justify-between items-center pt-4 border-t-2 border-gray-500 mt-4 rounded-lg bg-gray-100",style:{borderTopWidth:"2px",borderTopColor:"#6b7280",padding:"14px 18px",marginTop:"14px",marginLeft:"-18px",marginRight:"-18px",paddingLeft:"18px",paddingRight:"18px",backgroundColor:"#f3f4f6"},children:[e.jsx("span",{className:"text-base font-bold text-black",style:{fontSize:"16px",fontWeight:700},children:"GENEL TOPLAM:"}),e.jsxs("span",{className:"text-base font-bold text-black",style:{fontSize:"16px",fontWeight:700},children:[oe[i.currency]||i.currency,(d.grandTotal||0).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})]})]})]})]}),e.jsxs("div",{className:"mt-8 pt-4 border-t border-gray-200 flex justify-between items-end text-[10px] text-gray-600 relative z-10",style:{fontSize:"10px",lineHeight:"1.2"},children:[e.jsxs("div",{className:"space-y-[1px]",children:[e.jsx("p",{className:"font-semibold text-black",style:{fontWeight:600,fontSize:"9px"},children:"Revium Ltd. Şti."}),e.jsx("p",{style:{fontSize:"10px"},children:"Fevzi Çakmak Mah. Milenyum Cad."}),e.jsx("p",{style:{fontSize:"10px"},children:"No:81 Karatay/KONYA"}),e.jsx("p",{style:{fontSize:"10px"},children:"info@reviumtech.com | www.reviumtech.com"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("img",{src:Me,alt:"REVIUM",className:"h-8 w-8 object-contain"}),e.jsx("span",{className:"text-base font-bold text-black",style:{fontSize:"14px",fontWeight:700},children:"REVIUM"})]})]})]}),e.jsx("div",{className:"flex justify-end pt-4",children:e.jsxs(T,{onClick:u,size:"lg",className:"bg-gradient-to-r from-primary to-primary/90 hover:from-primary/90 hover:to-primary shadow-lg hover:shadow-xl transition-all duration-200 hover:scale-105 text-white font-semibold",children:[e.jsx(ce,{className:"h-5 w-5 mr-2"}),"PDF Olarak İndir"]})})]})})})]})})},Lt=()=>{const{user:P}=ue(),[L,v]=y.useState(!1),[E,R]=y.useState(!1),[x,D]=y.useState(!1),[m,b]=y.useState(!1),[o,i]=y.useState(!1),[z,Q]=y.useState([]),[X,V]=y.useState(null);y.useState(null);const[H,c]=y.useState(null);y.useEffect(()=>{P&&s()},[P]);const t=l=>{if(!l)return null;const f=l.match(/https:\/\/[^\s]+/);return f?f[0]:null},s=()=>O(void 0,null,function*(){try{const{getSavedReports:l}=yield he(()=>O(void 0,null,function*(){const{getSavedReports:W}=yield import("./reportService-yUgxtgcG.js");return{getSavedReports:W}}),__vite__mapDeps([0,1,2,3,4,5])),f=yield l({createdBy:P==null?void 0:P.id});Q(f),V(null)}catch(l){console.error("Fetch saved reports error:",l);const f=t(l==null?void 0:l.message);f&&(V(f),k.warning("Raporlar için Firestore index’i oluşturmanız gerekiyor.")),Q([])}}),r=l=>O(void 0,null,function*(){c(l.id);try{if(l.fileUrl){const f=document.createElement("a");f.href=l.fileUrl,f.download=l.fileName||`rapor-${l.id}.pdf`,document.body.appendChild(f),f.click(),document.body.removeChild(f),k.success("Rapor indiriliyor...")}else k.error("Rapor dosyası bulunamadı")}catch(f){console.error("Download report error:",f),k.error(f.message||"Rapor indirilemedi")}finally{c(null)}}),d=l=>({sales:"Satış",production:"Üretim",customer:"Müşteri",financial:"Mali"})[l]||l,j=[{icon:pe,title:"Satış Raporu",description:"Günlük, haftalık ve aylık satış analizleri",color:"primary",onClick:()=>v(!0)},{icon:Oe,title:"Satış Teklifi",description:"Teklif formunu düzenleyip PDF olarak indir",color:"default",onClick:()=>i(!0)},{icon:Se,title:"Üretim Raporu",description:"Üretim süreçleri ve tamamlanma oranları",color:"success",onClick:()=>R(!0)},{icon:De,title:"Müşteri Raporu",description:"Müşteri analizleri ve davranış raporları",color:"info",onClick:()=>D(!0)},{icon:Oe,title:"Mali Rapor",description:"Gelir-gider ve kar-zarar analizi",color:"warning",onClick:()=>b(!0)}];return e.jsx(ct,{children:e.jsxs("div",{className:"space-y-3 sm:space-y-4 md:space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl sm:text-2xl md:text-3xl font-bold text-foreground",children:"Raporlar"}),e.jsx("p",{className:"text-muted-foreground mt-0.5 sm:mt-1 text-xs sm:text-sm",children:"İş analizleri ve raporlama"})]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4 md:gap-6",children:j.map((l,f)=>e.jsxs(F,{className:"hover:shadow-lg transition-all duration-300 cursor-pointer touch-manipulation min-h-[44px]",onClick:l.onClick,children:[e.jsx(_,{className:"p-3 sm:p-4 md:p-6",children:e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 md:gap-4",children:[e.jsx("div",{className:"p-2 sm:p-2.5 md:p-3 rounded-lg bg-primary/10 flex-shrink-0",children:e.jsx(l.icon,{className:"h-4 w-4 sm:h-5 sm:w-5 md:h-6 md:w-6 text-primary"})}),e.jsx(M,{className:"text-sm sm:text-base md:text-lg",children:l.title})]})}),e.jsxs(I,{className:"p-3 sm:p-4 md:p-6 pt-0",children:[e.jsx("p",{className:"text-muted-foreground mb-2 sm:mb-3 md:mb-4 text-xs sm:text-sm md:text-base",children:l.description}),e.jsx(T,{className:"w-full sm:w-auto min-h-[44px] sm:min-h-10 text-xs sm:text-sm",variant:"outline",onClick:W=>{W.stopPropagation(),l.onClick()},children:"Rapor Oluştur"})]})]},f))}),e.jsx(yt,{open:L,onOpenChange:l=>{v(l),l||s()}}),e.jsx(jt,{open:E,onOpenChange:l=>{R(l),l||s()}}),e.jsx(Nt,{open:x,onOpenChange:l=>{D(l),l||s()}}),e.jsx(vt,{open:m,onOpenChange:l=>{b(l),l||s()}}),e.jsx(wt,{open:o,onOpenChange:i}),X&&e.jsxs("div",{className:"rounded-lg border border-amber-500 bg-amber-50 p-4 text-sm text-amber-900 space-y-2",children:[e.jsx("div",{className:"font-semibold",children:"Firestore index gerekli"}),e.jsx("p",{children:"Kayıtlı raporları görebilmek için Firestore’da aşağıdaki linkteki index’i oluşturup “Active” olmasını beklemelisiniz:"}),e.jsxs("a",{href:X,target:"_blank",rel:"noreferrer",className:"inline-flex items-center gap-2 text-amber-900 font-medium underline",children:["Index’i aç",e.jsx(ce,{className:"h-4 w-4"})]}),e.jsx("p",{className:"text-xs text-amber-800",children:"Index “building” durumundan “active” olana kadar birkaç dakika sürebilir. Tamamlandıktan sonra liste otomatik olarak çalışacaktır."})]}),e.jsxs(F,{children:[e.jsx(_,{className:"p-3 sm:p-4 md:p-6",children:e.jsx(M,{className:"text-base sm:text-lg md:text-xl",children:"Son Oluşturulan Raporlar"})}),e.jsx(I,{className:"p-3 sm:p-4 md:p-6",children:z.length===0?e.jsx("p",{className:"text-muted-foreground text-center py-6 sm:py-8 text-xs sm:text-sm md:text-base",children:"Henüz rapor oluşturulmamış"}):e.jsx("div",{className:"space-y-2 sm:space-y-3 max-h-[60vh] overflow-y-auto pr-2",children:z.map(l=>{var f,W;return e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-2 sm:gap-3 p-2.5 sm:p-3 rounded-lg border border-border hover:bg-muted/50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 flex-1 min-w-0",children:[e.jsx(Oe,{className:"h-4 w-4 sm:h-5 sm:w-5 text-primary flex-shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-xs sm:text-sm md:text-base truncate",children:l.title}),e.jsxs("p",{className:"text-[10px] sm:text-xs md:text-sm text-muted-foreground",children:[d(l.reportType)," • ",l.createdAt?(l.createdAt instanceof Date?l.createdAt:((W=(f=l.createdAt)==null?void 0:f.toDate)==null?void 0:W.call(f))||new Date).toLocaleDateString("tr-TR"):"-"]})]})]}),e.jsxs(T,{variant:"ghost",size:"sm",className:"h-8 sm:h-9 text-xs sm:text-sm w-full sm:w-auto",onClick:()=>r(l),disabled:H===l.id,children:[e.jsx(ce,{className:"h-3.5 w-3.5 sm:h-4 sm:w-4 sm:mr-2"}),e.jsx("span",{className:"hidden sm:inline",children:H===l.id?"İndiriliyor...":"İndir"}),e.jsx("span",{className:"sm:hidden",children:H===l.id?"...":"İndir"})]})]},l.id)})})})]})]})})};export{Lt as default};
