var x=Object.defineProperty,B=Object.defineProperties;var F=Object.getOwnPropertyDescriptors;var v=Object.getOwnPropertySymbols;var T=Object.prototype.hasOwnProperty,L=Object.prototype.propertyIsEnumerable;var o=(r,t,e)=>t in r?x(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e,y=(r,t)=>{for(var e in t||(t={}))T.call(t,e)&&o(r,e,t[e]);if(v)for(var e of v(t))L.call(t,e)&&o(r,e,t[e]);return r},h=(r,t)=>B(r,F(t));var w=(r,t,e)=>new Promise((i,c)=>{var m=a=>{try{s(e.next(a))}catch(n){c(n)}},d=a=>{try{s(e.throw(a))}catch(n){c(n)}},s=a=>a.done?i(a.value):Promise.resolve(a.value).then(m,d);s((e=e.apply(r,t)).next())});import{A as D,D as A,E as R,F as S,G as k,H as b,J as q,K as z,Q as G,T as P}from"./index-BQmY0BmM.js";import{uploadReportPDF as $}from"./storageService-BUAGZT8Z.js";import"./lucide-react-CAeuRJQk.js";import"./driveService-ChwQKMyd.js";const N=(r,t,e,i,c)=>w(void 0,null,function*(){var m;try{const d=Date.now(),s=`${r}_${d}.pdf`;let a=null;try{a=yield $(e,r,void 0)}catch(l){const p=(l==null?void 0:l.message)||String(l);a=null}const n={reportType:r,title:t,startDate:(c==null?void 0:c.startDate)||null,endDate:(c==null?void 0:c.endDate)||null,fileUrl:(a==null?void 0:a.url)||"",fileName:s,fileSize:e.size,createdBy:i,createdAt:q(),metadata:(c==null?void 0:c.metadata)||null,storageProvider:(a==null?void 0:a.provider)||null,driveFileId:(a==null?void 0:a.fileId)||null,driveLink:(a==null?void 0:a.webViewLink)||(a==null?void 0:a.webContentLink)||null},g=yield z(A(R,"reports"),n),u=yield G(g);return h(y({id:g.id},u.data()),{createdAt:((m=u.data())==null?void 0:m.createdAt)||P.now()})}catch(d){throw d}}),Q=r=>w(void 0,null,function*(){var t;try{let e=D(A(R,"reports"),S("createdAt","desc"));return r!=null&&r.reportType&&(e=D(e,k("reportType","==",r.reportType))),r!=null&&r.createdBy&&(e=D(e,k("createdBy","==",r.createdBy))),(yield b(e)).docs.map(c=>y({id:c.id},c.data()))}catch(e){return console.error("Get saved reports error:",e),(e==null?void 0:e.code)==="failed-precondition"||(t=e==null?void 0:e.message)!=null&&t.includes("index")?(console.warn("Firestore index eksik, boş array döndürülüyor. Index oluşturulana kadar raporlar görünmeyecek."),[]):[]}});export{Q as getSavedReports,N as saveReport};
