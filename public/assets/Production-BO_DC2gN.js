import{a3 as K,k as oe,r as a,T as q,b as v,j as e,B as f,C as I,e as z,S as F,p as Y,q as E,s as U,t as j}from"./index-Xd90qdO9.js";import{y as de,M as V,B as $,a5 as me}from"./MainLayout-DW7UjMSA.js";import{S as ue}from"./search-input-QX7HVhJf.js";import{T as xe,a as he,b as _,c as d,d as pe,e as o}from"./table-CHpYTcky.js";import{C as H}from"./currency-BpxR3_y8.js";import{A as fe,a as ge,b as je,c as ye,d as be,e as Ne,f as we,g as Se}from"./alert-dialog-BVp-ELLM.js";import{C as De}from"./CreateOrderDialog-UaDZ5hoj.js";import{O as ke}from"./OrderDetailModal-DehNQxg3.js";import{L as Ce}from"./loading-state-CyTUOPV3.js";import{P as Te}from"./plus-D9uLCipi.js";import{S as ve}from"./square-pen-zeHrcQ7c.js";import{T as _e}from"./trash-2-DlZRXDqX.js";import"./taskService-CQO0i9v5.js";import"./CustomerCombobox-B9g9riZZ.js";import"./popover-BA39Kv9C.js";import"./CreateCustomerDialog-Ct1V89iV.js";import"./save-Bgz0wbo5.js";import"./truck-CIL1YvLr.js";import"./circle-dot-CCfpRgG9.js";import"./list-checks-CkcaKLuC.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ae=K("ArrowDown01",[["path",{d:"m3 16 4 4 4-4",key:"1co6wj"}],["path",{d:"M7 20V4",key:"1yoxec"}],["rect",{x:"15",y:"4",width:"4",height:"6",ry:"2",key:"1bwicg"}],["path",{d:"M17 20v-6h-2",key:"1qp1so"}],["path",{d:"M15 20h4",key:"1j968p"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Oe=K("ArrowUp01",[["path",{d:"m3 8 4-4 4 4",key:"11wl7u"}],["path",{d:"M7 4v16",key:"1glfcx"}],["rect",{x:"15",y:"4",width:"4",height:"6",ry:"2",key:"1bwicg"}],["path",{d:"M17 20v-6h-2",key:"1qp1so"}],["path",{d:"M15 20h4",key:"1j968p"}]]),Me=[{value:"planned",label:"Planlanan"},{value:"in_production",label:"Üretimde"},{value:"quality_check",label:"Kalite Kontrol"},{value:"completed",label:"Tamamlandı"},{value:"on_hold",label:"Beklemede"}],et=()=>{oe();const[A,G]=a.useState([]),[y,O]=a.useState(!0),[Q,M]=a.useState(!1),[J,b]=a.useState(!1),[W,N]=a.useState(!1),[w,S]=a.useState(null),[x,X]=a.useState(""),[h,Z]=a.useState("created_at"),[p,ee]=a.useState("desc"),[m,te]=a.useState("all"),[L,Le]=a.useState(null),[u,D]=a.useState(1),[k,se]=a.useState(1);a.useEffect(()=>{g()},[h,p,m,x,u]),a.useEffect(()=>{u!==1&&D(1)},[m,h,p]),a.useEffect(()=>{const t=setTimeout(()=>{u!==1&&D(1),g()},300);return()=>clearTimeout(t)},[x]);const g=async()=>{O(!0);try{const t={};m!=="all"&&(t.status=m);let i=await de(t);if(x){const n=x.toLocaleLowerCase("tr-TR");i=i.filter(c=>{var l,r,R,B,P;return((l=c.order_number)==null?void 0:l.toLocaleLowerCase("tr-TR").includes(n))||((r=c.orderNumber)==null?void 0:r.toLocaleLowerCase("tr-TR").includes(n))||((R=c.product_name)==null?void 0:R.toLocaleLowerCase("tr-TR").includes(n))||((B=c.customer_name)==null?void 0:B.toLocaleLowerCase("tr-TR").includes(n))||((P=c.customerName)==null?void 0:P.toLocaleLowerCase("tr-TR").includes(n))})}i.sort((n,c)=>{let l,r;return h==="created_at"||h==="priority"?(l=n.createdAt,r=c.createdAt):h==="due_date"?(l=n.dueDate||n.deliveryDate,r=c.dueDate||c.deliveryDate):(l=n.orderNumber||"",r=c.orderNumber||""),l instanceof q&&(l=l.toMillis()),r instanceof q&&(r=r.toMillis()),l instanceof Date&&(l=l.getTime()),r instanceof Date&&(r=r.getTime()),p==="asc"?l>r?1:-1:l<r?1:-1});const C=(u-1)*50,T=C+50;G(i.slice(C,T)),se(Math.ceil(i.length/50))}catch(t){console.error("Fetch production orders error:",t),v.error(t.message||"Siparişler yüklenirken hata oluştu")}finally{O(!1)}},ae=t=>({planned:"Planlanan",in_production:"Üretimde",quality_check:"Kalite Kontrol",completed:"Tamamlandı",on_hold:"Beklemede"})[t]||t,le=t=>({planned:"bg-indigo-100 text-indigo-800 border-indigo-300",in_production:"bg-orange-100 text-orange-800 border-orange-300",quality_check:"bg-cyan-100 text-cyan-800 border-cyan-300",completed:"bg-green-100 text-green-800 border-green-300",on_hold:"bg-amber-100 text-amber-800 border-amber-300"})[t]||"bg-gray-100 text-gray-800 border-gray-300",re=t=>{if(!t)return"-";let s=null;if(t instanceof Date)s=t;else if(typeof t=="string")s=new Date(t);else if(t&&typeof t=="object")if("seconds"in t&&typeof t.seconds=="number")s=new Date(t.seconds*1e3);else if("toDate"in t&&typeof t.toDate=="function")try{s=t.toDate()}catch{return"-"}else"_seconds"in t&&typeof t._seconds=="number"&&(s=new Date(t._seconds*1e3));if(!s||isNaN(s.getTime()))return"-";try{return s.toLocaleDateString("tr-TR",{day:"2-digit",month:"short",year:"numeric"})}catch{return"-"}},ne=t=>t==null?{label:"Öncelik: 0",className:"bg-muted text-muted-foreground"}:t>=4?{label:`Öncelik: ${t}`,className:"bg-destructive/15 text-destructive"}:t>=2?{label:`Öncelik: ${t}`,className:"bg-amber-100 text-amber-800"}:{label:`Öncelik: ${t}`,className:"bg-slate-200 text-slate-800"},ie=(t,s)=>{if(t==null)return`${s&&H[s]||"₺"}0,00`;const i=s||"TRY",C=i==="TRY"?"TRY":i,T=i==="TRY"?"tr-TR":"en-US",n=H[i]||"₺";try{return new Intl.NumberFormat(T,{style:"currency",currency:C,minimumFractionDigits:2}).format(t)}catch{return`${n}${t.toFixed(2)}`}},ce=async()=>{if(w)try{await me(w.id),v.success("Sipariş silindi"),g(),N(!1),S(null)}catch(t){console.error("Delete production order error:",t),v.error(t.message||"Sipariş silinirken hata oluştu")}};return y?e.jsx(V,{children:e.jsx(Ce,{message:"Üretim siparişleri yükleniyor..."})}):e.jsxs(V,{children:[e.jsxs("div",{className:"space-y-3 sm:space-y-4 md:space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3 sm:gap-4",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h1",{className:"text-xl sm:text-2xl md:text-3xl font-bold text-foreground",children:"Üretim Siparişleri"}),e.jsx("p",{className:"text-muted-foreground mt-0.5 sm:mt-1 text-xs sm:text-sm",children:"Üretim süreçlerini yönetin"})]}),e.jsxs(f,{className:"gap-2 w-full sm:w-auto min-h-[44px] sm:min-h-0",onClick:()=>M(!0),children:[e.jsx(Te,{className:"h-4 w-4"}),"Yeni Sipariş"]})]}),e.jsx(I,{children:e.jsx(z,{className:"p-4 sm:p-6",children:e.jsxs("div",{className:"flex flex-wrap items-center gap-3 sm:gap-4",children:[e.jsx("div",{className:"flex-1 min-w-[200px] sm:min-w-[250px]",children:e.jsx(ue,{placeholder:"Sipariş ara...",className:"w-full h-10",value:x,onChange:t=>X(t.target.value)})}),e.jsx("div",{className:"w-full sm:w-auto sm:min-w-[180px]",children:e.jsxs(F,{value:m==="all"?"all":m,onValueChange:t=>te(t),children:[e.jsx(Y,{className:"w-full h-10",children:e.jsx(E,{placeholder:"Durum Filtrele"})}),e.jsxs(U,{children:[e.jsx(j,{value:"all",children:"Tüm Durumlar"}),Me.map(t=>e.jsx(j,{value:t.value,children:t.label},t.value))]})]})}),e.jsx("div",{className:"w-full sm:w-auto sm:min-w-[180px]",children:e.jsxs(F,{value:h,onValueChange:t=>Z(t),children:[e.jsx(Y,{className:"w-full h-10",children:e.jsx(E,{placeholder:"Sırala"})}),e.jsxs(U,{children:[e.jsx(j,{value:"created_at",children:"Tarihe Göre"}),e.jsx(j,{value:"priority",children:"Önceliğe Göre"}),e.jsx(j,{value:"due_date",children:"Termin Tarihine Göre"})]})]})}),e.jsxs(f,{variant:"outline",size:"sm",onClick:()=>ee(p==="asc"?"desc":"asc"),className:"h-10",children:[p==="asc"?e.jsx(Oe,{className:"h-4 w-4 mr-2"}):e.jsx(Ae,{className:"h-4 w-4 mr-2"}),p==="asc"?"Artan":"Azalan"]})]})})}),e.jsx(I,{children:e.jsxs(z,{className:"p-0",children:[e.jsx("div",{className:"overflow-x-auto -mx-4 sm:mx-0",children:e.jsx("div",{className:"inline-block min-w-full align-middle px-4 sm:px-0",children:e.jsxs(xe,{className:"min-w-[1000px]",children:[e.jsx(he,{children:e.jsxs(_,{children:[e.jsx(d,{children:"Sipariş No"}),e.jsx(d,{children:"Müşteri"}),e.jsx(d,{children:"Ürün / Miktar"}),e.jsx(d,{children:"Termin"}),e.jsx(d,{children:"Durum"}),e.jsx(d,{children:"Öncelik"}),e.jsx(d,{className:"text-right",children:"Tutar"}),e.jsx(d,{className:"text-right",children:"İşlemler"})]})}),e.jsxs(pe,{children:[A.map(t=>{const s=ne(t.priority);return e.jsxs(_,{className:"cursor-pointer hover:bg-muted/50 transition-colors",onClick:()=>{S(t),b(!0)},children:[e.jsx(o,{className:"font-medium",children:t.order_number||t.orderNumber||"-"}),e.jsx(o,{children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-medium",children:t.customer_name||t.customerName||"-"}),t.customer_company&&e.jsx("span",{className:"text-xs text-muted-foreground",children:t.customer_company})]})}),e.jsx(o,{children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-medium",children:t.product_name||t.productName||"-"}),t.quantity&&e.jsxs("span",{className:"text-xs text-muted-foreground",children:[t.quantity," ",t.unit||"Adet"]})]})}),e.jsx(o,{children:re(t.due_date||t.dueDate||t.created_at||t.createdAt)}),e.jsx(o,{children:e.jsx($,{className:le(t.status),children:ae(t.status)})}),e.jsx(o,{children:e.jsx($,{className:s.className,children:s.label})}),e.jsx(o,{className:"text-right font-semibold",children:ie(t.totalAmount||t.total_amount||0,t.currency)}),e.jsx(o,{className:"text-right",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",onClick:i=>i.stopPropagation(),children:[e.jsx(f,{variant:"outline",size:"sm",onClick:()=>{S(t),b(!0)},disabled:L===t.id,children:e.jsx(ve,{className:"h-4 w-4"})}),e.jsx(f,{variant:"outline",size:"sm",onClick:()=>{S(t),N(!0)},disabled:L===t.id,children:e.jsx(_e,{className:"h-4 w-4"})})]})})]},t.id)}),A.length===0&&!y&&e.jsx(_,{children:e.jsx(o,{colSpan:8,className:"text-center py-8 text-muted-foreground",children:x||m!=="all"?"Arama sonucu bulunamadı":"Henüz üretim siparişi bulunmuyor"})})]})]})})}),k>1&&e.jsxs("div",{className:"flex flex-col gap-3 mt-4 md:flex-row md:items-center md:justify-between",children:[e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Sayfa ",u," / ",k]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(f,{variant:"outline",size:"sm",onClick:()=>D(t=>Math.max(1,t-1)),disabled:u===1||y,children:"Önceki"}),e.jsx(f,{variant:"outline",size:"sm",onClick:()=>D(t=>Math.min(k,t+1)),disabled:u===k||y,children:"Sonraki"})]})]})]})})]}),e.jsx(De,{open:Q,onOpenChange:M,onSuccess:g}),w&&e.jsx(ke,{open:J,onOpenChange:b,order:w,onDelete:()=>{b(!1),N(!0)},onUpdate:g}),e.jsx(fe,{open:W,onOpenChange:N,children:e.jsxs(ge,{children:[e.jsxs(je,{children:[e.jsx(ye,{children:"Siparişi sil?"}),e.jsx(be,{children:"Bu işlem geri alınamaz. Sipariş kalıcı olarak silinecek."})]}),e.jsxs(Ne,{children:[e.jsx(we,{children:"İptal"}),e.jsx(Se,{onClick:ce,children:"Sil"})]})]})})]})};export{et as default};
