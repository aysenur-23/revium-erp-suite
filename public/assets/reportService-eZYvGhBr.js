import{z as n,x as D,M as g,N as h,D as w,E as k,Q as o,H as x,F as R,T as A}from"./index-Xd90qdO9.js";import{uploadReportPDF as B}from"./storageService-pEqhfEwa.js";import"./driveService-020R8zku.js";const S=async(r,c,a,i,t)=>{var m;try{const s=Date.now(),u=`${r}_${s}.pdf`;let e=null;try{e=await B(a,r,void 0)}catch(d){const F=(d==null?void 0:d.message)||String(d);e=null}const v={reportType:r,title:c,startDate:(t==null?void 0:t.startDate)||null,endDate:(t==null?void 0:t.endDate)||null,fileUrl:(e==null?void 0:e.url)||"",fileName:u,fileSize:a.size,createdBy:i,createdAt:o(),metadata:(t==null?void 0:t.metadata)||null,storageProvider:(e==null?void 0:e.provider)||null,driveFileId:(e==null?void 0:e.fileId)||null,driveLink:(e==null?void 0:e.webViewLink)||(e==null?void 0:e.webContentLink)||null},l=await x(D(g,"reports"),v),y=await R(l);return{id:l.id,...y.data(),createdAt:((m=y.data())==null?void 0:m.createdAt)||A.now()}}catch(s){throw s}},b=async r=>{var c;try{let a=n(D(g,"reports"),h("createdAt","desc"));return r!=null&&r.reportType&&(a=n(a,w("reportType","==",r.reportType))),r!=null&&r.createdBy&&(a=n(a,w("createdBy","==",r.createdBy))),(await k(a)).docs.map(t=>({id:t.id,...t.data()}))}catch(a){return console.error("Get saved reports error:",a),(a==null?void 0:a.code)==="failed-precondition"||(c=a==null?void 0:a.message)!=null&&c.includes("index")?(console.warn("Firestore index eksik, boş array döndürülüyor. Index oluşturulana kadar raporlar görünmeyecek."),[]):[]}};export{b as getSavedReports,S as saveReport};
