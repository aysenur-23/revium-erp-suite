[{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\eslint.config.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\functions\\.eslintrc.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\functions\\src\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\postcss.config.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public\\assets\\Admin-0Fo3q3pj.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public\\assets\\Admin-BRZE4rHI.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public\\assets\\CreateCustomerDialog-C7Uvoya8.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public\\assets\\CreateCustomerDialog-Ct1V89iV.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public\\assets\\CreateOrderDialog-BMioWDNS.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public\\assets\\CreateOrderDialog-C62L0stY.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public\\assets\\CreateOrderDialog-Di2tky-V.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public\\assets\\CreateOrderDialog-UaDZ5hoj.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public\\assets\\CustomerCombobox-B9g9riZZ.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public\\assets\\CustomerCombobox-LwAUFZox.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public\\assets\\CustomerDetailModal-D1Gwzqrs.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public\\assets\\CustomerDetailModal-DKJKtFVM.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public\\assets\\Customers-CUOT9w7t.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public\\assets\\Customers-D_wHKmvX.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public\\assets\\Dashboard-Cd021t-a.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public\\assets\\Dashboard-leWEM6OP.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public\\assets\\DepartmentDetailModal-CjqXK3b9.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public\\assets\\DepartmentDetailModal-eftmRmp7.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public\\assets\\DetailedValueReportModal-BRj7dqdh.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public\\assets\\DetailedValueReportModal-Hb3qQukI.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public\\assets\\MainLayout-DW7UjMSA.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public\\assets\\MainLayout-Dv9j77B5.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public\\assets\\Notifications-Bjwjam8f.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public\\assets\\Notifications-k-mcjnZU.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public\\assets\\OrderDetailModal-BnPVxs_W.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public\\assets\\OrderDetailModal-DehNQxg3.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public\\assets\\Orders-ByhjdmG5.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public\\assets\\Orders-DGg9ENAG.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public\\assets\\Production-BO_DC2gN.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public\\assets\\Production-Ds8dXTpq.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public\\assets\\Products-BpS_Hh3O.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public\\assets\\Products-CD-v0evj.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public\\assets\\Profile-D3uSTI2i.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public\\assets\\Profile-DQuLyO5P.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public\\assets\\Projects-CCMlHBeL.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public\\assets\\Projects-a9Z7ut5S.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public\\assets\\RawMaterials-BAsM9hfQ.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public\\assets\\RawMaterials-D-hG636A.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public\\assets\\Reports-Bblk1VGx.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public\\assets\\Reports-DVW0fROy.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public\\assets\\Requests-CGC9XHEO.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public\\assets\\Requests-D2rFGBYl.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public\\assets\\Settings-DBQkX1YU.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public\\assets\\Settings-DSbQg3ek.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public\\assets\\StatCard-Dh2Sp8Wp.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public\\assets\\StatCard-qsBkiUPn.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public\\assets\\TaskBoard-BI6dI0L7.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public\\assets\\TaskBoard-fwyGe4xh.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public\\assets\\TaskDetail-CuRZUy-b.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public\\assets\\TaskDetail-ar69kH0H.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public\\assets\\TaskDetailModal-Bwb1Je3g.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public\\assets\\TaskDetailModal-DYo7pzLX.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public\\assets\\TaskInlineForm-BjPlHrJk.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public\\assets\\TaskInlineForm-CDqKbM2W.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public\\assets\\TaskPool-BH52gMfq.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public\\assets\\TaskPool-CTAdN623.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public\\assets\\Tasks-CkJtzJaY.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public\\assets\\Tasks-j5VmRSrX.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public\\assets\\TasksArchive-DOMiRHnq.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public\\assets\\TasksArchive-Nwo1H-U5.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public\\assets\\TeamManagement-D6To5UvI.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public\\assets\\TeamManagement-DvELcpKp.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public\\assets\\UserMultiSelect-BycFT8u0.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public\\assets\\UserMultiSelect-KlPlOKAA.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public\\assets\\Warranty-BZnZOps6.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public\\assets\\Warranty-EX25GULt.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public\\assets\\addDays-DpNspVkx.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public\\assets\\addDays-b8IynWul.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public\\assets\\alert-dialog-BVp-ELLM.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public\\assets\\alert-dialog-vDPnsgl6.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public\\assets\\arrow-up-CYB1EkPb.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public\\assets\\avatar-CROuoa6p.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public\\assets\\avatar-KtUT5CWN.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public\\assets\\calendar-days-DIIfLF_e.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public\\assets\\chart-column-tcYl_7Fa.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public\\assets\\checkbox-BX7aNvy5.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public\\assets\\checkbox-DKBysPlW.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public\\assets\\circle-dot-CCfpRgG9.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public\\assets\\currency-BpxR3_y8.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public\\assets\\download-Bq-rl9Ru.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public\\assets\\driveService-020R8zku.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public\\assets\\driveService-ChwQKMyd.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public\\assets\\ellipsis-vertical-gVlTlFy-.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public\\assets\\exchangeRateService-Ba2gZPdu.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public\\assets\\exchangeRateService-Cpnvl6ZU.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public\\assets\\folder-DUFwF4S_.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public\\assets\\format-CN3feEER.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public\\assets\\format-DuC-NjES.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public\\assets\\formatLastLogin-BEZSaV0P.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public\\assets\\formatLastLogin-CD2ke5e-.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public\\assets\\html2canvas.esm-CBrSDip1.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public\\assets\\html2canvas.esm-CiaFdv3w.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public\\assets\\index-BQmY0BmM.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public\\assets\\index-Xd90qdO9.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public\\assets\\index.es-B98sUMqv.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public\\assets\\index.es-DFaL_L0y.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public\\assets\\isBefore-CpsBulHW.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public\\assets\\isBefore-DY2_5hKP.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public\\assets\\isSameDay-CbFR9PGK.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public\\assets\\isSameDay-CmhUF_DM.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public\\assets\\isToday-C_-qpr0F.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public\\assets\\isToday-imnuOj2q.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public\\assets\\list-checks-CkcaKLuC.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public\\assets\\loading-state-BC76X596.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public\\assets\\loading-state-CyTUOPV3.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public\\assets\\lucide-react-CAeuRJQk.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public\\assets\\map-pin-CYdnXw-f.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public\\assets\\materialService-BHW8dEom.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public\\assets\\materialService-fdlP1ZS7.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public\\assets\\message-square-BAQ_w3zD.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public\\assets\\pdfGenerator-CpYttanq.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public\\assets\\pdfGenerator-H9L-JbYf.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public\\assets\\permissions-D79DzJt5.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public\\assets\\permissions-gaCIgPOa.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public\\assets\\plus-D9uLCipi.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public\\assets\\popover-BA39Kv9C.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public\\assets\\popover-Bq_PZ6uK.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public\\assets\\progress-DCzQFBA2.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public\\assets\\progress-DSBhhNxd.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public\\assets\\purify.es-BXGrFVc7.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public\\assets\\purify.es-sOfw8HaZ.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public\\assets\\recipeService-B644vMa2.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public\\assets\\recipeService-CoAKsRoE.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public\\assets\\reportService-eZYvGhBr.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public\\assets\\reportService-yUgxtgcG.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public\\assets\\requestService-BTFAUymV.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public\\assets\\requestService-BZtc3QPN.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public\\assets\\rolePermissionsService-BQ7cNajw.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public\\assets\\rolePermissionsService-CoZ8Qmsy.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public\\assets\\save-Bgz0wbo5.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public\\assets\\search-input-DCf0xYml.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public\\assets\\search-input-QX7HVhJf.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public\\assets\\send-DtcYVw6S.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public\\assets\\separator-BNuYyAQ9.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public\\assets\\separator-C1rUq6WW.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public\\assets\\skeleton-DkPhyqEs.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public\\assets\\skeleton-jcdN6-ik.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public\\assets\\square-pen-zeHrcQ7c.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public\\assets\\storageService-BUAGZT8Z.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public\\assets\\storageService-pEqhfEwa.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public\\assets\\subDays-BSPI1LCX.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public\\assets\\subDays-DIU4Ell8.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public\\assets\\switch-Bq-e7DDF.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public\\assets\\switch-CUw8XPh6.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public\\assets\\table-CHpYTcky.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public\\assets\\table-zhTdMUM_.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public\\assets\\tag-EYbV-h0Y.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public\\assets\\taskService-CI62TrOj.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public\\assets\\taskService-CQO0i9v5.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public\\assets\\toastHelpers-DkuKGmwM.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public\\assets\\toastHelpers-I2G9dhou.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public\\assets\\trash-2-DlZRXDqX.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public\\assets\\trending-up-DyiN6Ad2.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public\\assets\\truck-CIL1YvLr.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public\\assets\\user-plus-DWuSLDZe.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public\\assets\\warrantyService-BpM1Aiia.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\ActivityCommentsPanel-DXz2Pza0.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\Admin-0Fo3q3pj.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\Admin-BRZE4rHI.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\CompanySettings-fDKdZ1oO.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\CreateCustomerDialog-C7Uvoya8.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\CreateCustomerDialog-CTvVHj5C.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\CreateCustomerDialog-Ct1V89iV.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\CreateOrderDialog-BMioWDNS.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\CreateOrderDialog-C62L0stY.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\CreateOrderDialog-Di2tky-V.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\CreateOrderDialog-UaDZ5hoj.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\CustomerCombobox-B9g9riZZ.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\CustomerCombobox-LwAUFZox.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\CustomerCombobox-NJSRZMVT.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\CustomerDetailModal-D1Gwzqrs.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\CustomerDetailModal-D7MEL0J9.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\CustomerDetailModal-DKJKtFVM.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\CustomerReportDialog-Ds1V1iZu.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\Customers-B3cTJ8m7.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\Customers-CUOT9w7t.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\Customers-D_wHKmvX.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\Dashboard-Cd021t-a.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\Dashboard-Cn2ftghM.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\Dashboard-leWEM6OP.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\DepartmentDetailModal-CjqXK3b9.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\DepartmentDetailModal-eftmRmp7.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\DetailedValueReportModal-BRj7dqdh.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\DetailedValueReportModal-C8yng4KC.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\DetailedValueReportModal-Hb3qQukI.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\FinancialReportDialog-B2tu__Md.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\MainLayout-DW7UjMSA.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\MainLayout-Dv9j77B5.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\Notifications-Bjwjam8f.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\Notifications-Bl5Ot_G5.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\Notifications-k-mcjnZU.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\OrderDetailModal-BnPVxs_W.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\OrderDetailModal-DehNQxg3.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\Orders-ByhjdmG5.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\Orders-CtUGD7jh.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\Orders-DGg9ENAG.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\PendingTaskApprovals-wt11dBTp.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\Production-BO_DC2gN.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\Production-BkzP2NCI.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\Production-Ds8dXTpq.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\ProductionReportDialog-CmM2ydgG.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\Products-BpS_Hh3O.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\Products-CD-v0evj.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\Products-Ipr5kjcg.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\Profile-BCt3ZoNl.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\Profile-D3uSTI2i.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\Profile-DQuLyO5P.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\ProfileSettings-CqCvPHM4.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\Projects-CCMlHBeL.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\Projects-DoUmTrRT.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\Projects-a9Z7ut5S.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\RawMaterials-520lKsSI.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\RawMaterials-BAsM9hfQ.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\RawMaterials-D-hG636A.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\Reports-BGaHarg8.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\Reports-Bblk1VGx.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\Reports-DVW0fROy.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\Requests-BnpK-cSq.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\Requests-CGC9XHEO.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\Requests-D2rFGBYl.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\ResponsiveTable-C9Kyt361.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\SalesQuoteForm-W9NLzgXo.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\SalesReportDialog-CN_U4cTj.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\Settings-B3Iw3V6H.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\Settings-DBQkX1YU.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\Settings-DSbQg3ek.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\StatCard-Bwg9pPpo.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\StatCard-Dh2Sp8Wp.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\StatCard-qsBkiUPn.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\TaskBoard-BI6dI0L7.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\TaskBoard-D17zD_sg.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\TaskBoard-fwyGe4xh.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\TaskDetail-CAT20nr2.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\TaskDetail-CuRZUy-b.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\TaskDetail-ar69kH0H.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\TaskDetailModal-Bwb1Je3g.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\TaskDetailModal-DYo7pzLX.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\TaskHistory-DCfe9IWz.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\TaskInlineForm-BjPlHrJk.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\TaskInlineForm-CDqKbM2W.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\TaskInlineForm-CaOJh-hh.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\TaskPool-BH52gMfq.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\TaskPool-CTAdN623.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\TaskPool-Lc5-5GD-.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\Tasks-BQvoA9Nr.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\Tasks-CkJtzJaY.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\Tasks-j5VmRSrX.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\TasksArchive-BpmHqdp1.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\TasksArchive-DOMiRHnq.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\TasksArchive-Nwo1H-U5.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\TeamManagement-BxhYWZMf.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\TeamManagement-D6To5UvI.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\TeamManagement-DvELcpKp.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\TeamMembers-bkO2yl0b.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\TeamStatsView--0p2SAzo.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\UserMultiSelect-BycFT8u0.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\UserMultiSelect-KlPlOKAA.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\Warranty-BZnZOps6.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\Warranty-CT-Lm6qo.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\Warranty-EX25GULt.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\addDays-DpNspVkx.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\addDays-b8IynWul.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\alert-dialog-BVp-ELLM.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\alert-dialog-vDPnsgl6.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\arrow-up-CYB1EkPb.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\avatar-CROuoa6p.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\avatar-KtUT5CWN.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\calendar-BP8UHdFt.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\calendar-days-DIIfLF_e.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\chart-column-tcYl_7Fa.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\checkbox-BX7aNvy5.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\checkbox-DKBysPlW.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\circle-dot-CCfpRgG9.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\currency-BpxR3_y8.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\download-Bq-rl9Ru.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\driveService-020R8zku.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\driveService-ChwQKMyd.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\ellipsis-vertical-gVlTlFy-.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\exchangeRateService-BXQ2GwZn.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\exchangeRateService-Ba2gZPdu.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\exchangeRateService-Cpnvl6ZU.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\folder-DUFwF4S_.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\format-CN3feEER.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\format-DuC-NjES.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\formatLastLogin-BEZSaV0P.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\formatLastLogin-CD2ke5e-.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\html2canvas.esm-CBrSDip1.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\html2canvas.esm-CiaFdv3w.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\index-BQmY0BmM.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\index-JaWMujla.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\index-Xd90qdO9.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\index.es-B98sUMqv.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\index.es-BICrbsct.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\index.es-DFaL_L0y.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\isBefore-CpsBulHW.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\isBefore-DY2_5hKP.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\isSameDay-CbFR9PGK.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\isSameDay-CmhUF_DM.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\isToday-C_-qpr0F.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\isToday-imnuOj2q.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\list-checks-CkcaKLuC.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\loading-state-BC76X596.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\loading-state-CyTUOPV3.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\loading-state-Dfb3ifQ1.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\lucide-react-CAeuRJQk.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\map-pin-CYdnXw-f.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\materialService-BHW8dEom.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\materialService-fdlP1ZS7.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\message-square-BAQ_w3zD.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\pdfGenerator-CpYttanq.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\pdfGenerator-H9L-JbYf.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\permissions-D79DzJt5.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\permissions-gaCIgPOa.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\plus-D9uLCipi.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\popover-BA39Kv9C.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\popover-Bq_PZ6uK.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\popover-DEC_C8Gd.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\priority-DjPsOOkO.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\progress-DCzQFBA2.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\progress-DSBhhNxd.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\purify.es-BXGrFVc7.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\purify.es-sOfw8HaZ.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\recipeService-B644vMa2.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\recipeService-CoAKsRoE.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\reportService-eZYvGhBr.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\reportService-yUgxtgcG.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\requestService-BTFAUymV.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\requestService-BZtc3QPN.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\rolePermissionsService-BQ7cNajw.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\rolePermissionsService-CoZ8Qmsy.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\save-Bgz0wbo5.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\scroll-area-CrNoZzd8.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\search-input-DCf0xYml.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\search-input-QX7HVhJf.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\send-DtcYVw6S.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\separator-BNuYyAQ9.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\separator-C1rUq6WW.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\skeleton-DkPhyqEs.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\skeleton-jcdN6-ik.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\square-pen-zeHrcQ7c.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\storageService-BUAGZT8Z.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\storageService-pEqhfEwa.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\subDays-BSPI1LCX.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\subDays-DIU4Ell8.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\switch-Bq-e7DDF.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\switch-CUw8XPh6.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\table-CHpYTcky.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\table-zhTdMUM_.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\tag-EYbV-h0Y.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\taskService-CI62TrOj.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\taskService-CQO0i9v5.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\toastHelpers-DTmP_pdy.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\toastHelpers-DkuKGmwM.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\toastHelpers-I2G9dhou.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\trash-2-DlZRXDqX.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\trending-up-DyiN6Ad2.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\truck-CIL1YvLr.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\user-plus-DWuSLDZe.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\validateTeamLeader-hOz2ha_k.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\vendor-firebase-DGeOnAS8.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\vendor-pdf-V47VfPU5.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\vendor-react-BEIwRqd1.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\public_html\\assets\\warrantyService-BpM1Aiia.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\scripts\\build-for-hostinger.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\scripts\\convert-logo-to-base64.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\scripts\\deploy-firestore-rules.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\scripts\\setTeamLeader.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\server\\server.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\server\\test-api.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\server\\test-email.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\App.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\assets\\fonts\\roboto-base64.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\assets\\rev-logo-base64.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\components\\AdminRoute.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\components\\Admin\\AdminDashboard.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\components\\Admin\\AuditLogs.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\components\\Admin\\DepartmentDetailModal.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchDepartmentDetails'. Either include it or remove the dependency array.","line":39,"column":6,"nodeType":"ArrayExpression","endLine":39,"endColumn":26,"suggestions":[{"desc":"Update the dependencies array to be: [open, departmentId, fetchDepartmentDetails]","fix":{"range":[1621,1641],"text":"[open, departmentId, fetchDepartmentDetails]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from \"react\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogHeader,\n  DialogTitle,\n  DialogDescription,\n} from \"@/components/ui/dialog\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Progress } from \"@/components/ui/progress\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from \"@/components/ui/table\";\nimport { Building2, Users, CheckSquare, Clock, TrendingUp, User, Mail, Phone } from \"lucide-react\";\nimport { getDepartmentById } from \"@/services/firebase/departmentService\";\nimport { getAllUsers, UserProfile } from \"@/services/firebase/authService\";\nimport { getTasks, Task } from \"@/services/firebase/taskService\";\nimport { format } from \"date-fns\";\nimport { tr } from \"date-fns/locale\";\nimport { Department, DepartmentWithStats } from \"@/services/firebase/departmentService\";\n\ninterface DepartmentDetailModalProps {\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n  departmentId: string;\n}\n\nexport const DepartmentDetailModal = ({ open, onOpenChange, departmentId }: DepartmentDetailModalProps) => {\n  const [department, setDepartment] = useState<DepartmentWithStats | null>(null);\n  const [members, setMembers] = useState<UserProfile[]>([]);\n  const [tasks, setTasks] = useState<Task[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [manager, setManager] = useState<UserProfile | null>(null);\n\n  useEffect(() => {\n    if (open && departmentId) {\n      fetchDepartmentDetails();\n    }\n  }, [open, departmentId]);\n\n  const fetchDepartmentDetails = async () => {\n    setLoading(true);\n    try {\n      const [dept, allUsers, allTasks] = await Promise.all([\n        getDepartmentById(departmentId),\n        getAllUsers(),\n        getTasks(),\n      ]);\n\n      setDepartment(dept);\n\n      // Manager bilgisini al (sadece silinmemi kullanclar)\n      if (dept.managerId) {\n        const managerUser = allUsers.find(u => u.id === dept.managerId && !('deleted' in u && u.deleted));\n        setManager(managerUser || null);\n      } else {\n        setManager(null);\n      }\n\n      // Departmana ait yeleri bul (approvedTeams, pendingTeams veya departmentId ile)\n      const deptMembers = allUsers.filter(u => {\n        // Direkt departman ID'si eleiyorsa\n        if (u.departmentId === departmentId) return true;\n        // Onaylanm ekiplerde varsa\n        if (u.approvedTeams && u.approvedTeams.includes(departmentId)) return true;\n        // Bekleyen ekiplerde varsa\n        if (u.pendingTeams && u.pendingTeams.includes(departmentId)) return true;\n        return false;\n      });\n      setMembers(deptMembers);\n\n      // Departmana ait grevleri bul - birden fazla yntemle\n      const teamMemberIds = new Set(deptMembers.map(u => u.id));\n      const deptTasks = allTasks.filter(t => {\n        // 1. productionProcessId ile direkt balant\n        if (t.productionProcessId === departmentId) return true;\n        \n        // 2. Grev ekip yelerinden birine atanmsa\n        if (t.assignedUsers && Array.isArray(t.assignedUsers)) {\n          const hasAssignedMember = t.assignedUsers.some((u: string | { id?: string; assignedTo?: string; userId?: string }) => {\n            if (typeof u === 'string') return teamMemberIds.has(u);\n            if (u && typeof u === 'object') {\n              const userId = u.id || u.assignedTo || u.userId;\n              return userId && teamMemberIds.has(userId);\n            }\n            return false;\n          });\n          if (hasAssignedMember) return true;\n        }\n        \n        // 3. Grev ekip yelerinden biri tarafndan oluturulmusa\n        if (t.createdBy && teamMemberIds.has(t.createdBy)) return true;\n        \n        return false;\n      });\n      setTasks(deptTasks);\n    } catch (error) {\n      if (import.meta.env.DEV) {\n        console.error(\"Error fetching department details:\", error);\n      }\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const stats = {\n    totalMembers: members.length,\n    activeTasks: tasks.filter(t => t.status !== \"completed\" && t.status !== \"cancelled\").length,\n    completedTasks: tasks.filter(t => t.status === \"completed\").length,\n    pendingTasks: tasks.filter(t => t.status === \"pending\").length,\n    inProgressTasks: tasks.filter(t => t.status === \"in_progress\").length,\n    completionRate: tasks.length > 0 \n      ? (tasks.filter(t => t.status === \"completed\").length / tasks.length) * 100 \n      : 0,\n  };\n\n  const getStatusBadgeColor = (status: string) => {\n    switch (status) {\n      case \"completed\":\n        return \"bg-green-500\";\n      case \"in_progress\":\n        return \"bg-blue-500\";\n      case \"pending\":\n        return \"bg-yellow-500\";\n      case \"cancelled\":\n        return \"bg-red-500\";\n      default:\n        return \"bg-gray-500\";\n    }\n  };\n\n  const getStatusLabel = (status: string) => {\n    switch (status) {\n      case \"completed\":\n        return \"Tamamland\";\n      case \"in_progress\":\n        return \"Devam Ediyor\";\n      case \"pending\":\n        return \"Beklemede\";\n      case \"cancelled\":\n        return \"ptal Edildi\";\n      default:\n        return status;\n    }\n  };\n\n  return (\n    <Dialog open={open} onOpenChange={onOpenChange}>\n      <DialogContent className=\"!max-w-[100vw] sm:!max-w-[85vw] !w-[100vw] sm:!w-[85vw] !h-[100vh] sm:!h-[80vh] !max-h-[100vh] sm:!max-h-[80vh] !left-0 sm:!left-[7.5vw] !top-0 sm:!top-[10vh] !right-0 sm:!right-auto !bottom-0 sm:!bottom-auto !translate-x-0 !translate-y-0 overflow-hidden !p-0 gap-0 bg-white flex flex-col !m-0 !rounded-none sm:!rounded-lg !border-0 sm:!border\">\n        {/* DialogTitle ve DialogDescription DialogContent'in direkt child' olmal (Radix UI gereksinimi) */}\n        <DialogTitle className=\"sr-only\">\n          {loading ? \"Ykleniyor...\" : department?.name ? `${department.name} - Departman Detaylar` : \"Departman Detaylar\"}\n        </DialogTitle>\n        <DialogDescription className=\"sr-only\">\n          {department?.description || \"Departman detaylar ve bilgileri\"}\n        </DialogDescription>\n        \n        <div className=\"flex flex-col h-full min-h-0\">\n          <DialogHeader className=\"p-3 sm:p-4 border-b bg-white flex-shrink-0\">\n            <div className=\"flex items-center gap-2 sm:gap-3\">\n              <div className=\"h-8 w-8 sm:h-10 sm:w-10 rounded-lg bg-primary/10 flex items-center justify-center border border-primary/20 flex-shrink-0\">\n                <Building2 className=\"h-4 w-4 sm:h-5 sm:w-5 text-primary\" />\n              </div>\n              <div className=\"flex-1 min-w-0\">\n                <h2 className=\"text-xl sm:text-2xl font-semibold text-foreground truncate\">\n                  {loading ? \"Ykleniyor...\" : department?.name || \"Departman Detaylar\"}\n                </h2>\n                {department?.description && (\n                  <p className=\"text-xs text-muted-foreground truncate mt-0.5\">\n                    {department.description}\n                  </p>\n                )}\n              </div>\n            </div>\n          </DialogHeader>\n\n          <div className=\"flex-1 overflow-hidden bg-gray-50/50 p-3 sm:p-4 min-h-0\">\n            <div className=\"max-w-full mx-auto h-full overflow-y-auto\">\n              {loading ? (\n          <div className=\"space-y-3 sm:space-y-4\">\n            <Skeleton className=\"h-32 w-full\" />\n            <Skeleton className=\"h-64 w-full\" />\n            <Skeleton className=\"h-64 w-full\" />\n          </div>\n        ) : (\n          <div className=\"space-y-6\">\n            {/* Genel Bilgiler */}\n            <Card>\n              <CardHeader>\n                <CardTitle className=\"text-lg\">Genel Bilgiler</CardTitle>\n              </CardHeader>\n              <CardContent className=\"space-y-3 sm:space-y-4\">\n                <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4\">\n                  <div>\n                    <span className=\"text-sm font-medium text-muted-foreground\">Departman Ad</span>\n                    <p className=\"text-base font-semibold mt-1\">{department?.name}</p>\n                  </div>\n                  <div>\n                    <span className=\"text-sm font-medium text-muted-foreground\">Ynetici</span>\n                    <p className=\"text-base font-semibold mt-1\">\n                      {manager ? (manager.fullName || manager.email) : \"Atanmam\"}\n                    </p>\n                    {manager?.email && (\n                      <p className=\"text-xs text-muted-foreground mt-1\">{manager.email}</p>\n                    )}\n                  </div>\n                  {department?.description && (\n                    <div className=\"md:col-span-2\">\n                      <span className=\"text-sm font-medium text-muted-foreground\">Aklama</span>\n                      <p className=\"text-sm mt-1\">{department.description}</p>\n                    </div>\n                  )}\n                </div>\n              </CardContent>\n            </Card>\n\n            {/* statistikler */}\n            <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3 sm:gap-4\">\n              <Card className=\"bg-gradient-to-br from-blue-50 to-blue-100/50 border-blue-200\">\n                <CardContent className=\"p-4\">\n                  <div className=\"flex items-center justify-between\">\n                    <div>\n                      <p className=\"text-sm font-medium text-blue-700\">Toplam ye</p>\n                      <p className=\"text-2xl font-bold text-blue-900 mt-1\">{stats.totalMembers}</p>\n                    </div>\n                    <Users className=\"h-8 w-8 text-blue-600\" />\n                  </div>\n                </CardContent>\n              </Card>\n\n              <Card className=\"bg-gradient-to-br from-yellow-50 to-yellow-100/50 border-yellow-200\">\n                <CardContent className=\"p-4\">\n                  <div className=\"flex items-center justify-between\">\n                    <div>\n                      <p className=\"text-sm font-medium text-yellow-700\">Aktif Grevler</p>\n                      <p className=\"text-2xl font-bold text-yellow-900 mt-1\">{stats.activeTasks}</p>\n                    </div>\n                    <Clock className=\"h-8 w-8 text-yellow-600\" />\n                  </div>\n                </CardContent>\n              </Card>\n\n              <Card className=\"bg-gradient-to-br from-green-50 to-green-100/50 border-green-200\">\n                <CardContent className=\"p-4\">\n                  <div className=\"flex items-center justify-between\">\n                    <div>\n                      <p className=\"text-sm font-medium text-green-700\">Tamamlanan</p>\n                      <p className=\"text-2xl font-bold text-green-900 mt-1\">{stats.completedTasks}</p>\n                    </div>\n                    <CheckSquare className=\"h-8 w-8 text-green-600\" />\n                  </div>\n                </CardContent>\n              </Card>\n\n              <Card className=\"bg-gradient-to-br from-purple-50 to-purple-100/50 border-purple-200\">\n                <CardContent className=\"p-4\">\n                  <div className=\"flex items-center justify-between\">\n                    <div>\n                      <p className=\"text-sm font-medium text-purple-700\">Tamamlanma Oran</p>\n                      <p className=\"text-2xl font-bold text-purple-900 mt-1\">{stats.completionRate.toFixed(0)}%</p>\n                    </div>\n                    <TrendingUp className=\"h-8 w-8 text-purple-600\" />\n                  </div>\n                </CardContent>\n              </Card>\n            </div>\n\n            {/* Tamamlanma Oran Progress */}\n            <Card>\n              <CardHeader>\n                <CardTitle className=\"text-lg\">Grev Tamamlanma Durumu</CardTitle>\n              </CardHeader>\n              <CardContent className=\"space-y-3 sm:space-y-4\">\n                <div className=\"space-y-1.5 sm:space-y-2\">\n                  <div className=\"flex items-center justify-between text-sm\">\n                    <span className=\"font-medium\">Genel lerleme</span>\n                    <span className=\"text-muted-foreground\">{stats.completionRate.toFixed(1)}%</span>\n                  </div>\n                  <Progress value={stats.completionRate} className=\"h-3\" />\n                </div>\n                <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm\">\n                  <div>\n                    <span className=\"text-muted-foreground\">Bekleyen:</span>\n                    <span className=\"ml-2 font-semibold\">{stats.pendingTasks}</span>\n                  </div>\n                  <div>\n                    <span className=\"text-muted-foreground\">Devam Eden:</span>\n                    <span className=\"ml-2 font-semibold\">{stats.inProgressTasks}</span>\n                  </div>\n                  <div>\n                    <span className=\"text-muted-foreground\">Tamamlanan:</span>\n                    <span className=\"ml-2 font-semibold\">{stats.completedTasks}</span>\n                  </div>\n                  <div>\n                    <span className=\"text-muted-foreground\">Toplam:</span>\n                    <span className=\"ml-2 font-semibold\">{tasks.length}</span>\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n\n            {/* yeler */}\n            <Card>\n              <CardHeader>\n                <CardTitle className=\"text-lg flex items-center gap-2\">\n                  <Users className=\"h-5 w-5\" />\n                  Ekip yeleri ({stats.totalMembers})\n                </CardTitle>\n              </CardHeader>\n              <CardContent>\n                {members.length > 0 ? (\n                  <div className=\"space-y-3\">\n                    {members.map((member) => (\n                      <div\n                        key={member.id}\n                        className=\"flex items-center justify-between p-3 rounded-lg bg-muted/50 hover:bg-muted transition-colors\"\n                      >\n                        <div className=\"flex items-center gap-3\">\n                          <div className=\"h-10 w-10 rounded-full bg-gradient-to-br from-primary to-primary/60 flex items-center justify-center text-white font-semibold\">\n                            {(member.fullName || member.email).charAt(0).toUpperCase()}\n                          </div>\n                          <div>\n                            <p className=\"font-medium\">{member.fullName || member.email}</p>\n                            <div className=\"flex items-center gap-2 text-xs text-muted-foreground mt-1\">\n                              {member.email && (\n                                <span className=\"flex items-center gap-1\">\n                                  <Mail className=\"h-3 w-3\" />\n                                  {member.email}\n                                </span>\n                              )}\n                            </div>\n                          </div>\n                        </div>\n                        <Badge variant=\"outline\">\n                          {member.approvedTeams?.includes(departmentId) ? \"Onayl\" : \"Beklemede\"}\n                        </Badge>\n                      </div>\n                    ))}\n                  </div>\n                ) : (\n                  <p className=\"text-center text-muted-foreground py-4\">\n                    Bu departmanda henz ye bulunmuyor\n                  </p>\n                )}\n              </CardContent>\n            </Card>\n\n            {/* Grevler */}\n            <Card>\n              <CardHeader>\n                <CardTitle className=\"text-lg flex items-center gap-2\">\n                  <CheckSquare className=\"h-5 w-5\" />\n                  Grevler ({tasks.length})\n                </CardTitle>\n              </CardHeader>\n              <CardContent>\n                {tasks.length > 0 ? (\n                  <div className=\"overflow-x-auto\">\n                    <Table>\n                      <TableHeader>\n                        <TableRow>\n                          <TableHead>Balk</TableHead>\n                          <TableHead>Durum</TableHead>\n                          <TableHead>ncelik</TableHead>\n                          <TableHead>Oluturulma</TableHead>\n                          <TableHead>Biti Tarihi</TableHead>\n                        </TableRow>\n                      </TableHeader>\n                      <TableBody>\n                        {tasks.slice(0, 10).map((task) => (\n                          <TableRow key={task.id}>\n                            <TableCell className=\"font-medium\">{task.title}</TableCell>\n                            <TableCell>\n                              <Badge className={getStatusBadgeColor(task.status)}>\n                                {getStatusLabel(task.status)}\n                              </Badge>\n                            </TableCell>\n                            <TableCell>\n                              <Badge variant=\"outline\">{task.priority || \"Normal\"}</Badge>\n                            </TableCell>\n                            <TableCell className=\"text-sm text-muted-foreground\">\n                              {task.createdAt ? format(task.createdAt.toDate(), \"dd MMM yyyy\", { locale: tr }) : \"-\"}\n                            </TableCell>\n                            <TableCell className=\"text-sm text-muted-foreground\">\n                              {task.dueDate ? format(task.dueDate.toDate(), \"dd MMM yyyy\", { locale: tr }) : \"-\"}\n                            </TableCell>\n                          </TableRow>\n                        ))}\n                      </TableBody>\n                    </Table>\n                    {tasks.length > 10 && (\n                      <p className=\"text-center text-sm text-muted-foreground mt-4\">\n                        +{tasks.length - 10} grev daha...\n                      </p>\n                    )}\n                  </div>\n                ) : (\n                  <p className=\"text-center text-muted-foreground py-4\">\n                    Bu departmanda henz grev bulunmuyor\n                  </p>\n                )}\n              </CardContent>\n            </Card>\n              </div>\n            )}\n            </div>\n          </div>\n        </div>\n      </DialogContent>\n    </Dialog>\n  );\n};\n\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\components\\Admin\\DepartmentManagement.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\components\\Admin\\DepartmentStatsTable.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\components\\Admin\\ProductionStatusBarChart.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\components\\Admin\\RecentActivitiesTable.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\components\\Admin\\RolePermissions.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchData'. Either include it or remove the dependency array.","line":56,"column":6,"nodeType":"ArrayExpression","endLine":56,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [fetchData]","fix":{"range":[2565,2567],"text":"[fetchData]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useEffect, useState } from \"react\";\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\nimport { Tabs, TabsList, TabsTrigger, TabsContent } from \"@/components/ui/tabs\";\nimport { Label } from \"@/components/ui/label\";\nimport { Input } from \"@/components/ui/input\";\nimport { Dialog, DialogContent, DialogDescription, DialogFooter, DialogHeader, DialogTitle, DialogTrigger } from \"@/components/ui/dialog\";\nimport { AlertDialog, AlertDialogAction, AlertDialogCancel, AlertDialogContent, AlertDialogDescription, AlertDialogFooter, AlertDialogHeader, AlertDialogTitle, AlertDialogTrigger } from \"@/components/ui/alert-dialog\";\nimport { Tooltip, TooltipContent, TooltipProvider, TooltipTrigger } from \"@/components/ui/tooltip\";\nimport { toast } from \"sonner\";\nimport { Loader2, Save, Shield, Plus, Trash2, Info, ChevronDown, ChevronRight } from \"lucide-react\";\nimport { useAuth } from \"@/contexts/AuthContext\";\nimport {\n  getRoles,\n  getRolePermissions,\n  updatePermission,\n  addRole,\n  deleteRole,\n  getSubPermissionsForResource,\n  updatePermissionsWithSubPermissions,\n  RoleDefinition,\n  RolePermission,\n  onPermissionCacheChange,\n  clearPermissionCache,\n} from \"@/services/firebase/rolePermissionsService\";\n\nexport const RolePermissions = () => {\n  const { isAdmin, isSuperAdmin } = useAuth();\n  const [roles, setRoles] = useState<RoleDefinition[]>([]);\n  const [permissions, setPermissions] = useState<RolePermission[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [saving, setSaving] = useState<string | null>(null);\n  const [activeRole, setActiveRole] = useState<string>(\"\");\n  const [addRoleOpen, setAddRoleOpen] = useState(false);\n  const [newRoleName, setNewRoleName] = useState(\"\");\n  const [newRoleKey, setNewRoleKey] = useState(\"\");\n  const [newRoleColor, setNewRoleColor] = useState(\"bg-gray-500\");\n  const [addingRole, setAddingRole] = useState(false);\n  const [deletingRole, setDeletingRole] = useState<string | null>(null);\n  const [expandedResources, setExpandedResources] = useState<Set<string>>(new Set());\n  const [updatingSubPermissions, setUpdatingSubPermissions] = useState(false);\n\n  useEffect(() => {\n    fetchData();\n    \n    // Listen to permission cache changes for real-time updates\n    const unsubscribe = onPermissionCacheChange(() => {\n      // Refresh permissions when cache changes\n      fetchData();\n    });\n    \n    return () => {\n      unsubscribe();\n    };\n  }, []);\n\n  const fetchData = async () => {\n    setLoading(true);\n    try {\n      const [rolesData, permissionsData] = await Promise.all([\n        getRoles(),\n        getRolePermissions(),\n      ]);\n      setRoles(rolesData);\n      setPermissions(permissionsData);\n      if (rolesData.length > 0 && !activeRole) {\n        setActiveRole(rolesData[0].key);\n      }\n    } catch (error: unknown) {\n      if (import.meta.env.DEV) {\n        console.error(\"Fetch role permissions error:\", error);\n      }\n      toast.error(\"Rol ve yetkiler yklenirken hata olutu\");\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handlePermissionChange = async (\n    permissionId: string,\n    field: \"canCreate\" | \"canRead\" | \"canUpdate\" | \"canDelete\" | \"subPermissions\",\n    checked: boolean | Record<string, boolean>\n  ) => {\n    if (!isAdmin) {\n      toast.error(\"Sadece ynetici rol yetkilerini dzenleyebilir\");\n      return;\n    }\n\n    // Super admin rolnn yetkilerini dzenlemeyi engelle (sadece super admin yapabilir)\n    const permission = permissions.find(p => p.id === permissionId);\n    if (permission && permission.role === \"super_admin\" && !isSuperAdmin) {\n      toast.error(\"Sper ynetici rolnn yetkileri sadece sper ynetici tarafndan dzenlenebilir\");\n      return;\n    }\n    \n    // Admin rol kaldrld, sadece super admin kontrol yaplyor\n\n    // Optimistic update\n    const oldPermissions = [...permissions];\n    setPermissions((prev) =>\n      prev.map((p) => (p.id === permissionId ? { ...p, [field]: checked } : p))\n    );\n\n    setSaving(permissionId);\n    try {\n      if (field === \"subPermissions\") {\n        await updatePermission(permissionId, { subPermissions: checked as Record<string, boolean> });\n      } else {\n        await updatePermission(permissionId, { [field]: checked as boolean });\n      }\n      // Cache will be updated by real-time listener automatically\n      // No need to clear cache - listener will update it\n      // toast.success(\"Yetki gncellendi\"); // Too spammy for toggles\n    } catch (error: unknown) {\n      if (import.meta.env.DEV) {\n        console.error(\"Update permission error:\", error);\n      }\n      toast.error(\"Yetki gncellenemedi\");\n      setPermissions(oldPermissions); // Revert\n    } finally {\n      setSaving(null);\n    }\n  };\n\n  const handleSubPermissionChange = async (\n    permissionId: string,\n    subPermissionKey: string,\n    checked: boolean\n  ) => {\n    if (!isAdmin) {\n      toast.error(\"Sadece ynetici rol yetkilerini dzenleyebilir\");\n      return;\n    }\n\n    const permission = permissions.find(p => p.id === permissionId);\n    if (permission && permission.role === \"super_admin\" && !isSuperAdmin) {\n      toast.error(\"Sper ynetici rolnn yetkileri sadece sper ynetici tarafndan dzenlenebilir\");\n      return;\n    }\n    \n    // Admin rol kaldrld, sadece super admin kontrol yaplyor\n\n    // Optimistic update\n    const oldPermissions = [...permissions];\n    const currentSubPermissions = permission?.subPermissions || {};\n    const newSubPermissions = { ...currentSubPermissions, [subPermissionKey]: checked };\n    \n    setPermissions((prev) =>\n      prev.map((p) => (p.id === permissionId ? { ...p, subPermissions: newSubPermissions } : p))\n    );\n\n    setSaving(permissionId);\n    try {\n      await updatePermission(permissionId, { subPermissions: newSubPermissions });\n    } catch (error: unknown) {\n      if (import.meta.env.DEV) {\n        console.error(\"Update sub-permission error:\", error);\n      }\n      toast.error(\"Alt yetki gncellenemedi\");\n      setPermissions(oldPermissions); // Revert\n    } finally {\n      setSaving(null);\n    }\n  };\n\n  const handleAddRole = async () => {\n    if (!isAdmin) {\n      toast.error(\"Sadece ynetici yeni rol ekleyebilir\");\n      return;\n    }\n\n    if (!newRoleName.trim() || !newRoleKey.trim()) {\n      toast.error(\"Ltfen rol ad ve anahtar girin\");\n      return;\n    }\n\n    setAddingRole(true);\n    try {\n      await addRole({\n        key: newRoleKey.trim().toLowerCase().replace(/\\s+/g, \"_\"),\n        label: newRoleName.trim(),\n        color: newRoleColor,\n      });\n      toast.success(\"Rol baaryla eklendi\");\n      setAddRoleOpen(false);\n      setNewRoleName(\"\");\n      setNewRoleKey(\"\");\n      setNewRoleColor(\"bg-gray-500\");\n      await fetchData();\n    } catch (error: unknown) {\n      if (import.meta.env.DEV) {\n        console.error(\"Add role error:\", error);\n      }\n      toast.error(error instanceof Error ? error.message : \"Rol eklenemedi\");\n    } finally {\n      setAddingRole(false);\n    }\n  };\n\n  const handleDeleteRole = async (roleKey: string) => {\n    if (!isAdmin) {\n      toast.error(\"Sadece ynetici rol silebilir\");\n      return;\n    }\n\n    // Sistem rollerini silmeyi engelle\n    if (roleKey === \"super_admin\" && !isSuperAdmin) {\n      toast.error(\"Sistem rolleri silinemez\");\n      return;\n    }\n    \n    // Super admin roln sadece super admin silebilir\n    if (roleKey === \"super_admin\" && !isSuperAdmin) {\n      toast.error(\"Sper ynetici rol silinemez\");\n      return;\n    }\n\n    setDeletingRole(roleKey);\n    try {\n      await deleteRole(roleKey);\n      toast.success(\"Rol baaryla silindi\");\n      if (activeRole === roleKey && roles.length > 1) {\n        const remainingRoles = roles.filter((r) => r.key !== roleKey);\n        setActiveRole(remainingRoles[0]?.key || \"\");\n      }\n      await fetchData();\n    } catch (error: unknown) {\n      if (import.meta.env.DEV) {\n        console.error(\"Delete role error:\", error);\n      }\n      toast.error(error instanceof Error ? error.message : \"Rol silinemedi\");\n    } finally {\n      setDeletingRole(null);\n    }\n  };\n\n  const handleUpdateSubPermissions = async () => {\n    if (!isAdmin) {\n      toast.error(\"Sadece ynetici alt yetkileri gncelleyebilir\");\n      return;\n    }\n\n    setUpdatingSubPermissions(true);\n    try {\n      await updatePermissionsWithSubPermissions();\n      toast.success(\"Alt yetkiler baaryla gncellendi\");\n      await fetchData();\n    } catch (error: unknown) {\n      if (import.meta.env.DEV) {\n        console.error(\"Update sub-permissions error:\", error);\n      }\n      toast.error(error instanceof Error ? error.message : \"Alt yetkiler gncellenemedi\");\n    } finally {\n      setUpdatingSubPermissions(false);\n    }\n  };\n\n  const getResourceLabel = (resource: string) => {\n    const labels: Record<string, string> = {\n      tasks: \"Grevler\",\n      users: \"Kullanclar\",\n      departments: \"Departmanlar\",\n      orders: \"Sipariler\",\n      production_orders: \"retim Siparileri\",\n      customers: \"Mteriler\",\n      products: \"rnler\",\n      projects: \"Projeler\",\n      audit_logs: \"Denetim Kaytlar\",\n      role_permissions: \"Rol Yetkileri\",\n      raw_materials: \"Hammaddeler\",\n      warranty: \"Garanti\",\n    };\n    return labels[resource] || resource;\n  };\n\n  const getPermissionDescription = (permissionType: \"canCreate\" | \"canRead\" | \"canUpdate\" | \"canDelete\", resource: string): string => {\n    const resourceLabel = getResourceLabel(resource);\n    \n    const descriptions: Record<string, Record<string, string>> = {\n      canCreate: {\n        tasks: `Yeni grevler oluturma yetkisi. Bu yetkiye sahip kullanclar grev listesine yeni grevler ekleyebilir.`,\n        users: `Yeni kullanc hesaplar oluturma yetkisi. Bu yetkiye sahip kullanclar sisteme yeni kullanc kaydedebilir.`,\n        departments: `Yeni departman/ekip oluturma yetkisi. Bu yetkiye sahip kullanclar yeni ekipler tanmlayabilir.`,\n        orders: `Yeni sipari oluturma yetkisi. Bu yetkiye sahip kullanclar mterilere sipari kayd oluturabilir.`,\n        production_orders: `Yeni retim siparii oluturma yetkisi. Bu yetkiye sahip kullanclar retim iin sipari kayd oluturabilir.`,\n        customers: `Yeni mteri kayd oluturma yetkisi. Bu yetkiye sahip kullanclar mteri bilgilerini sisteme ekleyebilir.`,\n        products: `Yeni rn kayd oluturma yetkisi. Bu yetkiye sahip kullanclar rn bilgilerini sisteme ekleyebilir.`,\n        projects: `Yeni proje oluturma yetkisi. Bu yetkiye sahip kullanclar proje kaytlar oluturabilir.`,\n        audit_logs: `Denetim kayd oluturma yetkisi. Sistem tarafndan otomatik oluturulur, manuel oluturma genellikle gerekmez.`,\n        role_permissions: `Yeni rol ve yetki tanm oluturma yetkisi. Bu yetkiye sahip kullanclar yeni roller tanmlayabilir.`,\n        raw_materials: `Yeni hammadde kayd oluturma yetkisi. Bu yetkiye sahip kullanclar hammadde bilgilerini sisteme ekleyebilir.`,\n        warranty: `Yeni garanti kayd oluturma yetkisi. Bu yetkiye sahip kullanclar garanti kaytlar oluturabilir.`,\n      },\n      canRead: {\n        tasks: `Grevleri grntleme yetkisi. Bu yetkiye sahip kullanclar grev listesini ve detaylarn grebilir.`,\n        users: `Kullanc bilgilerini grntleme yetkisi. Bu yetkiye sahip kullanclar kullanc listesini ve profil bilgilerini grebilir.`,\n        departments: `Departman/ekip bilgilerini grntleme yetkisi. Bu yetkiye sahip kullanclar ekip listesini ve detaylarn grebilir.`,\n        orders: `Sipari bilgilerini grntleme yetkisi. Bu yetkiye sahip kullanclar sipari listesini ve detaylarn grebilir.`,\n        production_orders: `retim siparilerini grntleme yetkisi. Bu yetkiye sahip kullanclar retim siparilerini grebilir.`,\n        customers: `Mteri bilgilerini grntleme yetkisi. Bu yetkiye sahip kullanclar mteri listesini ve detaylarn grebilir.`,\n        products: `rn bilgilerini grntleme yetkisi. Bu yetkiye sahip kullanclar rn listesini ve detaylarn grebilir.`,\n        projects: `Proje bilgilerini grntleme yetkisi. Bu yetkiye sahip kullanclar proje listesini ve detaylarn grebilir.`,\n        audit_logs: `Denetim kaytlarn grntleme yetkisi. Bu yetkiye sahip kullanclar sistem loglarn ve aktivite kaytlarn grebilir.`,\n        role_permissions: `Rol ve yetki tanmlarn grntleme yetkisi. Bu yetkiye sahip kullanclar rol listesini ve yetki tanmlarn grebilir.`,\n        raw_materials: `Hammadde bilgilerini grntleme yetkisi. Bu yetkiye sahip kullanclar hammadde listesini ve detaylarn grebilir.`,\n        warranty: `Garanti kaytlarn grntleme yetkisi. Bu yetkiye sahip kullanclar garanti listesini ve detaylarn grebilir.`,\n      },\n      canUpdate: {\n        tasks: `Grevleri dzenleme yetkisi. Bu yetkiye sahip kullanclar mevcut grevlerin bilgilerini, durumunu ve atamalarn deitirebilir.`,\n        users: `Kullanc bilgilerini dzenleme yetkisi. Bu yetkiye sahip kullanclar kullanc profil bilgilerini, rollerini ve ekip yeliklerini gncelleyebilir.`,\n        departments: `Departman/ekip bilgilerini dzenleme yetkisi. Bu yetkiye sahip kullanclar ekip bilgilerini ve lider atamalarn gncelleyebilir.`,\n        orders: `Sipari bilgilerini dzenleme yetkisi. Bu yetkiye sahip kullanclar sipari detaylarn, durumunu ve kalemlerini gncelleyebilir.`,\n        production_orders: `retim siparilerini dzenleme yetkisi. Bu yetkiye sahip kullanclar retim siparilerinin durumunu ve bilgilerini gncelleyebilir.`,\n        customers: `Mteri bilgilerini dzenleme yetkisi. Bu yetkiye sahip kullanclar mteri kaytlarn ve iletiim bilgilerini gncelleyebilir.`,\n        products: `rn bilgilerini dzenleme yetkisi. Bu yetkiye sahip kullanclar rn kaytlarn, fiyatlarn ve stok bilgilerini gncelleyebilir.`,\n        projects: `Proje bilgilerini dzenleme yetkisi. Bu yetkiye sahip kullanclar proje detaylarn, durumunu ve yelerini gncelleyebilir.`,\n        audit_logs: `Denetim kaytlarn dzenleme yetkisi. Genellikle sistem tarafndan oluturulan kaytlar dzenlenmez, sadece zel durumlarda gerekebilir.`,\n        role_permissions: `Rol ve yetki tanmlarn dzenleme yetkisi. Bu yetkiye sahip kullanclar rol yetkilerini ve tanmlarn gncelleyebilir.`,\n        raw_materials: `Hammadde bilgilerini dzenleme yetkisi. Bu yetkiye sahip kullanclar hammadde kaytlarn, stok bilgilerini ve maliyetlerini gncelleyebilir.`,\n        warranty: `Garanti kaytlarn dzenleme yetkisi. Bu yetkiye sahip kullanclar garanti kaytlarnn durumunu ve bilgilerini gncelleyebilir.`,\n      },\n      canDelete: {\n        tasks: `Grevleri silme yetkisi. Bu yetkiye sahip kullanclar grevleri silebilir veya arivleyebilir.`,\n        users: `Kullanc hesaplarn silme yetkisi. Bu yetkiye sahip kullanclar kullanc hesaplarn kalc olarak silebilir.`,\n        departments: `Departman/ekipleri silme yetkisi. Bu yetkiye sahip kullanclar ekipleri kalc olarak silebilir.`,\n        orders: `Siparileri silme yetkisi. Bu yetkiye sahip kullanclar sipari kaytlarn silebilir.`,\n        production_orders: `retim siparilerini silme yetkisi. Bu yetkiye sahip kullanclar retim siparilerini silebilir.`,\n        customers: `Mteri kaytlarn silme yetkisi. Bu yetkiye sahip kullanclar mteri kaytlarn silebilir.`,\n        products: `rn kaytlarn silme yetkisi. Bu yetkiye sahip kullanclar rn kaytlarn silebilir.`,\n        projects: `Projeleri silme yetkisi. Bu yetkiye sahip kullanclar proje kaytlarn silebilir.`,\n        audit_logs: `Denetim kaytlarn silme yetkisi. Bu yetkiye sahip kullanclar sistem loglarn silebilir (genellikle nerilmez).`,\n        role_permissions: `Rol ve yetki tanmlarn silme yetkisi. Bu yetkiye sahip kullanclar rolleri ve yetki tanmlarn silebilir.`,\n        raw_materials: `Hammadde kaytlarn silme yetkisi. Bu yetkiye sahip kullanclar hammadde kaytlarn silebilir.`,\n        warranty: `Garanti kaytlarn silme yetkisi. Bu yetkiye sahip kullanclar garanti kaytlarn silebilir.`,\n      },\n    };\n    \n    return descriptions[permissionType]?.[resource] || `${resourceLabel} iin ${permissionType} yetkisi.`;\n  };\n\n  if (loading) {\n    return (\n      <div className=\"flex h-40 items-center justify-center\">\n        <Loader2 className=\"h-8 w-8 animate-spin text-muted-foreground\" />\n      </div>\n    );\n  }\n\n  return (\n    <Card>\n      <CardHeader>\n        <div className=\"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3 sm:gap-4\">\n          <div>\n            <CardTitle className=\"flex items-center gap-2 text-[14px] sm:text-[15px] leading-tight\">\n              <Shield className=\"h-3.5 w-3.5 sm:h-4 sm:w-4\" />\n              Rol Yetkileri\n            </CardTitle>\n            <CardDescription className=\"text-[11px] sm:text-xs mt-1 leading-snug\">\n              Rollerin hangi kaynaklara eriebileceini ve hangi ilemleri yapabileceini ynetin.\n            </CardDescription>\n          </div>\n          <Button\n            variant=\"outline\"\n            size=\"sm\"\n            onClick={handleUpdateSubPermissions}\n            disabled={updatingSubPermissions || !isAdmin}\n            className=\"gap-2 w-full sm:w-auto min-h-[44px] sm:min-h-0\"\n          >\n            {updatingSubPermissions ? (\n              <>\n                <Loader2 className=\"h-4 w-4 animate-spin\" />\n                <span className=\"text-xs sm:text-sm\">Gncelleniyor...</span>\n              </>\n            ) : (\n              <>\n                <Save className=\"h-4 w-4\" />\n                <span className=\"text-xs sm:text-sm\">Alt Yetkileri Gncelle</span>\n              </>\n            )}\n          </Button>\n        </div>\n      </CardHeader>\n      <CardContent>\n        <Tabs value={activeRole} onValueChange={setActiveRole} className=\"w-full\">\n          <div className=\"flex flex-col sm:flex-row items-stretch sm:items-center justify-between gap-3 sm:gap-4 mb-4\">\n            <div className=\"overflow-x-auto -mx-4 px-4 sm:mx-0 sm:px-0 scrollbar-hide\">\n              <TabsList className=\"flex-wrap h-auto gap-1 min-w-max sm:min-w-0\">\n                {roles.map((role) => (\n                  <TabsTrigger key={role.id} value={role.key} className=\"min-w-[80px] sm:min-w-[100px] text-xs sm:text-sm min-h-[44px] sm:min-h-0 whitespace-nowrap\">\n                    {role.label}\n                  </TabsTrigger>\n                ))}\n              </TabsList>\n            </div>\n            <Dialog open={addRoleOpen} onOpenChange={setAddRoleOpen}>\n              <DialogTrigger asChild>\n                <Button className=\"gap-2 w-full sm:w-auto min-h-[44px] sm:min-h-0\" disabled={!isAdmin}>\n                  <Plus className=\"h-4 w-4\" />\n                  <span className=\"text-xs sm:text-sm\">Yeni Rol Ekle</span>\n                </Button>\n              </DialogTrigger>\n              <DialogContent>\n                <DialogHeader>\n                  <DialogTitle>Yeni Rol Ekle</DialogTitle>\n                  <DialogDescription>\n                    Yeni bir rol tanmlayn. Rol eklendikten sonra yetkilerini dzenleyebilirsiniz.\n                  </DialogDescription>\n                </DialogHeader>\n                <div className=\"space-y-4 py-4\">\n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"roleName\" className=\"text-[11px] sm:text-xs\">Rol Ad</Label>\n                    <Input\n                      id=\"roleName\"\n                      placeholder=\"rn: Sat Temsilcisi\"\n                      value={newRoleName}\n                      onChange={(e) => {\n                        setNewRoleName(e.target.value);\n                        if (!newRoleKey) {\n                          setNewRoleKey(e.target.value.toLowerCase().replace(/\\s+/g, \"_\"));\n                        }\n                      }}\n                      className=\"min-h-[44px] sm:min-h-0 text-[14px] sm:text-sm\"\n                    />\n                  </div>\n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"roleKey\" className=\"text-[11px] sm:text-xs\">Rol Anahtar</Label>\n                    <Input\n                      id=\"roleKey\"\n                      placeholder=\"rn: sales_representative\"\n                      value={newRoleKey}\n                      onChange={(e) => setNewRoleKey(e.target.value.toLowerCase().replace(/[^a-z0-9_]/g, \"_\"))}\n                      className=\"min-h-[44px] sm:min-h-0 text-[14px] sm:text-sm\"\n                    />\n                    <p className=\"text-[11px] sm:text-xs text-muted-foreground\">\n                      Kk harf, rakam ve alt izgi kullann. Boluklar otomatik olarak alt izgiye dntrlr.\n                    </p>\n                  </div>\n                  <div className=\"space-y-2\">\n                    <Label>Rol Rengi</Label>\n                    <div className=\"flex gap-2 flex-wrap\">\n                      {[\"bg-gray-500\", \"bg-blue-500\", \"bg-green-500\", \"bg-yellow-500\", \"bg-red-500\", \"bg-purple-500\", \"bg-pink-500\", \"bg-indigo-500\"].map((color) => (\n                        <button\n                          key={color}\n                          type=\"button\"\n                          className={`w-8 h-8 rounded-full ${color} border-2 ${newRoleColor === color ? \"border-primary\" : \"border-transparent\"}`}\n                          onClick={() => setNewRoleColor(color)}\n                        />\n                      ))}\n                    </div>\n                  </div>\n                </div>\n                <DialogFooter>\n                  <Button variant=\"outline\" onClick={() => setAddRoleOpen(false)}>\n                    ptal\n                  </Button>\n                  <Button onClick={handleAddRole} disabled={addingRole || !newRoleName.trim() || !newRoleKey.trim()}>\n                    {addingRole ? (\n                      <>\n                        <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />\n                        Ekleniyor...\n                      </>\n                    ) : (\n                      \"Rol Ekle\"\n                    )}\n                  </Button>\n                </DialogFooter>\n              </DialogContent>\n            </Dialog>\n          </div>\n\n          {roles.map((role) => (\n            <TabsContent key={role.id} value={role.key}>\n              <div className=\"space-y-4\">\n                <div className=\"flex items-center justify-between\">\n                  <div className=\"flex items-center gap-2\">\n                    <div className={`w-3 h-3 rounded-full ${role.color}`} />\n                    <h3 className=\"font-semibold\">{role.label}</h3>\n                    {role.isSystem && (\n                      <span className=\"text-xs text-muted-foreground\">(Sistem Rol)</span>\n                    )}\n                  </div>\n                  {!role.isSystem && (\n                    <AlertDialog>\n                      <AlertDialogTrigger asChild>\n                        <Button variant=\"destructive\" size=\"sm\" className=\"gap-2\" disabled={deletingRole === role.key || !isAdmin || (role.key === \"super_admin\" && !isSuperAdmin)}>\n                          {deletingRole === role.key ? (\n                            <>\n                              <Loader2 className=\"h-4 w-4 animate-spin\" />\n                              Siliniyor...\n                            </>\n                          ) : (\n                            <>\n                              <Trash2 className=\"h-4 w-4\" />\n                              Rol Sil\n                            </>\n                          )}\n                        </Button>\n                      </AlertDialogTrigger>\n                      <AlertDialogContent>\n                        <AlertDialogHeader>\n                          <AlertDialogTitle>Rol Silmek stediinize Emin Misiniz?</AlertDialogTitle>\n                          <AlertDialogDescription>\n                            \"{role.label}\" rol ve tm yetkileri kalc olarak silinecektir. Bu ilem geri alnamaz.\n                          </AlertDialogDescription>\n                        </AlertDialogHeader>\n                        <AlertDialogFooter>\n                          <AlertDialogCancel>ptal</AlertDialogCancel>\n                          <AlertDialogAction\n                            onClick={() => handleDeleteRole(role.key)}\n                            className=\"bg-destructive text-destructive-foreground hover:bg-destructive/90\"\n                          >\n                            Sil\n                          </AlertDialogAction>\n                        </AlertDialogFooter>\n                      </AlertDialogContent>\n                    </AlertDialog>\n                  )}\n                </div>\n                <div className=\"rounded-md border overflow-x-auto -mx-4 sm:mx-0 scrollbar-thin scrollbar-thumb-border scrollbar-track-transparent\">\n                  <div className=\"inline-block min-w-full align-middle px-4 sm:px-0\">\n                    <div className=\"min-w-[600px] sm:min-w-0\">\n                      <div className=\"grid grid-cols-5 gap-2 md:gap-4 p-2 md:p-4 font-medium bg-muted/50 text-[10px] sm:text-xs md:text-sm\">\n                      <div className=\"col-span-1 min-w-[120px]\">Kaynak</div>\n                      <div className=\"text-center flex items-center justify-center gap-1 min-w-[80px]\">\n                        <span className=\"hidden md:inline\">Oluturma</span>\n                        <span className=\"md:hidden\">Olutur</span>\n                        <TooltipProvider>\n                          <Tooltip>\n                            <TooltipTrigger asChild>\n                              <Info className=\"h-3.5 w-3.5 text-muted-foreground cursor-help flex-shrink-0\" />\n                            </TooltipTrigger>\n                            <TooltipContent className=\"max-w-sm\">\n                              <p className=\"font-medium mb-1\">Oluturma Yetkisi</p>\n                              <p className=\"text-xs\">Bu yetkiye sahip kullanclar yeni kaytlar oluturabilir. rnein: yeni grev, kullanc, sipari vb. ekleyebilir.</p>\n                            </TooltipContent>\n                          </Tooltip>\n                        </TooltipProvider>\n                      </div>\n                      <div className=\"text-center flex items-center justify-center gap-1 min-w-[80px]\">\n                        <span className=\"hidden md:inline\">Okuma</span>\n                        <span className=\"md:hidden\">Oku</span>\n                        <TooltipProvider>\n                          <Tooltip>\n                            <TooltipTrigger asChild>\n                              <Info className=\"h-3.5 w-3.5 text-muted-foreground cursor-help flex-shrink-0\" />\n                            </TooltipTrigger>\n                            <TooltipContent className=\"max-w-sm\">\n                              <p className=\"font-medium mb-1\">Okuma Yetkisi</p>\n                              <p className=\"text-xs\">Bu yetkiye sahip kullanclar kaytlar grntleyebilir ve okuyabilir. Liste ve detay sayfalarna eriebilir.</p>\n                            </TooltipContent>\n                          </Tooltip>\n                        </TooltipProvider>\n                      </div>\n                      <div className=\"text-center flex items-center justify-center gap-1 min-w-[80px]\">\n                        <span className=\"hidden md:inline\">Gncelleme</span>\n                        <span className=\"md:hidden\">Gncelle</span>\n                        <TooltipProvider>\n                          <Tooltip>\n                            <TooltipTrigger asChild>\n                              <Info className=\"h-3.5 w-3.5 text-muted-foreground cursor-help flex-shrink-0\" />\n                            </TooltipTrigger>\n                            <TooltipContent className=\"max-w-sm\">\n                              <p className=\"font-medium mb-1\">Gncelleme Yetkisi</p>\n                              <p className=\"text-xs\">Bu yetkiye sahip kullanclar mevcut kaytlar dzenleyebilir. Bilgileri, durumlar ve atamalar deitirebilir.</p>\n                            </TooltipContent>\n                          </Tooltip>\n                        </TooltipProvider>\n                      </div>\n                      <div className=\"text-center flex items-center justify-center gap-1 min-w-[80px]\">\n                        <span className=\"hidden md:inline\">Silme</span>\n                        <span className=\"md:hidden\">Sil</span>\n                        <TooltipProvider>\n                          <Tooltip>\n                            <TooltipTrigger asChild>\n                              <Info className=\"h-3.5 w-3.5 text-muted-foreground cursor-help flex-shrink-0\" />\n                            </TooltipTrigger>\n                            <TooltipContent className=\"max-w-sm\">\n                              <p className=\"font-medium mb-1\">Silme Yetkisi</p>\n                              <p className=\"text-xs\">Bu yetkiye sahip kullanclar kaytlar silebilir veya arivleyebilir. Bu ilem genellikle geri alnamaz.</p>\n                            </TooltipContent>\n                          </Tooltip>\n                        </TooltipProvider>\n                      </div>\n                    </div>\n                  </div>\n                <div className=\"divide-y\">\n                  {(() => {\n                    const rolePermissions = permissions.filter((p) => p.role === role.key);\n                    const resources = [\"tasks\", \"users\", \"departments\", \"orders\", \"production_orders\", \"customers\", \"products\", \"projects\", \"audit_logs\", \"role_permissions\", \"raw_materials\", \"warranty\"];\n                    \n                    return resources.map((resource) => {\n                      const permission = rolePermissions.find((p) => p.resource === resource);\n                      \n                      // Eer permission yoksa, varsaylan deerlerle gster\n                      const canCreate = permission?.canCreate ?? false;\n                      const canRead = permission?.canRead ?? true;\n                      const canUpdate = permission?.canUpdate ?? false;\n                      const canDelete = permission?.canDelete ?? false;\n                      \n                      const resourceKey = `${role.key}-${resource}`;\n                      const isExpanded = expandedResources.has(resourceKey);\n                      const subPermissions = getSubPermissionsForResource(resource);\n                      const subPermissionKeys = Object.keys(subPermissions);\n                      const currentSubPermissions = permission?.subPermissions || {};\n                      \n                      return (\n                        <div key={permission?.id || resourceKey}>\n                          <div className=\"min-w-[600px] sm:min-w-0\">\n                            <div\n                              className=\"grid grid-cols-5 gap-2 md:gap-4 p-2 md:p-4 items-center hover:bg-muted/20 transition-colors\"\n                            >\n                            <div className=\"font-medium text-xs md:text-sm flex items-center gap-2 min-w-0\">\n                              {subPermissionKeys.length > 0 && (\n                                <button\n                                  className=\"p-0.5 hover:bg-muted rounded flex-shrink-0\"\n                                  onClick={() => {\n                                    const newSet = new Set(expandedResources);\n                                    if (isExpanded) {\n                                      newSet.delete(resourceKey);\n                                    } else {\n                                      newSet.add(resourceKey);\n                                    }\n                                    setExpandedResources(newSet);\n                                  }}\n                                >\n                                  {isExpanded ? (\n                                    <ChevronDown className=\"h-4 w-4\" />\n                                  ) : (\n                                    <ChevronRight className=\"h-4 w-4\" />\n                                  )}\n                                </button>\n                              )}\n                              <span className=\"truncate\">{getResourceLabel(resource)}</span>\n                              <TooltipProvider>\n                                <Tooltip>\n                                  <TooltipTrigger asChild>\n                                    <Info className=\"h-3.5 w-3.5 text-muted-foreground cursor-help flex-shrink-0\" />\n                                  </TooltipTrigger>\n                                  <TooltipContent className=\"max-w-sm\">\n                                    <p className=\"font-medium mb-2\">{getResourceLabel(resource)}</p>\n                                    <p className=\"text-xs text-muted-foreground mb-2\">{getPermissionDescription(\"canRead\", resource)}</p>\n                                    <div className=\"border-t pt-2 mt-2 space-y-1\">\n                                      <p className=\"text-xs font-medium\">Yetki Trleri:</p>\n                                      <ul className=\"text-xs text-muted-foreground space-y-0.5 list-disc list-inside\">\n                                        <li>Oluturma: {getPermissionDescription(\"canCreate\", resource).split('.')[0]}</li>\n                                        <li>Okuma: {getPermissionDescription(\"canRead\", resource).split('.')[0]}</li>\n                                        <li>Gncelleme: {getPermissionDescription(\"canUpdate\", resource).split('.')[0]}</li>\n                                        <li>Silme: {getPermissionDescription(\"canDelete\", resource).split('.')[0]}</li>\n                                      </ul>\n                                    </div>\n                                  </TooltipContent>\n                                </Tooltip>\n                              </TooltipProvider>\n                            </div>\n                          <div className=\"flex justify-center min-w-[80px]\">\n                            <Checkbox\n                              checked={canCreate}\n                              onCheckedChange={async (checked) => {\n                                if (permission) {\n                                  await handlePermissionChange(permission.id, \"canCreate\", checked as boolean);\n                                } else {\n                                  toast.info(\"Bu kaynak iin yetki henz oluturulmam. Ltfen sayfay yenileyin.\");\n                                }\n                              }}\n                              disabled={!!saving || !isAdmin || (role.key === \"super_admin\" && !isSuperAdmin) || !permission}\n                              className=\"h-5 w-5 sm:h-4 sm:w-4\"\n                            />\n                          </div>\n                          <div className=\"flex justify-center min-w-[80px]\">\n                            <Checkbox\n                              checked={canRead}\n                              onCheckedChange={async (checked) => {\n                                if (permission) {\n                                  await handlePermissionChange(permission.id, \"canRead\", checked as boolean);\n                                } else {\n                                  toast.info(\"Bu kaynak iin yetki henz oluturulmam. Ltfen sayfay yenileyin.\");\n                                }\n                              }}\n                              disabled={!!saving || !isAdmin || (role.key === \"super_admin\" && !isSuperAdmin) || !permission}\n                              className=\"h-5 w-5 sm:h-4 sm:w-4\"\n                            />\n                          </div>\n                          <div className=\"flex justify-center min-w-[80px]\">\n                            <Checkbox\n                              checked={canUpdate}\n                              onCheckedChange={async (checked) => {\n                                if (permission) {\n                                  await handlePermissionChange(permission.id, \"canUpdate\", checked as boolean);\n                                } else {\n                                  toast.info(\"Bu kaynak iin yetki henz oluturulmam. Ltfen sayfay yenileyin.\");\n                                }\n                              }}\n                              disabled={!!saving || !isAdmin || (role.key === \"super_admin\" && !isSuperAdmin) || !permission}\n                              className=\"h-5 w-5 sm:h-4 sm:w-4\"\n                            />\n                          </div>\n                          <div className=\"flex justify-center min-w-[80px]\">\n                            <Checkbox\n                              checked={canDelete}\n                              onCheckedChange={async (checked) => {\n                                if (permission) {\n                                  await handlePermissionChange(permission.id, \"canDelete\", checked as boolean);\n                                } else {\n                                  toast.info(\"Bu kaynak iin yetki henz oluturulmam. Ltfen sayfay yenileyin.\");\n                                }\n                              }}\n                              disabled={!!saving || !isAdmin || (role.key === \"super_admin\" && !isSuperAdmin) || !permission}\n                              className=\"h-5 w-5 sm:h-4 sm:w-4\"\n                            />\n                          </div>\n                            </div>\n                          </div>\n                        {subPermissionKeys.length > 0 && isExpanded && (\n                          <div className=\"px-2 md:px-4 pb-2 md:pb-4 bg-muted/30 border-t\">\n                            <div className=\"pt-3 space-y-2\">\n                              <div className=\"text-xs md:text-sm font-medium text-muted-foreground mb-2\">Alt Yetkiler</div>\n                              <div className=\"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-2\">\n                                {subPermissionKeys.map((subKey) => (\n                                  <div key={subKey} className=\"flex items-center gap-2\">\n                                    <Checkbox\n                                      checked={currentSubPermissions[subKey] || false}\n                                      onCheckedChange={async (checked) => {\n                                        if (permission) {\n                                          await handleSubPermissionChange(permission.id, subKey, checked as boolean);\n                                        } else {\n                                          toast.info(\"Bu kaynak iin yetki henz oluturulmam. Ltfen sayfay yenileyin.\");\n                                        }\n                                      }}\n                                      disabled={!!saving || !isAdmin || (role.key === \"super_admin\" && !isSuperAdmin) || !permission}\n                                      className=\"h-5 w-5 sm:h-4 sm:w-4\"\n                                    />\n                                    <Label className=\"text-[11px] sm:text-xs font-normal cursor-pointer\">\n                                      {subPermissions[subKey]}\n                                    </Label>\n                                  </div>\n                                ))}\n                              </div>\n                            </div>\n                          </div>\n                        )}\n                      </div>\n                      );\n                    });\n                  })()}\n                    </div>\n                  </div>\n                </div>\n              </div>\n            </TabsContent>\n          ))}\n        </Tabs>\n      </CardContent>\n    </Card>\n  );\n};","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\components\\Admin\\SystemSettings.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\components\\Admin\\TaskStatusPieChart.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\components\\Admin\\TeamApprovalManagement.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchRequests'. Either include it or remove the dependency array.","line":103,"column":6,"nodeType":"ArrayExpression","endLine":103,"endColumn":21,"suggestions":[{"desc":"Update the dependencies array to be: [user, isAdmin, fetchRequests]","fix":{"range":[3313,3328],"text":"[user, isAdmin, fetchRequests]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useEffect, useState } from \"react\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { toast } from \"sonner\";\nimport { Check, X, Users, Loader2 } from \"lucide-react\";\nimport { useAuth } from \"@/contexts/AuthContext\";\nimport {\n  getPendingTeamRequests,\n  getAllPendingTeamRequests,\n  approveTeamRequest,\n  rejectTeamRequest,\n  TeamApprovalRequest,\n} from \"@/services/firebase/teamApprovalService\";\nimport { collection, onSnapshot, Unsubscribe } from \"firebase/firestore\";\nimport { firestore } from \"@/lib/firebase\";\nimport { UserProfile } from \"@/services/firebase/authService\";\nimport { getDepartments } from \"@/services/firebase/departmentService\";\nimport {\n  AlertDialog,\n  AlertDialogAction,\n  AlertDialogCancel,\n  AlertDialogContent,\n  AlertDialogDescription,\n  AlertDialogFooter,\n  AlertDialogHeader,\n  AlertDialogTitle,\n} from \"@/components/ui/alert-dialog\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\n\nexport const TeamApprovalManagement = () => {\n  const { user, isAdmin } = useAuth();\n  const [canApprove, setCanApprove] = useState(false);\n  \n  // Ekip talebi onaylama yetkisi - Firestore'dan kontrol et\n  useEffect(() => {\n    const checkPermission = async () => {\n      if (!user) {\n        setCanApprove(false);\n        return;\n      }\n      try {\n        const { canApproveTeamRequest } = await import(\"@/utils/permissions\");\n        const departments = await getDepartments();\n        const userProfile: UserProfile = {\n          id: user.id,\n          email: user.email,\n          emailVerified: user.emailVerified,\n          fullName: user.fullName,\n          displayName: user.fullName,\n          phone: user.phone,\n          dateOfBirth: user.dateOfBirth,\n          role: user.roles,\n          createdAt: null,\n          updatedAt: null,\n        };\n        const result = await canApproveTeamRequest(userProfile, departments);\n        setCanApprove(result);\n      } catch (error: unknown) {\n        if (import.meta.env.DEV) {\n          console.error(\"Error checking approve team request permission:\", error);\n        }\n        setCanApprove(false);\n      }\n    };\n    checkPermission();\n  }, [user]);\n  const [loading, setLoading] = useState(true);\n  const [requests, setRequests] = useState<TeamApprovalRequest[]>([]);\n  const [rejectDialogOpen, setRejectDialogOpen] = useState(false);\n  const [selectedRequest, setSelectedRequest] = useState<TeamApprovalRequest | null>(null);\n  const [rejectReason, setRejectReason] = useState(\"\");\n\n  useEffect(() => {\n    fetchRequests();\n    \n    // Dinamik gncelleme iin users collection'n dinle\n    if (!user?.id) return;\n    \n    let unsubscribe: Unsubscribe | null = null;\n    let isMounted = true;\n    \n    // Users collection deitiinde talepleri yeniden ykle\n    unsubscribe = onSnapshot(\n      collection(firestore, \"users\"),\n      () => {\n        if (isMounted) {\n          fetchRequests();\n        }\n      },\n      (error) => {\n        if (import.meta.env.DEV) {\n          console.error(\"Users snapshot error:\", error);\n        }\n      }\n    );\n    \n    return () => {\n      isMounted = false;\n      if (unsubscribe) unsubscribe();\n    };\n  }, [user, isAdmin]);\n\n  const fetchRequests = async () => {\n    if (!user?.id) return;\n    \n    setLoading(true);\n    try {\n      let data: TeamApprovalRequest[];\n      if (isAdmin) {\n        // Ana yneticiler tm talepleri grebilir\n        data = await getAllPendingTeamRequests();\n      } else {\n        // Ekip liderleri sadece kendi ekiplerinin taleplerini grebilir\n        data = await getPendingTeamRequests(user.id);\n      }\n      setRequests(data);\n    } catch (error: unknown) {\n      toast.error(\"Talepler yklenirken hata: \" + (error instanceof Error ? error.message : String(error)));\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleApprove = async (request: TeamApprovalRequest) => {\n    if (!canApprove) {\n      toast.error(\"Ekip talebi onaylama yetkiniz yok.\");\n      return;\n    }\n    try {\n      await approveTeamRequest(request.userId, request.teamId, user?.id || \"\");\n      toast.success(`${request.userName} kullancs ${request.teamName} ekibine onayland`);\n      fetchRequests();\n    } catch (error: unknown) {\n      toast.error(\"Onaylama hatas: \" + (error instanceof Error ? error.message : String(error)));\n    }\n  };\n\n  const handleReject = async () => {\n    if (!selectedRequest) return;\n    if (!canApprove) {\n      toast.error(\"Ekip talebi reddetme yetkiniz yok.\");\n      return;\n    }\n    \n    try {\n      await rejectTeamRequest(selectedRequest.userId, selectedRequest.teamId, rejectReason, user?.id);\n      toast.success(`${selectedRequest.userName} kullancsnn ${selectedRequest.teamName} ekibi talebi reddedildi`);\n      setRejectDialogOpen(false);\n      setSelectedRequest(null);\n      setRejectReason(\"\");\n      fetchRequests();\n    } catch (error: unknown) {\n      toast.error(\"Reddetme hatas: \" + (error instanceof Error ? error.message : String(error)));\n    }\n  };\n\n  const openRejectDialog = (request: TeamApprovalRequest) => {\n    setSelectedRequest(request);\n    setRejectDialogOpen(true);\n  };\n\n  if (loading) {\n    return (\n      <Card>\n        <CardContent className=\"flex items-center justify-center py-8\">\n          <Loader2 className=\"h-6 w-6 animate-spin text-primary\" />\n        </CardContent>\n      </Card>\n    );\n  }\n\n  return (\n    <div className=\"space-y-4\">\n      <Card>\n        <CardContent className=\"pt-6\">\n          {requests.length > 0 && (\n            <div className=\"mb-4 flex justify-end\">\n              <Badge variant=\"secondary\">{requests.length} bekleyen talep</Badge>\n            </div>\n          )}\n          {requests.length === 0 ? (\n            <div className=\"text-center py-8 text-muted-foreground\">\n              Onay bekleyen ekip talebi yok\n            </div>\n          ) : (\n            <div className=\"space-y-3\">\n              {requests.map((request) => (\n                <div\n                  key={`${request.userId}-${request.teamId}`}\n                  className=\"flex items-center justify-between p-4 border rounded-lg hover:bg-muted/50 transition-colors\"\n                >\n                  <div className=\"flex-1\">\n                    <div className=\"flex items-center gap-2 mb-1\">\n                      <p className=\"font-semibold\">{request.userName}</p>\n                      <Badge variant=\"outline\">{request.teamName}</Badge>\n                    </div>\n                    <p className=\"text-sm text-muted-foreground\">{request.userEmail}</p>\n                    <p className=\"text-xs text-muted-foreground mt-1\">\n                      Talep tarihi: {request.requestedAt?.toDate().toLocaleDateString(\"tr-TR\")}\n                    </p>\n                  </div>\n                  <div className=\"flex items-center gap-2\">\n                    <Button\n                      size=\"sm\"\n                      variant=\"default\"\n                      onClick={() => handleApprove(request)}\n                      className=\"gap-2\"\n                    >\n                      <Check className=\"h-4 w-4\" />\n                      Onayla\n                    </Button>\n                    <Button\n                      size=\"sm\"\n                      variant=\"destructive\"\n                      onClick={() => openRejectDialog(request)}\n                      className=\"gap-2\"\n                    >\n                      <X className=\"h-4 w-4\" />\n                      Reddet\n                    </Button>\n                  </div>\n                </div>\n              ))}\n            </div>\n          )}\n        </CardContent>\n      </Card>\n\n      <AlertDialog open={rejectDialogOpen} onOpenChange={setRejectDialogOpen}>\n        <AlertDialogContent>\n          <AlertDialogHeader>\n            <AlertDialogTitle>Ekip Talebini Reddet</AlertDialogTitle>\n            <AlertDialogDescription>\n              {selectedRequest && (\n                <>\n                  <strong>{selectedRequest.userName}</strong> kullancsnn{\" \"}\n                  <strong>{selectedRequest.teamName}</strong> ekibi talebini reddetmek istediinizden emin misiniz?\n                </>\n              )}\n            </AlertDialogDescription>\n          </AlertDialogHeader>\n          <div className=\"space-y-2 py-4\">\n            <Label htmlFor=\"reject-reason\">Red Nedeni (Opsiyonel)</Label>\n            <Input\n              id=\"reject-reason\"\n              value={rejectReason}\n              onChange={(e) => setRejectReason(e.target.value)}\n              placeholder=\"Red nedeni...\"\n            />\n          </div>\n          <AlertDialogFooter>\n            <AlertDialogCancel>ptal</AlertDialogCancel>\n            <AlertDialogAction onClick={handleReject} className=\"bg-destructive text-destructive-foreground\">\n              Reddet\n            </AlertDialogAction>\n          </AlertDialogFooter>\n        </AlertDialogContent>\n      </AlertDialog>\n    </div>\n  );\n};\n\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\components\\Admin\\UserInsights.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\components\\Admin\\UserManagement.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\components\\Customers\\CreateCustomerDialog.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\components\\Customers\\CustomerCard.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\components\\Customers\\CustomerCombobox.tsx","messages":[],"suppressedMessages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchCustomers'. Either include it or remove the dependency array.","line":80,"column":6,"nodeType":"ArrayExpression","endLine":80,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [fetchCustomers]","fix":{"range":[2602,2604],"text":"[fetchCustomers]"}}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'customers.length', 'fetchCustomers', and 'loading'. Either include them or remove the dependency array.","line":88,"column":6,"nodeType":"ArrayExpression","endLine":88,"endColumn":12,"suggestions":[{"desc":"Update the dependencies array to be: [customers.length, fetchCustomers, loading, open]","fix":{"range":[2833,2839],"text":"[customers.length, fetchCustomers, loading, open]"}}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useCallback has a missing dependency: 'onChange'. Either include it or remove the dependency array. If 'onChange' changes too often, find the parent component that defines it and wrap that definition in useCallback.","line":128,"column":6,"nodeType":"ArrayExpression","endLine":128,"endColumn":17,"suggestions":[{"desc":"Update the dependencies array to be: [customers, onChange]","fix":{"range":[4127,4138],"text":"[customers, onChange]"}}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\components\\Customers\\CustomerDetailModal.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchData'. Either include it or remove the dependency array.","line":113,"column":6,"nodeType":"ArrayExpression","endLine":113,"endColumn":26,"suggestions":[{"desc":"Update the dependencies array to be: [open, customer?.id, fetchData]","fix":{"range":[4499,4519],"text":"[open, customer?.id, fetchData]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { Dialog, DialogContent, DialogHeader, DialogTitle, DialogDescription } from \"@/components/ui/dialog\";\nimport { Separator } from \"@/components/ui/separator\";\nimport { Mail, Phone, Building2, MapPin, FileText, Plus, Download, PhoneCall, PhoneIncoming, AlertTriangle, MessageSquare, ExternalLink, Calendar, User, TrendingUp, Package, CheckCircle2, Loader2, Receipt, Edit, Trash2, Save, X } from \"lucide-react\";\nimport { useState, useEffect, useMemo } from \"react\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Label } from \"@/components/ui/label\";\nimport { Input } from \"@/components/ui/input\";\nimport { toast } from \"sonner\";\nimport { useAuth } from \"@/contexts/AuthContext\";\nimport { canUpdateResource, canDeleteResource } from \"@/utils/permissions\";\nimport { UserProfile } from \"@/services/firebase/authService\";\nimport { getCustomerNotes, createCustomerNote, CustomerNote } from \"@/services/firebase/customerNoteService\";\nimport { getSavedReports, SavedReport } from \"@/services/firebase/reportService\";\nimport { getOrders, Order } from \"@/services/firebase/orderService\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Tooltip, TooltipContent, TooltipTrigger } from \"@/components/ui/tooltip\";\nimport { format } from \"date-fns\";\nimport { formatPhoneForDisplay, formatPhoneForTelLink, normalizePhone } from \"@/utils/phoneNormalizer\";\nimport { tr } from \"date-fns/locale\";\nimport { updateCustomer, deleteCustomer, Customer } from \"@/services/firebase/customerService\";\nimport { Timestamp } from \"firebase/firestore\";\nimport {\n  AlertDialog,\n  AlertDialogAction,\n  AlertDialogCancel,\n  AlertDialogContent,\n  AlertDialogDescription,\n  AlertDialogFooter,\n  AlertDialogHeader,\n  AlertDialogTitle,\n} from \"@/components/ui/alert-dialog\";\n\ninterface CustomerDetailModalProps {\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n  customer: Customer;\n  onUpdate?: () => void;\n  onDelete?: () => void;\n}\n\nexport const CustomerDetailModal = ({ open, onOpenChange, customer, onUpdate, onDelete }: CustomerDetailModalProps) => {\n  const { user, isTeamLeader } = useAuth();\n  const [notes, setNotes] = useState<CustomerNote[]>([]);\n  const [quotes, setQuotes] = useState<SavedReport[]>([]);\n  const [orders, setOrders] = useState<Order[]>([]);\n  const [loading, setLoading] = useState(false);\n  const [newNoteContent, setNewNoteContent] = useState(\"\");\n  const [isAddingNote, setIsAddingNote] = useState(false);\n  const [isEditing, setIsEditing] = useState(false);\n  const [saving, setSaving] = useState(false);\n  const [deleteDialogOpen, setDeleteDialogOpen] = useState(false);\n  const [canUpdate, setCanUpdate] = useState(false);\n  const [canDelete, setCanDelete] = useState(false);\n  \n  // Personel kontrol - Personel mteri detayn grebilir ama dzenleyemez\n  const isPersonnel = user?.roles?.includes(\"personnel\") || false;\n  const [formData, setFormData] = useState({\n    name: \"\",\n    email: \"\",\n    phone: \"\",\n    company: \"\",\n    address: \"\",\n    tax_number: \"\",\n    notes: \"\",\n  });\n\n  // Yetki kontrolleri - Firestore'dan kontrol et\n  useEffect(() => {\n    const checkPermissions = async () => {\n      if (!user || !customer) {\n        setCanUpdate(false);\n        setCanDelete(false);\n        return;\n      }\n      try {\n        const userProfile: UserProfile = {\n          id: user.id,\n          email: user.email,\n          emailVerified: user.emailVerified,\n          fullName: user.fullName,\n          displayName: user.fullName,\n          phone: null,\n          dateOfBirth: null,\n          role: user.roles || [],\n          createdAt: null,\n          updatedAt: null,\n        };\n        const [canUpdateCustomer, canDeleteCustomer] = await Promise.all([\n          canUpdateResource(userProfile, \"customers\"),\n          canDeleteResource(userProfile, \"customers\"),\n        ]);\n        setCanUpdate(canUpdateCustomer);\n        setCanDelete(canDeleteCustomer);\n      } catch (error: unknown) {\n        if (import.meta.env.DEV) {\n          console.error(\"Error checking customer permissions:\", error);\n        }\n        setCanUpdate(false);\n        setCanDelete(false);\n      }\n    };\n    checkPermissions();\n  }, [user, customer]);\n\n  useEffect(() => {\n    if (open && customer?.id) {\n      fetchData();\n      setIsEditing(false);\n    }\n  }, [open, customer?.id]);\n\n  useEffect(() => {\n    if (customer && !isEditing) {\n      setFormData({\n        name: customer.name || \"\",\n        email: customer.email || \"\",\n        phone: formatPhoneForDisplay(customer.phone) || \"\",\n        company: customer.company || \"\",\n        address: customer.address || \"\",\n        tax_number: customer.taxId || \"\",\n        notes: customer.notes || \"\",\n      });\n    }\n  }, [customer, isEditing]);\n\n  const fetchData = async () => {\n    if (!customer?.id) return;\n    setLoading(true);\n    try {\n      const [notesData, quotesData, ordersData] = await Promise.all([\n        getCustomerNotes(customer.id),\n        getSavedReports({ reportType: \"sales_quote\" }),\n        getOrders({ customerId: customer.id }),\n      ]);\n      setNotes(notesData);\n      // Quotes'lar customerId'ye gre filtrele\n      const customerQuotes = quotesData.filter((quote) => {\n        const metadata = quote.metadata as { customerId?: string } | null | undefined;\n        return metadata?.customerId === customer.id;\n      });\n      setQuotes(customerQuotes);\n      setOrders(ordersData);\n    } catch (error: unknown) {\n      const errorMessage = error instanceof Error ? error.message : \"Bilinmeyen hata\";\n      toast.error(\"Veriler yklenirken hata: \" + errorMessage);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleAddNote = async () => {\n    if (!customer?.id || !user?.id) return;\n    if (!newNoteContent.trim()) {\n      toast.error(\"Not ierii gereklidir\");\n      return;\n    }\n\n    setIsAddingNote(true);\n    try {\n      await createCustomerNote({\n        customerId: customer.id,\n        type: \"general\",\n        title: \"Not\",\n        content: newNoteContent.trim(),\n        createdBy: user.id,\n      });\n      toast.success(\"Not eklendi\");\n      setNewNoteContent(\"\");\n      fetchData();\n    } catch (error: unknown) {\n      const errorMessage = error instanceof Error ? error.message : \"Bilinmeyen hata\";\n      toast.error(\"Not eklenirken hata: \" + errorMessage);\n    } finally {\n      setIsAddingNote(false);\n    }\n  };\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    if (!customer?.id || !user?.id) return;\n\n    // Yetki kontrol - Personel dzenleme yapamaz\n    if (isPersonnel) {\n      toast.error(\"Mteri dzenleme yetkiniz yok.\");\n      setIsEditing(false);\n      return;\n    }\n\n    // Yetki kontrol\n    if (!canUpdate && customer.createdBy !== user.id && !isTeamLeader) {\n      toast.error(\"Mteri dzenleme yetkiniz yok.\");\n      setIsEditing(false);\n      return;\n    }\n\n    if (!formData.name.trim()) {\n      toast.error(\"sim gereklidir\");\n      return;\n    }\n\n    setSaving(true);\n    try {\n      await updateCustomer(\n        customer.id,\n        {\n          name: formData.name.trim(),\n          company: formData.company.trim() || null,\n          email: formData.email.trim() || null,\n          phone: normalizePhone(formData.phone),\n          address: formData.address.trim() || null,\n          taxId: formData.tax_number.trim() || null,\n          notes: formData.notes.trim() || null,\n        },\n        user.id\n      );\n\n      toast.success(\"Mteri baaryla gncellendi\");\n      setIsEditing(false);\n      if (onUpdate) {\n        onUpdate();\n      }\n      fetchData();\n    } catch (error: unknown) {\n      if (import.meta.env.DEV) console.error(\"Update customer error:\", error);\n      const errorMessage = error instanceof Error ? error.message : \"Bilinmeyen hata\";\n      toast.error(errorMessage || \"Mteri gncellenirken hata olutu\");\n    } finally {\n      setSaving(false);\n    }\n  };\n\n  const handleDelete = async () => {\n    if (!customer?.id) return;\n\n    // Yetki kontrol - Personel silme yapamaz\n    if (isPersonnel) {\n      toast.error(\"Mteri silme yetkiniz yok.\");\n      setDeleteDialogOpen(false);\n      return;\n    }\n\n    // Yetki kontrol\n    if (!canDelete && customer.createdBy !== user?.id && !isTeamLeader) {\n      toast.error(\"Mteri silme yetkiniz yok.\");\n      setDeleteDialogOpen(false);\n      return;\n    }\n\n    try {\n      await deleteCustomer(customer.id, user?.id);\n      toast.success(\"Mteri silindi\");\n      setDeleteDialogOpen(false);\n      onOpenChange(false);\n      if (onDelete) {\n        onDelete();\n      }\n    } catch (error: unknown) {\n      if (import.meta.env.DEV) console.error(\"Delete customer error:\", error);\n      const errorMessage = error instanceof Error ? error.message : \"Bilinmeyen hata\";\n      toast.error(errorMessage || \"Mteri silinirken hata olutu\");\n    }\n  };\n\n  const getNoteTypeLabel = (type: CustomerNote[\"type\"]) => {\n    switch (type) {\n      case \"phone_call_out\":\n        return \"Telefonla Aradk\";\n      case \"phone_call_in\":\n        return \"Bizi Arad\";\n      case \"warranty\":\n        return \"Arza Kayd\";\n      case \"general\":\n        return \"Genel Not\";\n      default:\n        return type;\n    }\n  };\n\n  const getNoteTypeIcon = (type: CustomerNote[\"type\"]) => {\n    switch (type) {\n      case \"phone_call_out\":\n        return PhoneCall;\n      case \"phone_call_in\":\n        return PhoneIncoming;\n      case \"warranty\":\n        return AlertTriangle;\n      case \"general\":\n        return MessageSquare;\n      default:\n        return FileText;\n    }\n  };\n\n  // statistikleri hesapla\n  const stats = useMemo(() => {\n    const totalOrders = orders.length;\n    const totalOrderAmount = orders.reduce((sum, order) => sum + (order.totalAmount || 0), 0);\n    const totalQuotes = quotes.length;\n    const totalQuoteAmount = quotes.reduce((sum, quote) => {\n      const metadata = quote.metadata as { grandTotal?: number } | null | undefined;\n      return sum + (metadata?.grandTotal || 0);\n    }, 0);\n    const completedOrders = orders.filter((o) => o.status === \"completed\" || o.status === \"delivered\").length;\n    \n    return {\n      totalOrders,\n      totalOrderAmount,\n      totalQuotes,\n      totalQuoteAmount,\n      completedOrders,\n    };\n  }, [orders, quotes]);\n\n  const formatCurrency = (value: number) => {\n    return new Intl.NumberFormat(\"tr-TR\", {\n      style: \"currency\",\n      currency: \"TRY\",\n      minimumFractionDigits: 2,\n    }).format(value);\n  };\n\n  const formatDateSafe = (dateInput?: Timestamp | Date | string | null) => {\n    if (!dateInput) return \"-\";\n    try {\n      let date: Date;\n      \n      // Timestamp kontrol (Firebase Timestamp)\n      if (dateInput instanceof Timestamp) {\n        date = dateInput.toDate();\n      }\n      // Date objesi\n      else if (dateInput instanceof Date) {\n        date = dateInput;\n      }\n      // String (ISO format veya dier)\n      else if (typeof dateInput === \"string\") {\n        const parsed = new Date(dateInput);\n        if (!Number.isNaN(parsed.getTime())) {\n          date = parsed;\n        } else {\n          return \"-\";\n        }\n      }\n      // Number (timestamp)\n      else if (typeof dateInput === \"number\") {\n        date = new Date(dateInput);\n      }\n      // Dier durumlar (object with seconds property)\n      else if (typeof dateInput === \"object\" && dateInput !== null && \"seconds\" in dateInput) {\n        const timestamp = dateInput as { seconds: number; nanoseconds?: number };\n        date = new Date(timestamp.seconds * 1000 + (timestamp.nanoseconds || 0) / 1000000);\n      }\n      else {\n        return \"-\";\n      }\n      \n      if (Number.isNaN(date.getTime())) return \"-\";\n      return format(date, \"dd MMM yyyy\", { locale: tr });\n    } catch (error) {\n      if (import.meta.env.DEV) console.error(\"Date formatting error:\", error, dateInput);\n      return \"-\";\n    }\n  };\n\n  if (!customer) return null;\n\n  return (\n    <Dialog open={open} onOpenChange={onOpenChange}>\n      <DialogContent className=\"!max-w-[100vw] sm:!max-w-[95vw] md:!max-w-[85vw] !w-[100vw] sm:!w-[95vw] md:!w-[85vw] !h-[100vh] sm:!h-[90vh] md:!h-[80vh] !max-h-[100vh] sm:!max-h-[90vh] md:!max-h-[80vh] !left-0 sm:!left-[2.5vw] md:!left-[7.5vw] !top-0 sm:!top-[5vh] md:!top-[10vh] !right-0 sm:!right-auto !bottom-0 sm:!bottom-auto !translate-x-0 !translate-y-0 overflow-hidden !p-0 gap-0 bg-white flex flex-col !m-0 !rounded-none sm:!rounded-lg !border-0 sm:!border\">\n        {/* DialogTitle ve DialogDescription DialogContent'in direkt child' olmal (Radix UI gereksinimi) */}\n        <DialogTitle className=\"sr-only\" id=\"customer-detail-title\">\n          {isEditing ? \"Mteri Dzenle\" : `Mteri Detay - ${customer.name}`}\n        </DialogTitle>\n        <DialogDescription className=\"sr-only\" id=\"customer-detail-description\">\n          Mteri detaylar ve bilgileri\n        </DialogDescription>\n        \n        <div className=\"flex flex-col h-full min-h-0\">\n          {/* Header */}\n          <DialogHeader className=\"p-3 sm:p-4 border-b bg-white flex-shrink-0 relative pr-12 sm:pr-16\">\n            <div className=\"flex items-center justify-between gap-3\">\n              <div className=\"flex items-center gap-2 sm:gap-3 flex-1 min-w-0\">\n                <div className=\"h-8 w-8 sm:h-10 sm:w-10 rounded-lg bg-primary/10 flex items-center justify-center border border-primary/20 flex-shrink-0\">\n                  <User className=\"h-4 w-4 sm:h-5 sm:w-5 text-primary\" />\n                </div>\n                <div className=\"flex-1 min-w-0\">\n                  <h2 className=\"text-[16px] sm:text-[18px] font-semibold text-foreground truncate\">\n                    {isEditing ? \"Mteri Dzenle\" : customer.name}\n                  </h2>\n                  {!isEditing && customer.company && (\n                    <p className=\"text-[11px] sm:text-xs text-muted-foreground truncate mt-0.5\">\n                      {customer.company}\n                    </p>\n                  )}\n                </div>\n              </div>\n              <div className=\"flex flex-wrap gap-2 flex-shrink-0\">\n              {!isEditing ? (\n                <>\n                  {customer.email && (\n                    <Button\n                      variant=\"secondary\"\n                      size=\"sm\"\n                      className=\"bg-primary/10 text-primary hover:bg-primary/20 rounded-lg px-3 py-1.5 font-medium shadow-sm text-[11px] sm:text-xs flex-shrink-0 min-h-[36px] sm:min-h-8\"\n                      onClick={() => window.open(`https://mail.google.com/mail/?view=cm&fs=1&to=${encodeURIComponent(customer.email)}`, '_blank')}\n                      aria-label=\"E-posta gnder\"\n                    >\n                      <Mail className=\"h-3 w-3 sm:h-4 sm:w-4 mr-1.5 flex-shrink-0\" />\n                      Mail\n                    </Button>\n                  )}\n                  {customer.phone && (\n                    <Button\n                      variant=\"outline\"\n                      size=\"sm\"\n                      className=\"border-primary/20 hover:bg-primary/5 rounded-lg px-3 py-1.5 font-medium text-[11px] sm:text-xs flex-shrink-0 min-h-[36px] sm:min-h-8\"\n                      onClick={() => window.location.href = `tel:${formatPhoneForTelLink(customer.phone)}`}\n                      aria-label=\"Telefon ara\"\n                    >\n                      <Phone className=\"h-3 w-3 sm:h-4 sm:w-4 mr-1.5 flex-shrink-0\" />\n                      Ara\n                    </Button>\n                  )}\n                  {!isPersonnel && (\n                    <Button\n                      variant=\"outline\"\n                      size=\"sm\"\n                      className=\"border-primary/20 hover:bg-primary/5 rounded-lg px-3 py-1.5 font-medium text-[11px] sm:text-xs flex-shrink-0 min-h-[36px] sm:min-h-8\"\n                      onClick={() => setIsEditing(true)}\n                      disabled={!canUpdate && customer.createdBy !== user?.id && !isTeamLeader}\n                    >\n                      <Edit className=\"h-3 w-3 sm:h-4 sm:w-4 mr-1.5 flex-shrink-0\" />\n                      Dzenle\n                    </Button>\n                  )}\n                  {!isPersonnel && (\n                    <Button\n                      variant=\"outline\"\n                      size=\"sm\"\n                      className=\"border-destructive/20 hover:bg-destructive/5 text-destructive rounded-lg px-3 py-1.5 font-medium text-[11px] sm:text-xs flex-shrink-0 min-h-[36px] sm:min-h-8\"\n                      onClick={() => setDeleteDialogOpen(true)}\n                    >\n                      <Trash2 className=\"h-3 w-3 sm:h-4 sm:w-4 mr-1.5 flex-shrink-0\" />\n                      Sil\n                    </Button>\n                  )}\n                </>\n              ) : (\n                <>\n                  <Button\n                    variant=\"outline\"\n                    size=\"sm\"\n                    className=\"border-primary/20 hover:bg-primary/5 rounded-lg px-3 py-1.5 font-medium text-[11px] sm:text-xs flex-shrink-0 min-h-[36px] sm:min-h-8\"\n                    onClick={() => {\n                      setIsEditing(false);\n                      setFormData({\n                        name: customer.name || \"\",\n                        email: customer.email || \"\",\n                        phone: formatPhoneForDisplay(customer.phone) || \"\",\n                        company: customer.company || \"\",\n                        address: customer.address || \"\",\n                        tax_number: customer.taxId || \"\",\n                        notes: customer.notes || \"\",\n                      });\n                    }}\n                    disabled={saving}\n                  >\n                    <X className=\"h-3 w-3 sm:h-4 sm:w-4 mr-1.5 flex-shrink-0\" />\n                    ptal\n                  </Button>\n                  <Button\n                    variant=\"default\"\n                    size=\"sm\"\n                    className=\"bg-primary hover:bg-primary/90 rounded-lg px-3 py-1.5 font-medium text-[11px] sm:text-xs flex-shrink-0 text-white min-h-[36px] sm:min-h-8\"\n                    onClick={handleSubmit}\n                    disabled={saving}\n                  >\n                    {saving ? (\n                      <Loader2 className=\"h-3 w-3 sm:h-4 sm:w-4 mr-1.5 flex-shrink-0 animate-spin\" />\n                    ) : (\n                      <Save className=\"h-3 w-3 sm:h-4 sm:w-4 mr-1.5 flex-shrink-0\" />\n                    )}\n                    Kaydet\n                  </Button>\n                </>\n              )}\n            </div>\n          </div>\n          </DialogHeader>\n          {/* Quick Info Chips */}\n          {(customer.email || customer.phone || customer.taxId) && (\n            <div className=\"px-3 sm:px-6 py-2 sm:py-3 border-b bg-gray-50/50 flex flex-wrap items-center gap-2 flex-shrink-0\">\n              {customer.email && (\n                <div className=\"flex items-center gap-1 rounded-full border bg-muted/40 px-3 py-1.5 text-[11px] sm:text-xs font-medium text-muted-foreground\">\n                  <Mail className=\"h-3 w-3\" />\n                  <span className=\"text-muted-foreground/70\">E-posta:</span>\n                  <span className=\"text-foreground truncate max-w-[200px]\">{customer.email}</span>\n                </div>\n              )}\n              {customer.phone && (\n                <div className=\"flex items-center gap-1 rounded-full border bg-muted/40 px-3 py-1.5 text-[11px] sm:text-xs font-medium text-muted-foreground\">\n                  <Phone className=\"h-3 w-3\" />\n                  <span className=\"text-muted-foreground/70\">Telefon:</span>\n                  <span className=\"text-foreground\">{formatPhoneForDisplay(customer.phone)}</span>\n                </div>\n              )}\n              {customer.taxId && (\n                <div className=\"flex items-center gap-1 rounded-full border bg-muted/40 px-3 py-1.5 text-[11px] sm:text-xs font-medium text-muted-foreground\">\n                  <span className=\"text-muted-foreground/70\">Vergi No:</span>\n                  <span className=\"text-foreground\">{customer.taxId}</span>\n                </div>\n              )}\n        </div>\n          )}\n        \n          <div className=\"flex-1 overflow-hidden bg-gray-50/50 p-3 sm:p-4 min-h-0\">\n            <div className=\"max-w-full mx-auto h-full overflow-y-auto\">\n              {loading ? (\n                <div className=\"flex items-center justify-center py-8\">\n                  <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-primary\"></div>\n                </div>\n              ) : (\n                <div className=\"space-y-6\">\n\n        {/* statistik Kartlar */}\n        <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3 sm:gap-4\">\n          <div className=\"rounded-2xl border bg-gradient-to-br from-primary/10 via-white to-white border-primary/20 text-card-foreground p-4 shadow-sm transition hover:shadow-md hover:-translate-y-0.5 flex flex-col h-full\">\n            <div className=\"flex items-start justify-between flex-1\">\n              <div className=\"flex-1 min-w-0\">\n                <p className=\"text-[11px] sm:text-xs uppercase tracking-wide text-muted-foreground mb-1\">Toplam Sipari</p>\n                <p className=\"text-[11px] sm:text-xs font-semibold leading-tight\">{stats.totalOrders}</p>\n              </div>\n              <div className=\"rounded-full border p-2 bg-white/75 shadow-inner shrink-0 ml-2\">\n                <Package className=\"h-5 w-5 text-primary\" />\n              </div>\n            </div>\n          </div>\n          <div className=\"rounded-2xl border bg-gradient-to-br from-emerald-50/80 via-white to-white border-emerald-100 text-card-foreground p-4 shadow-sm transition hover:shadow-md hover:-translate-y-0.5 flex flex-col h-full\">\n            <div className=\"flex items-start justify-between flex-1\">\n              <div className=\"flex-1 min-w-0\">\n                <p className=\"text-[11px] sm:text-xs uppercase tracking-wide text-muted-foreground mb-1\">Sipari Tutar</p>\n                <p className=\"text-lg sm:text-xl font-semibold leading-tight\">{formatCurrency(stats.totalOrderAmount)}</p>\n              </div>\n              <div className=\"rounded-full border p-2 bg-white/75 shadow-inner shrink-0 ml-2\">\n                <TrendingUp className=\"h-5 w-5 text-emerald-600\" />\n              </div>\n            </div>\n          </div>\n          <div className=\"rounded-2xl border bg-gradient-to-br from-blue-50/80 via-white to-white border-blue-100 text-card-foreground p-4 shadow-sm transition hover:shadow-md hover:-translate-y-0.5 flex flex-col h-full\">\n            <div className=\"flex items-start justify-between flex-1\">\n              <div className=\"flex-1 min-w-0\">\n                <p className=\"text-[11px] sm:text-xs uppercase tracking-wide text-muted-foreground mb-1\">Fiyat Teklifleri</p>\n                <p className=\"text-lg sm:text-xl font-semibold leading-tight\">{stats.totalQuotes}</p>\n              </div>\n              <div className=\"rounded-full border p-2 bg-white/75 shadow-inner shrink-0 ml-2\">\n                <FileText className=\"h-5 w-5 text-blue-600\" />\n              </div>\n            </div>\n          </div>\n          <div className=\"rounded-2xl border bg-gradient-to-br from-amber-50/80 via-white to-white border-amber-100 text-card-foreground p-4 shadow-sm transition hover:shadow-md hover:-translate-y-0.5 flex flex-col h-full\">\n            <div className=\"flex items-start justify-between flex-1\">\n              <div className=\"flex-1 min-w-0\">\n                <p className=\"text-[11px] sm:text-xs uppercase tracking-wide text-muted-foreground mb-1\">Tamamlanan</p>\n                <p className=\"text-lg sm:text-xl font-semibold leading-tight\">{stats.completedOrders}</p>\n              </div>\n              <div className=\"rounded-full border p-2 bg-white/75 shadow-inner shrink-0 ml-2\">\n                <CheckCircle2 className=\"h-5 w-5 text-amber-600\" />\n              </div>\n            </div>\n          </div>\n        </div>\n        <Tabs defaultValue=\"info\" className=\"w-full overflow-x-hidden max-w-full px-3 sm:px-4 md:px-6 lg:px-12\">\n          <TabsList className=\"grid w-full grid-cols-4 h-auto sm:h-10 md:h-11 bg-muted/50 rounded-lg p-1 border gap-1\">\n            <TabsTrigger \n              value=\"info\" \n              className=\"rounded-md data-[state=active]:bg-background data-[state=active]:shadow-sm data-[state=active]:text-primary text-[11px] sm:text-xs font-medium transition-all duration-200 min-h-[44px] sm:min-h-0\"\n            >\n              Bilgiler\n            </TabsTrigger>\n            <TabsTrigger \n              value=\"quotes\" \n              className=\"rounded-md data-[state=active]:bg-background data-[state=active]:shadow-sm data-[state=active]:text-primary text-[11px] sm:text-xs font-medium transition-all duration-200 min-h-[44px] sm:min-h-0\"\n            >\n              Fiyat Teklifleri\n            </TabsTrigger>\n            <TabsTrigger \n              value=\"orders\" \n              className=\"rounded-md data-[state=active]:bg-background data-[state=active]:shadow-sm data-[state=active]:text-primary text-[11px] sm:text-xs font-medium transition-all duration-200 min-h-[44px] sm:min-h-0\"\n            >\n              Sipariler\n            </TabsTrigger>\n            <TabsTrigger \n              value=\"notes\" \n              className=\"rounded-md data-[state=active]:bg-background data-[state=active]:shadow-sm data-[state=active]:text-primary text-[11px] sm:text-xs font-medium transition-all duration-200 min-h-[44px] sm:min-h-0\"\n            >\n              Notlar\n            </TabsTrigger>\n          </TabsList>\n\n          <TabsContent value=\"info\" className=\"space-y-3 sm:space-y-4 mt-4 sm:mt-6 focus:outline-none overflow-x-hidden max-w-full\">\n            {isEditing ? (\n              <form onSubmit={handleSubmit} className=\"space-y-3 sm:space-y-4\">\n                <Card>\n                  <CardContent className=\"p-3 sm:p-4 space-y-3 sm:space-y-4\">\n                    <div>\n                      <h3 className=\"text-[14px] sm:text-[15px] font-semibold text-foreground mb-1\">Mteri Bilgileri</h3>\n                      <p className=\"text-[11px] sm:text-xs text-muted-foreground\">Temel mteri bilgilerini gncelleyin</p>\n                    </div>\n                    \n                    <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4\">\n                      <div className=\"space-y-1.5 sm:space-y-2\">\n                        <Label htmlFor=\"name\" showRequired className=\"text-[11px] sm:text-xs\">sim</Label>\n                        <Input\n                          id=\"name\"\n                          value={formData.name}\n                          onChange={(e) => setFormData({ ...formData, name: e.target.value })}\n                          className=\"text-[11px] sm:text-xs min-h-[44px] sm:min-h-0\"\n                          required\n                        />\n                      </div>\n                      <div className=\"space-y-1.5 sm:space-y-2\">\n                        <Label htmlFor=\"company\" className=\"text-[11px] sm:text-xs\">irket</Label>\n                        <Input\n                          id=\"company\"\n                          value={formData.company}\n                          onChange={(e) => setFormData({ ...formData, company: e.target.value })}\n                          className=\"text-[11px] sm:text-xs min-h-[44px] sm:min-h-0\"\n                        />\n                      </div>\n                    </div>\n\n                    <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4\">\n                      <div className=\"space-y-1.5 sm:space-y-2\">\n                        <Label htmlFor=\"email\" className=\"text-[11px] sm:text-xs\">E-posta</Label>\n                        <Input\n                          id=\"email\"\n                          type=\"email\"\n                          value={formData.email}\n                          onChange={(e) => setFormData({ ...formData, email: e.target.value })}\n                          className=\"text-[11px] sm:text-xs min-h-[44px] sm:min-h-0\"\n                        />\n                      </div>\n                      <div className=\"space-y-1.5 sm:space-y-2\">\n                        <Label htmlFor=\"phone\" className=\"text-[11px] sm:text-xs\">Telefon</Label>\n                        <Input\n                          id=\"phone\"\n                          value={formData.phone}\n                          onChange={(e) => setFormData({ ...formData, phone: e.target.value })}\n                          className=\"text-[11px] sm:text-xs min-h-[44px] sm:min-h-0\"\n                        />\n                      </div>\n                    </div>\n\n                    <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4\">\n                      <div className=\"space-y-1.5 sm:space-y-2\">\n                        <Label htmlFor=\"address\" className=\"text-[11px] sm:text-xs\">Adres</Label>\n                        <Textarea\n                          id=\"address\"\n                          value={formData.address}\n                          onChange={(e) => setFormData({ ...formData, address: e.target.value })}\n                          rows={3}\n                          className=\"text-[11px] sm:text-xs min-h-[44px] sm:min-h-0 resize-none\"\n                        />\n                      </div>\n                      <div className=\"space-y-1.5 sm:space-y-2\">\n                        <Label htmlFor=\"tax_number\" className=\"text-[11px] sm:text-xs\">Vergi No</Label>\n                        <Input\n                          id=\"tax_number\"\n                          value={formData.tax_number}\n                          onChange={(e) => setFormData({ ...formData, tax_number: e.target.value })}\n                          className=\"text-[11px] sm:text-xs min-h-[44px] sm:min-h-0\"\n                        />\n                      </div>\n                    </div>\n\n                    <div className=\"space-y-1.5 sm:space-y-2\">\n                      <Label htmlFor=\"notes\" className=\"text-[11px] sm:text-xs\">Notlar</Label>\n                      <Textarea\n                        id=\"notes\"\n                        value={formData.notes}\n                        onChange={(e) => setFormData({ ...formData, notes: e.target.value })}\n                        rows={4}\n                        className=\"text-[11px] sm:text-xs min-h-[44px] sm:min-h-0 resize-none\"\n                        placeholder=\"Mteri hakknda notlar...\"\n                      />\n                    </div>\n                  </CardContent>\n                </Card>\n              </form>\n            ) : (\n              <>\n                {/* Temel Bilgiler */}\n                <div className=\"space-y-3 sm:space-y-4\">\n                  <div className=\"flex items-start gap-3\">\n                    <User className=\"h-5 w-5 text-muted-foreground mt-0.5 flex-shrink-0\" />\n                    <div className=\"flex-1 min-w-0\">\n                      <p className=\"text-[11px] sm:text-xs font-medium text-foreground mb-0.5\">sim</p>\n                      <p className=\"text-[11px] sm:text-xs text-muted-foreground\">{customer.name}</p>\n                    </div>\n                  </div>\n\n                  {customer.company && (\n                    <div className=\"flex items-start gap-3\">\n                      <Building2 className=\"h-5 w-5 text-muted-foreground mt-0.5 flex-shrink-0\" />\n                        <div className=\"flex-1 min-w-0\">\n                        <p className=\"text-[11px] sm:text-xs font-medium text-foreground mb-0.5\">irket</p>\n                        <p className=\"text-[11px] sm:text-xs text-muted-foreground\">{customer.company}</p>\n                      </div>\n                    </div>\n                  )}\n\n                  {customer.email && (\n                    <div className=\"flex items-start gap-3\">\n                      <Mail className=\"h-5 w-5 text-muted-foreground mt-0.5 flex-shrink-0\" />\n                        <div className=\"flex-1 min-w-0\">\n                        <p className=\"text-[11px] sm:text-xs font-medium text-foreground mb-0.5\">E-posta</p>\n                        <p className=\"text-[11px] sm:text-xs text-muted-foreground break-all\">{customer.email}</p>\n                      </div>\n                    </div>\n                  )}\n\n                  {customer.phone && (\n                    <div className=\"flex items-start gap-3\">\n                      <Phone className=\"h-5 w-5 text-muted-foreground mt-0.5 flex-shrink-0\" />\n                        <div className=\"flex-1 min-w-0\">\n                        <p className=\"text-[11px] sm:text-xs font-medium text-foreground mb-0.5\">Telefon</p>\n                        <p className=\"text-[11px] sm:text-xs text-muted-foreground\">{formatPhoneForDisplay(customer.phone)}</p>\n                        </div>\n                      </div>\n                  )}\n\n                  {customer.taxId && (\n                    <div className=\"flex items-start gap-3\">\n                      <Receipt className=\"h-5 w-5 text-muted-foreground mt-0.5 flex-shrink-0\" />\n                      <div className=\"flex-1 min-w-0\">\n                        <p className=\"text-[11px] sm:text-xs font-medium text-foreground mb-0.5\">Vergi No</p>\n                        <p className=\"text-[11px] sm:text-xs text-muted-foreground\">{customer.taxId}</p>\n                      </div>\n                    </div>\n                  )}\n              </div>\n\n              {customer.address && (\n                <>\n                    <Separator />\n                    <div className=\"flex items-start gap-3\">\n                      <MapPin className=\"h-5 w-5 text-muted-foreground mt-0.5 flex-shrink-0\" />\n                      <div className=\"flex-1 min-w-0\">\n                        <p className=\"text-[11px] sm:text-xs font-medium text-foreground mb-0.5\">Adres</p>\n                        <p className=\"text-[11px] sm:text-xs text-muted-foreground whitespace-pre-wrap break-words leading-relaxed\">{customer.address}</p>\n                        </div>\n                    </div>\n                </>\n              )}\n\n                <Separator />\n\n                <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4\">\n                <div>\n                    <p className=\"text-[11px] sm:text-xs font-semibold text-muted-foreground uppercase tracking-wide mb-1.5\">Oluturma Tarihi</p>\n                      <p className=\"text-[11px] sm:text-xs font-medium text-foreground\">\n                      {formatDateSafe(customer.createdAt)}\n                  </p>\n                </div>\n                <div>\n                    <p className=\"text-[11px] sm:text-xs font-semibold text-muted-foreground uppercase tracking-wide mb-1.5\">Son Gncelleme</p>\n                      <p className=\"text-[11px] sm:text-xs font-medium text-foreground\">\n                      {formatDateSafe(customer.updatedAt)}\n                        </p>\n                  </div>\n              </div>\n              </>\n            )}\n          </TabsContent>\n\n          <TabsContent value=\"quotes\" className=\"space-y-3 sm:space-y-4 mt-4 sm:mt-6 focus:outline-none overflow-x-hidden max-w-full\">\n            <div className=\"flex items-center justify-between mb-4 sm:mb-6\">\n              <h3 className=\"text-lg sm:text-xl font-bold text-foreground\">Fiyat Teklifleri ({quotes.length})</h3>\n            </div>\n            {loading ? (\n              <div className=\"flex flex-col items-center justify-center py-16\">\n                <Loader2 className=\"h-8 w-8 animate-spin text-primary mb-4\" />\n                <p className=\"text-[11px] sm:text-xs text-muted-foreground\">Ykleniyor...</p>\n              </div>\n            ) : quotes.length === 0 ? (\n              <Card className=\"border-2 border-dashed\">\n                <CardContent className=\"p-12 text-center\">\n                  <FileText className=\"h-12 w-12 text-muted-foreground/50 mx-auto mb-4\" />\n                  <p className=\"text-[11px] sm:text-xs font-medium text-muted-foreground\">Henz teklif bulunmuyor</p>\n                </CardContent>\n              </Card>\n            ) : (\n              <div className=\"space-y-3\">\n                {quotes.map((quote) => (\n                  <Card key={quote.id} className=\"border-2 hover:border-primary/50 hover:shadow-md transition-all duration-200\">\n                    <CardContent className=\"p-5\">\n                      <div className=\"flex items-center justify-between gap-4\">\n                        <div className=\"flex-1 min-w-0\">\n                          <p className=\"font-bold text-[11px] sm:text-xs mb-2 text-foreground\">{quote.title}</p>\n                          <p className=\"text-[11px] sm:text-xs text-muted-foreground\">\n                            {formatDateSafe(quote.createdAt)}\n                        </p>\n                      </div>\n                        <div className=\"flex items-center gap-3 flex-shrink-0\">\n                          <Badge variant=\"outline\" className=\"text-[10px] font-semibold px-3 py-1 whitespace-nowrap\">\n                          {((quote.metadata as { grandTotal?: number } | null | undefined)?.grandTotal || 0).toLocaleString(\"tr-TR\")}\n                        </Badge>\n                        <Button\n                          size=\"sm\"\n                          variant=\"outline\"\n                            className=\"text-[11px] sm:text-xs font-semibold\"\n                          onClick={async () => {\n                            try {\n                              if (!quote.fileUrl) {\n                                toast.error(\"Dosya balants bulunamad\");\n                                return;\n                              }\n                              \n                              const response = await fetch(quote.fileUrl);\n                              const blob = await response.blob();\n                              const url = window.URL.createObjectURL(blob);\n                              const a = document.createElement('a');\n                              a.href = url;\n                              const fileName = quote.fileName || `${quote.title || \"teklif\"}.pdf`;\n                              a.download = fileName;\n                              document.body.appendChild(a);\n                              a.click();\n                              window.URL.revokeObjectURL(url);\n                              document.body.removeChild(a);\n                            } catch (error) {\n                              console.error(\"Download error:\", error);\n                              if (quote.fileUrl) {\n                                window.open(quote.fileUrl, \"_blank\");\n                              } else {\n                                toast.error(\"Dosya balants bulunamad\");\n                              }\n                            }\n                          }}\n                        >\n                          <Download className=\"h-4 w-4 mr-2\" />\n                          ndir\n                        </Button>\n                      </div>\n                    </div>\n                    </CardContent>\n                  </Card>\n                ))}\n              </div>\n            )}\n          </TabsContent>\n\n          <TabsContent value=\"orders\" className=\"space-y-3 sm:space-y-4 mt-6 focus:outline-none overflow-x-hidden max-w-full\">\n            <div className=\"flex items-center justify-between mb-6\">\n              <h3 className=\"text-lg sm:text-xl font-bold text-foreground\">Sipariler ({orders.length})</h3>\n            </div>\n            {loading ? (\n              <div className=\"flex flex-col items-center justify-center py-16\">\n                <Loader2 className=\"h-8 w-8 animate-spin text-primary mb-4\" />\n                <p className=\"text-[11px] sm:text-xs text-muted-foreground\">Ykleniyor...</p>\n              </div>\n            ) : orders.length === 0 ? (\n              <Card className=\"border-2 border-dashed\">\n                <CardContent className=\"p-12 text-center\">\n                  <Package className=\"h-12 w-12 text-muted-foreground/50 mx-auto mb-4\" />\n                  <p className=\"text-[11px] sm:text-xs font-medium text-muted-foreground\">Henz sipari bulunmuyor</p>\n                </CardContent>\n              </Card>\n            ) : (\n              <div className=\"space-y-3\">\n                {orders.map((order) => {\n                  const getStatusBadge = (status: string) => {\n                    const statusMap: Record<string, { label: string; variant: \"default\" | \"secondary\" | \"destructive\" | \"outline\" }> = {\n                      draft: { label: \"Taslak\", variant: \"outline\" },\n                      pending: { label: \"Beklemede\", variant: \"outline\" },\n                      planned: { label: \"Planland\", variant: \"outline\" },\n                      confirmed: { label: \"Onayland\", variant: \"default\" },\n                      in_progress: { label: \"retimde\", variant: \"default\" },\n                      in_production: { label: \"retimde\", variant: \"default\" },\n                      quality_check: { label: \"Kalite Kontrol\", variant: \"secondary\" },\n                      completed: { label: \"Tamamland\", variant: \"default\" },\n                      shipped: { label: \"Kargoda\", variant: \"secondary\" },\n                      delivered: { label: \"Teslim Edildi\", variant: \"default\" },\n                      on_hold: { label: \"Beklemede\", variant: \"outline\" },\n                      cancelled: { label: \"ptal\", variant: \"destructive\" },\n                    };\n                    return statusMap[status] || { label: status, variant: \"outline\" };\n                  };\n                  const statusBadge = getStatusBadge(order.status);\n                  return (\n                    <Card key={order.id} className=\"border-2 hover:border-primary/50 hover:shadow-md transition-all duration-200\">\n                      <CardContent className=\"p-5\">\n                        <div className=\"flex items-center justify-between gap-4\">\n                          <div className=\"flex-1 min-w-0\">\n                            <p className=\"font-bold text-[11px] sm:text-xs mb-2 text-foreground\">{order.orderNumber}</p>\n                            <p className=\"text-[11px] sm:text-xs text-muted-foreground\">\n                              {formatDateSafe(order.createdAt)}\n                        </p>\n                      </div>\n                          <div className=\"flex items-center gap-3 flex-shrink-0\">\n                            <Badge variant={statusBadge.variant} className=\"text-[10px] font-semibold px-3 py-1 whitespace-nowrap\">\n                              {statusBadge.label}\n                        </Badge>\n                            <span className=\"font-bold text-[11px] sm:text-xs whitespace-nowrap text-foreground\">\n                          {(order.totalAmount || 0).toLocaleString(\"tr-TR\")}\n                        </span>\n                      </div>\n                    </div>\n                      </CardContent>\n                    </Card>\n                  );\n                })}\n              </div>\n            )}\n          </TabsContent>\n\n          <TabsContent value=\"notes\" className=\"space-y-3 sm:space-y-4 mt-6 focus:outline-none overflow-x-hidden max-w-full\">\n            <div className=\"flex items-center justify-between mb-6\">\n              <h3 className=\"text-lg sm:text-xl font-bold text-foreground\">Notlar ({notes.length})</h3>\n            </div>\n            \n            {/* Direkt Not Ekleme Alan */}\n            <Card className=\"border-2 border-primary/20 bg-primary/5\">\n              <CardContent className=\"p-4 space-y-3\">\n                <Label className=\"text-[11px] sm:text-xs font-semibold\">Yeni Not Ekle</Label>\n                <Textarea\n                  value={newNoteContent}\n                  onChange={(e) => setNewNoteContent(e.target.value)}\n                  placeholder=\"Notunuzu buraya yazn...\"\n                  rows={4}\n                  className=\"text-[11px] sm:text-xs resize-none\"\n                  onKeyDown={(e) => {\n                    if (e.key === \"Enter\" && (e.ctrlKey || e.metaKey)) {\n                      e.preventDefault();\n                      handleAddNote();\n                    }\n                  }}\n                />\n                <div className=\"flex justify-end gap-2\">\n                  <Button\n                    variant=\"outline\"\n                    size=\"sm\"\n                    onClick={() => setNewNoteContent(\"\")}\n                    disabled={isAddingNote || !newNoteContent.trim()}\n                    className=\"text-[11px] sm:text-xs\"\n                  >\n                    Temizle\n                  </Button>\n                  <Button\n                    size=\"sm\"\n                    onClick={handleAddNote}\n                    disabled={isAddingNote || !newNoteContent.trim()}\n                    className=\"text-[11px] sm:text-xs\"\n                  >\n                    {isAddingNote ? (\n                      <>\n                        <Loader2 className=\"h-3 w-3 mr-2 animate-spin\" />\n                        Ekleniyor...\n                      </>\n                    ) : (\n                      <>\n                        <Plus className=\"h-3 w-3 mr-2\" />\n                        Ekle\n                      </>\n                    )}\n                  </Button>\n                </div>\n              </CardContent>\n            </Card>\n            {loading ? (\n              <div className=\"flex flex-col items-center justify-center py-16\">\n                <Loader2 className=\"h-8 w-8 animate-spin text-primary mb-4\" />\n                <p className=\"text-[11px] sm:text-xs text-muted-foreground\">Ykleniyor...</p>\n              </div>\n            ) : notes.length === 0 ? (\n              <Card className=\"border-2 border-dashed\">\n                <CardContent className=\"p-12 text-center\">\n                  <MessageSquare className=\"h-12 w-12 text-muted-foreground/50 mx-auto mb-4\" />\n                  <p className=\"text-[11px] sm:text-xs font-medium text-muted-foreground\">Henz not bulunmuyor</p>\n                </CardContent>\n              </Card>\n            ) : (\n              <div className=\"space-y-3\">\n                {notes.map((note) => {\n                  const Icon = getNoteTypeIcon(note.type);\n                  return (\n                    <Card key={note.id} className=\"border-2 hover:border-primary/50 hover:shadow-md transition-all duration-200\">\n                      <CardContent className=\"p-5\">\n                        <div className=\"flex items-start justify-between mb-3 gap-4\">\n                          <div className=\"flex items-center gap-3 flex-1 min-w-0\">\n                            <div className=\"h-9 w-9 rounded-lg bg-primary/10 flex items-center justify-center flex-shrink-0\">\n                              <Icon className=\"h-4 w-4 text-primary\" />\n                            </div>\n                            <Badge variant=\"outline\" className=\"text-[10px] font-semibold flex-shrink-0\">{getNoteTypeLabel(note.type)}</Badge>\n                            <p className=\"font-bold text-[11px] sm:text-xs text-foreground truncate\">{note.title}</p>\n                          </div>\n                          <p className=\"text-[11px] sm:text-xs text-muted-foreground flex-shrink-0 whitespace-nowrap\">\n                            {formatDateSafe(note.createdAt)}\n                          </p>\n                        </div>\n                        <p className=\"text-[11px] sm:text-xs text-foreground whitespace-pre-wrap break-words leading-relaxed pl-12\">\n                          {note.content}\n                        </p>\n                      </CardContent>\n                    </Card>\n                  );\n                })}\n              </div>\n            )}\n          </TabsContent>\n        </Tabs>\n                </div>\n              )}\n            </div>\n          </div>\n        </div>\n      </DialogContent>\n\n      {/* Silme Onay Dialog */}\n      <AlertDialog open={deleteDialogOpen} onOpenChange={setDeleteDialogOpen}>\n        <AlertDialogContent>\n          <AlertDialogHeader>\n            <AlertDialogTitle className=\"text-[16px] sm:text-[18px]\">Mteriyi sil?</AlertDialogTitle>\n            <AlertDialogDescription className=\"text-[11px] sm:text-xs\">\n              Bu ilem geri alnamaz. Mteri kalc olarak silinecek.\n            </AlertDialogDescription>\n          </AlertDialogHeader>\n          <AlertDialogFooter>\n            <AlertDialogCancel className=\"text-[11px] sm:text-xs\">ptal</AlertDialogCancel>\n            <AlertDialogAction onClick={handleDelete} className=\"text-[11px] sm:text-xs bg-destructive text-destructive-foreground hover:bg-destructive/90\">\n              Sil\n            </AlertDialogAction>\n          </AlertDialogFooter>\n        </AlertDialogContent>\n      </AlertDialog>\n\n    </Dialog>\n  );\n};\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\components\\Dashboard\\QuickActions.tsx","messages":[{"ruleId":null,"nodeType":null,"fatal":true,"severity":2,"message":"Parsing error: ':' expected.","line":78,"column":6}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":1,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Plus, Users, Package, ShoppingCart, ArrowRight } from \"lucide-react\";\nimport { useNavigate } from \"react-router-dom\";\nimport { cn } from \"@/lib/utils\";\nimport { useAuth } from \"@/contexts/AuthContext\";\nimport { useState, useEffect } from \"react\";\nimport { canCreateTask } from \"@/utils/permissions\";\nimport { UserProfile } from \"@/services/firebase/authService\";\n\ninterface QuickActionsProps {\n  onCreateTask?: () => void;\n  onCreateProductionOrder?: () => void;\n  onCreateCustomer?: () => void;\n  onCreateSalesOrder?: () => void;\n}\n\nexport const QuickActions = ({\n  onCreateTask,\n  onCreateProductionOrder,\n  onCreateCustomer,\n  onCreateSalesOrder,\n}: QuickActionsProps) => {\n  const navigate = useNavigate();\n  const { user } = useAuth();\n  const [canCreate, setCanCreate] = useState(false);\n  \n  // Grev oluturma yetkisi - Firestore'dan kontrol et\n  useEffect(() => {\n    const checkPermission = async () => {\n      if (!user) {\n        setCanCreate(false);\n        return;\n      }\n      try {\n        const userProfile: UserProfile = {\n          id: user.id,\n          email: user.email,\n          emailVerified: user.emailVerified,\n          fullName: user.fullName,\n          displayName: user.fullName,\n          phone: null,\n          dateOfBirth: null,\n          role: user.roles || [],\n          createdAt: null,\n          updatedAt: null,\n        };\n        const result = await canCreateTask(userProfile, []);\n        setCanCreate(result);\n      } catch (error: unknown) {\n        if (import.meta.env.DEV) {\n          console.error(\"Error checking create task permission:\", error);\n        }\n        setCanCreate(false);\n      }\n    };\n    checkPermission();\n  }, [user]);\n\n  const handleAction = (callback: (() => void) | undefined, fallbackPath: string) => {\n    if (callback) {\n      callback();\n    } else {\n      navigate(fallbackPath);\n    }\n  };\n\n  const actions = [\n    // Firestore'dan kontrol: canCreate yetkisi varsa \"Yeni Grev\" butonu gsterilir\n    ...(canCreate ? [{\n      title: \"Yeni Grev\",\n      description: \" planna ekle\",\n      icon: Plus,\n      onClick: () => handleAction(onCreateTask, \"/tasks\"),\n      color: \"text-blue-600\",\n      bgColor: \"bg-blue-50\",\n      hoverBg: \"hover:bg-blue-100\",\n      borderColor: \"border-blue-100\",\n    }]),\n    {\n      title: \"retim Siparii\",\n      description: \"retim balat\",\n      icon: Package,\n      onClick: () => handleAction(onCreateProductionOrder, \"/production\"),\n      color: \"text-orange-600\",\n      bgColor: \"bg-orange-50\",\n      hoverBg: \"hover:bg-orange-100\",\n      borderColor: \"border-orange-100\",\n    },\n    {\n      title: \"Yeni Mteri\",\n      description: \"Mteri kayd\",\n      icon: Users,\n      onClick: () => handleAction(onCreateCustomer, \"/customers\"),\n      color: \"text-violet-600\",\n      bgColor: \"bg-violet-50\",\n      hoverBg: \"hover:bg-violet-100\",\n      borderColor: \"border-violet-100\",\n    },\n    {\n      title: \"Sat Siparii\",\n      description: \"Sipari olutur\",\n      icon: ShoppingCart,\n      onClick: () => handleAction(onCreateSalesOrder, \"/orders\"),\n      color: \"text-emerald-600\",\n      bgColor: \"bg-emerald-50\",\n      hoverBg: \"hover:bg-emerald-100\",\n      borderColor: \"border-emerald-100\",\n    },\n  ];\n\n  return (\n    <Card className=\"border-none shadow-none bg-transparent\">\n      <CardHeader className=\"px-0 pt-0 pb-4\">\n        <CardTitle className=\"text-lg font-semibold text-gray-800\">Hzl lemler</CardTitle>\n      </CardHeader>\n      <CardContent className=\"p-0\">\n        <div className=\"grid grid-cols-2 sm:grid-cols-2 md:grid-cols-4 gap-2 sm:gap-3 md:gap-4\">\n          {actions.map((action, index) => (\n            <button\n              key={index}\n              onClick={action.onClick}\n              className={cn(\n                \"flex flex-col items-start p-3 sm:p-4 rounded-xl border transition-all duration-200 group text-left h-full min-h-[120px] sm:min-h-[140px]\",\n                \"hover:shadow-md hover:-translate-y-0.5\",\n                \"bg-white\", // Kart arka plan beyaz olsun, renkler ikonlarda ve hover'da olsun\n                \"border-gray-200 hover:border-gray-300\"\n              )}\n            >\n              <div className={cn(\n                \"p-2 sm:p-2.5 rounded-lg mb-2 sm:mb-3 transition-colors\",\n                action.bgColor,\n                action.color\n              )}>\n                <action.icon className=\"h-5 w-5 sm:h-6 sm:w-6\" />\n              </div>\n              \n              <div className=\"space-y-0.5 sm:space-y-1 w-full\">\n                <h3 className=\"font-semibold text-gray-900 group-hover:text-primary transition-colors text-xs sm:text-sm md:text-base\">\n                  {action.title}\n                </h3>\n                <p className=\"text-[10px] sm:text-xs text-gray-500 font-medium\">\n                  {action.description}\n                </p>\n              </div>\n\n              <div className=\"mt-auto w-full flex justify-end opacity-0 group-hover:opacity-100 transition-opacity pt-2\">\n                <ArrowRight className=\"h-3.5 w-3.5 sm:h-4 sm:w-4 text-gray-400\" />\n              </div>\n            </button>\n          ))}\n        </div>\n      </CardContent>\n    </Card>\n  );\n};\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\components\\Dashboard\\StatCard.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\components\\ErrorBoundary.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\components\\ErrorPage.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\components\\Layout\\GlobalSearch.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\components\\Layout\\Header.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\components\\Layout\\MainLayout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\components\\Layout\\NotificationCenter.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\components\\Layout\\PageContainer.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\components\\Layout\\Sidebar.tsx","messages":[],"suppressedMessages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'checkPermissions', 'user?.email', 'user?.emailVerified', 'user?.fullName', and 'user?.roles'. Either include them or remove the dependency array.","line":189,"column":6,"nodeType":"ArrayExpression","endLine":189,"endColumn":16,"suggestions":[{"desc":"Update the dependencies array to be: [checkPermissions, user?.email, user?.emailVerified, user?.fullName, user?.id, user?.roles]","fix":{"range":[7372,7382],"text":"[checkPermissions, user?.email, user?.emailVerified, user?.fullName, user?.id, user?.roles]"}}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\components\\NavLink.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\components\\Orders\\CreateOrderDialog.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\components\\Orders\\OrderDetailModal.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'isAdmin' and 'isTeamLeader'. Either include them or remove the dependency array.","line":227,"column":6,"nodeType":"ArrayExpression","endLine":227,"endColumn":19,"suggestions":[{"desc":"Update the dependencies array to be: [user, order, isAdmin, isTeamLeader]","fix":{"range":[9342,9355],"text":"[user, order, isAdmin, isTeamLeader]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchOrderDetails'. Either include it or remove the dependency array.","line":291,"column":6,"nodeType":"ArrayExpression","endLine":291,"endColumn":19,"suggestions":[{"desc":"Update the dependencies array to be: [order, open, fetchOrderDetails]","fix":{"range":[12077,12090],"text":"[order, open, fetchOrderDetails]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect, useMemo, useCallback } from \"react\";\nimport { Timestamp } from \"firebase/firestore\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogDescription } from \"@/components/ui/dialog\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { toast } from \"sonner\";\nimport { getOrderItems, requestOrderCompletion, approveOrderCompletion, rejectOrderCompletion } from \"@/services/firebase/orderService\";\nimport { getCustomerById, Customer } from \"@/services/firebase/customerService\";\nimport type { LucideIcon } from \"lucide-react\";\nimport {\n  Edit,\n  Trash2,\n  Calendar,\n  User,\n  Building2,\n  Phone,\n  Mail,\n  CheckCircle2,\n  Clock,\n  Package,\n  Truck,\n  Check,\n  ClipboardList,\n  PackageCheck,\n  ShoppingCart,\n  BarChart2,\n  CreditCard,\n  NotebookPen,\n  CircleDot,\n  X,\n} from \"lucide-react\";\nimport { Separator } from \"@/components/ui/separator\";\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from \"@/components/ui/table\";\nimport { Tooltip, TooltipContent, TooltipTrigger } from \"@/components/ui/tooltip\";\nimport { updateOrder, addOrderComment, getOrderComments, getOrderActivities, Order, OrderItem } from \"@/services/firebase/orderService\";\nimport { useAuth } from \"@/contexts/AuthContext\";\nimport { canUpdateResource, canDeleteResource } from \"@/utils/permissions\";\nimport { UserProfile } from \"@/services/firebase/authService\";\nimport { formatPhoneForDisplay, formatPhoneForTelLink } from \"@/utils/phoneNormalizer\";\nimport { getAllUsers } from \"@/services/firebase/authService\";\nimport { CURRENCY_SYMBOLS, Currency } from \"@/utils/currency\";\nimport { ActivityCommentsPanel } from \"@/components/shared/ActivityCommentsPanel\";\n\ntype StatusItem = {\n  value: string;\n  label: string;\n  icon: LucideIcon;\n  color: string;\n};\n\nconst statusWorkflow: StatusItem[] = [\n  { value: \"draft\", label: \"Taslak\", icon: ClipboardList, color: \"text-muted-foreground\" },\n  { value: \"pending\", label: \"Beklemede\", icon: Clock, color: \"text-amber-500\" },\n  { value: \"planned\", label: \"Planland\", icon: Calendar, color: \"text-blue-500\" },\n  { value: \"confirmed\", label: \"Onayland\", icon: CheckCircle2, color: \"text-emerald-500\" },\n  { value: \"in_production\", label: \"retimde\", icon: Package, color: \"text-blue-600\" },\n  { value: \"quality_check\", label: \"Kalite Kontrol\", icon: CircleDot, color: \"text-purple-500\" },\n  { value: \"completed\", label: \"Tamamland\", icon: Check, color: \"text-emerald-600\" },\n  { value: \"shipped\", label: \"Kargoda\", icon: Truck, color: \"text-sky-500\" },\n  { value: \"delivered\", label: \"Teslim Edildi\", icon: PackageCheck, color: \"text-primary\" },\n];\n\nconst normalizeStatusValue = (status?: string) => {\n  if (!status) return \"draft\";\n  // column_ prefix'ini kaldr (rn: \"column_1764448226762\" -> \"1764448226762\")\n  let normalized = status;\n  if (normalized.startsWith(\"column_\")) {\n    normalized = normalized.replace(\"column_\", \"\");\n  }\n  // Eer saysal bir ID ise, default olarak \"pending\" dndr\n  if (/^\\d+$/.test(normalized)) {\n    return \"pending\";\n  }\n  // in_progress -> in_production dnm\n  if (normalized === \"in_progress\") return \"in_production\";\n  return normalized;\n};\n\nconst resolveDateValue = (value?: unknown): Date | string | null => {\n  if (!value) return null;\n  if (typeof value === \"string\") return value;\n  if (value instanceof Date) return value;\n  if (value instanceof Timestamp) {\n    return value.toDate();\n  }\n  if (typeof value === \"object\" && value !== null && \"seconds\" in value) {\n    const timestamp = value as { seconds: number; nanoseconds?: number };\n    return new Date(timestamp.seconds * 1000);\n  }\n  return null;\n};\n\nconst formatCurrency = (value?: number | null, currency?: Currency | string) => {\n  const numericValue = typeof value === \"number\" ? value : Number(value) || 0;\n  const orderCurrency = (currency || \"TRY\") as Currency;\n  const currencyCode = orderCurrency === \"TRY\" ? \"TRY\" : orderCurrency;\n  const locale = orderCurrency === \"TRY\" ? \"tr-TR\" : \"en-US\";\n  const symbol = CURRENCY_SYMBOLS[orderCurrency] || \"\";\n  \n  try {\n    return new Intl.NumberFormat(locale, {\n      style: \"currency\",\n      currency: currencyCode,\n      minimumFractionDigits: 2,\n    }).format(numericValue);\n  } catch {\n    return `${symbol}${numericValue.toFixed(2)}`;\n  }\n};\n\ninterface OrderDetailModalProps {\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n  order: Order;\n  onEdit?: () => void;\n  onDelete?: () => void;\n}\n\nexport const OrderDetailModal = ({ open, onOpenChange, order, onEdit, onDelete }: OrderDetailModalProps) => {\n  const { user, isAdmin, isTeamLeader } = useAuth();\n  const [orderItems, setOrderItems] = useState<OrderItem[]>([]);\n  const [customer, setCustomer] = useState<Customer | null>(null);\n  const [loading, setLoading] = useState(true);\n  const [updatingStatus, setUpdatingStatus] = useState(false);\n  const [currentStatus, setCurrentStatus] = useState<string>(normalizeStatusValue(order?.status));\n  const [approvalStatus, setApprovalStatus] = useState<string | undefined>(order?.approvalStatus);\n  const [usersMap, setUsersMap] = useState<Record<string, string>>({});\n  \n  // Personel kontrol - Personel sipari detayn grebilir ama dzenleyemez\n  const isPersonnel = user?.roles?.includes(\"personnel\") || false;\n\n  const formatDateSafe = (dateInput?: string | Date | Timestamp | null) => {\n    if (!dateInput) return \"-\";\n    let date: Date;\n    if (dateInput instanceof Timestamp) {\n      date = dateInput.toDate();\n    } else if (dateInput instanceof Date) {\n      date = dateInput;\n    } else {\n      date = new Date(dateInput);\n    }\n    if (Number.isNaN(date.getTime())) return \"-\";\n    return date.toLocaleDateString(\"tr-TR\", { day: \"2-digit\", month: \"short\", year: \"numeric\" });\n  };\n\n  const orderNumber = order?.order_number || order?.orderNumber || order?.id;\n  const orderDateValue = resolveDateValue(order?.order_date || order?.orderDate);\n  const deliveryDateValue = resolveDateValue(order?.delivery_date || order?.deliveryDate);\n  const receivedDateValue = resolveDateValue(order?.received_date || order?.receivedDate);\n  const dueDateValue = resolveDateValue(order?.due_date || order?.dueDate);\n  const createdAtValue = resolveDateValue(order?.created_at || order?.createdAt);\n  const updatedAtValue = resolveDateValue(order?.updated_at || order?.updatedAt);\n  const paymentTerms = order?.payment_terms || order?.paymentTerms || \"-\";\n  const shippingAddress = order?.delivery_address || order?.shippingAddress || order?.shipping_address;\n  const shippingNotes = order?.delivery_notes || order?.shippingNotes || order?.shipping_notes;\n  const currency = order?.currency || \"TRY\";\n  const totalQuantity = orderItems.reduce((sum, item) => sum + (Number(item.quantity) || 0), 0);\n  const totalDiscount = orderItems.reduce((sum, item) => sum + (Number(item.discount) || 0), 0);\n  const subtotalValue = Number(order?.subtotal ?? order?.totalAmount ?? 0);\n  const taxValue = Number(order?.taxAmount ?? 0);\n  const totalValue = Number(order?.totalAmount ?? subtotalValue + taxValue - totalDiscount);\n  \n  const [canUpdate, setCanUpdate] = useState(false);\n  const [canDeleteState, setCanDeleteState] = useState(false);\n  const [canApprove, setCanApprove] = useState(false);\n\n  // Order deitiinde currentStatus'u gncelle (column_ prefix'ini kaldr)\n  useEffect(() => {\n    if (order?.status) {\n      const normalized = normalizeStatusValue(order.status);\n      setCurrentStatus(normalized);\n    }\n    if (order?.approvalStatus !== undefined) {\n      setApprovalStatus(order.approvalStatus);\n    }\n  }, [order?.status, order?.approvalStatus]);\n\n  // Yetki kontrolleri - Firestore'dan kontrol et\n  useEffect(() => {\n    const checkPermissions = async () => {\n      if (!user || !order) {\n        setCanUpdate(false);\n        setCanDeleteState(false);\n        setCanApprove(false);\n        return;\n      }\n      try {\n        const userProfile: UserProfile = {\n          id: user.id,\n          email: user.email,\n          emailVerified: user.emailVerified,\n          displayName: user.fullName || user.email || \"\",\n          fullName: user.fullName,\n          phone: null,\n          dateOfBirth: null,\n          role: user.roles || [],\n          createdAt: null,\n          updatedAt: null,\n        };\n        const [canUpdateOrder, canDeleteOrder] = await Promise.all([\n          canUpdateResource(userProfile, \"orders\"),\n          canDeleteResource(userProfile, \"orders\"),\n        ]);\n        setCanUpdate(canUpdateOrder);\n        setCanDeleteState(canDeleteOrder);\n        \n        // Admin ve ekip lideri her zaman dzenleyebilir\n        if (isAdmin || isTeamLeader) {\n          setCanUpdate(true);\n          setCanDeleteState(true);\n        }\n        \n        // Onaylama yetkisi: Gncelleme yetkisi varsa veya oluturan kii ise\n        const isCreator = user.id === order.createdBy;\n        setCanApprove(canUpdateOrder || isCreator || isTeamLeader);\n      } catch (error: unknown) {\n        if (import.meta.env.DEV) {\n          console.error(\"Error checking order permissions:\", error);\n        }\n        setCanUpdate(false);\n        setCanDeleteState(false);\n        setCanApprove(false);\n      }\n    };\n    checkPermissions();\n  }, [user, order]);\n\n  const isManager = user?.roles?.includes('manager') || isAdmin;\n  const isCreator = user?.id === order?.createdBy;\n\n  const highlightCards = [\n    {\n      label: \"Kalem Says\",\n      value: orderItems.length || 0,\n      icon: ShoppingCart,\n      helper: \"Siparie bal rn\",\n      accent: \"from-blue-50/80 via-white to-white border-blue-100\",\n      tooltip: \"Bu siparie eklenmi toplam satr says\",\n    },\n    {\n      label: \"Toplam Miktar\",\n      value: totalQuantity,\n      icon: BarChart2,\n      helper: \"Sipariteki toplam adet\",\n      accent: \"from-indigo-50/80 via-white to-white border-indigo-100\",\n      tooltip: \"rn miktarlarnn toplam\",\n    },\n    {\n      label: \"Ara Toplam\",\n      value: formatCurrency(order?.subtotal ?? order?.totalAmount ?? 0, currency),\n      icon: CreditCard,\n      helper: \"Vergi & indirim ncesi\",\n      accent: \"from-slate-50/80 via-white to-white border-slate-100\",\n      tooltip: \"KDV ve indirim uygulanmadan nceki tutar\",\n    },\n    {\n      label: \"ndirim\",\n      value: totalDiscount ? `-${formatCurrency(totalDiscount, currency)}` : \"-\",\n      icon: NotebookPen,\n      helper: \"rn bazl indirim\",\n      accent: \"from-emerald-50/80 via-white to-white border-emerald-100\",\n      tooltip: \"Kalemlere uygulanan toplam indirim\",\n    },\n  ];\n  const orderSummaryRows = [\n    { label: \"Sipari No\", value: orderNumber },\n    { label: \"Sipari Edilen Tarih\", value: formatDateSafe(orderDateValue as Date | string | Timestamp | null) },\n    { label: \"Teslimat Tarihi\", value: formatDateSafe(deliveryDateValue as Date | string | Timestamp | null) },\n    { label: \"Teslim Alnan Tarih\", value: formatDateSafe(receivedDateValue as Date | string | Timestamp | null) },\n    { label: \"Son deme\", value: formatDateSafe(dueDateValue as Date | string | Timestamp | null) },\n    { label: \"Para Birimi\", value: currency },\n    { label: \"deme art\", value: paymentTerms },\n    { label: \"Oluturan\", value: order?.createdBy \n      ? (usersMap[order.createdBy] || \"-\")\n      : \"-\" },\n    { label: \"Son Gncelleme\", value: formatDateSafe(updatedAtValue as Date | string | Timestamp | null) },\n  ];\n  const quickMetaChips = [\n    orderNumber && { label: \"Sipari No\", value: orderNumber },\n    createdAtValue && { label: \"Oluturulma\", value: formatDateSafe(createdAtValue as Date | string | Timestamp | null) },\n    dueDateValue && { label: \"Son deme\", value: formatDateSafe(dueDateValue as Date | string | Timestamp | null) },\n    currency && { label: \"Para Birimi\", value: currency },\n  ].filter(Boolean) as { label: string; value: string }[];\n\n  useEffect(() => {\n    if (order?.id && open) {\n      fetchOrderDetails();\n      setApprovalStatus(order.approvalStatus);\n    }\n  }, [order, open]);\n\n  useEffect(() => {\n    const loadUsers = async () => {\n      try {\n        const allUsers = await getAllUsers();\n        const userMap: Record<string, string> = {};\n        allUsers.forEach((u) => {\n          userMap[u.id] = u.fullName || u.email || \"Bilinmeyen\";\n        });\n        setUsersMap(userMap);\n      } catch (error) {\n        console.error(\"Error loading users:\", error);\n      }\n    };\n    if (open) {\n      loadUsers();\n    }\n  }, [open]);\n\n  useEffect(() => {\n    setCurrentStatus(normalizeStatusValue(order?.status));\n  }, [order?.status]);\n\n  const fetchOrderDetails = async () => {\n    setLoading(true);\n    try {\n      // Fetch order items\n      const items = await getOrderItems(order.id);\n      setOrderItems(items);\n\n      // Fetch customer details\n      if (order.customer_id || order.customerId) {\n        const customerId = order.customer_id || order.customerId;\n        const customerData = await getCustomerById(customerId);\n        setCustomer(customerData);\n      }\n    } catch (error: unknown) {\n      if (import.meta.env.DEV) console.error(\"Fetch order details error:\", error);\n      const errorMessage = error instanceof Error ? error.message : \"Bilinmeyen hata\";\n      toast.error(\"Detaylar yklenirken hata: \" + errorMessage);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const getStatusVariant = (status: string): \"default\" | \"secondary\" | \"destructive\" | \"outline\" => {\n    switch (status) {\n      case \"draft\":\n        return \"outline\";\n      case \"pending\":\n        return \"secondary\";\n      case \"confirmed\":\n        return \"default\";\n      case \"in_production\":\n      case \"in_progress\":\n        return \"secondary\";\n      case \"completed\":\n        return \"default\";\n      case \"shipped\":\n        return \"secondary\";\n      case \"delivered\":\n        return \"default\";\n      case \"cancelled\":\n        return \"destructive\";\n      default:\n        return \"outline\";\n    }\n  };\n\n  const getStatusLabel = (status: string) => {\n    // nce status' normalize et\n    const normalized = normalizeStatusValue(status);\n    const labels: Record<string, string> = {\n      draft: \"Taslak\",\n      pending: \"Beklemede\",\n      confirmed: \"Onayland\",\n      planned: \"Planland\",\n      in_production: \"retimde\",\n      in_progress: \"retimde\",\n      quality_check: \"Kalite Kontrol\",\n      completed: \"Tamamland\",\n      shipped: \"Kargoda\",\n      delivered: \"Teslim Edildi\",\n      cancelled: \"ptal Edildi\",\n      on_hold: \"Beklemede\",\n    };\n    return labels[normalized] || normalized;\n  };\n\n  const getCurrentStatusIndex = useCallback(() => {\n    // currentStatus zaten normalize edilmi olmal ama yine de normalize et\n    const normalized = normalizeStatusValue(currentStatus);\n    const index = statusWorkflow.findIndex((statusItem) => statusItem.value === normalized);\n    // Eer bulunamazsa, \"pending\" olarak kabul et (index 1)\n    if (index === -1) {\n      // \"pending\" index'i 1 (draft'tan sonra)\n      return 1;\n    }\n    return index;\n  }, [currentStatus]);\n\n  const nextStatus = useMemo(() => {\n    const currentIndex = getCurrentStatusIndex();\n    // currentIndex artk -1 dnmeyecek (minimum 1 dner), ama yine de kontrol et\n    if (currentIndex < 0 || currentIndex >= statusWorkflow.length - 1) {\n      return null;\n    }\n    return statusWorkflow[currentIndex + 1];\n  }, [getCurrentStatusIndex]);\n\n  const handleStatusChange = async (nextStatus: string) => {\n    if (!order?.id || !user?.id) {\n      return;\n    }\n\n    setUpdatingStatus(true);\n    try {\n      // Yetki kontrol\n      if (!canUpdate && !isCreator) {\n        toast.error(\"Sipari durumunu deitirme yetkiniz yok.\");\n        setUpdatingStatus(false);\n        return;\n      }\n\n      // Eer tamamland durumuna geiliyorsa ve yetkili deilse onaya gnder\n      if (nextStatus === \"completed\") {\n        const canCompleteDirectly = canUpdate || isCreator;\n        \n        if (!canCompleteDirectly) {\n          await requestOrderCompletion(order.id, user.id);\n          setApprovalStatus(\"pending\");\n          toast.success(\"Sipari tamamland olarak iaretlendi ve onay iin yneticiye gnderildi.\");\n          setUpdatingStatus(false);\n          return;\n        }\n        \n        // Yetkili ise direkt onayla (completed + approved)\n        await approveOrderCompletion(order.id, user.id);\n        setCurrentStatus(\"completed\");\n        setApprovalStatus(\"approved\");\n        toast.success(`Sipari durumu ${getStatusLabel(\"completed\")} olarak gncellendi.`);\n        setUpdatingStatus(false);\n        return;\n      }\n\n      await updateOrder(\n        order.id,\n        {\n        status: nextStatus as Order[\"status\"],\n        },\n        user.id,\n        canUpdate // Yetkili kullanclar iin durum gei validasyonunu atla\n      );\n      setCurrentStatus(nextStatus);\n      toast.success(`Sipari durumu ${getStatusLabel(nextStatus)} olarak gncellendi.`);\n    } catch (error: unknown) {\n      if (import.meta.env.DEV) console.error(\"Order status update error:\", error);\n      const errorMessage = error instanceof Error ? error.message : \"Bilinmeyen hata\";\n      toast.error(\"Durum gncellenemedi: \" + errorMessage);\n    } finally {\n      setUpdatingStatus(false);\n    }\n  };\n\n  const handleApprove = async () => {\n    if (!order?.id || !user?.id) return;\n    try {\n      await approveOrderCompletion(order.id, user.id);\n      setCurrentStatus(\"completed\");\n      setApprovalStatus(\"approved\");\n      toast.success(\"Sipari onay kabul edildi.\");\n    } catch (error: unknown) {\n      const errorMessage = error instanceof Error ? error.message : \"Bilinmeyen hata\";\n      toast.error(\"Onaylama baarsz: \" + errorMessage);\n    }\n  };\n\n  const handleReject = async () => {\n    if (!order?.id || !user?.id) return;\n    try {\n      await rejectOrderCompletion(order.id, user.id);\n      setCurrentStatus(\"in_production\"); // Geri dndr\n      setApprovalStatus(\"rejected\");\n      toast.success(\"Sipari onay reddedildi.\");\n    } catch (error: unknown) {\n      const errorMessage = error instanceof Error ? error.message : \"Bilinmeyen hata\";\n      toast.error(\"Reddetme baarsz: \" + errorMessage);\n    }\n  };\n\n  const handleRevertStatus = async (targetStatus: string) => {\n    if (!order?.id || !user?.id) {\n      return;\n    }\n    \n    // Yetki kontrol\n    if (!canUpdate && !isCreator) {\n      toast.error(\"Sipari durumunu deitirme yetkiniz yok.\");\n      return;\n    }\n\n    setUpdatingStatus(true);\n    try {\n      await updateOrder(\n        order.id,\n        {\n          status: targetStatus as Order[\"status\"],\n        },\n        user.id,\n        canUpdate\n      );\n      setCurrentStatus(targetStatus);\n      toast.success(`Sipari durumu ${getStatusLabel(targetStatus)} olarak gncellendi.`);\n    } catch (error: unknown) {\n      if (import.meta.env.DEV) console.error(\"Order status revert error:\", error);\n      const errorMessage = error instanceof Error ? error.message : \"Bilinmeyen hata\";\n      toast.error(\"Durum gncellenemedi: \" + errorMessage);\n    } finally {\n      setUpdatingStatus(false);\n    }\n  };\n\n  return (\n    <Dialog open={open} onOpenChange={onOpenChange}>\n      <DialogContent className=\"!max-w-[100vw] sm:!max-w-[95vw] md:!max-w-[85vw] !w-[100vw] sm:!w-[95vw] md:!w-[85vw] !h-[100vh] sm:!h-[90vh] md:!h-[85vh] !max-h-[100vh] sm:!max-h-[90vh] md:!max-h-[85vh] !left-0 sm:!left-[2.5vw] md:!left-[7.5vw] !top-0 sm:!top-[5vh] md:!top-[7.5vh] !right-0 sm:!right-auto !bottom-0 sm:!bottom-auto !translate-x-0 !translate-y-0 overflow-hidden !p-0 gap-0 bg-white flex flex-col !m-0 !rounded-none sm:!rounded-lg !border-0 sm:!border\">\n        {/* DialogTitle ve DialogDescription DialogContent'in direkt child' olmal (Radix UI gereksinimi) */}\n        <DialogTitle className=\"sr-only\">\n          Sipari Detay - {orderNumber}\n        </DialogTitle>\n        <DialogDescription className=\"sr-only\">\n          Sipari detaylar ve bilgileri\n        </DialogDescription>\n        \n        <div className=\"flex flex-col h-full min-h-0\">\n          <DialogHeader className=\"p-2 sm:p-3 md:p-4 border-b bg-white flex-shrink-0 relative pr-10 sm:pr-12\">\n            <div className=\"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-2 sm:gap-3\">\n              <div className=\"flex items-center gap-2 sm:gap-3 flex-1 min-w-0 w-full sm:w-auto\">\n                <div className=\"h-8 w-8 sm:h-10 sm:w-10 rounded-lg bg-primary/10 flex items-center justify-center border border-primary/20 flex-shrink-0\">\n                  <ShoppingCart className=\"h-4 w-4 sm:h-5 sm:w-5 text-primary\" />\n                </div>\n                <h2 className=\"text-[14px] sm:text-[18px] md:text-xl lg:text-2xl font-semibold text-foreground truncate flex-1 min-w-0\">\n                  Sipari Detay - {orderNumber}\n                </h2>\n              </div>\n              <div className=\"flex flex-wrap gap-2 flex-shrink-0 relative z-10 w-full sm:w-auto justify-start sm:justify-end\">\n                {approvalStatus === \"pending\" && (\n                  <Badge variant=\"outline\" className=\"border-yellow-500 text-yellow-600 bg-yellow-50 text-xs px-2 sm:px-3 py-1 relative z-10\">\n                    Onay Bekliyor\n                  </Badge>\n                )}\n                <Badge variant={getStatusVariant(normalizeStatusValue(currentStatus))} className=\"text-xs px-2 sm:px-3 py-1 relative z-10\">\n                  {getStatusLabel(normalizeStatusValue(currentStatus))}\n                </Badge>\n              </div>\n            </div>\n          </DialogHeader>\n          {quickMetaChips.length > 0 && (\n            <div className=\"px-2 sm:px-3 md:px-4 py-2 border-b bg-gray-50/50 flex flex-wrap items-center gap-1.5 sm:gap-2 flex-shrink-0 overflow-x-auto scrollbar-hide\">\n              {quickMetaChips.map((chip) => (\n                <div\n                  key={`${chip.label}-${chip.value}`}\n                  className=\"flex items-center gap-1 rounded-full border bg-muted/40 px-2 sm:px-3 py-1 sm:py-1.5 text-[10px] sm:text-xs font-medium text-muted-foreground whitespace-nowrap\"\n                >\n                  <span className=\"text-muted-foreground/70\">{chip.label}:</span>\n                  <span className=\"text-foreground\">{chip.value}</span>\n                </div>\n              ))}\n            </div>\n          )}\n\n          <div className=\"flex-1 overflow-hidden bg-gray-50/50 p-2 sm:p-3 md:p-4 min-h-0\">\n            <div className=\"max-w-full mx-auto h-full overflow-y-auto overflow-x-hidden\" style={{ WebkitOverflowScrolling: 'touch' }}>\n              {loading ? (\n                <div className=\"flex items-center justify-center py-8\">\n                  <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-primary\"></div>\n                </div>\n              ) : (\n                <div className=\"space-y-6\">\n            {approvalStatus === \"pending\" && (\n              <div className=\"p-3 sm:p-4 bg-yellow-50 border border-yellow-200 rounded-lg\">\n                <div className=\"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3 sm:gap-4\">\n                  <div className=\"flex-1 min-w-0\">\n                    <h4 className=\"text-[13px] sm:text-sm font-semibold text-yellow-900\">Sipari Tamamlanma Onay Bekliyor</h4>\n                    <p className=\"text-[11px] sm:text-sm text-yellow-700 mt-1\">\n                      Bu sipari tamamland olarak iaretlendi ve onaynz bekliyor.\n                    </p>\n                  </div>\n                  {canApprove && (\n                    <div className=\"flex gap-2 w-full sm:w-auto\">\n                      <Button\n                        size=\"sm\"\n                        variant=\"outline\"\n                        className=\"flex-1 sm:flex-none border-yellow-300 text-yellow-900 hover:bg-yellow-100 h-9 sm:h-10 min-h-[44px] sm:min-h-0 text-[11px] sm:text-xs\"\n                        onClick={handleReject}\n                      >\n                        <X className=\"h-4 w-4 mr-1\" />\n                        Reddet\n                      </Button>\n                      <Button\n                        size=\"sm\"\n                        className=\"flex-1 sm:flex-none bg-yellow-600 hover:bg-yellow-700 text-white border-none h-9 sm:h-10 min-h-[44px] sm:min-h-0 text-[11px] sm:text-xs\"\n                        onClick={handleApprove}\n                      >\n                        <Check className=\"h-4 w-4 mr-1\" />\n                        Onayla\n                      </Button>\n                    </div>\n                  )}\n                </div>\n              </div>\n            )}\n\n            <div className=\"grid grid-cols-2 sm:grid-cols-2 xl:grid-cols-4 gap-2 sm:gap-3 md:gap-4 auto-rows-fr\">\n              {highlightCards.map((card) => {\n                const Icon = card.icon;\n                return (\n                  <Tooltip key={card.label} delayDuration={150}>\n                    <TooltipTrigger asChild>\n                      <div\n                        className={`rounded-2xl border bg-gradient-to-br text-card-foreground p-4 shadow-sm transition hover:shadow-md hover:-translate-y-0.5 h-full ${card.accent}`}\n                      >\n                        <div className=\"flex items-center justify-between\">\n                          <div>\n                            <p className=\"text-xs uppercase tracking-wide text-muted-foreground\">{card.label}</p>\n                            <p className=\"text-2xl font-semibold mt-1 leading-tight\">{card.value}</p>\n                          </div>\n                          <div className=\"rounded-full border p-2 bg-white/75 shadow-inner shrink-0\">\n                            <Icon className=\"h-5 w-5 text-primary\" />\n                          </div>\n                        </div>\n                        <p className=\"text-xs text-muted-foreground mt-3\">{card.helper}</p>\n                      </div>\n                    </TooltipTrigger>\n                    <TooltipContent>{card.tooltip}</TooltipContent>\n                  </Tooltip>\n                );\n              })}\n            </div>\n\n            {/* Status Timeline */}\n            <Card>\n              <CardHeader className=\"space-y-1\">\n                <div className=\"flex items-center justify-between gap-3\">\n                  <div>\n                    <CardTitle className=\"text-lg sm:text-xl font-semibold\">Sipari Durumu</CardTitle>\n                    <p className=\"text-sm text-muted-foreground\">\n                      {(() => {\n                        const normalizedStatus = normalizeStatusValue(currentStatus);\n                        if (nextStatus) {\n                          return `${getStatusLabel(normalizedStatus)} aamasndasnz. Sradaki adm: ${nextStatus.label}`;\n                        }\n                        return \"Workflow tamamland.\";\n                      })()}\n                    </p>\n                  </div>\n                  <div className=\"text-xs text-muted-foreground text-right\">\n                    Son gncelleyen: {order?.statusUpdatedBy \n                      ? (usersMap[order.statusUpdatedBy] || order.statusUpdatedBy)\n                      : (user?.fullName || \"-\")}\n                    <br />\n                    <span className=\"text-[11px]\">\n                      {order?.statusUpdatedAt ? formatDateSafe(order.statusUpdatedAt as Timestamp | Date | string | null) : \"\"}\n                    </span>\n                  </div>\n                </div>\n              </CardHeader>\n              <CardContent className=\"p-3 sm:p-4 md:p-6\">\n                <div className=\"space-y-3 sm:space-y-4\">\n                  {/* Status Timeline */}\n                  <div className=\"flex items-center justify-between overflow-x-auto overflow-y-visible pt-2 pb-4\">\n                    {statusWorkflow.map((statusItem, index) => {\n                      const Icon = statusItem.icon;\n                      const currentIndex = getCurrentStatusIndex();\n                      const isActive = index === currentIndex;\n                      const isCompleted = index < currentIndex;\n                      const isClickable = !isPersonnel && (canUpdate || isCreator) && isCompleted && statusItem.value !== \"cancelled\" && approvalStatus !== \"pending\";\n                      \n                      return (\n                        <div key={statusItem.value} className=\"flex items-center flex-1 min-w-0\">\n                          <div className=\"flex flex-col items-center flex-1 min-w-0\">\n                            <Tooltip delayDuration={150}>\n                              <TooltipTrigger asChild>\n                                <div\n                                  className={`\n                                    w-10 h-10 rounded-full flex items-center justify-center border-2 transition-all relative z-10\n                                    ${isActive ? \"bg-primary text-primary-foreground border-primary scale-110\" : \"\"}\n                                    ${isCompleted ? \"bg-green-500 text-white border-green-500\" : \"\"}\n                                    ${!isActive && !isCompleted ? \"bg-muted border-muted-foreground/20\" : \"\"}\n                                    ${isClickable ? \"cursor-pointer hover:scale-105 hover:ring-2 hover:ring-primary/50\" : \"\"}\n                                  `}\n                                  onClick={() => {\n                                    if (isClickable) {\n                                      handleRevertStatus(statusItem.value);\n                                    }\n                                  }}\n                                >\n                                  <Icon className={`h-5 w-5 ${isActive || isCompleted ? \"text-white\" : statusItem.color}`} />\n                                </div>\n                              </TooltipTrigger>\n                              <TooltipContent>\n                                {isClickable\n                                  ? `${statusItem.label} durumuna geri dnmek iin tklayn`\n                                  : statusItem.label}\n                              </TooltipContent>\n                            </Tooltip>\n                            <p className={`text-xs mt-2 text-center font-medium ${isActive ? \"text-primary\" : isCompleted ? \"text-green-600\" : \"text-muted-foreground\"}`}>\n                              {statusItem.label}\n                            </p>\n                          </div>\n                          {index < statusWorkflow.length - 1 && (\n                            <div className={`flex-1 h-0.5 mx-2 ${isCompleted ? \"bg-green-500\" : \"bg-muted\"}`} />\n                          )}\n                        </div>\n                      );\n                    })}\n                  </div>\n                  \n                  {/* Next Status Button */}\n                  {(() => {\n                    const normalizedCurrentStatus = normalizeStatusValue(currentStatus);\n                    // Buton gsterilme koullar: next status var, delivered/cancelled deil, approval pending deil\n                    const shouldShowButton = nextStatus && \n                      normalizedCurrentStatus !== \"delivered\" && \n                      normalizedCurrentStatus !== \"cancelled\" && \n                      approvalStatus !== \"pending\" &&\n                      !isPersonnel && // Personel durum deitiremez\n                      (canUpdate || isCreator); // Yetki kontrol\n                    \n                    if (!shouldShowButton) {\n                      // Debug iin konsola yaz (sadece dev modda)\n                      if (import.meta.env.DEV && nextStatus) {\n                        // Debug log could go here if needed\n                      }\n                      return null;\n                    }\n                    \n                    return (\n                      <div className=\"flex justify-center pt-4 border-t\">\n                        <Button\n                          onClick={() => handleStatusChange(nextStatus.value)}\n                          disabled={updatingStatus}\n                          className=\"gap-2\"\n                        >\n                          {updatingStatus ? (\n                            <>\n                              <div className=\"animate-spin rounded-full h-4 w-4 border-b-2 border-white\"></div>\n                              Gncelleniyor...\n                            </>\n                          ) : (\n                            <>\n                              {(() => {\n                                const NextIcon = nextStatus.icon;\n                                return <NextIcon className=\"h-4 w-4\" />;\n                              })()}\n                              {nextStatus.label} Durumuna Ge\n                            </>\n                          )}\n                        </Button>\n                      </div>\n                    );\n                  })()}\n                </div>\n              </CardContent>\n            </Card>\n\n            <div className=\"grid gap-4 sm:gap-6 grid-cols-1 lg:grid-cols-2\">\n              {/* Customer Information */}\n              <Card>\n                <CardHeader className=\"space-y-1\">\n                  <CardTitle className=\"text-lg sm:text-xl font-semibold\">Mteri Bilgileri</CardTitle>\n                  <p className=\"text-sm text-muted-foreground\">\n                    letiim ve teslimat detaylar\n                  </p>\n                </CardHeader>\n                <CardContent className=\"space-y-3 sm:space-y-4\">\n                  <div className=\"space-y-2 sm:space-y-3\">\n                    <div className=\"flex items-center gap-2\">\n                      <User className=\"h-4 w-4 text-muted-foreground\" />\n                      <span className=\"font-medium\">{customer?.name || order?.customerName || order?.customer_name || \"-\"}</span>\n                    </div>\n                    {(customer?.company || order?.customerCompany) && (\n                  <div className=\"flex items-center gap-2\">\n                    <Building2 className=\"h-4 w-4 text-muted-foreground\" />\n                        <span>{customer?.company || order?.customerCompany || order?.customer_company}</span>\n                  </div>\n                )}\n                    {(customer?.phone || order?.customerPhone) && (\n                  <div className=\"flex items-center gap-2\">\n                    <Phone className=\"h-4 w-4 text-muted-foreground\" />\n                        <span>{formatPhoneForDisplay(customer?.phone || order?.customerPhone || order?.customer_phone)}</span>\n                  </div>\n                )}\n                    {(customer?.email || order?.customerEmail) && (\n                  <div className=\"flex items-center gap-2\">\n                    <Mail className=\"h-4 w-4 text-muted-foreground\" />\n                        <span>{customer?.email || order?.customerEmail || order?.customer_email}</span>\n                      </div>\n                    )}\n                  </div>\n\n                  {(customer?.phone || customer?.email || order?.customerPhone || order?.customerEmail) && (\n                    <div className=\"flex flex-wrap gap-3 pt-1\">\n                      {(customer?.phone || order?.customerPhone) && (\n                        <Button variant=\"outline\" size=\"sm\" asChild>\n                          <a href={`tel:${formatPhoneForTelLink(customer?.phone || order?.customerPhone || order?.customer_phone)}`}>\n                            Ara\n                          </a>\n                        </Button>\n                      )}\n                      {(customer?.email || order?.customerEmail) && (\n                        <Button \n                          variant=\"outline\" \n                          size=\"sm\"\n                          onClick={() => {\n                            const email = customer?.email || order?.customerEmail || order?.customer_email;\n                            if (email) {\n                              window.open(`https://mail.google.com/mail/?view=cm&fs=1&to=${encodeURIComponent(email)}`, '_blank');\n                            }\n                          }}\n                        >\n                          E-posta Gnder\n                        </Button>\n                      )}\n                    </div>\n                  )}\n\n                  {(shippingAddress || shippingNotes) && (\n                    <div className=\"space-y-2 rounded-lg border bg-muted/40 p-3\">\n                      <p className=\"text-sm font-medium text-muted-foreground flex items-center gap-2\">\n                        <Truck className=\"h-4 w-4\" />\n                        Teslimat Bilgileri\n                      </p>\n                      {shippingAddress && (\n                        <p className=\"text-sm\">{shippingAddress}</p>\n                      )}\n                      {shippingNotes && (\n                        <p className=\"text-xs text-muted-foreground\">{shippingNotes}</p>\n                      )}\n                  </div>\n                )}\n              </CardContent>\n            </Card>\n\n            {/* Order Information */}\n            <Card>\n              <CardHeader>\n                <CardTitle className=\"text-lg sm:text-xl font-semibold\">Sipari Bilgileri</CardTitle>\n              </CardHeader>\n                <CardContent className=\"space-y-3 sm:space-y-4\">\n                  <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4\">\n                    {orderSummaryRows.map((row) => (\n                      <div key={row.label} className=\"rounded-lg border bg-muted/30 px-3 py-2\">\n                        <p className=\"text-xs text-muted-foreground uppercase tracking-wide\">{row.label}</p>\n                        <p className=\"text-sm font-medium mt-1\">{row.value || \"-\"}</p>\n                    </div>\n                    ))}\n                  </div>\n                  {order?.notes && (\n                    <div className=\"rounded-lg border bg-muted/20 p-3\">\n                      <p className=\"text-sm text-muted-foreground mb-1 flex items-center gap-2\">\n                        <CircleDot className=\"h-4 w-4\" />\n                         Not\n                      </p>\n                      <p className=\"text-sm leading-relaxed\">{order.notes}</p>\n                  </div>\n                )}\n              </CardContent>\n            </Card>\n            </div>\n\n            {/* Order Items */}\n            <Card>\n              <CardHeader>\n                <CardTitle className=\"text-lg sm:text-xl font-semibold\">rnler</CardTitle>\n              </CardHeader>\n              <CardContent className=\"p-4 sm:p-6\">\n                {orderItems.length ? (\n                  <div className=\"rounded-lg border\">\n                    <Table>\n                      <TableHeader>\n                        <TableRow>\n                          <TableHead>rn</TableHead>\n                          <TableHead>SKU</TableHead>\n                          <TableHead>Kategori</TableHead>\n                          <TableHead className=\"text-right\">Miktar</TableHead>\n                          <TableHead className=\"text-right\">Birim Fiyat</TableHead>\n                          <TableHead className=\"text-right\">ndirim</TableHead>\n                          <TableHead className=\"text-right\">Toplam</TableHead>\n                        </TableRow>\n                      </TableHeader>\n                      <TableBody>\n                        {orderItems.map((item) => (\n                          <TableRow key={item.id}>\n                            <TableCell className=\"font-medium\">\n                              {item.productName || item.product_name || \"-\"}\n                            </TableCell>\n                            <TableCell>-</TableCell>\n                            <TableCell>{item.category || \"-\"}</TableCell>\n                            <TableCell className=\"text-right\">{item.quantity}</TableCell>\n                            <TableCell className=\"text-right\">{formatCurrency(item.unit_price ?? item.unitPrice, currency)}</TableCell>\n                            <TableCell className=\"text-right text-destructive\">\n                              {item.discount ? `-${formatCurrency(item.discount, currency)}` : \"-\"}\n                            </TableCell>\n                            <TableCell className=\"text-right font-semibold\">\n                              {formatCurrency(item.total, currency)}\n                            </TableCell>\n                          </TableRow>\n                        ))}\n                      </TableBody>\n                    </Table>\n                          </div>\n                ) : (\n                  <div className=\"text-center text-sm text-muted-foreground py-6\">\n                    Bu siparie ait rn bulunamad.\n                        </div>\n                )}\n              </CardContent>\n            </Card>\n\n            {/* Financial Summary */}\n            <Card>\n              <CardHeader>\n                <CardTitle className=\"text-lg sm:text-xl font-semibold\">Finansal zet</CardTitle>\n              </CardHeader>\n              <CardContent className=\"p-4 sm:p-6\">\n                <div className=\"space-y-2\">\n                  <div className=\"flex justify-between\">\n                    <span>Ara Toplam:</span>\n                    <span>{formatCurrency(subtotalValue, currency)}</span>\n                  </div>\n                  <div className=\"flex justify-between\">\n                    <span>KDV:</span>\n                    <span>{formatCurrency(taxValue, currency)}</span>\n                  </div>\n                  <Separator />\n                  <div className=\"flex justify-between font-bold text-lg\">\n                    <span>Genel Toplam:</span>\n                    <span>{formatCurrency(totalValue, currency)}</span>\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n\n            {order?.createdBy && usersMap[order.createdBy] && (\n              <p className=\"text-xs text-muted-foreground text-right\">\n                Siparii ekleyen: <span className=\"font-medium\">\n                  {usersMap[order.createdBy] || \"Bilinmeyen\"}\n                </span>\n              </p>\n            )}\n\n                  {/* Action Buttons */}\n                  <div className=\"flex justify-end gap-2\">\n                    {!isPersonnel && canDeleteState && onDelete && (\n                      <Button variant=\"outline\" onClick={onDelete} className=\"gap-2 h-10\">\n                        <Trash2 className=\"h-4 w-4\" />\n                        Sil\n                      </Button>\n                    )}\n                    {!isPersonnel && (canUpdate || isAdmin || isTeamLeader) && onEdit && (\n                      <Button onClick={onEdit} className=\"gap-2 h-10 bg-primary hover:bg-primary/90 text-white\">\n                        <Edit className=\"h-4 w-4\" />\n                        Dzenle\n                      </Button>\n                    )}\n                  </div>\n                </div>\n              )}\n            </div>\n          </div>\n          \n          {/* Activity Comments Panel */}\n          {order?.id && user && (\n            <ActivityCommentsPanel\n              entityId={order.id}\n              entityType=\"order\"\n              onAddComment={async (content: string) => {\n                await addOrderComment(\n                  order.id,\n                  user.id,\n                  content,\n                  user.fullName,\n                  user.email\n                );\n              }}\n              onGetComments={async () => {\n                return await getOrderComments(order.id);\n              }}\n              onGetActivities={async () => {\n                return await getOrderActivities(order.id);\n              }}\n              currentUserId={user.id}\n              currentUserName={user.fullName}\n              currentUserEmail={user.email}\n            />\n          )}\n        </div>\n      </DialogContent>\n    </Dialog>\n  );\n};\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\components\\Production\\CreateOrderDialog.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\components\\Production\\OrderDetailModal.tsx","messages":[{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useState\" is called conditionally. React Hooks must be called in the exact same order in every component render.","line":165,"column":35,"nodeType":"Identifier","endLine":165,"endColumn":43},{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useEffect\" is called conditionally. React Hooks must be called in the exact same order in every component render. Did you accidentally call a React Hook after an early return?","line":196,"column":3,"nodeType":"Identifier","endLine":196,"endColumn":12},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'isAdmin' and 'isTeamLeader'. Either include them or remove the dependency array.","line":231,"column":6,"nodeType":"ArrayExpression","endLine":231,"endColumn":19,"suggestions":[{"desc":"Update the dependencies array to be: [user, order, isAdmin, isTeamLeader]","fix":{"range":[8762,8775],"text":"[user, order, isAdmin, isTeamLeader]"}}]},{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useCallback\" is called conditionally. React Hooks must be called in the exact same order in every component render. Did you accidentally call a React Hook after an early return?","line":233,"column":25,"nodeType":"Identifier","endLine":233,"endColumn":36},{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useEffect\" is called conditionally. React Hooks must be called in the exact same order in every component render. Did you accidentally call a React Hook after an early return?","line":246,"column":3,"nodeType":"Identifier","endLine":246,"endColumn":12},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'fetchOrderDetails' and 'fetchProducts'. Either include them or remove the dependency array.","line":252,"column":6,"nodeType":"ArrayExpression","endLine":252,"endColumn":38,"suggestions":[{"desc":"Update the dependencies array to be: [fetchOrderDetails, fetchProducts, open, order?.id, order?.status]","fix":{"range":[9342,9374],"text":"[fetchOrderDetails, fetchProducts, open, order?.id, order?.status]"}}]},{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useEffect\" is called conditionally. React Hooks must be called in the exact same order in every component render. Did you accidentally call a React Hook after an early return?","line":254,"column":3,"nodeType":"Identifier","endLine":254,"endColumn":12},{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useEffect\" is called conditionally. React Hooks must be called in the exact same order in every component render. Did you accidentally call a React Hook after an early return?","line":290,"column":3,"nodeType":"Identifier","endLine":290,"endColumn":12},{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useCallback\" is called conditionally. React Hooks must be called in the exact same order in every component render. Did you accidentally call a React Hook after an early return?","line":394,"column":33,"nodeType":"Identifier","endLine":394,"endColumn":44},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useCallback has an unnecessary dependency: 'productionStatusWorkflow'. Either exclude it or remove the dependency array. Outer scope values like 'productionStatusWorkflow' aren't valid dependencies because mutating them doesn't re-render the component.","line":398,"column":6,"nodeType":"ArrayExpression","endLine":398,"endColumn":47,"suggestions":[{"desc":"Update the dependencies array to be: [currentStatus]","fix":{"range":[14512,14553],"text":"[currentStatus]"}}]},{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useMemo\" is called conditionally. React Hooks must be called in the exact same order in every component render. Did you accidentally call a React Hook after an early return?","line":400,"column":25,"nodeType":"Identifier","endLine":400,"endColumn":32},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useMemo has an unnecessary dependency: 'productionStatusWorkflow'. Either exclude it or remove the dependency array. Outer scope values like 'productionStatusWorkflow' aren't valid dependencies because mutating them doesn't re-render the component.","line":416,"column":6,"nodeType":"ArrayExpression","endLine":416,"endColumn":70,"suggestions":[{"desc":"Update the dependencies array to be: [currentStatus, getCurrentStatusIndex]","fix":{"range":[15138,15202],"text":"[currentStatus, getCurrentStatusIndex]"}}]}],"suppressedMessages":[],"errorCount":8,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useEffect, useState, useCallback, useMemo, type FormEvent } from \"react\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogDescription } from \"@/components/ui/dialog\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Separator } from \"@/components/ui/separator\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Tooltip, TooltipContent, TooltipTrigger } from \"@/components/ui/tooltip\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { \n  Calendar, \n  Package, \n  User, \n  Clock, \n  ListChecks, \n  ShoppingCart, \n  Edit, \n  Trash2, \n  Building2,\n  Phone,\n  Mail,\n  ClipboardList,\n  CheckCircle2,\n  Check,\n  CircleDot,\n  X,\n  Save,\n  Loader2,\n  Truck,\n} from \"lucide-react\";\nimport type { LucideIcon } from \"lucide-react\";\nimport { toast } from \"sonner\";\nimport { getTasks } from \"@/services/firebase/taskService\";\nimport { updateOrder, getOrderItems, updateOrderItem, getValidStatusTransitions, addOrderComment, getOrderComments, getOrderActivities, Order, OrderItem } from \"@/services/firebase/orderService\";\nimport { getCustomerById } from \"@/services/firebase/customerService\";\nimport { formatPhoneForDisplay, formatPhoneForTelLink } from \"@/utils/phoneNormalizer\";\nimport { useAuth } from \"@/contexts/AuthContext\";\nimport { canUpdateResource, canDeleteResource } from \"@/utils/permissions\";\nimport { getAllUsers, UserProfile } from \"@/services/firebase/authService\";\nimport { getProducts, Product } from \"@/services/firebase/productService\";\nimport { Timestamp } from \"firebase/firestore\";\nimport { ActivityCommentsPanel } from \"@/components/shared/ActivityCommentsPanel\";\nimport { PRIORITY_OPTIONS } from \"@/utils/priority\";\n\n// Helper functions\nconst resolveDateValue = (value?: unknown): Date | null => {\n  if (!value) return null;\n  if (typeof value === \"string\") {\n    const date = new Date(value);\n    if (!isNaN(date.getTime())) return date;\n    return null;\n  }\n  if (value instanceof Date) {\n    if (!isNaN(value.getTime())) return value;\n    return null;\n  }\n  if (value instanceof Timestamp) {\n    return value.toDate();\n  }\n  if (value && typeof value === \"object\") {\n    if (\"seconds\" in value && typeof (value as { seconds: unknown }).seconds === \"number\") {\n      return new Date((value as { seconds: number }).seconds * 1000);\n    }\n    if (\"toDate\" in value && typeof (value as { toDate: unknown }).toDate === \"function\") {\n      try {\n        return (value as { toDate: () => Date }).toDate();\n      } catch {\n        return null;\n      }\n    }\n    if (\"_seconds\" in value && typeof (value as { _seconds: unknown })._seconds === \"number\") {\n      return new Date((value as { _seconds: number })._seconds * 1000);\n    }\n  }\n  return null;\n};\n\nconst formatDateSafe = (dateInput?: string | Date | null | Timestamp | unknown) => {\n  if (!dateInput) return \"-\";\n  let date: Date | null = null;\n  \n  if (dateInput instanceof Date) {\n    date = dateInput;\n  } else if (dateInput instanceof Timestamp) {\n    date = dateInput.toDate();\n  } else if (typeof dateInput === \"string\") {\n    date = new Date(dateInput);\n  } else if (dateInput && typeof dateInput === \"object\") {\n    if (\"seconds\" in dateInput && typeof (dateInput as { seconds: unknown }).seconds === \"number\") {\n      date = new Date((dateInput as { seconds: number }).seconds * 1000);\n    } else if (\"toDate\" in dateInput && typeof (dateInput as { toDate: unknown }).toDate === \"function\") {\n      try {\n        date = (dateInput as { toDate: () => Date }).toDate();\n      } catch {\n        return \"-\";\n      }\n    } else if (\"_seconds\" in dateInput && typeof (dateInput as { _seconds: unknown })._seconds === \"number\") {\n      date = new Date((dateInput as { _seconds: number })._seconds * 1000);\n    }\n  }\n  \n  if (!date || isNaN(date.getTime())) return \"-\";\n  \n  try {\n    return date.toLocaleDateString(\"tr-TR\", { \n      day: \"2-digit\", \n      month: \"short\", \n      year: \"numeric\" \n    });\n  } catch {\n    return \"-\";\n  }\n};\n\ntype StatusItem = {\n  value: string;\n  label: string;\n  icon: LucideIcon;\n  color: string;\n};\n\n// retim siparilerine zg durum workflow'u\nconst productionStatusWorkflow: StatusItem[] = [\n  { value: \"planned\", label: \"Planlanan\", icon: ClipboardList, color: \"text-muted-foreground\" },\n  { value: \"in_production\", label: \"retimde\", icon: Package, color: \"text-blue-500\" },\n  { value: \"quality_check\", label: \"Kalite Kontrol\", icon: CheckCircle2, color: \"text-cyan-500\" },\n  { value: \"completed\", label: \"Tamamland\", icon: Check, color: \"text-emerald-600\" },\n  { value: \"on_hold\", label: \"Beklemede\", icon: Clock, color: \"text-amber-500\" },\n];\n\nconst normalizeStatusValue = (status?: string) => {\n  if (!status) return \"planned\";\n  return status;\n};\n\ninterface OrderDetailModalProps {\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n  order: Order;\n  onEdit?: () => void;\n  onDelete?: () => void;\n  onUpdate?: () => void;\n}\n\nexport const OrderDetailModal = ({ open, onOpenChange, order, onEdit, onDelete, onUpdate }: OrderDetailModalProps) => {\n  const { user, isAdmin, isTeamLeader } = useAuth();\n  const [tasks, setTasks] = useState<Awaited<ReturnType<typeof getTasks>>>([]);\n  const [tasksLoading, setTasksLoading] = useState(false);\n  const [loading, setLoading] = useState(true);\n  const [customer, setCustomer] = useState<Awaited<ReturnType<typeof getCustomerById>> | null>(null);\n  const [updatingStatus, setUpdatingStatus] = useState(false);\n  const [currentStatus, setCurrentStatus] = useState<string>(normalizeStatusValue(order?.status));\n  const [usersMap, setUsersMap] = useState<Record<string, string>>({});\n  const [isEditing, setIsEditing] = useState(false);\n  const [saving, setSaving] = useState(false);\n  const [products, setProducts] = useState<Product[]>([]);\n  const [productsLoading, setProductsLoading] = useState(false);\n  const [orderItems, setOrderItems] = useState<OrderItem[]>([]);\n  const [canUpdate, setCanUpdate] = useState(false);\n  const [canDelete, setCanDelete] = useState(false);\n  \n  if (!order) return null;\n  const [formData, setFormData] = useState({\n    order_number: \"\",\n    product_name: \"\",\n    product_id: \"\",\n    quantity: \"\",\n    unit: \"Adet\",\n    customer_id: \"\",\n    customer_name: \"\",\n    due_date: \"\",\n    priority: \"0\",\n    status: \"planned\",\n    notes: \"\",\n    shipping_address: \"\",\n    shipping_notes: \"\",\n  });\n  \n  // Personel kontrol - Personel retim siparii detayn grebilir ama dzenleyemez\n  // Bu deikeni en ste tayoruz nk dier deikenlerde kullanlyor\n  const isPersonnel = Boolean(user?.roles?.includes(\"personnel\"));\n  const isManager = Boolean(user?.roles?.includes('manager')) || isAdmin;\n  const isCreator = user?.id === order?.createdBy;\n  const canUpdateStatus = !isPersonnel && (isManager || isAdmin || isTeamLeader || isCreator);\n  \n  const orderNumber = order?.order_number || order?.orderNumber || order?.id || \"-\";\n  const dueDateValue = resolveDateValue(order?.due_date || order?.dueDate);\n  const createdAtValue = resolveDateValue(order?.created_at || order?.createdAt);\n  const updatedAtValue = resolveDateValue(order?.updated_at || order?.updatedAt);\n  const shippingAddress = order?.delivery_address || order?.shippingAddress || order?.shipping_address;\n  const shippingNotes = order?.delivery_notes || order?.shippingNotes || order?.shipping_notes;\n\n  // Yetki kontrolleri - Firestore'dan kontrol et\n  useEffect(() => {\n    const checkPermissions = async () => {\n      if (!user || !order) {\n        setCanUpdate(false);\n        setCanDelete(false);\n        return;\n      }\n      try {\n        const userProfile: UserProfile = {\n          id: user.id,\n          email: user.email,\n          emailVerified: user.emailVerified,\n          fullName: user.fullName,\n          displayName: user.fullName,\n          phone: null,\n          dateOfBirth: null,\n          role: user.roles || [],\n          createdAt: null,\n          updatedAt: null,\n        };\n        const [canUpdateOrder, canDeleteOrder] = await Promise.all([\n          canUpdateResource(userProfile, \"orders\"),\n          canDeleteResource(userProfile, \"orders\"),\n        ]);\n        setCanUpdate(canUpdateOrder || isAdmin || isTeamLeader);\n        setCanDelete(canDeleteOrder || isAdmin || isTeamLeader);\n      } catch (error: unknown) {\n        if (import.meta.env.DEV) {\n          console.error(\"Error checking order permissions:\", error);\n        }\n        setCanUpdate(false);\n        setCanDelete(false);\n      }\n    };\n    checkPermissions();\n  }, [user, order]);\n\n  const fetchProducts = useCallback(async () => {\n    try {\n      setProductsLoading(true);\n      const productData = await getProducts();\n      setProducts(productData);\n    } catch (error: unknown) {\n      if (import.meta.env.DEV) console.error(\"Fetch products error:\", error);\n      toast.error(\"rn listesi alnamad.\");\n    } finally {\n      setProductsLoading(false);\n    }\n  }, []);\n\n  useEffect(() => {\n    if (open && order?.id) {\n      fetchOrderDetails();\n      setCurrentStatus(normalizeStatusValue(order?.status));\n      fetchProducts();\n    }\n  }, [open, order?.id, order?.status]);\n\n  useEffect(() => {\n    if (order && !isEditing && orderItems.length > 0) {\n      // Order items'dan product_id'yi bul\n      const firstItem = orderItems[0];\n      const productId = firstItem?.productId || \"\";\n      const productName = firstItem?.productName || \"\";\n      const dueDate = order.due_date \n        ? (typeof order.due_date === 'string'\n            ? new Date(order.due_date).toISOString().split(\"T\")[0]\n            : order.dueDate\n            ? (order.dueDate instanceof Date\n                ? order.dueDate.toISOString().split(\"T\")[0]\n                : typeof order.dueDate === 'string'\n                ? new Date(order.dueDate).toISOString().split(\"T\")[0]\n                : \"\")\n            : \"\")\n        : \"\";\n      \n      setFormData({\n        order_number: order.order_number || order.orderNumber || \"\",\n        product_name: productName,\n        product_id: productId,\n        quantity: firstItem?.quantity?.toString() || \"\",\n        unit: \"Adet\",\n        customer_id: order.customer_id || order.customerId || \"\",\n        customer_name: order.customer_name || order.customerName || \"\",\n        due_date: dueDate,\n        priority: order.priority?.toString() || \"0\",\n        status: order.status || \"planned\",\n        notes: order.notes || \"\",\n        shipping_address: order.delivery_address || order.shippingAddress || order.shipping_address || \"\",\n        shipping_notes: order.delivery_notes || order.shippingNotes || order.shipping_notes || \"\",\n      });\n    }\n  }, [order, open, isEditing, orderItems]);\n\n  useEffect(() => {\n    const loadUsers = async () => {\n      try {\n        const allUsers = await getAllUsers();\n        const userMap: Record<string, string> = {};\n        allUsers.forEach((u) => {\n          userMap[u.id] = u.fullName || u.displayName || u.email || \"Bilinmeyen\";\n        });\n        setUsersMap(userMap);\n      } catch (error: unknown) {\n        if (import.meta.env.DEV) console.error(\"Error loading users:\", error);\n      }\n    };\n    if (open) {\n      loadUsers();\n    }\n  }, [open]);\n\n  const fetchOrderDetails = async () => {\n    setLoading(true);\n    try {\n      // Fetch customer details\n      if (order.customer_id || order.customerId) {\n        const customerId = order.customer_id || order.customerId;\n        try {\n          const customerData = await getCustomerById(customerId);\n          setCustomer(customerData);\n        } catch (error: unknown) {\n          if (import.meta.env.DEV) console.error(\"Fetch customer error:\", error);\n          // Customer fetch hatas kritik deil, devam et\n        }\n      }\n      \n      // Fetch order items\n      try {\n        const items = await getOrderItems(order.id);\n        setOrderItems(items);\n      } catch (error: unknown) {\n        if (import.meta.env.DEV) console.error(\"Fetch order items error:\", error);\n      }\n      \n      // Fetch tasks\n      setTasksLoading(true);\n      try {\n        const tasks = await getTasks({ productionOrderId: order.id });\n        setTasks(tasks);\n      } catch (error: unknown) {\n        if (import.meta.env.DEV) console.error(\"Fetch order tasks error:\", error);\n        const errorMessage = error instanceof Error ? error.message : \"Bilinmeyen hata\";\n        toast.error(errorMessage || \"Grevler yklenirken hata olutu\");\n      } finally {\n        setTasksLoading(false);\n      }\n    } catch (error: unknown) {\n      if (import.meta.env.DEV) console.error(\"Fetch order details error:\", error);\n      const errorMessage = error instanceof Error ? error.message : \"Bilinmeyen hata\";\n      toast.error(\"Detaylar yklenirken hata: \" + errorMessage);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const fetchOrderTasks = async () => {\n    setTasksLoading(true);\n    try {\n      const tasks = await getTasks({ productionOrderId: order.id });\n      setTasks(tasks);\n    } catch (error: unknown) {\n      if (import.meta.env.DEV) console.error(\"Fetch order tasks error:\", error);\n      const errorMessage = error instanceof Error ? error.message : \"Bilinmeyen hata\";\n      toast.error(errorMessage || \"Grevler yklenirken hata olutu\");\n    } finally {\n      setTasksLoading(false);\n    }\n  };\n\n  const getStatusLabel = (status: string) => {\n    const labels: Record<string, string> = {\n      planned: \"Planlanan\",\n      in_production: \"retimde\",\n      quality_check: \"Kalite Kontrol\",\n      completed: \"Tamamland\",\n      on_hold: \"Beklemede\",\n    };\n    return labels[status] || status;\n  };\n\n  const getStatusVariant = (status: string): \"default\" | \"secondary\" | \"destructive\" | \"outline\" => {\n    switch (status) {\n      case \"completed\":\n        return \"default\";\n      case \"in_production\":\n        return \"secondary\";\n      case \"quality_check\":\n        return \"secondary\";\n      case \"planned\":\n        return \"outline\";\n      case \"on_hold\":\n        return \"outline\";\n      default:\n        return \"secondary\";\n    }\n  };\n\n  const getCurrentStatusIndex = useCallback(() => {\n    const normalized = normalizeStatusValue(currentStatus);\n    const index = productionStatusWorkflow.findIndex((statusItem) => statusItem.value === normalized);\n    return index === -1 ? 0 : index;\n  }, [currentStatus, productionStatusWorkflow]);\n\n  const getNextStatus = useMemo(() => {\n    return () => {\n      const currentIndex = getCurrentStatusIndex();\n      if (currentIndex === -1 || currentIndex >= productionStatusWorkflow.length - 1) {\n        return null;\n      }\n      // on_hold durumundan sonraki duruma gei yok, sadece geri dn var\n      if (currentStatus === \"on_hold\") {\n        return null;\n      }\n      // completed durumundan sonra gei yok, sipari tamamland\n      if (currentStatus === \"completed\") {\n        return null;\n      }\n      return productionStatusWorkflow[currentIndex + 1];\n    };\n  }, [currentStatus, productionStatusWorkflow, getCurrentStatusIndex]);\n\n  const handleStatusChange = async (nextStatus: string) => {\n    if (!order?.id || !user?.id) {\n      return;\n    }\n\n    setUpdatingStatus(true);\n    try {\n      await updateOrder(\n        order.id,\n        {\n          status: nextStatus as Order[\"status\"],\n        },\n        user.id,\n        isAdmin // st yneticiler iin durum gei validasyonunu atla\n      );\n      setCurrentStatus(nextStatus);\n      toast.success(`Sipari durumu ${getStatusLabel(nextStatus)} olarak gncellendi.`);\n    } catch (error: unknown) {\n      if (import.meta.env.DEV) console.error(\"Order status update error:\", error);\n      const errorMessage = error instanceof Error ? error.message : \"Bilinmeyen hata\";\n      toast.error(\"Durum gncellenemedi: \" + errorMessage);\n    } finally {\n      setUpdatingStatus(false);\n    }\n  };\n\n  const handleRevertStatus = async (targetStatus: string) => {\n    if (!order?.id || !user?.id || !canUpdateStatus) {\n      return;\n    }\n\n    setUpdatingStatus(true);\n    try {\n      await updateOrder(\n        order.id,\n        {\n          status: targetStatus as Order[\"status\"],\n        },\n        user.id,\n        isAdmin\n      );\n      setCurrentStatus(targetStatus);\n      toast.success(`Sipari durumu ${getStatusLabel(targetStatus)} olarak gncellendi.`);\n    } catch (error: unknown) {\n      if (import.meta.env.DEV) console.error(\"Order status revert error:\", error);\n      const errorMessage = error instanceof Error ? error.message : \"Bilinmeyen hata\";\n      toast.error(\"Durum gncellenemedi: \" + errorMessage);\n    } finally {\n      setUpdatingStatus(false);\n    }\n  };\n\n  const handleProductSelect = (value: string) => {\n    if (value === \"none\" || value === \"\") {\n      setFormData((prev) => ({ ...prev, product_id: \"\" }));\n      return;\n    }\n    const selected = products.find((product) => product.id === value);\n    if (selected) {\n      setFormData((prev) => ({\n        ...prev,\n        product_id: value,\n        product_name: selected.name,\n      }));\n    }\n  };\n\n  const handleProductNameChange = (value: string) => {\n    setFormData((prev) => {\n      const selectedProduct = products.find((p) => p.id === prev.product_id);\n      const newProductId = selectedProduct && selectedProduct.name === value ? prev.product_id : \"\";\n      \n      return {\n        ...prev,\n        product_name: value,\n        product_id: newProductId,\n      };\n    });\n  };\n\n  const handleSubmit = async (e: FormEvent) => {\n    e.preventDefault();\n    if (!order?.id) return;\n    \n    setSaving(true);\n    try {\n      const dueDate = formData.due_date ? Timestamp.fromDate(new Date(formData.due_date)) : null;\n      const quantityValue = Number(formData.quantity) || 0;\n\n      // Order' gncelle\n      await updateOrder(order.id, {\n        orderNumber: formData.order_number,\n        order_number: formData.order_number,\n        customerId: formData.customer_id || null,\n        customer_id: formData.customer_id || null,\n        customerName: formData.customer_name || null,\n        customer_name: formData.customer_name || null,\n        dueDate,\n        due_date: formData.due_date || null,\n        status: formData.status as Order[\"status\"],\n        notes: formData.notes || null,\n        deliveryAddress: formData.shipping_address || null,\n        delivery_address: formData.shipping_address || null,\n        shippingAddress: formData.shipping_address || null,\n        shipping_address: formData.shipping_address || null,\n        deliveryNotes: formData.shipping_notes || null,\n        delivery_notes: formData.shipping_notes || null,\n        shippingNotes: formData.shipping_notes || null,\n        shipping_notes: formData.shipping_notes || null,\n        totalQuantity: quantityValue,\n        total_quantity: quantityValue,\n        itemsCount: 1,\n        items_count: 1,\n      }, user?.id);\n\n      // Items' gncelle\n      try {\n        const items = await getOrderItems(order.id);\n        if (items.length > 0) {\n          await updateOrderItem(order.id, items[0].id, {\n            productId: formData.product_id || null,\n            product_id: formData.product_id || null,\n            productName: formData.product_name,\n            product_name: formData.product_name,\n            quantity: quantityValue,\n          }, user?.id);\n        }\n      } catch (itemsError) {\n        console.warn(\"Order items gncellenemedi:\", itemsError);\n      }\n\n      toast.success(\"Sipari baaryla gncellendi\");\n      setIsEditing(false);\n      setCurrentStatus(formData.status);\n      onUpdate?.();\n      // Verileri yeniden ykle\n      fetchOrderDetails();\n    } catch (error: unknown) {\n      if (import.meta.env.DEV) console.error(\"Update production order error:\", error);\n      const errorMessage = error instanceof Error ? error.message : \"Bilinmeyen hata\";\n      toast.error(errorMessage || \"Sipari gncellenirken hata olutu\");\n    } finally {\n      setSaving(false);\n    }\n  };\n\n  // Quick meta chips iin veri\n  const quickMetaChips = [\n    orderNumber && { label: \"Sipari No\", value: orderNumber },\n    createdAtValue && { label: \"Oluturulma\", value: formatDateSafe(createdAtValue as Date | string | Timestamp | null) },\n    dueDateValue && { label: \"Termin\", value: formatDateSafe(dueDateValue as Date | string | Timestamp | null) },\n    order.priority !== undefined && { label: \"ncelik\", value: `${order.priority || 0} / 5` },\n  ].filter(Boolean) as { label: string; value: string }[];\n\n  // Sipari zeti satrlar\n  const firstItem = orderItems[0];\n  const orderSummaryRows = [\n    { label: \"Sipari No\", value: orderNumber },\n    { label: \"rn\", value: firstItem?.productName || \"-\" },\n    { label: \"Miktar\", value: `${firstItem?.quantity || 0} Adet` },\n    { label: \"Termin Tarihi\", value: formatDateSafe(dueDateValue as Date | string | Timestamp | null) },\n    { label: \"ncelik\", value: `${order.priority || 0} / 5` },\n    { label: \"Durum\", value: getStatusLabel(order.status) },\n    { label: \"Oluturan\", value: order?.createdBy \n      ? (usersMap[order.createdBy] || \"-\")\n      : \"-\" },\n    { label: \"Oluturma Tarihi\", value: formatDateSafe(createdAtValue as Date | string | Timestamp | null) },\n    { label: \"Son Gncelleme\", value: formatDateSafe(updatedAtValue as Date | string | Timestamp | null) },\n  ];\n\n  return (\n    <Dialog open={open} onOpenChange={onOpenChange}>\n      <DialogContent className=\"!max-w-[100vw] sm:!max-w-[95vw] md:!max-w-[85vw] !w-[100vw] sm:!w-[95vw] md:!w-[85vw] !h-[100vh] sm:!h-[90vh] md:!h-[85vh] !max-h-[100vh] sm:!max-h-[90vh] md:!max-h-[85vh] !left-0 sm:!left-[2.5vw] md:!left-[7.5vw] !top-0 sm:!top-[5vh] md:!top-[7.5vh] !right-0 sm:!right-auto !bottom-0 sm:!bottom-auto !translate-x-0 !translate-y-0 overflow-hidden !p-0 gap-0 bg-white flex flex-col !m-0 !rounded-none sm:!rounded-lg !border-0 sm:!border\">\n        {/* DialogTitle ve DialogDescription DialogContent'in direkt child' olmal (Radix UI gereksinimi) */}\n        <DialogTitle className=\"sr-only\">\n          retim Siparii - {orderNumber}\n        </DialogTitle>\n        <DialogDescription className=\"sr-only\">\n          {firstItem?.productName ? `${firstItem.productName} - retim siparii detaylar` : \"retim siparii detaylar\"}\n        </DialogDescription>\n        \n        <div className=\"flex flex-col h-full min-h-0\">\n          <DialogHeader className=\"p-2 sm:p-3 md:p-4 border-b bg-white flex-shrink-0 relative pr-10 sm:pr-12\">\n            <div className=\"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-2 sm:gap-3\">\n              <div className=\"flex items-center gap-2 sm:gap-3 flex-1 min-w-0 w-full sm:w-auto\">\n                <div className=\"h-8 w-8 sm:h-10 sm:w-10 rounded-lg bg-primary/10 flex items-center justify-center border border-primary/20 flex-shrink-0\">\n                  <ShoppingCart className=\"h-4 w-4 sm:h-5 sm:w-5 text-primary\" />\n                </div>\n                <div className=\"flex-1 min-w-0\">\n                  <h2 className=\"text-[14px] sm:text-[16px] md:text-[18px] font-semibold text-foreground truncate\">\n                    retim Siparii - {orderNumber}\n                  </h2>\n                  {firstItem?.productName && (\n                    <p className=\"text-[10px] sm:text-[11px] md:text-xs text-muted-foreground truncate mt-0.5\">\n                      {firstItem.productName}\n                    </p>\n                  )}\n                </div>\n              </div>\n              <div className=\"flex flex-wrap items-center gap-2 flex-shrink-0 relative z-10 w-full sm:w-auto justify-start sm:justify-end\">\n                <Badge variant={getStatusVariant(currentStatus)} className=\"text-[10px] sm:text-xs px-2 sm:px-3 py-1 relative z-10 w-full sm:w-auto justify-center sm:justify-start\">\n                  {getStatusLabel(currentStatus)}\n                </Badge>\n                {!isEditing ? (\n                  <>\n                    {!isPersonnel && (canUpdate || order.createdBy === user?.id) && (\n                      <Button\n                        variant=\"outline\"\n                        size=\"sm\"\n                        onClick={() => setIsEditing(true)}\n                        className=\"text-[11px] sm:text-xs h-10 sm:h-8 min-h-[44px] sm:min-h-0 w-full sm:w-auto\"\n                      >\n                        <Edit className=\"h-4 w-4 mr-2\" />\n                        Dzenle\n                      </Button>\n                    )}\n                    {!isPersonnel && canDelete && onDelete && (\n                      <Button\n                        variant=\"outline\"\n                        size=\"sm\"\n                        onClick={onDelete}\n                        className=\"text-[11px] sm:text-xs h-10 sm:h-8 min-h-[44px] sm:min-h-0 text-destructive hover:text-destructive w-full sm:w-auto\"\n                      >\n                        <Trash2 className=\"h-4 w-4 mr-2\" />\n                        Sil\n                      </Button>\n                    )}\n                  </>\n                ) : (\n                  <div className=\"flex gap-2\">\n                    <Button\n                      variant=\"outline\"\n                      size=\"sm\"\n                      onClick={() => {\n                        setIsEditing(false);\n                        // Form verilerini sfrla\n                        if (order && orderItems.length > 0) {\n                          const firstItem = orderItems[0];\n                          const productId = firstItem?.productId || \"\";\n                          const productName = firstItem?.productName || \"\";\n                          const dueDate = order.due_date \n                            ? (typeof order.due_date === 'string'\n                                ? new Date(order.due_date).toISOString().split(\"T\")[0]\n                                : \"\")\n                            : \"\";\n                          setFormData({\n                            order_number: order.order_number || order.orderNumber || \"\",\n                            product_name: productName,\n                            product_id: productId,\n                            quantity: firstItem?.quantity?.toString() || \"\",\n                            unit: \"Adet\",\n                            customer_id: order.customer_id || order.customerId || \"\",\n                            customer_name: order.customer_name || order.customerName || \"\",\n                            due_date: dueDate,\n                            priority: order.priority?.toString() || \"0\",\n                            status: order.status || \"planned\",\n                            notes: order.notes || \"\",\n                            shipping_address: order.delivery_address || order.shippingAddress || order.shipping_address || \"\",\n                            shipping_notes: order.delivery_notes || order.shippingNotes || order.shipping_notes || \"\",\n                          });\n                        }\n                      }}\n                      disabled={saving}\n                      className=\"text-[11px] sm:text-xs h-10 sm:h-8 min-h-[44px] sm:min-h-0 w-full sm:w-auto\"\n                    >\n                      <X className=\"h-4 w-4 mr-2\" />\n                      ptal\n                    </Button>\n                    <Button\n                      size=\"sm\"\n                      onClick={(e) => {\n                        e.preventDefault();\n                        const form = document.getElementById(\"production-order-edit-form\") as HTMLFormElement;\n                        if (form) {\n                          form.requestSubmit();\n                        } else {\n                          handleSubmit(e);\n                        }\n                      }}\n                      disabled={saving}\n                      className=\"text-[11px] sm:text-xs h-10 sm:h-8 min-h-[44px] sm:min-h-0 w-full sm:w-auto\"\n                    >\n                      {saving ? (\n                        <>\n                          <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />\n                          Kaydediliyor...\n                        </>\n                      ) : (\n                        <>\n                          <Save className=\"h-4 w-4 mr-2\" />\n                          Kaydet\n                        </>\n                      )}\n                    </Button>\n                  </div>\n                )}\n              </div>\n            </div>\n          </DialogHeader>\n\n          <div className=\"flex-1 overflow-hidden bg-gray-50/50 p-2 sm:p-3 md:p-4 min-h-0\">\n            <div className=\"max-w-full mx-auto h-full overflow-y-auto overflow-x-hidden\" style={{ WebkitOverflowScrolling: 'touch' }}>\n              {loading ? (\n                <div className=\"flex items-center justify-center py-8\">\n                  <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-primary\"></div>\n                </div>\n              ) : isEditing ? (\n                <form id=\"production-order-edit-form\" onSubmit={handleSubmit} className=\"space-y-3 sm:space-y-4\">\n                  <Card>\n                    <CardHeader>\n                      <CardTitle className=\"text-[14px] sm:text-[15px] font-semibold\">Sipari Bilgileri</CardTitle>\n                    </CardHeader>\n                    <CardContent className=\"space-y-3 sm:space-y-4\">\n                      <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4\">\n                        <div className=\"space-y-1.5 sm:space-y-2\">\n                          <Label htmlFor=\"order_number\" showRequired className=\"text-[11px] sm:text-xs\">Sipari No</Label>\n                          <Input\n                            id=\"order_number\"\n                            value={formData.order_number}\n                            onChange={(e) => setFormData({ ...formData, order_number: e.target.value })}\n                            required\n                            className=\"text-[11px] sm:text-xs h-10 sm:h-10 min-h-[44px] sm:min-h-0\"\n                          />\n                        </div>\n                        <div className=\"space-y-1.5 sm:space-y-2\">\n                          <Label htmlFor=\"status\" className=\"text-[11px] sm:text-xs\">Durum</Label>\n                          <Select value={formData.status} onValueChange={(value) => setFormData({ ...formData, status: value })}>\n                            <SelectTrigger className=\"text-[11px] sm:text-xs h-10 sm:h-10 min-h-[44px] sm:min-h-0\">\n                              <SelectValue />\n                            </SelectTrigger>\n                            <SelectContent className=\"text-[11px] sm:text-xs\">\n                              {(() => {\n                                const currentStatus = order?.status || \"planned\";\n                                const validTransitions = getValidStatusTransitions(currentStatus);\n                                const statusLabels: Record<string, string> = {\n                                  planned: \"Planlanan\",\n                                  in_production: \"retimde\",\n                                  quality_check: \"Kalite Kontrol\",\n                                  completed: \"Tamamland\",\n                                  on_hold: \"Beklemede\",\n                                  pending: \"Beklemede\",\n                                  cancelled: \"ptal Edildi\",\n                                };\n                                \n                                // Mevcut durumu da gster\n                                const allOptions = [...new Set([currentStatus, ...validTransitions])];\n                                \n                                return allOptions.map((status) => (\n                                  <SelectItem key={status} value={status} className=\"text-[11px] sm:text-xs\">\n                                    {statusLabels[status] || status}\n                                  </SelectItem>\n                                ));\n                              })()}\n                            </SelectContent>\n                          </Select>\n                        </div>\n                      </div>\n\n                      <div className=\"space-y-2\">\n                        <Label htmlFor=\"customer_name\" className=\"text-[11px] sm:text-xs\">Mteri Ad</Label>\n                        <Input\n                          id=\"customer_name\"\n                          value={formData.customer_name}\n                          onChange={(e) => setFormData({ ...formData, customer_name: e.target.value })}\n                          className=\"text-[11px] sm:text-xs h-10 sm:h-10 min-h-[44px] sm:min-h-0\"\n                        />\n                      </div>\n\n                      <div className=\"space-y-2\">\n                        <Label htmlFor=\"product_name\" showRequired className=\"text-[11px] sm:text-xs\">rn Ad</Label>\n                        <div className=\"space-y-1.5 sm:space-y-2\">\n                          <Select\n                            value={formData.product_id || \"none\"}\n                            onValueChange={handleProductSelect}\n                            disabled={productsLoading}\n                          >\n                            <SelectTrigger className=\"text-[11px] sm:text-xs h-10 sm:h-10 min-h-[44px] sm:min-h-0\">\n                              <SelectValue placeholder={productsLoading ? \"rnler ykleniyor...\" : \"rn sein (Opsiyonel)\"} />\n                            </SelectTrigger>\n                            <SelectContent className=\"text-[11px] sm:text-xs\">\n                              <SelectItem value=\"none\" className=\"text-[11px] sm:text-xs\">rn semeden devam et</SelectItem>\n                              {products.map((product) => (\n                                <SelectItem key={product.id} value={product.id} className=\"text-[11px] sm:text-xs\">\n                                  {product.name}\n                                </SelectItem>\n                              ))}\n                            </SelectContent>\n                          </Select>\n                          {productsLoading && (\n                            <div className=\"flex items-center gap-2 text-[11px] sm:text-xs text-muted-foreground\">\n                              <Loader2 className=\"h-4 w-4 animate-spin\" /> rnler ykleniyor...\n                            </div>\n                          )}\n                          <Input\n                            id=\"product_name\"\n                            placeholder=\"rn ad girin (dropdown'dan seebilir veya elle yazabilirsiniz)\"\n                            value={formData.product_name}\n                            onChange={(e) => handleProductNameChange(e.target.value)}\n                            required\n                            className=\"text-[11px] sm:text-xs h-10 sm:h-10 min-h-[44px] sm:min-h-0\"\n                          />\n                          {formData.product_id && (\n                            <p className=\"text-[11px] sm:text-xs text-muted-foreground flex items-center gap-1\">\n                              <span className=\"w-1.5 h-1.5 rounded-full bg-green-500\"></span>\n                              Dropdown'dan seili rn: {products.find(p => p.id === formData.product_id)?.name}\n                            </p>\n                          )}\n                        </div>\n                      </div>\n\n                      <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4\">\n                        <div className=\"space-y-1.5 sm:space-y-2\">\n                          <Label htmlFor=\"quantity\" showRequired className=\"text-[11px] sm:text-xs\">Miktar</Label>\n                          <Input\n                            id=\"quantity\"\n                            type=\"number\"\n                            value={formData.quantity}\n                            onChange={(e) => setFormData({ ...formData, quantity: e.target.value })}\n                            required\n                            className=\"text-[11px] sm:text-xs h-10 sm:h-10 min-h-[44px] sm:min-h-0\"\n                          />\n                        </div>\n                        <div className=\"space-y-1.5 sm:space-y-2\">\n                          <Label htmlFor=\"unit\" className=\"text-[11px] sm:text-xs\">Birim</Label>\n                          <Select value={formData.unit} onValueChange={(value) => setFormData({ ...formData, unit: value })}>\n                            <SelectTrigger className=\"text-[11px] sm:text-xs h-10 sm:h-10 min-h-[44px] sm:min-h-0\">\n                              <SelectValue />\n                            </SelectTrigger>\n                            <SelectContent className=\"text-[11px] sm:text-xs\">\n                              <SelectItem value=\"Adet\" className=\"text-[11px] sm:text-xs\">Adet</SelectItem>\n                              <SelectItem value=\"Kg\" className=\"text-[11px] sm:text-xs\">Kg</SelectItem>\n                              <SelectItem value=\"Lt\" className=\"text-[11px] sm:text-xs\">Lt</SelectItem>\n                              <SelectItem value=\"Mt\" className=\"text-[11px] sm:text-xs\">Mt</SelectItem>\n                              <SelectItem value=\"M2\" className=\"text-[11px] sm:text-xs\">M</SelectItem>\n                            </SelectContent>\n                          </Select>\n                        </div>\n                      </div>\n\n                      <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4\">\n                        <div className=\"space-y-1.5 sm:space-y-2\">\n                          <Label htmlFor=\"due_date\" showRequired className=\"text-[11px] sm:text-xs\">Termin Tarihi</Label>\n                          <Input\n                            id=\"due_date\"\n                            type=\"date\"\n                            value={formData.due_date}\n                            onChange={(e) => setFormData({ ...formData, due_date: e.target.value })}\n                            required\n                            className=\"text-[11px] sm:text-xs h-10 sm:h-10 min-h-[44px] sm:min-h-0\"\n                          />\n                        </div>\n                        <div className=\"space-y-1.5 sm:space-y-2\">\n                          <Label htmlFor=\"priority\" className=\"text-[11px] sm:text-xs\">ncelik</Label>\n                          <Select\n                            value={formData.priority?.toString() || \"0\"}\n                            onValueChange={(value) => setFormData({ ...formData, priority: value })}\n                          >\n                            <SelectTrigger className=\"h-10 sm:h-10 text-[11px] sm:text-xs min-h-[44px] sm:min-h-0\">\n                              <SelectValue />\n                            </SelectTrigger>\n                            <SelectContent>\n                              {PRIORITY_OPTIONS.map((option) => (\n                                <SelectItem key={option.value} value={option.value.toString()}>\n                                  {option.label} ({option.value})\n                                </SelectItem>\n                              ))}\n                            </SelectContent>\n                          </Select>\n                        </div>\n                      </div>\n\n                      <div className=\"space-y-2\">\n                        <Label htmlFor=\"notes\" className=\"text-[11px] sm:text-xs\">Notlar</Label>\n                        <Textarea\n                          id=\"notes\"\n                          value={formData.notes}\n                          onChange={(e) => setFormData({ ...formData, notes: e.target.value })}\n                          rows={3}\n                          className=\"text-[11px] sm:text-xs min-h-[80px] sm:min-h-0\"\n                          placeholder=\"Sipari ile ilgili notlar...\"\n                        />\n                      </div>\n\n                      <div className=\"space-y-2\">\n                        <Label className=\"text-[11px] sm:text-xs\">Teslimat Bilgileri</Label>\n                        <div className=\"space-y-1.5 sm:space-y-2\">\n                          <div className=\"space-y-1.5 sm:space-y-2\">\n                            <Label htmlFor=\"shipping_address\" className=\"text-[11px] sm:text-xs text-muted-foreground\">Teslimat Adresi</Label>\n                            <Input\n                              id=\"shipping_address\"\n                              value={formData.shipping_address}\n                              onChange={(e) => setFormData({ ...formData, shipping_address: e.target.value })}\n                              className=\"text-[11px] sm:text-xs h-10 sm:h-10 min-h-[44px] sm:min-h-0\"\n                              placeholder=\"Teslimat adresi...\"\n                            />\n                          </div>\n                          <div className=\"space-y-1.5 sm:space-y-2\">\n                            <Label htmlFor=\"shipping_notes\" className=\"text-[11px] sm:text-xs text-muted-foreground\">Teslimat Notlar</Label>\n                            <Textarea\n                              id=\"shipping_notes\"\n                              value={formData.shipping_notes}\n                              onChange={(e) => setFormData({ ...formData, shipping_notes: e.target.value })}\n                              rows={2}\n                              className=\"text-[11px] sm:text-xs min-h-[60px] sm:min-h-0\"\n                              placeholder=\"Teslimat ile ilgili notlar...\"\n                            />\n                          </div>\n                        </div>\n                      </div>\n                    </CardContent>\n                  </Card>\n                </form>\n              ) : (\n              <div className=\"space-y-3 sm:space-y-4\">\n                {/* Highlight Cards */}\n                <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3 sm:gap-4\">\n                  <Card className=\"bg-gradient-to-br from-blue-50/80 via-white to-white border-blue-100\">\n                    <CardHeader className=\"pb-2\">\n                      <CardTitle className=\"text-xs sm:text-sm font-medium text-muted-foreground flex items-center gap-2\">\n                        <Package className=\"h-3 w-3 sm:h-4 sm:w-4\" />\n                        rn\n                      </CardTitle>\n                    </CardHeader>\n                    <CardContent>\n                      <p className=\"text-[11px] sm:text-xs font-semibold text-foreground\">\n                        {firstItem?.productName || \"-\"}\n                      </p>\n                      <p className=\"text-[11px] sm:text-xs text-muted-foreground mt-1\">\n                        {firstItem?.quantity || 0} Adet\n                      </p>\n                    </CardContent>\n                  </Card>\n                  \n                  <Card className=\"bg-gradient-to-br from-indigo-50/80 via-white to-white border-indigo-100\">\n                    <CardHeader className=\"pb-2\">\n                      <CardTitle className=\"text-xs sm:text-sm font-medium text-muted-foreground flex items-center gap-2\">\n                        <User className=\"h-3 w-3 sm:h-4 sm:w-4\" />\n                        Mteri\n                      </CardTitle>\n                    </CardHeader>\n                    <CardContent>\n                      <p className=\"text-lg sm:text-xl font-semibold text-foreground\">\n                        {order.customer_name || order.customerName || \"Belirtilmemi\"}\n                      </p>\n                      {order.customer_company && (\n                        <p className=\"text-xs sm:text-sm text-muted-foreground mt-1\">\n                          {order.customer_company}\n                        </p>\n                      )}\n                    </CardContent>\n                  </Card>\n                  \n                  <Card className=\"bg-gradient-to-br from-slate-50/80 via-white to-white border-slate-100\">\n                    <CardHeader className=\"pb-2\">\n                      <CardTitle className=\"text-xs sm:text-sm font-medium text-muted-foreground flex items-center gap-2\">\n                        <Calendar className=\"h-3 w-3 sm:h-4 sm:w-4\" />\n                        Termin\n                      </CardTitle>\n                    </CardHeader>\n                    <CardContent>\n                      <p className=\"text-lg sm:text-xl font-semibold text-foreground\">\n                        {formatDateSafe(dueDateValue as Date | string | Timestamp | null)}\n                      </p>\n                    </CardContent>\n                  </Card>\n                  \n                  <Card className=\"bg-gradient-to-br from-emerald-50/80 via-white to-white border-emerald-100\">\n                    <CardHeader className=\"pb-2\">\n                      <CardTitle className=\"text-xs sm:text-sm font-medium text-muted-foreground flex items-center gap-2\">\n                        <Clock className=\"h-3 w-3 sm:h-4 sm:w-4\" />\n                        ncelik\n                      </CardTitle>\n                    </CardHeader>\n                    <CardContent>\n                      <p className=\"text-lg sm:text-xl font-semibold text-foreground\">\n                        {order.priority || 0} / 5\n                      </p>\n                    </CardContent>\n                  </Card>\n                </div>\n\n                {/* Status Timeline */}\n                <Card>\n                  <CardHeader className=\"space-y-1\">\n                    <div className=\"flex items-center justify-between gap-3\">\n                      <div>\n                        <CardTitle className=\"text-lg sm:text-xl font-semibold\">Sipari Durumu</CardTitle>\n                        <p className=\"text-[11px] sm:text-xs text-muted-foreground\">\n                          {getNextStatus()\n                            ? `${getStatusLabel(currentStatus)} aamasndasnz. Sradaki adm: ${getNextStatus()!.label}`\n                            : currentStatus === \"on_hold\"\n                            ? \"Sipari beklemede.\"\n                            : currentStatus === \"completed\"\n                            ? \"Sipari tamamland.\"\n                            : \"Workflow tamamland.\"}\n                        </p>\n                      </div>\n                      <div className=\"text-[11px] sm:text-xs text-muted-foreground text-right\">\n                        Son gncelleyen: {order?.statusUpdatedBy \n                          ? (usersMap[order.statusUpdatedBy] || order.statusUpdatedBy)\n                          : (user?.fullName || \"-\")}\n                        <br />\n                        <span className=\"text-[11px] sm:text-xs\">\n                          {order?.statusUpdatedAt ? formatDateSafe(order.statusUpdatedAt as Timestamp | Date | string | null) : \"\"}\n                        </span>\n                      </div>\n                    </div>\n                  </CardHeader>\n                  <CardContent className=\"p-3 sm:p-4 md:p-6\">\n                    <div className=\"space-y-3 sm:space-y-4\">\n                      {/* Status Timeline */}\n                      <div className=\"flex items-center justify-between overflow-x-auto overflow-y-visible pt-2 pb-4\">\n                        {productionStatusWorkflow.map((statusItem, index) => {\n                          const Icon = statusItem.icon;\n                          const currentIndex = getCurrentStatusIndex();\n                          const isActive = index === currentIndex;\n                          const isCompleted = index < currentIndex;\n                          const isClickable = canUpdateStatus && (isCompleted || isActive) && statusItem.value !== \"on_hold\";\n                          \n                          return (\n                            <div key={statusItem.value} className=\"flex items-center flex-1 min-w-0\">\n                              <div className=\"flex flex-col items-center flex-1 min-w-0\">\n                                <Tooltip delayDuration={150}>\n                                  <TooltipTrigger asChild>\n                                    <div\n                                      className={`\n                                        w-10 h-10 rounded-full flex items-center justify-center border-2 transition-all relative z-10\n                                        ${isActive ? \"bg-primary text-primary-foreground border-primary scale-110\" : \"\"}\n                                        ${isCompleted ? \"bg-green-500 text-white border-green-500\" : \"\"}\n                                        ${!isActive && !isCompleted ? \"bg-muted border-muted-foreground/20\" : \"\"}\n                                        ${isClickable ? \"cursor-pointer hover:scale-105\" : \"\"}\n                                      `}\n                                      onClick={() => {\n                                        if (isClickable && index < currentIndex) {\n                                          handleRevertStatus(statusItem.value);\n                                        }\n                                      }}\n                                    >\n                                      <Icon className={`h-5 w-5 ${isActive || isCompleted ? \"text-white\" : statusItem.color}`} />\n                                    </div>\n                                  </TooltipTrigger>\n                                  <TooltipContent>\n                                    {isClickable && index < currentIndex\n                                      ? `${statusItem.label} durumuna geri dnmek iin tklayn`\n                                      : statusItem.label}\n                                  </TooltipContent>\n                                </Tooltip>\n                                <p className={`text-[11px] sm:text-xs mt-2 text-center font-medium ${isActive ? \"text-primary\" : isCompleted ? \"text-green-600\" : \"text-muted-foreground\"}`}>\n                                  {statusItem.label}\n                                </p>\n                              </div>\n                              {index < productionStatusWorkflow.length - 1 && (\n                                <div className={`flex-1 h-0.5 mx-2 ${isCompleted ? \"bg-green-500\" : \"bg-muted\"}`} />\n                              )}\n                            </div>\n                          );\n                        })}\n                      </div>\n                      \n                      {/* Next Status Button */}\n                      {getNextStatus() && currentStatus !== \"on_hold\" && (\n                        <div className=\"flex justify-center pt-4 border-t\">\n                          <Button\n                            onClick={() => handleStatusChange(getNextStatus()!.value)}\n                            disabled={updatingStatus || !canUpdateStatus}\n                            className=\"text-[11px] sm:text-xs gap-2 h-10 sm:h-10 min-h-[44px] sm:min-h-0 w-full sm:w-auto\"\n                          >\n                            {updatingStatus ? (\n                              <>\n                                <div className=\"animate-spin rounded-full h-4 w-4 border-b-2 border-white\"></div>\n                                Gncelleniyor...\n                              </>\n                            ) : (\n                              <>\n                                {(() => {\n                                  const NextIcon = getNextStatus()!.icon;\n                                  return <NextIcon className=\"h-4 w-4\" />;\n                                })()}\n                                {getNextStatus()!.label} Durumuna Ge\n                              </>\n                            )}\n                          </Button>\n                        </div>\n                      )}\n                    </div>\n                  </CardContent>\n                </Card>\n\n                <div className=\"grid gap-4 sm:gap-6 grid-cols-1 lg:grid-cols-2\">\n                  {/* Mteri Bilgileri */}\n                  <Card>\n                    <CardHeader className=\"space-y-1\">\n                      <CardTitle className=\"text-lg sm:text-xl font-semibold\">Mteri Bilgileri</CardTitle>\n                      <p className=\"text-[11px] sm:text-xs text-muted-foreground\">\n                        letiim detaylar\n                      </p>\n                    </CardHeader>\n                    <CardContent className=\"space-y-3 sm:space-y-4\">\n                      <div className=\"space-y-2 sm:space-y-3\">\n                        <div className=\"flex items-center gap-2\">\n                          <User className=\"h-4 w-4 text-muted-foreground\" />\n                          <span className=\"text-[11px] sm:text-xs font-medium\">{customer?.name || order?.customerName || order?.customer_name || \"-\"}</span>\n                        </div>\n                        {(customer?.company || order?.customerCompany || order?.customer_company) && (\n                          <div className=\"flex items-center gap-2\">\n                            <Building2 className=\"h-4 w-4 text-muted-foreground\" />\n                            <span className=\"text-[11px] sm:text-xs\">{customer?.company || order?.customerCompany || order?.customer_company}</span>\n                          </div>\n                        )}\n                        {(customer?.phone || order?.customerPhone || order?.customer_phone) && (\n                          <div className=\"flex items-center gap-2\">\n                            <Phone className=\"h-4 w-4 text-muted-foreground\" />\n                            <span className=\"text-[11px] sm:text-xs\">{formatPhoneForDisplay(customer?.phone || order?.customerPhone || order?.customer_phone)}</span>\n                          </div>\n                        )}\n                        {(customer?.email || order?.customerEmail || order?.customer_email) && (\n                          <div className=\"flex items-center gap-2\">\n                            <Mail className=\"h-4 w-4 text-muted-foreground\" />\n                            <span className=\"text-[11px] sm:text-xs\">{customer?.email || order?.customerEmail || order?.customer_email}</span>\n                          </div>\n                        )}\n                      </div>\n\n                      {(customer?.phone || customer?.email || order?.customerPhone || order?.customerEmail) && (\n                        <div className=\"flex flex-wrap gap-3 pt-1\">\n                          {(customer?.phone || order?.customerPhone || order?.customer_phone) && (\n                            <Button variant=\"outline\" size=\"sm\" asChild className=\"text-[11px] sm:text-xs h-10 sm:h-8 min-h-[44px] sm:min-h-0 w-full sm:w-auto\">\n                              <a href={`tel:${formatPhoneForTelLink(customer?.phone || order?.customerPhone || order?.customer_phone)}`}>\n                                Ara\n                              </a>\n                            </Button>\n                          )}\n                          {(customer?.email || order?.customerEmail || order?.customer_email) && (\n                            <Button \n                              variant=\"outline\" \n                              size=\"sm\" \n                              className=\"text-[11px] sm:text-xs h-10 sm:h-8 min-h-[44px] sm:min-h-0 w-full sm:w-auto\"\n                              onClick={() => {\n                                const email = customer?.email || order?.customerEmail || order?.customer_email;\n                                if (email) {\n                                  window.open(`https://mail.google.com/mail/?view=cm&fs=1&to=${encodeURIComponent(email)}`, '_blank');\n                                }\n                              }}\n                            >\n                              E-posta Gnder\n                            </Button>\n                          )}\n                        </div>\n                      )}\n\n                      {(shippingAddress || shippingNotes) && (\n                        <div className=\"space-y-2 rounded-lg border bg-muted/40 p-3 mt-3\">\n                          <p className=\"text-[11px] sm:text-xs font-medium text-muted-foreground flex items-center gap-2\">\n                            <Truck className=\"h-4 w-4\" />\n                            Teslimat Bilgileri\n                          </p>\n                          {shippingAddress && (\n                            <p className=\"text-[11px] sm:text-xs\">{shippingAddress}</p>\n                          )}\n                          {shippingNotes && (\n                            <p className=\"text-[11px] sm:text-xs text-muted-foreground\">{shippingNotes}</p>\n                          )}\n                        </div>\n                      )}\n                    </CardContent>\n                  </Card>\n\n                  {/* Sipari Bilgileri */}\n                  <Card>\n                    <CardHeader>\n                      <CardTitle className=\"text-lg sm:text-xl font-semibold\">Sipari Bilgileri</CardTitle>\n                    </CardHeader>\n                    <CardContent className=\"space-y-3 sm:space-y-4\">\n                      <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4\">\n                        {orderSummaryRows.map((row) => (\n                          <div key={row.label} className=\"rounded-lg border bg-muted/30 px-3 py-2\">\n                            <p className=\"text-[11px] sm:text-xs text-muted-foreground uppercase tracking-wide\">{row.label}</p>\n                            <p className=\"text-[11px] sm:text-xs font-medium mt-1\">{row.value || \"-\"}</p>\n                          </div>\n                        ))}\n                      </div>\n                      {order?.notes && (\n                        <div className=\"rounded-lg border bg-muted/20 p-3\">\n                          <p className=\"text-[11px] sm:text-xs text-muted-foreground mb-1 flex items-center gap-2\">\n                            <CircleDot className=\"h-4 w-4\" />\n                             Not\n                          </p>\n                          <p className=\"text-[11px] sm:text-xs leading-relaxed\">{order.notes}</p>\n                        </div>\n                      )}\n                    </CardContent>\n                  </Card>\n                </div>\n\n                {/* Bal Grevler */}\n                <Card>\n                  <CardHeader>\n                    <div className=\"flex items-center justify-between\">\n                      <CardTitle className=\"text-lg sm:text-xl font-semibold flex items-center gap-2\">\n                        <ListChecks className=\"h-4 w-4 sm:h-5 sm:w-5\" />\n                        Bal Grevler ({tasks.length})\n                      </CardTitle>\n                      <Button variant=\"outline\" size=\"sm\" onClick={fetchOrderTasks} disabled={tasksLoading} className=\"text-[11px] sm:text-xs h-10 sm:h-8 min-h-[44px] sm:min-h-0 w-full sm:w-auto\">\n                        Yenile\n                      </Button>\n                    </div>\n                  </CardHeader>\n                  <CardContent>\n                    <div className=\"space-y-2\">\n                      {tasksLoading && (\n                        <p className=\"text-[11px] sm:text-xs text-muted-foreground\">Grevler ykleniyor...</p>\n                      )}\n                      {!tasksLoading && tasks.length === 0 && (\n                        <p className=\"text-[11px] sm:text-xs text-muted-foreground\">Bu siparie bal grev bulunmuyor.</p>\n                      )}\n                      {!tasksLoading &&\n                        tasks.map((task) => {\n                          const taskDueDate = resolveDateValue(task.dueDate);\n                          return (\n                            <div key={task.id} className=\"p-3 rounded-md border border-border bg-muted/30\">\n                              <div className=\"flex items-center justify-between\">\n                                <div>\n                                  <p className=\"text-[11px] sm:text-xs font-semibold text-foreground\">{task.title || \"-\"}</p>\n                                  {taskDueDate && (\n                                    <p className=\"text-[11px] sm:text-xs text-muted-foreground mt-1\">\n                                      Termin: {formatDateSafe(taskDueDate as Date | string | Timestamp | null)}\n                                    </p>\n                                  )}\n                                </div>\n                                <Badge variant={task.status === \"completed\" ? \"default\" : \"secondary\"} className=\"text-[10px]\">\n                                  {task.status || \"-\"}\n                                </Badge>\n                              </div>\n                            </div>\n                          );\n                        })}\n                    </div>\n                  </CardContent>\n                </Card>\n              </div>\n              )}\n            </div>\n          </div>\n        </div>\n        \n        {/* Activity Comments Panel */}\n        {order?.id && user && (\n          <ActivityCommentsPanel\n            entityId={order.id}\n            entityType=\"order\"\n            onAddComment={async (content: string) => {\n              await addOrderComment(\n                order.id,\n                user.id,\n                content,\n                user.fullName || user.email?.split(\"@\")[0] || \"Kullanc\",\n                user.email || \"\"\n              );\n            }}\n            onGetComments={async () => {\n              return await getOrderComments(order.id);\n            }}\n            onGetActivities={async () => {\n              return await getOrderActivities(order.id);\n            }}\n            currentUserId={user.id}\n            currentUserName={user.fullName || user.email?.split(\"@\")[0] || \"Kullanc\"}\n            currentUserEmail={user.email || \"\"}\n          />\n        )}\n      </DialogContent>\n    </Dialog>\n  );\n};\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\components\\Products\\CreateProductDialog.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\components\\Products\\EditProductDialog.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":26,"column":22,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":26,"endColumn":25,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1085,1088],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1085,1088],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from \"react\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogDescription } from \"@/components/ui/dialog\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { toast } from \"sonner\";\nimport { updateProduct, Product } from \"@/services/firebase/productService\";\nimport { useAuth } from \"@/contexts/AuthContext\";\nimport { Package, Loader2, X, Save } from \"lucide-react\";\n\nconst PRODUCT_CATEGORIES = [\n  \"Tanabilir G Paketleri\",\n  \"Kabin Tipi G Paketleri\",\n  \"Ara Tipi G Paketleri\",\n  \"Endstriyel G Paketleri\",\n  \"Gne Enerji Sistemleri\",\n] as const;\n\ninterface EditProductDialogProps {\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n  onSuccess: () => void;\n  product: Product | any;\n}\n\nexport const EditProductDialog = ({ open, onOpenChange, onSuccess, product }: EditProductDialogProps) => {\n  const { isAdmin, isTeamLeader } = useAuth();\n  const [loading, setLoading] = useState(false);\n  const [formData, setFormData] = useState({\n    name: \"\",\n    sku: \"\",\n    description: \"\",\n    category: \"\",\n    stock: \"0\",\n    unit: \"Adet\",\n    price: \"\",\n    cost: \"\",\n    min_stock: \"0\",\n    max_stock: \"\",\n    location: \"\",\n  });\n\n  useEffect(() => {\n    if (product) {\n      setFormData({\n        name: product.name || \"\",\n        sku: product.sku || \"\",\n        description: product.description || \"\",\n        category: product.category || \"\",\n        stock: product.stock?.toString() || \"0\",\n        unit: product.unit || \"Adet\",\n        price: product.price?.toString() || \"\",\n        cost: product.cost?.toString() || \"\",\n        min_stock: product.min_stock?.toString() || \"0\",\n        max_stock: product.max_stock?.toString() || \"\",\n        location: product.location || \"\",\n      });\n    }\n  }, [product]);\n\n  const handleSubmit = async (e?: React.FormEvent) => {\n    if (e) {\n      e.preventDefault();\n    }\n    setLoading(true);\n\n    try {\n      await updateProduct(product.id, {\n        name: formData.name,\n        sku: formData.sku || null,\n        description: formData.description || null,\n        category: formData.category || null,\n        imageUrl: null,\n        image_url: null,\n        stock: parseInt(formData.stock) || 0,\n        unit: formData.unit,\n        price: formData.price ? parseFloat(formData.price) : null,\n        unitPrice: formData.price ? parseFloat(formData.price) : null,\n        cost: formData.cost ? parseFloat(formData.cost) : null,\n        minStock: parseInt(formData.min_stock) || 0,\n        maxStock: formData.max_stock ? parseInt(formData.max_stock) : null,\n        location: formData.location || null,\n      });\n\n      toast.success(\"rn baaryla gncellendi\");\n      onSuccess();\n      onOpenChange(false);\n    } catch (error: unknown) {\n      // Sadece development'ta log gster\n      if (import.meta.env.DEV) {\n        console.error(\"Update product error:\", error);\n      }\n      toast.error(error instanceof Error ? error.message : \"rn gncellenirken hata olutu\");\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  return (\n    <Dialog open={open} onOpenChange={onOpenChange}>\n      <DialogContent className=\"!max-w-[100vw] sm:!max-w-[95vw] md:!max-w-[85vw] !w-[100vw] sm:!w-[95vw] md:!w-[85vw] !h-[100vh] sm:!h-[90vh] md:!h-[80vh] !max-h-[100vh] sm:!max-h-[90vh] md:!max-h-[80vh] !left-0 sm:!left-[2.5vw] md:!left-[7.5vw] !top-0 sm:!top-[5vh] md:!top-[10vh] !right-0 sm:!right-auto !bottom-0 sm:!bottom-auto !translate-x-0 !translate-y-0 overflow-hidden !p-0 gap-0 bg-white flex flex-col !m-0 !rounded-none sm:!rounded-lg !border-0 sm:!border\">\n        {/* DialogTitle ve DialogDescription DialogContent'in direkt child' olmal (Radix UI gereksinimi) */}\n        <DialogTitle className=\"sr-only\">\n          rn Dzenle\n        </DialogTitle>\n        <DialogDescription className=\"sr-only\">\n          rn bilgilerini dzenleyin\n        </DialogDescription>\n        \n        <div className=\"flex flex-col h-full min-h-0\">\n          {/* Header */}\n          <DialogHeader className=\"p-3 sm:p-4 border-b bg-white flex-shrink-0 relative pr-12 sm:pr-16\">\n            <div className=\"flex items-center justify-between gap-3\">\n              <div className=\"flex items-center gap-2 sm:gap-3 flex-1 min-w-0\">\n                <div className=\"h-8 w-8 sm:h-10 sm:w-10 rounded-lg bg-primary/10 flex items-center justify-center border border-primary/20 flex-shrink-0\">\n                  <Package className=\"h-4 w-4 sm:h-5 sm:w-5 text-primary\" />\n                </div>\n                <h2 className=\"text-[16px] sm:text-[18px] font-semibold text-foreground truncate\">\n                  rn Dzenle\n                </h2>\n              </div>\n              <div className=\"flex flex-wrap gap-2 flex-shrink-0\">\n                <Button\n                  variant=\"outline\"\n                  size=\"sm\"\n                  className=\"border-primary/20 hover:bg-primary/5 rounded-lg px-3 py-1.5 font-medium text-[11px] sm:text-xs flex-shrink-0 min-h-[36px] sm:min-h-8\"\n                  onClick={() => onOpenChange(false)}\n                  disabled={loading}\n                >\n                  <X className=\"h-3 w-3 sm:h-4 sm:w-4 mr-1.5 flex-shrink-0\" />\n                  ptal\n                </Button>\n                <Button\n                  variant=\"default\"\n                  size=\"sm\"\n                  className=\"bg-primary hover:bg-primary/90 rounded-lg px-3 py-1.5 font-medium text-[11px] sm:text-xs flex-shrink-0 text-white min-h-[36px] sm:min-h-8\"\n                  onClick={handleSubmit}\n                  disabled={loading}\n                >\n                  {loading ? (\n                    <Loader2 className=\"h-3 w-3 sm:h-4 sm:w-4 mr-1.5 flex-shrink-0 animate-spin\" />\n                  ) : (\n                    <Save className=\"h-3 w-3 sm:h-4 sm:w-4 mr-1.5 flex-shrink-0\" />\n                  )}\n                  Kaydet\n                </Button>\n              </div>\n            </div>\n          </DialogHeader>\n        \n          <div className=\"flex-1 overflow-hidden bg-gray-50/50 p-3 sm:p-4 min-h-0\">\n            <div className=\"max-w-full mx-auto h-full overflow-y-auto\">\n              <form onSubmit={(e) => { e.preventDefault(); handleSubmit(e); }} className=\"space-y-2\">\n                <Card>\n                  <CardHeader>\n                    <CardTitle className=\"text-[14px] sm:text-[15px] font-semibold\">Temel Bilgiler</CardTitle>\n                  </CardHeader>\n                  <CardContent className=\"space-y-3 sm:space-y-4\">\n                    <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-1.5 sm:gap-2\">\n                      <div className=\"space-y-1.5 sm:space-y-2\">\n                        <Label htmlFor=\"name\" className=\"text-[11px] sm:text-xs\">rn Ad</Label>\n                        <Input\n                          id=\"name\"\n                          value={formData.name}\n                          onChange={(e) => setFormData({ ...formData, name: e.target.value })}\n                          className=\"min-h-[44px] sm:min-h-0\"\n                          required\n                        />\n                      </div>\n                      <div className=\"space-y-1.5 sm:space-y-2\">\n                        <Label htmlFor=\"sku\" className=\"text-[11px] sm:text-xs\">SKU</Label>\n                        <Input\n                          id=\"sku\"\n                          value={formData.sku}\n                          onChange={(e) => setFormData({ ...formData, sku: e.target.value })}\n                          className=\"min-h-[44px] sm:min-h-0\"\n                          required\n                        />\n                      </div>\n                    </div>\n\n                    <div className=\"space-y-2\">\n                      <Label htmlFor=\"description\" className=\"text-[11px] sm:text-xs\">Aklama</Label>\n                      <Textarea\n                        id=\"description\"\n                        value={formData.description}\n                        onChange={(e) => setFormData({ ...formData, description: e.target.value })}\n                        rows={3}\n                        className=\"min-h-[44px] sm:min-h-0\"\n                      />\n                    </div>\n\n                    <div className=\"grid grid-cols-1 sm:grid-cols-3 gap-1.5 sm:gap-2\">\n                      <div className=\"space-y-1.5 sm:space-y-2\">\n                        <Label htmlFor=\"category\" className=\"text-[11px] sm:text-xs\">Kategori</Label>\n                        {(isAdmin || isTeamLeader) ? (\n                          <div className=\"space-y-2\">\n                            <Input\n                              id=\"category\"\n                              value={formData.category}\n                              onChange={(e) => setFormData({ ...formData, category: e.target.value })}\n                              placeholder=\"Kategori yazn veya sein\"\n                              className=\"min-h-[44px] sm:min-h-0\"\n                              list=\"category-options-edit\"\n                            />\n                            <datalist id=\"category-options-edit\">\n                              {PRODUCT_CATEGORIES.map((cat) => (\n                                <option key={cat} value={cat} />\n                              ))}\n                            </datalist>\n                          </div>\n                        ) : (\n                          <Select value={formData.category ? formData.category : \"none\"} onValueChange={(value) => setFormData({ ...formData, category: value === \"none\" ? \"\" : value })}>\n                            <SelectTrigger className=\"min-h-[44px] sm:min-h-0\">\n                              <SelectValue placeholder=\"Kategori sein\" />\n                            </SelectTrigger>\n                            <SelectContent>\n                              <SelectItem value=\"none\">Kategori Yok</SelectItem>\n                              {PRODUCT_CATEGORIES.map((cat) => (\n                                <SelectItem key={cat} value={cat}>\n                                  {cat}\n                                </SelectItem>\n                              ))}\n                            </SelectContent>\n                          </Select>\n                        )}\n                      </div>\n                      <div className=\"space-y-1.5 sm:space-y-2\">\n                        <Label htmlFor=\"stock\" className=\"text-[11px] sm:text-xs\">Stok</Label>\n                        <Input\n                          id=\"stock\"\n                          type=\"number\"\n                          value={formData.stock}\n                          onChange={(e) => setFormData({ ...formData, stock: e.target.value })}\n                          className=\"min-h-[44px] sm:min-h-0\"\n                          required\n                        />\n                      </div>\n                      <div className=\"space-y-1.5 sm:space-y-2\">\n                        <Label htmlFor=\"unit\" className=\"text-[11px] sm:text-xs\">Birim</Label>\n                        <Select value={formData.unit ? formData.unit : \"\"} onValueChange={(value) => setFormData({ ...formData, unit: value })}>\n                          <SelectTrigger className=\"min-h-[44px] sm:min-h-0\">\n                            <SelectValue />\n                          </SelectTrigger>\n                          <SelectContent>\n                            <SelectItem value=\"Adet\">Adet</SelectItem>\n                            <SelectItem value=\"Kg\">Kg</SelectItem>\n                            <SelectItem value=\"Lt\">Lt</SelectItem>\n                            <SelectItem value=\"Mt\">Mt</SelectItem>\n                            <SelectItem value=\"M2\">M</SelectItem>\n                          </SelectContent>\n                        </Select>\n                      </div>\n                    </div>\n\n                    <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-1.5 sm:gap-2\">\n                      <div className=\"space-y-1.5 sm:space-y-2\">\n                        <Label htmlFor=\"price\" className=\"text-[11px] sm:text-xs\">Sat Fiyat</Label>\n                        <Input\n                          id=\"price\"\n                          type=\"number\"\n                          step=\"0.01\"\n                          value={formData.price}\n                          onChange={(e) => setFormData({ ...formData, price: e.target.value })}\n                          className=\"min-h-[44px] sm:min-h-0\"\n                        />\n                      </div>\n                      <div className=\"space-y-1.5 sm:space-y-2\">\n                        <Label htmlFor=\"cost\" className=\"text-[11px] sm:text-xs\">Maliyet</Label>\n                        <Input\n                          id=\"cost\"\n                          type=\"number\"\n                          step=\"0.01\"\n                          value={formData.cost}\n                          onChange={(e) => setFormData({ ...formData, cost: e.target.value })}\n                          className=\"min-h-[44px] sm:min-h-0\"\n                        />\n                      </div>\n                    </div>\n\n                    <div className=\"grid grid-cols-1 sm:grid-cols-3 gap-1.5 sm:gap-2\">\n                      <div className=\"space-y-1.5 sm:space-y-2\">\n                        <Label htmlFor=\"min_stock\" className=\"text-[11px] sm:text-xs\">Min. Stok</Label>\n                        <Input\n                          id=\"min_stock\"\n                          type=\"number\"\n                          value={formData.min_stock}\n                          onChange={(e) => setFormData({ ...formData, min_stock: e.target.value })}\n                          className=\"min-h-[44px] sm:min-h-0\"\n                        />\n                      </div>\n                      <div className=\"space-y-1.5 sm:space-y-2\">\n                        <Label htmlFor=\"max_stock\" className=\"text-[11px] sm:text-xs\">Max. Stok</Label>\n                        <Input\n                          id=\"max_stock\"\n                          type=\"number\"\n                          value={formData.max_stock}\n                          onChange={(e) => setFormData({ ...formData, max_stock: e.target.value })}\n                          className=\"min-h-[44px] sm:min-h-0\"\n                        />\n                      </div>\n                      <div className=\"space-y-1.5 sm:space-y-2\">\n                        <Label htmlFor=\"location\" className=\"text-[11px] sm:text-xs\">Konum</Label>\n                        <Input\n                          id=\"location\"\n                          value={formData.location}\n                          onChange={(e) => setFormData({ ...formData, location: e.target.value })}\n                          className=\"min-h-[44px] sm:min-h-0\"\n                        />\n                      </div>\n                    </div>\n                  </CardContent>\n                </Card>\n              </form>\n            </div>\n          </div>\n        </div>\n      </DialogContent>\n    </Dialog>\n  );\n};\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\components\\Products\\ProductCard.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\components\\Products\\ProductDetailModal.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'isTeamLeader'. Either include it or remove the dependency array.","line":143,"column":6,"nodeType":"ArrayExpression","endLine":143,"endColumn":27,"suggestions":[{"desc":"Update the dependencies array to be: [user, open, isAdmin, isTeamLeader]","fix":{"range":[4899,4920],"text":"[user, open, isAdmin, isTeamLeader]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchRecipes'. Either include it or remove the dependency array.","line":150,"column":6,"nodeType":"ArrayExpression","endLine":150,"endColumn":32,"suggestions":[{"desc":"Update the dependencies array to be: [open, product, activeTab, fetchRecipes]","fix":{"range":[5058,5084],"text":"[open, product, activeTab, fetchRecipes]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from \"react\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogHeader,\n  DialogTitle,\n  DialogDescription,\n} from \"@/components/ui/dialog\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Package, Image as ImageIcon, Edit, Save, X, Loader2, Plus, Trash2, List } from \"lucide-react\";\nimport { toast } from \"sonner\";\nimport { updateProduct, addProductComment, getProductComments, getProductActivities, Product } from \"@/services/firebase/productService\";\nimport {\n  getProductRecipes,\n  addRecipeItem,\n  updateRecipeItem,\n  deleteRecipeItem,\n  RecipeWithMaterial,\n} from \"@/services/firebase/recipeService\";\nimport { getRawMaterials, RawMaterial } from \"@/services/firebase/materialService\";\nimport { useAuth } from \"@/contexts/AuthContext\";\nimport { canUpdateResource } from \"@/utils/permissions\";\nimport { UserProfile } from \"@/services/firebase/authService\";\nimport { ActivityCommentsPanel } from \"@/components/shared/ActivityCommentsPanel\";\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \"@/components/ui/table\";\n\nconst PRODUCT_CATEGORIES = [\n  \"Tanabilir G Paketleri\",\n  \"Kabin Tipi G Paketleri\",\n  \"Ara Tipi G Paketleri\",\n  \"Endstriyel G Paketleri\",\n  \"Gne Enerji Sistemleri\",\n] as const;\n\ninterface ProductDetailModalProps {\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n  product: Product;\n  onUpdate?: () => void;\n  onDelete?: () => void;\n}\n\nexport const ProductDetailModal = ({\n  open,\n  onOpenChange,\n  product,\n  onUpdate,\n  onDelete,\n}: ProductDetailModalProps) => {\n  const { user, isAdmin, isTeamLeader } = useAuth();\n  const [isEditing, setIsEditing] = useState(false);\n  const [loading, setLoading] = useState(false);\n  const [canUpdate, setCanUpdate] = useState(false);\n  const [canDelete, setCanDelete] = useState(false);\n  const [activeTab, setActiveTab] = useState(\"details\");\n  const [recipes, setRecipes] = useState<RecipeWithMaterial[]>([]);\n  const [materials, setMaterials] = useState<RawMaterial[]>([]);\n  const [selectedMaterial, setSelectedMaterial] = useState<string | null>(null);\n  const [newQuantity, setNewQuantity] = useState(\"\");\n  const [recipeLoading, setRecipeLoading] = useState(false);\n  const [formData, setFormData] = useState({\n    name: \"\",\n    sku: \"\",\n    description: \"\",\n    category: \"\",\n    stock: \"0\",\n    unit: \"Adet\",\n    price: \"\",\n    cost: \"\",\n    min_stock: \"0\",\n    max_stock: \"\",\n    location: \"\",\n  });\n\n  useEffect(() => {\n    if (product) {\n      setFormData({\n        name: product.name || \"\",\n        sku: product.sku || \"\",\n        description: product.description || \"\",\n        category: product.category || \"\",\n        stock: product.stock?.toString() || \"0\",\n        unit: product.unit || \"Adet\",\n        price: product.price?.toString() || \"\",\n        cost: product.cost?.toString() || \"\",\n        min_stock: product.minStock?.toString() || \"0\",\n        max_stock: product.maxStock?.toString() || \"\",\n        location: product.location || \"\",\n      });\n      setIsEditing(false);\n    }\n  }, [product, open]);\n\n  // Yetki kontrol\n  useEffect(() => {\n    const checkPermissions = async () => {\n      if (!user || !open) return;\n      \n      try {\n        const { getDepartments } = await import(\"@/services/firebase/departmentService\");\n        const departments = await getDepartments();\n        const userProfile: UserProfile = {\n          id: user.id,\n          email: user.email,\n          emailVerified: user.emailVerified,\n          fullName: user.fullName,\n          displayName: user.fullName,\n          phone: user.phone,\n          dateOfBirth: user.dateOfBirth,\n          role: user.roles || [],\n          createdAt: null,\n          updatedAt: null,\n        };\n        const { canDeleteResource } = await import(\"@/utils/permissions\");\n        const canUpdateProduct = await canUpdateResource(userProfile, \"products\");\n        const canDeleteProduct = await canDeleteResource(userProfile, \"products\");\n        setCanUpdate(canUpdateProduct || isAdmin || isTeamLeader || false);\n        setCanDelete(canDeleteProduct || isAdmin || isTeamLeader || false);\n      } catch (error) {\n        if (import.meta.env.DEV) {\n          console.error(\"Error checking product permissions:\", error);\n        }\n        setCanUpdate(isAdmin || isTeamLeader || false);\n        setCanDelete(isAdmin || isTeamLeader || false);\n      }\n    };\n    \n    checkPermissions();\n  }, [user, open, isAdmin]);\n\n  useEffect(() => {\n    if (open && product?.id && activeTab === \"recipe\") {\n      fetchRecipes();\n      fetchMaterials();\n    }\n  }, [open, product, activeTab]);\n\n  const fetchRecipes = async () => {\n    if (!product?.id) return;\n    try {\n      const recipesData = await getProductRecipes(product.id);\n      setRecipes(recipesData);\n    } catch (error: unknown) {\n      if (import.meta.env.DEV) {\n        console.error(\"Reete yklenirken hata:\", error);\n      }\n      const errorMessage = error instanceof Error ? error.message : \"Bilinmeyen hata\";\n      toast.error(\"Reeteler yklenemedi: \" + errorMessage);\n    }\n  };\n\n  const fetchMaterials = async () => {\n    try {\n      const materialsData = await getRawMaterials();\n      setMaterials(materialsData);\n    } catch (error: unknown) {\n      if (import.meta.env.DEV) {\n        console.error(\"Hammaddeler yklenirken hata:\", error);\n      }\n      const errorMessage = error instanceof Error ? error.message : \"Bilinmeyen hata\";\n      toast.error(\"Hammaddeler yklenemedi: \" + errorMessage);\n    }\n  };\n\n  const addMaterial = async () => {\n    if (!selectedMaterial || !newQuantity || !product?.id) {\n      toast.error(\"Ltfen hammadde ve miktar sein\");\n      return;\n    }\n\n    // Seilen hammaddenin silinmi olup olmadn kontrol et\n    const selectedMat = materials.find((m) => m.id === selectedMaterial);\n    if (!selectedMat) {\n      toast.error(\"Seilen hammadde bulunamad veya silinmi\");\n      return;\n    }\n\n    // Silinmi hammaddeleri eklemeyi engelle\n    if (selectedMat.deleted === true || selectedMat.isDeleted === true) {\n      toast.error(\"Silinmi hammaddeler reeteye eklenemez\");\n      return;\n    }\n\n    setRecipeLoading(true);\n    try {\n      await addRecipeItem(product.id, selectedMaterial, parseFloat(newQuantity));\n      toast.success(\"Hammadde eklendi\");\n      fetchRecipes();\n      setSelectedMaterial(null);\n      setNewQuantity(\"\");\n    } catch (error: unknown) {\n      const errorMessage = error instanceof Error ? error.message : \"Bilinmeyen hata\";\n      toast.error(\"Hata: \" + errorMessage);\n    } finally {\n      setRecipeLoading(false);\n    }\n  };\n\n  const removeMaterial = async (recipeId: string) => {\n    if (!confirm(\"Bu hammaddeyi reeteden karmak istediinizden emin misiniz?\"))\n      return;\n\n    try {\n      await deleteRecipeItem(recipeId);\n      toast.success(\"Hammadde karld\");\n      fetchRecipes();\n    } catch (error: unknown) {\n      const errorMessage = error instanceof Error ? error.message : \"Bilinmeyen hata\";\n      toast.error(\"Hata: \" + errorMessage);\n    }\n  };\n\n  const updateQuantity = async (recipeId: string, newQty: string) => {\n    if (!newQty || parseFloat(newQty) <= 0) return;\n\n    try {\n      await updateRecipeItem(recipeId, parseFloat(newQty));\n      toast.success(\"Miktar gncellendi\");\n      fetchRecipes();\n    } catch (error: unknown) {\n      const errorMessage = error instanceof Error ? error.message : \"Bilinmeyen hata\";\n      toast.error(\"Hata: \" + errorMessage);\n    }\n  };\n\n  const calculateTotalCost = () => {\n    return recipes.reduce((sum, recipe) => {\n      const material = recipe.rawMaterial;\n      return sum + (material?.cost || 0) * recipe.quantityPerUnit;\n    }, 0);\n  };\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    if (!product?.id || !user?.id) return;\n\n    // Yetki kontrol - canUpdate state'i henz yklenmemi olabilir, bu yzden tekrar kontrol et\n    const isCreator = product.createdBy === user.id;\n    let hasUpdatePermission = canUpdate;\n    \n    // Eer canUpdate henz yklenmemise, tekrar kontrol et\n    if (!hasUpdatePermission && !isCreator && !isAdmin && !isTeamLeader) {\n      try {\n        const { getDepartments } = await import(\"@/services/firebase/departmentService\");\n        const departments = await getDepartments();\n        const userProfile: UserProfile = {\n          id: user.id,\n          email: user.email,\n          emailVerified: user.emailVerified,\n          fullName: user.fullName,\n          displayName: user.fullName,\n          phone: user.phone,\n          dateOfBirth: user.dateOfBirth,\n          role: user.roles || [],\n          createdAt: null,\n          updatedAt: null,\n        };\n        hasUpdatePermission = await canUpdateResource(userProfile, \"products\");\n      } catch (error) {\n        // Hata durumunda devam et\n      }\n    }\n    \n    // Yetki kontrol - canUpdate state'i veya isCreator veya isAdmin veya isTeamLeader kontrol\n    if (!hasUpdatePermission && !isCreator && !isAdmin && !isTeamLeader) {\n      toast.error(\"rn dzenleme yetkiniz yok.\");\n      setIsEditing(false);\n      return;\n    }\n    \n    setLoading(true);\n    try {\n      await updateProduct(product.id, {\n        name: formData.name,\n        sku: formData.sku || null,\n        description: formData.description || null,\n        category: formData.category || null,\n        imageUrl: null,\n        image_url: null,\n        stock: parseInt(formData.stock) || 0,\n        unit: formData.unit,\n        price: formData.price ? parseFloat(formData.price) : null,\n        unitPrice: formData.price ? parseFloat(formData.price) : null,\n        cost: formData.cost ? parseFloat(formData.cost) : null,\n        minStock: parseInt(formData.min_stock) || 0,\n        maxStock: formData.max_stock ? parseInt(formData.max_stock) : null,\n        location: formData.location || null,\n      });\n\n      toast.success(\"rn baaryla gncellendi\");\n      setIsEditing(false);\n      onUpdate?.();\n    } catch (error: unknown) {\n      if (import.meta.env.DEV) console.error(\"Update product error:\", error);\n      const errorMessage = error instanceof Error ? error.message : \"Bilinmeyen hata\";\n      toast.error(errorMessage || \"rn gncellenirken hata olutu\");\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  if (!product) return null;\n\n  const getStatusVariant = (stock: number, minStock: number) => {\n    if (stock === 0) return \"destructive\";\n    if (stock <= minStock) return \"secondary\";\n    return \"default\";\n  };\n\n  const getStatusLabel = (stock: number, minStock: number) => {\n    if (stock === 0) return \"Tkendi\";\n    if (stock <= minStock) return \"Dk Stok\";\n    return \"Stokta\";\n  };\n\n  return (\n    <Dialog open={open} onOpenChange={onOpenChange}>\n      <DialogContent className=\"!max-w-[100vw] sm:!max-w-[95vw] md:!max-w-[85vw] !w-[100vw] sm:!w-[95vw] md:!w-[85vw] !h-[100vh] sm:!h-[90vh] md:!h-[80vh] !max-h-[100vh] sm:!max-h-[90vh] md:!max-h-[80vh] !left-0 sm:!left-[2.5vw] md:!left-[7.5vw] !top-0 sm:!top-[5vh] md:!top-[10vh] !right-0 sm:!right-auto !bottom-0 sm:!bottom-auto !translate-x-0 !translate-y-0 overflow-hidden !p-0 gap-0 bg-white flex flex-col !m-0 !rounded-none sm:!rounded-lg !border-0 sm:!border\">\n        {/* DialogTitle ve DialogDescription DialogContent'in direkt child' olmal (Radix UI gereksinimi) */}\n        <DialogTitle className=\"sr-only\">\n          {product.name} - rn Detay\n        </DialogTitle>\n        <DialogDescription className=\"sr-only\">\n          rn detaylar ve bilgileri\n        </DialogDescription>\n        \n        <div className=\"flex flex-col h-full min-h-0\">\n          <DialogHeader className=\"p-3 sm:p-4 border-b bg-white flex-shrink-0\">\n            <div className=\"flex items-center justify-between gap-3\">\n              <div className=\"flex items-center gap-2 sm:gap-3 flex-1 min-w-0\">\n                <div className=\"h-8 w-8 sm:h-10 sm:w-10 rounded-lg bg-primary/10 flex items-center justify-center border border-primary/20 flex-shrink-0\">\n                  <Package className=\"h-4 w-4 sm:h-5 sm:w-5 text-primary\" />\n                </div>\n                <h2 className=\"text-xl sm:text-2xl font-semibold text-foreground truncate\">\n                  {product.name}\n                </h2>\n              </div>\n              <div className=\"flex flex-wrap items-center gap-2 flex-shrink-0 relative z-10 pr-10 sm:pr-12\">\n                <Badge variant={getStatusVariant(product.stock, product.minStock)} className=\"text-xs px-2 sm:px-3 py-1 relative z-10\">\n                  {getStatusLabel(product.stock, product.minStock)}\n                </Badge>\n                {!isEditing ? (\n                  <>\n                    {(canUpdate || product.createdBy === user?.id) && (\n                      <Button\n                        variant=\"outline\"\n                        size=\"sm\"\n                        onClick={() => setIsEditing(true)}\n                        className=\"min-h-[44px] sm:min-h-0\"\n                      >\n                        <Edit className=\"h-4 w-4 mr-2\" />\n                        Dzenle\n                      </Button>\n                    )}\n                    {canDelete && onDelete && (\n                      <Button\n                        variant=\"outline\"\n                        size=\"sm\"\n                        onClick={onDelete}\n                        className=\"min-h-[44px] sm:min-h-0 text-destructive hover:text-destructive\"\n                      >\n                        <Trash2 className=\"h-4 w-4 mr-2\" />\n                        Sil\n                      </Button>\n                    )}\n                  </>\n                ) : (\n                  <div className=\"flex gap-2\">\n                    <Button\n                      variant=\"outline\"\n                      size=\"sm\"\n                      onClick={() => {\n                        setIsEditing(false);\n                        // Form verilerini sfrla\n                        if (product) {\n                          setFormData({\n                            name: product.name || \"\",\n                            sku: product.sku || \"\",\n                            description: product.description || \"\",\n                            category: product.category || \"\",\n                            stock: product.stock?.toString() || \"0\",\n                            unit: product.unit || \"Adet\",\n                            price: product.price?.toString() || \"\",\n                            cost: product.cost?.toString() || \"\",\n                            min_stock: product.minStock?.toString() || \"0\",\n                            max_stock: product.maxStock?.toString() || \"\",\n                            location: product.location || \"\",\n                          });\n                        }\n                      }}\n                      disabled={loading}\n                      className=\"min-h-[44px] sm:min-h-0\"\n                    >\n                      <X className=\"h-4 w-4 mr-2\" />\n                      ptal\n                    </Button>\n                    <Button\n                      size=\"sm\"\n                      onClick={handleSubmit}\n                      disabled={loading}\n                      className=\"min-h-[44px] sm:min-h-0\"\n                    >\n                      {loading ? (\n                        <>\n                          <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />\n                          Kaydediliyor...\n                        </>\n                      ) : (\n                        <>\n                          <Save className=\"h-4 w-4 mr-2\" />\n                          Kaydet\n                        </>\n                      )}\n                    </Button>\n                  </div>\n                )}\n              </div>\n            </div>\n          </DialogHeader>\n\n          <div className=\"flex-1 overflow-hidden bg-gray-50/50 p-3 sm:p-4 min-h-0\">\n            <div className=\"max-w-full mx-auto h-full overflow-y-auto\">\n              {isEditing ? (\n                <form onSubmit={handleSubmit} className=\"space-y-4 sm:space-y-6\">\n                  <Card>\n                    <CardHeader>\n                      <CardTitle className=\"text-lg sm:text-xl font-semibold\">Temel Bilgiler</CardTitle>\n                    </CardHeader>\n                    <CardContent className=\"space-y-4\">\n                      <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4\">\n                        <div className=\"space-y-2\">\n                          <Label htmlFor=\"name\" className=\"text-sm sm:text-base\">rn Ad</Label>\n                          <Input\n                            id=\"name\"\n                            value={formData.name}\n                            onChange={(e) => setFormData({ ...formData, name: e.target.value })}\n                            className=\"min-h-[44px] sm:min-h-0\"\n                            required\n                          />\n                        </div>\n                        <div className=\"space-y-2\">\n                          <Label htmlFor=\"sku\" className=\"text-sm sm:text-base\">SKU</Label>\n                          <Input\n                            id=\"sku\"\n                            value={formData.sku}\n                            onChange={(e) => setFormData({ ...formData, sku: e.target.value })}\n                            className=\"min-h-[44px] sm:min-h-0\"\n                            required\n                          />\n                        </div>\n                      </div>\n\n                      <div className=\"space-y-2\">\n                        <Label htmlFor=\"description\" className=\"text-sm sm:text-base\">Aklama</Label>\n                        <Textarea\n                          id=\"description\"\n                          value={formData.description}\n                          onChange={(e) => setFormData({ ...formData, description: e.target.value })}\n                          rows={3}\n                          className=\"min-h-[44px] sm:min-h-0\"\n                        />\n                      </div>\n\n                      <div className=\"grid grid-cols-1 sm:grid-cols-3 gap-3 sm:gap-4\">\n                        <div className=\"space-y-2\">\n                          <Label htmlFor=\"category\" className=\"text-sm sm:text-base\">Kategori</Label>\n                          <Select value={formData.category ? formData.category : \"none\"} onValueChange={(value) => setFormData({ ...formData, category: value === \"none\" ? \"\" : value })}>\n                            <SelectTrigger className=\"min-h-[44px] sm:min-h-0\">\n                              <SelectValue placeholder=\"Kategori sein\" />\n                            </SelectTrigger>\n                            <SelectContent>\n                              <SelectItem value=\"none\">Kategori Yok</SelectItem>\n                              {PRODUCT_CATEGORIES.map((cat) => (\n                                <SelectItem key={cat} value={cat}>\n                                  {cat}\n                                </SelectItem>\n                              ))}\n                            </SelectContent>\n                          </Select>\n                        </div>\n                        <div className=\"space-y-2\">\n                          <Label htmlFor=\"stock\" className=\"text-sm sm:text-base\">Stok</Label>\n                          <Input\n                            id=\"stock\"\n                            type=\"number\"\n                            value={formData.stock}\n                            onChange={(e) => setFormData({ ...formData, stock: e.target.value })}\n                            className=\"min-h-[44px] sm:min-h-0\"\n                            required\n                          />\n                        </div>\n                        <div className=\"space-y-2\">\n                          <Label htmlFor=\"unit\" className=\"text-sm sm:text-base\">Birim</Label>\n                          <Select value={formData.unit ? formData.unit : \"\"} onValueChange={(value) => setFormData({ ...formData, unit: value })}>\n                            <SelectTrigger className=\"min-h-[44px] sm:min-h-0\">\n                              <SelectValue />\n                            </SelectTrigger>\n                            <SelectContent>\n                              <SelectItem value=\"Adet\">Adet</SelectItem>\n                              <SelectItem value=\"Kg\">Kg</SelectItem>\n                              <SelectItem value=\"Lt\">Lt</SelectItem>\n                              <SelectItem value=\"Mt\">Mt</SelectItem>\n                              <SelectItem value=\"M2\">M</SelectItem>\n                            </SelectContent>\n                          </Select>\n                        </div>\n                      </div>\n\n                      <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4\">\n                        <div className=\"space-y-2\">\n                          <Label htmlFor=\"price\" className=\"text-sm sm:text-base\">Sat Fiyat</Label>\n                          <Input\n                            id=\"price\"\n                            type=\"number\"\n                            step=\"0.01\"\n                            value={formData.price}\n                            onChange={(e) => setFormData({ ...formData, price: e.target.value })}\n                            className=\"min-h-[44px] sm:min-h-0\"\n                          />\n                        </div>\n                        <div className=\"space-y-2\">\n                          <Label htmlFor=\"cost\" className=\"text-sm sm:text-base\">Maliyet</Label>\n                          <Input\n                            id=\"cost\"\n                            type=\"number\"\n                            step=\"0.01\"\n                            value={formData.cost}\n                            onChange={(e) => setFormData({ ...formData, cost: e.target.value })}\n                            className=\"min-h-[44px] sm:min-h-0\"\n                          />\n                        </div>\n                      </div>\n\n                      <div className=\"grid grid-cols-1 sm:grid-cols-3 gap-3 sm:gap-4\">\n                        <div className=\"space-y-2\">\n                          <Label htmlFor=\"min_stock\" className=\"text-sm sm:text-base\">Min. Stok</Label>\n                          <Input\n                            id=\"min_stock\"\n                            type=\"number\"\n                            value={formData.min_stock}\n                            onChange={(e) => setFormData({ ...formData, min_stock: e.target.value })}\n                            className=\"min-h-[44px] sm:min-h-0\"\n                          />\n                        </div>\n                        <div className=\"space-y-2\">\n                          <Label htmlFor=\"max_stock\" className=\"text-sm sm:text-base\">Max. Stok</Label>\n                          <Input\n                            id=\"max_stock\"\n                            type=\"number\"\n                            value={formData.max_stock}\n                            onChange={(e) => setFormData({ ...formData, max_stock: e.target.value })}\n                            className=\"min-h-[44px] sm:min-h-0\"\n                          />\n                        </div>\n                        <div className=\"space-y-2\">\n                          <Label htmlFor=\"location\" className=\"text-sm sm:text-base\">Konum</Label>\n                          <Input\n                            id=\"location\"\n                            value={formData.location}\n                            onChange={(e) => setFormData({ ...formData, location: e.target.value })}\n                            className=\"min-h-[44px] sm:min-h-0\"\n                          />\n                        </div>\n                      </div>\n                    </CardContent>\n                  </Card>\n                </form>\n              ) : (\n                <Tabs value={activeTab} onValueChange={setActiveTab} className=\"w-full\">\n                  <TabsList className=\"grid w-full grid-cols-2 mb-4 sm:mb-6\">\n                    <TabsTrigger value=\"details\" className=\"min-h-[44px] sm:min-h-0\">Detaylar</TabsTrigger>\n                    <TabsTrigger value=\"recipe\" className=\"min-h-[44px] sm:min-h-0\">Reete</TabsTrigger>\n                  </TabsList>\n                  <TabsContent value=\"details\" className=\"space-y-4 sm:space-y-6 mt-0\">\n                    <div className=\"space-y-4 sm:space-y-6\">\n                  {/* Grsel */}\n                  {product.image_url && (\n                    <Card>\n                      <CardContent className=\"pt-6\">\n                        <div className=\"flex justify-center\">\n                          <div className=\"relative w-full max-w-md h-64 rounded-lg overflow-hidden border border-border bg-muted\">\n                            <img\n                              src={(() => {\n                                if (!product.image_url) return '';\n                                if (product.image_url.startsWith('http://') || product.image_url.startsWith('https://')) {\n                                  return product.image_url;\n                                }\n                                const baseUrl = import.meta.env.VITE_API_URL?.replace('/api', '') || 'http://localhost:3000';\n                                const cleanPath = product.image_url.startsWith('/') ? product.image_url : `/${product.image_url}`;\n                                return `${baseUrl}${cleanPath}`;\n                              })()}\n                              alt={product.name}\n                              className=\"w-full h-full object-cover\"\n                              width={448}\n                              height={256}\n                              loading=\"lazy\"\n                              decoding=\"async\"\n                              onError={(e) => {\n                                e.currentTarget.style.display = 'none';\n                                const fallback = e.currentTarget.nextElementSibling as HTMLElement;\n                                if (fallback) fallback.classList.remove('hidden');\n                              }}\n                            />\n                            <div className=\"hidden w-full h-full items-center justify-center bg-muted\">\n                              <ImageIcon className=\"h-16 w-16 text-muted-foreground\" />\n                            </div>\n                          </div>\n                        </div>\n                      </CardContent>\n                    </Card>\n                  )}\n\n                  {/* Temel Bilgiler */}\n                  <Card>\n                    <CardHeader>\n                      <CardTitle className=\"text-lg sm:text-xl font-semibold\">Temel Bilgiler</CardTitle>\n                    </CardHeader>\n                    <CardContent>\n                      <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4\">\n                        <div className=\"rounded-lg border bg-muted/30 px-3 py-2\">\n                          <p className=\"text-xs sm:text-sm text-muted-foreground mb-1\">SKU</p>\n                          <p className=\"font-medium font-mono text-sm sm:text-base\">{product.sku || \"-\"}</p>\n                        </div>\n                        {product.category && (\n                          <div className=\"rounded-lg border bg-muted/30 px-3 py-2\">\n                            <p className=\"text-xs sm:text-sm text-muted-foreground mb-1\">Kategori</p>\n                            <Badge variant=\"outline\" className=\"font-normal\">\n                              {product.category}\n                            </Badge>\n                          </div>\n                        )}\n                        <div className=\"rounded-lg border bg-muted/30 px-3 py-2\">\n                          <p className=\"text-xs sm:text-sm text-muted-foreground mb-1\">Mevcut Stok</p>\n                          <p className=\"font-medium text-base sm:text-lg\">\n                            {product.stock || 0} {product.unit || \"Adet\"}\n                          </p>\n                        </div>\n                        <div className=\"rounded-lg border bg-muted/30 px-3 py-2\">\n                          <p className=\"text-xs sm:text-sm text-muted-foreground mb-1\">Durum</p>\n                          <Badge variant={getStatusVariant(product.stock || 0, product.minStock || 0)}>\n                            {getStatusLabel(product.stock || 0, product.minStock || 0)}\n                          </Badge>\n                        </div>\n                        {product.price && (\n                          <div className=\"rounded-lg border bg-muted/30 px-3 py-2\">\n                            <p className=\"text-xs sm:text-sm text-muted-foreground mb-1\">Sat Fiyat</p>\n                            <p className=\"font-semibold text-base sm:text-lg\">\n                              {new Intl.NumberFormat(\"tr-TR\", {\n                                minimumFractionDigits: 0,\n                                maximumFractionDigits: 0,\n                              }).format(product.price || 0)}\n                            </p>\n                          </div>\n                        )}\n                        {product.cost && (\n                          <div className=\"rounded-lg border bg-muted/30 px-3 py-2\">\n                            <p className=\"text-xs sm:text-sm text-muted-foreground mb-1\">Maliyet</p>\n                            <p className=\"font-medium text-sm sm:text-base\">\n                              {new Intl.NumberFormat(\"tr-TR\", {\n                                minimumFractionDigits: 0,\n                                maximumFractionDigits: 0,\n                              }).format(product.cost || 0)}\n                            </p>\n                          </div>\n                        )}\n                        <div className=\"rounded-lg border bg-muted/30 px-3 py-2\">\n                          <p className=\"text-xs sm:text-sm text-muted-foreground mb-1\">Minimum Stok</p>\n                          <p className=\"font-medium text-sm sm:text-base\">\n                            {product.minStock || 0} {product.unit || \"Adet\"}\n                          </p>\n                        </div>\n                        {product.maxStock && (\n                          <div className=\"rounded-lg border bg-muted/30 px-3 py-2\">\n                            <p className=\"text-xs sm:text-sm text-muted-foreground mb-1\">Maksimum Stok</p>\n                            <p className=\"font-medium text-sm sm:text-base\">\n                              {product.maxStock} {product.unit || \"Adet\"}\n                            </p>\n                          </div>\n                        )}\n                        {product.location && (\n                          <div className=\"rounded-lg border bg-muted/30 px-3 py-2\">\n                            <p className=\"text-xs sm:text-sm text-muted-foreground mb-1\">Konum</p>\n                            <p className=\"font-medium text-sm sm:text-base\">{product.location}</p>\n                          </div>\n                        )}\n                      </div>\n                    </CardContent>\n                  </Card>\n\n                  {/* Aklama */}\n                  {product.description && (\n                    <Card>\n                      <CardHeader>\n                        <CardTitle className=\"text-lg sm:text-xl font-semibold\">Aklama</CardTitle>\n                      </CardHeader>\n                      <CardContent>\n                        <p className=\"text-sm sm:text-base whitespace-pre-wrap\">{product.description}</p>\n                      </CardContent>\n                    </Card>\n                  )}\n                    </div>\n                  </TabsContent>\n                  <TabsContent value=\"recipe\" className=\"space-y-4 sm:space-y-6 mt-0\">\n                    <Card>\n                      <CardHeader>\n                        <CardTitle className=\"text-lg sm:text-xl font-semibold\">Reete Ynetimi</CardTitle>\n                      </CardHeader>\n                      <CardContent className=\"space-y-6\">\n                        {/* Mevcut Reete */}\n                        <div>\n                          <h4 className=\"font-medium mb-3 text-sm sm:text-base\">Hammadde Listesi</h4>\n                          {recipes.length === 0 ? (\n                            <p className=\"text-muted-foreground text-center py-8 text-sm sm:text-base\">\n                              Henz hammadde eklenmemi\n                            </p>\n                          ) : (\n                            <>\n                              <div className=\"overflow-x-auto -mx-4 sm:mx-0\">\n                                <div className=\"inline-block min-w-full align-middle px-4 sm:px-0\">\n                                  <Table className=\"w-full\">\n                                    <TableHeader>\n                                      <TableRow>\n                                        <TableHead>Hammadde</TableHead>\n                                        <TableHead>Miktar (Birim retim iin)</TableHead>\n                                        <TableHead>Mevcut Stok</TableHead>\n                                        <TableHead>Birim Maliyet</TableHead>\n                                        <TableHead>Toplam Maliyet</TableHead>\n                                        <TableHead className=\"w-[80px]\">lem</TableHead>\n                                      </TableRow>\n                                    </TableHeader>\n                                    <TableBody>\n                                      {recipes\n                                        .filter((recipe) => recipe.rawMaterial) // Sadece hammadde bilgisi olan reeteleri gster\n                                        .map((recipe) => {\n                                        const material = recipe.rawMaterial;\n                                          if (!material) return null; // Gvenlik kontrol\n                                        return (\n                                          <TableRow key={recipe.id}>\n                                            <TableCell className=\"font-medium\">\n                                                {material.name}\n                                            </TableCell>\n                                            <TableCell>\n                                              <div className=\"flex items-center gap-2\">\n                                                <Input\n                                                  type=\"number\"\n                                                  step=\"0.01\"\n                                                  value={recipe.quantityPerUnit}\n                                                  onChange={(e) =>\n                                                    updateQuantity(recipe.id, e.target.value)\n                                                  }\n                                                  className=\"w-24 min-h-[44px] sm:min-h-0\"\n                                                />\n                                                <span className=\"text-sm text-muted-foreground\">\n                                                    {material.unit}\n                                                </span>\n                                              </div>\n                                            </TableCell>\n                                            <TableCell>\n                                                {material.stock} {material.unit}\n                                            </TableCell>\n                                            <TableCell>\n                                              {new Intl.NumberFormat(\"tr-TR\", {\n                                                minimumFractionDigits: 0,\n                                                maximumFractionDigits: 0,\n                                                }).format(material.cost || 0)}\n                                            </TableCell>\n                                            <TableCell>\n                                              {new Intl.NumberFormat(\"tr-TR\", {\n                                                minimumFractionDigits: 0,\n                                                maximumFractionDigits: 0,\n                                                }).format((material.cost || 0) * recipe.quantityPerUnit)}\n                                            </TableCell>\n                                            <TableCell>\n                                              <Button\n                                                variant=\"ghost\"\n                                                size=\"sm\"\n                                                onClick={() => removeMaterial(recipe.id)}\n                                                className=\"min-h-[44px] sm:min-h-0\"\n                                              >\n                                                <Trash2 className=\"h-4 w-4 text-destructive\" />\n                                              </Button>\n                                            </TableCell>\n                                          </TableRow>\n                                        );\n                                      })}\n                                    </TableBody>\n                                  </Table>\n                                </div>\n                              </div>\n                              <div className=\"flex justify-end mt-3 pt-3 border-t\">\n                                <div className=\"text-right\">\n                                  <p className=\"text-sm text-muted-foreground\">\n                                    Toplam Hammadde Maliyeti (Birim)\n                                  </p>\n                                  <p className=\"text-xl sm:text-2xl font-bold\">\n                                    {new Intl.NumberFormat(\"tr-TR\", {\n                                      minimumFractionDigits: 0,\n                                      maximumFractionDigits: 0,\n                                    }).format(calculateTotalCost() || 0)}\n                                  </p>\n                                </div>\n                              </div>\n                            </>\n                          )}\n                        </div>\n\n                        {/* Yeni Hammadde Ekle */}\n                        <div className=\"border-t pt-4\">\n                          <h4 className=\"font-medium mb-3 text-sm sm:text-base\">Yeni Hammadde Ekle</h4>\n                          <div className=\"flex flex-col sm:flex-row gap-3\">\n                            <div className=\"flex-1\">\n                              <Label className=\"text-sm sm:text-base\">Hammadde</Label>\n                              <Select\n                                value={selectedMaterial ?? undefined}\n                                onValueChange={setSelectedMaterial}\n                              >\n                                <SelectTrigger className=\"min-h-[44px] sm:min-h-0\">\n                                  <SelectValue placeholder=\"Hammadde sein...\" />\n                                </SelectTrigger>\n                                <SelectContent className=\"max-h-[400px]\">\n                                  {materials.map((m) => (\n                                    <SelectItem key={m.id} value={m.id}>\n                                      {m.name} ({m.currentStock} {m.unit} - {new Intl.NumberFormat(\"tr-TR\", {\n                                        minimumFractionDigits: 0,\n                                        maximumFractionDigits: 0,\n                                      }).format(m.unitPrice || 0)}/{m.unit})\n                                    </SelectItem>\n                                  ))}\n                                </SelectContent>\n                              </Select>\n                            </div>\n                            <div className=\"w-full sm:w-32\">\n                              <Label className=\"text-sm sm:text-base\">Miktar</Label>\n                              <Input\n                                type=\"number\"\n                                step=\"1\"\n                                min=\"0\"\n                                placeholder=\"Miktar\"\n                                value={newQuantity}\n                                onChange={(e) => setNewQuantity(e.target.value)}\n                                className=\"min-h-[44px] sm:min-h-0\"\n                              />\n                            </div>\n                            <div className=\"flex items-end\">\n                              <Button onClick={addMaterial} disabled={recipeLoading} className=\"w-full sm:w-auto min-h-[44px] sm:min-h-0\">\n                                <Plus className=\"mr-2 h-4 w-4\" />\n                                Ekle\n                              </Button>\n                            </div>\n                          </div>\n                        </div>\n                      </CardContent>\n                    </Card>\n                  </TabsContent>\n                </Tabs>\n              )}\n            </div>\n          </div>\n        </div>\n        \n        {/* Activity Comments Panel */}\n        {product?.id && user && (\n          <ActivityCommentsPanel\n            entityId={product.id}\n            entityType=\"product\"\n            onAddComment={async (content: string) => {\n              await addProductComment(\n                product.id,\n                user.id,\n                content,\n                user.fullName,\n                user.email\n              );\n            }}\n            onGetComments={async () => {\n              return await getProductComments(product.id);\n            }}\n            onGetActivities={async () => {\n              return await getProductActivities(product.id);\n            }}\n            currentUserId={user.id}\n            currentUserName={user.fullName}\n            currentUserEmail={user.email}\n          />\n        )}\n      </DialogContent>\n    </Dialog>\n  );\n};\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\components\\Products\\ProductRecipeDialog.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchRecipes'. Either include it or remove the dependency array.","line":55,"column":6,"nodeType":"ArrayExpression","endLine":55,"endColumn":21,"suggestions":[{"desc":"Update the dependencies array to be: [fetchRecipes, open, product]","fix":{"range":[1557,1572],"text":"[fetchRecipes, open, product]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from \"react\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogDescription } from \"@/components/ui/dialog\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { toast } from \"sonner\";\nimport {\n  getProductRecipes,\n  addRecipeItem,\n  updateRecipeItem,\n  deleteRecipeItem,\n  RecipeWithMaterial,\n} from \"@/services/firebase/recipeService\";\nimport { getRawMaterials, RawMaterial } from \"@/services/firebase/materialService\";\nimport { Product } from \"@/services/firebase/productService\";\nimport { Plus, Trash2 } from \"lucide-react\";\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \"@/components/ui/table\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\n\ninterface ProductRecipeDialogProps {\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n  product: Product;\n}\n\nexport const ProductRecipeDialog = ({\n  open,\n  onOpenChange,\n  product,\n}: ProductRecipeDialogProps) => {\n  const [recipes, setRecipes] = useState<RecipeWithMaterial[]>([]);\n  const [materials, setMaterials] = useState<RawMaterial[]>([]);\n  const [selectedMaterial, setSelectedMaterial] = useState<string | null>(null);\n  const [newQuantity, setNewQuantity] = useState(\"\");\n  const [loading, setLoading] = useState(false);\n\n  useEffect(() => {\n    if (open && product?.id) {\n      fetchRecipes();\n      fetchMaterials();\n    }\n  }, [open, product]);\n\n  const fetchRecipes = async () => {\n    try {\n      const recipesData = await getProductRecipes(product.id);\n      setRecipes(recipesData);\n    } catch (error: unknown) {\n      // Sadece development'ta log gster\n      if (import.meta.env.DEV) {\n        console.error(\"Reete yklenirken hata:\", error);\n      }\n      toast.error(\"Reeteler yklenemedi: \" + (error instanceof Error ? error.message : String(error)));\n    }\n  };\n\n  const fetchMaterials = async () => {\n    try {\n      const materialsData = await getRawMaterials();\n      setMaterials(materialsData);\n    } catch (error: unknown) {\n      // Sadece development'ta log gster\n      if (import.meta.env.DEV) {\n        console.error(\"Hammaddeler yklenirken hata:\", error);\n      }\n      toast.error(\"Hammaddeler yklenemedi: \" + (error instanceof Error ? error.message : String(error)));\n    }\n  };\n\n  const addMaterial = async () => {\n    if (!selectedMaterial || !newQuantity) {\n      toast.error(\"Ltfen hammadde ve miktar sein\");\n      return;\n    }\n\n    // Seilen hammaddenin silinmi olup olmadn kontrol et\n    const selectedMat = materials.find((m) => m.id === selectedMaterial);\n    if (!selectedMat) {\n      toast.error(\"Seilen hammadde bulunamad veya silinmi\");\n      return;\n    }\n\n    // Silinmi hammaddeleri eklemeyi engelle\n    if (selectedMat.deleted === true || selectedMat.isDeleted === true) {\n      toast.error(\"Silinmi hammaddeler reeteye eklenemez\");\n      return;\n    }\n\n    setLoading(true);\n    try {\n      await addRecipeItem(product.id, selectedMaterial, parseFloat(newQuantity));\n      toast.success(\"Hammadde eklendi\");\n      fetchRecipes();\n      setSelectedMaterial(null);\n      setNewQuantity(\"\");\n    } catch (error: unknown) {\n      toast.error(\"Hata: \" + (error instanceof Error ? error.message : String(error)));\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const removeMaterial = async (recipeId: string) => {\n    if (!confirm(\"Bu hammaddeyi reeteden karmak istediinizden emin misiniz?\"))\n      return;\n\n    try {\n      await deleteRecipeItem(recipeId);\n      toast.success(\"Hammadde karld\");\n      fetchRecipes();\n    } catch (error: unknown) {\n      toast.error(\"Hata: \" + (error instanceof Error ? error.message : String(error)));\n    }\n  };\n\n  const updateQuantity = async (recipeId: string, newQty: string) => {\n    if (!newQty || parseFloat(newQty) <= 0) return;\n\n    try {\n      await updateRecipeItem(recipeId, parseFloat(newQty));\n      toast.success(\"Miktar gncellendi\");\n      fetchRecipes();\n    } catch (error: unknown) {\n      toast.error(\"Hata: \" + (error instanceof Error ? error.message : String(error)));\n    }\n  };\n\n  const calculateTotalCost = () => {\n    return recipes.reduce((sum, recipe) => {\n      const material = recipe.rawMaterial;\n      return sum + (material?.cost || 0) * recipe.quantityPerUnit;\n    }, 0);\n  };\n\n  return (\n    <Dialog open={open} onOpenChange={onOpenChange}>\n      <DialogContent className=\"max-w-4xl w-[80vw] max-h-[90vh] overflow-y-auto\">\n        <DialogHeader>\n          <DialogTitle>{product.name} - Reete Ynetimi</DialogTitle>\n          <DialogDescription>rn reetesini dzenleyin ve hammaddeleri ynetin</DialogDescription>\n        </DialogHeader>\n\n        <div className=\"space-y-6\">\n          {/* Mevcut Reete */}\n          <div>\n            <h4 className=\"font-medium mb-3\">Hammadde Listesi</h4>\n            {recipes.length === 0 ? (\n              <p className=\"text-muted-foreground text-center py-8\">\n                Henz hammadde eklenmemi\n              </p>\n            ) : (\n              <>\n                <Table>\n                  <TableHeader>\n                    <TableRow>\n                      <TableHead>Hammadde</TableHead>\n                      <TableHead>Miktar (Birim retim iin)</TableHead>\n                      <TableHead>Mevcut Stok</TableHead>\n                      <TableHead>Birim Maliyet</TableHead>\n                      <TableHead>Toplam Maliyet</TableHead>\n                      <TableHead className=\"w-[80px]\">lem</TableHead>\n                    </TableRow>\n                  </TableHeader>\n                  <TableBody>\n                    {recipes\n                      .filter((recipe) => recipe.rawMaterial) // Sadece hammadde bilgisi olan reeteleri gster\n                      .map((recipe) => {\n                        const material = recipe.rawMaterial;\n                        if (!material) return null; // Gvenlik kontrol\n                        return (\n                          <TableRow key={recipe.id}>\n                            <TableCell className=\"font-medium\">\n                              {material.name}\n                            </TableCell>\n                            <TableCell>\n                              <div className=\"flex items-center gap-2\">\n                                <Input\n                                  type=\"number\"\n                                  step=\"0.01\"\n                                  value={recipe.quantityPerUnit}\n                                  onChange={(e) =>\n                                    updateQuantity(recipe.id, e.target.value)\n                                  }\n                                  className=\"w-24\"\n                                />\n                                <span className=\"text-[11px] sm:text-xs text-muted-foreground\">\n                                  {material.unit}\n                                </span>\n                              </div>\n                            </TableCell>\n                            <TableCell>\n                              {material.stock} {material.unit}\n                            </TableCell>\n                            <TableCell>{material.cost || 0}</TableCell>\n                            <TableCell>\n                              {((material.cost || 0) * recipe.quantityPerUnit).toFixed(2)}\n                            </TableCell>\n                            <TableCell>\n                              <Button\n                                variant=\"ghost\"\n                                size=\"sm\"\n                                onClick={() => removeMaterial(recipe.id)}\n                              >\n                                <Trash2 className=\"h-4 w-4 text-destructive\" />\n                              </Button>\n                            </TableCell>\n                          </TableRow>\n                        );\n                      })}\n                  </TableBody>\n                </Table>\n                <div className=\"flex justify-end mt-3 pt-3 border-t\">\n                  <div className=\"text-right\">\n                    <p className=\"text-[11px] sm:text-xs text-muted-foreground\">\n                      Toplam Hammadde Maliyeti (Birim)\n                    </p>\n                    <p className=\"text-[11px] sm:text-xs font-bold\">\n                      {(calculateTotalCost() || 0).toFixed(2)}\n                    </p>\n                  </div>\n                </div>\n              </>\n            )}\n          </div>\n\n          {/* Yeni Hammadde Ekle */}\n          <div className=\"border-t pt-4\">\n            <h4 className=\"font-medium mb-3\">Yeni Hammadde Ekle</h4>\n            <div className=\"flex gap-3\">\n              <div className=\"flex-1\">\n                <Label>Hammadde</Label>\n                <Select\n                  value={selectedMaterial ?? undefined}\n                  onValueChange={setSelectedMaterial}\n                >\n                  <SelectTrigger>\n                    <SelectValue placeholder=\"Hammadde sein...\" />\n                  </SelectTrigger>\n                  <SelectContent className=\"max-h-[400px]\">\n                    {materials.map((m) => (\n                      <SelectItem key={m.id} value={m.id}>\n                        {m.name} ({m.currentStock} {m.unit} - {m.unitPrice || 0}/{m.unit})\n                      </SelectItem>\n                    ))}\n                  </SelectContent>\n                </Select>\n              </div>\n              <div className=\"w-32\">\n                <Label>Miktar</Label>\n                <Input\n                  type=\"number\"\n                  step=\"1\"\n                  min=\"0\"\n                  placeholder=\"Miktar\"\n                  value={newQuantity}\n                  onChange={(e) => setNewQuantity(e.target.value)}\n                />\n              </div>\n              <div className=\"flex items-end\">\n                <Button onClick={addMaterial} disabled={loading}>\n                  <Plus className=\"mr-2 h-4 w-4\" />\n                  Ekle\n                </Button>\n              </div>\n            </div>\n          </div>\n        </div>\n      </DialogContent>\n    </Dialog>\n  );\n};\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\components\\ProtectedRoute.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\components\\RawMaterials\\CreateRawMaterialDialog.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'defaultFormData'. Either include it or remove the dependency array.","line":94,"column":6,"nodeType":"ArrayExpression","endLine":94,"endColumn":12,"suggestions":[{"desc":"Update the dependencies array to be: [defaultFormData, open]","fix":{"range":[3296,3302],"text":"[defaultFormData, open]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from \"react\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogDescription } from \"@/components/ui/dialog\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport { toast } from \"sonner\";\nimport { createRawMaterial } from \"@/services/firebase/materialService\";\nimport { getRawMaterialCategories, createRawMaterialCategory, RawMaterialCategory } from \"@/services/firebase/materialCategoryService\";\nimport { useAuth } from \"@/contexts/AuthContext\";\nimport { handleErrorToast } from \"@/utils/toastHelpers\";\nimport { CURRENCY_OPTIONS, CURRENCY_SYMBOLS, DEFAULT_CURRENCY, Currency } from \"@/utils/currency\";\nimport { getAllUsers, UserProfile } from \"@/services/firebase/authService\";\nimport { Package, Loader2, X, Save, AlertTriangle, DollarSign, Warehouse, ShoppingCart, MapPin, Link2, Building2, User, FileText, Plus } from \"lucide-react\";\n\ninterface CreateRawMaterialDialogProps {\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n  onSuccess: () => void;\n}\n\nexport const CreateRawMaterialDialog = ({\n  open,\n  onOpenChange,\n  onSuccess,\n}: CreateRawMaterialDialogProps) => {\n  const { user, isAdmin, isTeamLeader } = useAuth();\n  const [loading, setLoading] = useState(false);\n  const [users, setUsers] = useState<UserProfile[]>([]);\n  const [usersLoading, setUsersLoading] = useState(false);\n  const [categories, setCategories] = useState<RawMaterialCategory[]>([]);\n  const [categoriesLoading, setCategoriesLoading] = useState(false);\n  const [newCategoryDialogOpen, setNewCategoryDialogOpen] = useState(false);\n  const [newCategoryName, setNewCategoryName] = useState(\"\");\n  const [newCategoryLoading, setNewCategoryLoading] = useState(false);\n\n  const defaultFormData = {\n    name: \"\",\n    sku: \"\",\n    category: \"other\",\n    stock: \"0\",\n    min_stock: \"0\",\n    unit: \"Adet\",\n    unitPrice: \"0\",\n    vatRate: \"0\", // KDV yzdesi\n    totalPrice: \"0\",\n    currency: DEFAULT_CURRENCY,\n    brand: \"\",\n    link: \"\",\n    supplier: \"\",\n    purchasedBy: \"\",\n    location: \"\",\n    description: \"\",\n  };\n\n  const [formData, setFormData] = useState(defaultFormData);\n\n  // KDV ve birim fiyat deitiinde nihai fiyat otomatik hesapla\n  useEffect(() => {\n    const unitPrice = parseFloat(formData.unitPrice) || 0;\n    const vatRate = parseFloat(formData.vatRate) || 0;\n    \n    if (unitPrice > 0) {\n      const vatAmount = (unitPrice * vatRate) / 100;\n      const finalPrice = unitPrice + vatAmount;\n      setFormData(prev => ({\n        ...prev,\n        totalPrice: finalPrice.toFixed(2)\n      }));\n    } else {\n      setFormData(prev => ({\n        ...prev,\n        totalPrice: \"0\"\n      }));\n    }\n  }, [formData.unitPrice, formData.vatRate]);\n\n  // Form aldnda kullanclar ykle ve formu temizle\n  useEffect(() => {\n    if (open) {\n      fetchUsers();\n      fetchCategories();\n      // Form aldnda her zaman default deerleri kullan (bo form)\n      setFormData(defaultFormData);\n    }\n  }, [open]);\n\n  // Form baaryla kaydedildikten sonra state'i sfrla\n  const resetForm = () => {\n    setFormData(defaultFormData);\n  };\n\n  const fetchUsers = async () => {\n    setUsersLoading(true);\n    try {\n      const allUsers = await getAllUsers();\n      setUsers(allUsers);\n    } catch (error) {\n      if (import.meta.env.DEV) {\n        console.error(\"Error fetching users:\", error);\n      }\n      toast.error(\"Kullanclar yklenirken hata olutu\");\n    } finally {\n      setUsersLoading(false);\n    }\n  };\n\n  const fetchCategories = async () => {\n    setCategoriesLoading(true);\n    try {\n      const allCategories = await getRawMaterialCategories();\n      setCategories(allCategories);\n    } catch (error) {\n      if (import.meta.env.DEV) {\n        console.error(\"Error fetching categories:\", error);\n      }\n      toast.error(\"Kategoriler yklenirken hata olutu\");\n    } finally {\n      setCategoriesLoading(false);\n    }\n  };\n\n  // Yeni kategori ekle\n  const handleAddCategory = async () => {\n    if (!newCategoryName.trim()) {\n      toast.error(\"Kategori ad bo olamaz\");\n      return;\n    }\n\n    setNewCategoryLoading(true);\n    try {\n      const newCategory = await createRawMaterialCategory(newCategoryName.trim(), user?.id);\n      setCategories((prev) => [...prev, newCategory].sort((a, b) => a.name.localeCompare(b.name, \"tr\")));\n      setFormData((prev) => ({ ...prev, category: newCategory.value }));\n      setNewCategoryName(\"\");\n      setNewCategoryDialogOpen(false);\n      toast.success(\"Kategori baaryla eklendi\");\n    } catch (error: unknown) {\n      const errorMessage = error instanceof Error ? error.message : \"Kategori eklenirken hata olutu\";\n      toast.error(errorMessage);\n    } finally {\n      setNewCategoryLoading(false);\n    }\n  };\n\n  const handleSubmit = async (e?: React.FormEvent) => {\n    if (e) {\n      e.preventDefault();\n    }\n\n    setLoading(true);\n    try {\n      if (!user) {\n        toast.error(\"Oturumunuz sona erdi. Ltfen tekrar giri yapn.\");\n        setLoading(false);\n        return;\n      }\n\n      await createRawMaterial({\n        name: formData.name,\n        code: formData.sku || null,\n        unit: formData.unit,\n        currentStock: parseInt(formData.stock) || 0,\n        minStock: parseInt(formData.min_stock) || 0,\n        maxStock: null,\n        unitPrice: parseFloat(formData.unitPrice) || null,\n        totalPrice: parseFloat(formData.totalPrice) || null,\n        vatRate: formData.vatRate ? parseFloat(formData.vatRate) : null,\n        currency: formData.currency,\n        currencies: [formData.currency],\n        brand: formData.brand || null,\n        link: formData.link || null,\n        supplier: formData.supplier || null,\n        purchasedBy: formData.purchasedBy || null,\n        location: formData.location || null,\n        description: formData.description || null,\n        notes: formData.description || null,\n      });\n\n      toast.success(\"Hammadde baaryla eklendi\");\n      onSuccess();\n      resetForm(); // State'i sfrla\n      onOpenChange(false);\n    } catch (error: unknown) {\n      handleErrorToast(error, \"Hammadde eklenirken hata olutu\");\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  return (\n    <>\n    <Dialog open={open} onOpenChange={onOpenChange}>\n      <DialogContent className=\"!max-w-[100vw] sm:!max-w-[95vw] md:!max-w-[85vw] !w-[100vw] sm:!w-[95vw] md:!w-[85vw] !h-[100vh] sm:!h-[90vh] md:!h-[80vh] !max-h-[100vh] sm:!max-h-[90vh] md:!max-h-[80vh] !left-0 sm:!left-[2.5vw] md:!left-[7.5vw] !top-0 sm:!top-[5vh] md:!top-[10vh] !right-0 sm:!right-auto !bottom-0 sm:!bottom-auto !translate-x-0 !translate-y-0 overflow-hidden !p-0 gap-0 bg-white flex flex-col !m-0 !rounded-none sm:!rounded-lg !border-0 sm:!border\">\n        {/* DialogTitle ve DialogDescription DialogContent'in direkt child' olmal (Radix UI gereksinimi) */}\n        <DialogTitle className=\"sr-only\">\n          Yeni Hammadde Ekle\n        </DialogTitle>\n        <DialogDescription className=\"sr-only\">\n          Yeni hammadde eklemek iin formu doldurun\n        </DialogDescription>\n        \n        <div className=\"flex flex-col h-full min-h-0\">\n          {/* Header */}\n          <DialogHeader className=\"p-3 sm:p-4 border-b bg-white flex-shrink-0 relative pr-12 sm:pr-16\">\n            <div className=\"flex items-center justify-between gap-3\">\n              <div className=\"flex items-center gap-2 sm:gap-3 flex-1 min-w-0\">\n                <div className=\"h-8 w-8 sm:h-10 sm:w-10 rounded-lg bg-primary/10 flex items-center justify-center border border-primary/20 flex-shrink-0\">\n                  <Package className=\"h-4 w-4 sm:h-5 sm:w-5 text-primary\" />\n                </div>\n                <h2 className=\"text-[16px] sm:text-[18px] font-semibold text-foreground truncate\">\n                  Yeni Hammadde Ekle\n                </h2>\n              </div>\n              <div className=\"flex flex-wrap gap-2 flex-shrink-0\">\n                <Button\n                  variant=\"outline\"\n                  size=\"sm\"\n                  className=\"border-primary/20 hover:bg-primary/5 rounded-lg px-3 py-1.5 font-medium text-[11px] sm:text-xs flex-shrink-0 min-h-[36px] sm:min-h-8\"\n                  onClick={() => onOpenChange(false)}\n                  disabled={loading}\n                >\n                  <X className=\"h-3 w-3 sm:h-4 sm:w-4 mr-1.5 flex-shrink-0\" />\n                  ptal\n                </Button>\n                <Button\n                  variant=\"default\"\n                  size=\"sm\"\n                  className=\"bg-primary hover:bg-primary/90 rounded-lg px-3 py-1.5 font-medium text-[11px] sm:text-xs flex-shrink-0 text-white min-h-[36px] sm:min-h-8\"\n                  onClick={handleSubmit}\n                  disabled={loading}\n                >\n                  {loading ? (\n                    <Loader2 className=\"h-3 w-3 sm:h-4 sm:w-4 mr-1.5 flex-shrink-0 animate-spin\" />\n                  ) : (\n                    <Save className=\"h-3 w-3 sm:h-4 sm:w-4 mr-1.5 flex-shrink-0\" />\n                  )}\n                  Kaydet\n                </Button>\n              </div>\n            </div>\n          </DialogHeader>\n        \n          <div className=\"flex-1 overflow-hidden bg-gray-50/50 p-3 sm:p-4 min-h-0\">\n            <div className=\"max-w-full mx-auto h-full overflow-y-auto\">\n              <form onSubmit={(e) => { e.preventDefault(); handleSubmit(e); }} className=\"space-y-2\">\n                {/* Temel Bilgiler */}\n                <Card className=\"border shadow-sm\">\n                  <CardHeader className=\"pb-3\">\n                    <CardTitle className=\"text-[14px] sm:text-[15px] font-semibold flex items-center gap-2\">\n                      <FileText className=\"h-4 w-4 sm:h-5 sm:w-5 text-primary\" />\n                      Temel Bilgiler\n                    </CardTitle>\n                  </CardHeader>\n                  <CardContent className=\"space-y-3 sm:space-y-4\">\n                    <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-1.5 sm:gap-2\">\n                      <div className=\"space-y-1.5 sm:space-y-2\">\n                        <Label htmlFor=\"name\" className=\"text-[11px] sm:text-xs font-medium flex items-center gap-1.5\">\n                          Hammadde Ad\n                          <span className=\"text-destructive\">*</span>\n                        </Label>\n                        <Input\n                          id=\"name\"\n                          value={formData.name}\n                          onChange={(e) => setFormData({ ...formData, name: e.target.value })}\n                          className=\"text-[11px] sm:text-xs min-h-[44px] sm:min-h-0\"\n                          placeholder=\"rn: elik Levha, Plastik Granl\"\n                          required\n                        />\n                      </div>\n                      <div className=\"space-y-1.5 sm:space-y-2\">\n                        <Label htmlFor=\"sku\" className=\"text-[11px] sm:text-xs font-medium flex items-center gap-1.5\">\n                          Stok Kodu\n                          <span className=\"text-destructive\">*</span>\n                        </Label>\n                        <Input\n                          id=\"sku\"\n                          value={formData.sku}\n                          onChange={(e) => setFormData({ ...formData, sku: e.target.value })}\n                          className=\"text-[11px] sm:text-xs min-h-[44px] sm:min-h-0\"\n                          placeholder=\"rn: HM-001, SKU-123\"\n                          required\n                        />\n                      </div>\n                    </div>\n                    <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-1.5 sm:gap-2\">\n                      <div className=\"space-y-1.5 sm:space-y-2\">\n                        <Label htmlFor=\"category\" className=\"text-[11px] sm:text-xs font-medium\">Kategori</Label>\n                        <Select\n                          value={formData.category}\n                          onValueChange={(value) => {\n                            if (value === \"__add_new__\") {\n                              // Bu durumda SelectItem'n onSelect'i alacak\n                              return;\n                            }\n                            setFormData({ ...formData, category: value });\n                          }}\n                        >\n                          <SelectTrigger className=\"text-[11px] sm:text-xs min-h-[44px] sm:min-h-0\">\n                            <SelectValue />\n                          </SelectTrigger>\n                          <SelectContent className=\"text-[11px] sm:text-xs\">\n                            {categoriesLoading ? (\n                              <SelectItem value=\"loading\" disabled>Ykleniyor...</SelectItem>\n                            ) : (\n                              <>\n                                {categories.map((cat) => (\n                                  <SelectItem key={cat.id} value={cat.value} className=\"text-[11px] sm:text-xs\">\n                                    {cat.name}\n                                  </SelectItem>\n                                ))}\n                                {(isAdmin || isTeamLeader) && (\n                                  <>\n                                    <div className=\"border-t my-1\" />\n                                    <SelectItem\n                                      value=\"__add_new__\"\n                                      className=\"text-[11px] sm:text-xs text-primary font-medium\"\n                                      onSelect={(e) => {\n                                        e.preventDefault();\n                                        setNewCategoryDialogOpen(true);\n                                      }}\n                                    >\n                                      <div className=\"flex items-center gap-2\">\n                                        <Plus className=\"h-3 w-3\" />\n                                        Yeni Kategori Ekle\n                                      </div>\n                                    </SelectItem>\n                                  </>\n                                )}\n                              </>\n                            )}\n                          </SelectContent>\n                        </Select>\n                      </div>\n                      <div className=\"space-y-1.5 sm:space-y-2\">\n                        <Label htmlFor=\"unit\" className=\"text-[11px] sm:text-xs font-medium\">Birim</Label>\n                        <Select\n                          value={formData.unit}\n                          onValueChange={(value) => setFormData({ ...formData, unit: value })}\n                        >\n                          <SelectTrigger className=\"text-[11px] sm:text-xs min-h-[44px] sm:min-h-0\">\n                            <SelectValue placeholder=\"Birim sein\" />\n                          </SelectTrigger>\n                          <SelectContent className=\"text-[11px] sm:text-xs\">\n                            <SelectItem value=\"Adet\" className=\"text-[11px] sm:text-xs\">Adet</SelectItem>\n                            <SelectItem value=\"Kg\" className=\"text-[11px] sm:text-xs\">Kg</SelectItem>\n                            <SelectItem value=\"Gram\" className=\"text-[11px] sm:text-xs\">Gram</SelectItem>\n                            <SelectItem value=\"Litre\" className=\"text-[11px] sm:text-xs\">Litre</SelectItem>\n                            <SelectItem value=\"Metre\" className=\"text-[11px] sm:text-xs\">Metre</SelectItem>\n                            <SelectItem value=\"Cm\" className=\"text-[11px] sm:text-xs\">Cm</SelectItem>\n                            <SelectItem value=\"M\" className=\"text-[11px] sm:text-xs\">M</SelectItem>\n                            <SelectItem value=\"M\" className=\"text-[11px] sm:text-xs\">M</SelectItem>\n                            <SelectItem value=\"Paket\" className=\"text-[11px] sm:text-xs\">Paket</SelectItem>\n                            <SelectItem value=\"Kutu\" className=\"text-[11px] sm:text-xs\">Kutu</SelectItem>\n                            <SelectItem value=\"Palet\" className=\"text-[11px] sm:text-xs\">Palet</SelectItem>\n                            <SelectItem value=\"Ton\" className=\"text-[11px] sm:text-xs\">Ton</SelectItem>\n                          </SelectContent>\n                        </Select>\n                      </div>\n                      <div className=\"space-y-1.5 sm:space-y-2\">\n                        <Label htmlFor=\"brand\" className=\"text-[11px] sm:text-xs font-medium\">Marka</Label>\n                        <Input\n                          id=\"brand\"\n                          value={formData.brand}\n                          onChange={(e) => setFormData({ ...formData, brand: e.target.value })}\n                          className=\"text-[11px] sm:text-xs min-h-[44px] sm:min-h-0\"\n                          placeholder=\"rn: Bosch, Samsung\"\n                        />\n                      </div>\n                    </div>\n                    <div className=\"space-y-2\">\n                      <Label htmlFor=\"description\" className=\"text-[11px] sm:text-xs font-medium\">Aklama</Label>\n                      <Textarea\n                        id=\"description\"\n                        value={formData.description}\n                        onChange={(e) => setFormData({ ...formData, description: e.target.value })}\n                        className=\"text-[11px] sm:text-xs min-h-[80px] sm:min-h-[100px] resize-none\"\n                        placeholder=\"Hammadde hakknda detayl aklama yazn...\"\n                      />\n                    </div>\n                  </CardContent>\n                </Card>\n\n                {/* Stok Bilgileri */}\n                <Card className=\"border shadow-sm\">\n                  <CardHeader className=\"pb-3\">\n                    <CardTitle className=\"text-[14px] sm:text-[15px] font-semibold flex items-center gap-2\">\n                      <Warehouse className=\"h-4 w-4 sm:h-5 sm:w-5 text-primary\" />\n                      Stok Bilgileri\n                    </CardTitle>\n                  </CardHeader>\n                  <CardContent className=\"space-y-3 sm:space-y-4\">\n                    <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-1.5 sm:gap-2\">\n                      <div className=\"space-y-1.5 sm:space-y-2\">\n                        <Label htmlFor=\"stock\" className=\"text-[11px] sm:text-xs font-medium flex items-center gap-1.5\">\n                          Mevcut Stok\n                          <span className=\"text-destructive\">*</span>\n                        </Label>\n                        <Input\n                          id=\"stock\"\n                          type=\"number\"\n                          step=\"1\"\n                          min=\"0\"\n                          value={formData.stock}\n                          onChange={(e) => setFormData({ ...formData, stock: e.target.value })}\n                          className=\"text-[11px] sm:text-xs min-h-[44px] sm:min-h-0\"\n                          required\n                        />\n                      </div>\n                      <div className=\"space-y-1.5 sm:space-y-2\">\n                        <Label htmlFor=\"min_stock\" className=\"text-[11px] sm:text-xs font-medium flex items-center gap-1.5\">\n                          Kritik Stok Adedi\n                          <span className=\"text-destructive\">*</span>\n                        </Label>\n                        <Input\n                          id=\"min_stock\"\n                          type=\"number\"\n                          step=\"1\"\n                          min=\"0\"\n                          value={formData.min_stock}\n                          onChange={(e) => setFormData({ ...formData, min_stock: e.target.value })}\n                          className=\"text-[11px] sm:text-xs min-h-[44px] sm:min-h-0\"\n                          required\n                        />\n                        {parseInt(formData.stock) < parseInt(formData.min_stock) && parseInt(formData.stock) >= 0 && parseInt(formData.min_stock) > 0 && (\n                          <div className=\"flex items-center gap-1.5 text-xs text-amber-600 bg-amber-50 dark:bg-amber-950/20 px-2 py-1.5 rounded-md border border-amber-200 dark:border-amber-800\">\n                            <AlertTriangle className=\"h-3.5 w-3.5\" />\n                            <span>Stok kritik seviyenin altnda!</span>\n                          </div>\n                        )}\n                      </div>\n                    </div>\n                  </CardContent>\n                </Card>\n\n                {/* Fiyat Bilgileri */}\n                <Card className=\"border shadow-sm\">\n                  <CardHeader className=\"pb-3\">\n                    <CardTitle className=\"text-[14px] sm:text-[15px] font-semibold flex items-center gap-2\">\n                      <DollarSign className=\"h-4 w-4 sm:h-5 sm:w-5 text-primary\" />\n                      Fiyat Bilgileri\n                    </CardTitle>\n                  </CardHeader>\n                  <CardContent className=\"space-y-3 sm:space-y-4\">\n                    <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-1.5 sm:gap-2\">\n                      <div className=\"space-y-1.5 sm:space-y-2\">\n                        <Label className=\"text-[11px] sm:text-xs font-medium\">Para Birimi</Label>\n                        <Select\n                          value={formData.currency}\n                          onValueChange={(value) => setFormData({ ...formData, currency: value as Currency })}\n                        >\n                          <SelectTrigger className=\"min-h-[44px] sm:min-h-0\">\n                            <SelectValue />\n                          </SelectTrigger>\n                          <SelectContent className=\"text-[11px] sm:text-xs\">\n                            {CURRENCY_OPTIONS.map((opt) => (\n                              <SelectItem key={opt.value} value={opt.value} className=\"text-[11px] sm:text-xs\">\n                                {opt.label}\n                              </SelectItem>\n                            ))}\n                          </SelectContent>\n                        </Select>\n                      </div>\n                      <div className=\"space-y-1.5 sm:space-y-2\">\n                        <Label htmlFor=\"unitPrice\" className=\"text-[11px] sm:text-xs font-medium\">\n                          Birim Fiyat ({CURRENCY_SYMBOLS[formData.currency as Currency]})\n                        </Label>\n                        <Input\n                          id=\"unitPrice\"\n                          type=\"number\"\n                          step=\"0.01\"\n                          min=\"0\"\n                          value={formData.unitPrice}\n                          onChange={(e) => setFormData({ ...formData, unitPrice: e.target.value })}\n                          className=\"text-[11px] sm:text-xs min-h-[44px] sm:min-h-0\"\n                          placeholder=\"0.00\"\n                        />\n                      </div>\n                      <div className=\"space-y-1.5 sm:space-y-2\">\n                        <Label htmlFor=\"vatRate\" className=\"text-[11px] sm:text-xs font-medium\">KDV Yzdesi (%)</Label>\n                        <Input\n                          id=\"vatRate\"\n                          type=\"number\"\n                          step=\"0.01\"\n                          min=\"0\"\n                          max=\"100\"\n                          value={formData.vatRate}\n                          onChange={(e) => setFormData({ ...formData, vatRate: e.target.value })}\n                          className=\"text-[11px] sm:text-xs min-h-[44px] sm:min-h-0\"\n                          placeholder=\"rn: 20\"\n                        />\n                      </div>\n                    </div>\n                    <div className=\"space-y-2\">\n                      <Label htmlFor=\"totalPrice\" className=\"text-[11px] sm:text-xs font-medium\">\n                        Nihai Fiyat (KDV Dahil) ({CURRENCY_SYMBOLS[formData.currency as Currency]})\n                      </Label>\n                      <Input\n                        id=\"totalPrice\"\n                        type=\"number\"\n                        step=\"0.01\"\n                        min=\"0\"\n                        value={formData.totalPrice}\n                        readOnly\n                        className=\"min-h-[44px] sm:min-h-0 bg-muted/50 cursor-not-allowed font-semibold\"\n                      />\n                    </div>\n                  </CardContent>\n                </Card>\n\n                {/* Tedarik Bilgileri */}\n                <Card className=\"border shadow-sm\">\n                  <CardHeader className=\"pb-3\">\n                    <CardTitle className=\"text-[14px] sm:text-[15px] font-semibold flex items-center gap-2\">\n                      <ShoppingCart className=\"h-4 w-4 sm:h-5 sm:w-5 text-primary\" />\n                      Tedarik Bilgileri\n                    </CardTitle>\n                  </CardHeader>\n                  <CardContent className=\"space-y-3 sm:space-y-4\">\n                    <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-1.5 sm:gap-2\">\n                      <div className=\"space-y-1.5 sm:space-y-2\">\n                        <Label htmlFor=\"supplier\" className=\"text-[11px] sm:text-xs font-medium flex items-center gap-1.5\">\n                          <Building2 className=\"h-3.5 w-3.5\" />\n                          Tedariki\n                        </Label>\n                        <Input\n                          id=\"supplier\"\n                          value={formData.supplier}\n                          onChange={(e) => setFormData({ ...formData, supplier: e.target.value })}\n                          className=\"text-[11px] sm:text-xs min-h-[44px] sm:min-h-0\"\n                          placeholder=\"Tedariki firma ad\"\n                        />\n                      </div>\n                      <div className=\"space-y-1.5 sm:space-y-2\">\n                        <Label htmlFor=\"purchasedBy\" className=\"text-[11px] sm:text-xs font-medium flex items-center gap-1.5\">\n                          <User className=\"h-3.5 w-3.5\" />\n                          Satn Alan Kii\n                        </Label>\n                        <Select\n                          value={formData.purchasedBy || \"none\"}\n                          onValueChange={(value) => setFormData({ ...formData, purchasedBy: value === \"none\" ? \"\" : value })}\n                          disabled={usersLoading}\n                        >\n                          <SelectTrigger className=\"min-h-[44px] sm:min-h-0\">\n                            <SelectValue placeholder={usersLoading ? \"Ykleniyor...\" : \"Kii sein\"} />\n                          </SelectTrigger>\n                          <SelectContent className=\"text-[11px] sm:text-xs max-h-[300px] overflow-y-auto\">\n                            <SelectItem value=\"none\" className=\"text-[11px] sm:text-xs\">Satn Alan Kii Yok</SelectItem>\n                            {users.map((user) => (\n                              <SelectItem key={user.id} value={user.id} className=\"text-[11px] sm:text-xs\">\n                                {user.fullName || user.displayName || user.email || \"simsiz Kullanc\"}\n                              </SelectItem>\n                            ))}\n                          </SelectContent>\n                        </Select>\n                      </div>\n                    </div>\n                    <div className=\"space-y-2\">\n                      <Label htmlFor=\"link\" className=\"text-[11px] sm:text-xs font-medium flex items-center gap-1.5\">\n                        <Link2 className=\"h-3.5 w-3.5\" />\n                        rn Linki\n                      </Label>\n                      <Input\n                        id=\"link\"\n                        type=\"url\"\n                        value={formData.link}\n                        onChange={(e) => setFormData({ ...formData, link: e.target.value })}\n                        className=\"min-h-[44px] sm:min-h-0\"\n                        placeholder=\"https://...\"\n                      />\n                    </div>\n                    <div className=\"space-y-2\">\n                      <Label htmlFor=\"location\" className=\"text-[11px] sm:text-xs font-medium flex items-center gap-1.5\">\n                        <MapPin className=\"h-3.5 w-3.5\" />\n                        Hammadde Konumu\n                      </Label>\n                      <Input\n                        id=\"location\"\n                        value={formData.location}\n                        onChange={(e) => setFormData({ ...formData, location: e.target.value })}\n                        className=\"min-h-[44px] sm:min-h-0\"\n                        placeholder=\"rn: Depo A, Raf 3, Blm 2\"\n                      />\n                    </div>\n                  </CardContent>\n                </Card>\n              </form>\n            </div>\n          </div>\n        </div>\n      </DialogContent>\n    </Dialog>\n\n      {/* Yeni Kategori Ekle Dialog */}\n      <Dialog open={newCategoryDialogOpen} onOpenChange={setNewCategoryDialogOpen}>\n        <DialogContent className=\"sm:max-w-[425px]\">\n          <DialogHeader>\n            <DialogTitle>Yeni Kategori Ekle</DialogTitle>\n            <DialogDescription>\n              Hammadde iin yeni bir kategori ekleyin.\n            </DialogDescription>\n          </DialogHeader>\n          <div className=\"space-y-4 py-4\">\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"newCategoryName\">Kategori Ad</Label>\n              <Input\n                id=\"newCategoryName\"\n                value={newCategoryName}\n                onChange={(e) => setNewCategoryName(e.target.value)}\n                placeholder=\"rn: Ahap, Cam, Tekstil...\"\n                onKeyDown={(e) => {\n                  if (e.key === \"Enter\" && !e.shiftKey) {\n                    e.preventDefault();\n                    handleAddCategory();\n                  }\n                }}\n              />\n            </div>\n            <div className=\"flex justify-end gap-2\">\n              <Button\n                variant=\"outline\"\n                onClick={() => {\n                  setNewCategoryDialogOpen(false);\n                  setNewCategoryName(\"\");\n                }}\n                disabled={newCategoryLoading}\n              >\n                ptal\n              </Button>\n              <Button onClick={handleAddCategory} disabled={newCategoryLoading || !newCategoryName.trim()}>\n                {newCategoryLoading ? (\n                  <>\n                    <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\n                    Ekleniyor...\n                  </>\n                ) : (\n                  \"Ekle\"\n                )}\n              </Button>\n            </div>\n          </div>\n        </DialogContent>\n      </Dialog>\n    </>\n  );\n};\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\components\\RawMaterials\\EditRawMaterialDialog.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\components\\RawMaterials\\MaterialTransactionsDialog.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchTransactions'. Either include it or remove the dependency array.","line":44,"column":6,"nodeType":"ArrayExpression","endLine":44,"endColumn":24,"suggestions":[{"desc":"Update the dependencies array to be: [open, materialId, fetchTransactions]","fix":{"range":[1485,1503],"text":"[open, materialId, fetchTransactions]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from \"react\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogDescription } from \"@/components/ui/dialog\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { toast } from \"sonner\";\nimport { getMaterialTransactions, MaterialTransaction } from \"@/services/firebase/materialService\";\nimport { getOrderById } from \"@/services/firebase/orderService\";\nimport { getAllUsers, UserProfile } from \"@/services/firebase/authService\";\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \"@/components/ui/table\";\nimport { format } from \"date-fns\";\nimport { tr } from \"date-fns/locale\";\nimport { Timestamp } from \"firebase/firestore\";\nimport { ExternalLink } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\n\ninterface MaterialTransactionsDialogProps {\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n  materialId: string;\n  materialName: string;\n}\n\nexport const MaterialTransactionsDialog = ({\n  open,\n  onOpenChange,\n  materialId,\n  materialName,\n}: MaterialTransactionsDialogProps) => {\n  const [transactions, setTransactions] = useState<MaterialTransaction[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [ordersMap, setOrdersMap] = useState<Record<string, { orderNumber: string; productName?: string }>>({});\n  const [usersMap, setUsersMap] = useState<Record<string, string>>({});\n\n  useEffect(() => {\n    if (open) {\n      fetchTransactions();\n    }\n  }, [open, materialId]);\n\n  const fetchTransactions = async () => {\n    setLoading(true);\n    try {\n      const transactionsData = await getMaterialTransactions(materialId);\n      // Tarihe gre srala (en yeni stte)\n      transactionsData.sort((a, b) => {\n        const aTime = a.createdAt && typeof a.createdAt === 'object' && 'toMillis' in a.createdAt && typeof a.createdAt.toMillis === 'function' \n          ? a.createdAt.toMillis() \n          : (a.createdAt && typeof a.createdAt === 'object' && 'seconds' in a.createdAt && typeof a.createdAt.seconds === 'number' \n            ? a.createdAt.seconds * 1000 \n            : 0);\n        const bTime = b.createdAt && typeof b.createdAt === 'object' && 'toMillis' in b.createdAt && typeof b.createdAt.toMillis === 'function' \n          ? b.createdAt.toMillis() \n          : (b.createdAt && typeof b.createdAt === 'object' && 'seconds' in b.createdAt && typeof b.createdAt.seconds === 'number' \n            ? b.createdAt.seconds * 1000 \n            : 0);\n        return bTime - aTime;\n      });\n      setTransactions(transactionsData);\n\n      // Sipari bilgilerini ve kullanc bilgilerini ykle\n      const orderIds = transactionsData\n        .filter(t => t.relatedOrderId)\n        .map(t => t.relatedOrderId!)\n        .filter((id, index, self) => self.indexOf(id) === index); // Unique\n\n      const userIds = transactionsData\n        .map(t => t.createdBy)\n        .filter((id, index, self) => self.indexOf(id) === index); // Unique\n\n      // Paralel olarak sipari ve kullanc bilgilerini ykle\n      const [ordersData, usersData] = await Promise.all([\n        Promise.all(orderIds.map(async (orderId) => {\n          try {\n            const order = await getOrderById(orderId);\n            return order ? { orderId, orderNumber: order.orderNumber || order.order_number || orderId, productName: order.productName || order.product_name } : null;\n          } catch {\n            return null;\n          }\n        })),\n        getAllUsers().catch(() => [] as UserProfile[]),\n      ]);\n\n      // Orders map olutur\n      const ordersMapData: Record<string, { orderNumber: string; productName?: string }> = {};\n      ordersData.forEach((orderData) => {\n        if (orderData) {\n          ordersMapData[orderData.orderId] = { orderNumber: orderData.orderNumber, productName: orderData.productName };\n        }\n      });\n      setOrdersMap(ordersMapData);\n\n      // Users map olutur\n      const usersMapData: Record<string, string> = {};\n      usersData.forEach((user) => {\n        usersMapData[user.id] = user.fullName || user.displayName || user.email || \"Bilinmeyen\";\n      });\n      setUsersMap(usersMapData);\n    } catch (error: unknown) {\n      if (import.meta.env.DEV) {\n        console.error(\"lemler yklenirken hata:\", error);\n      }\n      toast.error(error instanceof Error ? error.message : \"lemler yklenirken hata olutu\");\n      setTransactions([]);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const formatDate = (timestamp: Timestamp | Date | string | null | undefined) => {\n    if (!timestamp) return \"-\";\n    try {\n      let date: Date;\n      if (timestamp && typeof timestamp === 'object' && 'toDate' in timestamp && typeof timestamp.toDate === 'function') {\n        date = timestamp.toDate();\n      } else if (timestamp instanceof Date) {\n        date = timestamp;\n      } else if (timestamp instanceof Timestamp) {\n        date = timestamp.toDate();\n      } else if (typeof timestamp === 'string') {\n        date = new Date(timestamp);\n      } else {\n        return \"-\";\n      }\n      return format(date, \"dd MMMM yyyy HH:mm\", { locale: tr });\n    } catch {\n      return \"-\";\n    }\n  };\n\n  return (\n    <Dialog open={open} onOpenChange={onOpenChange}>\n      <DialogContent className=\"max-w-6xl w-[80vw] max-h-[80vh] overflow-y-auto\">\n        {/* DialogTitle ve DialogDescription DialogContent'in direkt child' olmal (Radix UI gereksinimi) */}\n        <DialogTitle className=\"sr-only\">\n          {materialName} - lem Gemii\n        </DialogTitle>\n        <DialogDescription className=\"sr-only\">\n          Bu hammadde iin yaplan tm stok hareketlerini grntleyin\n        </DialogDescription>\n        \n        <DialogHeader>\n          <h2 className=\"text-[16px] sm:text-[18px] font-semibold\">{materialName} - lem Gemii</h2>\n          <p className=\"text-[11px] sm:text-xs text-muted-foreground\">\n            Bu hammadde iin yaplan tm stok hareketlerini grntleyin\n          </p>\n        </DialogHeader>\n\n        {loading ? (\n          <p className=\"text-center py-8 text-[11px] sm:text-xs text-muted-foreground\">Ykleniyor...</p>\n        ) : transactions.length === 0 ? (\n          <p className=\"text-center py-8 text-[11px] sm:text-xs text-muted-foreground\">Henz ilem yaplmam</p>\n        ) : (\n          <div className=\"overflow-x-auto\">\n            <Table>\n              <TableHeader>\n                <TableRow>\n                  <TableHead className=\"text-[11px] sm:text-xs\">Tarih</TableHead>\n                  <TableHead className=\"text-[11px] sm:text-xs\">lem Tr</TableHead>\n                  <TableHead className=\"text-[11px] sm:text-xs text-right\">Miktar</TableHead>\n                  <TableHead className=\"text-[11px] sm:text-xs\">Sipari</TableHead>\n                  <TableHead className=\"text-[11px] sm:text-xs\">rn</TableHead>\n                  <TableHead className=\"text-[11px] sm:text-xs\">Kullanc</TableHead>\n                  <TableHead className=\"text-[11px] sm:text-xs\">Aklama</TableHead>\n                </TableRow>\n              </TableHeader>\n              <TableBody>\n                {transactions.map((t) => {\n                  const orderInfo = t.relatedOrderId ? ordersMap[t.relatedOrderId] : null;\n                  const userName = usersMap[t.createdBy] || \"Bilinmeyen\";\n                  \n                  return (\n                    <TableRow key={t.id}>\n                      <TableCell className=\"text-[11px] sm:text-xs whitespace-nowrap\">\n                        {formatDate(t.createdAt)}\n                      </TableCell>\n                      <TableCell>\n                        <Badge variant={t.type === \"in\" ? \"default\" : \"destructive\"} className=\"text-[10px]\">\n                          {t.type === \"in\" ? \"Giri\" : \"k\"}\n                        </Badge>\n                      </TableCell>\n                      <TableCell\n                        className={`text-[11px] sm:text-xs text-right font-medium whitespace-nowrap ${\n                          t.type === \"in\" ? \"text-green-600\" : \"text-red-600\"\n                        }`}\n                      >\n                        {t.type === \"in\" ? \"+\" : \"-\"}\n                        {t.quantity}\n                      </TableCell>\n                      <TableCell className=\"text-[11px] sm:text-xs\">\n                        {orderInfo ? (\n                          <div className=\"flex items-center gap-2\">\n                            <span className=\"font-medium\">{orderInfo.orderNumber}</span>\n                            {t.relatedOrderId && (\n                              <Button\n                                variant=\"ghost\"\n                                size=\"sm\"\n                                className=\"text-[11px] sm:text-xs h-6 w-6 p-0\"\n                                onClick={() => {\n                                  window.open(`/production?orderId=${t.relatedOrderId}`, '_blank');\n                                }}\n                                title=\"Siparii a\"\n                              >\n                                <ExternalLink className=\"h-3 w-3\" />\n                              </Button>\n                            )}\n                          </div>\n                        ) : (\n                          \"-\"\n                        )}\n                      </TableCell>\n                      <TableCell className=\"text-[11px] sm:text-xs\">\n                        {orderInfo?.productName || \"-\"}\n                      </TableCell>\n                      <TableCell className=\"text-[11px] sm:text-xs\">\n                        {userName}\n                      </TableCell>\n                      <TableCell className=\"text-[11px] sm:text-xs max-w-xs truncate\" title={t.reason}>\n                        {t.reason || \"-\"}\n                      </TableCell>\n                    </TableRow>\n                  );\n                })}\n              </TableBody>\n            </Table>\n          </div>\n        )}\n      </DialogContent>\n    </Dialog>\n  );\n};\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\components\\RawMaterials\\RawMaterialDetailModal.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'fetchRecipes', 'fetchTransactions', and 'fetchUsers'. Either include them or remove the dependency array.","line":165,"column":6,"nodeType":"ArrayExpression","endLine":165,"endColumn":37,"suggestions":[{"desc":"Update the dependencies array to be: [open, material?.id, activeTab, fetchRecipes, fetchTransactions, fetchUsers]","fix":{"range":[5702,5733],"text":"[open, material?.id, activeTab, fetchRecipes, fetchTransactions, fetchUsers]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import {\n  Dialog,\n  DialogContent,\n  DialogHeader,\n  DialogTitle,\n  DialogDescription,\n} from \"@/components/ui/dialog\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Edit, Trash2, Package, Loader2, Plus } from \"lucide-react\";\nimport { deleteRawMaterial, addMaterialComment, getMaterialComments, getMaterialActivities, RawMaterial } from \"@/services/firebase/materialService\";\nimport { useAuth } from \"@/contexts/AuthContext\";\nimport { canUpdateResource, canDeleteResource } from \"@/utils/permissions\";\nimport { ActivityCommentsPanel } from \"@/components/shared/ActivityCommentsPanel\";\nimport { toast } from \"sonner\";\nimport { useState, useEffect } from \"react\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \"@/components/ui/table\";\nimport {\n  getRawMaterialRecipes,\n  RecipeWithProduct,\n  deleteRecipeItem,\n  addRecipeItem,\n} from \"@/services/firebase/recipeService\";\nimport { getProducts, Product } from \"@/services/firebase/productService\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { CURRENCY_SYMBOLS } from \"@/utils/currency\";\nimport { getAllUsers, UserProfile, getUserProfile } from \"@/services/firebase/authService\";\nimport { getMaterialTransactions, MaterialTransaction } from \"@/services/firebase/materialService\";\nimport { getOrderById, getOrderItems } from \"@/services/firebase/orderService\";\nimport { format } from \"date-fns\";\nimport { tr } from \"date-fns/locale\";\nimport { ExternalLink } from \"lucide-react\";\n\ninterface RawMaterialDetailModalProps {\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n  material: RawMaterial;\n  onEdit: () => void;\n  onDelete: () => void;\n}\n\nexport const RawMaterialDetailModal = ({\n  open,\n  onOpenChange,\n  material,\n  onEdit,\n  onDelete,\n}: RawMaterialDetailModalProps) => {\n  const { user, isTeamLeader } = useAuth();\n  const [canUpdate, setCanUpdate] = useState(false);\n  const [canDelete, setCanDelete] = useState(false);\n  const [deleting, setDeleting] = useState(false);\n  const [recipes, setRecipes] = useState<RecipeWithProduct[]>([]);\n  const [recipeLoading, setRecipeLoading] = useState(false);\n  const [activeTab, setActiveTab] = useState(\"details\");\n  const [products, setProducts] = useState<Product[]>([]);\n  const [productsLoading, setProductsLoading] = useState(false);\n  const [selectedProduct, setSelectedProduct] = useState<string>(\"\");\n  const [newQuantity, setNewQuantity] = useState<string>(\"\");\n  const [users, setUsers] = useState<UserProfile[]>([]);\n  const [usersLoading, setUsersLoading] = useState(false);\n  const [transactions, setTransactions] = useState<MaterialTransaction[]>([]);\n  const [transactionsLoading, setTransactionsLoading] = useState(false);\n  const [ordersMap, setOrdersMap] = useState<Record<string, { orderNumber: string; productName?: string }>>({});\n  const [usersMap, setUsersMap] = useState<Record<string, string>>({});\n\n  // Yetki kontrol\n  useEffect(() => {\n    const checkPermissions = async () => {\n      if (!user) {\n        setCanUpdate(false);\n        setCanDelete(false);\n        return;\n      }\n\n      try {\n        const userProfile = await getUserProfile(user.id);\n        if (!userProfile) {\n          setCanUpdate(false);\n          setCanDelete(false);\n          return;\n        }\n        \n        const [updatePermission, deletePermission] = await Promise.all([\n          canUpdateResource(userProfile, \"raw_materials\"),\n          canDeleteResource(userProfile, \"raw_materials\"),\n        ]);\n\n        setCanUpdate(updatePermission);\n        setCanDelete(deletePermission);\n      } catch (error: unknown) {\n        if (import.meta.env.DEV) {\n          console.error(\"Permission check error:\", error);\n        }\n        setCanUpdate(false);\n        setCanDelete(false);\n      }\n    };\n\n    checkPermissions();\n  }, [user]);\n\n  const handleDelete = async () => {\n    if (!confirm(\"Bu hammaddeyi silmek istediinizden emin misiniz?\")) return;\n\n    // Yetki kontrol\n    if (!canDelete && material.createdBy !== user?.id && !isTeamLeader) {\n      toast.error(\"Hammadde silme yetkiniz yok.\");\n      return;\n    }\n\n    setDeleting(true);\n    try {\n      await deleteRawMaterial(material.id);\n      toast.success(\"Hammadde baaryla silindi\");\n      onDelete();\n    } catch (error: unknown) {\n      const errorMessage = error instanceof Error ? error.message : \"Bilinmeyen hata\";\n      toast.error(\"Hata: \" + errorMessage);\n    } finally {\n      setDeleting(false);\n    }\n  };\n\n  const getCategoryLabel = (category: string) => {\n    const labels: Record<string, string> = {\n      chemical: \"Kimyasal\",\n      metal: \"Metal\",\n      plastic: \"Plastik\",\n      electronic: \"Elektronik\",\n      packaging: \"Ambalaj\",\n      other: \"Dier\"\n    };\n    return labels[category] || category;\n  };\n\n  const getStockStatus = (stock: number, min_stock: number) => {\n    if (stock === 0) return { label: \"Tkendi\", variant: \"destructive\" as const };\n    if (stock < min_stock) return { label: \"Dk\", variant: \"secondary\" as const };\n    return { label: \"Normal\", variant: \"default\" as const };\n  };\n\n  useEffect(() => {\n    if (open && material?.id && activeTab === \"recipes\") {\n      fetchRecipes();\n      fetchProducts();\n    }\n    if (open && material?.id && activeTab === \"transactions\") {\n      fetchTransactions();\n    }\n    if (open) {\n      fetchUsers();\n    }\n  }, [open, material?.id, activeTab]);\n\n  const fetchUsers = async () => {\n    if (users.length > 0 && Object.keys(usersMap).length > 0) return;\n    setUsersLoading(true);\n    try {\n      const allUsers = await getAllUsers();\n      setUsers(allUsers);\n      // Users map olutur\n      const usersMapData: Record<string, string> = {};\n      allUsers.forEach((user) => {\n        usersMapData[user.id] = user.fullName || user.displayName || user.email || \"Bilinmeyen\";\n      });\n      setUsersMap(usersMapData);\n    } catch (error: unknown) {\n      if (import.meta.env.DEV) console.error(\"Error fetching users:\", error);\n    } finally {\n      setUsersLoading(false);\n    }\n  };\n\n  const fetchTransactions = async () => {\n    if (!material?.id) return;\n    setTransactionsLoading(true);\n    try {\n      const transactionsData = await getMaterialTransactions(material.id);\n      // Tarihe gre srala (en yeni stte)\n      transactionsData.sort((a, b) => {\n        const getTime = (createdAt: unknown): number => {\n          if (!createdAt) return 0;\n          if (createdAt && typeof createdAt === 'object' && 'toMillis' in createdAt && typeof createdAt.toMillis === 'function') {\n            return createdAt.toMillis();\n          }\n          if (createdAt && typeof createdAt === 'object' && 'seconds' in createdAt && typeof (createdAt as { seconds: unknown }).seconds === 'number') {\n            return (createdAt as { seconds: number }).seconds * 1000;\n          }\n          return 0;\n        };\n        const aTime = getTime(a.createdAt);\n        const bTime = getTime(b.createdAt);\n        return bTime - aTime;\n      });\n      setTransactions(transactionsData);\n\n      // Sipari bilgilerini ykle\n      const orderIds = transactionsData\n        .filter(t => t.relatedOrderId)\n        .map(t => t.relatedOrderId!)\n        .filter((id, index, self) => self.indexOf(id) === index); // Unique\n\n      // Paralel olarak sipari bilgilerini ykle\n      const ordersData = await Promise.all(\n        orderIds.map(async (orderId) => {\n          try {\n            const order = await getOrderById(orderId);\n            if (!order) return null;\n            \n            // Sipari kalemlerinden rn adn al\n            let productName: string | undefined;\n            try {\n              const items = await getOrderItems(orderId);\n              if (items.length > 0) {\n                productName = items[0].productName || items[0].product_name || undefined;\n              }\n            } catch {\n              // Sipari kalemleri alnamazsa reason'dan parse et\n              const transactionsForOrder = transactionsData.filter(t => t.relatedOrderId === orderId);\n              if (transactionsForOrder.length > 0 && transactionsForOrder[0].reason) {\n                const match = transactionsForOrder[0].reason.match(/-\\s*(.+?)\\s*\\(/);\n                if (match) {\n                  productName = match[1];\n                }\n              }\n            }\n            \n            return {\n              orderId,\n              orderNumber: order.orderNumber || order.order_number || orderId,\n              productName\n            };\n          } catch {\n            return null;\n          }\n        })\n      );\n\n      // Orders map olutur\n      const ordersMapData: Record<string, { orderNumber: string; productName?: string }> = {};\n      ordersData.forEach((orderData) => {\n        if (orderData) {\n          ordersMapData[orderData.orderId] = { orderNumber: orderData.orderNumber, productName: orderData.productName };\n        }\n      });\n      setOrdersMap(ordersMapData);\n    } catch (error: unknown) {\n      if (import.meta.env.DEV) console.error(\"lemler yklenirken hata:\", error);\n      const errorMessage = error instanceof Error ? error.message : \"Bilinmeyen hata\";\n      toast.error(errorMessage || \"lemler yklenirken hata olutu\");\n      setTransactions([]);\n    } finally {\n      setTransactionsLoading(false);\n    }\n  };\n\n  const formatTransactionDate = (timestamp: unknown) => {\n    if (!timestamp) return \"-\";\n    try {\n      let date: Date;\n      if (timestamp && typeof timestamp === 'object' && 'toDate' in timestamp && typeof timestamp.toDate === 'function') {\n        date = timestamp.toDate();\n      } else if (timestamp instanceof Date) {\n        date = timestamp;\n      } else {\n        date = new Date(String(timestamp));\n      }\n      return format(date, \"dd MMMM yyyy HH:mm\", { locale: tr });\n    } catch {\n      return \"-\";\n    }\n  };\n\n  const fetchProducts = async () => {\n    setProductsLoading(true);\n    try {\n      const productsData = await getProducts();\n      setProducts(productsData);\n    } catch (error: unknown) {\n      if (import.meta.env.DEV) console.error(\"Fetch products error:\", error);\n      toast.error(\"rn listesi alnamad.\");\n    } finally {\n      setProductsLoading(false);\n    }\n  };\n\n  const fetchRecipes = async () => {\n    if (!material?.id) return;\n    setRecipeLoading(true);\n    try {\n      const recipesData = await getRawMaterialRecipes(material.id);\n      setRecipes(recipesData);\n    } catch (error: unknown) {\n      if (import.meta.env.DEV) {\n        console.error(\"Reete yklenirken hata:\", error);\n      }\n      const errorMessage = error instanceof Error ? error.message : \"Bilinmeyen hata\";\n      toast.error(\"Reeteler yklenemedi: \" + errorMessage);\n    } finally {\n      setRecipeLoading(false);\n    }\n  };\n\n  const removeRecipe = async (recipeId: string) => {\n    if (!confirm(\"Bu reeteyi silmek istediinizden emin misiniz?\"))\n      return;\n\n    try {\n      await deleteRecipeItem(recipeId);\n      toast.success(\"Reete silindi\");\n      fetchRecipes();\n    } catch (error: unknown) {\n      const errorMessage = error instanceof Error ? error.message : \"Bilinmeyen hata\";\n      toast.error(\"Hata: \" + errorMessage);\n    }\n  };\n\n  const addRecipe = async () => {\n    if (!selectedProduct || !newQuantity || !material?.id) {\n      toast.error(\"Ltfen rn ve miktar sein\");\n      return;\n    }\n\n    const quantity = parseFloat(newQuantity);\n    if (isNaN(quantity) || quantity <= 0) {\n      toast.error(\"Geerli bir miktar girin\");\n      return;\n    }\n\n    setRecipeLoading(true);\n    try {\n      await addRecipeItem(selectedProduct, material.id, quantity);\n      toast.success(\"Reete eklendi\");\n      fetchRecipes();\n      setSelectedProduct(\"\");\n      setNewQuantity(\"\");\n    } catch (error: unknown) {\n      const errorMessage = error instanceof Error ? error.message : \"Bilinmeyen hata\";\n      toast.error(\"Hata: \" + errorMessage);\n    } finally {\n      setRecipeLoading(false);\n    }\n  };\n\n  if (!material) return null;\n\n  const stockStatus = getStockStatus(material.currentStock || material.stock || 0, material.minStock || material.min_stock || 0);\n\n  return (\n    <>\n      <Dialog open={open} onOpenChange={onOpenChange}>\n        <DialogContent className=\"!max-w-[100vw] sm:!max-w-[95vw] md:!max-w-[85vw] !w-[100vw] sm:!w-[95vw] md:!w-[85vw] !h-[100vh] sm:!h-[90vh] md:!h-[80vh] !max-h-[100vh] sm:!max-h-[90vh] md:!max-h-[80vh] !left-0 sm:!left-[2.5vw] md:!left-[7.5vw] !top-0 sm:!top-[5vh] md:!top-[10vh] !right-0 sm:!right-auto !bottom-0 sm:!bottom-auto !translate-x-0 !translate-y-0 overflow-hidden !p-0 gap-0 bg-white flex flex-col !m-0 !rounded-none sm:!rounded-lg !border-0 sm:!border\">\n          {/* DialogTitle ve DialogDescription DialogContent'in direkt child' olmal (Radix UI gereksinimi) */}\n          <DialogTitle className=\"sr-only\">\n            {material.name} - Hammadde Detay\n          </DialogTitle>\n          <DialogDescription className=\"sr-only\">\n            Hammadde detaylar ve bilgileri\n          </DialogDescription>\n          \n          <div className=\"flex flex-col h-full min-h-0\">\n            <DialogHeader className=\"p-3 sm:p-4 border-b bg-white flex-shrink-0\">\n              <div className=\"flex items-center justify-between gap-3\">\n                <div className=\"flex items-center gap-2 sm:gap-3 flex-1 min-w-0\">\n                  <div className=\"h-8 w-8 sm:h-10 sm:w-10 rounded-lg bg-primary/10 flex items-center justify-center border border-primary/20 flex-shrink-0\">\n                    <Package className=\"h-4 w-4 sm:h-5 sm:w-5 text-primary\" />\n                  </div>\n                  <h2 className=\"text-[16px] sm:text-[18px] font-semibold text-foreground truncate\">\n                    {material.name}\n                  </h2>\n                </div>\n                <div className=\"flex flex-wrap items-center gap-2 flex-shrink-0 relative z-10 pr-10 sm:pr-12\">\n                  <Badge variant={stockStatus.variant} className=\"text-xs px-2 sm:px-3 py-1 relative z-10\">\n                    {stockStatus.label}\n                  </Badge>\n                  {(canUpdate || material.createdBy === user?.id || isTeamLeader) && (\n                    <Button\n                      variant=\"outline\"\n                      size=\"sm\"\n                      onClick={onEdit}\n                      className=\"text-[11px] sm:text-xs min-h-[44px] sm:min-h-0\"\n                    >\n                      <Edit className=\"h-4 w-4 mr-2\" />\n                      Dzenle\n                    </Button>\n                  )}\n                  {canDelete && (\n                    <Button\n                      variant=\"outline\"\n                      size=\"sm\"\n                      onClick={handleDelete}\n                      disabled={deleting}\n                      className=\"text-[11px] sm:text-xs min-h-[44px] sm:min-h-0 text-destructive hover:text-destructive\"\n                    >\n                      <Trash2 className=\"h-4 w-4 mr-2\" />\n                      {deleting ? \"Siliniyor...\" : \"Sil\"}\n                    </Button>\n                  )}\n                </div>\n              </div>\n            </DialogHeader>\n\n            <div className=\"flex-1 overflow-hidden bg-gray-50/50 p-3 sm:p-4 min-h-0\">\n              <div className=\"max-w-full mx-auto h-full overflow-y-auto\">\n                <Tabs value={activeTab} onValueChange={setActiveTab} className=\"w-full\">\n                  <TabsList className=\"grid w-full grid-cols-3 mb-4 sm:mb-6 min-h-[44px] sm:min-h-0 overflow-hidden\">\n                    <TabsTrigger value=\"details\" className=\"text-[11px] sm:text-xs whitespace-nowrap overflow-hidden text-ellipsis\">\n                      Detaylar\n                    </TabsTrigger>\n                    <TabsTrigger value=\"recipes\" className=\"text-[11px] sm:text-xs whitespace-nowrap overflow-hidden text-ellipsis\">\n                      Reete\n                    </TabsTrigger>\n                    <TabsTrigger value=\"transactions\" className=\"text-[11px] sm:text-xs whitespace-nowrap overflow-hidden text-ellipsis\">\n                      Stok Hareketleri\n                    </TabsTrigger>\n                  </TabsList>\n\n                  <TabsContent value=\"details\" className=\"space-y-3 sm:space-y-4 mt-0\">\n                    <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4\">\n                      <div>\n                        <p className=\"text-[11px] sm:text-xs text-muted-foreground mb-1\">Stok Kodu</p>\n                        <p className=\"text-[11px] sm:text-xs font-medium\">{material.code || material.sku || \"-\"}</p>\n                      </div>\n                      <div>\n                        <p className=\"text-[11px] sm:text-xs text-muted-foreground mb-1\">Kategori</p>\n                        <p className=\"text-[11px] sm:text-xs font-medium\">{getCategoryLabel(material.category || \"other\")}</p>\n                      </div>\n                      <div>\n                        <p className=\"text-[11px] sm:text-xs text-muted-foreground mb-1\">Mevcut Stok</p>\n                        <p className=\"text-[11px] sm:text-xs font-medium text-lg sm:text-xl\">\n                          {material.currentStock !== undefined ? material.currentStock : (material.stock || 0)} {material.unit || \"Adet\"}\n                        </p>\n                      </div>\n                      <div>\n                        <p className=\"text-[11px] sm:text-xs text-muted-foreground mb-1\">Minimum Stok</p>\n                        <p className=\"text-[11px] sm:text-xs font-medium\">\n                          {material.minStock !== undefined ? material.minStock : (material.min_stock || 0)} {material.unit || \"Adet\"}\n                        </p>\n                      </div>\n                      {(material.maxStock !== undefined && material.maxStock !== null) || material.max_stock ? (\n                        <div>\n                          <p className=\"text-[11px] sm:text-xs text-muted-foreground mb-1\">Maksimum Stok</p>\n                          <p className=\"text-[11px] sm:text-xs font-medium\">\n                            {material.maxStock !== undefined ? material.maxStock : (material.max_stock || 0)} {material.unit || \"Adet\"}\n                          </p>\n                        </div>\n                      ) : null}\n                      {material.unitPrice !== undefined || material.cost ? (\n                        <div>\n                          <p className=\"text-[11px] sm:text-xs text-muted-foreground mb-1\">Birim Fiyat</p>\n                          <p className=\"text-[11px] sm:text-xs font-medium\">\n                            {(() => {\n                              const price = material.unitPrice !== undefined && material.unitPrice !== null ? material.unitPrice : (material.cost !== undefined && material.cost !== null ? material.cost : 0);\n                              const currency = material.currency || (material.currencies && material.currencies.length > 0 ? material.currencies[0] : \"TRY\");\n                              const symbol = CURRENCY_SYMBOLS[currency as keyof typeof CURRENCY_SYMBOLS] || \"\";\n                              return `${symbol}${(price || 0).toFixed(2)}`;\n                            })()}\n                          </p>\n                        </div>\n                      ) : null}\n                      {material.vatRate !== undefined && material.vatRate !== null && material.vatRate > 0 ? (\n                        <div>\n                          <p className=\"text-[11px] sm:text-xs text-muted-foreground mb-1\">KDV Yzdesi</p>\n                          <p className=\"text-[11px] sm:text-xs font-medium\">%{material.vatRate.toFixed(2)}</p>\n                        </div>\n                      ) : null}\n                      {material.totalPrice !== undefined && material.totalPrice !== null ? (\n                        <div>\n                          <p className=\"text-[11px] sm:text-xs text-muted-foreground mb-1\">Nihai Fiyat (KDV Dahil)</p>\n                          <p className=\"text-[11px] sm:text-xs font-medium\">\n                            {(() => {\n                              const currency = material.currency || (material.currencies && material.currencies.length > 0 ? material.currencies[0] : \"TRY\");\n                              const symbol = CURRENCY_SYMBOLS[currency as keyof typeof CURRENCY_SYMBOLS] || \"\";\n                              return `${symbol}${(material.totalPrice || 0).toFixed(2)}`;\n                            })()}\n                          </p>\n                          {material.unitPrice && material.vatRate && material.vatRate > 0 && (\n                            <p className=\"text-[11px] sm:text-xs text-muted-foreground mt-1\">\n                              {(() => {\n                                const currency = material.currency || (material.currencies && material.currencies.length > 0 ? material.currencies[0] : \"TRY\");\n                                const symbol = CURRENCY_SYMBOLS[currency as keyof typeof CURRENCY_SYMBOLS] || \"\";\n                                return `Birim: ${symbol}${material.unitPrice.toFixed(2)} + KDV (%${material.vatRate.toFixed(2)}): ${symbol}${((material.unitPrice * material.vatRate) / 100).toFixed(2)}`;\n                              })()}\n                            </p>\n                          )}\n                        </div>\n                      ) : null}\n                      {material.brand ? (\n                        <div>\n                          <p className=\"text-[11px] sm:text-xs text-muted-foreground mb-1\">Marka</p>\n                          <p className=\"text-[11px] sm:text-xs font-medium\">{material.brand}</p>\n                        </div>\n                      ) : null}\n                      {material.link ? (\n                      <div>\n                          <p className=\"text-[11px] sm:text-xs text-muted-foreground mb-1\">Link</p>\n                          <a\n                            href={material.link}\n                            target=\"_blank\"\n                            rel=\"noopener noreferrer\"\n                            className=\"text-[11px] sm:text-xs font-medium text-primary hover:underline break-all\"\n                          >\n                            {material.link}\n                          </a>\n                      </div>\n                      ) : null}\n                      {material.supplier ? (\n                        <div>\n                          <p className=\"text-[11px] sm:text-xs text-muted-foreground mb-1\">Tedariki</p>\n                          <p className=\"text-[11px] sm:text-xs font-medium\">{material.supplier}</p>\n                        </div>\n                      ) : null}\n                      {material.purchasedBy ? (\n                        <div>\n                          <p className=\"text-[11px] sm:text-xs text-muted-foreground mb-1\">Satn Alan Kii</p>\n                          <p className=\"text-[11px] sm:text-xs font-medium\">\n                            {(() => {\n                              const user = users.find(u => u.id === material.purchasedBy);\n                              return user ? (user.fullName || user.displayName || user.email || \"simsiz Kullanc\") : \"Ykleniyor...\";\n                            })()}\n                          </p>\n                        </div>\n                      ) : null}\n                      {material.createdBy ? (\n                        <div>\n                          <p className=\"text-[11px] sm:text-xs text-muted-foreground mb-1\">Ekleyen Kii</p>\n                          <p className=\"text-[11px] sm:text-xs font-medium\">\n                            {(() => {\n                              const creator = users.find(u => u.id === material.createdBy);\n                              return creator ? (creator.fullName || creator.email || \"simsiz Kullanc\") : \"Ykleniyor...\";\n                            })()}\n                          </p>\n                        </div>\n                      ) : null}\n                      {material.location ? (\n                        <div>\n                          <p className=\"text-[11px] sm:text-xs text-muted-foreground mb-1\">Hammadde Konumu</p>\n                          <p className=\"text-[11px] sm:text-xs font-medium\">{material.location}</p>\n                        </div>\n                      ) : null}\n                    </div>\n\n                    {(material.notes || material.description) && (\n                      <div>\n                        <p className=\"text-[11px] sm:text-xs text-muted-foreground mb-1\">Aklama</p>\n                        <p className=\"text-[11px] sm:text-xs\">{material.notes || material.description || \"\"}</p>\n                      </div>\n                    )}\n                  </TabsContent>\n\n                  <TabsContent value=\"recipes\" className=\"space-y-3 sm:space-y-4 mt-0\">\n                    <Card>\n                      <CardHeader>\n                        <CardTitle className=\"text-[14px] sm:text-[15px]\">Reete Ynetimi</CardTitle>\n                      </CardHeader>\n                      <CardContent className=\"space-y-6\">\n                        {/* Reete Ekleme Formu */}\n                        <div className=\"rounded-lg border bg-muted/30 p-4 sm:p-6\">\n                          <h3 className=\"text-[11px] sm:text-xs font-semibold mb-4\">Yeni Reete Ekle</h3>\n                          <div className=\"grid grid-cols-1 sm:grid-cols-3 gap-3 sm:gap-4\">\n                            <div className=\"space-y-1.5 sm:space-y-2\">\n                              <Label htmlFor=\"product-select\" className=\"text-[11px] sm:text-xs\">rn</Label>\n                              <Select\n                                value={selectedProduct}\n                                onValueChange={setSelectedProduct}\n                                disabled={productsLoading}\n                              >\n                                <SelectTrigger id=\"product-select\" className=\"text-[11px] sm:text-xs min-h-[44px] sm:min-h-0\">\n                                  <SelectValue placeholder=\"rn sein\" />\n                                </SelectTrigger>\n                                <SelectContent className=\"text-[11px] sm:text-xs\">\n                                  {products.map((product) => (\n                                    <SelectItem key={product.id} value={product.id} className=\"text-[11px] sm:text-xs\">\n                                      {product.name} {product.sku ? `(${product.sku})` : \"\"}\n                                    </SelectItem>\n                                  ))}\n                                </SelectContent>\n                              </Select>\n                            </div>\n                            <div className=\"space-y-1.5 sm:space-y-2\">\n                              <Label htmlFor=\"quantity-input\" className=\"text-[11px] sm:text-xs\">Miktar</Label>\n                              <Input\n                                id=\"quantity-input\"\n                                type=\"number\"\n                                step=\"0.01\"\n                                min=\"0.01\"\n                                value={newQuantity}\n                                onChange={(e) => setNewQuantity(e.target.value)}\n                                placeholder=\"Miktar\"\n                                className=\"text-[11px] sm:text-xs min-h-[44px] sm:min-h-0\"\n                              />\n                            </div>\n                            <div className=\"space-y-1.5 sm:space-y-2\">\n                              <Label className=\"text-[11px] sm:text-xs opacity-0\">Ekle</Label>\n                              <Button\n                                onClick={addRecipe}\n                                disabled={recipeLoading || !selectedProduct || !newQuantity}\n                                className=\"text-[11px] sm:text-xs w-full min-h-[44px] sm:min-h-0\"\n                              >\n                                {recipeLoading ? (\n                                  <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\n                                ) : (\n                                  <Plus className=\"mr-2 h-4 w-4\" />\n                                )}\n                                Ekle\n                              </Button>\n                            </div>\n                          </div>\n                        </div>\n\n                        {/* Reete Listesi */}\n                        {recipeLoading ? (\n                          <div className=\"flex items-center justify-center py-8\">\n                            <Loader2 className=\"h-6 w-6 animate-spin text-muted-foreground\" />\n                          </div>\n                        ) : recipes.length === 0 ? (\n                          <div className=\"text-center py-8 text-muted-foreground\">\n                            <Package className=\"h-12 w-12 mx-auto mb-4 opacity-50\" />\n                            <p className=\"text-[11px] sm:text-xs\">Bu hammadde henz hibir rnde kullanlmam</p>\n                          </div>\n                        ) : (\n                          <div className=\"rounded-lg border bg-white overflow-hidden\">\n                            <Table>\n                              <TableHeader>\n                                <TableRow>\n                                  <TableHead className=\"text-[11px] sm:text-xs\">rn Ad</TableHead>\n                                  <TableHead className=\"text-[11px] sm:text-xs\">Stok Kodu</TableHead>\n                                  <TableHead className=\"text-[11px] sm:text-xs\">Miktar</TableHead>\n                                  <TableHead className=\"text-[11px] sm:text-xs text-right\">lemler</TableHead>\n                                </TableRow>\n                              </TableHeader>\n                              <TableBody>\n                                {recipes.map((recipe) => {\n                                  const product = recipe.product;\n                                  return (\n                                    <TableRow key={recipe.id}>\n                                      <TableCell className=\"text-[11px] sm:text-xs font-medium\">\n                                        {product?.name || \"Silinmi rn\"}\n                                      </TableCell>\n                                      <TableCell className=\"text-[11px] sm:text-xs text-muted-foreground font-mono\">\n                                        {product?.sku || \"-\"}\n                                      </TableCell>\n                                      <TableCell className=\"text-[11px] sm:text-xs\">\n                                        <span className=\"font-medium\">{recipe.quantityPerUnit}</span>\n                                        <span className=\"text-[11px] sm:text-xs text-muted-foreground ml-1\">\n                                          {material.unit || \"Adet\"}\n                                        </span>\n                                      </TableCell>\n                                      <TableCell className=\"text-right\">\n                                        <Button\n                                          variant=\"ghost\"\n                                          size=\"sm\"\n                                          onClick={() => removeRecipe(recipe.id)}\n                                          className=\"text-[11px] sm:text-xs h-8 w-8 p-0 text-destructive hover:text-destructive min-h-[44px] sm:min-h-0\"\n                                        >\n                                          <Trash2 className=\"h-4 w-4\" />\n                                        </Button>\n                                      </TableCell>\n                                    </TableRow>\n                                  );\n                                })}\n                              </TableBody>\n                            </Table>\n                          </div>\n                        )}\n                      </CardContent>\n                    </Card>\n                  </TabsContent>\n\n                  <TabsContent value=\"transactions\" className=\"space-y-3 sm:space-y-4 mt-0\">\n                    <Card>\n                      <CardHeader>\n                        <CardTitle className=\"text-[14px] sm:text-[15px]\">Stok Hareketleri</CardTitle>\n                      </CardHeader>\n                      <CardContent>\n                        {transactionsLoading ? (\n                          <div className=\"flex items-center justify-center py-8\">\n                            <Loader2 className=\"h-6 w-6 animate-spin text-muted-foreground\" />\n                          </div>\n                        ) : transactions.length === 0 ? (\n                          <div className=\"text-center py-8 text-muted-foreground\">\n                            <Package className=\"h-12 w-12 mx-auto mb-4 opacity-50\" />\n                            <p className=\"text-[11px] sm:text-xs\">Henz stok hareketi yaplmam</p>\n                          </div>\n                        ) : (\n                          <div className=\"overflow-x-auto\">\n                            <Table>\n                              <TableHeader>\n                                <TableRow>\n                                  <TableHead className=\"text-[11px] sm:text-xs\">Tarih</TableHead>\n                                  <TableHead className=\"text-[11px] sm:text-xs\">lem Tr</TableHead>\n                                  <TableHead className=\"text-[11px] sm:text-xs text-right\">Miktar</TableHead>\n                                  <TableHead className=\"text-[11px] sm:text-xs\">Sipari</TableHead>\n                                  <TableHead className=\"text-[11px] sm:text-xs\">rn</TableHead>\n                                  <TableHead className=\"text-[11px] sm:text-xs\">Kullanc</TableHead>\n                                  <TableHead className=\"text-[11px] sm:text-xs\">Aklama</TableHead>\n                                </TableRow>\n                              </TableHeader>\n                              <TableBody>\n                                {transactions.map((t) => {\n                                  const orderInfo = t.relatedOrderId ? ordersMap[t.relatedOrderId] : null;\n                                  const userName = usersMap[t.createdBy] || \"Bilinmeyen\";\n                                  \n                                  return (\n                                    <TableRow key={t.id}>\n                                      <TableCell className=\"text-[11px] sm:text-xs whitespace-nowrap\">\n                                        {formatTransactionDate(t.createdAt)}\n                                      </TableCell>\n                                      <TableCell>\n                                        <Badge variant={t.type === \"in\" ? \"default\" : \"destructive\"} className=\"text-[10px]\">\n                                          {t.type === \"in\" ? \"Giri\" : \"k\"}\n                                        </Badge>\n                                      </TableCell>\n                                      <TableCell\n                                        className={`text-[11px] sm:text-xs text-right font-medium whitespace-nowrap ${\n                                          t.type === \"in\" ? \"text-green-600\" : \"text-red-600\"\n                                        }`}\n                                      >\n                                        {t.type === \"in\" ? \"+\" : \"-\"}\n                                        {t.quantity}\n                                      </TableCell>\n                                      <TableCell className=\"text-[11px] sm:text-xs\">\n                                        {orderInfo ? (\n                                          <div className=\"flex items-center gap-2\">\n                                            <span className=\"font-medium\">{orderInfo.orderNumber}</span>\n                                            {t.relatedOrderId && (\n                                              <Button\n                                                variant=\"ghost\"\n                                                size=\"sm\"\n                                                className=\"text-[11px] sm:text-xs h-6 w-6 p-0\"\n                                                onClick={() => {\n                                                  window.open(`/production?orderId=${t.relatedOrderId}`, '_blank');\n                                                }}\n                                                title=\"Siparii a\"\n                                              >\n                                                <ExternalLink className=\"h-3 w-3\" />\n                                              </Button>\n                                            )}\n                                          </div>\n                                        ) : (\n                                          \"-\"\n                                        )}\n                                      </TableCell>\n                                      <TableCell className=\"text-[11px] sm:text-xs\">\n                                        {orderInfo?.productName || \"-\"}\n                                      </TableCell>\n                                      <TableCell className=\"text-[11px] sm:text-xs\">\n                                        {userName}\n                                      </TableCell>\n                                      <TableCell className=\"text-[11px] sm:text-xs max-w-xs truncate\" title={t.reason}>\n                                        {t.reason || \"-\"}\n                                      </TableCell>\n                                    </TableRow>\n                                  );\n                                })}\n                              </TableBody>\n                            </Table>\n                          </div>\n                        )}\n                      </CardContent>\n                    </Card>\n                  </TabsContent>\n                </Tabs>\n              </div>\n            </div>\n          </div>\n        </DialogContent>\n        \n        {/* Activity Comments Panel */}\n        {material?.id && user && (\n          <ActivityCommentsPanel\n            entityId={material.id}\n            entityType=\"material\"\n            onAddComment={async (content: string) => {\n              await addMaterialComment(\n                material.id,\n                user.id,\n                content,\n                user.fullName,\n                user.email\n              );\n            }}\n            onGetComments={async () => {\n              return await getMaterialComments(material.id);\n            }}\n            onGetActivities={async () => {\n              return await getMaterialActivities(material.id);\n            }}\n            currentUserId={user.id}\n            currentUserName={user.fullName}\n            currentUserEmail={user.email}\n          />\n        )}\n      </Dialog>\n    </>\n  );\n};\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\components\\Reports\\CustomerReportDialog.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\components\\Reports\\FinancialReportDialog.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useCallback has a missing dependency: 'getOrderMonth'. Either include it or remove the dependency array.","line":321,"column":6,"nodeType":"ArrayExpression","endLine":321,"endColumn":26,"suggestions":[{"desc":"Update the dependencies array to be: [startDate, endDate, getOrderMonth]","fix":{"range":[11161,11181],"text":"[startDate, endDate, getOrderMonth]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect, useCallback } from \"react\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogDescription } from \"@/components/ui/dialog\";\nimport { Button } from \"@/components/ui/button\";\nimport { Label } from \"@/components/ui/label\";\nimport { Input } from \"@/components/ui/input\";\nimport { toast } from \"sonner\";\nimport { getOrders, getOrderItems, Order, OrderItem } from \"@/services/firebase/orderService\";\nimport { Download, DollarSign, TrendingUp, ArrowDown, ArrowUp, Percent, Calendar, Clock } from \"lucide-react\";\n// pdfGenerator will be dynamically imported when needed\nimport { useAuth } from \"@/contexts/AuthContext\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from \"@/components/ui/table\";\nimport { Timestamp } from \"firebase/firestore\";\nimport { convertToTRY } from \"@/services/exchangeRateService\";\nimport { getRawMaterials } from \"@/services/firebase/materialService\";\n\ntype FinancialOrderItem = OrderItem & {\n  cost?: number;\n  total?: number;\n  currency?: string;\n  raw_material_id?: string;\n};\n\ntype OrderWithItems = Order & {\n  total?: number;\n  order_items: FinancialOrderItem[];\n};\n\ntype MonthlyTrendPoint = {\n  month: string;\n  revenue: number;\n  cost: number;\n  profit: number;\n};\n\ntype ProductProfitabilityPoint = {\n  name: string;\n  revenue: number;\n  cost: number;\n  profit: number;\n};\n\ntype CostBreakdownItem = {\n  category: string;\n  amount: number;\n  percentage: number;\n};\n\ninterface FinancialReportData {\n  totalRevenue: number;\n  totalCost: number;\n  grossProfit: number;\n  profitMargin: number;\n  monthlyTrend: MonthlyTrendPoint[];\n  topProfitableProducts: ProductProfitabilityPoint[];\n  costBreakdown?: CostBreakdownItem[];\n}\n\ninterface FinancialReportDialogProps {\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n}\n\nexport const FinancialReportDialog = ({ open, onOpenChange }: FinancialReportDialogProps) => {\n  const { user } = useAuth();\n  const [loading, setLoading] = useState(false);\n  const [startDate, setStartDate] = useState(\"\");\n  const [endDate, setEndDate] = useState(\"\");\n  const [reportData, setReportData] = useState<FinancialReportData | null>(null);\n\n  const getOrderDate = (order: Order): Date => {\n    if (order.createdAt instanceof Timestamp) {\n      return order.createdAt.toDate();\n    }\n    if (order.created_at) {\n      const date = new Date(order.created_at);\n      if (!Number.isNaN(date.getTime())) {\n        return date;\n      }\n    }\n    return new Date();\n  };\n\n  const getOrderMonth = (order: Order): string => {\n    if (order.order_date) {\n      return new Date(order.order_date).toISOString().slice(0, 7);\n    }\n    if (order.created_at) {\n      return new Date(order.created_at).toISOString().slice(0, 7);\n    }\n    const created = getOrderDate(order);\n    return created.toISOString().slice(0, 7);\n  };\n\n  const getOrderTotal = (order: Order & { total?: number }): number => {\n    return (\n      order.total ??\n      order.totalAmount ??\n      order.total_amount ??\n      order.subtotal ??\n      0\n    );\n  };\n\n  const getItemCost = (item: FinancialOrderItem): number => {\n    return item.cost ?? item.unit_price ?? item.unitPrice ?? 0;\n  };\n\n  const fetchReportData = useCallback(async () => {\n    if (!startDate || !endDate) {\n      setReportData(null);\n      return;\n    }\n\n    setLoading(true);\n    try {\n      // Firebase'den siparileri al\n      const allOrders = await getOrders();\n      \n      // Tarih filtresi uygula\n      const filteredOrders = allOrders.filter((order) => {\n        const orderDate = getOrderDate(order);\n        const orderDateStr = orderDate.toISOString().split(\"T\")[0];\n        return orderDateStr >= startDate && orderDateStr <= endDate;\n      });\n      \n      // Fetch order items for each order\n      const ordersWithItems = await Promise.all(\n        filteredOrders.map(async (order): Promise<OrderWithItems> => {\n          try {\n            const items = await getOrderItems(order.id);\n            return { ...order, order_items: items as FinancialOrderItem[] };\n          } catch (err) {\n            console.error(\"Get order items error:\", err);\n            return { ...order, order_items: [] };\n          }\n        })\n      );\n\n      // Gelir hesaplama\n      const totalRevenue =\n        ordersWithItems?.reduce((sum, currentOrder) => sum + getOrderTotal(currentOrder), 0) || 0;\n      \n      // Gider hesaplama (rn maliyeti  miktar)\n      // Hammadde maliyetlerini de dahil et ve exchange rate ile evir\n      const rawMaterials = await getRawMaterials();\n      const materialMap = new Map(rawMaterials.map(m => [m.id, m]));\n      \n      let totalCost = 0;\n      const costPromises = ordersWithItems?.flatMap((order) =>\n        order.order_items?.map(async (item) => {\n          const itemCost = getItemCost(item);\n          let costInTRY = itemCost;\n          \n          // Eer item'da para birimi bilgisi varsa ve TRY deilse evir\n          if (item.currency && item.currency !== 'TRY') {\n            try {\n              costInTRY = await convertToTRY(itemCost, item.currency);\n            } catch (error) {\n              console.warn(`Exchange rate conversion failed for ${item.currency}, using original value`);\n            }\n          }\n          \n          // Hammadde maliyetlerini de kontrol et\n          if (item.raw_material_id && materialMap.has(item.raw_material_id)) {\n            const material = materialMap.get(item.raw_material_id)!;\n            if (material.unitPrice) {\n              let materialCostInTRY = material.unitPrice;\n              \n              // Hammadde para birimini kontrol et\n              if (material.currency && material.currency !== 'TRY') {\n                try {\n                  materialCostInTRY = await convertToTRY(material.unitPrice, material.currency);\n                } catch (error) {\n                  console.warn(`Exchange rate conversion failed for material ${material.currency}, using original value`);\n                }\n              }\n              \n              // Hammadde maliyetini ekle (miktar  birim fiyat)\n              costInTRY += (materialCostInTRY * (item.quantity || 1));\n            }\n          }\n          \n          return costInTRY * item.quantity;\n        }) || []\n      ) || [];\n      \n      const costs = await Promise.all(costPromises);\n      totalCost = costs.reduce((sum, cost) => sum + cost, 0);\n\n      const grossProfit = totalRevenue - totalCost;\n      const profitMargin = totalRevenue > 0 ? (grossProfit / totalRevenue) * 100 : 0;\n\n      // Aylk gelir-gider trendi\n      const monthlyData = new Map<string, { revenue: number; cost: number }>();\n      \n      // Tm sipariler iin maliyetleri paralel hesapla\n      const monthlyCostPromises = ordersWithItems?.map(async (order) => {\n        const month = getOrderMonth(order);\n        const orderTotal = getOrderTotal(order);\n        \n        // Exchange rate ile maliyetleri evir\n        const itemCostPromises = order.order_items?.map(async (item) => {\n          const itemCost = getItemCost(item);\n          let costInTRY = itemCost;\n          \n          if (item.currency && item.currency !== 'TRY') {\n            try {\n              costInTRY = await convertToTRY(itemCost, item.currency);\n            } catch (error) {\n              console.warn(`Exchange rate conversion failed, using original value`);\n            }\n          }\n          \n          return costInTRY * item.quantity;\n        }) || [];\n        \n        const itemCosts = await Promise.all(itemCostPromises);\n        const totalCost = itemCosts.reduce((sum, cost) => sum + cost, 0);\n        \n        return { month, revenue: orderTotal, cost: totalCost };\n      }) || [];\n      \n      const monthlyResults = await Promise.all(monthlyCostPromises);\n      \n      monthlyResults.forEach(({ month, revenue, cost }) => {\n        if (!monthlyData.has(month)) {\n          monthlyData.set(month, { revenue: 0, cost: 0 });\n        }\n        const data = monthlyData.get(month)!;\n        data.revenue += revenue;\n        data.cost += cost;\n      });\n\n      const monthlyTrend = Array.from(monthlyData.entries())\n        .map(([month, data]) => ({\n          month,\n          revenue: data.revenue,\n          cost: data.cost,\n          profit: data.revenue - data.cost\n        }))\n        .sort((a, b) => a.month.localeCompare(b.month));\n\n      // rn karll\n      const productProfitability = new Map<string, { name: string; revenue: number; cost: number }>();\n      \n      // Tm item'lar iin maliyetleri paralel hesapla\n      const productCostPromises = ordersWithItems?.flatMap((order) =>\n        order.order_items?.map(async (item) => {\n          const productName = item.product_name || \"Bilinmeyen\";\n          const itemCost = getItemCost(item);\n          let costInTRY = itemCost;\n          \n          if (item.currency && item.currency !== 'TRY') {\n            try {\n              costInTRY = await convertToTRY(itemCost, item.currency);\n            } catch (error) {\n              console.warn(`Exchange rate conversion failed, using original value`);\n            }\n          }\n          \n          return {\n            productName,\n            revenue: item.total ?? 0,\n            cost: costInTRY * item.quantity,\n          };\n        }) || []\n      ) || [];\n      \n      const productResults = await Promise.all(productCostPromises);\n      productResults.forEach(({ productName, revenue, cost }) => {\n        if (!productProfitability.has(productName)) {\n          productProfitability.set(productName, { name: productName, revenue: 0, cost: 0 });\n        }\n        const prod = productProfitability.get(productName)!;\n        prod.revenue += revenue;\n        prod.cost += cost;\n      });\n\n      const topProfitableProducts = Array.from(productProfitability.values())\n        .map(p => ({ ...p, profit: p.revenue - p.cost }))\n        .sort((a, b) => b.profit - a.profit)\n        .slice(0, 10);\n\n      // Gider Kalemleri Analizi - rn baznda grupla\n      const costBreakdownMap = new Map<string, number>();\n      productResults.forEach(({ productName, cost }) => {\n        if (!costBreakdownMap.has(productName)) {\n          costBreakdownMap.set(productName, 0);\n        }\n        costBreakdownMap.set(productName, costBreakdownMap.get(productName)! + cost);\n      });\n\n      const costBreakdown: CostBreakdownItem[] = Array.from(costBreakdownMap.entries())\n        .map(([category, amount]) => ({\n          category,\n          amount,\n          percentage: totalCost > 0 ? (amount / totalCost) * 100 : 0\n        }))\n        .sort((a, b) => b.amount - a.amount)\n        .slice(0, 10); // En yksek 10 gider kalemi\n\n      const data: FinancialReportData = {\n        totalRevenue,\n        totalCost,\n        grossProfit,\n        profitMargin,\n        monthlyTrend,\n        topProfitableProducts,\n        costBreakdown\n      };\n\n      setReportData(data);\n    } catch (error) {\n      console.error(\"Fetch report data error:\", error);\n      toast.error(\"Veri yklenirken hata olutu\");\n    } finally {\n      setLoading(false);\n    }\n  }, [startDate, endDate]);\n\n  // Tarih deitiinde otomatik veri gncelleme\n  useEffect(() => {\n    if (startDate && endDate) {\n      const timeoutId = setTimeout(() => {\n        fetchReportData();\n      }, 500); // Debounce\n      return () => clearTimeout(timeoutId);\n    }\n  }, [startDate, endDate, fetchReportData]);\n\n  const generateReport = async () => {\n    if (!startDate || !endDate) {\n      toast.error(\"Ltfen tarih aral sein\");\n      return;\n    }\n\n    if (!reportData) {\n      toast.error(\"Ltfen nce rapor verilerini ykleyin\");\n      return;\n    }\n\n    setLoading(true);\n    try {\n      // Dynamically import pdfGenerator to avoid loading it on initial page load\n      const { generateFinancialReportPDF } = await import(\"@/services/pdfGenerator\");\n      // PDF olutur - await ile bekle\n      const pdfBlob = await generateFinancialReportPDF(reportData, startDate, endDate);\n      \n      // PDF'i hemen indir (Drive upload'n beklemeden)\n      const url = URL.createObjectURL(pdfBlob);\n      const a = document.createElement(\"a\");\n      a.href = url;\n      const reportDate = new Date().toISOString().split('T')[0];\n      a.download = `Mali-Rapor-${startDate}-${endDate}-${reportDate}.pdf`;\n      document.body.appendChild(a);\n      a.click();\n      document.body.removeChild(a);\n      setTimeout(() => URL.revokeObjectURL(url), 100);\n      \n      toast.success(\"Rapor indiriliyor...\");\n      \n      // Loading'i kapat (indirme balad, Drive upload arka planda devam edecek)\n      setLoading(false);\n\n      // PDF'i Storage'a kaydet (Arka planda, kullancy bekletmeden)\n      (async () => {\n        try {\n          const { saveReport } = await import(\"@/services/firebase/reportService\");\n          const reportTitle = `Mali Rapor - ${startDate} / ${endDate}`;\n          await saveReport(\"financial\", reportTitle, pdfBlob, user?.id || \"\", {\n            startDate,\n            endDate,\n            metadata: { totalRevenue: reportData.totalRevenue, grossProfit: reportData.grossProfit },\n          });\n          toast.success(\"Rapor buluta yedeklendi.\");\n        } catch (error) {\n          console.warn(\"Rapor buluta kaydedilemedi (CORS/Yetki):\", error);\n        }\n      })();\n\n    } catch (error) {\n      const message = error instanceof Error ? error.message : \"Bilinmeyen hata\";\n      toast.error(\"Hata: \" + message);\n      setLoading(false);\n    }\n  };\n\n  return (\n    <Dialog open={open} onOpenChange={onOpenChange}>\n      <DialogContent className=\"sm:!max-w-[85vw] sm:!w-[85vw] sm:!h-[80vh] sm:!max-h-[80vh] sm:!left-[7.5vw] sm:!top-[10vh] sm:!translate-x-0 sm:!translate-y-0 flex flex-col p-0 overflow-hidden\">\n        {/* DialogTitle ve DialogDescription DialogContent'in direkt child' olmal (Radix UI gereksinimi) */}\n        <DialogTitle className=\"sr-only\">Mali Rapor Olutur</DialogTitle>\n        <DialogDescription className=\"sr-only\">Tarih aral seerek detayl mali rapor oluturun ve PDF olarak indirin</DialogDescription>\n        \n        <DialogHeader className=\"px-3 pt-3 pb-2 border-b bg-[rgb(255,255,255)] flex-shrink-0 sticky top-0 z-[10001] shadow-sm\">\n          <h2 className=\"text-[16px] sm:text-[18px] font-semibold flex items-center gap-2 leading-tight\">\n            <div className=\"h-6 w-6 sm:h-7 sm:w-7 rounded-lg bg-emerald-500/10 flex items-center justify-center\">\n              <DollarSign className=\"h-3.5 w-3.5 sm:h-4 sm:w-4 text-emerald-600\" />\n            </div>\n            Mali Rapor Olutur\n          </h2>\n          <p className=\"text-[11px] sm:text-xs text-muted-foreground mt-1 leading-snug\">\n            Tarih aral seerek detayl mali rapor oluturun ve PDF olarak indirin\n          </p>\n        </DialogHeader>\n        <div className=\"flex-1 min-h-0 overflow-y-auto overflow-x-hidden -webkit-overflow-scrolling-touch overscroll-behavior-contain\">\n          <div className=\"w-full p-2 space-y-2\">\n          {/* Tarih Seimi - Profesyonel Tasarm */}\n          <Card className=\"bg-[rgb(249,250,251)] border-2\">\n            <CardHeader className=\"pb-3\">\n              <CardTitle className=\"text-[14px] sm:text-[15px] font-semibold text-muted-foreground\">Tarih Aral Seimi</CardTitle>\n            </CardHeader>\n            <CardContent>\n              {/* Hzl Tarih Seenekleri */}\n              <div className=\"mb-4\">\n                <Label className=\"text-xs font-medium text-muted-foreground mb-2 block\">Hzl Seim</Label>\n                <div className=\"flex flex-wrap gap-2\">\n                  <Button\n                    type=\"button\"\n                    variant=\"outline\"\n                    size=\"sm\"\n                    onClick={() => {\n                      const today = new Date();\n                      const start = new Date(today);\n                      start.setDate(today.getDate() - 7);\n                      setStartDate(start.toISOString().split('T')[0]);\n                      setEndDate(today.toISOString().split('T')[0]);\n                    }}\n                    className=\"text-xs\"\n                  >\n                    <Clock className=\"h-3 w-3 mr-1\" />\n                    Son 7 Gn\n                  </Button>\n                  <Button\n                    type=\"button\"\n                    variant=\"outline\"\n                    size=\"sm\"\n                    onClick={() => {\n                      const today = new Date();\n                      const start = new Date(today);\n                      start.setDate(today.getDate() - 30);\n                      setStartDate(start.toISOString().split('T')[0]);\n                      setEndDate(today.toISOString().split('T')[0]);\n                    }}\n                    className=\"text-xs\"\n                  >\n                    <Calendar className=\"h-3 w-3 mr-1\" />\n                    Son 30 Gn\n                  </Button>\n                  <Button\n                    type=\"button\"\n                    variant=\"outline\"\n                    size=\"sm\"\n                    onClick={() => {\n                      const today = new Date();\n                      const start = new Date(today.getFullYear(), today.getMonth(), 1);\n                      setStartDate(start.toISOString().split('T')[0]);\n                      setEndDate(today.toISOString().split('T')[0]);\n                    }}\n                    className=\"text-xs\"\n                  >\n                    Bu Ay\n                  </Button>\n                  <Button\n                    type=\"button\"\n                    variant=\"outline\"\n                    size=\"sm\"\n                    onClick={() => {\n                      const today = new Date();\n                      const start = new Date(today.getFullYear(), today.getMonth() - 1, 1);\n                      const end = new Date(today.getFullYear(), today.getMonth(), 0);\n                      setStartDate(start.toISOString().split('T')[0]);\n                      setEndDate(end.toISOString().split('T')[0]);\n                    }}\n                    className=\"text-xs\"\n                  >\n                    Geen Ay\n                  </Button>\n                  <Button\n                    type=\"button\"\n                    variant=\"outline\"\n                    size=\"sm\"\n                    onClick={() => {\n                      const today = new Date();\n                      const start = new Date(today.getFullYear(), 0, 1);\n                      setStartDate(start.toISOString().split('T')[0]);\n                      setEndDate(today.toISOString().split('T')[0]);\n                    }}\n                    className=\"text-xs\"\n                  >\n                    Bu Yl\n                  </Button>\n                </div>\n              </div>\n              \n          <div className=\"grid grid-cols-2 gap-4\">\n            <div className=\"space-y-2\">\n                  <Label className=\"text-[11px] sm:text-xs font-medium\">Balang Tarihi</Label>\n                  <Input \n                    type=\"date\" \n                    value={startDate} \n                    onChange={(e) => setStartDate(e.target.value)}\n                    className=\"border-2 focus:border-primary\"\n                  />\n            </div>\n            <div className=\"space-y-2\">\n                  <Label className=\"text-[11px] sm:text-xs font-medium\">Biti Tarihi</Label>\n                  <Input \n                    type=\"date\" \n                    value={endDate} \n                    onChange={(e) => setEndDate(e.target.value)}\n                    className=\"border-2 focus:border-primary\"\n                  />\n            </div>\n          </div>\n            </CardContent>\n          </Card>\n\n          {loading && !reportData && (\n            <Card className=\"border-2 border-dashed\">\n              <CardContent className=\"py-12\">\n                <div className=\"flex flex-col items-center justify-center gap-3\">\n                  <div className=\"h-8 w-8 border-4 border-primary border-t-transparent rounded-full animate-spin\"></div>\n                  <p className=\"text-[11px] sm:text-xs font-medium text-muted-foreground\">Veriler ykleniyor...</p>\n                </div>\n              </CardContent>\n            </Card>\n          )}\n\n          {reportData && (\n            <div className=\"space-y-6 border-t pt-6\">\n              <div className=\"flex items-center justify-between mb-4\">\n                <h3 className=\"text-[14px] sm:text-[15px] font-bold flex items-center gap-2\">\n                  <div className=\"h-2 w-2 rounded-full bg-primary\"></div>\n                  Rapor nizlemesi\n                </h3>\n                <Badge variant=\"outline\" className=\"text-xs\">\n                  {startDate} - {endDate}\n                </Badge>\n              </div>\n              <div className=\"grid grid-cols-4 gap-4\">\n                <Card className=\"bg-[rgb(240,253,244)] border-[rgb(187,247,208)] border-2\">\n                  <CardHeader className=\"pb-3\">\n                    <CardTitle className=\"text-[14px] sm:text-[15px] font-semibold text-muted-foreground flex items-center gap-2\">\n                      <TrendingUp className=\"h-4 w-4 text-green-500\" />\n                      Toplam Gelir\n                    </CardTitle>\n                  </CardHeader>\n                  <CardContent>\n                    <p className=\"text-[11px] sm:text-xs font-bold text-green-600\">{reportData.totalRevenue.toLocaleString(\"tr-TR\", { minimumFractionDigits: 2, maximumFractionDigits: 2 })}</p>\n                    <p className=\"text-[11px] sm:text-xs text-muted-foreground mt-1\">Toplam ciro</p>\n                  </CardContent>\n                </Card>\n                <Card className=\"bg-[rgb(254,242,242)] border-[rgb(254,202,202)] border-2\">\n                  <CardHeader className=\"pb-3\">\n                    <CardTitle className=\"text-[14px] sm:text-[15px] font-semibold text-muted-foreground flex items-center gap-2\">\n                      <ArrowDown className=\"h-4 w-4 text-red-500\" />\n                      Toplam Gider\n                    </CardTitle>\n                  </CardHeader>\n                  <CardContent>\n                    <p className=\"text-[11px] sm:text-xs font-bold text-red-600\">{reportData.totalCost.toLocaleString(\"tr-TR\", { minimumFractionDigits: 2, maximumFractionDigits: 2 })}</p>\n                    <p className=\"text-[11px] sm:text-xs text-muted-foreground mt-1\">Toplam maliyet</p>\n                  </CardContent>\n                </Card>\n                <Card className=\"bg-[rgb(236,253,245)] border-[rgb(167,243,208)] border-2\">\n                  <CardHeader className=\"pb-3\">\n                    <CardTitle className=\"text-[14px] sm:text-[15px] font-semibold text-muted-foreground flex items-center gap-2\">\n                      <ArrowUp className=\"h-4 w-4 text-emerald-500\" />\n                      Brt Kar\n                    </CardTitle>\n                  </CardHeader>\n                  <CardContent>\n                    <p className=\"text-[11px] sm:text-xs font-bold text-emerald-600\">{reportData.grossProfit.toLocaleString(\"tr-TR\", { minimumFractionDigits: 2, maximumFractionDigits: 2 })}</p>\n                    <p className=\"text-[11px] sm:text-xs text-muted-foreground mt-1\">Net kar</p>\n                  </CardContent>\n                </Card>\n                <Card className=\"bg-[rgb(255,255,255)] border-[rgb(221,83,53)] border-2\" style={{ backgroundColor: 'rgba(221, 83, 53, 0.05)' }}>\n                  <CardHeader className=\"pb-3\">\n                    <CardTitle className=\"text-[14px] sm:text-[15px] font-semibold text-muted-foreground flex items-center gap-2\">\n                      <Percent className=\"h-4 w-4 text-primary\" />\n                      Kar Marj\n                    </CardTitle>\n                  </CardHeader>\n                  <CardContent>\n                    <p className=\"text-[11px] sm:text-xs font-bold text-primary\">{reportData.profitMargin.toFixed(1)}%</p>\n                    <p className=\"text-[11px] sm:text-xs text-muted-foreground mt-1\">Karllk oran</p>\n                  </CardContent>\n                </Card>\n              </div>\n\n              {/* Aylk Trend Tablosu */}\n              <Card className=\"border-2 shadow-sm\">\n                <CardHeader className=\"bg-[rgb(249,250,251)] border-b\">\n                  <CardTitle className=\"text-[13px] sm:text-[14px] font-semibold flex items-center gap-2\">\n                    <div className=\"h-1 w-1 rounded-full bg-primary\"></div>\n                    Aylk Gelir-Gider-Kar Trendi\n                  </CardTitle>\n                </CardHeader>\n                <CardContent className=\"p-0\">\n                  <div className=\"overflow-x-auto\">\n                    <Table>\n                      <TableHeader>\n                        <TableRow className=\"bg-gray-50/50\">\n                          <TableHead className=\"font-semibold\">Ay</TableHead>\n                          <TableHead className=\"text-right font-semibold\">Gelir</TableHead>\n                          <TableHead className=\"text-right font-semibold\">Gider</TableHead>\n                          <TableHead className=\"text-right font-semibold\">Kar</TableHead>\n                        </TableRow>\n                      </TableHeader>\n                      <TableBody>\n                        {reportData.monthlyTrend.map((item, index) => {\n                          const [year, month] = item.month.split('-');\n                          const monthLabels: Record<string, string> = {\n                            '01': 'Ocak', '02': 'ubat', '03': 'Mart', '04': 'Nisan',\n                            '05': 'Mays', '06': 'Haziran', '07': 'Temmuz', '08': 'Austos',\n                            '09': 'Eyll', '10': 'Ekim', '11': 'Kasm', '12': 'Aralk'\n                          };\n                          const monthLabel = monthLabels[month] || month;\n                          return (\n                            <TableRow key={index} className=\"hover:bg-gray-50/50 transition-colors\">\n                              <TableCell className=\"font-medium\">{monthLabel} {year}</TableCell>\n                              <TableCell className=\"text-right font-semibold text-green-600\">{item.revenue.toLocaleString(\"tr-TR\", { minimumFractionDigits: 2, maximumFractionDigits: 2 })}</TableCell>\n                              <TableCell className=\"text-right font-semibold text-red-600\">{item.cost.toLocaleString(\"tr-TR\", { minimumFractionDigits: 2, maximumFractionDigits: 2 })}</TableCell>\n                              <TableCell className=\"text-right font-semibold text-emerald-600\">{item.profit.toLocaleString(\"tr-TR\", { minimumFractionDigits: 2, maximumFractionDigits: 2 })}</TableCell>\n                            </TableRow>\n                          );\n                        })}\n                      </TableBody>\n                    </Table>\n                  </div>\n                </CardContent>\n              </Card>\n\n              {/* En Karl rnler Tablosu */}\n              <Card className=\"border-2 shadow-sm\">\n                <CardHeader className=\"bg-[rgb(249,250,251)] border-b\">\n                  <CardTitle className=\"text-[13px] sm:text-[14px] font-semibold flex items-center gap-2\">\n                    <div className=\"h-1 w-1 rounded-full bg-primary\"></div>\n                    En Karl rnler\n                  </CardTitle>\n                </CardHeader>\n                <CardContent className=\"p-0\">\n                  <div className=\"overflow-x-auto\">\n                    <Table>\n                      <TableHeader>\n                        <TableRow className=\"bg-gray-50/50\">\n                          <TableHead className=\"font-semibold\">Sra</TableHead>\n                          <TableHead className=\"font-semibold\">rn</TableHead>\n                          <TableHead className=\"text-right font-semibold\">Gelir</TableHead>\n                          <TableHead className=\"text-right font-semibold\">Gider</TableHead>\n                          <TableHead className=\"text-right font-semibold\">Kar</TableHead>\n                        </TableRow>\n                      </TableHeader>\n                      <TableBody>\n                        {reportData.topProfitableProducts.slice(0, 10).map((product, index) => (\n                          <TableRow key={index} className=\"hover:bg-gray-50/50 transition-colors\">\n                            <TableCell className=\"font-medium text-muted-foreground\">#{index + 1}</TableCell>\n                            <TableCell className=\"font-medium\">{product.name}</TableCell>\n                            <TableCell className=\"text-right font-semibold text-green-600\">{product.revenue.toLocaleString(\"tr-TR\", { minimumFractionDigits: 2, maximumFractionDigits: 2 })}</TableCell>\n                            <TableCell className=\"text-right font-semibold text-red-600\">{product.cost.toLocaleString(\"tr-TR\", { minimumFractionDigits: 2, maximumFractionDigits: 2 })}</TableCell>\n                            <TableCell className=\"text-right font-semibold text-emerald-600\">{product.profit.toLocaleString(\"tr-TR\", { minimumFractionDigits: 2, maximumFractionDigits: 2 })}</TableCell>\n                          </TableRow>\n                        ))}\n                      </TableBody>\n                    </Table>\n                  </div>\n                </CardContent>\n              </Card>\n\n              {/* Gider Kalemleri Analizi Tablosu - En Karl rnler ile ayn yap */}\n              {reportData.costBreakdown && reportData.costBreakdown.length > 0 && (\n                <Card className=\"border-2 shadow-sm\">\n                  <CardHeader className=\"bg-[rgb(249,250,251)] border-b\">\n                    <CardTitle className=\"text-[13px] sm:text-[14px] font-semibold flex items-center gap-2\">\n                      <div className=\"h-1 w-1 rounded-full bg-primary\"></div>\n                      Gider Kalemleri Analizi\n                    </CardTitle>\n                  </CardHeader>\n                  <CardContent className=\"p-0\">\n                    <div className=\"overflow-x-auto\">\n                      <Table>\n                        <TableHeader>\n                          <TableRow className=\"bg-gray-50/50\">\n                            <TableHead className=\"font-semibold\">Sra</TableHead>\n                            <TableHead className=\"font-semibold\">Gider Kalemi</TableHead>\n                            <TableHead className=\"text-right font-semibold\">Tutar</TableHead>\n                            <TableHead className=\"text-right font-semibold\">Oran</TableHead>\n                          </TableRow>\n                        </TableHeader>\n                        <TableBody>\n                          {reportData.costBreakdown.map((item, index) => (\n                            <TableRow key={index} className=\"hover:bg-gray-50/50 transition-colors\">\n                              <TableCell className=\"font-medium text-muted-foreground\">#{index + 1}</TableCell>\n                              <TableCell className=\"font-medium\">{item.category}</TableCell>\n                              <TableCell className=\"text-right font-semibold text-red-600\">{item.amount.toLocaleString(\"tr-TR\", { minimumFractionDigits: 2, maximumFractionDigits: 2 })}</TableCell>\n                              <TableCell className=\"text-right font-semibold text-muted-foreground\">{item.percentage.toFixed(1)}%</TableCell>\n                            </TableRow>\n                          ))}\n                        </TableBody>\n                      </Table>\n                    </div>\n                  </CardContent>\n                </Card>\n              )}\n            </div>\n          )}\n\n          </div>\n        </div>\n        <div className=\"flex-shrink-0 px-3 pb-3 pt-2 border-t\">\n          <Button \n            onClick={generateReport} \n            disabled={loading || !reportData} \n            size=\"lg\"\n            className=\"w-full bg-gradient-to-r from-primary to-primary/90 hover:from-primary/90 hover:to-primary shadow-lg\"\n          >\n            <Download className=\"mr-2 h-4 w-4\" />\n            {loading ? \"PDF Oluturuluyor...\" : reportData ? \"PDF ndir\" : \"Tarih Aral Sein\"}\n          </Button>\n        </div>\n      </DialogContent>\n    </Dialog>\n  );\n};\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\components\\Reports\\ProductionReportDialog.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\components\\Reports\\SalesQuoteDialog.tsx","messages":[{"ruleId":null,"nodeType":null,"fatal":true,"severity":2,"message":"Parsing error: JSX element 'div' has no corresponding closing tag.","line":182,"column":19}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":1,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useMemo, useState } from \"react\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogHeader,\n  DialogTitle,\n  DialogDescription,\n} from \"@/components/ui/dialog\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Card } from \"@/components/ui/card\";\nimport { Plus, Trash2, Download, X, Save } from \"lucide-react\";\n// pdfGenerator will be dynamically imported when needed\nimport { toast } from \"sonner\";\nimport { useAuth } from \"@/contexts/AuthContext\";\n\nconst currencySymbols = [\"\", \"$\", \"\"];\n\ninterface QuoteItem {\n  description: string;\n  quantity: number;\n  unitPrice: number;\n}\n\ninterface SalesQuoteDialogProps {\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n}\n\nconst defaultItems: QuoteItem[] = [\n  { description: \"\", quantity: 1, unitPrice: 0 },\n];\n\nexport const SalesQuoteDialog = ({ open, onOpenChange }: SalesQuoteDialogProps) => {\n  const today = new Date().toISOString().slice(0, 10);\n  const { user } = useAuth();\n\n  const [quote, setQuote] = useState({\n    quoteNumber: `REV-${new Date().getFullYear()}${new Date().getMonth() + 1}`,\n    quoteDate: today,\n    validUntil: today,\n    customerName: \"\",\n    customerCompany: \"\",\n    projectName: \"\",\n    deliveryTerms: \"rnlerimiz stoklara bal olarak sevk edilir.\",\n    paymentTerms: \"deme pein veya anlamaya gre yaplacaktr.\",\n    notes: \"Fiyatlarmza KDV dahil deildir. Teklif 7 gn geerlidir.\",\n    currency: \"\",\n    taxRate: 20,\n    discountRate: 0,\n    items: defaultItems,\n  });\n\n  const totals = useMemo(() => {\n    const subtotal = (Array.isArray(quote.items) ? quote.items : []).reduce((sum, item) => sum + item.quantity * item.unitPrice, 0);\n    const discount = subtotal * (quote.discountRate / 100);\n    const taxedBase = subtotal - discount;\n    const tax = taxedBase * (quote.taxRate / 100);\n    const grandTotal = taxedBase + tax;\n    return {\n      subtotal,\n      discount,\n      tax,\n      grandTotal,\n    };\n  }, [quote]);\n\n  const handleItemChange = (index: number, field: keyof QuoteItem, value: string) => {\n    setQuote((prev) => {\n      const nextItems = [...prev.items];\n      const parsedValue = field === \"description\" ? value : Number(value) || 0;\n      nextItems[index] = {\n        ...nextItems[index],\n        [field]: parsedValue,\n      };\n      return { ...prev, items: nextItems };\n    });\n  };\n\n  const addRow = () => {\n    setQuote((prev) => ({ ...prev, items: [...prev.items, { description: \"\", quantity: 1, unitPrice: 0 }] }));\n  };\n\n  const removeRow = (index: number) => {\n    setQuote((prev) => ({\n      ...prev,\n      items: prev.items.filter((_, i) => i !== index),\n    }));\n  };\n\n  const handleDownload = async () => {\n    if (!quote.customerName) {\n      toast.error(\"Ltfen mteri bilgisini girin.\");\n      return;\n    }\n\n    try {\n      // Dynamically import pdfGenerator to avoid loading it on initial page load\n      const { generateSalesOfferPDF } = await import(\"@/services/pdfGenerator\");\n      const blob = await generateSalesOfferPDF({\n        ...quote,\n        totals,\n      });\n      const url = URL.createObjectURL(blob);\n      const a = document.createElement(\"a\");\n      a.href = url;\n      a.download = `${quote.customerCompany || \"teklif\"}-${quote.quoteNumber}.pdf`;\n      a.click();\n      URL.revokeObjectURL(url);\n      toast.success(\"Teklif PDF hazrland\");\n\n      try {\n        const { saveReport } = await import(\"@/services/firebase/reportService\");\n        await saveReport(\"sales_quote\", `Teklif ${quote.quoteNumber}`, blob, user?.id || \"anonymous\", {\n          metadata: {\n            customerName: quote.customerCompany || quote.customerName || \"Bilinmiyor\",\n            currency: quote.currency,\n            grandTotal: Number(totals.grandTotal) || 0,\n            subtotal: Number(totals.subtotal) || 0,\n            tax: Number(totals.tax) || 0,\n            discount: Number(totals.discount) || 0,\n          },\n        });\n      } catch (reportError) {\n        console.warn(\"Teklif raporu kaydedilemedi:\", reportError);\n      }\n    } catch (error) {\n      const message = error instanceof Error ? error.message : \"Bilinmeyen hata\";\n      toast.error(\"PDF oluturulamad: \" + message);\n    }\n  };\n\n  return (\n    <Dialog open={open} onOpenChange={onOpenChange}>\n      <DialogContent className=\"!max-w-[100vw] sm:!max-w-[85vw] !w-[100vw] sm:!w-[85vw] !h-[100vh] sm:!h-[80vh] !max-h-[100vh] sm:!max-h-[80vh] !left-0 sm:!left-[7.5vw] !top-0 sm:!top-[10vh] !right-0 sm:!right-auto !bottom-0 sm:!bottom-auto !translate-x-0 !translate-y-0 overflow-hidden !p-0 gap-0 bg-white flex flex-col !m-0 !rounded-none sm:!rounded-lg !border-0 sm:!border\">\n        {/* DialogTitle ve DialogDescription DialogContent'in direkt child' olmal (Radix UI gereksinimi) */}\n        <DialogTitle className=\"sr-only\">Sat Teklifi Olutur</DialogTitle>\n        <DialogDescription className=\"sr-only\">Sat teklifi oluturun</DialogDescription>\n        \n        <div className=\"flex flex-col h-full min-h-0\">\n          {/* Header */}\n          <DialogHeader className=\"p-3 sm:p-4 border-b bg-white flex-shrink-0 relative pr-12 sm:pr-16\">\n            <div className=\"flex items-center justify-between gap-3\">\n              <div className=\"flex items-center gap-2 sm:gap-3 flex-1 min-w-0\">\n                <div className=\"h-8 w-8 sm:h-10 sm:w-10 rounded-lg bg-primary/10 flex items-center justify-center border border-primary/20 flex-shrink-0\">\n                  <Download className=\"h-4 w-4 sm:h-5 sm:w-5 text-primary\" />\n                </div>\n                <h2 className=\"text-lg sm:text-xl font-semibold text-foreground truncate\">\n                  Sat Teklifi Olutur\n                </h2>\n              </div>\n              <div className=\"flex flex-wrap gap-2 flex-shrink-0\">\n                <Button\n                  variant=\"outline\"\n                  size=\"sm\"\n                  className=\"border-primary/20 hover:bg-primary/5 rounded-lg px-3 py-1.5 font-medium text-xs sm:text-sm flex-shrink-0\"\n                  onClick={() => onOpenChange(false)}\n                >\n                  <X className=\"h-3 w-3 sm:h-4 sm:w-4 mr-1.5 flex-shrink-0\" />\n                  ptal\n                </Button>\n                <Button\n                  variant=\"default\"\n                  size=\"sm\"\n                  className=\"bg-primary hover:bg-primary/90 rounded-lg px-3 py-1.5 font-medium text-xs sm:text-sm flex-shrink-0 text-white\"\n                  onClick={handleDownload}\n                >\n                  <Save className=\"h-3 w-3 sm:h-4 sm:w-4 mr-1.5 flex-shrink-0\" />\n                  PDF ndir\n                </Button>\n              </div>\n            </div>\n          </DialogHeader>\n        \n          {/* Content */}\n          <div className=\"flex-1 overflow-hidden bg-gray-50/50 p-3 sm:p-4 min-h-0\">\n            <div className=\"max-w-full mx-auto h-full overflow-y-auto\">\n              <Card>\n                <CardContent className=\"pt-6\">\n                  <div className=\"grid gap-6 md:grid-cols-2\">\n          <div className=\"space-y-4\">\n            <div>\n              <Label>Teklif No</Label>\n              <Input\n                value={quote.quoteNumber}\n                onChange={(e) => setQuote((prev) => ({ ...prev, quoteNumber: e.target.value }))}\n              />\n            </div>\n            <div className=\"grid grid-cols-2 gap-4\">\n              <div>\n                <Label>Teklif Tarihi</Label>\n                <Input\n                  type=\"date\"\n                  value={quote.quoteDate}\n                  onChange={(e) => setQuote((prev) => ({ ...prev, quoteDate: e.target.value }))}\n                />\n              </div>\n              <div>\n                <Label>Geerlilik Tarihi</Label>\n                <Input\n                  type=\"date\"\n                  value={quote.validUntil}\n                  onChange={(e) => setQuote((prev) => ({ ...prev, validUntil: e.target.value }))}\n                />\n              </div>\n            </div>\n            <div>\n              <Label>Mteri / Firma</Label>\n              <Input\n                placeholder=\"rn. Rumitech Enerji\"\n                value={quote.customerCompany}\n                onChange={(e) => setQuote((prev) => ({ ...prev, customerCompany: e.target.value }))}\n              />\n            </div>\n            <div>\n              <Label>lgili Kii / Proje Ad</Label>\n              <Input\n                placeholder=\"lgili kii\"\n                value={quote.customerName}\n                onChange={(e) => setQuote((prev) => ({ ...prev, customerName: e.target.value }))}\n              />\n            </div>\n            <div>\n              <Label>Proje / rn Notlar</Label>\n              <Textarea\n                rows={2}\n                value={quote.projectName}\n                onChange={(e) => setQuote((prev) => ({ ...prev, projectName: e.target.value }))}\n              />\n            </div>\n\n            <div className=\"grid grid-cols-2 gap-4\">\n              <div>\n                <Label>Para Birimi</Label>\n                <select\n                  className=\"w-full rounded-md border border-input bg-background px-3 py-2 text-sm\"\n                  value={quote.currency}\n                  onChange={(e) => setQuote((prev) => ({ ...prev, currency: e.target.value }))}\n                >\n                  {currencySymbols.map((currency) => (\n                    <option key={currency} value={currency}>\n                      {currency}\n                    </option>\n                  ))}\n                </select>\n              </div>\n              <div>\n                <Label>skonto (%)</Label>\n                <Input\n                  type=\"number\"\n                  min=\"0\"\n                  value={quote.discountRate}\n                  onChange={(e) => setQuote((prev) => ({ ...prev, discountRate: Number(e.target.value) }))}\n                />\n              </div>\n            </div>\n            <div className=\"grid grid-cols-2 gap-4\">\n              <div>\n                <Label>KDV (%)</Label>\n                <Input\n                  type=\"number\"\n                  min=\"0\"\n                  value={quote.taxRate}\n                  onChange={(e) => setQuote((prev) => ({ ...prev, taxRate: Number(e.target.value) }))}\n                />\n              </div>\n              <div>\n                <Label>Teslimat / Termin</Label>\n                <Input\n                  value={quote.deliveryTerms}\n                  onChange={(e) => setQuote((prev) => ({ ...prev, deliveryTerms: e.target.value }))}\n                />\n              </div>\n            </div>\n            <div>\n              <Label>deme Koullar</Label>\n              <Input\n                value={quote.paymentTerms}\n                onChange={(e) => setQuote((prev) => ({ ...prev, paymentTerms: e.target.value }))}\n              />\n            </div>\n            <div>\n              <Label>Notlar</Label>\n              <Textarea\n                rows={3}\n                value={quote.notes}\n                onChange={(e) => setQuote((prev) => ({ ...prev, notes: e.target.value }))}\n              />\n            </div>\n          </div>\n\n          <div className=\"space-y-4\">\n            <div className=\"flex items-center justify-between\">\n              <Label>rn Kalemleri</Label>\n              <Button type=\"button\" variant=\"outline\" size=\"sm\" onClick={addRow}>\n                <Plus className=\"h-4 w-4 mr-2\" />\n                Satr Ekle\n              </Button>\n            </div>\n            <div className=\"space-y-3 max-h-64 overflow-y-auto pr-1\">\n              {(Array.isArray(quote.items) ? quote.items : []).map((item, index) => (\n                <Card key={index} className=\"p-3\">\n                  <div className=\"flex justify-between gap-2\">\n                    <div className=\"flex-1\">\n                      <Label className=\"text-xs\">rn / Hizmet</Label>\n                      <Input\n                        value={item.description}\n                        onChange={(e) => handleItemChange(index, \"description\", e.target.value)}\n                        placeholder=\"rn ad\"\n                      />\n                    </div>\n                    <Button\n                      type=\"button\"\n                      size=\"icon\"\n                      variant=\"ghost\"\n                      onClick={() => removeRow(index)}\n                      disabled={quote.items.length === 1}\n                    >\n                      <Trash2 className=\"h-4 w-4 text-destructive\" />\n                    </Button>\n                  </div>\n                  <div className=\"mt-2 grid grid-cols-2 gap-2 text-sm\">\n                    <div>\n                      <Label className=\"text-xs\">Adet</Label>\n                      <Input\n                        type=\"number\"\n                        min=\"1\"\n                        value={item.quantity}\n                        onChange={(e) => handleItemChange(index, \"quantity\", e.target.value)}\n                      />\n                    </div>\n                    <div>\n                      <Label className=\"text-xs\">Birim Fiyat</Label>\n                      <Input\n                        type=\"number\"\n                        min=\"0\"\n                        value={item.unitPrice}\n                        onChange={(e) => handleItemChange(index, \"unitPrice\", e.target.value)}\n                      />\n                    </div>\n                  </div>\n                </Card>\n              ))}\n            </div>\n\n            <div className=\"rounded-lg border bg-gradient-to-br from-slate-50 to-white p-4 shadow-inner\">\n              <div className=\"flex justify-between text-sm text-muted-foreground\">\n                <span>Ara Toplam</span>\n                <span>\n                  {quote.currency}\n                  {(totals.subtotal || 0).toFixed(2)}\n                </span>\n              </div>\n              {quote.discountRate > 0 && (\n                <div className=\"flex justify-between text-sm text-muted-foreground\">\n                  <span>skonto ({quote.discountRate}%)</span>\n                  <span>-{quote.currency}\n                    {(totals.discount || 0).toFixed(2)}</span>\n                </div>\n              )}\n              <div className=\"flex justify-between text-sm text-muted-foreground\">\n                <span>KDV ({quote.taxRate}%)</span>\n                <span>\n                  {quote.currency}\n                  {(totals.tax || 0).toFixed(2)}\n                </span>\n              </div>\n              <div className=\"mt-2 flex justify-between text-base font-semibold\">\n                <span>Genel Toplam</span>\n                <span>\n                  {quote.currency}\n                  {(totals.grandTotal || 0).toFixed(2)}\n                </span>\n              </div>\n            </div>\n                  </div>\n                </CardContent>\n              </Card>\n            </div>\n          </div>\n        </div>\n      </DialogContent>\n    </Dialog>\n  );\n};\n\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\components\\Reports\\SalesQuoteForm.tsx","messages":[],"suppressedMessages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'fetchCustomers', 'fetchOrderData', and 'fetchProducts'. Either include them or remove the dependency array.","line":160,"column":6,"nodeType":"ArrayExpression","endLine":160,"endColumn":21,"suggestions":[{"desc":"Update the dependencies array to be: [fetchCustomers, fetchOrderData, fetchProducts, open, orderId]","fix":{"range":[5731,5746],"text":"[fetchCustomers, fetchOrderData, fetchProducts, open, orderId]"}}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\components\\Reports\\SalesReportDialog.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useCallback has a missing dependency: 'getItemRevenue'. Either include it or remove the dependency array.","line":138,"column":6,"nodeType":"ArrayExpression","endLine":138,"endColumn":26,"suggestions":[{"desc":"Update the dependencies array to be: [startDate, endDate, getItemRevenue]","fix":{"range":[4830,4850],"text":"[startDate, endDate, getItemRevenue]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect, useCallback } from \"react\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogDescription } from \"@/components/ui/dialog\";\nimport { Button } from \"@/components/ui/button\";\nimport { Label } from \"@/components/ui/label\";\nimport { Input } from \"@/components/ui/input\";\nimport { toast } from \"sonner\";\nimport { getOrders, getOrderItems, Order, OrderItem } from \"@/services/firebase/orderService\";\nimport { Download, TrendingUp, Package, Users, Calendar, Clock } from \"lucide-react\";\n// pdfGenerator will be dynamically imported when needed\nimport { useAuth } from \"@/contexts/AuthContext\";\nimport { Timestamp } from \"firebase/firestore\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from \"@/components/ui/table\";\nimport { Badge } from \"@/components/ui/badge\";\n\ninterface SalesReportDialogProps {\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n}\n\nexport const SalesReportDialog = ({ open, onOpenChange }: SalesReportDialogProps) => {\n  const { user } = useAuth();\n  const [loading, setLoading] = useState(false);\n  const [startDate, setStartDate] = useState(\"\");\n  const [endDate, setEndDate] = useState(\"\");\n  const [reportData, setReportData] = useState<SalesReportData | null>(null);\n\n  interface TopProduct {\n    name: string;\n    quantity: number;\n    revenue: number;\n  }\n\n  interface SalesReportData {\n    totalRevenue: number;\n    totalOrders: number;\n    activeCustomers: number;\n    orders: Order[];\n    topProducts: TopProduct[];\n    avgOrderValue: number;\n  }\n\n  const getOrderDate = (order: Order): Date => {\n    if (order.createdAt instanceof Timestamp) {\n      return order.createdAt.toDate();\n    }\n    if (order.created_at) {\n      const parsed = new Date(order.created_at);\n      if (!Number.isNaN(parsed.getTime())) {\n        return parsed;\n      }\n    }\n    return new Date();\n  };\n\n  const getOrderTotal = (order: Order & { total?: number }): number => {\n    return order.total ?? order.totalAmount ?? order.total_amount ?? order.subtotal ?? 0;\n  };\n\n  const getItemQuantity = (item: OrderItem & { quantity?: number }): number => {\n    return item.quantity ?? 0;\n  };\n\n  const getItemRevenue = (item: OrderItem & { unit_price?: number; total?: number }): number => {\n    if (typeof item.total === \"number\") {\n      return item.total;\n    }\n    const unitPrice = item.unit_price ?? item.unitPrice ?? 0;\n    return unitPrice * getItemQuantity(item);\n  };\n\n  const fetchReportData = useCallback(async () => {\n    if (!startDate || !endDate) {\n      setReportData(null);\n      return;\n    }\n\n    setLoading(true);\n    try {\n      // Firebase'den siparileri al\n      const orders = await getOrders();\n      \n      // Tarih filtresi uygula\n      const filteredOrders = orders.filter((order) => {\n        const orderDate = getOrderDate(order);\n        const orderDateStr = orderDate.toISOString().split(\"T\")[0];\n        return orderDateStr >= startDate && orderDateStr <= endDate;\n      });\n\n      // Rapor verilerini hesapla\n      const totalRevenue = filteredOrders.reduce((sum, o) => sum + getOrderTotal(o), 0);\n      const totalOrders = filteredOrders.length;\n      const activeCustomers = new Set(filteredOrders.map((o) => o.customerId).filter(Boolean)).size;\n\n      // En ok satan rnler\n      const productMap = new Map<string, TopProduct>();\n      const orderItemsPromises = filteredOrders.map(async (order) => {\n        try {\n          return await getOrderItems(order.id);\n        } catch (err) {\n          console.error(\"Get order items error:\", err);\n          return [];\n        }\n      });\n      \n      const allOrderItems = await Promise.all(orderItemsPromises);\n      allOrderItems.flat().forEach((item) => {\n        const productName = (item as OrderItem & { product_name?: string }).product_name || item.productName || \"Bilinmeyen\";\n        if (!productMap.has(productName)) {\n          productMap.set(productName, { name: productName, quantity: 0, revenue: 0 });\n        }\n        const prod = productMap.get(productName);\n        if (!prod) return;\n        prod.quantity += getItemQuantity(item);\n        prod.revenue += getItemRevenue(item);\n      });\n\n      const topProducts = Array.from(productMap.values())\n        .sort((a, b) => b.revenue - a.revenue)\n        .slice(0, 10);\n\n      const data: SalesReportData = {\n        totalRevenue,\n        totalOrders,\n        activeCustomers,\n        orders: filteredOrders,\n        topProducts,\n        avgOrderValue: totalOrders > 0 ? totalRevenue / totalOrders : 0,\n      };\n\n      setReportData(data);\n    } catch (error) {\n      console.error(\"Fetch report data error:\", error);\n      toast.error(\"Veri yklenirken hata olutu\");\n    } finally {\n      setLoading(false);\n    }\n  }, [startDate, endDate]);\n\n  // Tarih deitiinde otomatik veri gncelleme\n  useEffect(() => {\n    if (startDate && endDate) {\n      const timeoutId = setTimeout(() => {\n        fetchReportData();\n      }, 500); // Debounce\n      return () => clearTimeout(timeoutId);\n    }\n  }, [startDate, endDate, fetchReportData]);\n\n  const generateReport = async () => {\n    if (!startDate || !endDate) {\n      toast.error(\"Ltfen tarih aral sein\");\n      return;\n    }\n\n    if (!reportData) {\n      toast.error(\"Ltfen nce rapor verilerini ykleyin\");\n      return;\n    }\n\n    setLoading(true);\n    try {\n      // Dynamically import pdfGenerator to avoid loading it on initial page load\n      const { generateSalesReportPDF } = await import(\"@/services/pdfGenerator\");\n      // Generate PDF - await ile bekle\n      const pdfBlob = await generateSalesReportPDF(reportData, startDate, endDate);\n      \n      // PDF'i hemen indir (Drive upload'n beklemeden)\n      const url = URL.createObjectURL(pdfBlob);\n      const a = document.createElement(\"a\");\n      a.href = url;\n      const reportDate = new Date().toISOString().split('T')[0];\n      a.download = `Satis-Raporu-${startDate}-${endDate}-${reportDate}.pdf`;\n      document.body.appendChild(a);\n      a.click();\n      document.body.removeChild(a);\n      // URL'yi hemen temizle (indirme baladktan sonra)\n      setTimeout(() => URL.revokeObjectURL(url), 100);\n      \n      toast.success(\"Rapor indiriliyor...\");\n      \n      // Loading'i kapat (indirme balad, Drive upload arka planda devam edecek)\n      setLoading(false);\n\n      // PDF'i Storage'a kaydet (Arka planda, kullancy bekletmeden)\n      // Promise'i await etmeden balat - arka planda alsn\n      (async () => {\n        try {\n          const { saveReport } = await import(\"@/services/firebase/reportService\");\n          const reportTitle = `Sat Raporu - ${startDate} / ${endDate}`;\n          await saveReport(\"sales\", reportTitle, pdfBlob, user?.id || \"\", {\n            startDate,\n            endDate,\n            metadata: { totalRevenue: reportData.totalRevenue, totalOrders: reportData.totalOrders, activeCustomers: reportData.activeCustomers },\n          });\n          toast.success(\"Rapor buluta yedeklendi.\");\n        } catch (error) {\n          console.warn(\"Rapor buluta kaydedilemedi (CORS/Yetki):\", error);\n        }\n      })();\n\n    } catch (error) {\n      console.error(\"Generate sales report error:\", error);\n      const message = error instanceof Error ? error.message : \"Rapor oluturulamad\";\n      toast.error(\"Hata: \" + message);\n      setLoading(false);\n    }\n  };\n\n  return (\n    <Dialog open={open} onOpenChange={onOpenChange}>\n      <DialogContent className=\"sm:!max-w-[85vw] sm:!w-[85vw] sm:!h-[80vh] sm:!max-h-[80vh] sm:!left-[7.5vw] sm:!top-[10vh] sm:!translate-x-0 sm:!translate-y-0 flex flex-col p-0 overflow-hidden\">\n        {/* DialogTitle ve DialogDescription DialogContent'in direkt child' olmal (Radix UI gereksinimi) */}\n        <DialogTitle className=\"sr-only\">Sat Raporu Olutur</DialogTitle>\n        <DialogDescription className=\"sr-only\">Tarih aral seerek detayl sat raporu oluturun ve PDF olarak indirin</DialogDescription>\n        \n        <DialogHeader className=\"px-4 sm:px-6 pt-4 sm:pt-6 pb-4 border-b bg-[rgb(255,255,255)] flex-shrink-0 sticky top-0 z-[10001] shadow-sm\">\n          <h2 className=\"text-[16px] sm:text-[18px] font-semibold flex items-center gap-2 leading-tight\">\n            <div className=\"h-6 w-6 sm:h-7 sm:w-7 rounded-lg bg-primary/10 flex items-center justify-center\">\n              <Download className=\"h-3.5 w-3.5 sm:h-4 sm:w-4 text-primary\" />\n            </div>\n            Sat Raporu Olutur\n          </h2>\n          <p className=\"text-[11px] sm:text-xs text-muted-foreground mt-1 leading-snug\">\n            Tarih aral seerek detayl sat raporu oluturun ve PDF olarak indirin\n          </p>\n        </DialogHeader>\n        <div className=\"flex-1 min-h-0 overflow-y-auto overflow-x-hidden -webkit-overflow-scrolling-touch overscroll-behavior-contain\">\n          <div className=\"w-full p-4 sm:p-6 space-y-4 sm:space-y-6\">\n          {/* Tarih Seimi - Profesyonel Tasarm */}\n          <Card className=\"bg-[rgb(249,250,251)] border-2\">\n            <CardHeader className=\"pb-3\">\n              <CardTitle className=\"text-[11px] sm:text-xs font-semibold text-muted-foreground leading-tight\">Tarih Aral Seimi</CardTitle>\n            </CardHeader>\n            <CardContent>\n              {/* Hzl Tarih Seenekleri */}\n              <div className=\"mb-4\">\n                <Label className=\"text-[11px] sm:text-xs font-medium text-muted-foreground mb-2 block\">Hzl Seim</Label>\n                <div className=\"flex flex-wrap gap-2\">\n                  <Button\n                    type=\"button\"\n                    variant=\"outline\"\n                    size=\"sm\"\n                    onClick={() => {\n                      const today = new Date();\n                      const start = new Date(today);\n                      start.setDate(today.getDate() - 7);\n                      setStartDate(start.toISOString().split('T')[0]);\n                      setEndDate(today.toISOString().split('T')[0]);\n                    }}\n                    className=\"text-[11px] sm:text-xs\"\n                  >\n                    <Clock className=\"h-3 w-3 mr-1\" />\n                    Son 7 Gn\n                  </Button>\n                  <Button\n                    type=\"button\"\n                    variant=\"outline\"\n                    size=\"sm\"\n                    onClick={() => {\n                      const today = new Date();\n                      const start = new Date(today);\n                      start.setDate(today.getDate() - 30);\n                      setStartDate(start.toISOString().split('T')[0]);\n                      setEndDate(today.toISOString().split('T')[0]);\n                    }}\n                    className=\"text-[11px] sm:text-xs\"\n                  >\n                    <Calendar className=\"h-3 w-3 mr-1\" />\n                    Son 30 Gn\n                  </Button>\n                  <Button\n                    type=\"button\"\n                    variant=\"outline\"\n                    size=\"sm\"\n                    onClick={() => {\n                      const today = new Date();\n                      const start = new Date(today.getFullYear(), today.getMonth(), 1);\n                      setStartDate(start.toISOString().split('T')[0]);\n                      setEndDate(today.toISOString().split('T')[0]);\n                    }}\n                    className=\"text-[11px] sm:text-xs\"\n                  >\n                    Bu Ay\n                  </Button>\n                  <Button\n                    type=\"button\"\n                    variant=\"outline\"\n                    size=\"sm\"\n                    onClick={() => {\n                      const today = new Date();\n                      const start = new Date(today.getFullYear(), today.getMonth() - 1, 1);\n                      const end = new Date(today.getFullYear(), today.getMonth(), 0);\n                      setStartDate(start.toISOString().split('T')[0]);\n                      setEndDate(end.toISOString().split('T')[0]);\n                    }}\n                    className=\"text-[11px] sm:text-xs\"\n                  >\n                    Geen Ay\n                  </Button>\n                  <Button\n                    type=\"button\"\n                    variant=\"outline\"\n                    size=\"sm\"\n                    onClick={() => {\n                      const today = new Date();\n                      const start = new Date(today.getFullYear(), 0, 1);\n                      setStartDate(start.toISOString().split('T')[0]);\n                      setEndDate(today.toISOString().split('T')[0]);\n                    }}\n                    className=\"text-[11px] sm:text-xs\"\n                  >\n                    Bu Yl\n                  </Button>\n                </div>\n              </div>\n              \n              <div className=\"grid grid-cols-2 gap-4\">\n          <div className=\"space-y-2\">\n                  <Label className=\"text-[11px] sm:text-xs font-medium\">Balang Tarihi</Label>\n                  <Input \n                    type=\"date\" \n                    value={startDate} \n                    onChange={(e) => setStartDate(e.target.value)}\n                    className=\"border-2 focus:border-primary\"\n                  />\n          </div>\n          <div className=\"space-y-2\">\n                  <Label className=\"text-[11px] sm:text-xs font-medium\">Biti Tarihi</Label>\n                  <Input \n                    type=\"date\" \n                    value={endDate} \n                    onChange={(e) => setEndDate(e.target.value)}\n                    className=\"border-2 focus:border-primary\"\n                  />\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n\n          {/* Rapor nizleme - Profesyonel Tasarm */}\n          {reportData && (\n            <div className=\"space-y-6 border-t pt-6\">\n              <div className=\"flex items-center justify-between mb-4\">\n                <h3 className=\"text-[14px] sm:text-[15px] font-semibold flex items-center gap-2 leading-tight\">\n                  <div className=\"h-2 w-2 rounded-full bg-primary\"></div>\n                  Rapor nizlemesi\n                </h3>\n                <Badge variant=\"outline\" className=\"text-[10px] sm:text-[11px]\">\n                  {startDate} - {endDate}\n                </Badge>\n              </div>\n              {/* statistik Kartlar - Profesyonel ve Sade */}\n              <div className=\"grid grid-cols-3 gap-4\">\n                <Card className=\"bg-[rgb(255,255,255)] border-[rgb(221,83,53)] border-2\" style={{ backgroundColor: 'rgba(221, 83, 53, 0.05)' }}>\n                  <CardHeader className=\"pb-3\">\n                    <CardTitle className=\"text-[11px] sm:text-xs font-semibold text-muted-foreground flex items-center gap-2 leading-tight\">\n                      <TrendingUp className=\"h-4 w-4 text-primary\" />\n                      Toplam Gelir\n                    </CardTitle>\n                  </CardHeader>\n                  <CardContent>\n                    <p className=\"text-3xl font-bold text-primary\">{reportData.totalRevenue.toLocaleString(\"tr-TR\", { minimumFractionDigits: 2, maximumFractionDigits: 2 })}</p>\n                    <p className=\"text-[11px] sm:text-xs text-muted-foreground mt-1 leading-snug\">Ortalama: {reportData.avgOrderValue.toLocaleString(\"tr-TR\", { minimumFractionDigits: 2, maximumFractionDigits: 2 })}</p>\n                  </CardContent>\n                </Card>\n                <Card className=\"bg-[rgb(239,246,255)] border-[rgb(191,219,254)] border-2\">\n                  <CardHeader className=\"pb-3\">\n                    <CardTitle className=\"text-[11px] sm:text-xs font-semibold text-muted-foreground flex items-center gap-2 leading-tight\">\n                      <Package className=\"h-4 w-4 text-blue-500\" />\n                      Toplam Sipari\n                    </CardTitle>\n                  </CardHeader>\n                  <CardContent>\n                    <p className=\"text-3xl font-bold text-blue-600\">{reportData.totalOrders}</p>\n                    <p className=\"text-xs text-muted-foreground mt-1\">Tarih aralnda</p>\n                  </CardContent>\n                </Card>\n                <Card className=\"bg-[rgb(240,253,244)] border-[rgb(187,247,208)] border-2\">\n                  <CardHeader className=\"pb-3\">\n                    <CardTitle className=\"text-[11px] sm:text-xs font-semibold text-muted-foreground flex items-center gap-2 leading-tight\">\n                      <Users className=\"h-4 w-4 text-green-500\" />\n                      Aktif Mteri\n                    </CardTitle>\n                  </CardHeader>\n                  <CardContent>\n                    <p className=\"text-3xl font-bold text-green-600\">{reportData.activeCustomers}</p>\n                    <p className=\"text-xs text-muted-foreground mt-1\">Sipari veren mteri</p>\n                  </CardContent>\n                </Card>\n              </div>\n\n              {/* Sipari Durumu Dalm */}\n              <Card className=\"border-2 shadow-sm\">\n                <CardHeader className=\"bg-[rgb(249,250,251)] border-b\">\n                  <CardTitle className=\"text-lg sm:text-xl font-semibold flex items-center gap-2\">\n                    <div className=\"h-1 w-1 rounded-full bg-primary\"></div>\n                    Sipari Durumu Dalm\n                  </CardTitle>\n                </CardHeader>\n                <CardContent className=\"p-0\">\n                  <div className=\"overflow-x-auto\">\n                    <Table>\n                      <TableHeader>\n                        <TableRow className=\"bg-gray-50/50\">\n                          <TableHead className=\"font-semibold\">Durum</TableHead>\n                          <TableHead className=\"text-right font-semibold\">Sipari Says</TableHead>\n                          <TableHead className=\"text-right font-semibold\">Toplam Tutar</TableHead>\n                          <TableHead className=\"text-right font-semibold\">Oran</TableHead>\n                        </TableRow>\n                      </TableHeader>\n                      <TableBody>\n                        {(() => {\n                          const statusMap = new Map<string, { count: number; total: number }>();\n                          reportData.orders.forEach((order) => {\n                            const status = order.status || \"Bilinmeyen\";\n                            const total = getOrderTotal(order);\n                            if (!statusMap.has(status)) {\n                              statusMap.set(status, { count: 0, total: 0 });\n                            }\n                            const stat = statusMap.get(status)!;\n                            stat.count += 1;\n                            stat.total += total;\n                          });\n                          const statusLabels: Record<string, string> = {\n                            draft: \"Taslak\",\n                            pending: \"Beklemede\",\n                            confirmed: \"Onayland\",\n                            planned: \"Planland\",\n                            in_production: \"retimde\",\n                            in_progress: \"retimde\",\n                            quality_check: \"Kalite Kontrol\",\n                            on_hold: \"Beklemede\",\n                            completed: \"Tamamland\",\n                            shipped: \"Kargoda\",\n                            delivered: \"Teslim Edildi\",\n                            cancelled: \"ptal\",\n                          };\n                          const totalOrders = reportData.orders.length;\n                          return Array.from(statusMap.entries())\n                            .sort((a, b) => b[1].count - a[1].count)\n                            .map(([status, data]) => (\n                              <TableRow key={status} className=\"hover:bg-gray-50/50 transition-colors\">\n                                <TableCell className=\"font-medium\">{statusLabels[status] || status}</TableCell>\n                                <TableCell className=\"text-right font-semibold\">{data.count}</TableCell>\n                                <TableCell className=\"text-right font-semibold text-primary\">{data.total.toLocaleString(\"tr-TR\", { minimumFractionDigits: 2, maximumFractionDigits: 2 })}</TableCell>\n                                <TableCell className=\"text-right font-semibold text-muted-foreground\">{totalOrders > 0 ? ((data.count / totalOrders) * 100).toFixed(1) : 0}%</TableCell>\n                              </TableRow>\n                            ));\n                        })()}\n                      </TableBody>\n                    </Table>\n                  </div>\n                </CardContent>\n              </Card>\n\n              {/* rn Tablosu - Profesyonel Tasarm */}\n              <Card className=\"border-2 shadow-sm\">\n                <CardHeader className=\"bg-[rgb(249,250,251)] border-b\">\n                  <CardTitle className=\"text-lg sm:text-xl font-semibold flex items-center gap-2\">\n                    <div className=\"h-1 w-1 rounded-full bg-primary\"></div>\n                    En ok Satan rnler\n                  </CardTitle>\n                </CardHeader>\n                <CardContent className=\"p-0\">\n                  <div className=\"overflow-x-auto\">\n                    <Table>\n                      <TableHeader>\n                        <TableRow className=\"bg-gray-50/50\">\n                          <TableHead className=\"font-semibold\">Sra</TableHead>\n                          <TableHead className=\"font-semibold\">rn Ad</TableHead>\n                          <TableHead className=\"text-right font-semibold\">Adet</TableHead>\n                          <TableHead className=\"text-right font-semibold\">Gelir</TableHead>\n                        </TableRow>\n                      </TableHeader>\n                      <TableBody>\n                        {reportData.topProducts.slice(0, 10).map((product, index) => (\n                          <TableRow key={index} className=\"hover:bg-gray-50/50 transition-colors\">\n                            <TableCell className=\"font-medium text-muted-foreground\">#{index + 1}</TableCell>\n                            <TableCell className=\"font-medium\">{product.name}</TableCell>\n                            <TableCell className=\"text-right font-semibold\">{product.quantity}</TableCell>\n                            <TableCell className=\"text-right font-semibold text-primary\">{product.revenue.toLocaleString(\"tr-TR\", { minimumFractionDigits: 2, maximumFractionDigits: 2 })}</TableCell>\n                          </TableRow>\n                        ))}\n                      </TableBody>\n                    </Table>\n                  </div>\n                </CardContent>\n              </Card>\n            </div>\n          )}\n\n          {loading && !reportData && (\n            <Card className=\"border-2 border-dashed\">\n              <CardContent className=\"py-12\">\n                <div className=\"flex flex-col items-center justify-center gap-3\">\n                  <div className=\"h-8 w-8 border-4 border-primary border-t-transparent rounded-full animate-spin\"></div>\n                  <p className=\"text-sm font-medium text-muted-foreground\">Veriler ykleniyor...</p>\n                </div>\n              </CardContent>\n            </Card>\n          )}\n          </div>\n        </div>\n        <div className=\"flex-shrink-0 px-4 sm:px-6 pb-4 sm:pb-6 pt-4 border-t\">\n          <Button \n            onClick={generateReport} \n            disabled={loading || !reportData} \n            size=\"lg\"\n            className=\"w-full bg-gradient-to-r from-primary to-primary/90 hover:from-primary/90 hover:to-primary shadow-lg\"\n          >\n            <Download className=\"mr-2 h-4 w-4\" />\n            {loading ? \"PDF Oluturuluyor...\" : reportData ? \"PDF ndir\" : \"Tarih Aral Sein\"}\n          </Button>\n        </div>\n      </DialogContent>\n    </Dialog>\n  );\n};\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\components\\Requests\\RequestModal.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\components\\Settings\\CompanySettings.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\components\\Settings\\DriveSettings.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\components\\Settings\\ProfileSettings.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\components\\Settings\\TaskHistory.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\components\\Settings\\UserPersonalInsights.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\components\\Statistics\\DetailedValueReportModal.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\components\\Statistics\\SimpleStatsModal.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\components\\Tasks\\CreateTaskDialog.tsx","messages":[{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useEffect\" is called conditionally. React Hooks must be called in the exact same order in every component render.","line":41,"column":3,"nodeType":"Identifier","endLine":41,"endColumn":12}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * CreateTaskDialog - Wrapper component\n * Artk tm grev oluturma ilemleri TaskInlineForm zerinden yaplyor\n */\n\nimport { useState, useEffect, useMemo } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Plus } from \"lucide-react\";\nimport { TaskInlineForm } from \"./TaskInlineForm\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogDescription } from \"@/components/ui/dialog\";\nimport { useNavigate } from \"react-router-dom\";\nimport { useAuth } from \"@/contexts/AuthContext\";\n\ninterface CreateTaskDialogProps {\n  onTaskCreated?: () => void;\n  open?: boolean;\n  onOpenChange?: (open: boolean) => void;\n  hideTrigger?: boolean;\n}\n\nexport const CreateTaskDialog = ({ onTaskCreated, open, onOpenChange, hideTrigger = false }: CreateTaskDialogProps) => {\n  const [taskModalOpen, setTaskModalOpen] = useState(false);\n  const navigate = useNavigate();\n  const { user } = useAuth();\n  \n  // Personnel ve zleyici kontrol - grev oluturma yetkisi yok\n  const isPersonnelOrViewer = useMemo(() => {\n    if (!user?.roles) return false;\n    const hasPersonnelRole = user.roles.includes(\"personnel\");\n    const hasViewerRole = user.roles.includes(\"viewer\");\n    const hasAdminRole = user.roles.includes(\"super_admin\") || user.roles.includes(\"main_admin\") || user.roles.includes(\"team_leader\");\n    return (hasPersonnelRole || hasViewerRole) && !hasAdminRole;\n  }, [user?.roles]);\n  \n  // Personnel ve zleyici iin buton gsterilmez\n  if (isPersonnelOrViewer) {\n    return null;\n  }\n\n  // Open state'i kontrol et\n  useEffect(() => {\n    if (open !== undefined) {\n      setTaskModalOpen(open);\n    }\n  }, [open]);\n\n  const handleOpenChange = (next: boolean) => {\n    setTaskModalOpen(next);\n    onOpenChange?.(next);\n  };\n\n  const handleTaskCreated = () => {\n    onTaskCreated?.();\n    handleOpenChange(false);\n  };\n\n  // Eer Tasks sayfasndaysak, oradaki modal' kullan\n  // Deilse, burada modal a\n  if (window.location.pathname === \"/tasks\") {\n    // Tasks sayfasndayz, oradaki modal' tetiklemek iin navigate kullan\n    return (\n      <>\n        {!hideTrigger && (\n          <Button \n            className=\"gap-2\" \n            onClick={() => {\n              navigate(\"/tasks?new=true\");\n              // Tasks sayfasndaki modal' amak iin state gncellemesi yaplabilir\n            }}\n          >\n            <Plus className=\"h-4 w-4\" />\n            Yeni Grev\n          </Button>\n        )}\n      </>\n    );\n  }\n\n  // Dier sayfalarda TaskInlineForm'u Dialog iinde kullan\n  return (\n    <>\n      {!hideTrigger && (\n        <Button \n          className=\"gap-2\" \n          onClick={() => handleOpenChange(true)}\n        >\n          <Plus className=\"h-4 w-4\" />\n          Yeni Grev\n        </Button>\n      )}\n      <Dialog open={taskModalOpen} onOpenChange={handleOpenChange}>\n        <DialogContent className=\"max-w-4xl max-h-[90vh] overflow-y-auto\">\n          <DialogHeader>\n            <DialogTitle>Yeni Grev Olutur</DialogTitle>\n            <DialogDescription>\n              Yeni bir grev oluturun\n            </DialogDescription>\n          </DialogHeader>\n          <TaskInlineForm\n            mode=\"create\"\n            onCancel={() => handleOpenChange(false)}\n            onSuccess={handleTaskCreated}\n            defaultStatus=\"pending\"\n          />\n        </DialogContent>\n      </Dialog>\n    </>\n  );\n};\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\components\\Tasks\\TaskBoard.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":588,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":588,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[20138,20141],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[20138,20141],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":589,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":589,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[20179,20182],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[20179,20182],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'showArchived'. Either include it or remove the dependency array. If 'setBoardState' needs the current value of 'showArchived', you can also switch to useReducer instead of useState and read 'showArchived' in the reducer.","line":743,"column":6,"nodeType":"ArrayExpression","endLine":743,"endColumn":51,"suggestions":[{"desc":"Update the dependencies array to be: [showArchived, tasks]","fix":{"range":[26841,26886],"text":"[showArchived, tasks]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a complex expression in the dependency array. Extract it to a separate variable so it can be statically checked.","line":743,"column":14,"nodeType":"CallExpression","endLine":743,"endColumn":50}],"suppressedMessages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'productionOrders'. Either include it or remove the dependency array.","line":1233,"column":6,"nodeType":"ArrayExpression","endLine":1233,"endColumn":21,"suggestions":[{"desc":"Update the dependencies array to be: [productionOrders, showTaskModal]","fix":{"range":[44836,44851],"text":"[productionOrders, showTaskModal]"}}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'productionOrders'. Either include it or remove the dependency array.","line":1240,"column":6,"nodeType":"ArrayExpression","endLine":1240,"endColumn":19,"suggestions":[{"desc":"Update the dependencies array to be: [productionOrders, showAddTask]","fix":{"range":[45074,45087],"text":"[productionOrders, showAddTask]"}}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":2,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useEffect, useMemo, useRef, useState, RefObject } from \"react\";\n// Drag and drop kaldrld - artk buton ile aama geii yaplacak\nimport { Button } from \"@/components/ui/button\";\nimport { useIsMobile } from \"@/hooks/use-mobile\";\nimport { Input } from \"@/components/ui/input\";\nimport { SearchInput } from \"@/components/ui/search-input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Avatar, AvatarFallback } from \"@/components/ui/avatar\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogFooter, DialogDescription } from \"@/components/ui/dialog\";\nimport { cn } from \"@/lib/utils\";\nimport { toast } from \"sonner\";\nimport {\n  createTask,\n  updateTask,\n  deleteTask,\n  assignTask,\n  getTaskById,\n  getTaskAssignments,\n  deleteTaskAssignment,\n  createChecklist,\n  archiveTask,\n  requestTaskApproval,\n  requestTaskFromPool,\n  removeTaskFromPool,\n  addTaskComment,\n  getTaskComments,\n  getTaskActivities,\n} from \"@/services/firebase/taskService\";\nimport { createNotification } from \"@/services/firebase/notificationService\";\nimport { getAllUsers, UserProfile } from \"@/services/firebase/authService\";\nimport { getOrders, Order } from \"@/services/firebase/orderService\";\nimport { getProjects, Project } from \"@/services/firebase/projectService\";\nimport { getDepartments } from \"@/services/firebase/departmentService\";\nimport { useAuth } from \"@/contexts/AuthContext\";\nimport { canCreateTask, canUpdateResource, canPerformSubPermission, isMainAdmin, canDeleteTask } from \"@/utils/permissions\";\nimport { Timestamp, collection, query, where, getDocs } from \"firebase/firestore\";\nimport { db } from \"@/lib/firebase\";\nimport {\n  Plus,\n  MoreVertical,\n  Edit2,\n  Edit,\n  Trash2,\n  Calendar,\n  Tag,\n  X,\n  Loader2,\n  CheckCircle2,\n  Paperclip,\n  MessageSquare,\n  Archive,\n  User,\n  Package,\n  UserPlus,\n  ListChecks,\n  Link2,\n  RefreshCcw,\n  ChevronDown,\n  ChevronUp,\n  Folder,\n  CircleDot,\n  Clock,\n  AlertCircle,\n  XCircle,\n  Minus,\n} from \"lucide-react\";\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuTrigger,\n  DropdownMenuSeparator,\n} from \"@/components/ui/dropdown-menu\";\nimport { format, isPast, isToday, isTomorrow } from \"date-fns\";\nimport { tr } from \"date-fns/locale\";\nimport { UserMultiSelect } from \"./UserMultiSelect\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport { ActivityCommentsPanel } from \"@/components/shared/ActivityCommentsPanel\";\nimport { getPriorityOption, convertOldPriorityToNew } from \"@/utils/priority\";\n\ntype Task = {\n  id: string;\n  title: string;\n  description?: string | null;\n  labels?: Array<{ name: string; color: string }>;\n  dueDate?: string;\n  createdAt: string;\n  status: string;\n  priority: number;\n  projectId?: string | null;\n  assignedUsers?: { id: string; full_name: string }[];\n  attachments?: number;\n  comments?: number;\n  checklists?: Array<{ completed: number; total: number }>;\n  createdBy?: string;\n  approvalStatus?: \"pending\" | \"approved\" | \"rejected\";\n  linkedProductionOrder?: {\n    id: string;\n    orderNumber?: string;\n    customerName?: string | null;\n    priority?: number | null;\n    dueDate?: string | null;\n    status?: string | null;\n  };\n  isInPool?: boolean;\n  poolRequests?: string[];\n};\n\ntype Column = {\n  id: string;\n  title: string;\n  taskIds: string[];\n  isArchived?: boolean;\n};\n\ntype BoardState = {\n  columns: Column[];\n  tasks: Record<string, Task>;\n  columnOrder: string[];\n};\n\nconst STORAGE_KEY = \"taskBoardState_v1\";\n// FILTER_STORAGE_KEY kaldrld - filtreler yok\n\ntype BoardTaskInput = {\n  id: string;\n  title: string;\n  description?: string | null;\n  status: string;\n  priority?: number;\n  due_date?: string | null;\n  created_at?: string;\n  projectId?: string | null;\n  isArchived?: boolean;\n  is_archived?: boolean;\n  labels?: Array<{ name: string; color: string }> | string;\n  assignments?: Array<{\n    assigned_to: string;\n    assigned_to_name?: string;\n    assigned_to_email?: string;\n  }>;\n  attachments?: number | Array<unknown>;\n  production_order_id?: string | null;\n  production_order_number?: string | null;\n  production_order_customer?: string | null;\n  production_order_priority?: number | null;\n  production_order_due_date?: string | null;\n  production_order_status?: string | null;\n  approvalStatus?: \"pending\" | \"approved\" | \"rejected\";\n  createdBy?: string;\n  created_by?: string;\n  isInPool?: boolean;\n  poolRequests?: string[];\n};\n\ninterface TaskBoardProps {\n  tasks: BoardTaskInput[];\n  onTaskClick: (taskId: string, initialStatus?: string) => void;\n  onStatusChange: (taskId: string, status: string) => Promise<void>;\n  showProjectFilter?: boolean; // Proje filtresini gster/gizle\n  projectId?: string; // Gizli proje kontrol iin\n  showArchived?: boolean; // Arivlenmi grevleri gster (archive filtresi iin)\n}\n\n// Trello color palette for labels\nconst LABEL_COLORS = [\n  { name: \"green\", value: \"#61BD4F\", class: \"bg-[#61BD4F]\" },\n  { name: \"yellow\", value: \"#F2D600\", class: \"bg-[#F2D600]\" },\n  { name: \"orange\", value: \"#FF9F1A\", class: \"bg-[#FF9F1A]\" },\n  { name: \"red\", value: \"#EB5A46\", class: \"bg-[#EB5A46]\" },\n  { name: \"purple\", value: \"#C377E0\", class: \"bg-[#C377E0]\" },\n  { name: \"blue\", value: \"#0079BF\", class: \"bg-[#0079BF]\" },\n  { name: \"sky\", value: \"#00C2E0\", class: \"bg-[#00C2E0]\" },\n  { name: \"lime\", value: \"#51E898\", class: \"bg-[#51E898]\" },\n  { name: \"pink\", value: \"#FF78CB\", class: \"bg-[#FF78CB]\" },\n  { name: \"black\", value: \"#344563\", class: \"bg-[#344563]\" },\n];\n\n// Status workflow tanm\ntype StatusItem = {\n  value: string;\n  label: string;\n  icon: typeof CircleDot;\n  color: string;\n};\n\nconst taskStatusWorkflow: StatusItem[] = [\n  { value: \"pending\", label: \"Yaplacak\", icon: CircleDot, color: \"text-amber-500\" },\n  { value: \"in_progress\", label: \"Devam Ediyor\", icon: Clock, color: \"text-blue-500\" },\n  { value: \"completed\", label: \"Tamamland\", icon: CheckCircle2, color: \"text-emerald-600\" },\n  { value: \"approved\", label: \"Onayland\", icon: CheckCircle2, color: \"text-green-600\" },\n];\n\n// Normalize status - remove \"column_\" prefix if present\nconst normalizeStatus = (status: string | undefined | null): string => {\n  if (!status) return \"pending\";\n  // Eer \"column_\" ile balyorsa, bu bir column ID'sidir (saysal olabilir)\n  if (status.startsWith(\"column_\")) {\n    const statusFromColumn = status.replace(\"column_\", \"\");\n    // Geerli status deerlerini kontrol et (pending, in_progress, completed, approved, cancelled)\n    if ([\"pending\", \"in_progress\", \"completed\", \"approved\", \"cancelled\"].includes(statusFromColumn)) {\n      return statusFromColumn === \"cancelled\" ? \"pending\" : statusFromColumn;\n    }\n    // Saysal ID veya geersiz deer ise \"pending\" olarak kabul et\n    return \"pending\";\n  }\n  // Geerli status deerlerini kontrol et\n  if ([\"pending\", \"in_progress\", \"completed\", \"approved\", \"cancelled\"].includes(status)) {\n    return status === \"cancelled\" ? \"pending\" : status;\n  }\n  return \"pending\"; // Fallback\n};\n\n// Status helper fonksiyonlar\nconst getStatusLabel = (status: string) => {\n  // nce status' normalize et (column_ prefix'ini kaldr)\n  const normalized = normalizeStatus(status);\n  const labels: Record<string, string> = {\n    pending: \"Yaplacak\",\n    in_progress: \"Devam Ediyor\",\n    completed: \"Tamamland\",\n    approved: \"Onayland\",\n  };\n  return labels[normalized] || normalized;\n};\n\n// Sabit kolonlar - 4 aama\nconst defaultColumns: Column[] = [\n  { id: \"pending\", title: \"Yaplacak\", taskIds: [] },\n  { id: \"in_progress\", title: \"Devam Ediyor\", taskIds: [] },\n  { id: \"completed\", title: \"Tamamland\", taskIds: [] },\n  { id: \"approved\", title: \"Onayland\", taskIds: [] }, // Onaylanm ve tamamlanm grevler (status: completed, approvalStatus: approved)\n];\n\n// Helper function to extract error message\nconst getErrorMessage = (error: unknown): string => {\n  if (error instanceof Error) {\n    return error.message;\n  }\n  if (typeof error === \"string\") {\n    return error;\n  }\n  return \"Bilinmeyen hata\";\n};\n\nexport const TaskBoard = ({ tasks, onTaskClick, onStatusChange, showProjectFilter = true, projectId: propProjectId, showArchived = false }: TaskBoardProps) => {\n  const { user, isTeamLeader, isSuperAdmin, isAdmin } = useAuth();\n  const [canCreate, setCanCreate] = useState(false);\n  const [canEditTasks, setCanEditTasks] = useState(false);\n  // Grev atamalarn saklamak iin state (taskId -> assignments map)\n  const [taskAssignmentsMap, setTaskAssignmentsMap] = useState<Record<string, Array<{ assignedTo: string; status: string }>>>({});\n  // Her task iin silme yetkisini sakla (taskId -> canDelete boolean)\n  const [taskDeletePermissions, setTaskDeletePermissions] = useState<Record<string, boolean>>({});\n  \n  // Grev oluturma yetkisi - Firestore'dan kontrol et\n  useEffect(() => {\n    const checkPermission = async () => {\n      if (!user) {\n        setCanCreate(false);\n        setCanEditTasks(false);\n        return;\n      }\n      try {\n        const departments = await getDepartments();\n        const userProfile: UserProfile = {\n          id: user.id,\n          email: user.email,\n          emailVerified: user.emailVerified,\n          fullName: user.fullName,\n          displayName: user.fullName,\n          phone: null,\n          dateOfBirth: null,\n          role: user.roles || [],\n          createdAt: null,\n          updatedAt: null,\n        };\n        const [createResult, updateResult] = await Promise.all([\n          canCreateTask(userProfile, departments),\n          canUpdateResource(userProfile, \"tasks\"),\n        ]);\n        setCanCreate(createResult);\n        setCanEditTasks(updateResult);\n      } catch (error: unknown) {\n        if (import.meta.env.DEV) {\n          console.error(\"Error checking permissions:\", error);\n        }\n        setCanCreate(false);\n        setCanEditTasks(false);\n      }\n    };\n    checkPermission();\n  }, [user]);\n  \n  // Status helper fonksiyonlar - component iinde tanml\n  const getCurrentStatusIndex = (status: string) => {\n    const index = taskStatusWorkflow.findIndex((statusItem) => statusItem.value === status);\n    return index === -1 ? 0 : index;\n  };\n\n  const getNextStatus = (currentStatus: string) => {\n    const currentIndex = getCurrentStatusIndex(currentStatus);\n    if (currentIndex === -1 || currentIndex >= taskStatusWorkflow.length - 1) {\n      return null;\n    }\n    const nextStatus = taskStatusWorkflow[currentIndex + 1];\n    \n    // \"approved\" durumuna direkt gei yaplamaz - sadece onay sreci ile geilebilir\n    if (nextStatus && nextStatus.value === \"approved\") {\n      return null;\n    }\n    \n    return nextStatus;\n  };\n\n  const [boardState, setBoardState] = useState<BoardState>({\n    columns: defaultColumns,\n    tasks: {},\n    columnOrder: defaultColumns.map((c) => c.id),\n  });\n\n  /*\n  useEffect(() => {\n    const checkTeamLeader = async () => {\n      if (!user) return;\n      try {\n        const q = query(collection(db, \"departments\"), where(\"managerId\", \"==\", user.id));\n        const snapshot = await getDocs(q);\n        setIsTeamLeader(!snapshot.empty);\n      } catch (error: unknown) {\n        if (import.meta.env.DEV) {\n          console.error(\"Error checking team leader status:\", error);\n        }\n      }\n    };\n    checkTeamLeader();\n  }, [user]);\n  */\n\n  const [selectedTask, setSelectedTask] = useState<Task | null>(null);\n  const [showTaskModal, setShowTaskModal] = useState(false);\n  const [openDropdownMenuId, setOpenDropdownMenuId] = useState<string | null>(null);\n  const [showAddTask, setShowAddTask] = useState<string | null>(null);\n  const [newTaskTitle, setNewTaskTitle] = useState(\"\");\n  const [newTaskDescription, setNewTaskDescription] = useState(\"\");\n  const [newTaskMembers, setNewTaskMembers] = useState<string[]>([]);\n  const [newTaskChecklistItems, setNewTaskChecklistItems] = useState<Array<{ text: string; completed: boolean }>>([]);\n  const [newChecklistItemText, setNewChecklistItemText] = useState(\"\");\n  const [newTaskLabelInput, setNewTaskLabelInput] = useState(\"\");\n  const [newTaskLabels, setNewTaskLabels] = useState<Array<{ name: string; color: string }>>([]);\n  const [newTaskLabelColor, setNewTaskLabelColor] = useState(LABEL_COLORS[0].value);\n  const [newTaskDueDate, setNewTaskDueDate] = useState(\"\");\n  const [newTaskOrderLink, setNewTaskOrderLink] = useState(\"none\");\n  const [quickAddPanels, setQuickAddPanels] = useState({\n    members: true,\n    checklist: true,\n  });\n  const [taskForm, setTaskForm] = useState({\n    title: \"\",\n    description: \"\",\n    labels: [] as Array<{ name: string; color: string }>,\n    dueDate: \"\",\n    labelInput: \"\",\n    labelColor: LABEL_COLORS[0].value,\n  });\n  const [saving, setSaving] = useState(false);\n  const [showLabelPicker, setShowLabelPicker] = useState(false);\n  const [showMemberAssignment, setShowMemberAssignment] = useState(false);\n  const [selectedMembers, setSelectedMembers] = useState<string[]>([]);\n  // Filtreler kaldrld - boardSearch, memberFilter, priorityFilter, projectFilter artk kullanlmyor\n  const [productionOrders, setProductionOrders] = useState<Order[]>([]);\n  const [ordersLoading, setOrdersLoading] = useState(false);\n  const [selectedOrderLink, setSelectedOrderLink] = useState(\"none\");\n  const [projects, setProjects] = useState<Map<string, Project>>(new Map());\n  const [allUsers, setAllUsers] = useState<UserProfile[]>([]);\n  const columnScrollRefs = useRef<Record<string, HTMLDivElement | null>>({});\n  const labelSectionRef = useRef<HTMLDivElement | null>(null);\n  const descriptionSectionRef = useRef<HTMLDivElement | null>(null);\n  const dueDateSectionRef = useRef<HTMLDivElement | null>(null);\n  const newCardTitleRef = useRef<HTMLDivElement | null>(null);\n  const newCardDescriptionRef = useRef<HTMLDivElement | null>(null);\n  const newCardChecklistRef = useRef<HTMLDivElement | null>(null);\n  const newCardMembersRef = useRef<HTMLDivElement | null>(null);\n  const newCardLabelsRef = useRef<HTMLDivElement | null>(null);\n\n  const quickTitleSuggestions = [\"Acil Kontrol\", \"Hzl Geri Bildirim\", \"Toplant Notu\", \"Hata Dzeltme\"];\n\n  // Tm kullanclar ykle - Her render'da yeniden ykle (performans iin optimize edilebilir)\n  useEffect(() => {\n    const fetchUsers = async () => {\n      try {\n        const users = await getAllUsers();\n        setAllUsers(users);\n      } catch (error: unknown) {\n        if (import.meta.env.DEV) {\n          console.error(\"Kullanclar yklenirken hata:\", error);\n        }\n        // Hata durumunda bo array set et\n        setAllUsers([]);\n      }\n    };\n    fetchUsers();\n  }, []);\n\n  const memberOptions = useMemo(() => {\n    // Tm kullanclar gster\n    return allUsers\n      .filter(user => user.id && (user.fullName || user.displayName || user.email))\n      .map(user => ({\n        id: user.id,\n        full_name: user.fullName || user.displayName || user.email || \"simsiz Kullanc\"\n      }));\n  }, [allUsers]);\n\n  const toggleQuickPanel = (panel: keyof typeof quickAddPanels) => {\n    setQuickAddPanels((prev) => ({ ...prev, [panel]: !prev[panel] }));\n  };\n\n  const handleAddQuickLabel = () => {\n    const labelName = newTaskLabelInput.trim();\n    if (!labelName) return;\n    if (newTaskLabels.some((label) => label.name.toLowerCase() === labelName.toLowerCase())) {\n      toast.info(\"Bu etiket zaten ekli\");\n      return;\n    }\n    setNewTaskLabels((prev) => [...prev, { name: labelName, color: newTaskLabelColor }]);\n    setNewTaskLabelInput(\"\");\n  };\n\n  const removeQuickLabel = (name: string) => {\n    setNewTaskLabels((prev) => prev.filter((label) => label.name !== name));\n  };\n\n  const highlightSection = (ref: RefObject<HTMLDivElement>) => {\n    const section = ref.current;\n    if (!section) return;\n    section.scrollIntoView({ behavior: \"smooth\", block: \"center\" });\n    section.classList.add(\"ring-2\", \"ring-[#0079BF]/40\", \"rounded-xl\");\n    setTimeout(() => {\n      section.classList.remove(\"ring-2\", \"ring-[#0079BF]/40\", \"rounded-xl\");\n    }, 900);\n  };\n\n  const scrollToNewCardSection = (ref: RefObject<HTMLDivElement>) => {\n    ref.current?.scrollIntoView({ behavior: \"smooth\", block: \"start\" });\n  };\n\n  const newCardActions = [\n    {\n      id: \"title\",\n      title: \"Balk\",\n      description: \"Kart adn belirleyin\",\n      icon: Package,\n      action: () => scrollToNewCardSection(newCardTitleRef),\n    },\n    {\n      id: \"description\",\n      title: \"Aklama\",\n      description: \"Detaylar ekleyin\",\n      icon: MessageSquare,\n      action: () => scrollToNewCardSection(newCardDescriptionRef),\n    },\n    {\n      id: \"checklist\",\n      title: \"Checklist\",\n      description: \"Adm oluturun\",\n      icon: ListChecks,\n      action: () => scrollToNewCardSection(newCardChecklistRef),\n    },\n    {\n      id: \"members\",\n      title: \"yeler\",\n      description: \"Kii atayn\",\n      icon: UserPlus,\n      action: () => scrollToNewCardSection(newCardMembersRef),\n    },\n    {\n      id: \"labels\",\n      title: \"Etiketler\",\n      description: \"Renklerle grupla\",\n      icon: Tag,\n      action: () => scrollToNewCardSection(newCardLabelsRef),\n    },\n  ];\n\n  // Etiket filtresi kaldrld - labelOptions artk kullanlmyor\n\n  // matchesFilters fonksiyonu kaldrld - filtreler yok\n\n  // Load from localStorage on mount\n  useEffect(() => {\n    const saved = localStorage.getItem(STORAGE_KEY);\n    if (saved) {\n      try {\n        const parsed = JSON.parse(saved);\n        // Eski state formatn yeni formata evir (archivedColumns kaldrld)\n        const validState: BoardState = {\n          columns: defaultColumns.map((col) => ({ ...col, taskIds: [] })),\n          tasks: parsed.tasks || {},\n          columnOrder: defaultColumns.map((c) => c.id),\n        };\n        setBoardState(validState);\n      } catch (e) {\n        // Silently fail - invalid saved state\n      }\n    }\n\n    // Filtre localStorage ilemleri kaldrld\n  }, []);\n\n  // Grev atamalarn ykle (Firestore'dan)\n  useEffect(() => {\n    const loadAssignments = async () => {\n      if (!tasks || tasks.length === 0 || !user) {\n        setTaskAssignmentsMap({});\n        return;\n      }\n      \n      try {\n        const assignmentsMap: Record<string, Array<{ assignedTo: string; status: string }>> = {};\n        \n        // Her grev iin atamalar ykle\n        await Promise.all(\n          tasks.map(async (task) => {\n            try {\n              const assignments = await getTaskAssignments(task.id);\n              assignmentsMap[task.id] = assignments.map(a => ({\n                assignedTo: a.assignedTo,\n                status: a.status,\n              }));\n            } catch (error) {\n              // Hata durumunda bo array\n              assignmentsMap[task.id] = [];\n            }\n          })\n        );\n        \n        setTaskAssignmentsMap(assignmentsMap);\n      } catch (error) {\n        if (import.meta.env.DEV) {\n          console.error(\"Error loading task assignments:\", error);\n        }\n      }\n    };\n    \n    loadAssignments();\n  }, [tasks, user]);\n  \n  // Her task iin silme yetkisini kontrol et\n  useEffect(() => {\n    const checkDeletePermissions = async () => {\n      if (!tasks || tasks.length === 0 || !user) {\n        setTaskDeletePermissions({});\n        return;\n      }\n      \n      try {\n        const userProfile: UserProfile = {\n          id: user.id,\n          email: user.email,\n          emailVerified: user.emailVerified,\n          fullName: user.fullName,\n          displayName: user.fullName,\n          phone: null,\n          dateOfBirth: null,\n          role: user.roles || [],\n          createdAt: null,\n          updatedAt: null,\n        };\n        \n        // Tm task'lar iin silme yetkisini paralel kontrol et\n        const permissionPromises = tasks.map(async (task) => {\n          try {\n            // BoardTaskInput'u Firebase Task formatna evir\n            const firebaseTask = {\n              ...task,\n              id: task.id,\n              title: task.title,\n              description: task.description || null,\n              status: task.status,\n              priority: task.priority || 0,\n              createdBy: (task as any).createdBy || null,\n            } as any;\n            const canDelete = await canDeleteTask(firebaseTask, userProfile);\n            return { taskId: task.id, canDelete };\n          } catch (error) {\n            if (import.meta.env.DEV) {\n              console.error(`Error checking delete permission for task ${task.id}:`, error);\n            }\n            return { taskId: task.id, canDelete: false };\n          }\n        });\n        \n        const permissions = await Promise.all(permissionPromises);\n        const permissionsMap: Record<string, boolean> = {};\n        permissions.forEach(({ taskId, canDelete }) => {\n          permissionsMap[taskId] = canDelete;\n        });\n        \n        setTaskDeletePermissions(permissionsMap);\n      } catch (error) {\n        if (import.meta.env.DEV) {\n          console.error(\"Error checking delete permissions:\", error);\n        }\n        setTaskDeletePermissions({});\n      }\n    };\n    \n    checkDeletePermissions();\n  }, [tasks, user]);\n  \n  // Sync tasks from props to board state\n  useEffect(() => {\n    // tasks bo olsa bile boardState'i temizlemeliyiz\n    if (tasks.length === 0) {\n      setBoardState((prev) => ({\n        ...prev,\n        tasks: {},\n        columns: prev.columns.map((col) => ({ ...col, taskIds: [] })),\n      }));\n      return;\n    }\n\n    setBoardState((prev) => {\n      // nceki grevleri temizle, sadece yeni grevleri ekle\n      const newTasks: Record<string, Task> = {};\n      // Tm kolonlar sfrla (ariv kolonu artk yok)\n      const newColumns = defaultColumns.map((col) => ({ ...col, taskIds: [] }));\n\n      tasks.forEach((task) => {\n        // Parse labels - support both old string array and new object array\n        let parsedLabels: Array<{ name: string; color: string }> = [];\n        if (task.labels) {\n          if (typeof task.labels === \"string\") {\n            try {\n              const parsed = JSON.parse(task.labels);\n              parsedLabels = Array.isArray(parsed) \n                ? (Array.isArray(parsed) ? parsed : []).map((l: string | { name: string; color?: string }) => \n                    typeof l === \"string\" \n                      ? { name: l, color: LABEL_COLORS[0].value }\n                      : { name: l.name, color: l.color || LABEL_COLORS[0].value }\n                  )\n                : [];\n            } catch {\n              parsedLabels = [];\n            }\n          } else if (Array.isArray(task.labels)) {\n            parsedLabels = (Array.isArray(task.labels) ? task.labels : []).map((l: string | { name: string; color?: string }) =>\n              typeof l === \"string\" ? { name: l, color: LABEL_COLORS[0].value } : { name: l.name, color: l.color || LABEL_COLORS[0].value }\n            );\n          }\n        }\n\n        const taskData: Task = {\n          id: task.id,\n          title: task.title,\n          description: task.description,\n          labels: parsedLabels,\n          dueDate: task.due_date,\n          createdAt: task.created_at,\n          status: task.status,\n          priority: task.priority || 0,\n          projectId: task.projectId || null,\n          assignedUsers: (Array.isArray(task.assignments) ? task.assignments : []).map((assignment: { assigned_to?: string; assigned_to_name?: string; assigned_to_email?: string }) => ({\n            id: assignment.assigned_to,\n            full_name: assignment.assigned_to_name || assignment.assigned_to_email || \"Kullanc\",\n          })),\n          attachments: Array.isArray(task.attachments) ? task.attachments.length : (typeof task.attachments === 'number' ? task.attachments : 0),\n          comments: 0, // Comments count will be added when backend support is available\n          checklists: [], // Checklists will be added when backend support is available\n          createdBy: task.createdBy || task.created_by,\n          approvalStatus: task.approvalStatus,\n          linkedProductionOrder: task.production_order_id\n            ? {\n                id: task.production_order_id,\n                orderNumber: task.production_order_number,\n                customerName: task.production_order_customer,\n                priority: task.production_order_priority,\n                dueDate: task.production_order_due_date,\n                status: task.production_order_status,\n              }\n            : undefined,\n          // Grev havuzu bilgilerini ekle\n          isInPool: task.isInPool === true,\n          poolRequests: Array.isArray(task.poolRequests) ? task.poolRequests : [],\n        };\n        newTasks[task.id] = taskData;\n\n        // Arivlenmi grevleri atla - sadece showArchived=false ise (archive filtresi aktif deilse)\n        if (!showArchived && (task.is_archived || task.isArchived)) {\n          return; // Arivlenmi grevleri board'da gsterme (archive filtresi aktif deilse)\n        }\n\n        // Status' normalize et (column_ prefix'ini kaldr)\n        const normalizedStatus = normalizeStatus(task.status);\n\n        // Onaylanm grevler iin \"Onayland\" kolonu (status: completed, approvalStatus: approved)\n        // Ayrca eski \"cancelled\" durumundaki grevleri de \"Onayland\" kolonuna ta\n        // approvalStatus kontroln daha gvenli yap (undefined, null, \"approved\" kontrol)\n        const isApproved = (task.approvalStatus as string) === \"approved\";\n        if (normalizedStatus === \"completed\" && isApproved) {\n          const approvedCol = newColumns.find((c) => c.id === \"approved\");\n          if (approvedCol) {\n            approvedCol.taskIds.push(task.id);\n            return; // Bu grevi yerletirdik, devam etme\n          }\n        }\n        // Eski \"cancelled\" durumundaki grevleri \"Onayland\" kolonuna ta\n        if (normalizedStatus === \"cancelled\" || task.status === \"cancelled\") {\n          const approvedCol = newColumns.find((c) => c.id === \"approved\");\n          if (approvedCol) {\n            approvedCol.taskIds.push(task.id);\n            return; // Bu grevi yerletirdik, devam etme\n          }\n        }\n        // Dier grevler normalize edilmi status kolonlarna\n        const col = newColumns.find((c) => c.id === normalizedStatus);\n        if (col) {\n          col.taskIds.push(task.id);\n        } else {\n          // Eer normalize edilmi status defaultColumns iinde yoksa, \"pending\" kolonuna ekle\n          // Bu, bilinmeyen status'lerin de grnmesini salar\n          const pendingCol = newColumns.find((c) => c.id === \"pending\");\n          if (pendingCol) {\n            pendingCol.taskIds.push(task.id);\n          }\n        }\n      });\n\n      return {\n        ...prev,\n        tasks: newTasks,\n        columns: newColumns,\n        columnOrder: newColumns.map((c) => c.id), // Tm kolonlar her zaman gsterilir\n      };\n    });\n  }, [tasks, JSON.stringify(tasks.map(t => t.id))]);\n\n  // Save to localStorage whenever board state changes\n  useEffect(() => {\n    localStorage.setItem(STORAGE_KEY, JSON.stringify(boardState));\n  }, [boardState]);\n\n  // Fetch production orders for linking\n  useEffect(() => {\n    const fetchProductionOrders = async () => {\n      setOrdersLoading(true);\n      try {\n        const orders = await getOrders({ status: undefined }); // Tm sipariler\n        setProductionOrders(orders);\n      } catch (error: unknown) {\n        if (import.meta.env.DEV) {\n          if (import.meta.env.DEV) {\n            console.error(\"Fetch production orders error:\", error);\n          }\n        }\n        toast.error(\"Sipariler yklenirken hata olutu\");\n      } finally {\n        setOrdersLoading(false);\n      }\n    };\n    fetchProductionOrders();\n  }, []);\n\n  // Fetch projects\n  useEffect(() => {\n    const fetchProjects = async () => {\n      try {\n        const allProjects = await getProjects();\n        const projectsMap = new Map<string, Project>();\n        allProjects.forEach((p) => {\n          projectsMap.set(p.id, p);\n        });\n        setProjects(projectsMap);\n      } catch (error: unknown) {\n        if (import.meta.env.DEV) {\n          console.error(\"Fetch projects error:\", error);\n        }\n      }\n    };\n    fetchProjects();\n  }, []);\n\n  // Filtre localStorage kaydetme kaldrld\n\n  // Sonraki aamaya ge fonksiyonu\n  const handleNextStage = async (taskId: string, currentStatus: string) => {\n    try {\n      // Aama sras: pending -> in_progress -> completed -> onaya gnder -> approved (ynetici onaylar)\n      const statusFlow: Record<string, string> = {\n        pending: \"in_progress\",\n        in_progress: \"completed\",\n        // completed durumunda onaya gnderilir, ynetici onaylarsa status completed + approvalStatus approved olur\n      };\n\n      const nextStatus = statusFlow[currentStatus];\n      if (!nextStatus) {\n        toast.error(\"Bu aamadan sonraki aama bulunamad\");\n        return;\n      }\n\n      // Yetki kontrol: SISTEM_YETKILERI.md'ye gre\n      // - Super Admin: Tm grevlerin durumunu deitirebilir\n      // - Team Leader: Tm grevlerin durumunu deitirebilir\n      // - Personnel: Sadece atanan grevlerin durumunu deitirebilir (accepted veya pending durumunda)\n      // - Grevi oluturan: Her zaman durum deitirebilir\n      const task = boardState.tasks[taskId];\n      if (!task) return;\n\n      // Atamalar kontrol et - greve ye edilen herkes (rejected hari) buton grebilir\n      // Kullanc istei: Ekip lideri, personel, ynetici - greve ye edilen herkes butonu grebilmeli\n      let isAssigned = false;\n      try {\n        const assignments = await getTaskAssignments(taskId);\n        // Rejected hari tm durumlar (pending, accepted, completed) iin kontrol\n        isAssigned = assignments.some(\n          (a) => a.assignedTo === user?.id && a.status !== \"rejected\"\n        );\n      } catch (error) {\n        // Fallback: task.assignedUsers array'inden kontrol et\n        isAssigned = task.assignedUsers?.some((u) => u.id === user?.id) || false;\n      }\n      \n      const isCreator = task.createdBy === user?.id || (task as { created_by?: string }).created_by === user?.id;\n      \n      // Yetki kontrol: SADECE grev yesi (rejected hari) veya oluturan durum deitirebilir\n      // Yneticiler iin zel durum YOK - sadece grev yeleri durum deitirebilir\n      const canMoveTask = isAssigned || isCreator;\n      \n      if (!canMoveTask) {\n        toast.error(\"Bu grevi tama yetkiniz yok. Sadece size atanan grevleri veya oluturduunuz grevleri tayabilirsiniz.\");\n        return;\n      }\n\n      // Tamamland durumuna geerken onaya gnder\n      if (nextStatus === \"completed\" && currentStatus === \"in_progress\") {\n        // SADECE grev yesi (rejected hari) veya oluturan direkt tamamlayabilir\n        // Yneticiler iin zel durum YOK\n        const isCreator = task.createdBy === user?.id;\n        const canDirectComplete = isAssigned || isCreator;\n        \n        if (!canDirectComplete) {\n          // Normal kullanc onaya gnderir\n          const { requestTaskApproval } = await import(\"@/services/firebase/taskService\");\n          await requestTaskApproval(taskId, user?.id || \"\");\n          toast.success(\"Grev tamamland olarak iaretlendi ve onay iin yneticiye gnderildi.\");\n          return;\n        }\n      }\n\n      await onStatusChange(taskId, nextStatus);\n    } catch (error) {\n      toast.error(\"Aama geii yaplamad\");\n    }\n  };\n\n  // Onaya gnder fonksiyonu\n  const handleRequestApproval = async (taskId: string) => {\n    try {\n      if (!user?.id) {\n        toast.error(\"Kullanc bilgisi bulunamad\");\n        return;\n      }\n\n      await requestTaskApproval(taskId, user.id);\n      toast.success(\"Grev onay iin yneticiye gnderildi.\");\n      \n      // Grevi yeniden ykle\n      const task = boardState.tasks[taskId];\n      if (task) {\n        try {\n          const updatedTask = await getTaskById(taskId);\n          if (updatedTask) {\n            setBoardState((prev) => ({\n              ...prev,\n              tasks: {\n                ...prev.tasks,\n                [taskId]: updatedTask as unknown as Task,\n              },\n            }));\n          }\n        } catch (error) {\n          console.error(\"Error refreshing task:\", error);\n        }\n      }\n    } catch (error) {\n      const errorMessage = error instanceof Error ? error.message : String(error);\n      toast.error(\"Onay istei gnderilemedi: \" + (errorMessage || \"Bilinmeyen hata\"));\n    }\n  };\n\n  // clearBoardFilters fonksiyonu kaldrld - filtreler yok\n\n  // Liste ekleme/dzenleme/arivleme/silme zellikleri kaldrld - sabit 4 kolon kullanlyor\n\n  const handleAddTask = async (columnId: string, quickAdd: boolean = false) => {\n    // Firestore'dan yetki kontrol\n    if (!canCreate) {\n      toast.error(\"Grev ekleme yetkiniz yok. Sadece ynetici veya ekip lideri ekleyebilir.\");\n      return;\n    }\n\n    // Artk direkt grev oluturmak yerine TaskInlineForm'u ayoruz\n    // initialStatus olarak columnId'yi kullanyoruz\n    onTaskClick(\"new\", columnId);\n    return;\n    \n    // Eski kod - artk kullanlmyor\n    if (!newTaskTitle.trim() || !user) return;\n\n    const trimmedTitle = newTaskTitle.trim();\n    const trimmedDescription = newTaskDescription.trim();\n    const labelNames = newTaskLabels.map((label) => label.name);\n    const dueDateTimestamp = newTaskDueDate ? Timestamp.fromDate(new Date(newTaskDueDate)) : null;\n    const linkedOrderId = newTaskOrderLink !== \"none\" ? newTaskOrderLink : null;\n\n    setSaving(true);\n    try {\n      // Yetki kontrol: Grev oluturma yetkisi var m?\n      if (!canCreate) {\n        const departments = await getDepartments();\n        const userProfile: UserProfile = {\n          id: user.id,\n          email: user.email,\n          emailVerified: user.emailVerified,\n          fullName: user.fullName,\n          displayName: user.fullName,\n          phone: null,\n          dateOfBirth: null,\n          role: user.roles || [],\n          createdAt: null,\n          updatedAt: null,\n        };\n        const canCreateResult = await canCreateTask(userProfile, departments);\n        if (!canCreateResult) {\n          toast.error(\"Grev oluturma yetkiniz yok. Sadece yneticiler ve ekip liderleri grev oluturabilir.\");\n          setSaving(false);\n          return;\n        }\n      }\n\n      const task = await createTask({\n        title: trimmedTitle,\n        description: trimmedDescription || null,\n        status: columnId as \"pending\" | \"in_progress\" | \"completed\",\n        priority: 2,\n        dueDate: dueDateTimestamp,\n        labels: labelNames.length > 0 ? labelNames : null,\n        productionOrderId: linkedOrderId,\n        productionProcessId: null,\n        createdBy: user.id,\n      });\n\n      const taskId = task.id;\n      \n      // Assign members if any selected and send email notifications\n      if (Array.isArray(newTaskMembers) && newTaskMembers.length > 0) {\n        // Alt yetki kontrol - grev atama\n        try {\n          const { canPerformSubPermission } = await import(\"@/utils/permissions\");\n          const userProfile: UserProfile = {\n            id: user.id,\n            email: user.email,\n            emailVerified: user.emailVerified,\n            fullName: user.fullName,\n            displayName: user.fullName,\n            phone: user.phone,\n            dateOfBirth: user.dateOfBirth,\n            role: user.roles || [],\n            createdAt: null,\n            updatedAt: null,\n          };\n          const hasPermission = await canPerformSubPermission(userProfile, \"tasks\", \"canAssign\");\n          // SISTEM_YETKILERI.md'ye gre: Super Admin ve Team Leader grev atayabilir\n          // Firestore'dan yetki kontrol\n          if (!hasPermission && user) {\n            try {\n              const userProfile: UserProfile = {\n                id: user.id,\n                email: user.email,\n                emailVerified: user.emailVerified,\n                fullName: user.fullName,\n                displayName: user.fullName,\n                phone: null,\n                dateOfBirth: null,\n                role: user.roles || [],\n                createdAt: null,\n                updatedAt: null,\n              };\n              const isMainAdminUser = await isMainAdmin(userProfile);\n              const canUpdate = await canUpdateResource(userProfile, \"tasks\");\n              const canAssign = await canPerformSubPermission(userProfile, \"tasks\", \"canAssign\");\n              if (!isMainAdminUser && !canUpdate && !canAssign) {\n                toast.error(\"Grev atama yetkiniz yok\");\n                return;\n              }\n            } catch (error: unknown) {\n              if (import.meta.env.DEV) {\n                console.error(\"Error checking assign permission:\", error);\n              }\n              toast.error(\"Grev atama yetkiniz yok\");\n              return;\n            }\n          }\n        } catch (error: unknown) {\n          if (import.meta.env.DEV) {\n            console.error(\"Permission check error:\", error);\n          }\n          // Hata durumunda devam et (eski davran)\n        }\n\n        try {\n          const allUsers = await getAllUsers();\n          await Promise.all(\n            newTaskMembers.map(async (userId) => {\n              const assignment = await assignTask(taskId, userId, user.id);\n              \n              // Email bildirimi gnder - assignment_id ile birlikte\n              // Hata olsa bile sessizce devam et\n              try {\n                const assignedUser = allUsers.find((u) => u.id === userId);\n                if (assignedUser) {\n                  await createNotification({\n                    userId: userId,\n                    type: \"task_assigned\",\n                    title: \"Yeni grev atand\",\n                    message: `${user.fullName || user.email || \"Bir kullanc\"} size \"${newTaskTitle.trim()}\" grevini atad. Grev detaylarn grntlemek iin bildirime tklayabilirsiniz.`,\n                    read: false,\n                    relatedId: taskId,\n                    metadata: { assignment_id: assignment.id }, // Assignment ID'yi metadata'ya ekle\n                  });\n                }\n              } catch (notifError) {\n                // Bildirim hatas kritik deil, sessizce devam et\n              }\n            })\n          );\n        } catch (assignError: unknown) {\n          if (import.meta.env.DEV) {\n            console.error(\"Assignment error:\", assignError);\n          }\n          // Continue even if assignment fails\n        }\n      }\n\n      // Create checklist if items exist\n      if (newTaskChecklistItems.length > 0) {\n        try {\n          await createChecklist(taskId, \"Checklist\", newTaskChecklistItems);\n        } catch (checklistError: unknown) {\n          if (import.meta.env.DEV) {\n            console.error(\"Checklist creation error:\", checklistError);\n          }\n          // Continue even if checklist creation fails\n        }\n      }\n\n      // Fetch updated task with assignments\n      try {\n        const [taskData, assignments, allUsers] = await Promise.all([\n          getTaskById(taskId),\n          getTaskAssignments(taskId),\n          getAllUsers(),\n        ]);\n\n        if (taskData) {\n          const assignedUsers = assignments.map((a) => {\n            const userProfile = allUsers.find((u) => u.id === a.assignedTo);\n            return {\n              id: a.assignedTo,\n              full_name: userProfile?.fullName || userProfile?.displayName || \"Kullanc\",\n            };\n          });\n\n          const linkedOrder =\n            linkedOrderId && productionOrders.length > 0\n              ? productionOrders.find((order) => order.id === linkedOrderId)\n              : undefined;\n\n      const rawCreatedAt = taskData.createdAt;\n      const createdAtDate =\n        rawCreatedAt instanceof Timestamp\n          ? rawCreatedAt.toDate()\n          : new Date(rawCreatedAt as unknown as string | number | Date);\n\n      const newTask: Task = {\n            id: taskData.id,\n            title: taskData.title,\n            description: taskData.description || null,\n            labels: newTaskLabels,\n            dueDate: dueDateTimestamp ? dueDateTimestamp.toDate().toISOString() : undefined,\n        createdAt: createdAtDate.toISOString(),\n            status: taskData.status,\n            priority: taskData.priority || 2,\n            assignedUsers,\n            attachments: 0,\n            comments: 0,\n            checklists:\n              newTaskChecklistItems.length > 0\n                ? [\n                    {\n                      completed: newTaskChecklistItems.filter((i) => i.completed).length,\n                      total: newTaskChecklistItems.length,\n                    },\n                  ]\n                : [],\n            linkedProductionOrder: linkedOrder\n              ? {\n                  id: linkedOrder.id,\n                  orderNumber: linkedOrder.order_number,\n                  customerName: linkedOrder.customer_name,\n                  priority: linkedOrder.priority,\n                  dueDate: linkedOrder.due_date,\n                  status: linkedOrder.status,\n                }\n              : undefined,\n          };\n\n          setBoardState((prev) => ({\n            ...prev,\n            tasks: { ...prev.tasks, [newTask.id]: newTask },\n            columns: prev.columns.map((col) =>\n              col.id === columnId ? { ...col, taskIds: [...col.taskIds, newTask.id] } : col\n            ),\n          }));\n          }\n        } catch (fetchError: unknown) {\n          // Fallback to basic task if fetch fails\n          console.error(\"Fetch task details error:\", fetchError);\n          const newTask: Task = {\n            id: taskId,\n          title: trimmedTitle,\n          description: trimmedDescription || null,\n          labels: newTaskLabels,\n          dueDate: dueDateTimestamp ? dueDateTimestamp.toDate().toISOString() : undefined,\n            createdAt: new Date().toISOString(),\n            status: columnId,\n            priority: 2,\n            assignedUsers: [],\n            attachments: 0,\n            comments: 0,\n          checklists:\n            newTaskChecklistItems.length > 0\n              ? [\n                  {\n                    completed: newTaskChecklistItems.filter((i) => i.completed).length,\n                    total: newTaskChecklistItems.length,\n                  },\n                ]\n              : [],\n          linkedProductionOrder: linkedOrderId\n            ? {\n                id: linkedOrderId,\n                orderNumber: productionOrders.find((order) => order.id === linkedOrderId)?.order_number,\n                customerName: productionOrders.find((order) => order.id === linkedOrderId)?.customer_name,\n              }\n            : undefined,\n          };\n\n          setBoardState((prev) => ({\n            ...prev,\n            tasks: { ...prev.tasks, [newTask.id]: newTask },\n            columns: prev.columns.map((col) =>\n              col.id === columnId ? { ...col, taskIds: [...col.taskIds, newTask.id] } : col\n            ),\n          }));\n        }\n\n      setNewTaskTitle(\"\");\n      setNewTaskDescription(\"\");\n      setNewTaskMembers([]);\n      setNewTaskChecklistItems([]);\n      setNewChecklistItemText(\"\");\n      setNewTaskLabels([]);\n      setNewTaskLabelInput(\"\");\n      setNewTaskLabelColor(LABEL_COLORS[0].value);\n      setNewTaskDueDate(\"\");\n      setNewTaskOrderLink(\"none\");\n      setShowAddTask(null);\n      setShowTaskModal(false);\n      setSelectedTask(null);\n      toast.success(\"Kart eklendi\");\n      requestAnimationFrame(() => {\n        const container = columnScrollRefs.current[columnId];\n        if (container) {\n          container.scrollTo({\n            top: container.scrollHeight,\n            behavior: \"smooth\",\n          });\n        }\n      });\n    } catch (err: unknown) {\n      if (import.meta.env.DEV) {\n        console.error(\"Add task error:\", err);\n      }\n      const errorMessage = getErrorMessage(err);\n      toast.error(\"Kart eklenemedi: \" + errorMessage);\n    } finally {\n      setSaving(false);\n    }\n  };\n\n  const fetchProductionOrderList = async () => {\n    setOrdersLoading(true);\n    try {\n      const orders = await getOrders({ status: undefined }); // Tm sipariler\n      setProductionOrders(orders);\n    } catch (error: unknown) {\n      console.error(\"Fetch production orders error:\", error);\n      toast.error(\"Sipariler yklenirken hata olutu\");\n    } finally {\n      setOrdersLoading(false);\n    }\n    //   console.error(\"Fetch production orders error:\", error);\n    //   toast.error(\"Sipariler yklenemedi: \" + (error.message || \"Bilinmeyen hata\"));\n    //   setProductionOrders([]);\n    // } finally {\n    //   setOrdersLoading(false);\n    // }\n  };\n\n  useEffect(() => {\n    if (showTaskModal && (!Array.isArray(productionOrders) || productionOrders.length === 0)) {\n      fetchProductionOrderList();\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [showTaskModal]);\n\n  useEffect(() => {\n    if (showAddTask && (!Array.isArray(productionOrders) || productionOrders.length === 0)) {\n      fetchProductionOrderList();\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [showAddTask]);\n\n  useEffect(() => {\n    if (selectedTask) {\n      setSelectedOrderLink(selectedTask.linkedProductionOrder?.id || \"none\");\n    }\n  }, [selectedTask]);\n\n  const handleLinkProductionOrder = async (orderId: string | null) => {\n    if (!selectedTask) return;\n    setSaving(true);\n    try {\n      await updateTask(selectedTask.id, {\n        productionOrderId: orderId || null,\n      });\n\n      const orderInfo =\n        orderId && Array.isArray(productionOrders) && productionOrders.length > 0\n          ? productionOrders.find((order) => order.id === orderId)\n          : null;\n      const linked = orderId\n        ? {\n            id: orderId,\n            orderNumber: orderInfo?.order_number,\n            customerName: orderInfo?.customer_name,\n            priority: orderInfo?.priority,\n            dueDate: orderInfo?.due_date,\n            status: orderInfo?.status,\n          }\n        : undefined;\n\n      const updatedTask: Task = {\n        ...selectedTask,\n        linkedProductionOrder: linked,\n      };\n\n      setSelectedTask(updatedTask);\n      setBoardState((prev) => ({\n        ...prev,\n        tasks: { ...prev.tasks, [selectedTask.id]: updatedTask },\n      }));\n      setSelectedOrderLink(orderId || \"none\");\n      toast.success(orderId ? \"Sipari balants gncellendi\" : \"Balant kaldrld\");\n    } catch (error: unknown) {\n      if (import.meta.env.DEV) {\n        console.error(\"Link production order error:\", error);\n      }\n      const errorMessage = getErrorMessage(error);\n      toast.error(\"Balant gncellenemedi: \" + errorMessage);\n    } finally {\n      setSaving(false);\n    }\n  };\n\n  const handleEditTask = async () => {\n    if (!selectedTask || !taskForm.title.trim()) return;\n\n    setSaving(true);\n    try {\n      const dueDate = taskForm.dueDate ? Timestamp.fromDate(new Date(taskForm.dueDate)) : null;\n      const labelsArray = taskForm.labels.map((l) => l.name);\n      \n      await updateTask(selectedTask.id, {\n        title: taskForm.title,\n        description: taskForm.description || null,\n        dueDate,\n        labels: labelsArray.length > 0 ? labelsArray : null,\n      });\n\n      const updatedTask: Task = {\n        ...selectedTask,\n        title: taskForm.title,\n        description: taskForm.description,\n        labels: taskForm.labels,\n        dueDate: taskForm.dueDate,\n      };\n\n      setBoardState((prev) => ({\n        ...prev,\n        tasks: { ...prev.tasks, [selectedTask.id]: updatedTask },\n      }));\n\n      setShowTaskModal(false);\n      setSelectedTask(null);\n      toast.success(\"Kart gncellendi\");\n    } catch (error: unknown) {\n      if (import.meta.env.DEV) {\n        console.error(\"Edit task error:\", error);\n      }\n      const errorMessage = getErrorMessage(error);\n      toast.error(\"Kart gncellenemedi: \" + errorMessage);\n    } finally {\n      setSaving(false);\n    }\n  };\n\n  const handleDeleteTask = async (taskId: string) => {\n    if (!confirm(\"Bu kart silmek istediinize emin misiniz?\")) return;\n\n    try {\n      await deleteTask(taskId);\n      const column = boardState.columns.find((c) => c.taskIds.includes(taskId));\n      if (column) {\n        setBoardState((prev) => ({\n          ...prev,\n          tasks: Object.fromEntries(Object.entries(prev.tasks).filter(([id]) => id !== taskId)),\n          columns: prev.columns.map((c) =>\n            c.id === column.id ? { ...c, taskIds: c.taskIds.filter((id) => id !== taskId) } : c\n          ),\n        }));\n      }\n      toast.success(\"Kart silindi\");\n    } catch (error: unknown) {\n      if (import.meta.env.DEV) {\n        console.error(\"Delete task error:\", error);\n      }\n      const errorMessage = getErrorMessage(error);\n      toast.error(\"Kart silinemedi: \" + errorMessage);\n    }\n  };\n\n  const handleArchiveTask = async (taskId: string) => {\n    if (!user?.id) return;\n    try {\n      await archiveTask(taskId, user.id);\n      const column = boardState.columns.find((c) => c.taskIds.includes(taskId));\n      if (column) {\n        setBoardState((prev) => ({\n          ...prev,\n          tasks: Object.fromEntries(Object.entries(prev.tasks).filter(([id]) => id !== taskId)),\n          columns: prev.columns.map((c) =>\n            c.id === column.id ? { ...c, taskIds: c.taskIds.filter((id) => id !== taskId) } : c\n          ),\n        }));\n      }\n      toast.success(\"Grev arivlendi\");\n    } catch (error: unknown) {\n      if (import.meta.env.DEV) {\n        console.error(\"Archive task error:\", error);\n      }\n      const errorMessage = getErrorMessage(error);\n      toast.error(\"Grev arivlenemedi: \" + errorMessage);\n    }\n  };\n\n  const openTaskModal = (task: Task) => {\n    // Parent component'e ynlendir (TaskInlineForm alacak)\n    onTaskClick(task.id, task.status);\n  };\n\n  const handleRequestTaskFromPool = async (taskId: string) => {\n    if (!user?.id) {\n      toast.error(\"Grev talep etmek iin giri yapmalsnz\");\n      return;\n    }\n\n    try {\n      await requestTaskFromPool(taskId, user.id);\n      toast.success(\"Grev talebi gnderildi\");\n      // Modal amaya gerek yok, sadece baar mesaj yeterli\n    } catch (error: unknown) {\n      if (import.meta.env.DEV) {\n        console.error(\"Request task from pool error:\", error);\n      }\n      const errorMessage = getErrorMessage(error);\n      toast.error(\"Grev talebi gnderilemedi: \" + errorMessage);\n    }\n  };\n\n  const handleRemoveFromPool = async (taskId: string) => {\n    if (!user?.id) {\n      toast.error(\"Grev havuzundan kaldrmak iin giri yapmalsnz\");\n      return;\n    }\n\n    try {\n      await removeTaskFromPool(taskId);\n      toast.success(\"Grev havuzundan kaldrld\");\n    } catch (error: unknown) {\n      if (import.meta.env.DEV) {\n        console.error(\"Remove task from pool error:\", error);\n      }\n      const errorMessage = getErrorMessage(error);\n      toast.error(\"Grev havuzundan kaldrlamad: \" + errorMessage);\n    }\n  };\n\n  const handleAssignMembers = async () => {\n    if (!selectedTask || !user) return;\n\n    setSaving(true);\n    try {\n      // Mevcut atamalar al\n      const currentAssignments = Array.isArray(selectedTask.assignedUsers) ? selectedTask.assignedUsers.map(u => u.id) : [];\n      \n      // Mevcut assignment'lar detayl olarak al (silme ilemi iin)\n      const existingAssignments = await getTaskAssignments(selectedTask.id);\n      \n      // Yeni eklenen kullanclar ata\n      const toAdd = selectedMembers.filter(id => !currentAssignments.includes(id));\n      for (const userId of toAdd) {\n        try {\n          await assignTask(selectedTask.id, userId, user.id);\n        } catch (error: unknown) {\n          console.error(\"Assignment error:\", error);\n          // Continue even if assignment fails\n        }\n      }\n\n      // Kaldrlan kullanclar sil\n      const toRemove = currentAssignments.filter(id => !selectedMembers.includes(id));\n      for (const userId of toRemove) {\n        try {\n          const userAssignment = existingAssignments.find(a => a.assignedTo === userId);\n          if (userAssignment) {\n            await deleteTaskAssignment(selectedTask.id, userAssignment.id, user.id);\n          }\n        } catch (error: unknown) {\n          if (import.meta.env.DEV) {\n            console.error(\"Delete assignment error:\", error);\n          }\n          // Continue even if deletion fails\n        }\n      }\n\n      toast.success(\"yeler gncellendi\");\n      setShowMemberAssignment(false);\n      \n      // Task' yeniden ykle\n      const [taskData, assignments, allUsers] = await Promise.all([\n        getTaskById(selectedTask.id),\n        getTaskAssignments(selectedTask.id),\n        getAllUsers(),\n      ]);\n\n      if (taskData) {\n        const assignedUsers = assignments.map((a) => {\n          const userProfile = allUsers.find((u) => u.id === a.assignedTo);\n          return {\n            id: a.assignedTo,\n            full_name: userProfile?.fullName || userProfile?.displayName || '',\n          };\n        });\n\n        const updatedTask: Task = {\n          ...selectedTask,\n          assignedUsers,\n        };\n        setSelectedTask(updatedTask);\n        setBoardState((prev) => ({\n          ...prev,\n          tasks: { ...prev.tasks, [selectedTask.id]: updatedTask },\n        }));\n      }\n    } catch (error: unknown) {\n      if (import.meta.env.DEV) {\n        console.error(\"Assign members error:\", error);\n      }\n      const errorMessage = getErrorMessage(error);\n      toast.error(\"ye atama hatas: \" + errorMessage);\n    } finally {\n      setSaving(false);\n    }\n  };\n\n  const addLabel = () => {\n    if (taskForm.labelInput.trim() && !taskForm.labels.some(l => l.name === taskForm.labelInput.trim())) {\n      setTaskForm((prev) => ({\n        ...prev,\n        labels: [...prev.labels, { name: prev.labelInput.trim(), color: prev.labelColor }],\n        labelInput: \"\",\n      }));\n    }\n  };\n\n  const removeLabel = (labelName: string) => {\n    setTaskForm((prev) => ({\n      ...prev,\n      labels: prev.labels.filter((l) => l.name !== labelName),\n    }));\n  };\n\n  const getInitials = (name: string) => {\n    return name\n      .split(\" \")\n      .map((n) => n[0])\n      .join(\"\")\n      .toUpperCase()\n      .slice(0, 2);\n  };\n\n  const getDueDateDisplay = (dueDate: string | Timestamp) => {\n    const date = dueDate instanceof Timestamp ? dueDate.toDate() : new Date(dueDate);\n    if (isPast(date) && !isToday(date)) {\n      return { text: format(date, \"dd MMM\", { locale: tr }), className: \"bg-[#EC9488] text-white\" };\n    }\n    if (isToday(date)) {\n      return { text: \"Bugn\", className: \"bg-[#F5D90A] text-[#172B4D]\" };\n    }\n    if (isTomorrow(date)) {\n      return { text: \"Yarn\", className: \"bg-[#F5D90A] text-[#172B4D]\" };\n    }\n    return { text: format(date, \"dd MMM\", { locale: tr }), className: \"bg-[#DFE1E6] text-[#172B4D]\" };\n  };\n\n  // ncelik gsterimi iin helper - Eski sistem (1-5) varsa yeni sisteme (0-5) evir\n  const getPriorityDisplay = (priority: number | undefined) => {\n    if (!priority) {\n      const option = getPriorityOption(0);\n      return { label: option.label, icon: ChevronDown, color: option.color };\n    }\n    // Eski sistem (1-5) varsa yeni sisteme (0-5) evir\n    const newPriority = convertOldPriorityToNew(priority);\n    const option = getPriorityOption(newPriority);\n    // Icon seimi: 0-1 = down, 2-3 = minus, 4-5 = up\n    const icon = newPriority <= 1 ? ChevronDown : newPriority <= 3 ? Minus : ChevronUp;\n    return { label: option.label, icon, color: option.color };\n  };\n\n  const quickActionButtons = [\n    {\n      key: \"members\",\n      label: \"ye Ekle\",\n      description: \"Kart kime atayacan se\",\n      icon: <UserPlus className=\"h-4 w-4\" />,\n      onClick: () => toggleQuickPanel(\"members\"),\n      toggle: true,\n      active: quickAddPanels.members,\n    },\n    {\n      key: \"labels\",\n      label: \"Etiketler\",\n      description: \"Renk paleti ile kart kodla\",\n      icon: <Tag className=\"h-4 w-4\" />,\n      onClick: () => highlightSection(labelSectionRef),\n      toggle: false,\n      active: false,\n    },\n    {\n      key: \"checklist\",\n      label: \"Checklist\",\n      description: \"Admlar takip listesine ayr\",\n      icon: <ListChecks className=\"h-4 w-4\" />,\n      onClick: () => toggleQuickPanel(\"checklist\"),\n      toggle: true,\n      active: quickAddPanels.checklist,\n    },\n    {\n      key: \"date\",\n      label: \"Tarih\",\n      description: \"Biti tarihini belirle\",\n      icon: <Calendar className=\"h-4 w-4\" />,\n      onClick: () => highlightSection(dueDateSectionRef),\n      toggle: false,\n      active: Boolean(newTaskDueDate),\n    },\n    {\n      key: \"description\",\n      label: \"Aklama\",\n      description: \"Detayl bilgi ekle\",\n      icon: <MessageSquare className=\"h-4 w-4\" />,\n      onClick: () => highlightSection(descriptionSectionRef),\n      toggle: false,\n      active: Boolean(newTaskDescription.trim()),\n    },\n  ];\n\n  return (\n    <div className=\"flex flex-col bg-[#F4F5F7] min-h-[500px] rounded-lg border border-[#DFE1E6]\">\n      {/* Header kaldrld - filtreler ve balk yok */}\n\n      {/* Board - Sabit kolonlar, drag & drop yok */}\n      <div \n        className=\"pb-8 px-2 sm:px-3 md:px-6 pt-3 sm:pt-4 md:pt-6\"\n        draggable={false}\n        onDragStart={(e) => e.preventDefault()}\n        onDragOver={(e) => e.preventDefault()}\n        onDrop={(e) => e.preventDefault()}\n      >\n        <div \n          className=\"flex flex-col md:flex-row gap-3 md:gap-4 pb-6 w-full\"\n          draggable={false}\n          onDragStart={(e) => e.preventDefault()}\n          onDragOver={(e) => e.preventDefault()}\n          onDrop={(e) => e.preventDefault()}\n        >\n          {boardState.columnOrder.map((columnId) => {\n              const column = boardState.columns.find((c) => c.id === columnId);\n              if (!column) return null;\n\n              const columnTasks = Array.isArray(column.taskIds) \n                ? column.taskIds\n                    .map((id) => boardState.tasks[id])\n                    .filter((task) => task !== undefined) // Sadece undefined olmayan grevleri filtrele\n                : [];\n              const difficultyLabel = column.title.toLowerCase().includes(\"tamam\") || column.id === \"completed\"\n                ? \"EASY\"\n                : column.title.toLowerCase().includes(\"progress\")\n                ? \"MEDIUM\"\n                : \"FOCUS\";\n\n              return (\n                <div\n                  key={column.id}\n                  draggable={false}\n                  onDragStart={(e) => e.preventDefault()}\n                  onDragOver={(e) => e.preventDefault()}\n                  onDrop={(e) => e.preventDefault()}\n                  className=\"flex-shrink-0 w-full md:flex-1 md:min-w-0 bg-[#EBECF0] rounded-lg p-2 sm:p-3 flex flex-col transition-all shadow-sm\"\n                  style={{ overflow: 'visible' }}\n                >\n                      {/* Column Header - Sabit kolonlar, dzenleme yok */}\n                      <div className=\"flex items-center justify-between mb-2 px-2 py-1\">\n                        <h3 className=\"font-semibold text-[11px] sm:text-xs text-[#172B4D] flex-1 px-2 py-1\">\n                          {(() => {\n                            // Eer column.id teknik bir ID ise (column_ ile balyorsa), defaultColumns'dan title' al\n                            if (column.id.startsWith(\"column_\")) {\n                              const defaultColumn = defaultColumns.find(c => c.id === column.id.replace(\"column_\", \"\"));\n                              return defaultColumn?.title || column.title;\n                            }\n                            // Eer column.id defaultColumns'da yoksa, defaultColumns'dan title' al\n                            const defaultColumn = defaultColumns.find(c => c.id === column.id);\n                            return defaultColumn?.title || column.title;\n                          })()}\n                        </h3>\n                        <div className=\"flex items-center gap-1\">\n                          <span className=\"text-xs text-[#5E6C84] font-medium px-1.5 py-0.5 bg-white/60 rounded\">\n                            {columnTasks.length}\n                          </span>\n                        </div>\n                      </div>\n\n                {/* Tasks - Trello card style */}\n                <div \n                  className=\"space-y-2.5 pr-1\"\n                  draggable={false}\n                  onDragStart={(e) => e.preventDefault()}\n                  onDragOver={(e) => e.preventDefault()}\n                  onDrop={(e) => e.preventDefault()}\n                >\n                  {columnTasks.map((task, index) => (\n                    <div\n                      key={task.id}\n                      draggable={false}\n                      onDragStart={(e) => e.preventDefault()}\n                      onDragOver={(e) => e.preventDefault()}\n                      onDrop={(e) => e.preventDefault()}\n                      className={cn(\n                        \"relative group bg-white dark:bg-gray-800 rounded-lg p-2 flex flex-col\",\n                        \"shadow-sm hover:shadow-md border border-gray-200/40 dark:border-gray-700/40\",\n                        \"transition-all duration-150 ease-in-out cursor-pointer\",\n                        \"hover:border-gray-300 dark:hover:border-gray-600\",\n                        \"active:scale-[0.99]\"\n                      )}\n                      onClick={() => openTaskModal(task)}\n                    >\n                      {/* Title and Menu Row - Menu moved to top */}\n                      <div className=\"flex items-start justify-between gap-2 mb-2\">\n                        <h3 className=\"font-semibold text-[11px] sm:text-xs text-gray-900 dark:text-gray-100 leading-tight break-words flex-1\">\n                          {task.title}\n                        </h3>\n                        \n                        {/* Menu Icon - Moved to top right */}\n                        {(canEditTasks || task.createdBy === user?.id) && (\n                          <div className=\"opacity-100 flex-shrink-0\" onClick={(e) => e.stopPropagation()}>\n                            <DropdownMenu\n                              open={openDropdownMenuId === task.id}\n                              onOpenChange={(open) => {\n                                if (open) {\n                                  setOpenDropdownMenuId(task.id);\n                                } else {\n                                  setOpenDropdownMenuId(null);\n                                }\n                              }}\n                            >\n                              <DropdownMenuTrigger asChild onClick={(e) => e.stopPropagation()}>\n                                <button\n                                  type=\"button\"\n                                  className={cn(\n                                    \"inline-flex items-center justify-center h-5 w-5 rounded transition-colors duration-200 border border-transparent\",\n                                    openDropdownMenuId === task.id\n                                      ? \"border-border bg-muted/80\"\n                                      : \"hover:bg-muted/50 hover:border-border/50\"\n                                  )}\n                                >\n                                  <MoreVertical className=\"h-3 w-3 stroke-[2] text-gray-500 dark:text-gray-400\" />\n                                </button>\n                              </DropdownMenuTrigger>\n                              <DropdownMenuContent align=\"end\" onClick={(e) => e.stopPropagation()}>\n                                <DropdownMenuItem\n                                  onClick={(e) => {\n                                    e.stopPropagation();\n                                    setOpenDropdownMenuId(null);\n                                    openTaskModal(task);\n                                  }}\n                                  className=\"cursor-pointer rounded-md px-3 py-2.5 text-[11px] sm:text-xs font-medium transition-colors hover:bg-accent focus:bg-accent focus:text-accent-foreground\"\n                                >\n                                  <Edit className=\"h-4 w-4 mr-2.5 stroke-[2]\" />\n                                  Dzenle\n                                </DropdownMenuItem>\n                                {task.isInPool === true && task.createdBy === user?.id && (\n                                  <DropdownMenuItem\n                                    onClick={(e) => {\n                                      e.stopPropagation();\n                                      setOpenDropdownMenuId(null);\n                                      if (confirm(`\"${task.title}\" grevini havuzdan kaldrmak istediinize emin misiniz?`)) {\n                                        handleRemoveFromPool(task.id);\n                                      }\n                                    }}\n                                    className=\"cursor-pointer rounded-md px-3 py-2.5 text-[11px] sm:text-xs font-medium transition-colors hover:bg-accent focus:bg-accent focus:text-accent-foreground\"\n                                  >\n                                    <XCircle className=\"h-4 w-4 mr-2.5 stroke-[2]\" />\n                                    Havuzdan Kaldr\n                                  </DropdownMenuItem>\n                                )}\n                                <DropdownMenuItem\n                                  onClick={(e) => {\n                                    e.stopPropagation();\n                                    setOpenDropdownMenuId(null);\n                                    handleArchiveTask(task.id);\n                                  }}\n                                  className=\"cursor-pointer rounded-md px-3 py-2.5 text-[11px] sm:text-xs font-medium transition-colors hover:bg-accent focus:bg-accent focus:text-accent-foreground\"\n                                >\n                                  <Archive className=\"h-4 w-4 mr-2.5 stroke-[2]\" />\n                                  {(task as BoardTaskInput).isArchived || (task as BoardTaskInput).is_archived ? \"Arivden kar\" : \"Arivle\"}\n                                </DropdownMenuItem>\n                                {taskDeletePermissions[task.id] && (\n                                  <DropdownMenuItem\n                                    onClick={(e) => {\n                                      e.stopPropagation();\n                                      setOpenDropdownMenuId(null);\n                                      if (confirm(`\"${task.title}\" grevini silmek istediinize emin misiniz? Bu ilem geri alnamaz.`)) {\n                                        handleDeleteTask(task.id);\n                                      }\n                                    }}\n                                    className=\"cursor-pointer rounded-md px-3 py-2.5 text-[11px] sm:text-xs font-medium text-destructive focus:text-destructive hover:bg-destructive/10 focus:bg-destructive/10 transition-colors\"\n                                  >\n                                    <Trash2 className=\"h-4 w-4 mr-2.5 stroke-[2]\" />\n                                    Sil\n                                  </DropdownMenuItem>\n                                )}\n                              </DropdownMenuContent>\n                            </DropdownMenu>\n                          </div>\n                        )}\n                      </div>\n\n                      {/* Priority and Date Row */}\n                      <div className=\"flex items-center gap-1.5 mb-2 flex-wrap\">\n                        {/* ncelik Gstergesi */}\n                        {(() => {\n                          const taskPriority = task.priority || (task as BoardTaskInput).production_order_priority || 2;\n                          const priorityDisplay = getPriorityDisplay(taskPriority);\n                          const Icon = priorityDisplay.icon;\n                          return (\n                            <div className=\"flex items-center gap-1\">\n                              <Icon className={cn(\"h-3 w-3\", priorityDisplay.color)} />\n                              <span className={cn(\"text-[10px] font-medium\", priorityDisplay.color)}>\n                                {priorityDisplay.label}\n                              </span>\n                            </div>\n                          );\n                        })()}\n                        \n                        {/* Date Row - Only show if overdue */}\n                        {(() => {\n                          const dueDate = task.dueDate || (task as BoardTaskInput).due_date;\n                          if (!dueDate) return null;\n                          \n                          let date: Date | null = null;\n                          try {\n                            // Type guard for Timestamp\n                            const dueDateObj = dueDate as unknown;\n                            if (dueDateObj && typeof dueDateObj === 'object' && 'toDate' in dueDateObj) {\n                              date = (dueDateObj as Timestamp).toDate();\n                            } else if (typeof dueDate === 'string') {\n                              date = new Date(dueDate);\n                            }\n                          } catch {\n                            return null;\n                          }\n                          \n                          if (!date) return null;\n                          \n                          // Sadece gecikmi tarihleri gster\n                          if (isPast(date) && !isToday(date)) {\n                            return (\n                              <div className=\"flex items-center gap-1 px-2 py-1 rounded bg-[#EC9488] text-white text-[10px] font-medium\">\n                                <Clock className=\"h-3 w-3\" />\n                                <span>{format(date, \"d MMM yyyy\", { locale: tr })}</span>\n                              </div>\n                            );\n                          }\n                          \n                          return null;\n                        })()}\n                      </div>\n\n                                  {/* Assigned users or Request button - Bottom right */}\n                                  {(() => {\n                                    const isInPool = task.isInPool === true;\n                                    const poolRequests = task.poolRequests || [];\n                                    const hasUserRequest = user?.id && Array.isArray(poolRequests) && poolRequests.includes(user.id);\n                                    \n                                    // Atanan kullanclar taskAssignmentsMap ve allUsers'dan al\n                                    const assignments = taskAssignmentsMap[task.id] || [];\n                                    const assignedUserIds = assignments\n                                      .filter(a => a.status !== \"rejected\")\n                                      .map(a => a.assignedTo);\n                                    const assignedUsers = allUsers\n                                      .filter(u => assignedUserIds.includes(u.id))\n                                      .map(u => ({\n                                        id: u.id,\n                                        full_name: u.fullName || u.displayName || u.email || \"Kullanc\"\n                                      }));\n                                    \n                                    // Fallback: task.assignedUsers varsa onu kullan\n                                    const finalAssignedUsers = assignedUsers.length > 0 \n                                      ? assignedUsers \n                                      : (Array.isArray(task.assignedUsers) ? task.assignedUsers : []);\n                                    \n                                    const hasAssignedUsers = finalAssignedUsers.length > 0;\n                                    const canRequest = isInPool && user?.id && !hasUserRequest && !hasAssignedUsers;\n                                    \n                                    // Eer atanm kullanclar varsa, onlar gster\n                                    if (hasAssignedUsers) {\n                                      return (\n                                        <div className=\"flex items-center justify-end -space-x-1 mt-auto\">\n                                          {finalAssignedUsers.slice(0, 4).map((assignedUser) => (\n                                            <div\n                                              key={assignedUser.id}\n                                              className=\"w-5 h-5 rounded-full bg-gradient-to-br from-blue-500 to-indigo-600 text-white text-[9px] font-semibold flex items-center justify-center border border-white dark:border-gray-800 shadow-sm hover:shadow-md transition-shadow cursor-pointer\"\n                                              title={assignedUser.full_name}\n                                            >\n                                              {getInitials(assignedUser.full_name)}\n                                            </div>\n                                          ))}\n                                          {finalAssignedUsers.length > 4 && (\n                                            <div className=\"w-5 h-5 rounded-full bg-gray-400 text-white text-[9px] font-semibold flex items-center justify-center border border-white dark:border-gray-800 shadow-sm\" title={`+${finalAssignedUsers.length - 4} kii daha`}>\n                                              +{finalAssignedUsers.length - 4}\n                                            </div>\n                                          )}\n                                        </div>\n                                      );\n                                    }\n                                    \n                                    // Talep butonu veya talep gnderildi mesaj\n                                    if (canRequest) {\n                                      return (\n                                        <div className=\"flex justify-end mt-auto\">\n                                          <Button\n                                            size=\"sm\"\n                                            variant=\"outline\"\n                                            className=\"h-5 px-1.5 text-[9px] bg-blue-50 hover:bg-blue-100 text-blue-700 border-blue-200 whitespace-nowrap\"\n                                            onClick={(e) => {\n                                              e.stopPropagation();\n                                              handleRequestTaskFromPool(task.id);\n                                            }}\n                                          >\n                                            Talep Et\n                                          </Button>\n                                        </div>\n                                      );\n                                    }\n                                    \n                                    if (hasUserRequest && !hasAssignedUsers) {\n                                            return (\n                                        <div className=\"flex justify-end mt-auto\">\n                                          <span className=\"text-[9px] px-1.5 py-0.5 bg-primary/10 text-primary border border-primary/20 rounded whitespace-nowrap flex-shrink-0 inline-block\">\n                                            Talep Gnderildi\n                                          </span>\n                                              </div>\n                                            );\n                                          }\n                                    \n                                          return null;\n                                        })()}\n\n\n                                </div>\n                          ))}\n                </div>\n\n                {/* Add Card Button - Trello style (yiletirilmi) - Sadece yetkili kullanclar grebilir */}\n                {canCreate && showAddTask === column.id ? (\n                  <div className=\"mt-3 rounded-lg bg-white border-2 border-[#0079BF]/20 shadow-lg p-4 space-y-4 animate-in fade-in-0 slide-in-from-top-2 duration-200\">\n                          {/* Balk */}\n                          <div className=\"space-y-1.5\">\n                            <Label className=\"text-[11px] sm:text-xs font-semibold text-[#172B4D] flex items-center gap-1.5\">\n                              <Package className=\"h-3.5 w-3.5 text-[#0079BF]\" />\n                              Kart Bal <span className=\"text-destructive\">*</span>\n                            </Label>\n                            <Input\n                              placeholder=\"rn: Yeni zellik gelitir...\"\n                              value={newTaskTitle}\n                              onChange={(e) => setNewTaskTitle(e.target.value)}\n                              onKeyDown={(e) => {\n                                if (e.key === \"Escape\") {\n                                  setShowAddTask(null);\n                                  setNewTaskTitle(\"\");\n                                  setNewTaskDescription(\"\");\n                                  setNewTaskMembers([]);\n                                  setNewTaskChecklistItems([]);\n                                  setNewChecklistItemText(\"\");\n                                } else if (e.key === \"Enter\" && !e.shiftKey && newTaskTitle.trim()) {\n                                  e.preventDefault();\n                                  // Artk TaskInlineForm'u ayoruz\n                                  onTaskClick(\"new\");\n                                  setShowAddTask(null);\n                                }\n                              }}\n                              autoFocus\n                              disabled={saving}\n                              className=\"h-10 bg-white border-[#DFE1E6] text-[#172B4D] focus-visible:ring-2 focus-visible:ring-[#0079BF] focus-visible:border-[#0079BF] text-[11px] sm:text-xs font-medium placeholder:text-[#5E6C84]\"\n                            />\n                          </div>\n                          \n                          {/* Aklama */}\n                          <div className=\"space-y-1.5\">\n                            <Label className=\"text-[11px] sm:text-xs font-semibold text-[#172B4D] flex items-center gap-1.5\">\n                              <MessageSquare className=\"h-3.5 w-3.5 text-[#0079BF]\" />\n                              Aklama\n                            </Label>\n                            <Textarea\n                              placeholder=\"Kart hakknda detayl bilgi ekleyin...\"\n                              value={newTaskDescription}\n                              onChange={(e) => setNewTaskDescription(e.target.value)}\n                              rows={3}\n                              disabled={saving}\n                              className=\"bg-white border-[#DFE1E6] text-[#172B4D] focus-visible:ring-2 focus-visible:ring-[#0079BF] focus-visible:border-[#0079BF] resize-none text-[11px] sm:text-xs placeholder:text-[#5E6C84]\"\n                            />\n                          </div>\n                          \n                          {/* Checklist */}\n                          <div className=\"space-y-2\">\n                            <Label className=\"text-[11px] sm:text-xs font-semibold text-[#172B4D] flex items-center gap-1.5\">\n                              <CheckCircle2 className=\"h-3.5 w-3.5 text-[#0079BF]\" />\n                              Kontrol Listesi\n                            </Label>\n                            {newTaskChecklistItems.length > 0 && (\n                              <div className=\"space-y-1.5 bg-[#F4F5F7] rounded-md p-2.5 border border-[#DFE1E6]\">\n                                {newTaskChecklistItems.map((item, idx) => (\n                                  <div key={idx} className=\"flex items-center gap-2.5 text-[11px] sm:text-xs group\">\n                                    <input\n                                      type=\"checkbox\"\n                                      checked={item.completed}\n                                      onChange={(e) => {\n                                        const updated = [...newTaskChecklistItems];\n                                        updated[idx].completed = e.target.checked;\n                                        setNewTaskChecklistItems(updated);\n                                      }}\n                                      className=\"w-4 h-4 rounded border-[#DFE1E6] text-[#0079BF] focus:ring-2 focus:ring-[#0079BF] cursor-pointer\"\n                                    />\n                                    <span className={cn(\n                                      \"flex-1\",\n                                      item.completed ? \"line-through text-[#5E6C84]\" : \"text-[#172B4D]\"\n                                    )}>\n                                      {item.text}\n                                    </span>\n                                    <button\n                                      type=\"button\"\n                                      onClick={() => {\n                                        setNewTaskChecklistItems(newTaskChecklistItems.filter((_, i) => i !== idx));\n                                      }}\n                                      className=\"opacity-0 group-hover:opacity-100 text-[#5E6C84] hover:text-[#EB5A46] transition-opacity p-1 rounded hover:bg-[#EB5A46]/10\"\n                                    >\n                                      <X className=\"h-3.5 w-3.5\" />\n                                    </button>\n                                  </div>\n                                ))}\n                              </div>\n                            )}\n                            <div className=\"flex gap-2\">\n                              <Input\n                                placeholder=\"Yeni madde ekle...\"\n                                value={newChecklistItemText}\n                                onChange={(e) => setNewChecklistItemText(e.target.value)}\n                                onKeyDown={(e) => {\n                                  if (e.key === \"Enter\" && newChecklistItemText.trim()) {\n                                    e.preventDefault();\n                                    setNewTaskChecklistItems([\n                                      ...newTaskChecklistItems,\n                                      { text: newChecklistItemText.trim(), completed: false },\n                                    ]);\n                                    setNewChecklistItemText(\"\");\n                                  }\n                                }}\n                                disabled={saving}\n                                className=\"flex-1 h-9 text-xs border-[#DFE1E6] focus-visible:ring-2 focus-visible:ring-[#0079BF]\"\n                              />\n                              <Button\n                                type=\"button\"\n                                size=\"sm\"\n                                onClick={() => {\n                                  if (newChecklistItemText.trim()) {\n                                    setNewTaskChecklistItems([\n                                      ...newTaskChecklistItems,\n                                      { text: newChecklistItemText.trim(), completed: false },\n                                    ]);\n                                    setNewChecklistItemText(\"\");\n                                  }\n                                }}\n                                disabled={saving || !newChecklistItemText.trim()}\n                                className=\"h-9 px-3 text-xs bg-[#0079BF] hover:bg-[#005A8B] text-white\"\n                              >\n                                <Plus className=\"h-3.5 w-3.5\" />\n                              </Button>\n                            </div>\n                          </div>\n                          \n                          {/* Kii Ata */}\n                          <div className=\"space-y-2\">\n                            <Label className=\"text-[11px] sm:text-xs font-semibold text-[#172B4D] flex items-center gap-1.5\">\n                              <User className=\"h-3.5 w-3.5 text-[#0079BF]\" />\n                              Kii Ata\n                            </Label>\n                            <div className=\"border border-[#DFE1E6] rounded-md p-2 bg-white\">\n                              <UserMultiSelect\n                                selectedUsers={newTaskMembers}\n                                onSelectionChange={setNewTaskMembers}\n                              />\n                            </div>\n                          </div>\n                          \n                          {/* Butonlar */}\n                          <div className=\"flex items-center gap-2 pt-2 border-t border-[#DFE1E6]\">\n                            <Button\n                              size=\"sm\"\n                              onClick={() => {\n                                // Artk TaskInlineForm'u ayoruz\n                                onTaskClick(\"new\");\n                                setShowAddTask(null);\n                              }}\n                              className=\"bg-[#0079BF] hover:bg-[#005A8B] text-white flex-1 font-semibold shadow-md hover:shadow-lg transition-all h-9\"\n                            >\n                              <CheckCircle2 className=\"h-4 w-4 mr-1.5\" />\n                              Kart Ekle\n                            </Button>\n                            <Button\n                              size=\"sm\"\n                              variant=\"ghost\"\n                              onClick={() => {\n                                setShowAddTask(null);\n                                setNewTaskTitle(\"\");\n                                setNewTaskDescription(\"\");\n                                setNewTaskMembers([]);\n                                setNewTaskChecklistItems([]);\n                                setNewChecklistItemText(\"\");\n                              }}\n                              className=\"text-[#5E6C84] hover:text-[#172B4D] hover:bg-[#F4F5F7] h-9 w-9 p-0\"\n                            >\n                              <X className=\"h-4 w-4\" />\n                            </Button>\n                          </div>\n                        </div>\n                      ) : canCreate ? (\n                        <button\n                          onClick={() => {\n                            onTaskClick(\"new\", column.id);\n                          }}\n                          className=\"w-full mt-2 text-left text-[11px] sm:text-xs text-[#5E6C84] hover:text-[#172B4D] hover:bg-white/80 py-2.5 px-3 rounded-md transition-all flex items-center gap-2 font-medium group border border-transparent hover:border-[#DFE1E6] shadow-sm hover:shadow-md\"\n                        >\n                          <div className=\"p-1 rounded bg-[#0079BF]/10 group-hover:bg-[#0079BF]/20 transition-colors\">\n                            <Plus className=\"h-4 w-4 text-[#0079BF] group-hover:text-[#005A8B]\" />\n                          </div>\n                          <span className=\"group-hover:font-semibold transition-all\">Kart ekle</span>\n                        </button>\n                      ) : null}\n              </div>\n            );\n          })}\n        </div>\n      </div>\n\n      {/* Liste ekleme zellii kaldrld - sabit 4 kolon kullanlyor */}\n\n      {/* Task Edit Modal kaldrld - TaskInlineForm kullanlyor */}\n    </div>\n  );\n};\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\components\\Tasks\\TaskInlineForm.tsx","messages":[{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useState\" is called conditionally. React Hooks must be called in the exact same order in every component render.","line":159,"column":29,"nodeType":"Identifier","endLine":159,"endColumn":37},{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useState\" is called conditionally. React Hooks must be called in the exact same order in every component render.","line":160,"column":41,"nodeType":"Identifier","endLine":160,"endColumn":49},{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useState\" is called conditionally. React Hooks must be called in the exact same order in every component render.","line":161,"column":33,"nodeType":"Identifier","endLine":161,"endColumn":41},{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useState\" is called conditionally. React Hooks must be called in the exact same order in every component render.","line":162,"column":35,"nodeType":"Identifier","endLine":162,"endColumn":43},{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useState\" is called conditionally. React Hooks must be called in the exact same order in every component render.","line":163,"column":49,"nodeType":"Identifier","endLine":163,"endColumn":57},{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useState\" is called conditionally. React Hooks must be called in the exact same order in every component render.","line":164,"column":47,"nodeType":"Identifier","endLine":164,"endColumn":55},{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useState\" is called conditionally. React Hooks must be called in the exact same order in every component render.","line":165,"column":51,"nodeType":"Identifier","endLine":165,"endColumn":59},{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useState\" is called conditionally. React Hooks must be called in the exact same order in every component render.","line":166,"column":41,"nodeType":"Identifier","endLine":166,"endColumn":49},{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useState\" is called conditionally. React Hooks must be called in the exact same order in every component render.","line":167,"column":37,"nodeType":"Identifier","endLine":167,"endColumn":45},{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useState\" is called conditionally. React Hooks must be called in the exact same order in every component render.","line":168,"column":33,"nodeType":"Identifier","endLine":168,"endColumn":41},{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useState\" is called conditionally. React Hooks must be called in the exact same order in every component render.","line":169,"column":33,"nodeType":"Identifier","endLine":169,"endColumn":41},{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useState\" is called conditionally. React Hooks must be called in the exact same order in every component render.","line":170,"column":31,"nodeType":"Identifier","endLine":170,"endColumn":39},{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useState\" is called conditionally. React Hooks must be called in the exact same order in every component render.","line":171,"column":53,"nodeType":"Identifier","endLine":171,"endColumn":61},{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useState\" is called conditionally. React Hooks must be called in the exact same order in every component render.","line":172,"column":57,"nodeType":"Identifier","endLine":172,"endColumn":65},{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useState\" is called conditionally. React Hooks must be called in the exact same order in every component render.","line":173,"column":43,"nodeType":"Identifier","endLine":173,"endColumn":51},{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useState\" is called conditionally. React Hooks must be called in the exact same order in every component render.","line":174,"column":37,"nodeType":"Identifier","endLine":174,"endColumn":45},{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useState\" is called conditionally. React Hooks must be called in the exact same order in every component render.","line":175,"column":45,"nodeType":"Identifier","endLine":175,"endColumn":53},{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useState\" is called conditionally. React Hooks must be called in the exact same order in every component render.","line":176,"column":47,"nodeType":"Identifier","endLine":176,"endColumn":55},{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useState\" is called conditionally. React Hooks must be called in the exact same order in every component render.","line":177,"column":57,"nodeType":"Identifier","endLine":177,"endColumn":65},{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useState\" is called conditionally. React Hooks must be called in the exact same order in every component render.","line":178,"column":45,"nodeType":"Identifier","endLine":178,"endColumn":53},{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useState\" is called conditionally. React Hooks must be called in the exact same order in every component render.","line":179,"column":53,"nodeType":"Identifier","endLine":179,"endColumn":61},{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useState\" is called conditionally. React Hooks must be called in the exact same order in every component render. Did you accidentally call a React Hook after an early return?","line":180,"column":35,"nodeType":"Identifier","endLine":180,"endColumn":43},{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useState\" is called conditionally. React Hooks must be called in the exact same order in every component render. Did you accidentally call a React Hook after an early return?","line":181,"column":37,"nodeType":"Identifier","endLine":181,"endColumn":45},{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useState\" is called conditionally. React Hooks must be called in the exact same order in every component render. Did you accidentally call a React Hook after an early return?","line":182,"column":51,"nodeType":"Identifier","endLine":182,"endColumn":59},{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useState\" is called conditionally. React Hooks must be called in the exact same order in every component render. Did you accidentally call a React Hook after an early return?","line":183,"column":39,"nodeType":"Identifier","endLine":183,"endColumn":47},{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useState\" is called conditionally. React Hooks must be called in the exact same order in every component render. Did you accidentally call a React Hook after an early return?","line":184,"column":47,"nodeType":"Identifier","endLine":184,"endColumn":55},{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useRef\" is called conditionally. React Hooks must be called in the exact same order in every component render. Did you accidentally call a React Hook after an early return?","line":185,"column":24,"nodeType":"Identifier","endLine":185,"endColumn":30},{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useMemo\" is called conditionally. React Hooks must be called in the exact same order in every component render. Did you accidentally call a React Hook after an early return?","line":187,"column":21,"nodeType":"Identifier","endLine":187,"endColumn":28},{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useMemo\" is called conditionally. React Hooks must be called in the exact same order in every component render. Did you accidentally call a React Hook after an early return?","line":192,"column":24,"nodeType":"Identifier","endLine":192,"endColumn":31},{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useEffect\" is called conditionally. React Hooks must be called in the exact same order in every component render. Did you accidentally call a React Hook after an early return?","line":237,"column":3,"nodeType":"Identifier","endLine":237,"endColumn":12},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'checkPermissions'. Either include it or remove the dependency array.","line":239,"column":6,"nodeType":"ArrayExpression","endLine":239,"endColumn":26,"suggestions":[{"desc":"Update the dependencies array to be: [user, isSuperAdmin, checkPermissions]","fix":{"range":[8534,8554],"text":"[user, isSuperAdmin, checkPermissions]"}}]},{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useEffect\" is called conditionally. React Hooks must be called in the exact same order in every component render. Did you accidentally call a React Hook after an early return?","line":242,"column":3,"nodeType":"Identifier","endLine":242,"endColumn":12},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'checkPermissions'. Either include it or remove the dependency array.","line":249,"column":6,"nodeType":"ArrayExpression","endLine":249,"endColumn":26,"suggestions":[{"desc":"Update the dependencies array to be: [user, isSuperAdmin, checkPermissions]","fix":{"range":[8822,8842],"text":"[user, isSuperAdmin, checkPermissions]"}}]},{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useNavigate\" is called conditionally. React Hooks must be called in the exact same order in every component render. Did you accidentally call a React Hook after an early return?","line":252,"column":20,"nodeType":"Identifier","endLine":252,"endColumn":31},{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useEffect\" is called conditionally. React Hooks must be called in the exact same order in every component render. Did you accidentally call a React Hook after an early return?","line":341,"column":3,"nodeType":"Identifier","endLine":341,"endColumn":12},{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useCallback\" is called conditionally. React Hooks must be called in the exact same order in every component render. Did you accidentally call a React Hook after an early return?","line":352,"column":24,"nodeType":"Identifier","endLine":352,"endColumn":35},{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useEffect\" is called conditionally. React Hooks must be called in the exact same order in every component render. Did you accidentally call a React Hook after an early return?","line":513,"column":3,"nodeType":"Identifier","endLine":513,"endColumn":12},{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useEffect\" is called conditionally. React Hooks must be called in the exact same order in every component render. Did you accidentally call a React Hook after an early return?","line":518,"column":3,"nodeType":"Identifier","endLine":518,"endColumn":12},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'loadProjects' and 'projects'. Either include them or remove the dependency array.","line":526,"column":6,"nodeType":"ArrayExpression","endLine":526,"endColumn":25,"suggestions":[{"desc":"Update the dependencies array to be: [loadProjects, projects, selectedProjectId]","fix":{"range":[20011,20030],"text":"[loadProjects, projects, selectedProjectId]"}}]},{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useEffect\" is called conditionally. React Hooks must be called in the exact same order in every component render. Did you accidentally call a React Hook after an early return?","line":529,"column":3,"nodeType":"Identifier","endLine":529,"endColumn":12}],"suppressedMessages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'loadTask' and 'resetState'. Either include them or remove the dependency array.","line":349,"column":6,"nodeType":"ArrayExpression","endLine":349,"endColumn":22,"suggestions":[{"desc":"Update the dependencies array to be: [isEdit, loadTask, resetState, taskId]","fix":{"range":[12019,12035],"text":"[isEdit, loadTask, resetState, taskId]"}}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":37,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { uploadTaskAttachment } from \"@/services/firebase/storageService\";\nimport { useEffect, useMemo, useState, useRef, useCallback } from \"react\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Button } from \"@/components/ui/button\";\nimport { Label } from \"@/components/ui/label\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\nimport { UserMultiSelect } from \"@/components/Tasks/UserMultiSelect\";\nimport { canCreateTask, canCreateProject, canUpdateResource, isMainAdmin, canAddChecklist } from \"@/utils/permissions\";\nimport { getDepartments } from \"@/services/firebase/departmentService\";\nimport { onPermissionCacheChange } from \"@/services/firebase/rolePermissionsService\";\nimport { UserProfile } from \"@/services/firebase/authService\";\nimport { Project } from \"@/services/firebase/projectService\";\nimport {\n  addChecklistItem,\n  addTaskAttachment,\n  assignTask,\n  createChecklist,\n  createTask,\n  deleteChecklistItem,\n  deleteTaskAssignment,\n  deleteTaskAttachment,\n  getChecklists,\n  getTaskAssignments,\n  getTaskAttachments,\n  approveTask,\n  rejectTaskApproval,\n  getTaskById,\n  TaskAssignment,\n  updateChecklistItem,\n  updateTask,\n  updateTaskStatus,\n} from \"@/services/firebase/taskService\";\nimport { useAuth } from \"@/contexts/AuthContext\";\nimport { toast } from \"sonner\";\nimport { cn } from \"@/lib/utils\";\nimport { Timestamp } from \"firebase/firestore\";\nimport { Loader2, Plus, Link as LinkIcon, ListChecks, X, Check, Paperclip, Lock, CircleDot, Clock, CheckCircle2 } from \"lucide-react\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { useNavigate } from \"react-router-dom\";\nimport { PRIORITY_OPTIONS, PriorityLevel, convertOldPriorityToNew, convertNewPriorityToOld } from \"@/utils/priority\";\n\ntype TaskInlineFormMode = \"create\" | \"edit\";\n\ninterface TaskInlineFormProps {\n  mode: TaskInlineFormMode;\n  projectId?: string | null;\n  taskId?: string | null;\n  defaultStatus?: \"pending\" | \"in_progress\" | \"completed\";\n  onCancel: () => void;\n  onSuccess?: (taskId?: string) => void;\n  className?: string;\n  isInPool?: boolean;\n  showOnlyInMyTasks?: boolean; // \"Sadece Benim Grevlerim sayfasnda gster\" seeneini gster\n}\n\ninterface ChecklistItemState {\n  id: string;\n  text: string;\n  completed?: boolean;\n}\n\ninterface AttachmentState {\n  id: string;\n  label: string;\n  url: string;\n  type: \"drive_link\" | \"file\";\n  attachmentId?: string;\n  storageProvider?: \"firebase\" | \"google_drive\";\n  driveFileId?: string;\n}\n\nconst formatDateInput = (value?: Timestamp | Date | string | null) => {\n  if (!value) return \"\";\n  if (value instanceof Timestamp) {\n    return value.toDate().toISOString().slice(0, 10);\n  }\n  if (value instanceof Date) {\n    return value.toISOString().slice(0, 10);\n  }\n  try {\n    return new Date(value).toISOString().slice(0, 10);\n  } catch {\n    return \"\";\n  }\n};\n\n\nexport const TaskInlineForm = ({\n  mode,\n  projectId,\n  taskId,\n  defaultStatus = \"pending\",\n  onCancel,\n  onSuccess,\n  className,\n  isInPool,\n  showOnlyInMyTasks = false,\n}: TaskInlineFormProps) => {\n  const isEdit = mode === \"edit\";\n  const { user } = useAuth();\n  const [canUpdate, setCanUpdate] = useState(false);\n  const [isSuperAdmin, setIsSuperAdmin] = useState(false);\n  \n  // Permission state'lerini Firestore'dan kontrol et\n  useEffect(() => {\n    const checkPermissions = async () => {\n      if (!user) {\n        setCanUpdate(false);\n        setIsSuperAdmin(false);\n        return;\n      }\n      try {\n        const { canUpdateResource, isMainAdmin } = await import(\"@/utils/permissions\");\n        const userProfile: UserProfile = {\n          id: user.id,\n          email: user.email,\n          emailVerified: user.emailVerified,\n          fullName: user.fullName,\n          displayName: user.fullName,\n          phone: null,\n          dateOfBirth: null,\n          role: user.roles || [],\n          createdAt: null,\n          updatedAt: null,\n        };\n        const [hasUpdatePermission, isMainAdminUser] = await Promise.all([\n          canUpdateResource(userProfile, \"tasks\"),\n          isMainAdmin(userProfile),\n        ]);\n        setCanUpdate(hasUpdatePermission);\n        setIsSuperAdmin(isMainAdminUser);\n      } catch (error: unknown) {\n        setCanUpdate(false);\n        setIsSuperAdmin(false);\n      }\n    };\n    checkPermissions();\n  }, [user]);\n  \n  // Grev oluturma modunda personnel/izleyici iin eriim yok\n  const isPersonnelOrViewer = useMemo(() => {\n    if (!user?.roles) return false;\n    return user.roles.includes(\"personnel\") || user.roles.includes(\"viewer\");\n  }, [user?.roles]);\n  \n  if (!isEdit && isPersonnelOrViewer) {\n    return (\n      <Card className={className}>\n        <Card className=\"p-4 border-destructive/50 bg-destructive/5\">\n          <p className=\"text-[11px] sm:text-xs text-destructive font-medium\">\n            Grev oluturma yetkiniz yok. Sadece ynetici veya ekip lideri grev oluturabilir.\n          </p>\n        </Card>\n      </Card>\n    );\n  }\n  const [title, setTitle] = useState(\"\");\n  const [description, setDescription] = useState(\"\");\n  const [dueDate, setDueDate] = useState(\"\");\n  const [priority, setPriority] = useState<PriorityLevel>(1); // Default: Normal (1)\n  const [selectedMembers, setSelectedMembers] = useState<string[]>([]);\n  const [checklistItems, setChecklistItems] = useState<ChecklistItemState[]>([]);\n  const [newChecklistText, setNewChecklistText] = useState(\"\");\n  const [attachments, setAttachments] = useState<AttachmentState[]>([]);\n  const [linkLabel, setLinkLabel] = useState(\"\");\n  const [linkUrl, setLinkUrl] = useState(\"\");\n  const [loading, setLoading] = useState(isEdit);\n  const [saving, setSaving] = useState(false);\n  const [activeChecklistId, setActiveChecklistId] = useState<string | null>(null);\n  const [existingAssignments, setExistingAssignments] = useState<TaskAssignment[]>([]);\n  const [isTaskInPool, setIsTaskInPool] = useState(isInPool || false);\n  const [isPrivate, setIsPrivate] = useState(false);\n  const [onlyInMyTasks, setOnlyInMyTasks] = useState(false);\n  const [approvalStatus, setApprovalStatus] = useState<\"pending\" | \"approved\" | \"rejected\" | undefined>(undefined);\n  const [approvalRequestedBy, setApprovalRequestedBy] = useState<string | undefined>(undefined);\n  const [taskCreatorId, setTaskCreatorId] = useState<string | undefined>(undefined);\n  const [selectedProjectId, setSelectedProjectId] = useState<string | null>(projectId || null);\n  const [projects, setProjects] = useState<Project[]>([]);\n  const [canCreate, setCanCreate] = useState(false);\n  const [canSelectProject, setCanSelectProject] = useState(false);\n  const [taskStatus, setTaskStatus] = useState<\"pending\" | \"in_progress\" | \"completed\">(\"pending\");\n  const [updatingStatus, setUpdatingStatus] = useState(false);\n  const fileInputRef = useRef<HTMLInputElement>(null);\n\n  const formTitle = useMemo(\n    () => (isEdit ? \"Grevi Dzenle\" : \"Yeni Grev\"),\n    [isEdit]\n  );\n\n  const formSubTitle = useMemo(\n    () =>\n      isEdit\n        ? \"Balk, aklama, ekip ve ekleri ayn mini formdan dzenleyin.\"\n        : \"Minimal form ile grevi hzla ekleyin, dosya ve checklist ekleyin.\",\n    [isEdit]\n  );\n\n  const checkPermissions = async () => {\n    if (!user) {\n      setCanCreate(false);\n      setCanSelectProject(false);\n      return;\n    }\n    try {\n      const departments = await getDepartments();\n      const userProfile: UserProfile = {\n        id: user.id,\n        email: user.email,\n        emailVerified: user.emailVerified,\n        fullName: user.fullName,\n        displayName: user.fullName,\n        phone: user.phone,\n        dateOfBirth: user.dateOfBirth,\n        role: user.roles,\n        createdAt: null,\n        updatedAt: null,\n      };\n      const [hasTaskPermission, hasProjectPermission] = await Promise.all([\n        canCreateTask(userProfile, departments),\n        canCreateProject(userProfile, departments),\n      ]);\n      setCanCreate(hasTaskPermission);\n      const [hasUpdatePermission, isMainAdminUser] = await Promise.all([\n        canUpdateResource(userProfile, \"tasks\"),\n        isMainAdmin(userProfile),\n      ]);\n      setCanSelectProject(hasTaskPermission || hasProjectPermission || hasUpdatePermission || isMainAdminUser);\n    } catch (error) {\n      setCanCreate(false);\n      setCanSelectProject(false);\n    }\n  };\n\n  // Yetki kontrolleri\n  useEffect(() => {\n    checkPermissions();\n  }, [user, isSuperAdmin]);\n\n  // Listen to permission changes in real-time\n  useEffect(() => {\n    if (!user) return;\n    const unsubscribe = onPermissionCacheChange(() => {\n      // Re-check permissions when they change\n      checkPermissions();\n    });\n    return () => unsubscribe();\n  }, [user, isSuperAdmin]);\n\n  const isRestrictedUser = isEdit && !isSuperAdmin && !canUpdate && user?.id !== taskCreatorId;\n  const navigate = useNavigate();\n\n  const resetState = () => {\n    setTitle(\"\");\n    setDescription(\"\");\n    setDueDate(\"\");\n    setPriority(1); // Default: Normal (1)\n    setSelectedMembers([]);\n    setChecklistItems([]);\n    setNewChecklistText(\"\");\n    setAttachments([]);\n    setLinkLabel(\"\");\n    setLinkUrl(\"\");\n    setActiveChecklistId(null);\n    setExistingAssignments([]);\n    setIsTaskInPool(isInPool || false);\n    setIsPrivate(false);\n    setSelectedProjectId(projectId || null);\n  };\n\n  const loadTask = async (id: string) => {\n    setLoading(true);\n    try {\n      const [task, assignments, checklists, taskAttachments] = await Promise.all([\n        getTaskById(id),\n        getTaskAssignments(id),\n        getChecklists(id),\n        getTaskAttachments(id),\n      ]);\n\n      if (!task) {\n        toast.error(\"Grev bulunamad\");\n        onCancel();\n        return;\n      }\n\n      setTitle(task.title);\n      setDescription(task.description || \"\");\n      setDueDate(formatDateInput(task.dueDate));\n      // Eski sistem (1-5) varsa yeni sisteme (0-5) evir\n      const oldPriority = task.priority || 2;\n      setPriority(convertOldPriorityToNew(oldPriority));\n      setApprovalStatus(task.approvalStatus);\n      setApprovalRequestedBy(task.approvalRequestedBy);\n      setTaskCreatorId(task.createdBy);\n      setSelectedProjectId(task.projectId || null);\n      setIsPrivate(task.isPrivate || false);\n      // Status' normalize et (column_ prefix'ini kaldr)\n      const normalizedStatus = task.status?.startsWith(\"column_\") \n        ? \"pending\" \n        : (task.status as \"pending\" | \"in_progress\" | \"completed\" || \"pending\");\n      setTaskStatus(normalizedStatus);\n      \n      const activeAssignments = assignments.filter((a) => a.status !== \"rejected\");\n      setSelectedMembers(activeAssignments.map((a) => a.assignedTo));\n      setExistingAssignments(assignments);\n\n      if (checklists.length > 0) {\n        const primaryChecklist = checklists[0];\n        setActiveChecklistId(primaryChecklist.id);\n        setChecklistItems(\n          primaryChecklist.items.map((item) => ({\n            id: item.id,\n            text: item.text,\n            completed: item.completed,\n          }))\n        );\n      } else {\n        setChecklistItems([]);\n        setActiveChecklistId(null);\n      }\n\n      setAttachments(\n        taskAttachments.map((attachment) => ({\n          id: attachment.id,\n          attachmentId: attachment.id,\n          label: attachment.name,\n          url: attachment.driveLink || attachment.url,\n          type: (attachment.attachmentType === \"file\" || attachment.type === \"file\") ? \"file\" : \"drive_link\",\n        }))\n      );\n    } catch (error: unknown) {\n      const errorMessage = error instanceof Error ? error.message : \"Grev verileri yklenemedi\";\n      toast.error(errorMessage);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  useEffect(() => {\n    if (isEdit && taskId) {\n      loadTask(taskId);\n    } else {\n      resetState();\n      setLoading(false);\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [isEdit, taskId]);\n\n  // Projeleri ykle fonksiyonu\n  const loadProjects = useCallback(async () => {\n      try {\n        const { getProjects, getProjectById } = await import(\"@/services/firebase/projectService\");\n        \n        // Dzenleme modunda tm projeleri gster, yeni grev olutururken ve projectId varsa sadece o projeyi gster\n        if (projectId && !isEdit) {\n          try {\n            const currentProject = await getProjectById(projectId);\n            // Proje bulunamadysa bo liste gster\n            if (!currentProject) {\n              setProjects([]);\n              return;\n            }\n            // Gizli proje kontrol: Eer gizli projeyse ve kullanc yetkili deilse, bo liste gster\n            // Ekip lideri sadece kendi oluturduu gizli projeleri grebilir\n            if (currentProject.isPrivate) {\n              if (isSuperAdmin) {\n                setProjects([currentProject]);\n                return;\n              }\n              if (user?.id && currentProject.createdBy === user.id) {\n                setProjects([currentProject]);\n                return;\n              }\n              // Ekip lideri iin projede grevi olan kullanclar kontrol yaplmaz (sadece kendi oluturduu gizli projeleri grebilir)\n              // Team Leader kontrol - Firestore'dan (canUpdate projects)\n              if (canUpdate && !isSuperAdmin) {\n                // Ekip lideri sadece kendi oluturduu gizli projeleri grebilir (yukarda kontrol edildi)\n                setProjects([]);\n                return;\n              }\n              // Projede grevi olan kullanclar grebilir (ekip lideri hari)\n              if (user?.id) {\n                try {\n                  const { getTasks, getTaskAssignments } = await import(\"@/services/firebase/taskService\");\n                  const projectTasks = await getTasks({ projectId: projectId });\n                  \n                  for (const task of projectTasks) {\n                    if (task.createdBy === user.id) {\n                      setProjects([currentProject]);\n                      return;\n                    }\n                    if (task.assignedUsers && task.assignedUsers.includes(user.id)) {\n                      setProjects([currentProject]);\n                      return;\n                    }\n                    const assignments = await getTaskAssignments(task.id);\n                    const isAssigned = assignments.some(\n                      (a) => a.assignedTo === user.id && (a.status === \"accepted\" || a.status === \"pending\")\n                    );\n                    if (isAssigned) {\n                      setProjects([currentProject]);\n                      return;\n                    }\n                  }\n                } catch (error: unknown) {\n                  // Hata durumunda sessizce devam et\n                }\n              }\n              // Yetkisiz kullanc - bo liste\n              setProjects([]);\n              return;\n            } else {\n              // Gizli olmayan proje - gster\n              setProjects([currentProject]);\n              return;\n            }\n          } catch (error: unknown) {\n            setProjects([]);\n            return;\n          }\n        }\n        \n        // Normal durum: Tm grnr projeleri ykle\n        const allProjects = await getProjects({ status: \"active\" });\n\n        // Eer bir gizli projeye grev ekleniyorsa (projectId prop'u ile ve yeni grev olutururken), sadece o proje gsterilmeli\n        // Dier gizli projeler gsterilmemeli\n        if (projectId && !isEdit) {\n          const currentProject = allProjects.find(p => p.id === projectId);\n          if (currentProject?.isPrivate) {\n            // Gizli projeye grev ekleniyorsa, sadece o proje gsterilmeli\n            // Yukardaki kontrol zaten yapld, buraya gelmemeli ama yine de kontrol edelim\n            setProjects([currentProject]);\n            return;\n          }\n        }\n\n        // Gizli projeleri filtrele: Sadece ynetici, oluturan ve projede grevi olanlar grebilir\n        // NEML: Eer bir gizli projeye grev ekleniyorsa (ve yeni grev olutururken), dier gizli projeler gsterilmemeli\n        const visibleProjects = await Promise.all(\n          allProjects.map(async (project) => {\n            // Eer bir gizli projeye grev ekleniyorsa (ve yeni grev olutururken), dier gizli projeler gsterilmemeli\n            if (projectId && !isEdit) {\n              const currentProject = allProjects.find(p => p.id === projectId);\n              if (currentProject?.isPrivate && project.isPrivate && project.id !== projectId) {\n                // Baka bir gizli proje, gsterilmemeli\n                return null;\n              }\n            }\n            \n            if (!project.isPrivate) return project; // Gizli olmayan projeler herkes grebilir\n            \n            // Gizli projeler iin yetki kontrol\n            if (isSuperAdmin) return project; // Super Admin tm projeleri grebilir\n            if (user?.id && project.createdBy === user.id) return project; // Oluturan grebilir\n            \n            // Ekip lideri iin projede grevi olan kullanclar kontrol yaplmaz (sadece kendi oluturduu gizli projeleri grebilir)\n            // Team Leader kontrol - Firestore'dan (canUpdate projects)\n            if (canUpdate && !isSuperAdmin) {\n              return null; // Ekip lideri sadece kendi oluturduu gizli projeleri grebilir (yukarda kontrol edildi)\n            }\n            \n            // Projede grevi olan kullanclar grebilir (ekip lideri hari)\n            if (user?.id) {\n              try {\n                // Projedeki grevleri kontrol etmeden nce, kullancnn bu projeye atanm olup olmadn kontrol et\n                // (Eer proje yeleri zellii varsa)\n                \n                const { getTasks, getTaskAssignments } = await import(\"@/services/firebase/taskService\");\n                const projectTasks = await getTasks({ projectId: project.id });\n                \n                // Kullancnn bu projede grevi var m kontrol et\n                for (const task of projectTasks) {\n                  // Grevi oluturan kii\n                  if (task.createdBy === user.id) return project;\n                  \n                  // Atanan kullanclar\n                  if (task.assignedUsers && task.assignedUsers.includes(user.id)) return project;\n                  \n                  // Assignments kontrol\n                  const assignments = await getTaskAssignments(task.id);\n                  const isAssigned = assignments.some(\n                    (a) => a.assignedTo === user.id && (a.status === \"accepted\" || a.status === \"pending\")\n                  );\n                  if (isAssigned) return project;\n                }\n              } catch (error) {\n                // Hata durumunda sessizce devam et\n              }\n            }\n            \n            return null; // Dier kullanclar gizli projeleri gremez\n          })\n        );\n\n        // Null deerleri filtrele ve ayn projeyi tekrarlamamak iin filtrele (Genel Grevler artk gsterilecek)\n        const uniqueProjects = Array.from(\n          new Map(\n            visibleProjects\n              .filter((project) => project !== null && project !== undefined && project.id)\n              .map((project) => [project.id, project])\n          ).values()\n        );\n\n        setProjects(uniqueProjects);\n      } catch (error: unknown) {\n        // Hata durumunda sessizce devam et\n      }\n  }, [isEdit, isSuperAdmin, canUpdate, user, projectId]);\n  \n  useEffect(() => {\n    loadProjects();\n  }, [loadProjects]);\n  \n  // selectedProjectId deitiinde projeleri yeniden ykle (gizli proje seildiyse)\n  useEffect(() => {\n    if (selectedProjectId) {\n      const selectedProject = projects.find(p => p.id === selectedProjectId);\n      if (selectedProject?.isPrivate) {\n        // Gizli proje seildiyse, sadece gizli projeleri gster\n        loadProjects();\n      }\n    }\n  }, [selectedProjectId]);\n\n  // Proje seildiinde veya projectId prop'u geldiinde, eer proje gizli ise isPrivate' otomatik true yap\n  useEffect(() => {\n    if (!isEdit && projects.length > 0) {\n      const currentProjectId = selectedProjectId || projectId;\n      if (currentProjectId) {\n        const currentProject = projects.find(p => p.id === currentProjectId);\n        if (currentProject?.isPrivate) {\n          setIsPrivate(true);\n        }\n      }\n    }\n  }, [selectedProjectId, projectId, projects, isEdit]);\n\n  const handleAddChecklistItem = async () => {\n    if (!newChecklistText.trim()) return;\n    \n    // Yetki kontrol: Dzenleme modunda sadece atanan kullanclar ve adminler checklist esi ekleyebilir\n    if (isEdit && taskId) {\n      const canInteract = isSuperAdmin || canUpdate || (user?.id && selectedMembers.includes(user.id));\n      if (!canInteract) {\n        const { showPermissionErrorToast } = await import(\"@/utils/toastHelpers\");\n        showPermissionErrorToast(\"interact\", \"checklist\");\n        return;\n      }\n    }\n    \n    const newItem = {\n      id: `${Date.now()}`,\n      text: newChecklistText.trim(),\n      completed: false,\n    };\n\n    if (isEdit && taskId && activeChecklistId) {\n      try {\n        await addChecklistItem(taskId, activeChecklistId, newItem.text);\n        await loadTask(taskId);\n        setNewChecklistText(\"\");\n        toast.success(\"Checklist maddesi eklendi\");\n        return;\n      } catch (error: unknown) {\n        const errorMessage = error instanceof Error ? error.message : \"Checklist maddesi eklenemedi\";\n        toast.error(errorMessage);\n        return;\n      }\n    }\n\n    setChecklistItems((prev) => [...prev, newItem]);\n    setNewChecklistText(\"\");\n  };\n\n  const handleToggleChecklistItem = async (id: string) => {\n    if (isEdit && taskId && activeChecklistId) {\n      const item = checklistItems.find((c) => c.id === id);\n      if (!item) return;\n      try {\n        await updateChecklistItem(taskId, activeChecklistId, id, !item.completed, user?.id);\n        setChecklistItems((prev) =>\n          prev.map((c) => (c.id === id ? { ...c, completed: !c.completed } : c))\n        );\n      } catch (error: unknown) {\n        const errorMessage = error instanceof Error ? error.message : \"Checklist gncellenemedi\";\n        toast.error(errorMessage);\n      }\n      return;\n    }\n\n    setChecklistItems((prev) =>\n      prev.map((item) => (item.id === id ? { ...item, completed: !item.completed } : item))\n    );\n  };\n\n  const handleRemoveChecklistItem = async (id: string) => {\n    // Yetki kontrol: Dzenleme modunda sadece atanan kullanclar ve adminler checklist esi silebilir\n    if (isEdit && taskId) {\n      const canInteract = isSuperAdmin || canUpdate || (user?.id && selectedMembers.includes(user.id));\n      if (!canInteract) {\n        const { showPermissionErrorToast } = await import(\"@/utils/toastHelpers\");\n        showPermissionErrorToast(\"delete\", \"checklist\");\n        return;\n      }\n    }\n    \n    if (isEdit && taskId && activeChecklistId) {\n      try {\n        await deleteChecklistItem(taskId, activeChecklistId, id);\n        setChecklistItems((prev) => prev.filter((item) => item.id !== id));\n        toast.success(\"Checklist maddesi silindi\");\n      } catch (error: unknown) {\n        const errorMessage = error instanceof Error ? error.message : \"Checklist maddesi silinemedi\";\n        toast.error(errorMessage);\n      }\n      return;\n    }\n\n    setChecklistItems((prev) => prev.filter((item) => item.id !== id));\n  };\n\n  const handleAddLink = async () => {\n    if (!linkUrl.trim()) return;\n\n    if (isEdit && taskId) {\n      if (!user?.id) {\n        toast.error(\"Kullanc oturumu bulunamad\");\n        return;\n      }\n      try {\n        const attachment = await addTaskAttachment(taskId, {\n          name: linkLabel.trim() || \"Dosya Linki\",\n          url: linkUrl.trim(),\n          type: \"drive_link\",\n          attachmentType: \"drive_link\",\n          driveLink: linkUrl.trim(),\n          size: 0,\n          uploadedBy: user.id,\n        });\n        setAttachments((prev) => [\n          ...prev,\n          {\n            id: attachment.id,\n            attachmentId: attachment.id,\n            label: attachment.name,\n            url: attachment.driveLink || attachment.url,\n            type: \"drive_link\",\n          },\n        ]);\n        setLinkLabel(\"\");\n        setLinkUrl(\"\");\n        toast.success(\"Link eklendi\");\n        return;\n      } catch (error: unknown) {\n        const errorMessage = error instanceof Error ? error.message : \"Link eklenemedi\";\n        toast.error(errorMessage);\n        return;\n      }\n    }\n\n    setAttachments((prev) => [\n      ...prev,\n      {\n        id: `${Date.now()}`,\n        label: linkLabel.trim() || \"Dosya Linki\",\n        url: linkUrl.trim(),\n        type: \"drive_link\",\n      },\n    ]);\n    setLinkLabel(\"\");\n    setLinkUrl(\"\");\n  };\n\n  const handleFileUpload = async (e: React.ChangeEvent<HTMLInputElement>) => {\n    const file = e.target.files?.[0];\n    if (!file) return;\n\n    if (!isEdit || !taskId) {\n      toast.info(\"Dosya yklemek iin nce grevi oluturmalsnz.\");\n      return;\n    }\n\n    if (!user?.id) {\n      toast.error(\"Kullanc oturumu bulunamad\");\n      return;\n    }\n\n    const toastId = toast.loading(\"Dosya ykleniyor...\");\n    try {\n      // 1. Upload to Storage\n      const uploadResult = await uploadTaskAttachment(file, taskId);\n      \n      // 2. Add metadata to Firestore\n      const attachment = await addTaskAttachment(taskId, {\n        name: file.name,\n        url: uploadResult.url,\n        type: file.type,\n        attachmentType: uploadResult.provider === \"google_drive\" ? \"drive_link\" : \"file\",\n        size: file.size,\n        storageProvider: uploadResult.provider,\n        driveLink: uploadResult.webViewLink || uploadResult.webContentLink || uploadResult.url,\n        driveFileId: uploadResult.fileId,\n        uploadedBy: user.id,\n      });\n\n      setAttachments((prev) => [\n        ...prev,\n        {\n          id: attachment.id,\n          attachmentId: attachment.id,\n          label: attachment.name,\n          url: attachment.url,\n          type: attachment.attachmentType === \"drive_link\" ? \"drive_link\" : \"file\",\n          storageProvider: attachment.storageProvider,\n          driveFileId: attachment.driveFileId,\n        },\n      ]);\n      \n      toast.success(\"Dosya baaryla yklendi\", { id: toastId });\n    } catch (error: unknown) {\n      const errorMessage = error instanceof Error ? error.message : \"Dosya yklenemedi\";\n      toast.error(errorMessage, { id: toastId });\n    } finally {\n      // Reset input\n      if (fileInputRef.current) {\n        fileInputRef.current.value = \"\";\n      }\n    }\n  };\n\n  const handleRemoveAttachment = async (id: string) => {\n    const attachment = attachments.find((a) => a.id === id);\n\n    if (isEdit && taskId && attachment?.attachmentId) {\n      try {\n        if (attachment.storageProvider === \"google_drive\" && attachment.driveFileId) {\n          const { deleteFile } = await import(\"@/services/firebase/storageService\");\n          await deleteFile(attachment.url, { provider: \"google_drive\", fileId: attachment.driveFileId });\n        } else if (attachment.type !== \"drive_link\") {\n          const { deleteFile } = await import(\"@/services/firebase/storageService\");\n          await deleteFile(attachment.url);\n        }\n        await deleteTaskAttachment(taskId, attachment.attachmentId);\n        setAttachments((prev) => prev.filter((item) => item.id !== id));\n        toast.success(\"Ek kaldrld\");\n      } catch (error: unknown) {\n        const errorMessage = error instanceof Error ? error.message : \"Ek kaldrlamad\";\n        toast.error(errorMessage);\n      }\n      return;\n    }\n\n    setAttachments((prev) => prev.filter((item) => item.id !== id));\n  };\n\n  const syncAssignments = async (id: string) => {\n    if (!user?.id) return;\n    const currentAssigned = existingAssignments\n      .filter((assignment) => assignment.status !== \"rejected\")\n      .map((assignment) => assignment.assignedTo);\n\n    const toAdd = selectedMembers.filter((memberId) => !currentAssigned.includes(memberId));\n    const toRemove = currentAssigned.filter((memberId) => !selectedMembers.includes(memberId));\n\n    if (toAdd.length === 0 && toRemove.length === 0) {\n      return;\n    }\n\n    // Atama ilemleri - permission hatalarn throw et\n    try {\n      const assignErrors: Error[] = [];\n      await Promise.all(\n        toAdd.map(async (memberId) => {\n          try {\n            await assignTask(id, memberId, user.id);\n          } catch (error) {\n            const errorMessage = error instanceof Error ? error.message : String(error);\n            // Permission hatas ise throw et\n            if (errorMessage.includes(\"permission\") || errorMessage.includes(\"Permission\") || errorMessage.includes(\"Missing or insufficient\")) {\n              assignErrors.push(new Error(`Grev yesi ekleme yetkisi yok: ${errorMessage}`));\n            } else {\n              // Email servisi hatas gibi dier hatalar sessizce devam eder\n              if (import.meta.env.DEV) {\n                console.debug(\"Grev atama hatas (email servisi almyor olabilir):\", memberId);\n              }\n            }\n          }\n        })\n      );\n      // Permission hatalar varsa throw et\n      if (assignErrors.length > 0) {\n        throw assignErrors[0];\n      }\n    } catch (error) {\n      // Permission hatas ise throw et\n      if (error instanceof Error && (error.message.includes(\"permission\") || error.message.includes(\"Permission\") || error.message.includes(\"Missing or insufficient\"))) {\n        throw error;\n      }\n      // Dier hatalar sessizce devam eder\n      if (import.meta.env.DEV) {\n        console.debug(\"Grev atamalar srasnda hata olutu (email servisi almyor olabilir)\");\n      }\n    }\n\n    // Kaldrma ilemleri - permission hatalarn throw et\n    try {\n      const deleteErrors: Error[] = [];\n      await Promise.all(\n        toRemove.map(async (memberId) => {\n          try {\n            const assignment = existingAssignments.find(\n              (a) => a.assignedTo === memberId && a.status !== \"rejected\"\n            );\n            if (assignment) {\n              await deleteTaskAssignment(id, assignment.id, user?.id);\n            }\n          } catch (error) {\n            const errorMessage = error instanceof Error ? error.message : String(error);\n            // Permission hatas ise throw et\n            if (errorMessage.includes(\"permission\") || errorMessage.includes(\"Permission\") || errorMessage.includes(\"Missing or insufficient\")) {\n              deleteErrors.push(new Error(`Grev yesi kaldrma yetkisi yok: ${errorMessage}`));\n            } else {\n              // Email servisi hatas gibi dier hatalar sessizce devam eder\n              if (import.meta.env.DEV) {\n                console.debug(\"Grev atamas kaldrma hatas (email servisi almyor olabilir):\", memberId);\n              }\n            }\n          }\n        })\n      );\n      // Permission hatalar varsa throw et\n      if (deleteErrors.length > 0) {\n        throw deleteErrors[0];\n      }\n    } catch (error) {\n      // Permission hatas ise throw et\n      if (error instanceof Error && (error.message.includes(\"permission\") || error.message.includes(\"Permission\") || error.message.includes(\"Missing or insufficient\"))) {\n        throw error;\n      }\n      // Dier hatalar sessizce devam eder\n      if (import.meta.env.DEV) {\n        console.debug(\"Grev atamas kaldrmalar srasnda hata olutu (email servisi almyor olabilir)\");\n      }\n    }\n  };\n\n  const handleApproveTask = async () => {\n    if (!taskId || !user?.id) return;\n    try {\n      await approveTask(taskId, user.id);\n      toast.success(\"Grev onayland ve tamamland\");\n      onSuccess?.(taskId);\n    } catch (error: unknown) {\n      const errorMessage = error instanceof Error ? error.message : \"Onaylama ilemi baarsz\";\n      toast.error(errorMessage);\n    }\n  };\n\n  const handleRejectTask = async () => {\n    if (!taskId || !user?.id) return;\n    try {\n      await rejectTaskApproval(taskId, user.id);\n      toast.success(\"Grev onay reddedildi\");\n      onSuccess?.(taskId);\n    } catch (error: unknown) {\n      const errorMessage = error instanceof Error ? error.message : \"Reddetme ilemi baarsz\";\n      toast.error(errorMessage);\n    }\n  };\n\n  const handleSubmit = async () => {\n    if (!user?.id) {\n      toast.error(\"Kullanc oturumu bulunamad\");\n      return;\n    }\n\n    if (!title.trim()) {\n      toast.error(\"Grev bal gereklidir\");\n      return;\n    }\n\n    setSaving(true);\n\n    try {\n      const parsedDueDate = dueDate ? Timestamp.fromDate(new Date(dueDate)) : null;\n\n      // Gizli grev iin proje kontrol\n      // Proje detay sayfasndayken (projectId prop'u varsa), otomatik olarak o projeyi kullan\n      // Eer kullanc baka bir proje semise, onu kullan\n      let finalProjectId = selectedProjectId || projectId || null;\n      \n      // Proje detay sayfasndayken ve proje seilmemise, otomatik olarak projectId prop'unu kullan\n      if (projectId && !selectedProjectId && !onlyInMyTasks) {\n        finalProjectId = projectId;\n      }\n      \n      // Gizli projelere gizli olmayan grevlerin atanmasn engelle\n      // Eer proje gizliyse, otomatik olarak grevi de gizli yap\n      let finalIsPrivate = isPrivate;\n      if (finalProjectId) {\n        const selectedProject = projects.find(p => p.id === finalProjectId);\n        if (selectedProject?.isPrivate) {\n          // Gizli projelere sadece gizli grevler atanabilir - otomatik olarak gizli yap\n          if (!isPrivate && !onlyInMyTasks) {\n            finalIsPrivate = true;\n            // Uyar verme, otomatik olarak gizli yapld\n          }\n        }\n      }\n      \n      // Gizli grevler iin proje seimi zorunlu ve sadece gizli projelere atanabilir\n      if (finalIsPrivate) {\n        if (!finalProjectId) {\n          toast.error(\"Gizli grevler iin bir gizli proje semelisiniz. Ltfen nce bir gizli proje oluturun.\");\n          setSaving(false);\n          return;\n        }\n        // Gizli grevlerin gizli olmayan projelere atanmasn engelle\n        const selectedProject = projects.find(p => p.id === finalProjectId);\n        if (selectedProject && !selectedProject.isPrivate) {\n          toast.error(\"Gizli grevler sadece gizli projelere atanabilir. Ltfen bir gizli proje sein.\");\n          setSaving(false);\n          return;\n        }\n      }\n\n      // Proje seimi zorunlu (gizli grevler ve \"Sadece Benim Grevlerim\" grevleri hari)\n      // Proje detay sayfasndayken (projectId prop'u varsa), otomatik olarak o projeye atanr\n      if (!finalProjectId || finalProjectId === \"general\") {\n        if (!isPrivate && !onlyInMyTasks && !projectId) {\n          toast.error(\"Ltfen bir proje sein. Her grevin bir projesi olmaldr.\");\n          setSaving(false);\n          return;\n        }\n      }\n\n      if (isEdit) {\n        if (!taskId) {\n          throw new Error(\"Grev seilemedi\");\n        }\n\n        // Yetki kontrol: Grev dzenleme yetkisi var m?\n        if (!canUpdate && !isSuperAdmin) {\n          const taskData = await getTaskById(taskId);\n          if (taskData) {\n            const userProfile: UserProfile = {\n              id: user.id,\n              email: user.email,\n              emailVerified: user.emailVerified,\n              fullName: user.fullName,\n              displayName: user.fullName,\n              phone: user.phone,\n              dateOfBirth: user.dateOfBirth,\n              role: user.roles,\n              createdAt: null,\n              updatedAt: null,\n            };\n            const { canEditTask } = await import(\"@/utils/permissions\");\n            const canEdit = await canEditTask(taskData, userProfile);\n            if (!canEdit) {\n              toast.error(\"Bu grevi dzenlemek iin yetkiniz yok. Sadece yneticiler, ekip liderleri veya grevi oluturan kii dzenleyebilir.\");\n              setSaving(false);\n              return;\n            }\n          }\n        }\n\n        await updateTask(\n          taskId,\n          {\n            title: title.trim(),\n            description: description.trim() || null,\n            dueDate: parsedDueDate,\n            priority: convertNewPriorityToOld(priority) as 1 | 2 | 3 | 4 | 5, // TaskService hala 1-5 kullanyor\n            projectId: finalProjectId || null,\n            isPrivate: finalIsPrivate,\n          },\n          user.id\n        );\n\n        // Grev yelerini senkronize et - hata varsa kullancya bildir\n        try {\n          await syncAssignments(taskId);\n        } catch (error: unknown) {\n          // Permission hatas ise kullancya bildir\n          const errorMessage = error instanceof Error ? error.message : String(error);\n          if (errorMessage.includes(\"permission\") || errorMessage.includes(\"Permission\") || errorMessage.includes(\"Missing or insufficient\")) {\n            toast.error(\"Grev yelerini deitirme yetkiniz yok. Sadece yneticiler, ekip liderleri veya grevi oluturan kii deitirebilir.\");\n            setSaving(false);\n            return;\n          }\n          // Dier hatalar iin genel mesaj\n          toast.error(\"Grev yeleri gncellenirken hata olutu: \" + errorMessage);\n          setSaving(false);\n          return;\n        }\n\n        // Eer checklist yoksa ve yeni maddeler varsa olutur\n        // Yetki kontrol: Firestore'dan kontrol et\n        if (!activeChecklistId && checklistItems.length > 0) {\n          try {\n            const taskData = await getTaskById(taskId);\n            if (taskData) {\n              const userProfile: UserProfile = {\n                id: user.id,\n                email: user.email,\n                emailVerified: user.emailVerified,\n                fullName: user.fullName,\n                displayName: user.fullName,\n                phone: user.phone,\n                dateOfBirth: user.dateOfBirth,\n                role: user.roles,\n                createdAt: null,\n                updatedAt: null,\n              };\n              const canAdd = await canAddChecklist(taskData, userProfile, selectedMembers);\n              if (canAdd) {\n                const newChecklist = await createChecklist(\n                  taskId,\n                  \"Checklist\",\n                  checklistItems.map((item) => ({\n                    text: item.text,\n                    completed: !!item.completed,\n                    updatedAt: Timestamp.now(),\n                  }))\n                );\n                setActiveChecklistId(newChecklist.id);\n              } else {\n                const { showPermissionErrorToast } = await import(\"@/utils/toastHelpers\");\n                showPermissionErrorToast(\"create\", \"checklist\");\n              }\n            }\n          } catch (error: unknown) {\n            // Hata durumunda sessizce devam et\n          }\n        }\n\n        toast.success(\"Grev gncellendi\");\n        onSuccess?.(taskId);\n        return;\n      }\n\n      // Yetki kontrol: Grev oluturma yetkisi var m?\n      if (!canCreate && !isSuperAdmin) {\n        const departments = await getDepartments();\n        const userProfile: UserProfile = {\n          id: user.id,\n          email: user.email,\n          emailVerified: user.emailVerified,\n          fullName: user.fullName,\n          displayName: user.fullName,\n          phone: user.phone,\n          dateOfBirth: user.dateOfBirth,\n          role: user.roles,\n          createdAt: null,\n          updatedAt: null,\n        };\n        const canCreateResult = await canCreateTask(userProfile, departments);\n        if (!canCreateResult) {\n          toast.error(\"Grev oluturma yetkiniz yok. Sadece yneticiler ve ekip liderleri grev oluturabilir.\");\n          setSaving(false);\n          return;\n        }\n      }\n\n      const task = await createTask({\n        title: title.trim(),\n        description: description.trim() || null,\n        status: defaultStatus,\n        priority: convertNewPriorityToOld(priority) as 1 | 2 | 3 | 4 | 5, // TaskService hala 1-5 kullanyor\n        dueDate: parsedDueDate,\n        labels: null,\n        projectId: onlyInMyTasks ? null : (finalProjectId || null),\n        productionOrderId: null,\n        productionProcessId: null,\n        createdBy: user.id,\n        isInPool: isTaskInPool,\n        poolRequests: [],\n        isPrivate: onlyInMyTasks ? true : finalIsPrivate, // Sadece benim grevlerim grevleri otomatik gizli\n        onlyInMyTasks: onlyInMyTasks,\n      });\n\n      if (!task?.id) {\n        throw new Error(\"Grev oluturulamad\");\n      }\n\n      const createdTaskId = task.id;\n\n      if (selectedMembers.length > 0) {\n        await Promise.all(\n          selectedMembers.map((memberId) => assignTask(createdTaskId, memberId, user.id))\n        );\n      }\n\n      if (checklistItems.length > 0) {\n        await createChecklist(\n          createdTaskId,\n          \"Checklist\",\n          checklistItems.map((item) => ({ text: item.text }))\n        );\n      }\n\n      // Sadece link tipi ekleri olutur, dosya ekleri create modunda desteklenmiyor (nce task olumal)\n      if (attachments.length > 0) {\n        const links = attachments.filter(a => a.type === \"drive_link\");\n        if (links.length > 0) {\n          await Promise.all(\n            links.map((link) =>\n              addTaskAttachment(createdTaskId, {\n                name: link.label,\n                url: link.url,\n                type: \"drive_link\",\n                attachmentType: \"drive_link\",\n                driveLink: link.url,\n                size: 0,\n                uploadedBy: user.id,\n              })\n            )\n          );\n        }\n      }\n\n      toast.success(\"Grev oluturuldu\");\n      resetState();\n      onSuccess?.(createdTaskId);\n    } catch (error: unknown) {\n      const errorMessage = error instanceof Error ? error.message : \"Grev kaydedilirken hata olutu\";\n      toast.error(errorMessage);\n    } finally {\n      setSaving(false);\n    }\n  };\n\n  return (\n    <Card\n      className={cn(\n        \"w-full border-primary/30 bg-muted/20 p-3 sm:p-4 md:p-6 space-y-3 sm:space-y-4 shadow-sm\",\n        className\n      )}\n    >\n      <div className=\"flex flex-col gap-2\">\n        {saving && (\n          <div className=\"flex justify-end mb-2\">\n            <Loader2 className=\"h-5 w-5 animate-spin text-primary\" />\n          </div>\n        )}\n      </div>\n\n      {loading ? (\n        <div className=\"flex h-32 items-center justify-center text-muted-foreground\">\n          <Loader2 className=\"h-5 w-5 animate-spin mr-2\" />\n          Form verileri ykleniyor...\n        </div>\n      ) : (\n        <>\n          {approvalStatus === \"pending\" && (\n            <div className=\"mb-4 p-4 bg-yellow-50 border border-yellow-200 rounded-lg\">\n              <div className=\"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4\">\n                <div>\n                  <h4 className=\"text-[11px] sm:text-xs font-semibold text-yellow-900\">Onay Bekliyor</h4>\n                  <p className=\"text-[11px] sm:text-xs text-yellow-700\">\n                    Bu grev tamamland olarak iaretlendi ve onaynz bekliyor.\n                  </p>\n                </div>\n                {/* SISTEM_YETKILERI.md'ye gre: Super Admin, Team Leader ve grevi oluturan onaylayabilir */}\n                {(isSuperAdmin || canUpdate || (user?.id && taskCreatorId === user.id)) && (\n                  <div className=\"flex gap-2 w-full sm:w-auto\">\n                    <Button\n                      size=\"sm\"\n                      variant=\"outline\"\n                      className=\"flex-1 sm:flex-none border-yellow-300 text-yellow-900 hover:bg-yellow-100 min-h-[44px] sm:min-h-0\"\n                      onClick={handleRejectTask}\n                    >\n                      <X className=\"h-4 w-4 mr-1\" />\n                      Reddet\n                    </Button>\n                    <Button\n                      size=\"sm\"\n                      className=\"flex-1 sm:flex-none bg-yellow-600 hover:bg-yellow-700 text-white border-none min-h-[44px] sm:min-h-0\"\n                      onClick={handleApproveTask}\n                    >\n                      <Check className=\"h-4 w-4 mr-1\" />\n                      Onayla\n                    </Button>\n                  </div>\n                )}\n              </div>\n            </div>\n          )}\n\n\n          <div className=\"grid gap-3 sm:grid-cols-2\">\n            <div className=\"space-y-2\">\n              <Label className=\"text-[11px] sm:text-xs\">Grev Bal *</Label>\n              <Input\n                placeholder=\"Grev bal\"\n                value={title}\n                onChange={(e) => {\n                  const value = e.target.value;\n                  if (value.length <= 200) {\n                    setTitle(value);\n                  }\n                }}\n                disabled={isRestrictedUser}\n                maxLength={200}\n                aria-describedby=\"title-char-count\"\n                className=\"min-h-[44px] sm:min-h-0 text-[14px] sm:text-sm\"\n              />\n              <div className=\"flex justify-between items-center\">\n                <span className=\"text-xs text-muted-foreground\" id=\"title-char-count\">\n                  {title.length}/200 karakter\n                </span>\n                {title.length === 0 && (\n                  <span className=\"text-xs text-destructive\">Zorunlu alan</span>\n                )}\n              </div>\n            </div>\n            <div className=\"space-y-2\">\n              <Label className=\"text-[11px] sm:text-xs\">Biti Tarihi</Label>\n              <Input\n                type=\"date\"\n                value={dueDate}\n                onChange={(e) => setDueDate(e.target.value)}\n                disabled={isRestrictedUser}\n                className=\"min-h-[44px] sm:min-h-0 text-[14px] sm:text-sm\"\n              />\n            </div>\n          </div>\n\n          <div className=\"space-y-2\">\n            <Label className=\"text-[11px] sm:text-xs\">ncelik</Label>\n            <Select\n              value={priority.toString()}\n              onValueChange={(value) => setPriority(Number(value) as PriorityLevel)}\n              disabled={isRestrictedUser}\n            >\n              <SelectTrigger className=\"w-full min-h-[44px] sm:min-h-0 text-[14px] sm:text-sm\">\n                <SelectValue />\n              </SelectTrigger>\n              <SelectContent className=\"min-w-[var(--radix-select-trigger-width)] max-h-[300px] sm:max-h-[200px] p-1 sm:p-1\">\n                {PRIORITY_OPTIONS.map((option) => (\n                  <SelectItem \n                    key={option.value} \n                    value={option.value.toString()} \n                    className=\"text-[14px] sm:text-sm min-h-[44px] sm:min-h-[36px] flex items-center py-2.5 sm:py-1.5 px-3 sm:px-2 cursor-pointer\"\n                  >\n                    {option.label} ({option.value})\n                  </SelectItem>\n                ))}\n              </SelectContent>\n            </Select>\n          </div>\n\n          <div className=\"space-y-2\">\n            <Label className=\"text-[11px] sm:text-xs\">\n              Proje {!showOnlyInMyTasks && <span className=\"text-destructive\">*</span>}\n            </Label>\n            <Select\n              value={selectedProjectId || \"\"}\n              onValueChange={async (value) => {\n                if (value === \"__create_project__\") {\n                  // Proje oluturma sayfasna git, sonra geri dn\n                  const currentPath = window.location.pathname;\n                  const currentSearch = window.location.search;\n                  navigate(\"/projects?returnTo=\" + encodeURIComponent(currentPath + currentSearch));\n                  return;\n                }\n                setSelectedProjectId(value);\n                // Seilen proje gizli ise grev de otomatik gizli olmal\n                const selectedProject = projects.find(p => p.id === value);\n                if (selectedProject?.isPrivate) {\n                  setIsPrivate(true);\n                  // Gizli proje seildiyse, sadece gizli projeleri gster\n                  // Projeleri yeniden ykle\n                  loadProjects();\n                } else {\n                  // Gizli olmayan proje seildiyse, tm projeleri gster\n                  loadProjects();\n                }\n              }}\n              disabled={isRestrictedUser || (!isEdit && !canSelectProject) || onlyInMyTasks}\n            >\n              <SelectTrigger className=\"min-h-[44px] sm:min-h-0 text-[14px] sm:text-sm\">\n                <SelectValue placeholder=\"Proje seiniz\" />\n              </SelectTrigger>\n              <SelectContent>\n                {(() => {\n                  // Eer gizli grev seildiyse veya gizli proje seildiyse, sadece gizli projeleri gster\n                  const selectedProject = selectedProjectId ? projects.find(p => p.id === selectedProjectId) : null;\n                  let filteredProjects = projects;\n                  \n                  if (isPrivate) {\n                    // Gizli grev seildiyse, sadece gizli projeleri gster\n                    // ANCAK: Mevcut seili proje gizli deilse bile, kullancnn eriebildii tm gizli projeleri gstermeliyiz\n                    // projects listesi zaten kullancnn yetkisine gre filtrelenmi olarak geliyor (loadProjects fonksiyonunda)\n                    // Bu yzden projects iindeki isPrivate olanlar filtrelemek yeterli\n                    filteredProjects = projects.filter(p => p.isPrivate);\n                    \n                    // Eer liste bosa ve mevcut seili proje varsa onu ekle (listede grnmesi iin)\n                    if (filteredProjects.length === 0 && selectedProject?.isPrivate) {\n                      filteredProjects = [selectedProject];\n                    }\n                  } else if (selectedProject?.isPrivate) {\n                    // Gizli proje seildiyse, sadece gizli projeleri gster\n                    filteredProjects = projects.filter(p => p.isPrivate);\n                  }\n                  \n                  return (\n                    <div className=\"max-h-[300px] overflow-y-auto overflow-x-hidden scroll-smooth\" \n                         style={{ \n                           height: 'auto', \n                           maxHeight: '300px',\n                           scrollPaddingBlock: '10px'\n                         }}>\n                      {filteredProjects.map((p) => (\n                        <SelectItem key={p.id} value={p.id}>\n                          {p.name}\n                        </SelectItem>\n                      ))}\n                      <div className=\"border-t border-border mt-1 pt-1\">\n                        <SelectItem \n                          value=\"__create_project__\" \n                          className=\"text-primary font-medium cursor-pointer\"\n                        >\n                          <Plus className=\"h-4 w-4 mr-2 inline\" />\n                          Yeni Proje Ekle\n                        </SelectItem>\n                      </div>\n                    </div>\n                  );\n                })()}\n              </SelectContent>\n            </Select>\n          </div>\n\n          <div className=\"space-y-2\">\n            <Label className=\"text-[11px] sm:text-xs\">Aklama</Label>\n            <Textarea\n              rows={3}\n              placeholder=\"Grev aklamas\"\n              value={description}\n              onChange={(e) => {\n                const value = e.target.value;\n                if (value.length <= 2000) {\n                  setDescription(value);\n                }\n              }}\n              disabled={isRestrictedUser}\n              maxLength={2000}\n              aria-describedby=\"description-char-count\"\n              className=\"text-[14px] sm:text-sm min-h-[100px] sm:min-h-0\"\n            />\n            <div className=\"flex justify-end\">\n              <span className=\"text-xs text-muted-foreground\" id=\"description-char-count\">\n                {description.length}/2000 karakter\n              </span>\n            </div>\n          </div>\n\n          <div className=\"space-y-3\">\n            <Label className=\"text-[11px] sm:text-xs\">Grev yeleri</Label>\n            <UserMultiSelect\n              selectedUsers={selectedMembers}\n              onSelectionChange={setSelectedMembers}\n              disabled={isRestrictedUser}\n            />\n            <div className=\"flex flex-col gap-2 pt-2\">\n              {!isEdit && (\n                <div className=\"flex items-center space-x-2\">\n                  <Checkbox \n                    id=\"pool-mode\" \n                    checked={isTaskInPool}\n                    onCheckedChange={(checked) => setIsTaskInPool(checked as boolean)}\n                  />\n                  <Label htmlFor=\"pool-mode\" className=\"text-[11px] sm:text-xs font-normal cursor-pointer text-muted-foreground\">\n                    Bu grevi Grev Havuzuna gnder (Atama yaplsa bile havuzda grnr)\n                  </Label>\n                </div>\n              )}\n              \n              {/* Sadece Benim Grevlerim Sayfasnda Gster */}\n              {showOnlyInMyTasks && !isEdit && (\n                <div className=\"flex items-center space-x-2\">\n                  <Checkbox\n                    id=\"only-my-tasks-inline\"\n                    checked={onlyInMyTasks}\n                    onCheckedChange={(checked) => {\n                      setOnlyInMyTasks(checked as boolean);\n                      if (checked) {\n                        // Sadece benim grevlerim seildiinde proje seimini temizle ve gizli yap\n                        setSelectedProjectId(null);\n                        setIsPrivate(true);\n                      }\n                    }}\n                  />\n                  <Label htmlFor=\"only-my-tasks-inline\" className=\"text-[11px] sm:text-xs font-normal cursor-pointer text-muted-foreground\">\n                    Sadece \"Benim Grevlerim\" sayfasnda gster (Sadece ben grebilirim)\n                  </Label>\n                </div>\n              )}\n              \n              {/* Gizlilik Ayar - Personel gremez */}\n              {!onlyInMyTasks && !isPersonnelOrViewer && (\n                <div className=\"flex items-center space-x-2\">\n                  <div className=\"flex items-center space-x-2\">\n                    <Checkbox\n                      id=\"private-task-inline\"\n                      checked={isPrivate}\n                      disabled={selectedProjectId && projects.find(p => p.id === selectedProjectId)?.isPrivate}\n                      onCheckedChange={async (checked) => {\n                        // Gizli projede grev olutururken checkbox disabled olduu iin bu fonksiyon almayacak\n                        // Ama yine de gvenlik iin kontrol ekliyoruz\n                        const selectedProject = selectedProjectId ? projects.find(p => p.id === selectedProjectId) : null;\n                        \n                        // Eer proje gizli ise, checkbox zaten disabled olduu iin buraya gelmemeli\n                        if (selectedProject?.isPrivate) {\n                          return; // Gizli projede deiiklik yaplamaz\n                        }\n                        \n                        setIsPrivate(checked as boolean);\n                        \n                        // Gizlilik seildiinde, eer seili proje gizli deilse proje seimini sfrla\n                        if (checked && selectedProjectId && !selectedProject?.isPrivate) {\n                          setSelectedProjectId(null);\n                          // Projeleri yeniden ykle (sadece gizli projeleri gstermek iin)\n                          loadProjects();\n                        }\n                      }}\n                    />\n                    <Label \n                      htmlFor=\"private-task-inline\" \n                      className={cn(\n                        \"text-[11px] sm:text-xs font-normal text-muted-foreground flex items-center gap-1\",\n                        selectedProjectId && projects.find(p => p.id === selectedProjectId)?.isPrivate \n                          ? \"cursor-default\" \n                          : \"cursor-pointer\"\n                      )}\n                    >\n                      <Lock className=\"h-3 w-3\" />\n                      Gizli Grev (Sadece atanan kiiler grebilir)\n                    </Label>\n                  </div>\n                </div>\n              )}\n            </div>\n          </div>\n\n\n          <div className=\"space-y-3\">\n            <Label className=\"flex items-center gap-2 text-[11px] sm:text-xs\">\n              <ListChecks className=\"h-4 w-4\" />\n              Checklist\n            </Label>\n            <div className=\"flex flex-col gap-2 sm:flex-row\">\n              <Input\n                placeholder=\"Checklist maddesi\"\n                value={newChecklistText}\n                onChange={(e) => setNewChecklistText(e.target.value)}\n                onKeyDown={(e) => {\n                  if (e.key === \"Enter\") {\n                    e.preventDefault();\n                    handleAddChecklistItem();\n                  }\n                }}\n                className=\"flex-1 min-h-[44px] sm:min-h-0 text-[14px] sm:text-sm\"\n              />\n              <Button type=\"button\" onClick={handleAddChecklistItem} className=\"min-h-[44px] sm:min-h-0 min-w-[44px] sm:min-w-0\">\n                <Plus className=\"h-4 w-4\" />\n              </Button>\n            </div>\n            {checklistItems.length > 0 && (\n              <div className=\"space-y-2\">\n                {checklistItems.map((item) => (\n                  <div\n                    key={item.id}\n                    className=\"flex items-center justify-between rounded-md border px-3 py-2\"\n                  >\n                    <div className=\"flex items-center gap-3\">\n                      <Checkbox\n                        checked={!!item.completed}\n                        onCheckedChange={() => handleToggleChecklistItem(item.id)}\n                      />\n                      <span className=\"text-[11px] sm:text-xs\">{item.text}</span>\n                    </div>\n                    <Button\n                      variant=\"ghost\"\n                      size=\"sm\"\n                      onClick={() => handleRemoveChecklistItem(item.id)}\n                      className=\"min-h-[44px] sm:min-h-0 min-w-[44px] sm:min-w-0\"\n                    >\n                      <X className=\"h-4 w-4\" />\n                    </Button>\n                  </div>\n                ))}\n              </div>\n            )}\n          </div>\n\n          <div className=\"space-y-3\">\n            <Label className=\"flex items-center gap-2 text-[11px] sm:text-xs\">\n              <Paperclip className=\"h-4 w-4\" />\n              Ekler (Dosya & Link)\n            </Label>\n            \n            {/* Link Ekleme Alan */}\n            <div className=\"grid gap-2 sm:grid-cols-3\">\n              <Input\n                placeholder=\"Link ad\"\n                value={linkLabel}\n                onChange={(e) => setLinkLabel(e.target.value)}\n                className=\"min-h-[44px] sm:min-h-0 text-[14px] sm:text-sm\"\n              />\n              <Input\n                placeholder=\"https://...\"\n                className=\"sm:col-span-2 min-h-[44px] sm:min-h-0 text-[14px] sm:text-sm\"\n                value={linkUrl}\n                onChange={(e) => setLinkUrl(e.target.value)}\n                onKeyDown={(e) => {\n                  if (e.key === \"Enter\") {\n                    e.preventDefault();\n                    handleAddLink();\n                  }\n                }}\n              />\n            </div>\n            <div className=\"flex gap-2 flex-wrap\">\n              <Button type=\"button\" variant=\"outline\" size=\"sm\" onClick={handleAddLink} className=\"min-h-[44px] sm:min-h-0 flex-1 sm:flex-initial\">\n                <LinkIcon className=\"h-4 w-4 mr-1\" />\n                Link Ekle\n              </Button>\n              \n              {/* Dosya Ykleme Butonu (Sadece Edit modunda) */}\n              {isEdit && (\n                <div className=\"relative\">\n                  <input\n                    type=\"file\"\n                    ref={fileInputRef}\n                    className=\"hidden\"\n                    onChange={handleFileUpload}\n                  />\n                  <Button \n                    type=\"button\" \n                    variant=\"outline\" \n                    size=\"sm\" \n                    onClick={() => fileInputRef.current?.click()}\n                    className=\"min-h-[44px] sm:min-h-0 flex-1 sm:flex-initial\"\n                  >\n                    <Paperclip className=\"h-4 w-4 mr-1\" />\n                    Dosya Ykle\n                  </Button>\n                </div>\n              )}\n              {!isEdit && (\n                <div title=\"Dosya yklemek iin nce grevi oluturmalsnz\" className=\"cursor-not-allowed opacity-50 flex-1 sm:flex-initial\">\n                  <Button type=\"button\" variant=\"outline\" size=\"sm\" disabled className=\"min-h-[44px] sm:min-h-0 w-full sm:w-auto\">\n                    <Paperclip className=\"h-4 w-4 mr-1\" />\n                    Dosya Ykle\n                  </Button>\n                </div>\n              )}\n            </div>\n\n            {attachments.length > 0 && (\n              <div className=\"space-y-2\">\n                {attachments.map((att) => (\n                  <div\n                    key={att.id}\n                    className=\"flex items-center justify-between rounded-md border px-3 py-2 text-[11px] sm:text-xs\"\n                  >\n                    <div className=\"truncate flex items-center\">\n                      {att.type === \"file\" ? (\n                        <Paperclip className=\"h-3 w-3 mr-2 text-muted-foreground\" />\n                      ) : (\n                        <LinkIcon className=\"h-3 w-3 mr-2 text-muted-foreground\" />\n                      )}\n                      <span className=\"font-medium\">{att.label}</span>\n                      <a \n                        href={att.url} \n                        target=\"_blank\" \n                        rel=\"noopener noreferrer\" \n                        className=\"text-muted-foreground ml-2 truncate inline-block max-w-[220px] align-middle hover:text-primary hover:underline\"\n                      >\n                        {att.type === \"file\" ? \"Dosyay A\" : att.url}\n                      </a>\n                    </div>\n                    <Button\n                      variant=\"ghost\"\n                      size=\"sm\"\n                      onClick={() => handleRemoveAttachment(att.id)}\n                      className=\"min-h-[44px] sm:min-h-0 min-w-[44px] sm:min-w-0\"\n                    >\n                      <X className=\"h-4 w-4\" />\n                    </Button>\n                  </div>\n                ))}\n              </div>\n            )}\n          </div>\n\n          <div className=\"flex flex-col gap-2 sm:flex-row sm:justify-end\">\n            <Button\n              variant=\"ghost\"\n              onClick={() => {\n                onCancel();\n                if (!isEdit) {\n                  resetState();\n                }\n              }}\n              disabled={saving}\n              className=\"min-h-[44px] sm:min-h-0 w-full sm:w-auto\"\n            >\n              Vazge\n            </Button>\n            {!isRestrictedUser && (\n              <Button onClick={handleSubmit} disabled={saving} className=\"min-h-[44px] sm:min-h-0 w-full sm:w-auto\">\n                {saving ? \"Kaydediliyor...\" : isEdit ? \"Gncelle\" : \"Grevi Olutur\"}\n              </Button>\n            )}\n          </div>\n        </>\n      )}\n    </Card>\n  );\n};\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\components\\Tasks\\TaskListHeader.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\components\\Tasks\\TaskListItem.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\components\\Tasks\\TaskPool.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchData'. Either include it or remove the dependency array.","line":166,"column":6,"nodeType":"ArrayExpression","endLine":166,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [fetchData]","fix":{"range":[6091,6093],"text":"[fetchData]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'filterAndSortTasks'. Either include it or remove the dependency array.","line":170,"column":6,"nodeType":"ArrayExpression","endLine":170,"endColumn":37,"suggestions":[{"desc":"Update the dependencies array to be: [filterAndSortTasks, poolTasks, searchTerm, sortBy]","fix":{"range":[6148,6179],"text":"[filterAndSortTasks, poolTasks, searchTerm, sortBy]"}}]},{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":648,"column":86,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":648,"endColumn":113}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useEffect, useMemo, useState } from \"react\";\nimport { MainLayout } from \"@/components/Layout/MainLayout\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { SearchInput } from \"@/components/ui/search-input\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { toast } from \"sonner\";\nimport { Loader2, Check, X, Users, Calendar, Plus, User, CircleDot, Clock, CheckCircle2 } from \"lucide-react\";\nimport { cn } from \"@/lib/utils\";\nimport { useAuth } from \"@/contexts/AuthContext\";\nimport {\n  getTasks,\n  requestTaskFromPool,\n  approvePoolRequest,\n  rejectPoolRequest,\n  Task,\n  updateTaskStatus,\n  requestTaskApproval,\n  getTaskAssignments,\n} from \"@/services/firebase/taskService\";\nimport { getAllUsers, UserProfile } from \"@/services/firebase/authService\";\nimport { getProjects, Project } from \"@/services/firebase/projectService\";\nimport { canViewPrivateProject } from \"@/utils/permissions\";\nimport {\n  AlertDialog,\n  AlertDialogAction,\n  AlertDialogCancel,\n  AlertDialogContent,\n  AlertDialogDescription,\n  AlertDialogFooter,\n  AlertDialogHeader,\n  AlertDialogTitle,\n} from \"@/components/ui/alert-dialog\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogDescription, DialogFooter } from \"@/components/ui/dialog\";\nimport { TaskInlineForm } from \"@/components/Tasks/TaskInlineForm\";\nimport { Label } from \"@/components/ui/label\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\nimport { TaskBoard } from \"@/components/Tasks/TaskBoard\";\nimport { Tabs, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Timestamp } from \"firebase/firestore\";\n\n// Status workflow tanm\ntype StatusItem = {\n  value: string;\n  label: string;\n  icon: typeof CircleDot;\n  color: string;\n};\n\nconst taskStatusWorkflow: StatusItem[] = [\n  { value: \"pending\", label: \"Yaplacak\", icon: CircleDot, color: \"text-amber-500\" },\n  { value: \"in_progress\", label: \"Devam Ediyor\", icon: Clock, color: \"text-blue-500\" },\n  { value: \"completed\", label: \"Tamamland\", icon: CheckCircle2, color: \"text-emerald-600\" },\n  { value: \"approved\", label: \"Onayland\", icon: CheckCircle2, color: \"text-green-600\" },\n];\n\n// Status helper fonksiyonlar\nconst getStatusLabel = (status: string) => {\n  const labels: Record<string, string> = {\n    pending: \"Yaplacak\",\n    in_progress: \"Devam Ediyor\",\n    completed: \"Tamamland\",\n    approved: \"Onayland\",\n  };\n  return labels[status] || status;\n};\n\nconst getCurrentStatusIndex = (status: string) => {\n  const index = taskStatusWorkflow.findIndex((statusItem) => statusItem.value === status);\n  return index === -1 ? 0 : index;\n};\n\nconst getNextStatus = (currentStatus: string) => {\n  const currentIndex = getCurrentStatusIndex(currentStatus);\n  if (currentIndex === -1 || currentIndex >= taskStatusWorkflow.length - 1) {\n    return null;\n  }\n  const nextStatus = taskStatusWorkflow[currentIndex + 1];\n  \n  // \"approved\" durumuna direkt gei yaplamaz - sadece onay sreci ile geilebilir\n  if (nextStatus && nextStatus.value === \"approved\") {\n    return null;\n  }\n  \n  return nextStatus;\n};\n\nconst TaskPool = () => {\n  const { user } = useAuth();\n  const [isSuperAdmin, setIsSuperAdmin] = useState(false);\n  const [canUpdate, setCanUpdate] = useState(false);\n  \n  // Permission state'lerini Firestore'dan kontrol et\n  useEffect(() => {\n    const checkPermissions = async () => {\n      if (!user) {\n        setIsSuperAdmin(false);\n        setCanUpdate(false);\n        return;\n      }\n      try {\n        const { isMainAdmin, canUpdateResource } = await import(\"@/utils/permissions\");\n        const userProfile: UserProfile = {\n          id: user.id,\n          email: user.email,\n          emailVerified: user.emailVerified,\n          fullName: user.fullName,\n          displayName: user.fullName,\n          phone: null,\n          dateOfBirth: null,\n          role: user.roles || [],\n          createdAt: null,\n          updatedAt: null,\n        };\n        const [isMainAdminUser, hasUpdatePermission] = await Promise.all([\n          isMainAdmin(userProfile),\n          canUpdateResource(userProfile, \"tasks\"),\n        ]);\n        setIsSuperAdmin(isMainAdminUser);\n        setCanUpdate(hasUpdatePermission);\n      } catch (error: unknown) {\n        if (import.meta.env.DEV) {\n          console.error(\"Error checking permissions:\", error);\n        }\n        setIsSuperAdmin(false);\n        setCanUpdate(false);\n      }\n    };\n    checkPermissions();\n  }, [user]);\n  const [loading, setLoading] = useState(true);\n  const [poolTasks, setPoolTasks] = useState<Task[]>([]);\n  const [filteredTasks, setFilteredTasks] = useState<Task[]>([]);\n  const [users, setUsers] = useState<Record<string, UserProfile>>({});\n  const [projects, setProjects] = useState<Record<string, Project>>({});\n  const [approveDialogOpen, setApproveDialogOpen] = useState(false);\n  const [selectedTask, setSelectedTask] = useState<Task | null>(null);\n  const [searchTerm, setSearchTerm] = useState(\"\");\n  const [sortBy, setSortBy] = useState<\"title\" | \"dueDate\" | \"createdAt\">(\"createdAt\");\n  const [addTaskDialogOpen, setAddTaskDialogOpen] = useState(false);\n  const [selectedProjectId, setSelectedProjectId] = useState<string | null>(null);\n  const [projectList, setProjectList] = useState<Project[]>([]);\n  const [viewMode, setViewMode] = useState<\"list\" | \"board\">(\"list\");\n  const [newTaskDefaultStatus, setNewTaskDefaultStatus] = useState<\"pending\" | \"in_progress\" | \"completed\">(\"pending\");\n  \n  // Yeni state'ler\n  const [viewTaskDialogOpen, setViewTaskDialogOpen] = useState(false);\n  const [viewTaskId, setViewTaskId] = useState<string | null>(null);\n  const [confirmApproveState, setConfirmApproveState] = useState<{\n    isOpen: boolean;\n    taskId: string;\n    userId: string;\n    userName: string;\n    keepInPool: boolean;\n  }>({\n    isOpen: false,\n    taskId: \"\",\n    userId: \"\",\n    userName: \"\",\n    keepInPool: false,\n  });\n\n  useEffect(() => {\n    fetchData();\n  }, []);\n\n  useEffect(() => {\n    filterAndSortTasks();\n  }, [poolTasks, searchTerm, sortBy]);\n\n  const fetchData = async () => {\n    setLoading(true);\n    try {\n      const [allTasks, allProjects, allUsersData] = await Promise.all([\n        getTasks(),\n        getProjects(),\n        getAllUsers(),\n      ]);\n\n      // Grev havuzunda sadece isInPool=true olan grevler gsterilir\n      // onlyInMyTasks grevleri grev havuzunda grnmez\n      const poolTasksData = allTasks.filter((task) => \n        task.isInPool === true && !task.onlyInMyTasks\n      );\n      setPoolTasks(poolTasksData);\n\n      const projectsMap: Record<string, Project> = {};\n      allProjects.forEach((p) => {\n        if (p.id === \"general\" || p.name?.toLowerCase() === \"genel grevler\" || p.name?.toLowerCase() === \"genel\") {\n          return;\n        }\n        projectsMap[p.id] = p;\n      });\n      setProjects(projectsMap);\n      // Gizli projeleri filtrele: Sadece ynetici, oluturan ve projede grevi olanlar grebilir\n      // Ekip lideri sadece kendi oluturduu gizli projeleri grebilir\n      const visibleProjects = await Promise.all(\n        allProjects.map(async (project) => {\n          if (!project.isPrivate) return project; // Gizli olmayan projeler herkes grebilir\n          if (isSuperAdmin) return project; // Super Admin tm projeleri grebilir\n          if (user?.id && project.createdBy === user.id) return project; // Oluturan grebilir\n          \n          // Ekip lideri iin projede grevi olan kullanclar kontrol yaplmaz (sadece kendi oluturduu gizli projeleri grebilir)\n          // Team Leader kontrol - Firestore'dan (canUpdate projects)\n          if (canUpdate && !isSuperAdmin) {\n            return null; // Ekip lideri sadece kendi oluturduu gizli projeleri grebilir (yukarda kontrol edildi)\n          }\n          \n          // Projede grevi olan kullanclar grebilir (ekip lideri hari)\n          if (user?.id) {\n            try {\n              const { getTasks, getTaskAssignments } = await import(\"@/services/firebase/taskService\");\n              const projectTasks = await getTasks({ projectId: project.id });\n              \n              // Kullancnn bu projede grevi var m kontrol et\n              for (const task of projectTasks) {\n                // Grevi oluturan kii\n                if (task.createdBy === user.id) return project;\n                \n                // Atanan kullanclar\n                if (task.assignedUsers && task.assignedUsers.includes(user.id)) return project;\n                \n                // Assignments kontrol\n                const assignments = await getTaskAssignments(task.id);\n                const isAssigned = assignments.some(\n                  (a) => a.assignedTo === user.id && (a.status === \"accepted\" || a.status === \"pending\")\n                );\n                if (isAssigned) return project;\n              }\n            } catch (error: unknown) {\n              // Hata durumunda gsterilmesin\n              if (import.meta.env.DEV) {\n                if (import.meta.env.DEV) {\n                  console.error(\"Error checking project tasks:\", error);\n                }\n              }\n            }\n          }\n          \n          return null; // Dier kullanclar gizli projeleri gremez\n        })\n      );\n\n      // Otomatik oluturulan \"Gizli Grevler\" projesini listeden kaldr\n      // Sadece kullancnn manuel oluturduu gizli projeler gsterilmeli\n      const finalProjects = visibleProjects.filter(\n        (p): p is typeof allProjects[0] => {\n          if (p === null) return false;\n          // Status ve genel proje filtrelemesi\n          if (p.status !== \"active\" || p.id === \"general\" || \n              p.name?.toLowerCase() === \"genel grevler\" || \n              p.name?.toLowerCase() === \"genel\") {\n            return false;\n          }\n          // Otomatik oluturulan \"Gizli Grevler\" projesini filtrele\n          if (p.name === \"Gizli Grevler\" && p.isPrivate === true && \n              p.description === \"Projesi olmayan gizli grevler iin otomatik oluturulan proje\") {\n            return false;\n          }\n          return true;\n        }\n      );\n      \n      setProjectList(finalProjects);\n\n      const usersMap: Record<string, UserProfile> = {};\n      allUsersData.forEach((u) => {\n        usersMap[u.id] = u;\n      });\n      setUsers(usersMap);\n    } catch (error: unknown) {\n      const errorMessage = error instanceof Error ? error.message : \"Grev havuzu yklenirken hata olutu\";\n      toast.error(errorMessage);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleRequestTask = async (taskId: string) => {\n    if (!user?.id) {\n      toast.error(\"Kullanc bilgisi bulunamad\");\n      return;\n    }\n\n    try {\n      await requestTaskFromPool(taskId, user.id);\n      toast.success(\"Grev talebi gnderildi\");\n      fetchData();\n    } catch (error: unknown) {\n      const errorMessage = error instanceof Error ? error.message : \"Talep hatas olutu\";\n      toast.error(errorMessage);\n    }\n  };\n\n  // Eski fonksiyon yerine yeni initiateApprove kullanyoruz\n  /*\n  const handleApproveRequest = async (taskId: string, userId: string) => {\n    // ...\n  };\n  */\n\n  const initiateApprove = (taskId: string, userId: string, userName: string) => {\n    setConfirmApproveState({\n      isOpen: true,\n      taskId,\n      userId,\n      userName,\n      keepInPool: false\n    });\n  };\n\n  const handleConfirmApprove = async () => {\n    const { taskId, userId, keepInPool } = confirmApproveState;\n    if (!user?.id) return;\n\n    try {\n      await approvePoolRequest(taskId, userId, user.id, keepInPool);\n      toast.success(\"Grev talebi onayland\");\n      \n      // State'i manuel gncelle\n      if (selectedTask) {\n        const updatedPoolRequests = (selectedTask.poolRequests || []).filter(id => id !== userId);\n        const updatedAssignedUsers = [...(selectedTask.assignedUsers || []), userId];\n        \n        const updatedTask = {\n          ...selectedTask,\n          poolRequests: keepInPool ? updatedPoolRequests : [], \n          isInPool: keepInPool,\n          assignedUsers: updatedAssignedUsers\n        };\n        \n        setSelectedTask(updatedTask);\n      }\n\n      setConfirmApproveState(prev => ({ ...prev, isOpen: false }));\n      fetchData();\n    } catch (error: unknown) {\n      const errorMessage = error instanceof Error ? error.message : \"Onaylama hatas olutu\";\n      toast.error(errorMessage);\n    }\n  };\n\n  const handleRejectRequest = async (taskId: string, userId: string) => {\n    try {\n      await rejectPoolRequest(taskId, userId);\n      toast.success(\"Grev talebi reddedildi\");\n      fetchData();\n    } catch (error: unknown) {\n      const errorMessage = error instanceof Error ? error.message : \"Reddetme hatas olutu\";\n      toast.error(errorMessage);\n    }\n  };\n\n  const openApproveDialog = (task: Task) => {\n    setSelectedTask(task);\n    setApproveDialogOpen(true);\n  };\n\n  const openViewTask = (taskId: string) => {\n    setViewTaskId(taskId);\n    setViewTaskDialogOpen(true);\n  };\n\n  const handleBoardTaskClick = (taskId: string, initialStatus?: string) => {\n    if (taskId === \"new\") {\n      if (\n        initialStatus &&\n        [\"pending\", \"in_progress\", \"completed\"].includes(initialStatus)\n      ) {\n        setNewTaskDefaultStatus(initialStatus as \"pending\" | \"in_progress\" | \"completed\");\n      } else {\n        setNewTaskDefaultStatus(\"pending\");\n      }\n      setAddTaskDialogOpen(true);\n      return;\n    }\n    openViewTask(taskId);\n  };\n\n  const filterAndSortTasks = () => {\n    let filtered = [...poolTasks];\n\n    if (searchTerm.trim()) {\n      const searchLower = searchTerm.toLocaleLowerCase('tr-TR');\n      filtered = filtered.filter(\n        (task) =>\n          (task.title?.toLocaleLowerCase('tr-TR') || \"\").includes(searchLower) ||\n          (task.description?.toLocaleLowerCase('tr-TR') || \"\").includes(searchLower)\n      );\n    }\n\n    filtered.sort((a, b) => {\n      if (sortBy === \"title\") {\n        return (a.title || \"\").localeCompare(b.title || \"\");\n      } else if (sortBy === \"dueDate\") {\n        const aDate = a.dueDate?.toMillis() || 0;\n        const bDate = b.dueDate?.toMillis() || 0;\n        return aDate - bDate;\n      } else {\n        const aDate = a.createdAt?.toMillis() || 0;\n        const bDate = b.createdAt?.toMillis() || 0;\n        return bDate - aDate;\n      }\n    });\n\n    setFilteredTasks(filtered);\n  };\n\n  const canManagePool = isSuperAdmin || canUpdate;\n\n  const boardTasks = useMemo(() => {\n    return filteredTasks.map((task) => {\n      const toISO = (value: Timestamp | Date | string | null | undefined) => {\n        if (!value) return null;\n        if (value instanceof Timestamp) return value.toDate().toISOString();\n        if (value instanceof Date) return value.toISOString();\n        // String kontrol\n        if (typeof value === \"string\") {\n          try {\n            return new Date(value).toISOString();\n          } catch {\n            return null;\n          }\n        }\n        // Firestore Timestamp objesi kontrol (toDate metodu varsa)\n        if (typeof value === \"object\" && value !== null) {\n          const objValue = value as Record<string, unknown>;\n          if (\"toDate\" in objValue && typeof objValue.toDate === \"function\") {\n            return (objValue.toDate as () => Date)().toISOString();\n          }\n        }\n        return null;\n      };\n\n      let labels: Array<{ name: string; color: string }> = [];\n      if (Array.isArray(task.labels)) {\n        labels = task.labels.map((label: string | { name: string; color: string }) =>\n          typeof label === \"string\" ? { name: label, color: \"#61BD4F\" } : label\n        );\n      } else if (typeof task.labels === \"string\") {\n        try {\n          const parsed = JSON.parse(task.labels);\n          if (Array.isArray(parsed)) {\n            labels = parsed.map((label: string | { name: string; color: string }) =>\n              typeof label === \"string\" ? { name: label, color: \"#61BD4F\" } : label\n            );\n          }\n        } catch {\n          labels = [];\n        }\n      }\n\n      const assignments = (task.assignedUsers || []).map((userId: string) => {\n        const assignedUser = users[userId];\n        return {\n          assigned_to: userId,\n          assigned_to_name: assignedUser?.fullName || assignedUser?.email || \"Kullanc\",\n          assigned_to_email: assignedUser?.email || \"\",\n        };\n      });\n\n      return {\n        id: task.id,\n        title: task.title,\n        description: task.description || \"\",\n        status: (task.status as \"pending\" | \"in_progress\" | \"completed\") || \"pending\",\n        priority: task.priority || 0,\n        due_date: toISO(task.dueDate),\n        created_at: toISO(task.createdAt) || new Date().toISOString(),\n        createdBy: task.createdBy,\n        labels,\n        assignments,\n      };\n    });\n  }, [filteredTasks, users]);\n\n  const handleBoardStatusChange = async (taskId: string, status: string) => {\n    if (!user) return;\n\n    try {\n      const normalizedStatus = status as \"pending\" | \"in_progress\" | \"completed\";\n      const targetTask = poolTasks.find((task) => task.id === taskId);\n      \n      if (!targetTask) {\n        toast.error(\"Grev bulunamad\");\n        return;\n      }\n\n      // Yetki kontrol: SADECE grev yeleri (rejected hari) ve grevi oluturan durum deitirebilir\n      // Personel, ekip lideri, ynetici - grev yesi olduu grevin durumunu deitirebilir\n      const isCreator = targetTask?.createdBy === user.id;\n      \n      // Grevin atanan kullanclarn kontrol et (rejected hari)\n      const taskAssignments = await getTaskAssignments(taskId);\n      const assignedUserIds = Array.isArray(taskAssignments) \n        ? taskAssignments\n            .filter(a => a?.status !== \"rejected\")\n            .map(a => a?.assignedTo)\n            .filter((id): id is string => !!id) \n        : [];\n      const isAssignedFromAssignments = assignedUserIds.includes(user.id);\n      \n      // Fallback: task.assignedUsers array'inden kontrol\n      const isInTaskAssignedUsers = Array.isArray(targetTask.assignedUsers) && targetTask.assignedUsers.some((u) => {\n        if (typeof u === 'string') {\n          return u === user.id;\n        }\n        if (typeof u === 'object' && u !== null && 'id' in u) {\n          return (u as { id: string }).id === user.id;\n        }\n        return false;\n      });\n      \n      const isAssigned = isAssignedFromAssignments || isInTaskAssignedUsers;\n      \n      // Sadece grev yesi (rejected hari) veya oluturan ise izin var\n      if (!isAssigned && !isCreator) {\n        toast.error(\"Bu grevin durumunu deitirme yetkiniz yok. Sadece grev yesi olduunuz grevlerin durumunu deitirebilirsiniz.\");\n        return;\n      }\n\n      const canDirectComplete = isCreator;\n\n      if (normalizedStatus === \"completed\" && !canDirectComplete) {\n        await requestTaskApproval(taskId, user.id);\n        toast.success(\"Grev tamamland olarak iaretlendi ve onay iin gnderildi.\");\n        fetchData();\n        return;\n      }\n\n      await updateTaskStatus(taskId, normalizedStatus);\n      toast.success(\"Grev durumu gncellendi\");\n      fetchData();\n    } catch (error: unknown) {\n      if (import.meta.env.DEV) {\n        if (import.meta.env.DEV) {\n          console.error(\"Task pool status change error:\", error);\n        }\n      }\n      const errorMessage = error instanceof Error ? error.message : \"Durum gncellenemedi\";\n      toast.error(errorMessage);\n    }\n  };\n\n  if (loading) {\n    return (\n      <MainLayout>\n        <div className=\"flex items-center justify-center h-64\">\n          <Loader2 className=\"h-8 w-8 animate-spin text-primary\" />\n        </div>\n      </MainLayout>\n    );\n  }\n\n  return (\n    <MainLayout>\n      <div className=\"space-y-6\">\n        <div className=\"flex flex-col sm:flex-row sm:items-center justify-between gap-4\">\n          <div>\n            <h1 className=\"text-[16px] sm:text-[18px] font-bold text-foreground\">Grev Havuzu</h1>\n            <p className=\"text-muted-foreground mt-1 text-sm sm:text-base\">\n              Henz atanmam grevleri grntleyin ve talep edin\n            </p>\n          </div>\n          <div className=\"flex items-center gap-3\">\n            <Tabs value={viewMode} onValueChange={(value) => setViewMode(value as \"list\" | \"board\")}>\n              <TabsList>\n                <TabsTrigger value=\"list\">Liste</TabsTrigger>\n                <TabsTrigger value=\"board\">Pano</TabsTrigger>\n              </TabsList>\n            </Tabs>\n            {canManagePool && (\n              <Button\n                onClick={() => {\n                  setNewTaskDefaultStatus(\"pending\");\n                  setAddTaskDialogOpen(true);\n                }}\n              >\n                <Plus className=\"h-4 w-4 mr-2\" />\n                Havuza Grev Ekle\n              </Button>\n            )}\n          </div>\n        </div>\n\n        <Card>\n          <CardHeader>\n            <div className=\"space-y-4\">\n              <div className=\"flex items-center justify-between\">\n                <div className=\"flex items-center gap-2\">\n                  <Users className=\"h-5 w-5\" />\n                  <CardTitle>Ak Grevler</CardTitle>\n                </div>\n                <Badge variant=\"secondary\">{filteredTasks.length} grev</Badge>\n              </div>\n              <div className=\"flex flex-col sm:flex-row items-center gap-3\">\n                <SearchInput\n                  placeholder=\"Grev ara...\"\n                  value={searchTerm}\n                  onChange={(e) => setSearchTerm(e.target.value)}\n                  containerClassName=\"flex-1 w-full\"\n                />\n                <Select value={sortBy} onValueChange={(value: \"title\" | \"dueDate\" | \"createdAt\") => setSortBy(value)}>\n                  <SelectTrigger className=\"w-full sm:w-[180px]\">\n                    <SelectValue placeholder=\"Srala\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"createdAt\">Yeni nce</SelectItem>\n                    <SelectItem value=\"title\">Bala Gre</SelectItem>\n                    <SelectItem value=\"dueDate\">Biti Tarihine Gre</SelectItem>\n                  </SelectContent>\n                </Select>\n              </div>\n            </div>\n          </CardHeader>\n          <CardContent>\n            {viewMode === \"list\" ? (\n              filteredTasks.length === 0 ? (\n                <div className=\"text-center py-12 text-muted-foreground border-2 border-dashed rounded-xl\">\n                  {searchTerm ? \"Arama sonucu bulunamad\" : \"Grev havuzunda u an ak grev yok.\"}\n                </div>\n              ) : (\n                <div className=\"space-y-4\">\n                  {filteredTasks.map((task) => {\n                  const poolRequests = task.poolRequests || [];\n                  const hasUserRequest = user?.id && poolRequests.includes(user.id);\n                  const isTaskCreator = task.createdBy === user?.id;\n                  const dueDate = task.dueDate ? task.dueDate.toDate() : null;\n                  const project = task.projectId ? projects[task.projectId] : null;\n\n                    return (\n                      <div\n                        key={task.id}\n                        className=\"flex flex-col gap-4 p-4 rounded-lg border bg-card hover:bg-accent/5 transition-colors cursor-pointer\"\n                        onClick={() => openViewTask(task.id)}\n                      >\n                      <div className=\"flex flex-col sm:flex-row sm:items-start justify-between gap-4\">\n                        <div className=\"space-y-2 flex-1\">\n                          <div className=\"flex flex-wrap items-center gap-2\">\n                            <h3 className=\"font-semibold text-lg\">{task.title}</h3>\n                            {project && (\n                              <Badge variant=\"secondary\" className=\"h-5 px-2 py-0 text-[11px] font-normal leading-tight\">\n                                {project.name}\n                              </Badge>\n                            )}\n                            {(() => {\n                              const { getPriorityOption, convertOldPriorityToNew } = require(\"@/utils/priority\");\n                              const taskPriority = task.priority || 0;\n                              // Eski sistem (1-5) varsa yeni sisteme (0-5) evir\n                              const newPriority = convertOldPriorityToNew(taskPriority);\n                              const option = getPriorityOption(newPriority);\n                              // Sadece yksek ncelikli grevleri gster (3 = Yksek, 4 = ok Yksek, 5 = Acil)\n                              if (newPriority >= 3) {\n                                return (\n                                  <Badge variant={newPriority >= 4 ? \"destructive\" : \"secondary\"} className=\"h-5 px-2 py-0 text-[11px] font-normal leading-tight\">\n                                    {option.label}\n                                  </Badge>\n                                );\n                              }\n                              return null;\n                            })()}\n                          </div>\n                          {task.description && (\n                            <p className=\"text-sm text-muted-foreground line-clamp-2\">\n                              {task.description}\n                            </p>\n                          )}\n                          <div className=\"flex flex-wrap items-center gap-4 text-sm text-muted-foreground\">\n                            {dueDate && (\n                              <div className=\"flex items-center gap-1\">\n                                <Calendar className=\"h-4 w-4\" />\n                                <span>{dueDate.toLocaleDateString(\"tr-TR\")}</span>\n                              </div>\n                            )}\n                            {task.createdBy && users[task.createdBy] && (\n                              <div className=\"flex items-center gap-1\">\n                                <User className=\"h-4 w-4\" />\n                                <span>Oluturan: {users[task.createdBy].fullName || users[task.createdBy].email || \"Bilinmeyen\"}</span>\n                              </div>\n                            )}\n                            <div className=\"flex items-center gap-1\">\n                              <Users className=\"h-4 w-4\" />\n                              <span>{poolRequests.length} talep</span>\n                            </div>\n                          </div>\n                        </div>\n\n                        <div className=\"flex items-center gap-2 self-end sm:self-start\" onClick={(e) => e.stopPropagation()}>\n                          {hasUserRequest ? (\n                            <Badge variant=\"outline\" className=\"bg-primary/10 text-primary border-primary/20\">\n                              Talep Gnderildi\n                            </Badge>\n                          ) : (\n                            <Button\n                              size=\"sm\"\n                              onClick={() => handleRequestTask(task.id)}\n                              disabled={poolRequests.includes(user?.id || \"\")}\n                            >\n                              Grevi Talep Et\n                            </Button>\n                          )}\n                          \n                          {(canManagePool || isTaskCreator) && poolRequests.length > 0 && (\n                            <Button\n                              size=\"sm\"\n                              variant=\"outline\"\n                              onClick={() => openApproveDialog(task)}\n                            >\n                              Talepleri Ynet\n                            </Button>\n                          )}\n                        </div>\n                      </div>\n                      </div>\n                    );\n                  })}\n                </div>\n              )\n            ) : (\n              <div className=\"-mx-4 sm:mx-0\">\n                <TaskBoard\n                  tasks={boardTasks}\n                  onTaskClick={handleBoardTaskClick}\n                  onStatusChange={handleBoardStatusChange}\n                />\n              </div>\n            )}\n          </CardContent>\n        </Card>\n\n        <AlertDialog open={approveDialogOpen} onOpenChange={setApproveDialogOpen}>\n          <AlertDialogContent>\n            <AlertDialogHeader>\n              <AlertDialogTitle>Grev Taleplerini Ynet</AlertDialogTitle>\n              <AlertDialogDescription>\n                \"{selectedTask?.title}\" grevi iin gelen talepleri onaylayn veya reddedin.\n              </AlertDialogDescription>\n            </AlertDialogHeader>\n            <div className=\"py-4 space-y-4 max-h-[60vh] overflow-y-auto\">\n              {selectedTask?.assignedUsers && selectedTask.assignedUsers.length > 0 && (\n                <div className=\"mb-4\">\n                  <h4 className=\"text-sm font-medium text-muted-foreground mb-2\">Atanan Kullanclar</h4>\n                  <div className=\"space-y-2\">\n                    {selectedTask.assignedUsers.map((userId) => {\n                      const assignedUser = users[userId];\n                      return (\n                        <div key={`assigned-${userId}`} className=\"flex items-center justify-between p-3 bg-green-50 border border-green-100 rounded-lg\">\n                          <div className=\"flex items-center gap-3\">\n                            <div className=\"h-8 w-8 rounded-full bg-green-100 flex items-center justify-center text-green-700 font-semibold text-sm\">\n                              {assignedUser?.fullName?.charAt(0) || assignedUser?.email?.charAt(0) || \"?\"}\n                            </div>\n                            <div>\n                              <div className=\"font-medium text-green-900\">{assignedUser?.fullName || \"Bilinmeyen Kullanc\"}</div>\n                              <div className=\"text-xs text-green-700\">{assignedUser?.email}</div>\n                            </div>\n                          </div>\n                          <Badge className=\"bg-green-100 text-green-800 hover:bg-green-100 border-green-200\">\n                            Onayland\n                          </Badge>\n                        </div>\n                      );\n                    })}\n                  </div>\n                </div>\n              )}\n\n              <div>\n                <h4 className=\"text-sm font-medium text-muted-foreground mb-2\">Bekleyen Talepler</h4>\n                <div className=\"space-y-2\">\n                  {selectedTask?.poolRequests?.map((userId) => {\n                    const requestingUser = users[userId];\n                    return (\n                      <div key={`request-${userId}`} className=\"flex items-center justify-between p-3 bg-muted rounded-lg\">\n                        <div className=\"flex items-center gap-3\">\n                          <div className=\"h-8 w-8 rounded-full bg-primary/10 flex items-center justify-center text-primary font-semibold text-sm\">\n                            {requestingUser?.fullName?.charAt(0) || requestingUser?.email?.charAt(0) || \"?\"}\n                          </div>\n                          <div>\n                            <div className=\"font-medium\">{requestingUser?.fullName || \"Bilinmeyen Kullanc\"}</div>\n                            <div className=\"text-xs text-muted-foreground\">{requestingUser?.email}</div>\n                          </div>\n                        </div>\n                        <div className=\"flex items-center gap-2\">\n                          <Button\n                            size=\"icon\"\n                            variant=\"ghost\"\n                            className=\"h-8 w-8 text-destructive hover:text-destructive hover:bg-destructive/10\"\n                            onClick={() => handleRejectRequest(selectedTask.id, userId)}\n                          >\n                            <X className=\"h-4 w-4\" />\n                          </Button>\n                          <Button\n                            size=\"icon\"\n                            variant=\"ghost\"\n                            className=\"h-8 w-8 text-green-600 hover:text-green-600 hover:bg-green-50\"\n                            onClick={() => initiateApprove(selectedTask.id, userId, requestingUser?.fullName || \"Kullanc\")}\n                          >\n                            <Check className=\"h-4 w-4\" />\n                          </Button>\n                        </div>\n                      </div>\n                    );\n                  })}\n                  {(!selectedTask?.poolRequests || selectedTask.poolRequests.length === 0) && (\n                    <div className=\"text-center text-muted-foreground py-4 bg-muted/30 rounded-lg border border-dashed\">Henz bekleyen talep yok.</div>\n                  )}\n                </div>\n              </div>\n            </div>\n            <AlertDialogFooter>\n              <AlertDialogCancel onClick={() => setApproveDialogOpen(false)}>Kapat</AlertDialogCancel>\n            </AlertDialogFooter>\n          </AlertDialogContent>\n        </AlertDialog>\n\n        <Dialog open={confirmApproveState.isOpen} onOpenChange={(open) => setConfirmApproveState(prev => ({ ...prev, isOpen: open }))}>\n          <DialogContent>\n            <DialogHeader>\n              <DialogTitle>Onaylama lemi</DialogTitle>\n              <DialogDescription>\n                {confirmApproveState.userName} kullancsnn talebini onaylamak zeresiniz.\n              </DialogDescription>\n            </DialogHeader>\n            <div className=\"py-4 space-y-4\">\n              <div className=\"flex items-center space-x-2\">\n                <Checkbox \n                  id=\"keepInPool\" \n                  checked={confirmApproveState.keepInPool}\n                  onCheckedChange={(checked) => setConfirmApproveState(prev => ({ ...prev, keepInPool: checked as boolean }))}\n                />\n                <label\n                  htmlFor=\"keepInPool\"\n                  className=\"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70 cursor-pointer\"\n                >\n                  Grevi havuzda tut (Dier kiiler de talep edebilir)\n                </label>\n              </div>\n              <p className=\"text-xs text-muted-foreground\">\n                Eer iaretlemezseniz, grev havuzdan kaldrlacak ve sadece atanan kullancya grnecektir.\n              </p>\n            </div>\n            <DialogFooter>\n              <Button variant=\"outline\" onClick={() => setConfirmApproveState(prev => ({ ...prev, isOpen: false }))}>ptal</Button>\n              <Button onClick={handleConfirmApprove}>Onayla</Button>\n            </DialogFooter>\n          </DialogContent>\n        </Dialog>\n\n        <Dialog open={addTaskDialogOpen} onOpenChange={setAddTaskDialogOpen}>\n          <DialogContent className=\"max-w-4xl w-[80vw] overflow-y-auto max-h-[90vh]\">\n            <DialogHeader>\n              <DialogTitle>Havuza Grev Ekle</DialogTitle>\n              <DialogDescription>\n                Grev havuzuna yeni bir grev ekleyin. Bu greve uygun ekip yeleri bavurabilir.\n              </DialogDescription>\n            </DialogHeader>\n            \n            <div className=\"mb-4\">\n              <Label htmlFor=\"project-select\">Proje Seimi *</Label>\n              <Select\n                value={selectedProjectId || \"\"}\n                onValueChange={setSelectedProjectId}\n              >\n                <SelectTrigger id=\"project-select\" className=\"mt-1\">\n                  <SelectValue placeholder=\"Bir proje sein...\" />\n                </SelectTrigger>\n                <SelectContent>\n                  {projectList.map((project) => (\n                    <SelectItem key={project.id} value={project.id}>\n                      {project.name}\n                    </SelectItem>\n                  ))}\n                </SelectContent>\n              </Select>\n            </div>\n\n            {selectedProjectId ? (\n            <TaskInlineForm\n                mode=\"create\"\n                projectId={selectedProjectId}\n              defaultStatus={newTaskDefaultStatus}\n                onCancel={() => {\n                  setAddTaskDialogOpen(false);\n                  setSelectedProjectId(null);\n                }}\n                onSuccess={() => {\n                  setAddTaskDialogOpen(false);\n                  setSelectedProjectId(null);\n                  fetchData();\n                }}\n                className=\"border-0 shadow-none p-0\"\n                isInPool={true}\n              />\n            ) : (\n              <div className=\"text-center py-8 text-muted-foreground border-2 border-dashed rounded-lg\">\n                Ltfen devam etmek iin bir proje sein.\n              </div>\n            )}\n          </DialogContent>\n        </Dialog>\n\n        <Dialog open={viewTaskDialogOpen} onOpenChange={setViewTaskDialogOpen}>\n          <DialogContent className=\"max-w-4xl w-[80vw] overflow-y-auto max-h-[90vh]\">\n            <DialogHeader>\n              <DialogTitle>Grev Detay</DialogTitle>\n              <DialogDescription>\n                Grevi inceleyin ve talep oluturun.\n              </DialogDescription>\n            </DialogHeader>\n            {viewTaskId && (\n              <TaskInlineForm\n                mode=\"edit\"\n                projectId={null}\n                taskId={viewTaskId}\n                onCancel={() => setViewTaskDialogOpen(false)}\n                onSuccess={() => {\n                    fetchData();\n                    setViewTaskDialogOpen(false);\n                }}\n                className=\"border-0 shadow-none p-0\"\n              />\n            )}\n          </DialogContent>\n        </Dialog>\n      </div>\n    </MainLayout>\n  );\n};\n\nexport default TaskPool;\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\components\\Tasks\\TaskStats.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\components\\Tasks\\UserMultiSelect.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\components\\Tasks\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\components\\Team\\PendingTaskApprovals.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchPendingTasks'. Either include it or remove the dependency array.","line":145,"column":6,"nodeType":"ArrayExpression","endLine":145,"endColumn":21,"suggestions":[{"desc":"Update the dependencies array to be: [user, isAdmin, fetchPendingTasks]","fix":{"range":[6696,6711],"text":"[user, isAdmin, fetchPendingTasks]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchPendingTasks'. Either include it or remove the dependency array.","line":165,"column":6,"nodeType":"ArrayExpression","endLine":165,"endColumn":21,"suggestions":[{"desc":"Update the dependencies array to be: [user, isAdmin, fetchPendingTasks]","fix":{"range":[7280,7295],"text":"[user, isAdmin, fetchPendingTasks]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useEffect, useState } from \"react\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Avatar, AvatarFallback } from \"@/components/ui/avatar\";\nimport { toast } from \"sonner\";\nimport { Check, X, ListTodo, Loader2, Clock, CheckCircle2, XCircle, Eye, AlertCircle, Users, CalendarDays, Folder, ChevronDown, ChevronUp, FileText, CircleDot } from \"lucide-react\";\nimport { cn } from \"@/lib/utils\";\nimport { useAuth } from \"@/contexts/AuthContext\";\nimport { getTasks, approveTask, rejectTaskApproval, Task, getTaskAssignments, getTaskById, subscribeToTasks, approvePoolRequest, rejectPoolRequest } from \"@/services/firebase/taskService\";\nimport { getUserProfile, getAllUsers, UserProfile } from \"@/services/firebase/authService\";\nimport { getDepartments } from \"@/services/firebase/departmentService\";\nimport { getProjects, Project, getProjectById } from \"@/services/firebase/projectService\";\nimport { getAuditLogs, AuditLog } from \"@/services/firebase/auditLogsService\";\nimport { getCustomerById } from \"@/services/firebase/customerService\";\nimport { getOrderById } from \"@/services/firebase/orderService\";\nimport { getProductById } from \"@/services/firebase/productService\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogDescription, DialogFooter } from \"@/components/ui/dialog\";\nimport { Label } from \"@/components/ui/label\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { TaskInlineForm } from \"@/components/Tasks/TaskInlineForm\";\nimport { addDays, isAfter, isBefore, startOfDay } from \"date-fns\";\nimport { Timestamp } from \"firebase/firestore\";\n\n// Status workflow tanm\ntype StatusItem = {\n  value: string;\n  label: string;\n  icon: typeof CircleDot;\n  color: string;\n};\n\nconst taskStatusWorkflow: StatusItem[] = [\n  { value: \"pending\", label: \"Yaplacak\", icon: CircleDot, color: \"text-amber-500\" },\n  { value: \"in_progress\", label: \"Devam Ediyor\", icon: Clock, color: \"text-blue-500\" },\n  { value: \"completed\", label: \"Tamamland\", icon: CheckCircle2, color: \"text-emerald-600\" },\n];\n\n// Normalize status - remove \"column_\" prefix if present\nconst normalizeStatusHelper = (status: string | undefined | null): string => {\n  if (!status) return \"pending\";\n  // Eer \"column_\" ile balyorsa, bu bir column ID'sidir (saysal olabilir)\n  if (status.startsWith(\"column_\")) {\n    const statusFromColumn = status.replace(\"column_\", \"\");\n    // Geerli status deerlerini kontrol et (pending, in_progress, completed, approved, cancelled)\n    if ([\"pending\", \"in_progress\", \"completed\", \"approved\", \"cancelled\"].includes(statusFromColumn)) {\n      return statusFromColumn === \"cancelled\" ? \"pending\" : statusFromColumn;\n    }\n    // Saysal ID veya geersiz deer ise \"pending\" olarak kabul et\n    return \"pending\";\n  }\n  // Geerli status deerlerini kontrol et\n  if ([\"pending\", \"in_progress\", \"completed\", \"approved\", \"cancelled\"].includes(status)) {\n    return status === \"cancelled\" ? \"pending\" : status;\n  }\n  return \"pending\"; // Fallback\n};\n\n// Status helper fonksiyonlar\nconst getStatusLabelHelper = (status: string) => {\n  // nce status' normalize et (column_ prefix'ini kaldr)\n  const normalized = normalizeStatusHelper(status);\n  const labels: Record<string, string> = {\n    pending: \"Yaplacak\",\n    in_progress: \"Devam Ediyor\",\n    completed: \"Tamamland\",\n  };\n  return labels[normalized] || normalized;\n};\n\nconst getCurrentStatusIndex = (status: string) => {\n  const index = taskStatusWorkflow.findIndex((statusItem) => statusItem.value === status);\n  return index === -1 ? 0 : index;\n};\n\nconst getNextStatus = (currentStatus: string) => {\n  const currentIndex = getCurrentStatusIndex(currentStatus);\n  if (currentIndex === -1 || currentIndex >= taskStatusWorkflow.length - 1) {\n    return null;\n  }\n  return taskStatusWorkflow[currentIndex + 1];\n};\n\n// Tarih formatlama fonksiyonu\nconst formatDateSafe = (dateInput?: Timestamp | Date | string | null) => {\n  if (!dateInput) return \"Tarih yok\";\n  try {\n    let date: Date;\n    if (dateInput instanceof Timestamp) {\n      // Firebase Timestamp\n      date = dateInput.toDate();\n    } else if (dateInput instanceof Date) {\n      date = dateInput;\n    } else if (typeof dateInput === \"string\") {\n      date = new Date(dateInput);\n    } else if (typeof dateInput === 'object' && 'toDate' in dateInput && typeof (dateInput as { toDate: () => Date }).toDate === 'function') {\n      date = (dateInput as { toDate: () => Date }).toDate();\n    } else {\n      return \"Geersiz tarih\";\n    }\n    \n    if (isNaN(date.getTime())) {\n      return \"Geersiz tarih\";\n    }\n    \n    return date.toLocaleDateString(\"tr-TR\", {\n      day: \"2-digit\",\n      month: \"2-digit\",\n      year: \"numeric\",\n      hour: \"2-digit\",\n      minute: \"2-digit\",\n    });\n  } catch (error) {\n    return \"Tarih hatas\";\n  }\n};\n\nexport const PendingTaskApprovals = () => {\n  const { user, isAdmin, isTeamLeader } = useAuth();\n  const [loading, setLoading] = useState(true);\n  const [pendingTasks, setPendingTasks] = useState<Task[]>([]);\n  const [approvedTasks, setApprovedTasks] = useState<Task[]>([]);\n  const [rejectedTasks, setRejectedTasks] = useState<Task[]>([]);\n  const [poolRequestTasks, setPoolRequestTasks] = useState<Task[]>([]);\n  const [requesterNames, setRequesterNames] = useState<Record<string, string>>({});\n  const [approverNames, setApproverNames] = useState<Record<string, string>>({});\n  const [rejecterNames, setRejecterNames] = useState<Record<string, string>>({});\n  const [selectedTask, setSelectedTask] = useState<Task | null>(null);\n  const [rejectDialogOpen, setRejectDialogOpen] = useState(false);\n  const [rejectReason, setRejectReason] = useState(\"\");\n  const [activeTab, setActiveTab] = useState(\"pending\");\n  const [taskDetailModalOpen, setTaskDetailModalOpen] = useState(false);\n  const [selectedTaskId, setSelectedTaskId] = useState<string | null>(null);\n  const [selectedTaskStatus, setSelectedTaskStatus] = useState<\"pending\" | \"in_progress\" | \"completed\">(\"pending\");\n  const [inlineFormMode, setInlineFormMode] = useState<\"create\" | \"edit\">(\"edit\");\n  const [projects, setProjects] = useState<Map<string, Project>>(new Map());\n  const [allUsers, setAllUsers] = useState<UserProfile[]>([]);\n  const [userLogs, setUserLogs] = useState<Record<string, AuditLog[]>>({});\n  const [expandedTaskLogs, setExpandedTaskLogs] = useState<Set<string>>(new Set());\n  const [entityNames, setEntityNames] = useState<Record<string, string>>({});\n\n  useEffect(() => {\n    fetchPendingTasks();\n  }, [user, isAdmin]);\n\n  // Dinamik gncelleme iin real-time listener\n  useEffect(() => {\n    if (!user?.id) return;\n    \n    let unsubscribeTasks: (() => void) | null = null;\n    let isMounted = true;\n\n    // Tasks iin real-time listener - tm grevleri dinle\n    unsubscribeTasks = subscribeToTasks({}, (tasks) => {\n      if (!isMounted) return;\n      // Real-time gncellemeler iin fetchPendingTasks' ar (grev havuzu talepleri de dahil)\n      fetchPendingTasks();\n    });\n\n    return () => {\n      isMounted = false;\n      if (unsubscribeTasks) unsubscribeTasks();\n    };\n  }, [user, isAdmin]);\n\n  const fetchPendingTasks = async () => {\n    if (!user?.id) return;\n    setLoading(true);\n    try {\n      // Tm onay durumlarndaki grevleri ve grev havuzu taleplerini getir\n      const [pending, approved, rejected, allTasksForPool, usersData, allDepts, projectsData] = await Promise.all([\n        getTasks({ approvalStatus: \"pending\" }),\n        getTasks({ approvalStatus: \"approved\" }),\n        getTasks({ approvalStatus: \"rejected\" }),\n        getTasks(), // Grev havuzu talepleri iin tm grevleri al\n        getAllUsers(),\n        getDepartments(),\n        getProjects(),\n      ]);\n      \n      // Grev havuzu taleplerini filtrele - sadece grevi oluturan kii iin\n      const poolTasks = allTasksForPool.filter(t => \n        t.isInPool === true && \n        t.poolRequests && \n        Array.isArray(t.poolRequests) && \n        t.poolRequests.length > 0 &&\n        t.createdBy === user.id // Sadece grevi oluturan kii grebilir\n      );\n      \n      // Projeleri Map'e evir\n      const projectsMap = new Map<string, Project>();\n      projectsData.forEach((p) => {\n        projectsMap.set(p.id, p);\n      });\n      setProjects(projectsMap);\n      setAllUsers(usersData);\n      \n      // Eer admin deilse, ekip lideri iin kendi ekibindeki yelerin grevlerini filtrele\n      const filterTasks = (taskList: Task[]) => {\n        if (isAdmin) return taskList;\n        \n        // Ekip lideri iin ynettii departmanlar bul\n        const managedDepartments = allDepts.filter(d => d.managerId === user.id);\n        \n        if (managedDepartments.length === 0) {\n          // Ekip lideri deilse veya hi departman ynetmiyorsa bo liste\n          return [];\n        }\n        \n        const managedDeptIds = managedDepartments.map(d => d.id);\n        \n        // Ekip yelerini bul\n        const teamMemberIds = usersData\n          .filter(u => {\n            if (u.approvedTeams && u.approvedTeams.some(deptId => managedDeptIds.includes(deptId))) {\n              return true;\n            }\n            if (u.pendingTeams && u.pendingTeams.some(deptId => managedDeptIds.includes(deptId))) {\n              return true;\n            }\n            if (u.departmentId && managedDeptIds.includes(u.departmentId)) {\n              return true;\n            }\n            return false;\n          })\n          .map(u => u.id);\n        \n        // Ekip lideri, kendi oluturduu grevleri ve ynettii ekip yelerinin onay bekleyen grevlerini grmeli\n        return taskList.filter(t =>\n          t.createdBy === user.id || // Kendi oluturduu grevler\n          (t.approvalRequestedBy && teamMemberIds.includes(t.approvalRequestedBy)) // Ekip yelerinin onay bekleyen grevleri\n        );\n      };\n\n      const filteredPending = filterTasks(pending);\n      const filteredApproved = filterTasks(approved);\n      const filteredRejected = filterTasks(rejected);\n\n      // Tm grevler iin assignments'lar al ve assignedUsers bilgisini ekle\n      const allTasks = [...filteredPending, ...filteredApproved, ...filteredRejected];\n      const tasksWithAssignments = await Promise.all(\n        allTasks.map(async (task) => {\n          try {\n            const assignments = await getTaskAssignments(task.id);\n            const assignedUsers = assignments\n              .map((a) => {\n                const user = usersData.find((u) => u.id === a.assignedTo);\n                return user\n                  ? {\n                      id: user.id,\n                      full_name: user.fullName || user.displayName || user.email || \"Bilinmeyen\",\n                      email: user.email,\n                    }\n                  : null;\n              })\n              .filter((u): u is { id: string; full_name: string; email: string } => u !== null);\n            \n            return { ...task, assignedUsers };\n          } catch (error: unknown) {\n            if (import.meta.env.DEV) {\n              if (import.meta.env.DEV) {\n                console.error(`Error fetching assignments for task ${task.id}:`, error);\n              }\n            }\n            return { ...task, assignedUsers: [] };\n          }\n        })\n      );\n\n      // Filtrelenmi grevleri assignedUsers ile gncelle\n      const pendingWithAssignments = tasksWithAssignments.filter(t => \n        filteredPending.some(ft => ft.id === t.id)\n      );\n      const approvedWithAssignments = tasksWithAssignments.filter(t => \n        filteredApproved.some(ft => ft.id === t.id)\n      );\n      const rejectedWithAssignments = tasksWithAssignments.filter(t => \n        filteredRejected.some(ft => ft.id === t.id)\n      );\n\n      setPendingTasks(pendingWithAssignments as unknown as Task[]);\n      setApprovedTasks(approvedWithAssignments as unknown as Task[]);\n      setRejectedTasks(rejectedWithAssignments as unknown as Task[]);\n      \n      // Grev havuzu taleplerini de assignments ile birlikte al\n      const poolTasksWithAssignments = await Promise.all(\n        poolTasks.map(async (task) => {\n          try {\n            const assignments = await getTaskAssignments(task.id);\n            const assignedUsers = assignments\n              .map((a) => {\n                const user = usersData.find((u) => u.id === a.assignedTo);\n                return user\n                  ? {\n                      id: user.id,\n                      full_name: user.fullName || user.displayName || user.email || \"Bilinmeyen\",\n                      email: user.email,\n                    }\n                  : null;\n              })\n              .filter((u): u is { id: string; full_name: string; email: string } => u !== null);\n            \n            return { ...task, assignedUsers };\n          } catch (error: unknown) {\n            if (import.meta.env.DEV) {\n              console.error(`Error fetching assignments for pool task ${task.id}:`, error);\n            }\n            return { ...task, assignedUsers: [] };\n          }\n        })\n      );\n      setPoolRequestTasks(poolTasksWithAssignments as unknown as Task[]);\n\n      // Tm kullanc isimlerini al\n      const requesterNamesMap: Record<string, string> = {};\n      const approverNamesMap: Record<string, string> = {};\n      const rejecterNamesMap: Record<string, string> = {};\n\n      await Promise.all(\n        allTasks.map(async (task) => {\n          if (task.approvalRequestedBy && !requesterNamesMap[task.approvalRequestedBy]) {\n            try {\n              const profile = await getUserProfile(task.approvalRequestedBy, true);\n              requesterNamesMap[task.approvalRequestedBy] = profile?.fullName || profile?.email || \"Silinmi Kullanc\";\n            } catch (error: unknown) {\n              requesterNamesMap[task.approvalRequestedBy] = \"Silinmi Kullanc\";\n            }\n          }\n          if (task.approvedBy && !approverNamesMap[task.approvedBy]) {\n            try {\n              const profile = await getUserProfile(task.approvedBy, true);\n              approverNamesMap[task.approvedBy] = profile?.fullName || profile?.email || \"Silinmi Kullanc\";\n            } catch (error: unknown) {\n              approverNamesMap[task.approvedBy] = \"Silinmi Kullanc\";\n            }\n          }\n          if (task.rejectedBy && !rejecterNamesMap[task.rejectedBy]) {\n            try {\n              const profile = await getUserProfile(task.rejectedBy, true);\n              rejecterNamesMap[task.rejectedBy] = profile?.fullName || profile?.email || \"Silinmi Kullanc\";\n            } catch (error: unknown) {\n              rejecterNamesMap[task.rejectedBy] = \"Silinmi Kullanc\";\n            }\n          }\n        })\n      );\n\n      setRequesterNames(requesterNamesMap);\n      setApproverNames(approverNamesMap);\n      setRejecterNames(rejecterNamesMap);\n\n      // Atanan kullanclarn loglarn al\n      const logsMap: Record<string, AuditLog[]> = {};\n      const uniqueUserIds = new Set<string>();\n      \n      // Tm grevlerdeki atanan kullanc ID'lerini topla\n      for (const task of tasksWithAssignments) {\n        const taskWithAssignments = task as Task & { assignedUsers?: Array<{ id: string; full_name: string; email: string }> };\n        const assignedUsers = taskWithAssignments.assignedUsers || [];\n        for (const user of assignedUsers) {\n          if (typeof user === 'string') {\n            uniqueUserIds.add(user);\n          } else if (user && typeof user === 'object' && 'id' in user) {\n            const userId = (user as { id: string }).id;\n            if (userId) {\n              uniqueUserIds.add(userId);\n            }\n          }\n        }\n      }\n      \n      // Her kullanc iin loglar al\n      await Promise.all(\n        Array.from(uniqueUserIds).map(async (userId) => {\n          try {\n            const logs = await getAuditLogs({ userId, limit: 10 });\n            logsMap[userId] = logs;\n          } catch (error: unknown) {\n            if (import.meta.env.DEV) {\n              if (import.meta.env.DEV) {\n                console.error(`Error fetching logs for user ${userId}:`, error);\n              }\n            }\n            logsMap[userId] = [];\n          }\n        })\n      );\n      \n      setUserLogs(logsMap);\n\n      // Entity isimlerini topla ve ek\n      const entityMap: Record<string, Set<string>> = {\n        tasks: new Set(),\n        projects: new Set(),\n        customers: new Set(),\n        orders: new Set(),\n        products: new Set(),\n      };\n      \n      const userIds = new Set<string>(); // Atanan kullanclar iin\n      \n      Object.values(logsMap).flat().forEach(log => {\n        if (log.recordId && entityMap[log.tableName]) {\n          entityMap[log.tableName].add(log.recordId);\n        }\n        // task_assignments iin taskId ve assignedTo'yu al\n        if (log.tableName === \"task_assignments\" && log.newData) {\n          const newData = log.newData as Record<string, unknown>;\n          if (typeof newData.taskId === 'string') {\n            entityMap.tasks.add(newData.taskId);\n          }\n          if (typeof newData.assignedTo === 'string') {\n            userIds.add(newData.assignedTo);\n          }\n        }\n      });\n      \n      // Entity adlarn ek\n      const names: Record<string, string> = {};\n      \n      // Grevler - proje bilgisi ile birlikte\n      if (entityMap.tasks.size > 0) {\n        const projectIds = new Set<string>();\n        await Promise.all(\n          Array.from(entityMap.tasks).map(async (id) => {\n            try {\n              const task = await getTaskById(id);\n              if (task?.title) {\n                names[`tasks_${id}`] = task.title;\n                // Proje ID'sini de kaydet - taskId -> projectId mapping\n                if (task.projectId) {\n                  projectIds.add(task.projectId);\n                  names[`task_project_${id}`] = task.projectId; // Mapping iin\n                }\n              }\n            } catch (error) {\n              // Sessizce devam et\n            }\n          })\n        );\n        // Grevlerin projelerini de ek\n        if (projectIds.size > 0) {\n          await Promise.all(\n            Array.from(projectIds).map(async (projectId) => {\n              try {\n                const project = await getProjectById(projectId);\n                if (project?.name) {\n                  names[`projects_${projectId}`] = project.name;\n                }\n              } catch (error) {\n                // Sessizce devam et\n              }\n            })\n          );\n        }\n      }\n      \n      // Projeler\n      if (entityMap.projects.size > 0) {\n        await Promise.all(\n          Array.from(entityMap.projects).map(async (id) => {\n            try {\n              const project = await getProjectById(id);\n              if (project?.name) {\n                names[`projects_${id}`] = project.name;\n              }\n            } catch (error) {\n              // Sessizce devam et\n            }\n          })\n        );\n      }\n      \n      // Mteriler\n      if (entityMap.customers.size > 0) {\n        await Promise.all(\n          Array.from(entityMap.customers).map(async (id) => {\n            try {\n              const customer = await getCustomerById(id);\n              if (customer?.name) {\n                names[`customers_${id}`] = customer.name;\n              }\n            } catch (error) {\n              // Sessizce devam et\n            }\n          })\n        );\n      }\n      \n      // Sipariler\n      if (entityMap.orders.size > 0) {\n        await Promise.all(\n          Array.from(entityMap.orders).map(async (id) => {\n            try {\n              const order = await getOrderById(id);\n              if (order?.orderNumber) {\n                names[`orders_${id}`] = `Sipari #${order.orderNumber}`;\n              } else if (order?.customerName) {\n                names[`orders_${id}`] = order.customerName;\n              }\n            } catch (error) {\n              // Sessizce devam et\n            }\n          })\n        );\n      }\n      \n      // rnler\n      if (entityMap.products.size > 0) {\n        await Promise.all(\n          Array.from(entityMap.products).map(async (id) => {\n            try {\n              const product = await getProductById(id);\n              if (product?.name) {\n                names[`products_${id}`] = product.name;\n              }\n            } catch (error) {\n              // Sessizce devam et\n            }\n          })\n        );\n      }\n      \n      // Kullanc adlarn ek (task_assignments iin)\n      if (userIds.size > 0) {\n        try {\n          const allUsers = await getAllUsers();\n          allUsers.forEach(user => {\n            if (userIds.has(user.id)) {\n              names[`users_${user.id}`] = user.fullName || user.displayName || user.email || \"Bilinmeyen\";\n            }\n          });\n        } catch (error) {\n          // Sessizce devam et\n        }\n      }\n      \n      setEntityNames(names);\n\n    } catch (error: unknown) {\n      if (import.meta.env.DEV) {\n        if (import.meta.env.DEV) {\n          console.error(\"Fetch tasks error:\", error);\n        }\n      }\n      toast.error(\"Grevler yklenemedi\");\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleApprove = async (task: Task) => {\n    if (!user?.id) return;\n    try {\n      await approveTask(task.id, user.id);\n      toast.success(\"Grev onayland\");\n      fetchPendingTasks();\n    } catch (error: unknown) {\n      const errorMessage = error instanceof Error ? error.message : \"Onaylama hatas olutu\";\n      toast.error(errorMessage);\n    }\n  };\n\n  const handleReject = async () => {\n    if (!selectedTask || !user?.id) return;\n    try {\n      await rejectTaskApproval(selectedTask.id, user.id, rejectReason || null); \n      toast.success(\"Grev onay reddedildi\");\n      setRejectDialogOpen(false);\n      setSelectedTask(null);\n      setRejectReason(\"\");\n      fetchPendingTasks();\n    } catch (error: unknown) {\n      const errorMessage = error instanceof Error ? error.message : \"Reddetme hatas olutu\";\n      toast.error(errorMessage);\n    }\n  };\n\n  const handleApprovePoolRequest = async (task: Task, requestingUserId: string) => {\n    if (!user?.id || !task?.id) return;\n    try {\n      await approvePoolRequest(task.id, requestingUserId, user.id, true);\n      toast.success(\"Grev havuzu talebi onayland\");\n      fetchPendingTasks();\n    } catch (error: unknown) {\n      const errorMessage = error instanceof Error ? error.message : \"Onaylama hatas olutu\";\n      toast.error(errorMessage);\n    }\n  };\n\n  const handleRejectPoolRequest = async (task: Task, requestingUserId: string) => {\n    if (!user?.id || !task?.id) return;\n    try {\n      await rejectPoolRequest(task.id, requestingUserId);\n      toast.success(\"Grev havuzu talebi reddedildi\");\n      fetchPendingTasks();\n    } catch (error: unknown) {\n      const errorMessage = error instanceof Error ? error.message : \"Reddetme hatas olutu\";\n      toast.error(errorMessage);\n    }\n  };\n\n  const handleTaskClick = (task: Task) => {\n    setSelectedTaskId(task.id);\n    // cancelled durumu artk yok, sadece pending, in_progress, completed var\n    const validStatus = task.status === \"cancelled\" ? \"completed\" : task.status;\n    setSelectedTaskStatus(validStatus as \"pending\" | \"in_progress\" | \"completed\");\n    setInlineFormMode(\"edit\");\n    setTaskDetailModalOpen(true);\n  };\n\n  const handleTaskDetailUpdate = () => {\n    fetchPendingTasks();\n  };\n\n  const getStatusIcon = (status: string) => {\n    switch (status) {\n      case \"completed\":\n        return <CheckCircle2 className=\"h-5 w-5 text-success\" />;\n      case \"in_progress\":\n        return <Clock className=\"h-5 w-5 text-warning\" />;\n      default:\n        return <AlertCircle className=\"h-5 w-5 text-muted-foreground\" />;\n    }\n  };\n\n  // Normalize status - remove \"column_\" prefix if present\n  const normalizeStatus = (status: string | undefined | null): string => {\n    if (!status) return \"pending\";\n    // Eer \"column_\" ile balyorsa, bu bir column ID'sidir (saysal olabilir)\n    if (status.startsWith(\"column_\")) {\n      const statusFromColumn = status.replace(\"column_\", \"\");\n      // Geerli status deerlerini kontrol et (pending, in_progress, completed, approved, cancelled)\n      if ([\"pending\", \"in_progress\", \"completed\", \"approved\", \"cancelled\"].includes(statusFromColumn)) {\n        return statusFromColumn === \"cancelled\" ? \"pending\" : statusFromColumn;\n      }\n      // Saysal ID veya geersiz deer ise \"pending\" olarak kabul et\n      return \"pending\";\n    }\n    // Geerli status deerlerini kontrol et\n    if ([\"pending\", \"in_progress\", \"completed\", \"approved\", \"cancelled\"].includes(status)) {\n      return status === \"cancelled\" ? \"pending\" : status;\n    }\n    return \"pending\"; // Fallback\n  };\n\n  const getStatusLabel = (status: string) => {\n    // nce status' normalize et (column_ prefix'ini kaldr)\n    const normalized = normalizeStatus(status);\n    const labels: Record<string, string> = {\n      pending: \"Beklemede\",\n      in_progress: \"Devam Ediyor\",\n      completed: \"Tamamland\",\n      cancelled: \"ptal\",\n    };\n    return labels[normalized] || normalized;\n  };\n\n  const isTaskOverdue = (task: Task) => {\n    if (!task.dueDate) return false;\n    let dueDate: Date;\n    if (task.dueDate instanceof Timestamp) {\n      dueDate = task.dueDate.toDate();\n    } else if (task.dueDate && typeof task.dueDate === 'object' && 'toDate' in task.dueDate) {\n      dueDate = (task.dueDate as { toDate: () => Date }).toDate();\n    } else if (typeof task.dueDate === 'string' || typeof task.dueDate === 'number') {\n      dueDate = new Date(task.dueDate);\n    } else {\n      return false;\n    }\n    return isBefore(dueDate, new Date()) && task.status !== \"completed\";\n  };\n\n  const isTaskDueSoon = (task: Task) => {\n    if (!task.dueDate) return false;\n    let dueDate: Date;\n    if (task.dueDate instanceof Timestamp) {\n      dueDate = task.dueDate.toDate();\n    } else if (task.dueDate && typeof task.dueDate === 'object' && 'toDate' in task.dueDate) {\n      dueDate = (task.dueDate as { toDate: () => Date }).toDate();\n    } else if (typeof task.dueDate === 'string' || typeof task.dueDate === 'number') {\n      dueDate = new Date(task.dueDate);\n    } else {\n      return false;\n    }\n    const today = startOfDay(new Date());\n    const threeDaysAfter = addDays(today, 3);\n    return (\n      !isTaskOverdue(task) &&\n      (isAfter(dueDate, today) || dueDate.getTime() === today.getTime()) &&\n      isBefore(dueDate, threeDaysAfter) &&\n      task.status !== \"completed\"\n    );\n  };\n\n  const formatDueDate = (value?: string | Timestamp | null) => {\n    if (!value) return \"-\";\n    try {\n      let date: Date;\n      if (value instanceof Timestamp) {\n        date = value.toDate();\n      } else if (typeof value === 'string') {\n        date = new Date(value);\n      } else if (value && typeof value === 'object' && 'toDate' in value) {\n        date = (value as { toDate: () => Date }).toDate();\n      } else {\n        return \"-\";\n      }\n      return date.toLocaleDateString(\"tr-TR\", {\n        day: \"2-digit\",\n        month: \"short\",\n      });\n    } catch {\n      return \"-\";\n    }\n  };\n\n  const getInitials = (name: string) => {\n    return name\n      .split(\" \")\n      .map(n => n[0])\n      .join(\"\")\n      .toUpperCase()\n      .slice(0, 2);\n  };\n\n  const renderTaskCard = (task: Task, showActions: boolean = true) => {\n    const requesterName = requesterNames[task.approvalRequestedBy || \"\"] || \"...\";\n    const approverName = task.approvedBy ? approverNames[task.approvedBy] || \"...\" : null;\n    const rejecterName = task.rejectedBy ? rejecterNames[task.rejectedBy] || \"...\" : null;\n    const approvalDate = task.approvedAt ? formatDateSafe(task.approvedAt) : null;\n    const rejectionDate = task.rejectedAt ? formatDateSafe(task.rejectedAt) : null;\n    const overdue = isTaskOverdue(task);\n    const dueSoon = isTaskDueSoon(task);\n    \n    // Assigned users bilgisini al\n    const taskWithAssignments = task as Task & { assignedUsers?: Array<{ id: string; full_name: string; email?: string }> };\n    const assignedUsers = taskWithAssignments.assignedUsers || [];\n    const assignedUsersWithDetails = assignedUsers\n      .map((user: { id: string; full_name: string; email?: string } | string) => {\n        if (typeof user === 'string') {\n          const userData = allUsers.find(u => u.id === user);\n          return userData ? { id: userData.id, full_name: userData.fullName || userData.email || \"Bilinmeyen\" } : null;\n        }\n        return user;\n      })\n      .filter((u): u is { id: string; full_name: string; email?: string } => u !== null);\n\n    return (\n      <Card\n        key={task.id}\n        className=\"group border-0 shadow-sm hover:shadow-md transition-all duration-200 overflow-hidden\"\n      >\n        <CardContent className=\"p-2\">\n          <div className=\"flex flex-col gap-2\">\n            {/* Header */}\n            <div\n              className=\"flex-1 cursor-pointer\"\n              onClick={() => handleTaskClick(task)}\n            >\n              <div className=\"flex items-start gap-2 mb-1.5\">\n                <div className=\"p-2 rounded-lg bg-primary/10\">\n                  {getStatusIcon(task.status)}\n                </div>\n                <div className=\"flex-1 min-w-0\">\n                  <div className=\"flex items-start justify-between gap-2 mb-2 min-w-0\">\n                    <h3 className=\"font-semibold text-[14px] sm:text-[15px] leading-tight line-clamp-2 flex-1 min-w-0\">{task.title}</h3>\n                    {task.projectId && projects.has(task.projectId) && (\n                      <Badge \n                        variant=\"outline\" \n                        className=\"bg-blue-50 text-blue-700 border-blue-200 text-xs flex-shrink-0 ml-2\"\n                      >\n                        <Folder className=\"h-3 w-3 mr-1 flex-shrink-0\" />\n                        <span className=\"truncate max-w-[100px] inline-block\">\n                          {projects.get(task.projectId)?.name}\n                        </span>\n                      </Badge>\n                    )}\n                  </div>\n                  {task.description && (\n                    <p className=\"text-sm text-muted-foreground line-clamp-2 leading-relaxed mb-1.5\">\n                      {task.description}\n                    </p>\n                  )}\n                </div>\n              </div>\n              \n              {/* Badges */}\n              <div className=\"flex flex-wrap gap-1 mb-1.5\">\n                <Badge variant=\"secondary\" className=\"h-4 px-1.5 text-[10px] font-normal border-0 leading-tight py-0\">{getStatusLabel(task.status)}</Badge>\n                <Badge variant=\"outline\" className=\"h-4 px-1.5 text-[10px] font-normal border leading-tight py-0\">ncelik {task.priority}</Badge>\n                {dueSoon && <Badge className=\"h-4 px-1.5 text-[10px] font-normal border-0 leading-tight py-0 bg-amber-100 text-amber-900 border-amber-200\">Yaklaan</Badge>}\n                {overdue && <Badge variant=\"destructive\" className=\"h-4 px-1.5 text-[10px] font-normal border-0 leading-tight py-0\">Gecikti</Badge>}\n                {task.approvalStatus === \"pending\" && (\n                  <Badge className=\"h-4 px-1.5 text-[10px] font-normal border-0 leading-tight py-0 bg-yellow-100 text-yellow-900 border-yellow-300\">Onay Bekliyor</Badge>\n                )}\n                {task.approvalStatus === \"approved\" && (\n                  <Badge className=\"h-4 px-1.5 text-[10px] font-normal border-0 leading-tight py-0 bg-green-100 text-green-900 border-green-300\">Onayland</Badge>\n                )}\n                {task.approvalStatus === \"rejected\" && (\n                  <Badge className=\"h-4 px-1.5 text-[10px] font-normal border-0 leading-tight py-0 bg-red-100 text-red-900 border-red-300\">Reddedildi</Badge>\n                )}\n              </div>\n              \n              {/* Meta Info */}\n              <div className=\"flex flex-wrap items-center gap-2 text-xs text-muted-foreground mb-1.5\">\n                {task.dueDate && (\n                  <span className=\"flex items-center gap-1.5\">\n                    <CalendarDays className=\"h-3.5 w-3.5\" />\n                    {formatDueDate(task.dueDate)}\n                  </span>\n                )}\n                {assignedUsersWithDetails.length > 0 && (\n                  <span className=\"flex items-center gap-1.5\">\n                    <Users className=\"h-3.5 w-3.5\" />\n                    {assignedUsersWithDetails.length} kii\n                  </span>\n                )}\n              </div>\n              \n              {/* Assigned Users */}\n              {assignedUsersWithDetails.length > 0 && (\n                <div className=\"flex items-center gap-2 mb-1.5\">\n                  <div className=\"flex -space-x-2\">\n                    {assignedUsersWithDetails.slice(0, 4).map((user) => {\n                      if (typeof user === 'string') return null;\n                      return (\n                        <Avatar key={user.id} className=\"h-6 w-6 border-2 border-background\">\n                          <AvatarFallback className=\"text-[10px]\">\n                            {getInitials(user.full_name)}\n                          </AvatarFallback>\n                        </Avatar>\n                      );\n                    }).filter(Boolean)}\n                  </div>\n                  {assignedUsersWithDetails.length > 4 && (\n                    <span className=\"text-xs text-muted-foreground\">\n                      +{assignedUsersWithDetails.length - 4}\n                    </span>\n                  )}\n                </div>\n              )}\n              \n              {/* Approval/Rejection Info */}\n              {(approverName || rejecterName || task.rejectionReason) && (\n                <div className=\"flex flex-col gap-1.5 p-2 bg-muted/30 rounded-lg border border-border text-xs\">\n                  {approverName && approvalDate && (\n                    <div className=\"flex items-start gap-2 min-w-0\">\n                      <CheckCircle2 className=\"h-3.5 w-3.5 text-emerald-600 mt-0.5 flex-shrink-0\" />\n                      <div className=\"flex-1 min-w-0\">\n                        <span className=\"font-semibold text-emerald-700\">Onaylayan:</span>\n                        <span className=\"ml-1.5 text-foreground break-words\">{approverName}</span>\n                        <span className=\"ml-1.5 text-muted-foreground whitespace-nowrap\">({approvalDate})</span>\n                      </div>\n                    </div>\n                  )}\n                  {rejecterName && rejectionDate && (\n                    <div className=\"flex items-start gap-2 min-w-0\">\n                      <XCircle className=\"h-3.5 w-3.5 text-red-600 mt-0.5 flex-shrink-0\" />\n                      <div className=\"flex-1 min-w-0\">\n                        <span className=\"font-semibold text-red-700\">Reddeden:</span>\n                        <span className=\"ml-1.5 text-foreground break-words\">{rejecterName}</span>\n                        <span className=\"ml-1.5 text-muted-foreground whitespace-nowrap\">({rejectionDate})</span>\n                      </div>\n                    </div>\n                  )}\n                  {task.rejectionReason && (\n                    <div className=\"text-red-700 font-medium pt-2 border-t border-border break-words\">\n                      <span className=\"font-semibold\">Neden:</span> <span className=\"break-words\">{task.rejectionReason}</span>\n                    </div>\n                  )}\n                </div>\n              )}\n            </div>\n\n            {/* Actions */}\n            <div className=\"flex items-center gap-2 pt-3 border-t\" onClick={(e) => e.stopPropagation()}>\n              {showActions && task.approvalStatus === \"pending\" && (\n                <>\n                  <Button\n                    size=\"sm\"\n                    variant=\"default\"\n                    className=\"flex-1 bg-green-600 hover:bg-green-700 text-white\"\n                    onClick={(e) => {\n                      e.stopPropagation();\n                      handleApprove(task);\n                    }}\n                  >\n                    <Check className=\"h-4 w-4 mr-1.5\" />\n                    Onayla\n                  </Button>\n                  <Button\n                    size=\"sm\"\n                    variant=\"outline\"\n                    className=\"flex-1 border-red-200 text-red-700 hover:bg-red-50 hover:text-red-800\"\n                    onClick={(e) => {\n                      e.stopPropagation();\n                      setSelectedTask(task);\n                      setRejectDialogOpen(true);\n                    }}\n                  >\n                    <X className=\"h-4 w-4 mr-1.5\" />\n                    Reddet\n                  </Button>\n                </>\n              )}\n              <Button\n                size=\"sm\"\n                variant=\"outline\"\n                className=\"flex-1\"\n                onClick={(e) => {\n                  e.stopPropagation();\n                  handleTaskClick(task);\n                }}\n              >\n                <Eye className=\"h-4 w-4 mr-1.5\" />\n                Detay\n              </Button>\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n    );\n  };\n\n  if (loading) {\n    return (\n      <Card>\n        <CardContent className=\"flex items-center justify-center py-8\">\n          <Loader2 className=\"h-6 w-6 animate-spin text-primary\" />\n        </CardContent>\n      </Card>\n    );\n  }\n\n  return (\n    <div className=\"w-full space-y-1 min-w-0\">\n      <div>\n          <Tabs value={activeTab} onValueChange={setActiveTab} className=\"w-full\">\n            <TabsList className=\"grid w-full grid-cols-3 bg-muted/50\">\n              <TabsTrigger value=\"pending\" className=\"gap-2 data-[state=active]:bg-background data-[state=active]:shadow-sm\">\n                <Clock className=\"h-4 w-4\" />\n                Bekleyen\n                {(pendingTasks.length + poolRequestTasks.length) > 0 && (\n                  <Badge variant=\"secondary\" className=\"ml-1.5 h-5 min-w-5 px-1.5 text-xs\">\n                    {pendingTasks.length + poolRequestTasks.length}\n                  </Badge>\n                )}\n              </TabsTrigger>\n              <TabsTrigger value=\"approved\" className=\"gap-2 data-[state=active]:bg-background data-[state=active]:shadow-sm\">\n                <CheckCircle2 className=\"h-4 w-4\" />\n                Onayland\n                {approvedTasks.length > 0 && (\n                  <Badge variant=\"secondary\" className=\"ml-1.5 h-5 min-w-5 px-1.5 text-xs\">\n                    {approvedTasks.length}\n                  </Badge>\n                )}\n              </TabsTrigger>\n              <TabsTrigger value=\"rejected\" className=\"gap-2 data-[state=active]:bg-background data-[state=active]:shadow-sm\">\n                <XCircle className=\"h-4 w-4\" />\n                Reddedildi\n                {rejectedTasks.length > 0 && (\n                  <Badge variant=\"secondary\" className=\"ml-1.5 h-5 min-w-5 px-1.5 text-xs\">\n                    {rejectedTasks.length}\n                  </Badge>\n                )}\n              </TabsTrigger>\n            </TabsList>\n\n            <TabsContent value=\"pending\" className=\"space-y-1 mt-1 max-h-[60vh] overflow-y-auto\">\n              {pendingTasks.length === 0 && poolRequestTasks.length === 0 ? (\n                <div className=\"text-center py-6 text-muted-foreground\">\n                  <div className=\"flex justify-center mb-2\">\n                    <Check className=\"h-8 w-8 text-muted-foreground/20\" />\n                  </div>\n                  <p className=\"text-sm\">Onaynz bekleyen grev bulunmuyor.</p>\n                </div>\n              ) : (\n                <div className=\"space-y-1.5\">\n                  {/* Grev Onaylar */}\n                  {pendingTasks.map((task) => renderTaskCard(task, true))}\n                  \n                  {/* Grev Havuzu Talepleri */}\n                  {poolRequestTasks.map((task) => {\n                    const poolRequests = task.poolRequests || [];\n                    if (!Array.isArray(poolRequests) || poolRequests.length === 0) return null;\n                    \n                    return (\n                      <Card\n                        key={task.id}\n                        className=\"border-amber-200 bg-amber-50/30 hover:bg-amber-50/50 transition-all duration-200 shadow-sm hover:shadow-md\"\n                      >\n                        <CardContent className=\"p-4\">\n                          <div className=\"flex flex-col gap-4\">\n                            {/* Header */}\n                            <div className=\"flex items-start gap-2\">\n                              <div className=\"p-2 rounded-lg bg-amber-100\">\n                                <ListTodo className=\"h-5 w-5 text-amber-600\" />\n                              </div>\n                              <div className=\"flex-1 min-w-0\">\n                                <div className=\"flex items-start justify-between gap-2 mb-2\">\n                                  <h3 className=\"font-semibold text-[14px] sm:text-[15px] leading-tight line-clamp-2\">{task.title}</h3>\n                                  <Badge className=\"bg-amber-100 text-amber-900 border-amber-300 text-xs flex-shrink-0\">\n                                    Havuz Talebi\n                                  </Badge>\n                                </div>\n                                {task.projectId && projects.has(task.projectId) && (\n                                  <Badge \n                                    variant=\"outline\" \n                                    className=\"bg-blue-50 text-blue-700 border-blue-200 text-xs mb-2\"\n                                  >\n                                    <Folder className=\"h-3 w-3 mr-1\" />\n                                    {projects.get(task.projectId)?.name}\n                                  </Badge>\n                                )}\n                                {task.description && (\n                                  <p className=\"text-sm text-muted-foreground line-clamp-2 leading-relaxed mb-1.5\">\n                                    {task.description}\n                                  </p>\n                                )}\n                              </div>\n                            </div>\n                            \n                            {/* Requests */}\n                            <div className=\"space-y-2\">\n                              <p className=\"text-sm font-medium text-amber-900\">\n                                {poolRequests.length} talep var:\n                              </p>\n                              <div className=\"space-y-2\">\n                                {poolRequests.map((requestingUserId: string) => {\n                                  const requestingUser = allUsers.find(u => u.id === requestingUserId);\n                                  const userName = requestingUser?.fullName || requestingUser?.displayName || requestingUser?.email?.split(\"@\")[0] || \"Bilinmeyen Kullanc\";\n                                  \n                                  return (\n                                    <div key={requestingUserId} className=\"flex items-center justify-between gap-1.5 p-2 bg-white rounded-lg border border-amber-200 hover:border-amber-300 transition-colors min-w-0\">\n                                      <div className=\"flex items-center gap-2 flex-1 min-w-0\">\n                                        <Avatar className=\"h-8 w-8 flex-shrink-0\">\n                                          <AvatarFallback className=\"bg-amber-100 text-amber-700 text-xs\">\n                                            {getInitials(userName)}\n                                          </AvatarFallback>\n                                        </Avatar>\n                                        <div className=\"flex-1 min-w-0\">\n                                          <p className=\"text-sm font-medium text-gray-900 truncate\">{userName}</p>\n                                          <p className=\"text-xs text-gray-500 truncate\">Grevi talep etti</p>\n                                        </div>\n                                      </div>\n                                      <div className=\"flex items-center gap-2 flex-shrink-0\">\n                                        <Button\n                                          size=\"sm\"\n                                          variant=\"outline\"\n                                          className=\"border-red-300 text-red-700 hover:bg-red-50 h-8 px-2\"\n                                          onClick={() => handleRejectPoolRequest(task, requestingUserId)}\n                                        >\n                                          <X className=\"h-3.5 w-3.5 mr-1\" />\n                                          Reddet\n                                        </Button>\n                                        <Button\n                                          size=\"sm\"\n                                          className=\"bg-amber-600 hover:bg-amber-700 text-white border-none h-8 px-3\"\n                                          onClick={() => handleApprovePoolRequest(task, requestingUserId)}\n                                        >\n                                          <Check className=\"h-3.5 w-3.5 mr-1\" />\n                                          Onayla\n                                        </Button>\n                                      </div>\n                                    </div>\n                                  );\n                                })}\n                              </div>\n                            </div>\n                            \n                            {/* Action */}\n                            <div className=\"pt-3 border-t\" onClick={(e) => e.stopPropagation()}>\n                              <Button\n                                size=\"sm\"\n                                variant=\"outline\"\n                                className=\"w-full\"\n                                onClick={(e) => {\n                                  e.stopPropagation();\n                                  handleTaskClick(task);\n                                }}\n                              >\n                                <Eye className=\"h-4 w-4 mr-2\" />\n                                Detay\n                              </Button>\n                            </div>\n                          </div>\n                        </CardContent>\n                      </Card>\n                    );\n                  })}\n                </div>\n              )}\n            </TabsContent>\n\n            <TabsContent value=\"approved\" className=\"space-y-1 mt-1 max-h-[60vh] overflow-y-auto\">\n              {approvedTasks.length === 0 ? (\n                <div className=\"text-center py-12 text-muted-foreground\">\n                  <div className=\"flex justify-center mb-1.5\">\n                    <CheckCircle2 className=\"h-10 w-10 text-muted-foreground/20\" />\n                  </div>\n                  <p>Onaylanm grev bulunmuyor.</p>\n                </div>\n              ) : (\n                <div className=\"space-y-1.5\">\n                  {approvedTasks.map((task) => renderTaskCard(task, false))}\n                </div>\n              )}\n            </TabsContent>\n\n            <TabsContent value=\"rejected\" className=\"space-y-1 mt-1 max-h-[60vh] overflow-y-auto\">\n              {rejectedTasks.length === 0 ? (\n                <div className=\"text-center py-12 text-muted-foreground\">\n                  <div className=\"flex justify-center mb-1.5\">\n                    <XCircle className=\"h-10 w-10 text-muted-foreground/20\" />\n                  </div>\n                  <p>Reddedilmi grev bulunmuyor.</p>\n                </div>\n              ) : (\n                <div className=\"space-y-1\">\n                  {rejectedTasks.map((task) => renderTaskCard(task, false))}\n                </div>\n              )}\n            </TabsContent>\n          </Tabs>\n      </div>\n\n      <Dialog open={rejectDialogOpen} onOpenChange={setRejectDialogOpen}>\n        <DialogContent>\n          <DialogTitle className=\"sr-only\">Grevi Reddet</DialogTitle>\n          <DialogDescription className=\"sr-only\">\n              Grevi neden reddettiinizi belirtebilirsiniz. Grev \"Devam Ediyor\" statsne geri dnecektir.\n            </DialogDescription>\n          <DialogHeader>\n            <h2 className=\"text-[14px] sm:text-[15px] font-semibold text-foreground\">Grevi Reddet</h2>\n            <p className=\"text-sm text-muted-foreground\">\n              Grevi neden reddettiinizi belirtebilirsiniz. Grev \"Devam Ediyor\" statsne geri dnecektir.\n            </p>\n          </DialogHeader>\n          <div className=\"space-y-2 py-2\">\n            <Label>Red Nedeni</Label>\n            <Textarea \n              placeholder=\"Eksik ksmlar var, ltfen kontrol et...\" \n              value={rejectReason}\n              onChange={(e) => setRejectReason(e.target.value)}\n            />\n          </div>\n          <DialogFooter>\n            <Button variant=\"outline\" onClick={() => setRejectDialogOpen(false)}>ptal</Button>\n            <Button variant=\"destructive\" onClick={handleReject}>Reddet</Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n\n      <Dialog open={taskDetailModalOpen} onOpenChange={setTaskDetailModalOpen}>\n        <DialogContent className=\"!max-w-[100vw] sm:!max-w-[95vw] md:!max-w-[90vw] lg:!max-w-4xl !w-[100vw] sm:!w-[95vw] md:!w-[90vw] lg:!w-[80vw] !h-[100vh] sm:!h-[90vh] md:!h-[85vh] !max-h-[100vh] sm:!max-h-[90vh] md:!max-h-[85vh] !left-0 sm:!left-[2.5vw] md:!left-[5vw] lg:!left-1/2 !top-0 sm:!top-[5vh] md:!top-[7.5vh] lg:!top-1/2 !right-0 sm:!right-auto !bottom-0 sm:!bottom-auto !translate-x-0 sm:!translate-x-0 md:!translate-x-0 lg:!-translate-x-1/2 !translate-y-0 sm:!translate-y-0 md:!translate-y-0 lg:!-translate-y-1/2 overflow-hidden !p-0 gap-0 bg-white flex flex-col !m-0 !rounded-none sm:!rounded-lg !border-0 sm:!border\">\n          <DialogTitle className=\"sr-only\">Grev Detaylar</DialogTitle>\n          <DialogDescription className=\"sr-only\">\n            Grev detaylarn, ekibi ve checklist'i grntleyin.\n          </DialogDescription>\n          <div className=\"flex flex-col h-full min-h-0 overflow-hidden\">\n            <DialogHeader className=\"flex-shrink-0 px-4 sm:px-6 pt-4 sm:pt-6 pb-3 sm:pb-4 border-b\">\n              <h2 className=\"text-[14px] sm:text-[15px] font-semibold text-foreground\">Grev Detaylar</h2>\n              <p className=\"text-sm text-muted-foreground\">\n                Grev detaylarn, ekibi ve checklist'i grntleyin.\n              </p>\n            </DialogHeader>\n            <div className=\"flex-1 overflow-y-auto overflow-x-hidden min-h-0 px-4 sm:px-6 py-4 sm:py-6\">\n              {selectedTaskId && (\n                <TaskInlineForm\n                  key={`${inlineFormMode}-${selectedTaskId}`}\n                  mode={inlineFormMode}\n                  projectId={null}\n                  taskId={selectedTaskId}\n                  defaultStatus={selectedTaskStatus}\n                  onCancel={() => {\n                    setTaskDetailModalOpen(false);\n                    setSelectedTaskId(null);\n                    setSelectedTaskStatus(\"pending\");\n                  }}\n                  onSuccess={() => {\n                    handleTaskDetailUpdate();\n                    setTaskDetailModalOpen(false);\n                    setSelectedTaskId(null);\n                    setSelectedTaskStatus(\"pending\");\n                  }}\n                  className=\"border-0 shadow-none p-0\"\n                />\n              )}\n            </div>\n          </div>\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n};\n\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\components\\Team\\TeamMembers.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchTeamData'. Either include it or remove the dependency array.","line":73,"column":6,"nodeType":"ArrayExpression","endLine":73,"endColumn":35,"suggestions":[{"desc":"Update the dependencies array to be: [user, isAdmin, isTeamLeader, fetchTeamData]","fix":{"range":[3564,3593],"text":"[user, isAdmin, isTeamLeader, fetchTeamData]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useEffect, useState, useMemo } from \"react\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { toast } from \"sonner\";\nimport { Users, FileText, Loader2, Shield, Mail, Phone, CheckCircle2, Clock, XCircle, TrendingUp, Eye, Download, Building2, UserPlus, Check, X, Calendar, Gift } from \"lucide-react\";\nimport { useAuth } from \"@/contexts/AuthContext\";\nimport { getAllUsers, UserProfile } from \"@/services/firebase/authService\";\nimport { getDepartments, Department } from \"@/services/firebase/departmentService\";\n// pdfGenerator will be dynamically imported when needed\nimport { getTasks, getTaskAssignments, Task } from \"@/services/firebase/taskService\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { formatPhoneForDisplay } from \"@/utils/phoneNormalizer\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogDescription, DialogFooter } from \"@/components/ui/dialog\";\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from \"@/components/ui/table\";\nimport { format } from \"date-fns\";\nimport { tr } from \"date-fns/locale\";\nimport { getRoles, RoleDefinition } from \"@/services/firebase/rolePermissionsService\";\nimport { approveTeamRequest, rejectTeamRequest, TeamApprovalRequest, subscribeToTeamRequests } from \"@/services/firebase/teamApprovalService\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Label } from \"@/components/ui/label\";\nimport { Timestamp } from \"firebase/firestore\";\n\ninterface TeamMembersProps {\n  departmentFilter?: string;\n}\n\nexport const TeamMembers = ({ departmentFilter: externalDepartmentFilter = \"all\" }: TeamMembersProps) => {\n  const { user, isAdmin, isTeamLeader } = useAuth();\n  const [loading, setLoading] = useState(true);\n  const [members, setMembers] = useState<UserProfile[]>([]);\n  const [departments, setDepartments] = useState<Department[]>([]);\n  const [roles, setRoles] = useState<RoleDefinition[]>([]);\n  const [generatingPdfId, setGeneratingPdfId] = useState<string | null>(null);\n  // External props varsa onlar kullan, yoksa internal state kullan\n  const departmentFilter = externalDepartmentFilter;\n  const [memberStats, setMemberStats] = useState<Record<string, {\n    total: number;\n    completed: number;\n    pending: number;\n    inProgress: number;\n  }>>({});\n  const [previewOpen, setPreviewOpen] = useState(false);\n  const [previewData, setPreviewData] = useState<{\n    member: UserProfile;\n    stats: {\n      userName: string;\n      userEmail: string;\n      total: number;\n      accepted: number;\n      rejected: number;\n      pending: number;\n      completed: number;\n      active: number;\n      assignments: Array<{\n        taskTitle: string;\n        status: string;\n        assignedAt: Date | string;\n        completedAt?: Date | string | null;\n      }>;\n    };\n  } | null>(null);\n  const [loadingPreview, setLoadingPreview] = useState(false);\n  const [pendingRequests, setPendingRequests] = useState<TeamApprovalRequest[]>([]);\n  const [loadingRequests, setLoadingRequests] = useState(false);\n  const [rejectDialogOpen, setRejectDialogOpen] = useState(false);\n  const [selectedRequest, setSelectedRequest] = useState<{ userId: string; teamId: string } | null>(null);\n  const [rejectReason, setRejectReason] = useState(\"\");\n\n  useEffect(() => {\n    fetchTeamData();\n  }, [user, isAdmin, isTeamLeader]);\n\n  // Katlm isteklerini gerek zamanl dinle\n  useEffect(() => {\n    if (!user?.id) {\n      setPendingRequests([]);\n      setLoadingRequests(false);\n      return;\n    }\n\n    setLoadingRequests(true);\n    const unsubscribe = subscribeToTeamRequests(\n      isAdmin || false,\n      isTeamLeader ? user.id : null,\n      (requests) => {\n        setPendingRequests(requests);\n        setLoadingRequests(false);\n      }\n    );\n\n    return () => {\n      unsubscribe();\n    };\n  }, [user?.id, isAdmin, isTeamLeader]);\n\n  const fetchTeamData = async () => {\n    if (!user?.id) return;\n    setLoading(true);\n    try {\n      const [allUsers, allDepts, allRoles] = await Promise.all([\n        getAllUsers(),\n        getDepartments(),\n        getRoles()\n      ]);\n      \n      setDepartments(allDepts);\n      setRoles(allRoles);\n\n      let filteredMembers: UserProfile[] = [];\n\n      if (isAdmin) {\n        // Admin herkesi grr\n        filteredMembers = allUsers;\n      } else {\n        // Ekip lideri sadece ynettii departmanlardaki yeleri grr\n        // Kullancnn ynettii tm departmanlar bul (managerId kontrol)\n        const managedDepartments = allDepts.filter(d => d.managerId === user.id);\n        \n        if (managedDepartments.length === 0) {\n          // Kullanc hibir departmann yneticisi deilse bo liste\n          filteredMembers = [];\n        } else {\n          // Kullancnn ynettii tm departman ID'lerini topla\n          const managedDeptIds = managedDepartments.map(d => d.id);\n          \n          // KRTK: approvedTeams, pendingTeams ve departmentId alanlarn kontrol et\n          filteredMembers = allUsers.filter(u => {\n            // approvedTeams kontrol - ynettii herhangi bir departmanda onaylanm ye\n            if (u.approvedTeams && u.approvedTeams.some(deptId => managedDeptIds.includes(deptId))) {\n              return true;\n            }\n            \n            // pendingTeams kontrol - ynettii herhangi bir departmanda onay bekleyen ye\n            if (u.pendingTeams && u.pendingTeams.some(deptId => managedDeptIds.includes(deptId))) {\n              return true;\n            }\n            \n            // departmentId kontrol - ynettii herhangi bir departmanda dorudan atanm ye\n            if (u.departmentId && managedDeptIds.includes(u.departmentId)) {\n              return true;\n            }\n            \n            return false;\n          });\n        }\n      }\n\n      // Kendini listeden kar (istee bal, genelde lider kendini de grmek ister ama rapor bakas iinse karlabilir)\n      // filteredMembers = filteredMembers.filter(m => m.id !== user.id);\n\n      setMembers(filteredMembers);\n\n      // Her ye iin grev istatistiklerini al\n      const statsMap: Record<string, {\n        total: number;\n        completed: number;\n        pending: number;\n        inProgress: number;\n      }> = {};\n\n      await Promise.all(\n        filteredMembers.map(async (member) => {\n          try {\n            const memberTasks = await getTasks({ assignedTo: member.id });\n            const assignments = await Promise.all(\n              memberTasks.map(async (task) => {\n                const taskAssignments = await getTaskAssignments(task.id);\n                return taskAssignments.find(a => a.assignedTo === member.id);\n              })\n            );\n\n            const completed = assignments.filter(a => a?.status === \"completed\").length;\n            const pending = assignments.filter(a => a?.status === \"pending\").length;\n            const inProgress = assignments.filter(a => a?.status === \"accepted\").length;\n\n            statsMap[member.id] = {\n              total: memberTasks.length,\n              completed,\n              pending,\n              inProgress,\n            };\n          } catch (error: unknown) {\n            if (import.meta.env.DEV) {\n              console.error(`Error fetching stats for ${member.id}:`, error);\n            }\n            statsMap[member.id] = { total: 0, completed: 0, pending: 0, inProgress: 0 };\n          }\n        })\n      );\n\n      setMemberStats(statsMap);\n    } catch (error: unknown) {\n      if (import.meta.env.DEV) {\n        console.error(\"Fetch team members error:\", error);\n      }\n      toast.error(\"Ekip yeleri yklenemedi\");\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const filteredMembers = useMemo(() => {\n    let filtered = members;\n\n    // Departman filtresi\n    if (departmentFilter !== \"all\") {\n      filtered = filtered.filter(member => {\n        // approvedTeams kontrol\n        if (member.approvedTeams?.includes(departmentFilter)) return true;\n        // pendingTeams kontrol\n        if (member.pendingTeams?.includes(departmentFilter)) return true;\n        // departmentId kontrol\n        if (member.departmentId === departmentFilter) return true;\n        return false;\n      });\n    }\n\n    return filtered;\n  }, [members, departmentFilter]);\n\n  // Ynetici iin ekiplere gre gruplandrlm yeler\n  const membersByDepartment = useMemo(() => {\n    if (!isAdmin) return null;\n    \n    const grouped: Record<string, UserProfile[]> = {};\n    \n    // Tm departmanlar iin bo array olutur\n    departments.forEach(dept => {\n      grouped[dept.id] = [];\n    });\n    \n    // \"Departman olmayan\" kategorisi\n    grouped[\"no-department\"] = [];\n    \n    filteredMembers.forEach(member => {\n      const memberDeptIds: string[] = [];\n      \n      if (member.approvedTeams && member.approvedTeams.length > 0) {\n        memberDeptIds.push(...member.approvedTeams);\n      }\n      if (member.pendingTeams && member.pendingTeams.length > 0) {\n        member.pendingTeams.forEach(id => {\n          if (!memberDeptIds.includes(id)) memberDeptIds.push(id);\n        });\n      }\n      if (member.departmentId && !memberDeptIds.includes(member.departmentId)) {\n        memberDeptIds.push(member.departmentId);\n      }\n      \n      if (memberDeptIds.length > 0) {\n        memberDeptIds.forEach(deptId => {\n          if (grouped[deptId]) {\n            // Ayn ye birden fazla departmanda olabilir, her departmanda gster\n            if (!grouped[deptId].find(m => m.id === member.id)) {\n              grouped[deptId].push(member);\n            }\n          }\n        });\n      } else {\n        grouped[\"no-department\"].push(member);\n      }\n    });\n    \n    return grouped;\n  }, [filteredMembers, departments, isAdmin]);\n\n  // Ekiplere gre gruplandrlm istekler\n  const requestsByTeam = useMemo(() => {\n    const grouped: Record<string, TeamApprovalRequest[]> = {};\n    pendingRequests.forEach(request => {\n      if (!grouped[request.teamId]) {\n        grouped[request.teamId] = [];\n      }\n      grouped[request.teamId].push(request);\n    });\n    return grouped;\n  }, [pendingRequests]);\n\n  // Dinamik rol fonksiyonlar\n  const getUserRole = (member: UserProfile): string => {\n    // nce departments tablosundaki managerId kontrol yap (ekip lideri)\n    const isTeamLeader = departments.some(dept => dept.managerId === member.id);\n    if (isTeamLeader) {\n      return \"team_leader\";\n    }\n    // Sonra role array'inden ilk rol al\n    return member.role?.[0] || \"viewer\";\n  };\n\n  const getRoleLabel = (roleKey: string): string => {\n    const roleDef = roles.find(r => r.key === roleKey);\n    return roleDef ? roleDef.label : roleKey;\n  };\n\n  const getRoleBadgeColor = (roleKey: string): string => {\n    const roleDef = roles.find(r => r.key === roleKey);\n    return roleDef ? roleDef.color.replace(\"bg-\", \"bg-\") : \"bg-gray-500\";\n  };\n\n  const isUserTeamLeader = (member: UserProfile): boolean => {\n    return departments.some(dept => dept.managerId === member.id);\n  };\n\n  const fetchUserStats = async (member: UserProfile) => {\n    try {\n      const memberTasks = await getTasks({ assignedTo: member.id });\n      \n      const taskDetails = await Promise.all(memberTasks.map(async (task) => {\n        const assignments = await getTaskAssignments(task.id);\n        const userAssignment = assignments.find(a => a.assignedTo === member.id);\n        \n        return {\n          taskTitle: task.title,\n          status: userAssignment?.status || \"pending\",\n          assignedAt: userAssignment?.assignedAt?.toDate() || task.createdAt.toDate(),\n          completedAt: userAssignment?.completedAt?.toDate() || (task.status === \"completed\" ? task.updatedAt.toDate() : null)\n        };\n      }));\n\n      return {\n        userName: member.fullName || member.email,\n        userEmail: member.email,\n        total: memberTasks.length,\n        accepted: taskDetails.filter(t => t.status === \"accepted\").length,\n        rejected: taskDetails.filter(t => t.status === \"rejected\").length,\n        pending: taskDetails.filter(t => t.status === \"pending\").length,\n        completed: taskDetails.filter(t => t.status === \"completed\").length,\n        active: taskDetails.filter(t => t.status === \"accepted\").length,\n        assignments: taskDetails\n      };\n    } catch (error: unknown) {\n      if (import.meta.env.DEV) {\n        console.error(\"Error fetching user stats:\", error);\n      }\n      throw error;\n    }\n  };\n\n  const handlePreviewReport = async (member: UserProfile) => {\n    setLoadingPreview(true);\n    try {\n      const stats = await fetchUserStats(member);\n      setPreviewData({ member, stats });\n      setPreviewOpen(true);\n    } catch (error: unknown) {\n      toast.error(\"Rapor yklenemedi: \" + (error instanceof Error ? error.message : String(error)));\n    } finally {\n      setLoadingPreview(false);\n    }\n  };\n\n  const handleDownloadReport = async (member: UserProfile) => {\n    setGeneratingPdfId(member.id);\n    try {\n      const stats = await fetchUserStats(member);\n      const { generateUserStatsPDF } = await import(\"@/services/pdfGenerator\");\n      const pdfBlob = await generateUserStatsPDF(stats);\n      const url = URL.createObjectURL(pdfBlob);\n      const a = document.createElement(\"a\");\n      a.href = url;\n      a.download = `${member.fullName || \"Kullanici\"}-Raporu.pdf`;\n      document.body.appendChild(a);\n      a.click();\n      document.body.removeChild(a);\n      URL.revokeObjectURL(url);\n      toast.success(\"Rapor indirildi\");\n    } catch (error: unknown) {\n      if (import.meta.env.DEV) {\n        console.error(\"Report generation error:\", error);\n      }\n      toast.error(\"Rapor oluturulamad: \" + (error instanceof Error ? error.message : String(error)));\n    } finally {\n      setGeneratingPdfId(null);\n    }\n  };\n\n  const handleDownloadFromPreview = async () => {\n    if (!previewData) return;\n    setGeneratingPdfId(previewData.member.id);\n    try {\n      const { generateUserStatsPDF } = await import(\"@/services/pdfGenerator\");\n      const pdfBlob = await generateUserStatsPDF(previewData.stats);\n      const url = URL.createObjectURL(pdfBlob);\n      const a = document.createElement(\"a\");\n      a.href = url;\n      a.download = `${previewData.member.fullName || \"Kullanici\"}-Raporu.pdf`;\n      document.body.appendChild(a);\n      a.click();\n      document.body.removeChild(a);\n      URL.revokeObjectURL(url);\n      toast.success(\"Rapor indirildi\");\n    } catch (error: unknown) {\n      if (import.meta.env.DEV) {\n        console.error(\"Report generation error:\", error);\n      }\n      toast.error(\"Rapor oluturulamad: \" + (error instanceof Error ? error.message : String(error)));\n    } finally {\n      setGeneratingPdfId(null);\n    }\n  };\n\n  const getDepartmentNames = (member: UserProfile) => {\n    const departmentIds: string[] = [];\n    \n    // approvedTeams kontrol\n    if (member.approvedTeams && member.approvedTeams.length > 0) {\n      departmentIds.push(...member.approvedTeams);\n    }\n    \n    // pendingTeams kontrol (onay bekleyen departmanlar da gsterilebilir)\n    if (member.pendingTeams && member.pendingTeams.length > 0) {\n      member.pendingTeams.forEach(id => {\n        if (!departmentIds.includes(id)) {\n          departmentIds.push(id);\n        }\n      });\n    }\n    \n    // departmentId kontrol (eski sistem uyumluluu iin)\n    if (member.departmentId && !departmentIds.includes(member.departmentId)) {\n      departmentIds.push(member.departmentId);\n    }\n    \n    if (departmentIds.length === 0) return \"-\";\n    \n    const departmentNames = departmentIds\n      .map(id => departments.find(d => d.id === id)?.name)\n      .filter(Boolean);\n    \n    return departmentNames.length > 0 ? departmentNames.join(\", \") : \"-\";\n  };\n\n  if (loading) {\n    return (\n      <Card>\n        <CardContent className=\"flex items-center justify-center py-8\">\n          <Loader2 className=\"h-6 w-6 animate-spin text-primary\" />\n        </CardContent>\n      </Card>\n    );\n  }\n\n  const handleApproveRequest = async (userId: string, teamId: string) => {\n    if (!user?.id) return;\n    try {\n      await approveTeamRequest(userId, teamId, user.id);\n      toast.success(\"Katlm istei onayland\");\n      // Gerek zamanl dinleme otomatik olarak gncelleyecek\n      await fetchTeamData(); // ye listesini yenile\n    } catch (error: unknown) {\n      const errorMessage = error instanceof Error ? error.message : \"Bilinmeyen hata\";\n      toast.error(\"stek onaylanamad: \" + errorMessage);\n    }\n  };\n\n  const handleRejectRequest = async () => {\n    if (!user?.id || !selectedRequest) return;\n    try {\n      await rejectTeamRequest(selectedRequest.userId, selectedRequest.teamId, rejectReason || undefined, user.id);\n      toast.success(\"Katlm istei reddedildi\");\n      setRejectDialogOpen(false);\n      setSelectedRequest(null);\n      setRejectReason(\"\");\n      // Gerek zamanl dinleme otomatik olarak gncelleyecek\n    } catch (error: unknown) {\n      const errorMessage = error instanceof Error ? error.message : \"Bilinmeyen hata\";\n      toast.error(\"stek reddedilemedi: \" + errorMessage);\n    }\n  };\n\n  // Doum gn formatla\n  const formatBirthday = (dateOfBirth: Date | Timestamp | string | null | undefined): string | null => {\n    if (!dateOfBirth) return null;\n    try {\n      let date: Date;\n      if (dateOfBirth instanceof Date) {\n        date = dateOfBirth;\n      } else if (dateOfBirth && typeof dateOfBirth === 'object' && 'toDate' in dateOfBirth) {\n        date = (dateOfBirth as Timestamp).toDate();\n      } else if (typeof dateOfBirth === 'string') {\n        date = new Date(dateOfBirth);\n      } else {\n        return null;\n      }\n      return format(date, \"dd MMMM yyyy\", { locale: tr });\n    } catch {\n      return null;\n    }\n  };\n\n  // Doum gn yaklayor mu kontrol et (30 gn iinde)\n  const isBirthdaySoon = (dateOfBirth: Date | Timestamp | string | null | undefined): boolean => {\n    if (!dateOfBirth) return false;\n    try {\n      let date: Date;\n      if (dateOfBirth instanceof Date) {\n        date = dateOfBirth;\n      } else if (dateOfBirth && typeof dateOfBirth === 'object' && 'toDate' in dateOfBirth) {\n        date = (dateOfBirth as Timestamp).toDate();\n      } else if (typeof dateOfBirth === 'string') {\n        date = new Date(dateOfBirth);\n      } else {\n        return false;\n      }\n      const today = new Date();\n      const thisYear = today.getFullYear();\n      const birthdayThisYear = new Date(thisYear, date.getMonth(), date.getDate());\n      const daysUntilBirthday = Math.ceil((birthdayThisYear.getTime() - today.getTime()) / (1000 * 60 * 60 * 24));\n      return daysUntilBirthday >= 0 && daysUntilBirthday <= 30;\n    } catch {\n      return false;\n    }\n  };\n\n  return (\n    <div className=\"space-y-1 h-full flex flex-col\">\n      {/* Katlm stekleri Blm - Sadece istek geldiinde grnr */}\n      {pendingRequests.length > 0 && (\n        <Card className=\"border-blue-200 dark:border-blue-800 bg-gradient-to-r from-blue-50/50 to-indigo-50/50 dark:from-blue-950/20 dark:to-indigo-950/20\">\n          <CardHeader>\n            <CardTitle className=\"flex items-center gap-2\">\n              <UserPlus className=\"h-5 w-5 text-blue-600 dark:text-blue-400\" />\n              Katlm stekleri\n              <Badge variant=\"secondary\" className=\"ml-auto\">{pendingRequests.length}</Badge>\n            </CardTitle>\n          </CardHeader>\n          <CardContent className=\"space-y-4\">\n            {loadingRequests ? (\n              <div className=\"flex items-center justify-center py-8\">\n                <Loader2 className=\"h-6 w-6 animate-spin text-primary\" />\n              </div>\n            ) : (\n            <>\n              {isAdmin ? (\n                  // Admin iin ekiplere gre gruplandrlm\n                  <div className=\"space-y-4\">\n                    {Object.entries(requestsByTeam).map(([teamId, requests]) => {\n                      const team = departments.find(d => d.id === teamId);\n                      return (\n                        <div key={teamId} className=\"space-y-2\">\n                          <div className=\"flex items-center gap-2 pb-2 border-b\">\n                            <Building2 className=\"h-4 w-4 text-primary\" />\n                            <h4 className=\"font-semibold\">{team?.name || \"Bilinmeyen Ekip\"}</h4>\n                            <Badge variant=\"outline\">{requests.length} istek</Badge>\n                          </div>\n                          <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3\">\n                            {requests.map((request) => (\n                              <Card key={`${request.userId}-${request.teamId}`} className=\"border-blue-200 dark:border-blue-800\">\n                                <CardContent className=\"p-4 space-y-3\">\n                                  <div className=\"flex items-center gap-3\">\n                                    <Avatar className=\"h-10 w-10\">\n                                      <AvatarFallback className=\"bg-blue-100 text-blue-700\">\n                                        {request.userName.substring(0, 2).toUpperCase()}\n                                      </AvatarFallback>\n                                    </Avatar>\n                                    <div className=\"flex-1 min-w-0\">\n                                      <p className=\"font-semibold text-sm line-clamp-1\">{request.userName}</p>\n                                      <p className=\"text-xs text-muted-foreground line-clamp-1\">{request.userEmail}</p>\n                                    </div>\n                                  </div>\n                                  <div className=\"flex gap-2\">\n                                    <Button\n                                      size=\"sm\"\n                                      className=\"flex-1 gap-2\"\n                                      onClick={() => handleApproveRequest(request.userId, request.teamId)}\n                                    >\n                                      <Check className=\"h-4 w-4\" />\n                                      Kabul Et\n                                    </Button>\n                                    <Button\n                                      size=\"sm\"\n                                      variant=\"destructive\"\n                                      className=\"flex-1 gap-2\"\n                                      onClick={() => {\n                                        setSelectedRequest({ userId: request.userId, teamId: request.teamId });\n                                        setRejectDialogOpen(true);\n                                      }}\n                                    >\n                                      <X className=\"h-4 w-4\" />\n                                      Reddet\n                                    </Button>\n                                  </div>\n                                  {request.requestedAt && (\n                                    <p className=\"text-xs text-muted-foreground text-center\">\n                                      {format(request.requestedAt.toDate(), \"dd MMMM yyyy, HH:mm\", { locale: tr })}\n                                    </p>\n                                  )}\n                                </CardContent>\n                              </Card>\n                            ))}\n                          </div>\n                        </div>\n                      );\n                    })}\n                  </div>\n                ) : (\n                  // Ekip lideri iin basit liste\n                  <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3\">\n                    {pendingRequests.map((request) => (\n                      <Card key={`${request.userId}-${request.teamId}`} className=\"border-blue-200 dark:border-blue-800\">\n                        <CardContent className=\"p-4 space-y-3\">\n                          <div className=\"flex items-center gap-3\">\n                            <Avatar className=\"h-10 w-10\">\n                              <AvatarFallback className=\"bg-blue-100 text-blue-700\">\n                                {request.userName.substring(0, 2).toUpperCase()}\n                              </AvatarFallback>\n                            </Avatar>\n                            <div className=\"flex-1 min-w-0\">\n                              <p className=\"font-semibold text-sm line-clamp-1\">{request.userName}</p>\n                              <p className=\"text-xs text-muted-foreground line-clamp-1\">{request.userEmail}</p>\n                              <p className=\"text-xs text-blue-600 dark:text-blue-400 mt-1\">{request.teamName}</p>\n                            </div>\n                          </div>\n                          <div className=\"flex gap-2\">\n                            <Button\n                              size=\"sm\"\n                              className=\"flex-1 gap-2\"\n                              onClick={() => handleApproveRequest(request.userId, request.teamId)}\n                            >\n                              <Check className=\"h-4 w-4\" />\n                              Kabul Et\n                            </Button>\n                            <Button\n                              size=\"sm\"\n                              variant=\"destructive\"\n                              className=\"flex-1 gap-2\"\n                              onClick={() => {\n                                setSelectedRequest({ userId: request.userId, teamId: request.teamId });\n                                setRejectDialogOpen(true);\n                              }}\n                            >\n                              <X className=\"h-4 w-4\" />\n                              Reddet\n                            </Button>\n                          </div>\n                          {request.requestedAt && (\n                            <p className=\"text-xs text-muted-foreground text-center\">\n                              {format(request.requestedAt.toDate(), \"dd MMMM yyyy, HH:mm\", { locale: tr })}\n                            </p>\n                          )}\n                        </CardContent>\n                      </Card>\n                    ))}\n                  </div>\n                )}\n              </>\n            )}\n          </CardContent>\n        </Card>\n      )}\n\n    <Card>\n        <CardContent className=\"pt-6 space-y-4\">\n\n          {filteredMembers.length === 0 ? (\n            <div className=\"text-center py-12 text-muted-foreground\">\n              <Users className=\"h-12 w-12 mx-auto mb-3 opacity-20\" />\n              <p>{departmentFilter !== \"all\" ? \"Filtre kriterlerinize uygun ye bulunamad.\" : \"Ekibinizde ye bulunmuyor.\"}</p>\n          </div>\n        ) : isAdmin && membersByDepartment ? (\n          // Ynetici iin ekiplere gre kategorik gsterim\n          <div className=\"space-y-6\">\n            {Object.entries(membersByDepartment).map(([deptId, deptMembers]) => {\n              if (deptMembers.length === 0) return null;\n              \n              const dept = departments.find(d => d.id === deptId);\n              const deptName = dept ? dept.name : (deptId === \"no-department\" ? \"Departman Olmayan yeler\" : \"Bilinmeyen Departman\");\n              \n              return (\n                <div key={deptId} className=\"space-y-3\">\n                  <div className=\"flex items-center gap-2 pb-2 border-b\">\n                    <Building2 className=\"h-5 w-5 text-primary\" />\n                    <h3 className=\"text-lg font-semibold\">{deptName}</h3>\n                    <Badge variant=\"secondary\" className=\"ml-auto\">{deptMembers.length} ye</Badge>\n                  </div>\n                  <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4 min-w-0\">\n                    {deptMembers.map((member) => {\n                      const stats = memberStats[member.id] || { total: 0, completed: 0, pending: 0, inProgress: 0 };\n                      \n                      return (\n                        <Card\n                          key={member.id}\n                          className=\"hover:shadow-md transition-shadow h-full flex flex-col min-w-0 overflow-hidden\"\n                        >\n                          <CardContent className=\"p-4 space-y-4 flex flex-col h-full min-w-0\">\n                            {/* Kullanc Bilgileri */}\n                            <div className=\"flex items-start gap-3 min-w-0\">\n                              <Avatar className=\"h-14 w-14 flex-shrink-0\">\n                                <AvatarImage src={undefined} />\n                                <AvatarFallback className=\"bg-primary/10 text-primary\">\n                                  {member.fullName ? member.fullName.substring(0, 2).toUpperCase() : \"U\"}\n                                </AvatarFallback>\n                              </Avatar>\n                              <div className=\"flex-1 min-w-0\">\n                                <div className=\"flex items-center gap-2 min-w-0 mb-1\">\n                                  <p className=\"font-semibold text-base truncate\">{member.fullName || \"simsiz\"}</p>\n                                  {(member.role?.includes(\"super_admin\") || member.role?.includes(\"main_admin\") || isUserTeamLeader(member)) && (\n                                    <Shield className=\"h-4 w-4 text-primary flex-shrink-0\" />\n                                  )}\n                                </div>\n                                <p className=\"text-sm text-muted-foreground truncate\">{member.email}</p>\n                                {member.phone && (\n                                  <p className=\"text-xs text-muted-foreground truncate mt-1\">\n                                    {formatPhoneForDisplay(member.phone)}\n                                  </p>\n                                )}\n                              </div>\n                            </div>\n\n                            {/* Grev statistikleri */}\n                            <div className=\"space-y-2 pt-3 border-t\">\n                              <div className=\"flex items-center justify-between text-sm\">\n                                <span className=\"text-muted-foreground\">Toplam Grev</span>\n                                <span className=\"font-semibold\">{stats.total}</span>\n                              </div>\n                              <div className=\"grid grid-cols-3 gap-2\">\n                                <div className=\"flex flex-col items-center p-3 bg-green-50 rounded-lg\">\n                                  <CheckCircle2 className=\"h-5 w-5 text-green-600 mb-1.5\" />\n                                  <span className=\"text-base font-bold text-green-700\">{stats.completed}</span>\n                                  <span className=\"text-xs text-green-600 mt-0.5\">Tamamland</span>\n                                </div>\n                                <div className=\"flex flex-col items-center p-3 bg-blue-50 rounded-lg\">\n                                  <TrendingUp className=\"h-5 w-5 text-blue-600 mb-1.5\" />\n                                  <span className=\"text-base font-bold text-blue-700\">{stats.inProgress}</span>\n                                  <span className=\"text-xs text-blue-600 mt-0.5\">Devam Ediyor</span>\n                                </div>\n                                <div className=\"flex flex-col items-center p-3 bg-yellow-50 rounded-lg\">\n                                  <Clock className=\"h-5 w-5 text-yellow-600 mb-1.5\" />\n                                  <span className=\"text-base font-bold text-yellow-700\">{stats.pending}</span>\n                                  <span className=\"text-xs text-yellow-600 mt-0.5\">Bekliyor</span>\n                                </div>\n                              </div>\n                            </div>\n\n                            {/* Bilgiler */}\n                            <div className=\"space-y-2 pt-3 border-t\">\n                              <div className=\"flex items-center justify-between text-sm\">\n                                <span className=\"text-muted-foreground\">Departman</span>\n                                <span className=\"font-medium text-right truncate flex-1 ml-2\">{getDepartmentNames(member)}</span>\n                              </div>\n                              <div className=\"flex items-center justify-between text-sm\">\n                                <span className=\"text-muted-foreground\">Rol</span>\n                                <Badge className={`${getRoleBadgeColor(getUserRole(member))} text-white text-xs px-2 py-0.5`}>\n                                  {getRoleLabel(getUserRole(member))}\n                                </Badge>\n                              </div>\n                            </div>\n\n                            {/* letiim Butonlar */}\n                            <div className=\"flex gap-2 pt-2\">\n                              {member.email && (\n                                <Button\n                                  variant=\"outline\"\n                                  size=\"sm\"\n                                  className=\"flex-1 gap-2\"\n                                  onClick={() => window.location.href = `mailto:${member.email}`}\n                                >\n                                  <Mail className=\"h-4 w-4\" />\n                                  Mail\n                                </Button>\n                              )}\n                              {member.phone && (\n                                <Button\n                                  variant=\"outline\"\n                                  size=\"sm\"\n                                  className=\"flex-1 gap-2\"\n                                  onClick={() => window.location.href = `tel:${member.phone}`}\n                                >\n                                  <Phone className=\"h-4 w-4\" />\n                                  Ara\n                                </Button>\n                              )}\n                            </div>\n                          </CardContent>\n                        </Card>\n                      );\n                    })}\n                  </div>\n                </div>\n              );\n            })}\n          </div>\n        ) : (\n          // Ekip lideri iin normal liste gsterimi\n          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n              {filteredMembers.map((member) => {\n                const stats = memberStats[member.id] || { total: 0, completed: 0, pending: 0, inProgress: 0 };\n                \n                return (\n                  <Card\n                key={member.id}\n                    className=\"hover:shadow-md transition-shadow h-full flex flex-col overflow-hidden\"\n              >\n                    <CardContent className=\"p-4 space-y-4 flex flex-col h-full min-w-0\">\n                <div className=\"flex items-start gap-3 min-w-0\">\n                        <Avatar className=\"h-14 w-14 flex-shrink-0\">\n                      <AvatarImage src={undefined} />\n                            <AvatarFallback className=\"bg-primary/10 text-primary\">\n                              {member.fullName ? member.fullName.substring(0, 2).toUpperCase() : \"U\"}\n                            </AvatarFallback>\n                    </Avatar>\n                          <div className=\"flex-1 min-w-0\">\n                            <div className=\"flex items-center gap-2 min-w-0 mb-1\">\n                      <p className=\"font-semibold text-base truncate\">{member.fullName || \"simsiz\"}</p>\n                              {(member.role?.includes(\"super_admin\") || member.role?.includes(\"main_admin\") || isUserTeamLeader(member)) && (\n                                <Shield className=\"h-4 w-4 text-primary flex-shrink-0\" />\n                              )}\n                            </div>\n                      <p className=\"text-sm text-muted-foreground truncate\">{member.email}</p>\n                            {member.phone && (\n                              <p className=\"text-xs text-muted-foreground truncate mt-1\">\n                                {formatPhoneForDisplay(member.phone)}\n                              </p>\n                            )}\n                          </div>\n                  </div>\n\n                      {/* Grev statistikleri */}\n                      <div className=\"space-y-2 pt-3\">\n                        <div className=\"flex items-center justify-between text-sm\">\n                          <span className=\"text-muted-foreground\">Toplam Grev</span>\n                          <span className=\"font-semibold\">{stats.total}</span>\n                        </div>\n                        <div className=\"grid grid-cols-3 gap-2\">\n                          <div className=\"flex flex-col items-center p-3 bg-green-50 rounded-lg\">\n                            <CheckCircle2 className=\"h-5 w-5 text-green-600 mb-1.5\" />\n                            <span className=\"text-base font-bold text-green-700\">{stats.completed}</span>\n                            <span className=\"text-xs text-green-600 mt-0.5\">Tamamland</span>\n                          </div>\n                          <div className=\"flex flex-col items-center p-3 bg-blue-50 rounded-lg\">\n                            <TrendingUp className=\"h-5 w-5 text-blue-600 mb-1.5\" />\n                            <span className=\"text-base font-bold text-blue-700\">{stats.inProgress}</span>\n                            <span className=\"text-xs text-blue-600 mt-0.5\">Devam Ediyor</span>\n                          </div>\n                          <div className=\"flex flex-col items-center p-3 bg-yellow-50 rounded-lg\">\n                            <Clock className=\"h-5 w-5 text-yellow-600 mb-1.5\" />\n                            <span className=\"text-base font-bold text-yellow-700\">{stats.pending}</span>\n                            <span className=\"text-xs text-yellow-600 mt-0.5\">Bekliyor</span>\n                          </div>\n                        </div>\n                      </div>\n\n                      {/* Bilgiler */}\n                      <div className=\"space-y-2 pt-3\">\n                  <div className=\"flex items-center justify-between text-sm\">\n                    <span className=\"text-muted-foreground\">Departman</span>\n                    <span className=\"font-medium text-right truncate flex-1 ml-2\">{getDepartmentNames(member)}</span>\n                  </div>\n                  <div className=\"flex items-center justify-between text-sm\">\n                    <span className=\"text-muted-foreground\">Rol</span>\n                    <Badge className={`${getRoleBadgeColor(getUserRole(member))} text-white text-xs px-2 py-0.5`}>\n                      {getRoleLabel(getUserRole(member))}\n                    </Badge>\n                  </div>\n                </div>\n\n                      {/* letiim Butonlar */}\n                      <div className=\"flex gap-2 pt-2\">\n                        {member.email && (\n                          <Button\n                            variant=\"outline\"\n                            size=\"sm\"\n                            className=\"flex-1 gap-2\"\n                            onClick={() => window.location.href = `mailto:${member.email}`}\n                          >\n                            <Mail className=\"h-4 w-4\" />\n                            Mail\n                          </Button>\n                        )}\n                        {member.phone && (\n                          <Button\n                            variant=\"outline\"\n                            size=\"sm\"\n                            className=\"flex-1 gap-2\"\n                            onClick={() => window.location.href = `tel:${member.phone}`}\n                          >\n                            <Phone className=\"h-4 w-4\" />\n                            Ara\n                          </Button>\n                        )}\n                      </div>\n                    </CardContent>\n                  </Card>\n                );\n              })}\n          </div>\n        )}\n      </CardContent>\n    </Card>\n\n      {/* Rapor nizleme Modal */}\n      <Dialog open={previewOpen} onOpenChange={setPreviewOpen}>\n        <DialogContent className=\"w-full max-w-[80vw] md:max-w-6xl max-h-[95vh] flex flex-col p-0 overflow-hidden\">\n          <DialogTitle className=\"sr-only\">Kullanc Raporu nizleme</DialogTitle>\n          <DialogDescription className=\"sr-only\">Kullanc istatistikleri ve grev detaylar</DialogDescription>\n          <DialogHeader className=\"flex-shrink-0 px-6 pt-6 pb-4 border-b\">\n            <h2 className=\"flex items-center gap-2\">\n              <FileText className=\"h-5 w-5\" />\n              Kullanc Performans Raporu - {previewData?.member.fullName || previewData?.member.email}\n            </h2>\n            <p>\n              {previewData?.member.email} - {new Date().toLocaleDateString(\"tr-TR\", { day: \"2-digit\", month: \"long\", year: \"numeric\" })}\n            </p>\n          </DialogHeader>\n\n          {previewData && (\n            <div className=\"flex-1 overflow-y-auto px-6 py-4 space-y-6 min-h-0 overscroll-contain\">\n              {/* statistik Kartlar */}\n              <div className=\"grid grid-cols-1 sm:grid-cols-3 gap-4\">\n                <Card className=\"bg-gradient-to-br from-blue-50 to-blue-100/50 border-blue-200\">\n                  <CardContent className=\"p-4\">\n                    <div className=\"flex items-center justify-between\">\n                      <div>\n                        <p className=\"text-sm font-medium text-blue-700\">Toplam Grev</p>\n                        <p className=\"text-2xl font-bold text-blue-900 mt-1\">{previewData.stats.total}</p>\n                      </div>\n                      <FileText className=\"h-8 w-8 text-blue-600\" />\n                    </div>\n                  </CardContent>\n                </Card>\n\n                <Card className=\"bg-gradient-to-br from-green-50 to-green-100/50 border-green-200\">\n                  <CardContent className=\"p-4\">\n                    <div className=\"flex items-center justify-between\">\n                      <div>\n                        <p className=\"text-sm font-medium text-green-700\">Tamamlanan</p>\n                        <p className=\"text-2xl font-bold text-green-900 mt-1\">{previewData.stats.completed}</p>\n                        <p className=\"text-xs text-green-600 mt-1\">\n                          {previewData.stats.total > 0 \n                            ? `%${Math.round((previewData.stats.completed / previewData.stats.total) * 100)}`\n                            : \"%0\"}\n                        </p>\n                      </div>\n                      <CheckCircle2 className=\"h-8 w-8 text-green-600\" />\n                    </div>\n                  </CardContent>\n                </Card>\n\n                <Card className=\"bg-gradient-to-br from-yellow-50 to-yellow-100/50 border-yellow-200\">\n                  <CardContent className=\"p-4\">\n                    <div className=\"flex items-center justify-between\">\n                      <div>\n                        <p className=\"text-sm font-medium text-yellow-700\">Aktif Grevler</p>\n                        <p className=\"text-2xl font-bold text-yellow-900 mt-1\">{previewData.stats.active}</p>\n                      </div>\n                      <TrendingUp className=\"h-8 w-8 text-yellow-600\" />\n                    </div>\n                  </CardContent>\n                </Card>\n              </div>\n\n              {/* Detayl statistikler */}\n              <Card>\n                <CardHeader>\n                  <CardTitle>Detayl statistikler</CardTitle>\n                </CardHeader>\n                <CardContent>\n                  <Table>\n                    <TableHeader>\n                      <TableRow>\n                        <TableHead>Metrik</TableHead>\n                        <TableHead className=\"text-center\">Deer</TableHead>\n                        <TableHead className=\"text-center\">Oran</TableHead>\n                      </TableRow>\n                    </TableHeader>\n                    <TableBody>\n                      <TableRow>\n                        <TableCell className=\"font-medium\">Toplam Grev</TableCell>\n                        <TableCell className=\"text-center\">{previewData.stats.total}</TableCell>\n                        <TableCell className=\"text-center\">%100</TableCell>\n                      </TableRow>\n                      <TableRow>\n                        <TableCell className=\"font-medium\">Tamamlanan</TableCell>\n                        <TableCell className=\"text-center\">{previewData.stats.completed}</TableCell>\n                        <TableCell className=\"text-center\">\n                          {previewData.stats.total > 0 \n                            ? `%${Math.round((previewData.stats.completed / previewData.stats.total) * 100)}`\n                            : \"%0\"}\n                        </TableCell>\n                      </TableRow>\n                      <TableRow>\n                        <TableCell className=\"font-medium\">Kabul Edilen</TableCell>\n                        <TableCell className=\"text-center\">{previewData.stats.accepted}</TableCell>\n                        <TableCell className=\"text-center\">\n                          {previewData.stats.total > 0 \n                            ? `%${Math.round((previewData.stats.accepted / previewData.stats.total) * 100)}`\n                            : \"%0\"}\n                        </TableCell>\n                      </TableRow>\n                      <TableRow>\n                        <TableCell className=\"font-medium\">Beklemede</TableCell>\n                        <TableCell className=\"text-center\">{previewData.stats.pending}</TableCell>\n                        <TableCell className=\"text-center\">\n                          {previewData.stats.total > 0 \n                            ? `%${Math.round((previewData.stats.pending / previewData.stats.total) * 100)}`\n                            : \"%0\"}\n                        </TableCell>\n                      </TableRow>\n                      <TableRow>\n                        <TableCell className=\"font-medium\">Reddedilen</TableCell>\n                        <TableCell className=\"text-center\">{previewData.stats.rejected}</TableCell>\n                        <TableCell className=\"text-center\">\n                          {previewData.stats.total > 0 \n                            ? `%${Math.round((previewData.stats.rejected / previewData.stats.total) * 100)}`\n                            : \"%0\"}\n                        </TableCell>\n                      </TableRow>\n                      <TableRow>\n                        <TableCell className=\"font-medium\">Aktif Grevler</TableCell>\n                        <TableCell className=\"text-center\">{previewData.stats.active}</TableCell>\n                        <TableCell className=\"text-center\">\n                          {previewData.stats.total > 0 \n                            ? `%${Math.round((previewData.stats.active / previewData.stats.total) * 100)}`\n                            : \"%0\"}\n                        </TableCell>\n                      </TableRow>\n                    </TableBody>\n                  </Table>\n                </CardContent>\n              </Card>\n\n              {/* Grev Detaylar */}\n              {previewData.stats.assignments.length > 0 && (\n                <Card>\n                  <CardHeader>\n                    <CardTitle>Grev Detaylar</CardTitle>\n                  </CardHeader>\n                  <CardContent>\n                    <div className=\"overflow-x-auto\">\n                      <Table>\n                        <TableHeader>\n                          <TableRow>\n                            <TableHead>Grev Bal</TableHead>\n                            <TableHead className=\"text-center\">Durum</TableHead>\n                            <TableHead className=\"text-center\">Atanma Tarihi</TableHead>\n                            <TableHead className=\"text-center\">Tamamlanma Tarihi</TableHead>\n                          </TableRow>\n                        </TableHeader>\n                        <TableBody>\n                          {previewData.stats.assignments.map((assignment, index) => {\n                            const statusLabels: Record<string, string> = {\n                              \"pending\": \"Beklemede\",\n                              \"accepted\": \"Kabul Edildi\",\n                              \"rejected\": \"Reddedildi\",\n                              \"completed\": \"Tamamland\",\n                              \"in_progress\": \"Devam Ediyor\",\n                            };\n\n                            const assignedDate = assignment.assignedAt instanceof Date\n                              ? assignment.assignedAt\n                              : new Date(assignment.assignedAt);\n                            const completedDate = assignment.completedAt\n                              ? (assignment.completedAt instanceof Date\n                                ? assignment.completedAt\n                                : new Date(assignment.completedAt))\n                              : null;\n\n                            return (\n                              <TableRow key={index}>\n                                <TableCell className=\"font-medium\">{assignment.taskTitle}</TableCell>\n                                <TableCell className=\"text-center\">\n                                  <Badge \n                                    variant={\n                                      assignment.status === \"completed\" ? \"default\" :\n                                      assignment.status === \"accepted\" || assignment.status === \"in_progress\" ? \"secondary\" :\n                                      assignment.status === \"rejected\" ? \"destructive\" : \"outline\"\n                                    }\n                                  >\n                                    {statusLabels[assignment.status] || assignment.status}\n                                  </Badge>\n                                </TableCell>\n                                <TableCell className=\"text-center\">\n                                  {format(assignedDate, \"dd.MM.yyyy\", { locale: tr })}\n                                </TableCell>\n                                <TableCell className=\"text-center\">\n                                  {completedDate ? format(completedDate, \"dd.MM.yyyy\", { locale: tr }) : \"-\"}\n                                </TableCell>\n                              </TableRow>\n                            );\n                          })}\n                        </TableBody>\n                      </Table>\n                    </div>\n                  </CardContent>\n                </Card>\n              )}\n\n              {/* zet */}\n              <Card className=\"bg-gradient-to-r from-primary/10 to-primary/5 border-primary/20\">\n                <CardContent className=\"p-4\">\n                  <p className=\"text-sm text-muted-foreground\">\n                    <strong>{previewData.stats.userName}</strong> kullancs toplam{\" \"}\n                    <strong>{previewData.stats.total}</strong> grev alm,{\" \"}\n                    <strong>{previewData.stats.completed}</strong> grevi tamamlamtr.{\" \"}\n                    Tamamlanma oran:{\" \"}\n                    <strong>\n                      %{previewData.stats.total > 0 \n                        ? Math.round((previewData.stats.completed / previewData.stats.total) * 100)\n                        : 0}\n                    </strong>\n                  </p>\n                </CardContent>\n              </Card>\n            </div>\n          )}\n\n          <DialogFooter>\n            <Button variant=\"outline\" onClick={() => setPreviewOpen(false)}>\n              Kapat\n            </Button>\n            <Button \n              onClick={handleDownloadFromPreview}\n              disabled={!previewData || generatingPdfId === previewData?.member.id}\n            >\n              {generatingPdfId === previewData?.member.id ? (\n                <>\n                  <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />\n                  ndiriliyor...\n                </>\n              ) : (\n                <>\n                  <Download className=\"h-4 w-4 mr-2\" />\n                  PDF ndir\n                </>\n              )}\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n\n      {/* Reddetme Dialog */}\n      <Dialog open={rejectDialogOpen} onOpenChange={setRejectDialogOpen}>\n        <DialogContent>\n          <DialogHeader>\n            <DialogTitle>Katlm steini Reddet</DialogTitle>\n            <DialogDescription>\n              Bu katlm isteini reddetmek istediinize emin misiniz? stei reddetmek iin bir sebep belirtebilirsiniz (istee bal).\n            </DialogDescription>\n          </DialogHeader>\n          <div className=\"space-y-4 py-4\">\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"rejectReason\">Red Sebebi (stee Bal)</Label>\n              <Textarea\n                id=\"rejectReason\"\n                placeholder=\"Red sebebini buraya yazabilirsiniz...\"\n                value={rejectReason}\n                onChange={(e) => setRejectReason(e.target.value)}\n                rows={3}\n              />\n            </div>\n          </div>\n          <DialogFooter>\n            <Button variant=\"outline\" onClick={() => {\n              setRejectDialogOpen(false);\n              setSelectedRequest(null);\n              setRejectReason(\"\");\n            }}>\n              ptal\n            </Button>\n            <Button variant=\"destructive\" onClick={handleRejectRequest}>\n              Reddet\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n};\n\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\components\\Team\\TeamStatsView.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\components\\shared\\ActivityCommentsPanel.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":29,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":29,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[880,883],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[880,883],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchData'. Either include it or remove the dependency array.","line":108,"column":6,"nodeType":"ArrayExpression","endLine":108,"endColumn":24,"suggestions":[{"desc":"Update the dependencies array to be: [isOpen, entityId, fetchData]","fix":{"range":[2910,2928],"text":"[isOpen, entityId, fetchData]"}}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect, useRef } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Avatar, AvatarFallback } from \"@/components/ui/avatar\";\nimport { ChevronLeft, ChevronRight, Send, Loader2, MessageSquare } from \"lucide-react\";\nimport { toast } from \"sonner\";\nimport { format } from \"date-fns\";\nimport { tr } from \"date-fns/locale\";\nimport { Timestamp } from \"firebase/firestore\";\nimport { cn } from \"@/lib/utils\";\n\nexport interface Comment {\n  id: string;\n  userId: string;\n  userName?: string;\n  userEmail?: string;\n  content: string;\n  createdAt: Timestamp | Date | string;\n  updatedAt?: Timestamp | Date | string | null;\n}\n\nexport interface Activity {\n  id: string;\n  userId: string;\n  userName?: string;\n  userEmail?: string;\n  action: string;\n  description: string;\n  metadata?: Record<string, any>;\n  createdAt: Timestamp | Date | string;\n}\n\ninterface ActivityCommentsPanelProps {\n  entityId: string;\n  entityType: \"order\" | \"product\" | \"customer\" | \"material\" | \"task\" | \"warranty\";\n  onAddComment: (content: string) => Promise<void>;\n  onGetComments: () => Promise<Comment[]>;\n  onGetActivities: () => Promise<Activity[]>;\n  currentUserId?: string;\n  currentUserName?: string;\n  currentUserEmail?: string;\n}\n\nconst getInitials = (name?: string, email?: string): string => {\n  if (name) {\n    return name\n      .split(\" \")\n      .map((n) => n[0])\n      .join(\"\")\n      .toUpperCase()\n      .slice(0, 2);\n  }\n  if (email) {\n    return email[0].toUpperCase();\n  }\n  return \"?\";\n};\n\nconst getUserDisplayName = (userName?: string, userEmail?: string): string => {\n  return userName || userEmail || \"Bilinmeyen Kullanc\";\n};\n\nconst formatActivityDate = (date: Timestamp | Date | string): string => {\n  try {\n    let dateObj: Date;\n    if (date instanceof Timestamp) {\n      dateObj = date.toDate();\n    } else if (date instanceof Date) {\n      dateObj = date;\n    } else if (typeof date === \"string\") {\n      dateObj = new Date(date);\n    } else {\n      return \"-\";\n    }\n    \n    if (isNaN(dateObj.getTime())) {\n      return \"-\";\n    }\n    \n    return format(dateObj, \"d MMM yyyy HH:mm\", { locale: tr });\n  } catch {\n    return \"-\";\n  }\n};\n\nexport const ActivityCommentsPanel = ({\n  entityId,\n  entityType,\n  onAddComment,\n  onGetComments,\n  onGetActivities,\n  currentUserId,\n  currentUserName,\n  currentUserEmail,\n}: ActivityCommentsPanelProps) => {\n  const [isOpen, setIsOpen] = useState(false);\n  const [comments, setComments] = useState<Comment[]>([]);\n  const [activities, setActivities] = useState<Activity[]>([]);\n  const [commentInput, setCommentInput] = useState(\"\");\n  const [sendingComment, setSendingComment] = useState(false);\n  const [loading, setLoading] = useState(false);\n  const commentsEndRef = useRef<HTMLDivElement>(null);\n\n  useEffect(() => {\n    if (isOpen && entityId) {\n      fetchData();\n    }\n  }, [isOpen, entityId]);\n\n  const fetchData = async () => {\n    setLoading(true);\n    try {\n      const [commentsData, activitiesData] = await Promise.all([\n        onGetComments().catch(() => []),\n        onGetActivities().catch(() => []),\n      ]);\n      setComments(commentsData);\n      setActivities(activitiesData);\n    } catch (error: unknown) {\n      if (import.meta.env.DEV) {\n        console.error(\"Fetch data error:\", error);\n      }\n      toast.error(\"Veriler yklenirken hata olutu\");\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleSendComment = async () => {\n    if (!commentInput.trim() || !currentUserId) {\n      toast.error(\"Yorum bo olamaz\");\n      return;\n    }\n\n    setSendingComment(true);\n    try {\n      await onAddComment(commentInput.trim());\n      setCommentInput(\"\");\n      await fetchData();\n      toast.success(\"Yorum eklendi\");\n      // Scroll to bottom\n      setTimeout(() => {\n        commentsEndRef.current?.scrollIntoView({ behavior: \"smooth\" });\n      }, 100);\n    } catch (error: unknown) {\n      if (import.meta.env.DEV) {\n        console.error(\"Send comment error:\", error);\n      }\n      const errorMessage = error instanceof Error ? error.message : \"Bilinmeyen hata\";\n      toast.error(errorMessage || \"Yorum eklenemedi\");\n    } finally {\n      setSendingComment(false);\n    }\n  };\n\n  // Birletirilmi aktivite ve yorum listesi (tarihe gre sral)\n  const combinedItems = [...activities, ...comments].sort((a, b) => {\n    const aDate = a.createdAt instanceof Timestamp \n      ? a.createdAt.toDate() \n      : a.createdAt instanceof Date \n        ? a.createdAt \n        : new Date(a.createdAt);\n    const bDate = b.createdAt instanceof Timestamp \n      ? b.createdAt.toDate() \n      : b.createdAt instanceof Date \n        ? b.createdAt \n        : new Date(b.createdAt);\n    return bDate.getTime() - aDate.getTime();\n  });\n\n  return (\n    <>\n      {/* Chevron Toggle Button */}\n      <Button\n        variant=\"ghost\"\n        size=\"icon\"\n        className={cn(\n          \"fixed right-0 top-1/2 -translate-y-1/2 z-50 h-12 w-8 rounded-l-lg rounded-r-none border-r-0 shadow-lg\",\n          \"bg-background hover:bg-muted transition-all duration-300\",\n          isOpen && \"right-[320px] sm:right-[400px]\"\n        )}\n        onClick={() => setIsOpen(!isOpen)}\n        aria-label={isOpen ? \"Paneli kapat\" : \"Paneli a\"}\n      >\n        {isOpen ? (\n          <ChevronRight className=\"h-5 w-5\" />\n        ) : (\n          <ChevronLeft className=\"h-5 w-5\" />\n        )}\n      </Button>\n\n      {/* Panel */}\n      {isOpen && (\n        <div\n          className={cn(\n            \"fixed right-0 top-0 h-full w-[320px] sm:w-[400px] bg-background border-l shadow-xl z-40\",\n            \"flex flex-col transition-all duration-300 ease-in-out\"\n          )}\n        >\n          {/* Header */}\n          <div className=\"p-4 border-b flex items-center justify-between bg-muted/30\">\n            <div className=\"flex items-center gap-2\">\n              <MessageSquare className=\"h-4 w-4 text-primary\" />\n              <h3 className=\"font-semibold text-sm\">Yorumlar ve Etkinlik</h3>\n            </div>\n          </div>\n\n          {/* Content */}\n          <div className=\"flex-1 overflow-y-auto p-4 space-y-4\">\n            {loading ? (\n              <div className=\"flex items-center justify-center py-8\">\n                <Loader2 className=\"h-6 w-6 animate-spin text-muted-foreground\" />\n              </div>\n            ) : combinedItems.length === 0 ? (\n              <div className=\"text-center py-8 text-muted-foreground text-sm\">\n                <MessageSquare className=\"h-8 w-8 mx-auto mb-2 opacity-50\" />\n                <p>Henz aktivite veya yorum yok</p>\n              </div>\n            ) : (\n              <div className=\"space-y-4\">\n                {combinedItems.map((item) => {\n                  const isComment = \"content\" in item;\n                  const itemWithUser = item as Comment | Activity;\n                  const userName = getUserDisplayName(\n                    itemWithUser.userName,\n                    itemWithUser.userEmail\n                  );\n                  const initials = getInitials(\n                    itemWithUser.userName,\n                    itemWithUser.userEmail\n                  );\n                  const date = formatActivityDate(item.createdAt);\n\n                  return (\n                    <div key={item.id} className=\"flex gap-3\">\n                      <Avatar className=\"h-8 w-8 flex-shrink-0\">\n                        <AvatarFallback className=\"text-xs bg-primary/10 text-primary\">\n                          {initials}\n                        </AvatarFallback>\n                      </Avatar>\n                      <div className=\"flex-1 min-w-0\">\n                        <div className=\"flex items-center gap-2 mb-1\">\n                          <span className=\"font-medium text-sm text-foreground\">\n                            {userName}\n                          </span>\n                          <span className=\"text-xs text-muted-foreground\">\n                            {date}\n                          </span>\n                        </div>\n                        {isComment ? (\n                          <div className=\"bg-muted/50 rounded-lg p-2.5 text-sm text-foreground\">\n                            {(item as Comment).content}\n                          </div>\n                        ) : (\n                          <div className=\"text-sm text-muted-foreground\">\n                            {(item as Activity).description}\n                          </div>\n                        )}\n                      </div>\n                    </div>\n                  );\n                })}\n                <div ref={commentsEndRef} />\n              </div>\n            )}\n          </div>\n\n          {/* Comment Input */}\n          <div className=\"p-4 border-t bg-muted/30\">\n            <div className=\"space-y-2\">\n              <Textarea\n                placeholder=\"Yorum yaz...\"\n                value={commentInput}\n                onChange={(e) => setCommentInput(e.target.value)}\n                onKeyDown={(e) => {\n                  if (e.key === \"Enter\" && (e.metaKey || e.ctrlKey)) {\n                    e.preventDefault();\n                    handleSendComment();\n                  }\n                }}\n                className=\"min-h-[80px] resize-none text-sm\"\n                disabled={sendingComment || !currentUserId}\n              />\n              <Button\n                onClick={handleSendComment}\n                disabled={sendingComment || !commentInput.trim() || !currentUserId}\n                size=\"sm\"\n                className=\"w-full\"\n              >\n                {sendingComment ? (\n                  <>\n                    <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />\n                    Gnderiliyor...\n                  </>\n                ) : (\n                  <>\n                    <Send className=\"h-4 w-4 mr-2\" />\n                    Gnder\n                  </>\n                )}\n              </Button>\n            </div>\n          </div>\n        </div>\n      )}\n    </>\n  );\n};\n\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\components\\shared\\ResponsiveTable.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":7,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":7,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[354,357],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[354,357],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":20,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":20,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[816,819],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[816,819],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":32,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":32,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1167,1170],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1167,1170],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":176,"column":86,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":176,"endColumn":89,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5962,5965],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5962,5965],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { ReactNode, useState, useEffect, useMemo } from \"react\";\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from \"@/components/ui/table\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { useIsMobile } from \"@/hooks/use-mobile\";\nimport { cn } from \"@/lib/utils\";\n\nexport interface ResponsiveTableColumn<T = any> {\n  key: string;\n  header: string | ReactNode;\n  accessor?: (row: T) => ReactNode;\n  className?: string;\n  headerClassName?: string;\n  cellClassName?: string;\n  hideOnMobile?: boolean;\n  priority?: \"high\" | \"medium\" | \"low\"; // ncelik: high = her zaman gster, medium = tablet+ gster, low = desktop+ gster\n  minWidth?: number; // Minimum genilik (px)\n  sticky?: boolean; // Sticky column (solda sabit kalr)\n}\n\nexport interface ResponsiveTableProps<T = any> {\n  data: T[];\n  columns: ResponsiveTableColumn<T>[];\n  renderCard?: (row: T, index: number) => ReactNode;\n  emptyMessage?: string;\n  className?: string;\n  tableClassName?: string;\n  cardClassName?: string;\n  onRowClick?: (row: T, index: number) => void;\n  keyExtractor?: (row: T, index: number) => string;\n}\n\nexport function ResponsiveTable<T = any>({\n  data,\n  columns,\n  renderCard,\n  emptyMessage = \"Veri bulunamad\",\n  className,\n  tableClassName,\n  cardClassName,\n  onRowClick,\n  keyExtractor,\n}: ResponsiveTableProps<T>) {\n  const isMobile = useIsMobile();\n\n  // Window width state for responsive column visibility - Hook'lar her zaman en stte olmal\n  const [windowWidth, setWindowWidth] = useState(() => {\n    if (typeof window !== \"undefined\") {\n      return window.innerWidth;\n    }\n    return 1024; // Default to desktop\n  });\n\n  useEffect(() => {\n    if (typeof window === \"undefined\") return;\n    \n    const handleResize = () => {\n      setWindowWidth(window.innerWidth);\n    };\n    \n    window.addEventListener(\"resize\", handleResize);\n    return () => window.removeEventListener(\"resize\", handleResize);\n  }, []);\n\n  // nemli stunlar belirle (priority'ye gre)\n  const visibleColumns = useMemo(() => {\n    // Mobil (< 640px): Sadece high priority\n    if (windowWidth < 640) {\n      return columns.filter(col => col.priority === \"high\" || !col.priority);\n    }\n    \n    // Tablet (640px - 1024px): High + Medium priority\n    if (windowWidth < 1024) {\n      return columns.filter(col => \n        col.priority === \"high\" || \n        col.priority === \"medium\" || \n        !col.priority\n      );\n    }\n    \n    // Desktop (1024px+): Tm stunlar\n    return columns;\n  }, [columns, windowWidth]);\n\n  // Mobile'da kart grnm\n  if (isMobile && renderCard) {\n    if (data.length === 0) {\n      return (\n        <div className={cn(\"flex items-center justify-center p-8 text-muted-foreground\", className)}>\n          <p className=\"text-sm\">{emptyMessage}</p>\n        </div>\n      );\n    }\n\n    return (\n      <div className={cn(\"space-y-3 w-full max-w-full overflow-hidden\", className)}>\n        {data.map((row, index) => (\n          <div\n            key={keyExtractor ? keyExtractor(row, index) : `row-${index}`}\n            onClick={() => onRowClick?.(row, index)}\n            className={cn(\n              onRowClick && \"cursor-pointer\",\n              cardClassName\n            )}\n          >\n            {renderCard(row, index)}\n          </div>\n        ))}\n      </div>\n    );\n  }\n\n  // Tablet+ desktop'ta tablo grnm\n  if (data.length === 0) {\n    return (\n      <div className={cn(\"flex items-center justify-center p-8 text-muted-foreground\", className)}>\n        <p className=\"text-sm\">{emptyMessage}</p>\n      </div>\n    );\n  }\n  const hasStickyColumn = visibleColumns.some(col => col.sticky);\n\n  return (\n    <div className={cn(\n      \"w-full max-w-full overflow-hidden\",\n      className\n    )}>\n      <div className={cn(\n        \"w-full overflow-x-auto overflow-y-visible\",\n        \"scrollbar-thin scrollbar-thumb-muted-foreground/20 scrollbar-track-transparent\",\n        \"hover:scrollbar-thumb-muted-foreground/30\",\n        \"-webkit-overflow-scrolling-touch\",\n        \"overscroll-behavior-contain\"\n      )}>\n        <div className=\"min-w-full inline-block\">\n          <Table className={cn(\"w-full table-auto\", tableClassName)}>\n            <TableHeader>\n              <TableRow>\n                {visibleColumns.map((column) => (\n                  <TableHead\n                    key={column.key}\n                    className={cn(\n                      column.priority === \"low\" && \"hidden lg:table-cell\",\n                      column.priority === \"medium\" && \"hidden md:table-cell\",\n                      column.sticky && \"sticky left-0 z-20 bg-background\",\n                      column.headerClassName,\n                      !column.headerClassName?.includes(\"text-\") && \"text-left\",\n                      column.minWidth && `min-w-[${column.minWidth}px]`,\n                      \"px-4\"\n                    )}\n                    style={{\n                      minWidth: column.minWidth ? `${column.minWidth}px` : undefined,\n                      ...(column.sticky && {\n                        position: \"sticky\",\n                        left: 0,\n                        zIndex: 20,\n                        backgroundColor: \"var(--background)\",\n                      }),\n                    }}\n                  >\n                    {column.header}\n                  </TableHead>\n                ))}\n              </TableRow>\n            </TableHeader>\n            <TableBody>\n              {data.map((row, index) => (\n                <TableRow\n                  key={keyExtractor ? keyExtractor(row, index) : `row-${index}`}\n                  onClick={() => onRowClick?.(row, index)}\n                  className={cn(\n                    onRowClick && \"cursor-pointer hover:bg-muted/50\",\n                    hasStickyColumn && \"relative\"\n                  )}\n                >\n                  {visibleColumns.map((column) => {\n                    const content = column.accessor ? column.accessor(row) : (row as any)[column.key];\n                    return (\n                      <TableCell\n                        key={column.key}\n                        className={cn(\n                          column.priority === \"low\" && \"hidden lg:table-cell\",\n                          column.priority === \"medium\" && \"hidden md:table-cell\",\n                          column.sticky && \"sticky left-0 z-10 bg-background\",\n                          column.cellClassName,\n                          column.className,\n                          !column.cellClassName && !column.className?.includes(\"text-\") && \"text-left\",\n                          \"px-4 py-1.5 sm:py-2\"\n                        )}\n                        style={{\n                          minWidth: column.minWidth ? `${column.minWidth}px` : undefined,\n                          ...(column.sticky && {\n                            position: \"sticky\",\n                            left: 0,\n                            zIndex: 10,\n                            backgroundColor: \"var(--background)\",\n                          }),\n                        }}\n                      >\n                        {content}\n                      </TableCell>\n                    );\n                  })}\n                </TableRow>\n              ))}\n            </TableBody>\n          </Table>\n        </div>\n      </div>\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\components\\ui\\accordion.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\components\\ui\\alert-dialog.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\components\\ui\\alert.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\components\\ui\\aspect-ratio.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\components\\ui\\avatar.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\components\\ui\\badge.tsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":29,"column":17,"nodeType":"Identifier","messageId":"namedExport","endLine":29,"endColumn":30}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import * as React from \"react\";\nimport { cva, type VariantProps } from \"class-variance-authority\";\n\nimport { cn } from \"@/lib/utils\";\n\nconst badgeVariants = cva(\n  \"inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2\",\n  {\n    variants: {\n      variant: {\n        default: \"border-transparent bg-primary text-primary-foreground hover:bg-primary/80\",\n        secondary: \"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80\",\n        destructive: \"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80\",\n        outline: \"text-foreground\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  },\n);\n\nexport interface BadgeProps extends React.HTMLAttributes<HTMLDivElement>, VariantProps<typeof badgeVariants> {}\n\nfunction Badge({ className, variant, ...props }: BadgeProps) {\n  return <div className={cn(badgeVariants({ variant }), className)} {...props} />;\n}\n\nexport { Badge, badgeVariants };\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\components\\ui\\breadcrumb.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\components\\ui\\button.tsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":47,"column":18,"nodeType":"Identifier","messageId":"namedExport","endLine":47,"endColumn":32}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import * as React from \"react\";\nimport { Slot } from \"@radix-ui/react-slot\";\nimport { cva, type VariantProps } from \"class-variance-authority\";\n\nimport { cn } from \"@/lib/utils\";\n\nconst buttonVariants = cva(\n  \"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-all duration-200 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-60 disabled:cursor-not-allowed [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0 touch-manipulation\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-primary text-primary-foreground hover:bg-primary/90 active:bg-primary/95 active:scale-[0.98] shadow-sm hover:shadow-md\",\n        destructive: \"bg-destructive text-destructive-foreground hover:bg-destructive/90 active:bg-destructive/95 active:scale-[0.98] shadow-sm hover:shadow-md\",\n        outline: \"border border-input bg-background hover:bg-accent hover:text-accent-foreground active:bg-accent/80 active:scale-[0.98]\",\n        secondary: \"bg-secondary text-secondary-foreground hover:bg-secondary/80 active:bg-secondary/70 active:scale-[0.98]\",\n        ghost: \"hover:bg-accent hover:text-accent-foreground active:bg-accent/80 active:scale-[0.98]\",\n        link: \"text-primary underline-offset-4 hover:underline active:opacity-80\",\n      },\n      size: {\n        default: \"h-11 sm:h-10 px-3 sm:px-3 py-2.5 sm:py-2 min-h-[44px] sm:min-h-0 text-sm sm:text-sm\",\n        sm: \"h-10 sm:h-9 rounded-md px-3 sm:px-2.5 min-h-[44px] sm:min-h-0 text-xs sm:text-xs\",\n        lg: \"h-12 sm:h-11 rounded-md px-6 sm:px-5 min-h-[44px] sm:min-h-0 text-base sm:text-sm\",\n        icon: \"h-11 w-11 sm:h-10 sm:w-10 min-h-[44px] min-w-[44px] sm:min-h-0 sm:min-w-0 p-0\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  },\n);\n\nexport interface ButtonProps\n  extends React.ButtonHTMLAttributes<HTMLButtonElement>,\n    VariantProps<typeof buttonVariants> {\n  asChild?: boolean;\n}\n\nconst Button = React.forwardRef<HTMLButtonElement, ButtonProps>(\n  ({ className, variant, size, asChild = false, ...props }, ref) => {\n    const Comp = asChild ? Slot : \"button\";\n    return <Comp className={cn(buttonVariants({ variant, size, className }))} ref={ref} {...props} />;\n  },\n);\nButton.displayName = \"Button\";\n\nexport { Button, buttonVariants };\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\components\\ui\\calendar.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\components\\ui\\card.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\components\\ui\\carousel.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\components\\ui\\chart.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\components\\ui\\checkbox.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\components\\ui\\collapsible.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\components\\ui\\command.tsx","messages":[{"ruleId":"@typescript-eslint/no-empty-object-type","severity":2,"message":"An interface declaring no members is equivalent to its supertype.","line":24,"column":11,"nodeType":"Identifier","messageId":"noEmptyInterfaceWithSuper","endLine":24,"endColumn":29,"suggestions":[{"messageId":"replaceEmptyInterfaceWithSuper","fix":{"range":[756,807],"text":"type CommandDialogProps = DialogProps"},"desc":"Replace empty interface with a type alias."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import * as React from \"react\";\nimport { type DialogProps } from \"@radix-ui/react-dialog\";\nimport { Command as CommandPrimitive } from \"cmdk\";\nimport { Search } from \"lucide-react\";\n\nimport { cn } from \"@/lib/utils\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogDescription } from \"@/components/ui/dialog\";\n\nconst Command = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground\",\n      className,\n    )}\n    {...props}\n  />\n));\nCommand.displayName = CommandPrimitive.displayName;\n\ninterface CommandDialogProps extends DialogProps {}\n\nconst CommandDialog = ({ children, ...props }: CommandDialogProps) => {\n  return (\n    <Dialog {...props}>\n      <DialogContent className=\"overflow-hidden p-0 shadow-lg\">\n        {/* DialogTitle ve DialogDescription DialogContent'in direkt child' olmal (Radix UI gereksinimi) */}\n        <DialogTitle className=\"sr-only\">\n          Komut Paleti\n        </DialogTitle>\n        <DialogDescription className=\"sr-only\">\n          Komutlar arayn ve sein\n        </DialogDescription>\n        <Command className=\"[&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground [&_[cmdk-group]:not([hidden])_~[cmdk-group]]:pt-0 [&_[cmdk-group]]:px-2 [&_[cmdk-input-wrapper]_svg]:h-5 [&_[cmdk-input-wrapper]_svg]:w-5 [&_[cmdk-input]]:h-12 [&_[cmdk-item]]:px-2 [&_[cmdk-item]]:py-3 [&_[cmdk-item]_svg]:h-5 [&_[cmdk-item]_svg]:w-5\">\n          {children}\n        </Command>\n      </DialogContent>\n    </Dialog>\n  );\n};\n\nconst CommandInput = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Input>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Input>\n>(({ className, ...props }, ref) => (\n  <div className=\"flex items-center border-b px-3\" cmdk-input-wrapper=\"\">\n    <Search className=\"mr-3 h-4 w-4 shrink-0 opacity-50\" />\n    <CommandPrimitive.Input\n      ref={ref}\n      className={cn(\n        \"flex h-11 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50\",\n        className,\n      )}\n      {...props}\n    />\n  </div>\n));\n\nCommandInput.displayName = CommandPrimitive.Input.displayName;\n\nconst CommandList = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.List\n    ref={ref}\n    className={cn(\"!overflow-y-auto !overflow-x-hidden\", className)}\n    style={{\n      WebkitOverflowScrolling: 'touch',\n      touchAction: 'pan-y pinch-zoom',\n      overscrollBehavior: 'contain',\n      overscrollBehaviorY: 'contain',\n      overscrollBehaviorX: 'contain',\n      scrollbarWidth: 'thin',\n      scrollbarColor: 'rgba(0, 0, 0, 0.2) transparent',\n      paddingBottom: '0px',\n      scrollPaddingBottom: '0px',\n      // erie gre otomatik ykseklik, gerektiinde scroll\n      height: 'auto',\n      maxHeight: '85vh',\n    } as React.CSSProperties}\n    {...props}\n  />\n));\n\nCommandList.displayName = CommandPrimitive.List.displayName;\n\nconst CommandEmpty = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Empty>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Empty>\n>((props, ref) => <CommandPrimitive.Empty ref={ref} className=\"py-6 text-center text-sm\" {...props} />);\n\nCommandEmpty.displayName = CommandPrimitive.Empty.displayName;\n\nconst CommandGroup = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Group>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Group>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Group\n    ref={ref}\n    className={cn(\n      \"overflow-hidden p-1 pb-0 text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground\",\n      className,\n    )}\n    {...props}\n  />\n));\n\nCommandGroup.displayName = CommandPrimitive.Group.displayName;\n\nconst CommandSeparator = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Separator ref={ref} className={cn(\"-mx-1 h-px bg-border\", className)} {...props} />\n));\nCommandSeparator.displayName = CommandPrimitive.Separator.displayName;\n\nconst CommandItem = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-pointer select-none items-center rounded-md px-3 py-2 text-sm outline-none transition-colors data-[disabled=true]:pointer-events-none data-[selected='true']:bg-accent data-[selected=true]:text-accent-foreground data-[disabled=true]:opacity-50 hover:bg-accent/80\",\n      className,\n    )}\n    {...props}\n  />\n));\n\nCommandItem.displayName = CommandPrimitive.Item.displayName;\n\nconst CommandShortcut = ({ className, ...props }: React.HTMLAttributes<HTMLSpanElement>) => {\n  return <span className={cn(\"ml-auto text-xs tracking-widest text-muted-foreground\", className)} {...props} />;\n};\nCommandShortcut.displayName = \"CommandShortcut\";\n\nexport {\n  Command,\n  CommandDialog,\n  CommandInput,\n  CommandList,\n  CommandEmpty,\n  CommandGroup,\n  CommandItem,\n  CommandShortcut,\n  CommandSeparator,\n};\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\components\\ui\\context-menu.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\components\\ui\\dialog.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":71,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":71,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2982,2985],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2982,2985],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":80,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":80,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3526,3529],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3526,3529],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":95,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":95,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4296,4299],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4296,4299],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import * as React from \"react\";\nimport * as DialogPrimitive from \"@radix-ui/react-dialog\";\nimport { X } from \"lucide-react\";\n\nimport { cn } from \"@/lib/utils\";\nimport { useSidebarContext } from \"@/contexts/SidebarContext\";\n\nconst Dialog = DialogPrimitive.Root;\n\nconst DialogTrigger = DialogPrimitive.Trigger;\n\nconst DialogPortal = DialogPrimitive.Portal;\n\nconst DialogClose = DialogPrimitive.Close;\n\nconst DialogOverlay = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Overlay\n    ref={ref}\n    className={cn(\n      \"fixed inset-0 z-[10000] bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className,\n    )}\n    {...props}\n  />\n));\nDialogOverlay.displayName = DialogPrimitive.Overlay.displayName;\n\nconst DialogContent = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Content>\n>(({ className, children, ...props }, ref) => {\n  // Eer data-task-modal attribute'u varsa, varsaylan sm:max-w-lg snfn kaldr\n  // React'te data attribute'lar props'da dorudan geer (data-task-modal olarak)\n  // Props'tan kontrol et - React'te data attribute'lar props'da dorudan geer\n  const propsObj = props as Record<string, unknown>;\n  const hasTaskModal = ('data-task-modal' in propsObj && propsObj['data-task-modal'] !== undefined) || \n                       ('dataTaskModal' in propsObj && propsObj['dataTaskModal'] !== undefined) ||\n                       (typeof className === 'string' && className.includes('task-modal-full-width'));\n  \n  const sidebarContext = useSidebarContext();\n  \n  // Dialog aldnda mobilde meny kapat\n  // NOT: useEffect kaldrld - DialogContent mount olduunda sidebar' kapatmak\n  // GlobalSearch gibi her zaman render edilen Dialog'lar sidebar' hemen kapatyordu\n  // Artk sadece overlay tklamasnda sidebar kapanacak\n  \n  // Accessibility: DialogTitle ve DialogDescription kontrol\n  // Eer children iinde DialogTitle veya DialogDescription yoksa, otomatik olarak sr-only versiyonlarn ekle\n  let hasTitle = false;\n  let hasDescription = false;\n  \n  // Recursive function to check for DialogTitle and DialogDescription\n  const checkForTitleAndDescription = (node: React.ReactNode, depth: number = 0): void => {\n    // Max depth kontrol (sonsuz dngy nlemek iin)\n    if (depth > 10) return;\n    if (!node) return;\n    \n    // Fragment kontrol\n    if (React.isValidElement(node) && node.type === React.Fragment) {\n      if (node.props?.children) {\n        React.Children.forEach(node.props.children, (child) => checkForTitleAndDescription(child, depth + 1));\n      }\n      return;\n    }\n    \n    if (React.isValidElement(node)) {\n      // Check if it's a DialogTitle or DialogDescription\n      const nodeType = node.type as any;\n      const displayName = nodeType?.displayName || nodeType?.name || nodeType?.$$typeof?.toString();\n      \n      // DialogTitle kontrol - daha kapsaml\n      // Radix UI'nin Title component'ini kontrol et\n      const isTitle = displayName === DialogPrimitive.Title.displayName || \n          displayName === 'DialogTitle' ||\n          nodeType === DialogPrimitive.Title ||\n          (typeof nodeType === 'function' && (nodeType.displayName === 'DialogTitle' || nodeType.name === 'DialogTitle')) ||\n          (node.props && (node.props as any).__isDialogTitle) ||\n          // String kontrol - baz durumlarda string olarak gelebilir\n          (typeof node === 'string' && node.includes('DialogTitle'));\n      \n      if (isTitle) {\n        hasTitle = true;\n        // Early return yapma - children' da kontrol et\n      }\n      \n      // DialogDescription kontrol - daha kapsaml\n      // Radix UI'nin Description component'ini kontrol et\n      const isDescription = displayName === DialogPrimitive.Description.displayName || \n          displayName === 'DialogDescription' ||\n          nodeType === DialogPrimitive.Description ||\n          (typeof nodeType === 'function' && (nodeType.displayName === 'DialogDescription' || nodeType.name === 'DialogDescription')) ||\n          (node.props && (node.props as any).__isDialogDescription) ||\n          // String kontrol - baz durumlarda string olarak gelebilir\n          (typeof node === 'string' && node.includes('DialogDescription'));\n      \n      if (isDescription) {\n        hasDescription = true;\n        // Early return yapma - children' da kontrol et\n      }\n      \n      // Eer hem title hem description bulunduysa, erken k\n      if (hasTitle && hasDescription) {\n        return;\n      }\n      \n      // Recursively check children - tm olas children formatlarn kontrol et\n      if (node.props?.children) {\n        const childrenArray = React.Children.toArray(node.props.children);\n        childrenArray.forEach((child) => checkForTitleAndDescription(child, depth + 1));\n      }\n    } else if (Array.isArray(node)) {\n      node.forEach((item) => checkForTitleAndDescription(item, depth + 1));\n    }\n  };\n  \n  // Check all children recursively - React.Children.toArray kullanarak daha gvenli kontrol\n  const childrenArray = React.Children.toArray(children);\n  childrenArray.forEach((child) => checkForTitleAndDescription(child, 0));\n  \n  // Eksik DialogTitle veya DialogDescription varsa, otomatik olarak sr-only versiyonlarn ekle\n  // Her zaman ekle (Radix UI uyarlarn nlemek iin) - duplicate kontrol zaten yapld\n  // Not: Radix UI'nin kontrol render srasnda yaplyor, bu yzden her zaman eklemek daha gvenli\n  const enhancedChildren = (\n    <>\n      {/* Her zaman ekle - eer zaten varsa Radix UI duplicate'i handle edecek */}\n      <DialogPrimitive.Title className=\"sr-only\" key=\"auto-title\" aria-hidden={hasTitle ? true : undefined}>\n        {hasTitle ? '' : 'Dialog'}\n      </DialogPrimitive.Title>\n      <DialogPrimitive.Description className=\"sr-only\" key=\"auto-description\" aria-hidden={hasDescription ? true : undefined}>\n        {hasDescription ? '' : 'Dialog ierii'}\n      </DialogPrimitive.Description>\n      {children}\n    </>\n  );\n  \n  return (\n    <DialogPortal>\n      <DialogOverlay \n        className=\"z-[10000]\"\n        onClick={() => {\n          // Overlay'e tklandnda mobilde meny kapat\n          if (sidebarContext) {\n            sidebarContext.closeSidebar();\n          }\n        }}\n      />\n      <DialogPrimitive.Content\n        ref={ref}\n        className={cn(\n          // Her zaman fixed olmal (modal almas iin gerekli)\n          \"fixed z-[10001]\",\n          // Mobil iin left-0 right-0 bottom-0 gerekli (modal render edilmesi iin)\n          // Tablet/desktop iin CSS'teki !important kurallar bu class'lar override edecek\n          \"left-0 right-0 bottom-0\",\n          \"grid w-full gap-3 sm:gap-4 border-t bg-background p-3 sm:p-4 md:p-6 pb-safe shadow-lg duration-200\",\n          \"data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n          \"data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom\",\n          \"!max-h-[95vh] sm:!max-h-[80vh] !overflow-hidden\",\n          \"scroll-smooth -webkit-overflow-scrolling-touch overscroll-behavior-contain\",\n          // Professional mobile optimizations\n          \"touch-manipulation\",\n          // Desktop: Centered modal (sadece data-task-modal yoksa)\n          // CSS'teki !important kurallar bu class'lar override edecek\n          // NOT: sm:left, sm:translate-x gibi positioning class'lar kaldrld - CSS'teki !important kurallar alsn\n          !hasTaskModal && \"sm:rounded-lg sm:border sm:border-t\",\n          !hasTaskModal && \"sm:data-[state=closed]:slide-out-to-left sm:data-[state=closed]:slide-out-to-top sm:data-[state=open]:slide-in-from-left sm:data-[state=open]:slide-in-from-top\",\n          !hasTaskModal && \"sm:data-[state=closed]:zoom-out-95 sm:data-[state=open]:zoom-in-95\",\n          className,\n        )}\n        {...props}\n      >\n        {enhancedChildren}\n        <DialogPrimitive.Close className=\"absolute right-3 sm:right-4 top-3 sm:top-4 rounded-sm opacity-70 ring-offset-background transition-opacity data-[state=open]:bg-accent data-[state=open]:text-muted-foreground hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none touch-manipulation min-h-[44px] min-w-[44px] sm:min-h-[36px] sm:min-w-[36px] flex items-center justify-center z-[10002] active:scale-95\">\n          <X className=\"h-5 w-5 sm:h-4 sm:w-4\" />\n          <span className=\"sr-only\">Close</span>\n        </DialogPrimitive.Close>\n      </DialogPrimitive.Content>\n    </DialogPortal>\n  );\n});\nDialogContent.displayName = DialogPrimitive.Content.displayName;\n\nconst DialogHeader = ({ className, ...props }: React.HTMLAttributes<HTMLDivElement>) => (\n  <div className={cn(\"flex flex-col space-y-1.5 sm:space-y-2 text-center sm:text-left px-1\", className)} {...props} />\n);\nDialogHeader.displayName = \"DialogHeader\";\n\nconst DialogFooter = ({ className, ...props }: React.HTMLAttributes<HTMLDivElement>) => (\n  <div className={cn(\"flex flex-col-reverse sm:flex-row sm:justify-end gap-2 sm:gap-2 sm:space-x-2 pt-2 sm:pt-0\", className)} {...props} />\n);\nDialogFooter.displayName = \"DialogFooter\";\n\nconst DialogTitle = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg sm:text-xl md:text-2xl font-semibold leading-tight tracking-tight\", className)}\n    {...props}\n  />\n));\nDialogTitle.displayName = DialogPrimitive.Title.displayName;\n\nconst DialogDescription = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Description ref={ref} className={cn(\"text-sm sm:text-base text-muted-foreground leading-relaxed mt-1 sm:mt-1.5\", className)} {...props} />\n));\nDialogDescription.displayName = DialogPrimitive.Description.displayName;\n\nexport {\n  Dialog,\n  DialogPortal,\n  DialogOverlay,\n  DialogClose,\n  DialogTrigger,\n  DialogContent,\n  DialogHeader,\n  DialogFooter,\n  DialogTitle,\n  DialogDescription,\n};\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\components\\ui\\drawer.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\components\\ui\\dropdown-menu.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\components\\ui\\empty-state.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\components\\ui\\form.tsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":129,"column":10,"nodeType":"Identifier","messageId":"namedExport","endLine":129,"endColumn":22}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import * as React from \"react\";\nimport * as LabelPrimitive from \"@radix-ui/react-label\";\nimport { Slot } from \"@radix-ui/react-slot\";\nimport { Controller, ControllerProps, FieldPath, FieldValues, FormProvider, useFormContext } from \"react-hook-form\";\n\nimport { cn } from \"@/lib/utils\";\nimport { Label } from \"@/components/ui/label\";\n\nconst Form = FormProvider;\n\ntype FormFieldContextValue<\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>,\n> = {\n  name: TName;\n};\n\nconst FormFieldContext = React.createContext<FormFieldContextValue>({} as FormFieldContextValue);\n\nconst FormField = <\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>,\n>({\n  ...props\n}: ControllerProps<TFieldValues, TName>) => {\n  return (\n    <FormFieldContext.Provider value={{ name: props.name }}>\n      <Controller {...props} />\n    </FormFieldContext.Provider>\n  );\n};\n\nconst useFormField = () => {\n  const fieldContext = React.useContext(FormFieldContext);\n  const itemContext = React.useContext(FormItemContext);\n  const { getFieldState, formState } = useFormContext();\n\n  const fieldState = getFieldState(fieldContext.name, formState);\n\n  if (!fieldContext) {\n    throw new Error(\"useFormField should be used within <FormField>\");\n  }\n\n  const { id } = itemContext;\n\n  return {\n    id,\n    name: fieldContext.name,\n    formItemId: `${id}-form-item`,\n    formDescriptionId: `${id}-form-item-description`,\n    formMessageId: `${id}-form-item-message`,\n    ...fieldState,\n  };\n};\n\ntype FormItemContextValue = {\n  id: string;\n};\n\nconst FormItemContext = React.createContext<FormItemContextValue>({} as FormItemContextValue);\n\nconst FormItem = React.forwardRef<HTMLDivElement, React.HTMLAttributes<HTMLDivElement>>(\n  ({ className, ...props }, ref) => {\n    const id = React.useId();\n\n    return (\n      <FormItemContext.Provider value={{ id }}>\n        <div ref={ref} className={cn(\"space-y-2\", className)} {...props} />\n      </FormItemContext.Provider>\n    );\n  },\n);\nFormItem.displayName = \"FormItem\";\n\nconst FormLabel = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  const { error, formItemId } = useFormField();\n\n  return <Label ref={ref} className={cn(error && \"text-destructive\", className)} htmlFor={formItemId} {...props} />;\n});\nFormLabel.displayName = \"FormLabel\";\n\nconst FormControl = React.forwardRef<React.ElementRef<typeof Slot>, React.ComponentPropsWithoutRef<typeof Slot>>(\n  ({ ...props }, ref) => {\n    const { error, formItemId, formDescriptionId, formMessageId } = useFormField();\n\n    return (\n      <Slot\n        ref={ref}\n        id={formItemId}\n        aria-describedby={!error ? `${formDescriptionId}` : `${formDescriptionId} ${formMessageId}`}\n        aria-invalid={!!error}\n        {...props}\n      />\n    );\n  },\n);\nFormControl.displayName = \"FormControl\";\n\nconst FormDescription = React.forwardRef<HTMLParagraphElement, React.HTMLAttributes<HTMLParagraphElement>>(\n  ({ className, ...props }, ref) => {\n    const { formDescriptionId } = useFormField();\n\n    return <p ref={ref} id={formDescriptionId} className={cn(\"text-sm text-muted-foreground\", className)} {...props} />;\n  },\n);\nFormDescription.displayName = \"FormDescription\";\n\nconst FormMessage = React.forwardRef<HTMLParagraphElement, React.HTMLAttributes<HTMLParagraphElement>>(\n  ({ className, children, ...props }, ref) => {\n    const { error, formMessageId } = useFormField();\n    const body = error ? String(error?.message) : children;\n\n    if (!body) {\n      return null;\n    }\n\n    return (\n      <p ref={ref} id={formMessageId} className={cn(\"text-sm font-medium text-destructive\", className)} {...props}>\n        {body}\n      </p>\n    );\n  },\n);\nFormMessage.displayName = \"FormMessage\";\n\nexport { useFormField, Form, FormItem, FormLabel, FormControl, FormDescription, FormMessage, FormField };\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\components\\ui\\hover-card.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\components\\ui\\input-otp.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\components\\ui\\input.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\components\\ui\\label.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\components\\ui\\loading-spinner.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\components\\ui\\loading-state.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\components\\ui\\menubar.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\components\\ui\\navigation-menu.tsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":111,"column":3,"nodeType":"Identifier","messageId":"namedExport","endLine":111,"endColumn":29}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import * as React from \"react\";\nimport * as NavigationMenuPrimitive from \"@radix-ui/react-navigation-menu\";\nimport { cva } from \"class-variance-authority\";\nimport { ChevronDown } from \"lucide-react\";\n\nimport { cn } from \"@/lib/utils\";\n\nconst NavigationMenu = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Root\n    ref={ref}\n    className={cn(\"relative z-10 flex max-w-max flex-1 items-center justify-center\", className)}\n    {...props}\n  >\n    {children}\n    <NavigationMenuViewport />\n  </NavigationMenuPrimitive.Root>\n));\nNavigationMenu.displayName = NavigationMenuPrimitive.Root.displayName;\n\nconst NavigationMenuList = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.List\n    ref={ref}\n    className={cn(\"group flex flex-1 list-none items-center justify-center space-x-1\", className)}\n    {...props}\n  />\n));\nNavigationMenuList.displayName = NavigationMenuPrimitive.List.displayName;\n\nconst NavigationMenuItem = NavigationMenuPrimitive.Item;\n\nconst navigationMenuTriggerStyle = cva(\n  \"group inline-flex h-10 w-max items-center justify-center rounded-md bg-background px-4 py-2 text-sm font-medium transition-colors hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground focus:outline-none disabled:pointer-events-none disabled:opacity-50 data-[active]:bg-accent/50 data-[state=open]:bg-accent/50\",\n);\n\nconst NavigationMenuTrigger = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Trigger\n    ref={ref}\n    className={cn(navigationMenuTriggerStyle(), \"group\", className)}\n    {...props}\n  >\n    {children}{\" \"}\n    <ChevronDown\n      className=\"relative top-[1px] ml-1 h-3 w-3 transition duration-200 group-data-[state=open]:rotate-180\"\n      aria-hidden=\"true\"\n    />\n  </NavigationMenuPrimitive.Trigger>\n));\nNavigationMenuTrigger.displayName = NavigationMenuPrimitive.Trigger.displayName;\n\nconst NavigationMenuContent = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"left-0 top-0 w-full data-[motion^=from-]:animate-in data-[motion^=to-]:animate-out data-[motion^=from-]:fade-in data-[motion^=to-]:fade-out data-[motion=from-end]:slide-in-from-right-52 data-[motion=from-start]:slide-in-from-left-52 data-[motion=to-end]:slide-out-to-right-52 data-[motion=to-start]:slide-out-to-left-52 md:absolute md:w-auto\",\n      className,\n    )}\n    {...props}\n  />\n));\nNavigationMenuContent.displayName = NavigationMenuPrimitive.Content.displayName;\n\nconst NavigationMenuLink = NavigationMenuPrimitive.Link;\n\nconst NavigationMenuViewport = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Viewport>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Viewport>\n>(({ className, ...props }, ref) => (\n  <div className={cn(\"absolute left-0 top-full flex justify-center\")}>\n    <NavigationMenuPrimitive.Viewport\n      className={cn(\n        \"origin-top-center relative mt-1.5 h-[var(--radix-navigation-menu-viewport-height)] w-full overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-90 md:w-[var(--radix-navigation-menu-viewport-width)]\",\n        className,\n      )}\n      ref={ref}\n      {...props}\n    />\n  </div>\n));\nNavigationMenuViewport.displayName = NavigationMenuPrimitive.Viewport.displayName;\n\nconst NavigationMenuIndicator = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Indicator>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Indicator>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Indicator\n    ref={ref}\n    className={cn(\n      \"top-full z-[1] flex h-1.5 items-end justify-center overflow-hidden data-[state=visible]:animate-in data-[state=hidden]:animate-out data-[state=hidden]:fade-out data-[state=visible]:fade-in\",\n      className,\n    )}\n    {...props}\n  >\n    <div className=\"relative top-[60%] h-2 w-2 rotate-45 rounded-tl-sm bg-border shadow-md\" />\n  </NavigationMenuPrimitive.Indicator>\n));\nNavigationMenuIndicator.displayName = NavigationMenuPrimitive.Indicator.displayName;\n\nexport {\n  navigationMenuTriggerStyle,\n  NavigationMenu,\n  NavigationMenuList,\n  NavigationMenuItem,\n  NavigationMenuContent,\n  NavigationMenuTrigger,\n  NavigationMenuLink,\n  NavigationMenuIndicator,\n  NavigationMenuViewport,\n};\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\components\\ui\\pagination.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\components\\ui\\password-input.tsx","messages":[{"ruleId":"@typescript-eslint/no-empty-object-type","severity":2,"message":"An interface declaring no members is equivalent to its supertype.","line":6,"column":18,"nodeType":"Identifier","messageId":"noEmptyInterfaceWithSuper","endLine":6,"endColumn":36,"suggestions":[{"messageId":"replaceEmptyInterfaceWithSuper","fix":{"range":[151,236],"text":"type PasswordInputProps = React.InputHTMLAttributes<HTMLInputElement>"},"desc":"Replace empty interface with a type alias."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import * as React from \"react\";\nimport { Eye, EyeOff } from \"lucide-react\";\nimport { Input } from \"./input\";\nimport { cn } from \"@/lib/utils\";\n\nexport interface PasswordInputProps\n  extends React.InputHTMLAttributes<HTMLInputElement> {}\n\nconst PasswordInput = React.forwardRef<HTMLInputElement, PasswordInputProps>(\n  ({ className, ...props }, ref) => {\n    const [showPassword, setShowPassword] = React.useState(false);\n\n    return (\n      <div className=\"relative\" style={{ isolation: 'isolate' }}>\n        <Input\n          type={showPassword ? \"text\" : \"password\"}\n          className={cn(\"pr-10\", className)}\n          ref={ref}\n          {...props}\n          style={{ \n            position: 'relative',\n            zIndex: 1,\n            ...props.style \n          }}\n        />\n        <button\n          type=\"button\"\n          className=\"absolute right-0 top-0 bottom-0 h-full px-3 hover:bg-transparent z-10 flex items-center justify-center cursor-pointer disabled:cursor-not-allowed disabled:opacity-60 touch-manipulation active:!transform-none active:!scale-100 focus:!transform-none focus:!scale-100\"\n          onClick={() => setShowPassword(!showPassword)}\n          disabled={props.disabled}\n          style={{ \n            zIndex: 10,\n            margin: 0,\n            paddingTop: 0,\n            paddingBottom: 0,\n            paddingRight: '0.75rem',\n            paddingLeft: '0.75rem',\n            background: 'transparent',\n            border: 'none',\n            outline: 'none',\n            transform: 'none !important',\n            position: 'absolute',\n            top: 0,\n            bottom: 0,\n            display: 'flex',\n            alignItems: 'center',\n            justifyContent: 'center'\n          }}\n        >\n          {showPassword ? (\n            <EyeOff className=\"h-4 w-4 text-muted-foreground flex-shrink-0\" />\n          ) : (\n            <Eye className=\"h-4 w-4 text-muted-foreground flex-shrink-0\" />\n          )}\n          <span className=\"sr-only\">\n            {showPassword ? \"ifreyi gizle\" : \"ifreyi gster\"}\n          </span>\n        </button>\n      </div>\n    );\n  }\n);\nPasswordInput.displayName = \"PasswordInput\";\n\nexport { PasswordInput };\n\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\components\\ui\\popover.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\components\\ui\\progress.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\components\\ui\\radio-group.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\components\\ui\\resizable.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\components\\ui\\scroll-area.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\components\\ui\\search-input.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\components\\ui\\select.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\components\\ui\\separator.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\components\\ui\\sheet.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\components\\ui\\sidebar.tsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":636,"column":3,"nodeType":"Identifier","messageId":"namedExport","endLine":636,"endColumn":13}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import * as React from \"react\";\nimport { Slot } from \"@radix-ui/react-slot\";\nimport { VariantProps, cva } from \"class-variance-authority\";\nimport { PanelLeft } from \"lucide-react\";\n\nimport { useIsMobile } from \"@/hooks/use-mobile\";\nimport { cn } from \"@/lib/utils\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Separator } from \"@/components/ui/separator\";\nimport { Sheet, SheetContent } from \"@/components/ui/sheet\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { Tooltip, TooltipContent, TooltipProvider, TooltipTrigger } from \"@/components/ui/tooltip\";\n\nconst SIDEBAR_COOKIE_NAME = \"sidebar:state\";\nconst SIDEBAR_COOKIE_MAX_AGE = 60 * 60 * 24 * 7;\nconst SIDEBAR_WIDTH = \"16rem\";\nconst SIDEBAR_WIDTH_MOBILE = \"18rem\";\nconst SIDEBAR_WIDTH_ICON = \"3rem\";\nconst SIDEBAR_KEYBOARD_SHORTCUT = \"b\";\n\ntype SidebarContext = {\n  state: \"expanded\" | \"collapsed\";\n  open: boolean;\n  setOpen: (open: boolean) => void;\n  openMobile: boolean;\n  setOpenMobile: (open: boolean) => void;\n  isMobile: boolean;\n  toggleSidebar: () => void;\n};\n\nconst SidebarContext = React.createContext<SidebarContext | null>(null);\n\nfunction useSidebar() {\n  const context = React.useContext(SidebarContext);\n  if (!context) {\n    throw new Error(\"useSidebar must be used within a SidebarProvider.\");\n  }\n\n  return context;\n}\n\nconst SidebarProvider = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    defaultOpen?: boolean;\n    open?: boolean;\n    onOpenChange?: (open: boolean) => void;\n  }\n>(({ defaultOpen = true, open: openProp, onOpenChange: setOpenProp, className, style, children, ...props }, ref) => {\n  const isMobile = useIsMobile();\n  const [openMobile, setOpenMobile] = React.useState(false);\n\n  // This is the internal state of the sidebar.\n  // We use openProp and setOpenProp for control from outside the component.\n  const [_open, _setOpen] = React.useState(defaultOpen);\n  const open = openProp ?? _open;\n  const setOpen = React.useCallback(\n    (value: boolean | ((value: boolean) => boolean)) => {\n      const openState = typeof value === \"function\" ? value(open) : value;\n      if (setOpenProp) {\n        setOpenProp(openState);\n      } else {\n        _setOpen(openState);\n      }\n\n      // This sets the cookie to keep the sidebar state.\n      document.cookie = `${SIDEBAR_COOKIE_NAME}=${openState}; path=/; max-age=${SIDEBAR_COOKIE_MAX_AGE}`;\n    },\n    [setOpenProp, open],\n  );\n\n  // Helper to toggle the sidebar.\n  const toggleSidebar = React.useCallback(() => {\n    return isMobile ? setOpenMobile((open) => !open) : setOpen((open) => !open);\n  }, [isMobile, setOpen, setOpenMobile]);\n\n  // Adds a keyboard shortcut to toggle the sidebar.\n  React.useEffect(() => {\n    const handleKeyDown = (event: KeyboardEvent) => {\n      if (event.key === SIDEBAR_KEYBOARD_SHORTCUT && (event.metaKey || event.ctrlKey)) {\n        event.preventDefault();\n        toggleSidebar();\n      }\n    };\n\n    window.addEventListener(\"keydown\", handleKeyDown);\n    return () => window.removeEventListener(\"keydown\", handleKeyDown);\n  }, [toggleSidebar]);\n\n  // We add a state so that we can do data-state=\"expanded\" or \"collapsed\".\n  // This makes it easier to style the sidebar with Tailwind classes.\n  const state = open ? \"expanded\" : \"collapsed\";\n\n  const contextValue = React.useMemo<SidebarContext>(\n    () => ({\n      state,\n      open,\n      setOpen,\n      isMobile,\n      openMobile,\n      setOpenMobile,\n      toggleSidebar,\n    }),\n    [state, open, setOpen, isMobile, openMobile, setOpenMobile, toggleSidebar],\n  );\n\n  return (\n    <SidebarContext.Provider value={contextValue}>\n      <TooltipProvider delayDuration={0}>\n        <div\n          style={\n            {\n              \"--sidebar-width\": SIDEBAR_WIDTH,\n              \"--sidebar-width-icon\": SIDEBAR_WIDTH_ICON,\n              ...style,\n            } as React.CSSProperties\n          }\n          className={cn(\"group/sidebar-wrapper flex min-h-svh w-full has-[[data-variant=inset]]:bg-sidebar\", className)}\n          ref={ref}\n          {...props}\n        >\n          {children}\n        </div>\n      </TooltipProvider>\n    </SidebarContext.Provider>\n  );\n});\nSidebarProvider.displayName = \"SidebarProvider\";\n\nconst Sidebar = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    side?: \"left\" | \"right\";\n    variant?: \"sidebar\" | \"floating\" | \"inset\";\n    collapsible?: \"offcanvas\" | \"icon\" | \"none\";\n  }\n>(({ side = \"left\", variant = \"sidebar\", collapsible = \"offcanvas\", className, children, ...props }, ref) => {\n  const { isMobile, state, openMobile, setOpenMobile } = useSidebar();\n\n  if (collapsible === \"none\") {\n    return (\n      <div\n        className={cn(\"flex h-full w-[--sidebar-width] flex-col bg-sidebar text-sidebar-foreground\", className)}\n        ref={ref}\n        {...props}\n      >\n        {children}\n      </div>\n    );\n  }\n\n  if (isMobile) {\n    return (\n      <Sheet open={openMobile} onOpenChange={setOpenMobile} {...props}>\n        <SheetContent\n          data-sidebar=\"sidebar\"\n          data-mobile=\"true\"\n          className=\"w-[--sidebar-width] bg-sidebar p-0 text-sidebar-foreground [&>button]:hidden\"\n          style={\n            {\n              \"--sidebar-width\": SIDEBAR_WIDTH_MOBILE,\n            } as React.CSSProperties\n          }\n          side={side}\n        >\n          <div className=\"flex h-full w-full flex-col\">{children}</div>\n        </SheetContent>\n      </Sheet>\n    );\n  }\n\n  return (\n    <div\n      ref={ref}\n      className=\"group peer hidden text-sidebar-foreground md:block\"\n      data-state={state}\n      data-collapsible={state === \"collapsed\" ? collapsible : \"\"}\n      data-variant={variant}\n      data-side={side}\n    >\n      {/* This is what handles the sidebar gap on desktop */}\n      <div\n        className={cn(\n          \"relative h-svh w-[--sidebar-width] bg-transparent transition-[width] duration-200 ease-linear\",\n          \"group-data-[collapsible=offcanvas]:w-0\",\n          \"group-data-[side=right]:rotate-180\",\n          variant === \"floating\" || variant === \"inset\"\n            ? \"group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)_+_theme(spacing.4))]\"\n            : \"group-data-[collapsible=icon]:w-[--sidebar-width-icon]\",\n        )}\n      />\n      <div\n        className={cn(\n          \"fixed inset-y-0 z-10 hidden h-svh w-[--sidebar-width] transition-[left,right,width] duration-200 ease-linear md:flex\",\n          side === \"left\"\n            ? \"left-0 group-data-[collapsible=offcanvas]:left-[calc(var(--sidebar-width)*-1)]\"\n            : \"right-0 group-data-[collapsible=offcanvas]:right-[calc(var(--sidebar-width)*-1)]\",\n          // Adjust the padding for floating and inset variants.\n          variant === \"floating\" || variant === \"inset\"\n            ? \"p-2 group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)_+_theme(spacing.4)_+2px)]\"\n            : \"group-data-[collapsible=icon]:w-[--sidebar-width-icon] group-data-[side=left]:border-r group-data-[side=right]:border-l\",\n          className,\n        )}\n        {...props}\n      >\n        <div\n          data-sidebar=\"sidebar\"\n          className=\"flex h-full w-full flex-col bg-sidebar group-data-[variant=floating]:rounded-lg group-data-[variant=floating]:border group-data-[variant=floating]:border-sidebar-border group-data-[variant=floating]:shadow\"\n        >\n          {children}\n        </div>\n      </div>\n    </div>\n  );\n});\nSidebar.displayName = \"Sidebar\";\n\nconst SidebarTrigger = React.forwardRef<React.ElementRef<typeof Button>, React.ComponentProps<typeof Button>>(\n  ({ className, onClick, ...props }, ref) => {\n    const { toggleSidebar } = useSidebar();\n\n    return (\n      <Button\n        ref={ref}\n        data-sidebar=\"trigger\"\n        variant=\"ghost\"\n        size=\"icon\"\n        className={cn(\"h-7 w-7\", className)}\n        onClick={(event) => {\n          onClick?.(event);\n          toggleSidebar();\n        }}\n        {...props}\n      >\n        <PanelLeft />\n        <span className=\"sr-only\">Toggle Sidebar</span>\n      </Button>\n    );\n  },\n);\nSidebarTrigger.displayName = \"SidebarTrigger\";\n\nconst SidebarRail = React.forwardRef<HTMLButtonElement, React.ComponentProps<\"button\">>(\n  ({ className, ...props }, ref) => {\n    const { toggleSidebar } = useSidebar();\n\n    return (\n      <button\n        ref={ref}\n        data-sidebar=\"rail\"\n        aria-label=\"Toggle Sidebar\"\n        tabIndex={-1}\n        onClick={toggleSidebar}\n        title=\"Toggle Sidebar\"\n        className={cn(\n          \"absolute inset-y-0 z-20 hidden w-4 -translate-x-1/2 transition-all ease-linear after:absolute after:inset-y-0 after:left-1/2 after:w-[2px] group-data-[side=left]:-right-4 group-data-[side=right]:left-0 hover:after:bg-sidebar-border sm:flex\",\n          \"[[data-side=left]_&]:cursor-w-resize [[data-side=right]_&]:cursor-e-resize\",\n          \"[[data-side=left][data-state=collapsed]_&]:cursor-e-resize [[data-side=right][data-state=collapsed]_&]:cursor-w-resize\",\n          \"group-data-[collapsible=offcanvas]:translate-x-0 group-data-[collapsible=offcanvas]:after:left-full group-data-[collapsible=offcanvas]:hover:bg-sidebar\",\n          \"[[data-side=left][data-collapsible=offcanvas]_&]:-right-2\",\n          \"[[data-side=right][data-collapsible=offcanvas]_&]:-left-2\",\n          className,\n        )}\n        {...props}\n      />\n    );\n  },\n);\nSidebarRail.displayName = \"SidebarRail\";\n\nconst SidebarInset = React.forwardRef<HTMLDivElement, React.ComponentProps<\"main\">>(({ className, ...props }, ref) => {\n  return (\n    <main\n      ref={ref}\n      className={cn(\n        \"relative flex min-h-svh flex-1 flex-col bg-background\",\n        \"peer-data-[variant=inset]:min-h-[calc(100svh-theme(spacing.4))] md:peer-data-[variant=inset]:m-2 md:peer-data-[state=collapsed]:peer-data-[variant=inset]:ml-2 md:peer-data-[variant=inset]:ml-0 md:peer-data-[variant=inset]:rounded-xl md:peer-data-[variant=inset]:shadow\",\n        className,\n      )}\n      {...props}\n    />\n  );\n});\nSidebarInset.displayName = \"SidebarInset\";\n\nconst SidebarInput = React.forwardRef<React.ElementRef<typeof Input>, React.ComponentProps<typeof Input>>(\n  ({ className, ...props }, ref) => {\n    return (\n      <Input\n        ref={ref}\n        data-sidebar=\"input\"\n        className={cn(\n          \"h-8 w-full bg-background shadow-none focus-visible:ring-2 focus-visible:ring-sidebar-ring\",\n          className,\n        )}\n        {...props}\n      />\n    );\n  },\n);\nSidebarInput.displayName = \"SidebarInput\";\n\nconst SidebarHeader = React.forwardRef<HTMLDivElement, React.ComponentProps<\"div\">>(({ className, ...props }, ref) => {\n  return <div ref={ref} data-sidebar=\"header\" className={cn(\"flex flex-col gap-2 p-2\", className)} {...props} />;\n});\nSidebarHeader.displayName = \"SidebarHeader\";\n\nconst SidebarFooter = React.forwardRef<HTMLDivElement, React.ComponentProps<\"div\">>(({ className, ...props }, ref) => {\n  return <div ref={ref} data-sidebar=\"footer\" className={cn(\"flex flex-col gap-2 p-2\", className)} {...props} />;\n});\nSidebarFooter.displayName = \"SidebarFooter\";\n\nconst SidebarSeparator = React.forwardRef<React.ElementRef<typeof Separator>, React.ComponentProps<typeof Separator>>(\n  ({ className, ...props }, ref) => {\n    return (\n      <Separator\n        ref={ref}\n        data-sidebar=\"separator\"\n        className={cn(\"mx-2 w-auto bg-sidebar-border\", className)}\n        {...props}\n      />\n    );\n  },\n);\nSidebarSeparator.displayName = \"SidebarSeparator\";\n\nconst SidebarContent = React.forwardRef<HTMLDivElement, React.ComponentProps<\"div\">>(({ className, ...props }, ref) => {\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"content\"\n      className={cn(\n        \"flex min-h-0 flex-1 flex-col gap-2 overflow-auto group-data-[collapsible=icon]:overflow-hidden\",\n        className,\n      )}\n      {...props}\n    />\n  );\n});\nSidebarContent.displayName = \"SidebarContent\";\n\nconst SidebarGroup = React.forwardRef<HTMLDivElement, React.ComponentProps<\"div\">>(({ className, ...props }, ref) => {\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"group\"\n      className={cn(\"relative flex w-full min-w-0 flex-col p-2\", className)}\n      {...props}\n    />\n  );\n});\nSidebarGroup.displayName = \"SidebarGroup\";\n\nconst SidebarGroupLabel = React.forwardRef<HTMLDivElement, React.ComponentProps<\"div\"> & { asChild?: boolean }>(\n  ({ className, asChild = false, ...props }, ref) => {\n    const Comp = asChild ? Slot : \"div\";\n\n    return (\n      <Comp\n        ref={ref}\n        data-sidebar=\"group-label\"\n        className={cn(\n          \"flex h-8 shrink-0 items-center rounded-md px-2 text-xs font-medium text-sidebar-foreground/70 outline-none ring-sidebar-ring transition-[margin,opa] duration-200 ease-linear focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n          \"group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0\",\n          className,\n        )}\n        {...props}\n      />\n    );\n  },\n);\nSidebarGroupLabel.displayName = \"SidebarGroupLabel\";\n\nconst SidebarGroupAction = React.forwardRef<HTMLButtonElement, React.ComponentProps<\"button\"> & { asChild?: boolean }>(\n  ({ className, asChild = false, ...props }, ref) => {\n    const Comp = asChild ? Slot : \"button\";\n\n    return (\n      <Comp\n        ref={ref}\n        data-sidebar=\"group-action\"\n        className={cn(\n          \"absolute right-3 top-3.5 flex aspect-square w-5 items-center justify-center rounded-md p-0 text-sidebar-foreground outline-none ring-sidebar-ring transition-transform hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n          // Increases the hit area of the button on mobile.\n          \"after:absolute after:-inset-2 after:md:hidden\",\n          \"group-data-[collapsible=icon]:hidden\",\n          className,\n        )}\n        {...props}\n      />\n    );\n  },\n);\nSidebarGroupAction.displayName = \"SidebarGroupAction\";\n\nconst SidebarGroupContent = React.forwardRef<HTMLDivElement, React.ComponentProps<\"div\">>(\n  ({ className, ...props }, ref) => (\n    <div ref={ref} data-sidebar=\"group-content\" className={cn(\"w-full text-sm\", className)} {...props} />\n  ),\n);\nSidebarGroupContent.displayName = \"SidebarGroupContent\";\n\nconst SidebarMenu = React.forwardRef<HTMLUListElement, React.ComponentProps<\"ul\">>(({ className, ...props }, ref) => (\n  <ul ref={ref} data-sidebar=\"menu\" className={cn(\"flex w-full min-w-0 flex-col gap-1\", className)} {...props} />\n));\nSidebarMenu.displayName = \"SidebarMenu\";\n\nconst SidebarMenuItem = React.forwardRef<HTMLLIElement, React.ComponentProps<\"li\">>(({ className, ...props }, ref) => (\n  <li ref={ref} data-sidebar=\"menu-item\" className={cn(\"group/menu-item relative\", className)} {...props} />\n));\nSidebarMenuItem.displayName = \"SidebarMenuItem\";\n\nconst sidebarMenuButtonVariants = cva(\n  \"peer/menu-button flex w-full items-center gap-2 overflow-hidden rounded-md p-2 text-left text-sm outline-none ring-sidebar-ring transition-[width,height,padding] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 group-has-[[data-sidebar=menu-action]]/menu-item:pr-8 aria-disabled:pointer-events-none aria-disabled:opacity-50 data-[active=true]:bg-sidebar-accent data-[active=true]:font-medium data-[active=true]:text-sidebar-accent-foreground data-[state=open]:hover:bg-sidebar-accent data-[state=open]:hover:text-sidebar-accent-foreground group-data-[collapsible=icon]:!size-8 group-data-[collapsible=icon]:!p-2 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0\",\n  {\n    variants: {\n      variant: {\n        default: \"hover:bg-sidebar-accent hover:text-sidebar-accent-foreground\",\n        outline:\n          \"bg-background shadow-[0_0_0_1px_hsl(var(--sidebar-border))] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground hover:shadow-[0_0_0_1px_hsl(var(--sidebar-accent))]\",\n      },\n      size: {\n        default: \"h-8 text-sm\",\n        sm: \"h-7 text-xs\",\n        lg: \"h-12 text-sm group-data-[collapsible=icon]:!p-0\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  },\n);\n\nconst SidebarMenuButton = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<\"button\"> & {\n    asChild?: boolean;\n    isActive?: boolean;\n    tooltip?: string | React.ComponentProps<typeof TooltipContent>;\n  } & VariantProps<typeof sidebarMenuButtonVariants>\n>(({ asChild = false, isActive = false, variant = \"default\", size = \"default\", tooltip, className, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"button\";\n  const { isMobile, state } = useSidebar();\n\n  const button = (\n    <Comp\n      ref={ref}\n      data-sidebar=\"menu-button\"\n      data-size={size}\n      data-active={isActive}\n      className={cn(sidebarMenuButtonVariants({ variant, size }), className)}\n      {...props}\n    />\n  );\n\n  if (!tooltip) {\n    return button;\n  }\n\n  if (typeof tooltip === \"string\") {\n    tooltip = {\n      children: tooltip,\n    };\n  }\n\n  return (\n    <Tooltip>\n      <TooltipTrigger asChild>{button}</TooltipTrigger>\n      <TooltipContent side=\"right\" align=\"center\" hidden={state !== \"collapsed\" || isMobile} {...tooltip} />\n    </Tooltip>\n  );\n});\nSidebarMenuButton.displayName = \"SidebarMenuButton\";\n\nconst SidebarMenuAction = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<\"button\"> & {\n    asChild?: boolean;\n    showOnHover?: boolean;\n  }\n>(({ className, asChild = false, showOnHover = false, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"button\";\n\n  return (\n    <Comp\n      ref={ref}\n      data-sidebar=\"menu-action\"\n      className={cn(\n        \"absolute right-1 top-1.5 flex aspect-square w-5 items-center justify-center rounded-md p-0 text-sidebar-foreground outline-none ring-sidebar-ring transition-transform peer-hover/menu-button:text-sidebar-accent-foreground hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 after:md:hidden\",\n        \"peer-data-[size=sm]/menu-button:top-1\",\n        \"peer-data-[size=default]/menu-button:top-1.5\",\n        \"peer-data-[size=lg]/menu-button:top-2.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        showOnHover &&\n          \"group-focus-within/menu-item:opacity-100 group-hover/menu-item:opacity-100 data-[state=open]:opacity-100 peer-data-[active=true]/menu-button:text-sidebar-accent-foreground md:opacity-0\",\n        className,\n      )}\n      {...props}\n    />\n  );\n});\nSidebarMenuAction.displayName = \"SidebarMenuAction\";\n\nconst SidebarMenuBadge = React.forwardRef<HTMLDivElement, React.ComponentProps<\"div\">>(\n  ({ className, ...props }, ref) => (\n    <div\n      ref={ref}\n      data-sidebar=\"menu-badge\"\n      className={cn(\n        \"pointer-events-none absolute right-1 flex h-5 min-w-5 select-none items-center justify-center rounded-md px-1 text-xs font-medium tabular-nums text-sidebar-foreground\",\n        \"peer-hover/menu-button:text-sidebar-accent-foreground peer-data-[active=true]/menu-button:text-sidebar-accent-foreground\",\n        \"peer-data-[size=sm]/menu-button:top-1\",\n        \"peer-data-[size=default]/menu-button:top-1.5\",\n        \"peer-data-[size=lg]/menu-button:top-2.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className,\n      )}\n      {...props}\n    />\n  ),\n);\nSidebarMenuBadge.displayName = \"SidebarMenuBadge\";\n\nconst SidebarMenuSkeleton = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    showIcon?: boolean;\n  }\n>(({ className, showIcon = false, ...props }, ref) => {\n  // Random width between 50 to 90%.\n  const width = React.useMemo(() => {\n    return `${Math.floor(Math.random() * 40) + 50}%`;\n  }, []);\n\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"menu-skeleton\"\n      className={cn(\"flex h-8 items-center gap-2 rounded-md px-2\", className)}\n      {...props}\n    >\n      {showIcon && <Skeleton className=\"size-4 rounded-md\" data-sidebar=\"menu-skeleton-icon\" />}\n      <Skeleton\n        className=\"h-4 max-w-[--skeleton-width] flex-1\"\n        data-sidebar=\"menu-skeleton-text\"\n        style={\n          {\n            \"--skeleton-width\": width,\n          } as React.CSSProperties\n        }\n      />\n    </div>\n  );\n});\nSidebarMenuSkeleton.displayName = \"SidebarMenuSkeleton\";\n\nconst SidebarMenuSub = React.forwardRef<HTMLUListElement, React.ComponentProps<\"ul\">>(\n  ({ className, ...props }, ref) => (\n    <ul\n      ref={ref}\n      data-sidebar=\"menu-sub\"\n      className={cn(\n        \"mx-3.5 flex min-w-0 translate-x-px flex-col gap-1 border-l border-sidebar-border px-2.5 py-0.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className,\n      )}\n      {...props}\n    />\n  ),\n);\nSidebarMenuSub.displayName = \"SidebarMenuSub\";\n\nconst SidebarMenuSubItem = React.forwardRef<HTMLLIElement, React.ComponentProps<\"li\">>(({ ...props }, ref) => (\n  <li ref={ref} {...props} />\n));\nSidebarMenuSubItem.displayName = \"SidebarMenuSubItem\";\n\nconst SidebarMenuSubButton = React.forwardRef<\n  HTMLAnchorElement,\n  React.ComponentProps<\"a\"> & {\n    asChild?: boolean;\n    size?: \"sm\" | \"md\";\n    isActive?: boolean;\n  }\n>(({ asChild = false, size = \"md\", isActive, className, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"a\";\n\n  return (\n    <Comp\n      ref={ref}\n      data-sidebar=\"menu-sub-button\"\n      data-size={size}\n      data-active={isActive}\n      className={cn(\n        \"flex h-7 min-w-0 -translate-x-px items-center gap-2 overflow-hidden rounded-md px-2 text-sidebar-foreground outline-none ring-sidebar-ring aria-disabled:pointer-events-none aria-disabled:opacity-50 hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0 [&>svg]:text-sidebar-accent-foreground\",\n        \"data-[active=true]:bg-sidebar-accent data-[active=true]:text-sidebar-accent-foreground\",\n        size === \"sm\" && \"text-xs\",\n        size === \"md\" && \"text-sm\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className,\n      )}\n      {...props}\n    />\n  );\n});\nSidebarMenuSubButton.displayName = \"SidebarMenuSubButton\";\n\nexport {\n  Sidebar,\n  SidebarContent,\n  SidebarFooter,\n  SidebarGroup,\n  SidebarGroupAction,\n  SidebarGroupContent,\n  SidebarGroupLabel,\n  SidebarHeader,\n  SidebarInput,\n  SidebarInset,\n  SidebarMenu,\n  SidebarMenuAction,\n  SidebarMenuBadge,\n  SidebarMenuButton,\n  SidebarMenuItem,\n  SidebarMenuSkeleton,\n  SidebarMenuSub,\n  SidebarMenuSubButton,\n  SidebarMenuSubItem,\n  SidebarProvider,\n  SidebarRail,\n  SidebarSeparator,\n  SidebarTrigger,\n  useSidebar,\n};\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\components\\ui\\skeleton.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\components\\ui\\slider.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\components\\ui\\sonner.tsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":27,"column":19,"nodeType":"Identifier","messageId":"namedExport","endLine":27,"endColumn":24}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useTheme } from \"next-themes\";\nimport { Toaster as Sonner, toast } from \"sonner\";\n\ntype ToasterProps = React.ComponentProps<typeof Sonner>;\n\nconst Toaster = ({ ...props }: ToasterProps) => {\n  const { theme = \"system\" } = useTheme();\n\n  return (\n    <Sonner\n      theme={theme as ToasterProps[\"theme\"]}\n      className=\"toaster group\"\n      toastOptions={{\n        classNames: {\n          toast:\n            \"group toast group-[.toaster]:bg-background group-[.toaster]:text-foreground group-[.toaster]:border-border group-[.toaster]:shadow-lg\",\n          description: \"group-[.toast]:text-muted-foreground\",\n          actionButton: \"group-[.toast]:bg-primary group-[.toast]:text-primary-foreground\",\n          cancelButton: \"group-[.toast]:bg-muted group-[.toast]:text-muted-foreground\",\n        },\n      }}\n      {...props}\n    />\n  );\n};\n\nexport { Toaster, toast };\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\components\\ui\\switch.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\components\\ui\\table.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\components\\ui\\tabs.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\components\\ui\\textarea.tsx","messages":[{"ruleId":"@typescript-eslint/no-empty-object-type","severity":2,"message":"An interface declaring no members is equivalent to its supertype.","line":5,"column":18,"nodeType":"Identifier","messageId":"noEmptyInterfaceWithSuper","endLine":5,"endColumn":31,"suggestions":[{"messageId":"replaceEmptyInterfaceWithSuper","fix":{"range":[75,159],"text":"type TextareaProps = React.TextareaHTMLAttributes<HTMLTextAreaElement>"},"desc":"Replace empty interface with a type alias."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import * as React from \"react\";\n\nimport { cn } from \"@/lib/utils\";\n\nexport interface TextareaProps extends React.TextareaHTMLAttributes<HTMLTextAreaElement> {}\n\nconst Textarea = React.forwardRef<HTMLTextAreaElement, TextareaProps>(({ className, ...props }, ref) => {\n  return (\n    <textarea\n      className={cn(\n        \"flex w-full rounded-md border border-input bg-background px-3 py-2.5 sm:py-2 text-[11px] sm:text-xs ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-60 touch-manipulation transition-all duration-200 hover:border-input/80 min-h-[100px] sm:min-h-[80px]\",\n        className,\n      )}\n      ref={ref}\n      {...props}\n    />\n  );\n});\nTextarea.displayName = \"Textarea\";\n\nexport { Textarea };\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\components\\ui\\toast.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\components\\ui\\toaster.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\components\\ui\\toggle-group.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\components\\ui\\toggle.tsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":37,"column":18,"nodeType":"Identifier","messageId":"namedExport","endLine":37,"endColumn":32}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import * as React from \"react\";\nimport * as TogglePrimitive from \"@radix-ui/react-toggle\";\nimport { cva, type VariantProps } from \"class-variance-authority\";\n\nimport { cn } from \"@/lib/utils\";\n\nconst toggleVariants = cva(\n  \"inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors hover:bg-muted hover:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-transparent\",\n        outline: \"border border-input bg-transparent hover:bg-accent hover:text-accent-foreground\",\n      },\n      size: {\n        default: \"h-10 px-3\",\n        sm: \"h-9 px-2.5\",\n        lg: \"h-11 px-5\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  },\n);\n\nconst Toggle = React.forwardRef<\n  React.ElementRef<typeof TogglePrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof TogglePrimitive.Root> & VariantProps<typeof toggleVariants>\n>(({ className, variant, size, ...props }, ref) => (\n  <TogglePrimitive.Root ref={ref} className={cn(toggleVariants({ variant, size, className }))} {...props} />\n));\n\nToggle.displayName = TogglePrimitive.Root.displayName;\n\nexport { Toggle, toggleVariants };\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\components\\ui\\tooltip.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\components\\ui\\use-toast.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\components\\ui\\visually-hidden.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\config\\auth.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\contexts\\AuthContext.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useCallback has a missing dependency: 'getDepartmentsCached'. Either include it or remove the dependency array.","line":221,"column":6,"nodeType":"ArrayExpression","endLine":221,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [getDepartmentsCached]","fix":{"range":[8681,8683],"text":"[getDepartmentsCached]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'convertUserProfileToUser'. Either include it or remove the dependency array.","line":417,"column":6,"nodeType":"ArrayExpression","endLine":417,"endColumn":18,"suggestions":[{"desc":"Update the dependencies array to be: [checkRoles, convertUserProfileToUser]","fix":{"range":[16176,16188],"text":"[checkRoles, convertUserProfileToUser]"}}]},{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":532,"column":14,"nodeType":"Identifier","messageId":"namedExport","endLine":532,"endColumn":21}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { createContext, useContext, useEffect, useState, useMemo, useRef, useCallback, ReactNode } from \"react\";\nimport {\n  register,\n  login,\n  logout,\n  resetPassword,\n  onAuthChange,\n  getUserProfile,\n  UserProfile,\n  signInWithGoogle as signInWithGoogleService,\n} from \"@/services/firebase/authService\";\nimport { REQUIRE_EMAIL_VERIFICATION } from \"@/config/auth\";\nimport { getPermission, onPermissionCacheChange } from \"@/services/firebase/rolePermissionsService\";\nimport { Timestamp } from \"firebase/firestore\";\n\ninterface User {\n  id: string;\n  email: string;\n  emailVerified: boolean;\n  fullName: string;\n  phone?: string;\n  dateOfBirth?: string;\n  roles: string[];\n  lastLoginAt?: Timestamp | Date | null;\n}\n\ninterface AuthContextType {\n  user: User | null;\n  isAdmin: boolean;\n  isSuperAdmin: boolean;\n  isTeamLeader: boolean;\n  signIn: (email: string, password: string) => Promise<{ success: boolean; message?: string }>;\n  signInWithGoogle: () => Promise<{ success: boolean; message?: string }>;\n  signUp: (\n    email: string,\n    password: string,\n    fullName: string,\n    phone?: string,\n    dateOfBirth?: string,\n    selectedTeamId?: string,\n  ) => Promise<{ success: boolean; message?: string; user: User | null }>;\n  signOut: () => Promise<void>;\n  resetPassword: (email: string) => Promise<{ success: boolean; message?: string }>;\n  loading: boolean;\n}\n\nconst AuthContext = createContext<AuthContextType | undefined>(undefined);\n\nexport const AuthProvider = ({ children }: { children: ReactNode }) => {\n  const [user, setUser] = useState<User | null>(null);\n  const [currentUserProfile, setCurrentUserProfile] = useState<UserProfile | null>(null);\n  const [isAdmin, setIsAdmin] = useState(false);\n  const [isSuperAdmin, setIsSuperAdmin] = useState(false);\n  const [isTeamLeader, setIsTeamLeader] = useState(false);\n  const [loading, setLoading] = useState(true);\n  \n  // Departments cache - performans iin\n  const departmentsCacheRef = useRef<Array<{ id: string; managerId?: string }> | null>(null);\n  const departmentsCacheTimeRef = useRef<number>(0);\n  const CACHE_DURATION = 5 * 60 * 1000; // 5 dakika\n\n  // Departments' cache'den al veya ykle\n  const getDepartmentsCached = async (): Promise<Array<{ id: string; managerId?: string }>> => {\n    const now = Date.now();\n    // Cache varsa ve 5 dakikadan eski deilse kullan\n    if (departmentsCacheRef.current && (now - departmentsCacheTimeRef.current) < CACHE_DURATION) {\n      return departmentsCacheRef.current;\n    }\n    \n    // Cache yoksa veya eskiyse ykle\n    try {\n      const { getDepartments } = await import(\"@/services/firebase/departmentService\");\n      const departments = await getDepartments();\n      departmentsCacheRef.current = departments;\n      departmentsCacheTimeRef.current = now;\n      return departments;\n    } catch (error) {\n      // Hata durumunda cache'i kullan veya bo array dndr\n      if (departmentsCacheRef.current) {\n        return departmentsCacheRef.current;\n      }\n      return [];\n    }\n  };\n\n  // Son kontrol edilen user ID ve rolleri cache'le (performans iin)\n  const lastCheckedUserIdRef = useRef<string | null>(null);\n  const lastCheckedRolesRef = useRef<{ isSuperAdmin: boolean; isAdmin: boolean; isTeamLeader: boolean } | null>(null);\n\n  // Check roles based on role_permissions system - Firestore'dan kontrol et\n  // useCallback ile memoize et (performans iin)\n  // Optimized: lk yklemede sadece rol array'inden kontrol et, permission kontrollerini defer et\n  const checkRoles = useCallback(async (userProfile: UserProfile | null, immediate: boolean = false) => {\n    const normalizedRoles = normalizeRoles(userProfile?.role);\n\n    if (!userProfile || normalizedRoles.length === 0) {\n      setIsSuperAdmin(false);\n      setIsAdmin(false);\n      setIsTeamLeader(false);\n      lastCheckedUserIdRef.current = null;\n      lastCheckedRolesRef.current = null;\n      return;\n    }\n\n    // Ayn user iin cache'den dndr (performans iin)\n    if (lastCheckedUserIdRef.current === userProfile.id && lastCheckedRolesRef.current) {\n      setIsSuperAdmin(lastCheckedRolesRef.current.isSuperAdmin);\n      setIsAdmin(lastCheckedRolesRef.current.isAdmin);\n      setIsTeamLeader(lastCheckedRolesRef.current.isTeamLeader);\n      return;\n    }\n\n    const userRoles = normalizedRoles;\n    \n    // lk yklemede hzl kontrol: Sadece rol array'inden kontrol et\n    // Permission kontrollerini defer et (non-blocking)\n    const hasSuperAdminRole = userRoles.some(role => role === \"super_admin\" || role === \"main_admin\");\n    const hasTeamLeaderRole = userRoles.some(role => role === \"team_leader\");\n    \n    // Hzl rol kontrol - hemen set et (UI blocking'i nle)\n    setIsSuperAdmin(hasSuperAdminRole);\n    setIsAdmin(hasSuperAdminRole);\n    setIsTeamLeader(hasTeamLeaderRole);\n\n    // Permission kontrollerini defer et (non-blocking)\n    // immediate=true ise hemen yap (signIn/signUp gibi durumlar iin)\n    const checkPermissions = async () => {\n      let hasSuperAdminPermission = hasSuperAdminRole;\n      let hasTeamLeaderPermission = hasTeamLeaderRole;\n\n      // Super Admin permission kontrol - sadece rol varsa kontrol et\n      if (hasSuperAdminRole) {\n        for (const role of userRoles) {\n          if (role === \"super_admin\" || role === \"main_admin\") {\n            try {\n              // Lazy load permissions service\n              const { getRolePermissions } = await import(\"@/services/firebase/rolePermissionsService\");\n              await getRolePermissions();\n              \n              const permission = await getPermission(role, \"role_permissions\", true);\n              hasSuperAdminPermission = permission?.canRead === true;\n              if (hasSuperAdminPermission) break;\n            } catch (error: unknown) {\n              if (import.meta.env.DEV) {\n                console.error(\"Error checking super admin permission:\", error);\n              }\n              // Fallback: rol array'inden kontrol - super_admin rol varsa true\n              hasSuperAdminPermission = true;\n              break;\n            }\n          }\n        }\n      }\n\n      // Team Leader permission kontrol - sadece rol varsa kontrol et\n      if (hasTeamLeaderRole) {\n        for (const role of userRoles) {\n          if (role === \"team_leader\") {\n            try {\n              // Lazy load permissions service\n              const { getRolePermissions } = await import(\"@/services/firebase/rolePermissionsService\");\n              await getRolePermissions();\n              \n              // Team leader iin departments kaynanda canUpdate yetkisi var m?\n              const permission = await getPermission(role, \"departments\", true);\n              hasTeamLeaderPermission = permission?.canUpdate === true;\n              if (hasTeamLeaderPermission) break;\n            } catch (error: unknown) {\n              if (import.meta.env.DEV) {\n                console.error(\"Error checking team leader permission:\", error);\n              }\n              // Fallback: manager kontrol - lazy load departments\n              try {\n                const departments = await getDepartmentsCached();\n                hasTeamLeaderPermission = departments.some((dept) => dept.managerId === userProfile.id);\n                if (hasTeamLeaderPermission) break;\n              } catch (deptError: unknown) {\n                if (import.meta.env.DEV) {\n                  console.error(\"Error checking team leader from departments:\", deptError);\n                }\n              }\n            }\n          }\n        }\n      }\n\n      // Permission kontrolleri tamamlandktan sonra gncelle\n      setIsSuperAdmin(hasSuperAdminPermission);\n      setIsAdmin(hasSuperAdminPermission);\n      setIsTeamLeader(hasTeamLeaderPermission);\n\n      // Cache'e kaydet (performans iin)\n      lastCheckedUserIdRef.current = userProfile.id;\n      lastCheckedRolesRef.current = {\n        isSuperAdmin: hasSuperAdminPermission,\n        isAdmin: hasSuperAdminPermission,\n        isTeamLeader: hasTeamLeaderPermission,\n      };\n    };\n\n    // lk yklemede defer et (non-blocking), immediate durumlarda hemen yap\n    if (immediate) {\n      await checkPermissions();\n    } else {\n      // requestIdleCallback kullan (tarayc msait olduunda)\n      if (typeof window !== 'undefined' && 'requestIdleCallback' in window) {\n        window.requestIdleCallback(() => {\n          checkPermissions().catch(() => {\n            // Silently handle errors\n          });\n        }, { timeout: 2000 });\n      } else {\n        // Fallback: setTimeout ile defer et\n        setTimeout(() => {\n          checkPermissions().catch(() => {\n            // Silently handle errors\n          });\n        }, 100);\n      }\n    }\n  }, []);\n\n  const normalizeRoles = (roles?: string[] | null): string[] => {\n    if (!roles || roles.length === 0) return [];\n    const mapped = roles.map((r) => (r === \"admin\" ? \"super_admin\" : r));\n    // Tekrarlananlar temizle\n    return Array.from(new Set(mapped));\n  };\n\n  const convertUserProfileToUser = (profile: UserProfile | null): User | null => {\n    if (!profile) return null;\n    \n    const normalizedRoles = normalizeRoles(profile.role);\n\n    return {\n      id: profile.id,\n      email: profile.email,\n      emailVerified: profile.emailVerified,\n      fullName: profile.fullName || profile.displayName,\n      phone: profile.phone,\n      dateOfBirth: profile.dateOfBirth,\n      roles: normalizedRoles,\n      lastLoginAt: profile.lastLoginAt,\n    };\n  };\n\n  useEffect(() => {\n    // Firebase Auth state listener\n    let unsubscribe: (() => void) | null = null;\n    let isMounted = true;\n    \n    // Timeout: Eer 5 saniye iinde auth state gelmezse loading'i false yap\n    // Bu, Firebase balatlamazsa veya network sorunlar varsa kullancnn taklp kalmasn nler\n    const loadingTimeout = setTimeout(() => {\n      if (isMounted) {\n        setLoading(false);\n        if (import.meta.env.DEV) {\n          if (import.meta.env.DEV) {\n            console.warn(\"Auth state timeout (5 saniye) - loading'i false yapyoruz\");\n          }\n        }\n      }\n    }, 5000);\n    \n    // Firebase Auth state listener' hemen balat\n    try {\n      unsubscribe = onAuthChange(async (userProfile) => {\n        if (!isMounted) return;\n        \n        clearTimeout(loadingTimeout);\n        \n        try {\n          if (userProfile) {\n            const userData = convertUserProfileToUser(userProfile);\n            setUser(userData);\n            setCurrentUserProfile(userProfile);\n            // Check roles based on role_permissions system\n            // lk yklemede non-blocking (immediate=false)\n            await checkRoles(userProfile, false);\n            \n            // Listen to permission cache changes for real-time updates\n            // Debounce ile optimize et (ok sk tetiklenmeyi nle)\n            let permissionUpdateTimeout: ReturnType<typeof setTimeout> | null = null;\n            const unsubscribePermissions = onPermissionCacheChange(async () => {\n              if (!isMounted) return;\n              \n              // Debounce: Son deiiklikten 500ms sonra gncelle\n              if (permissionUpdateTimeout) {\n                clearTimeout(permissionUpdateTimeout);\n              }\n              \n              permissionUpdateTimeout = setTimeout(async () => {\n                if (!isMounted) return;\n                \n                // Departments cache'ini invalidate et (rol deiiklikleri departments' etkileyebilir)\n                departmentsCacheRef.current = null;\n                departmentsCacheTimeRef.current = 0;\n                \n                // Kullanc profilini yeniden ykle (rol deiikliklerini yakalamak iin)\n                // Non-blocking: requestIdleCallback veya setTimeout ile defer et\n                const updateProfile = async () => {\n                  try {\n                    const { getUserProfile } = await import(\"@/services/firebase/authService\");\n                    const { auth } = await import(\"@/lib/firebase\");\n                    if (auth?.currentUser && isMounted) {\n                      const updatedProfile = await getUserProfile(auth.currentUser.uid);\n                      if (updatedProfile && isMounted) {\n                        const updatedUserData = convertUserProfileToUser(updatedProfile);\n                        setUser(updatedUserData);\n                        setCurrentUserProfile(updatedProfile);\n                        await checkRoles(updatedProfile, false);\n                      } else if (isMounted) {\n                        // Profil yklenemezse mevcut userProfile ile devam et\n                        await checkRoles(userProfile, false);\n                      }\n                    } else if (isMounted) {\n                      // Auth yoksa mevcut userProfile ile devam et\n                      await checkRoles(userProfile, false);\n                    }\n                  } catch (error) {\n                    // Hata durumunda mevcut userProfile ile devam et\n                    if (import.meta.env.DEV) {\n                      console.error(\"Permission cache deiikliinde profil yenileme hatas:\", error);\n                    }\n                    if (isMounted) {\n                      await checkRoles(userProfile, false);\n                    }\n                  }\n                };\n                \n                // Non-blocking update\n                if (typeof window !== 'undefined' && 'requestIdleCallback' in window) {\n                  window.requestIdleCallback(() => {\n                    updateProfile().catch(() => {\n                      // Silently handle errors\n                    });\n                  }, { timeout: 1000 });\n                } else {\n                  setTimeout(() => {\n                    updateProfile().catch(() => {\n                      // Silently handle errors\n                    });\n                  }, 100);\n                }\n              }, 500); // 500ms debounce\n            });\n            \n            // Store unsubscribe function for cleanup\n            if (isMounted) {\n              (window as Window & { __unsubscribePermissions?: () => void }).__unsubscribePermissions = unsubscribePermissions;\n            }\n          } else {\n            setUser(null);\n            setCurrentUserProfile(null);\n            setIsAdmin(false);\n            setIsSuperAdmin(false);\n            setIsTeamLeader(false);\n            // Cache'i temizle\n            lastCheckedUserIdRef.current = null;\n            lastCheckedRolesRef.current = null;\n          }\n        } catch (error) {\n          // Callback iinde hata oluursa\n          if (import.meta.env.DEV) {\n            if (import.meta.env.DEV) {\n              console.error(\"Auth state callback hatas:\", error);\n            }\n          }\n          // Hata durumunda user' null yap ve loading'i false yap\n          if (isMounted) {\n            setUser(null);\n            setCurrentUserProfile(null);\n            setIsAdmin(false);\n            setIsSuperAdmin(false);\n            setIsTeamLeader(false);\n          }\n        } finally {\n          if (isMounted) {\n            setLoading(false);\n          }\n        }\n      });\n    } catch (error) {\n      // Firebase initialization hatas durumunda\n      if (import.meta.env.DEV) {\n        if (import.meta.env.DEV) {\n          console.error(\"Auth state listener hatas:\", error);\n        }\n      }\n      clearTimeout(loadingTimeout);\n      if (isMounted) {\n        setLoading(false);\n        setUser(null);\n        setCurrentUserProfile(null);\n        setIsAdmin(false);\n        setIsSuperAdmin(false);\n        setIsTeamLeader(false);\n      }\n    }\n\n    return () => {\n      isMounted = false;\n      clearTimeout(loadingTimeout);\n      if (unsubscribe) {\n        unsubscribe();\n      }\n      // Cleanup permission cache listener\n      const windowWithUnsubscribe = window as Window & { __unsubscribePermissions?: () => void };\n      if (windowWithUnsubscribe.__unsubscribePermissions) {\n        windowWithUnsubscribe.__unsubscribePermissions();\n        delete windowWithUnsubscribe.__unsubscribePermissions;\n      }\n      // Cache'i temizle\n      lastCheckedUserIdRef.current = null;\n      lastCheckedRolesRef.current = null;\n    };\n  }, [checkRoles]); // checkRoles dependency eklendi\n\n  const signIn = async (email: string, password: string) => {\n    try {\n      const result = await login(email, password);\n      \n      if (result.success && result.user) {\n        const userData = convertUserProfileToUser(result.user);\n        setUser(userData);\n        \n        // Check roles based on role_permissions system\n        await checkRoles(result.user);\n        \n        // E-posta dorulanmamsa dorulama sayfasna ynlendir - sadece flag true ise\n        if (REQUIRE_EMAIL_VERIFICATION && userData && !userData.emailVerified) {\n          window.location.href = \"/verify-email-prompt\";\n          return { success: true };\n        }\n        \n        window.location.href = \"/\";\n        return { success: true };\n      } else {\n        return { success: false, message: result.message || 'Giri baarsz' };\n      }\n    } catch (error: unknown) {\n      return { success: false, message: error instanceof Error ? error.message : 'Giri baarsz' };\n    }\n  };\n\n  const signInWithGoogle = async () => {\n    try {\n      const result = await signInWithGoogleService();\n      \n      if (result.success && result.user) {\n        const userData = convertUserProfileToUser(result.user);\n        setUser(userData);\n        \n        // Check roles based on role_permissions system\n        // Google sign in durumunda immediate=true (hzl permission kontrol)\n        await checkRoles(result.user, true);\n        \n        window.location.href = \"/\";\n        return { success: true };\n      } else {\n        return { success: false, message: result.message || 'Google ile giri baarsz' };\n      }\n    } catch (error: unknown) {\n      return { success: false, message: error.message || 'Google ile giri baarsz' };\n    }\n  };\n\n  const signUp = async (email: string, password: string, fullName: string, phone?: string, dateOfBirth?: string, selectedTeamId?: string) => {\n    try {\n      const result = await register(email, password, fullName, phone, dateOfBirth, selectedTeamId);\n\n      if (result.success && result.user) {\n        const userData = convertUserProfileToUser(result.user);\n        // Email dorulamas yaplmadan kullancy giri yaptrma\n        // Kullanc email dorulamas yapana kadar beklemeli\n        return {\n          success: true,\n          message: result.message || 'Kayt baarl! Ltfen e-posta adresinize gnderilen dorulama balantsna tklayn.',\n          user: userData,\n        };\n      } else {\n        return {\n          success: false,\n          message: result.message || 'Kayt baarsz',\n          user: null,\n        };\n      }\n    } catch (error: unknown) {\n      const errorMsg = error instanceof Error ? error.message : String(error);\n      return {\n        success: false,\n        message: errorMsg || 'Kayt baarsz',\n        user: null,\n      };\n    }\n  };\n\n  const signOut = async () => {\n    try {\n      await logout();\n    } catch (error) {\n      // Ignore logout errors\n    } finally {\n      setUser(null);\n      setCurrentUserProfile(null);\n      setIsAdmin(false);\n      setIsSuperAdmin(false);\n      setIsTeamLeader(false);\n      window.location.href = \"/auth\";\n    }\n  };\n\n  const handleResetPassword = async (email: string) => {\n    try {\n      return await resetPassword(email);\n    } catch (error: unknown) {\n      const errorMsg = error instanceof Error ? error.message : String(error);\n      return {\n        success: false,\n        message: errorMsg || 'ifre sfrlama baarsz',\n      };\n    }\n  };\n\n  return (\n    <AuthContext.Provider value={{ user, isAdmin, isSuperAdmin, isTeamLeader, signIn, signInWithGoogle, signUp, signOut, resetPassword: handleResetPassword, loading }}>\n      {children}\n    </AuthContext.Provider>\n  );\n};\n\nexport const useAuth = () => {\n  const context = useContext(AuthContext);\n  if (context === undefined) {\n    throw new Error(\"useAuth must be used within an AuthProvider\");\n  }\n  return context;\n};\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\contexts\\SidebarContext.tsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":9,"column":14,"nodeType":"Identifier","messageId":"namedExport","endLine":9,"endColumn":31}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { createContext, useContext, ReactNode } from \"react\";\n\ninterface SidebarContextType {\n  closeSidebar: () => void;\n}\n\nconst SidebarContext = createContext<SidebarContextType | undefined>(undefined);\n\nexport const useSidebarContext = () => {\n  const context = useContext(SidebarContext);\n  return context;\n};\n\ninterface SidebarProviderProps {\n  children: ReactNode;\n  closeSidebar: () => void;\n}\n\nexport const SidebarProvider = ({ children, closeSidebar }: SidebarProviderProps) => {\n  return (\n    <SidebarContext.Provider value={{ closeSidebar }}>\n      {children}\n    </SidebarContext.Provider>\n  );\n};\n\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\hooks\\use-mobile.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\hooks\\use-toast.ts","messages":[{"ruleId":null,"message":"Unused eslint-disable directive (no problems were reported from 'react-hooks/exhaustive-deps').","line":177,"column":5,"severity":1,"nodeType":null,"fix":{"range":[3770,3825],"text":" "}}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":1,"source":"import * as React from \"react\";\n\nimport type { ToastActionElement, ToastProps } from \"@/components/ui/toast\";\n\nconst TOAST_LIMIT = 1;\nconst TOAST_REMOVE_DELAY = 1000000;\n\ntype ToasterToast = ToastProps & {\n  id: string;\n  title?: React.ReactNode;\n  description?: React.ReactNode;\n  action?: ToastActionElement;\n};\n\nconst actionTypes = {\n  ADD_TOAST: \"ADD_TOAST\",\n  UPDATE_TOAST: \"UPDATE_TOAST\",\n  DISMISS_TOAST: \"DISMISS_TOAST\",\n  REMOVE_TOAST: \"REMOVE_TOAST\",\n} as const;\n\nlet count = 0;\n\nfunction genId() {\n  count = (count + 1) % Number.MAX_SAFE_INTEGER;\n  return count.toString();\n}\n\ntype ActionType = typeof actionTypes;\n\ntype Action =\n  | {\n      type: ActionType[\"ADD_TOAST\"];\n      toast: ToasterToast;\n    }\n  | {\n      type: ActionType[\"UPDATE_TOAST\"];\n      toast: Partial<ToasterToast>;\n    }\n  | {\n      type: ActionType[\"DISMISS_TOAST\"];\n      toastId?: ToasterToast[\"id\"];\n    }\n  | {\n      type: ActionType[\"REMOVE_TOAST\"];\n      toastId?: ToasterToast[\"id\"];\n    };\n\ninterface State {\n  toasts: ToasterToast[];\n}\n\nconst toastTimeouts = new Map<string, ReturnType<typeof setTimeout>>();\n\nconst addToRemoveQueue = (toastId: string) => {\n  if (toastTimeouts.has(toastId)) {\n    return;\n  }\n\n  const timeout = setTimeout(() => {\n    toastTimeouts.delete(toastId);\n    dispatch({\n      type: \"REMOVE_TOAST\",\n      toastId: toastId,\n    });\n  }, TOAST_REMOVE_DELAY);\n\n  toastTimeouts.set(toastId, timeout);\n};\n\nexport const reducer = (state: State, action: Action): State => {\n  switch (action.type) {\n    case \"ADD_TOAST\":\n      return {\n        ...state,\n        toasts: [action.toast, ...state.toasts].slice(0, TOAST_LIMIT),\n      };\n\n    case \"UPDATE_TOAST\":\n      return {\n        ...state,\n        toasts: state.toasts.map((t) => (t.id === action.toast.id ? { ...t, ...action.toast } : t)),\n      };\n\n    case \"DISMISS_TOAST\": {\n      const { toastId } = action;\n\n      // ! Side effects ! - This could be extracted into a dismissToast() action,\n      // but I'll keep it here for simplicity\n      if (toastId) {\n        addToRemoveQueue(toastId);\n      } else {\n        state.toasts.forEach((toast) => {\n          addToRemoveQueue(toast.id);\n        });\n      }\n\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === toastId || toastId === undefined\n            ? {\n                ...t,\n                open: false,\n              }\n            : t,\n        ),\n      };\n    }\n    case \"REMOVE_TOAST\":\n      if (action.toastId === undefined) {\n        return {\n          ...state,\n          toasts: [],\n        };\n      }\n      return {\n        ...state,\n        toasts: state.toasts.filter((t) => t.id !== action.toastId),\n      };\n  }\n};\n\nconst listeners: Array<(state: State) => void> = [];\n\nlet memoryState: State = { toasts: [] };\n\nfunction dispatch(action: Action) {\n  memoryState = reducer(memoryState, action);\n  listeners.forEach((listener) => {\n    listener(memoryState);\n  });\n}\n\ntype Toast = Omit<ToasterToast, \"id\">;\n\nfunction toast({ ...props }: Toast) {\n  const id = genId();\n\n  const update = (props: ToasterToast) =>\n    dispatch({\n      type: \"UPDATE_TOAST\",\n      toast: { ...props, id },\n    });\n  const dismiss = () => dispatch({ type: \"DISMISS_TOAST\", toastId: id });\n\n  dispatch({\n    type: \"ADD_TOAST\",\n    toast: {\n      ...props,\n      id,\n      open: true,\n      onOpenChange: (open) => {\n        if (!open) dismiss();\n      },\n    },\n  });\n\n  return {\n    id: id,\n    dismiss,\n    update,\n  };\n}\n\nfunction useToast() {\n  const [state, setState] = React.useState<State>(memoryState);\n\n  React.useEffect(() => {\n    listeners.push(setState);\n    return () => {\n      const index = listeners.indexOf(setState);\n      if (index > -1) {\n        listeners.splice(index, 1);\n      }\n    };\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n\n  return {\n    ...state,\n    toast,\n    dismiss: (toastId?: string) => dispatch({ type: \"DISMISS_TOAST\", toastId }),\n  };\n}\n\nexport { useToast, toast };\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\hooks\\useAdminStats.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\hooks\\useDashboardStats.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\hooks\\usePermissions.ts","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useCallback has an unnecessary dependency: 'refreshKey'. Either exclude it or remove the dependency array.","line":64,"column":6,"nodeType":"ArrayExpression","endLine":64,"endColumn":34,"suggestions":[{"desc":"Update the dependencies array to be: [getUserProfile]","fix":{"range":[1972,2000],"text":"[getUserProfile]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useCallback has an unnecessary dependency: 'refreshKey'. Either exclude it or remove the dependency array.","line":70,"column":6,"nodeType":"ArrayExpression","endLine":70,"endColumn":34,"suggestions":[{"desc":"Update the dependencies array to be: [getUserProfile]","fix":{"range":[2222,2250],"text":"[getUserProfile]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useCallback has an unnecessary dependency: 'refreshKey'. Either exclude it or remove the dependency array.","line":76,"column":6,"nodeType":"ArrayExpression","endLine":76,"endColumn":34,"suggestions":[{"desc":"Update the dependencies array to be: [getUserProfile]","fix":{"range":[2476,2504],"text":"[getUserProfile]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useCallback has an unnecessary dependency: 'refreshKey'. Either exclude it or remove the dependency array.","line":82,"column":6,"nodeType":"ArrayExpression","endLine":82,"endColumn":34,"suggestions":[{"desc":"Update the dependencies array to be: [getUserProfile]","fix":{"range":[2730,2758],"text":"[getUserProfile]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useCallback has an unnecessary dependency: 'refreshKey'. Either exclude it or remove the dependency array.","line":91,"column":6,"nodeType":"ArrayExpression","endLine":91,"endColumn":34,"suggestions":[{"desc":"Update the dependencies array to be: [getUserProfile]","fix":{"range":[3054,3082],"text":"[getUserProfile]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * usePermissions Hook\n * Rol yetkilerini dinamik olarak kontrol eder ve real-time gncellemeleri dinler\n */\n\nimport { useEffect, useState, useCallback } from \"react\";\nimport { useAuth } from \"@/contexts/AuthContext\";\nimport { UserProfile } from \"@/services/firebase/authService\";\nimport {\n  canCreateResource,\n  canReadResource,\n  canUpdateResource,\n  canDeleteResource,\n  canPerformSubPermission,\n} from \"@/utils/permissions\";\nimport { onPermissionCacheChange } from \"@/services/firebase/rolePermissionsService\";\n\ninterface UsePermissionsResult {\n  canCreate: (resource: string) => Promise<boolean>;\n  canRead: (resource: string) => Promise<boolean>;\n  canUpdate: (resource: string) => Promise<boolean>;\n  canDelete: (resource: string) => Promise<boolean>;\n  canPerformSubPerm: (resource: string, subPermissionKey: string) => Promise<boolean>;\n  refreshPermissions: () => void;\n}\n\nexport const usePermissions = (): UsePermissionsResult => {\n  const { user } = useAuth();\n  const [refreshKey, setRefreshKey] = useState(0);\n\n  // Convert user to UserProfile format\n  const getUserProfile = useCallback((): UserProfile | null => {\n    if (!user) return null;\n    return {\n      id: user.id,\n      email: user.email,\n      emailVerified: user.emailVerified,\n      fullName: user.fullName,\n      displayName: user.fullName,\n      phone: user.phone,\n      dateOfBirth: user.dateOfBirth,\n      role: user.roles,\n      createdAt: null,\n      updatedAt: null,\n    };\n  }, [user]);\n\n  // Listen to permission cache changes\n  useEffect(() => {\n    const unsubscribe = onPermissionCacheChange(() => {\n      // Force re-render when permissions change\n      setRefreshKey(prev => prev + 1);\n    });\n\n    return () => {\n      unsubscribe();\n    };\n  }, []);\n\n  const canCreate = useCallback(async (resource: string): Promise<boolean> => {\n    const userProfile = getUserProfile();\n    if (!userProfile) return false;\n    return await canCreateResource(userProfile, resource);\n  }, [getUserProfile, refreshKey]);\n\n  const canRead = useCallback(async (resource: string): Promise<boolean> => {\n    const userProfile = getUserProfile();\n    if (!userProfile) return false;\n    return await canReadResource(userProfile, resource);\n  }, [getUserProfile, refreshKey]);\n\n  const canUpdate = useCallback(async (resource: string): Promise<boolean> => {\n    const userProfile = getUserProfile();\n    if (!userProfile) return false;\n    return await canUpdateResource(userProfile, resource);\n  }, [getUserProfile, refreshKey]);\n\n  const canDelete = useCallback(async (resource: string): Promise<boolean> => {\n    const userProfile = getUserProfile();\n    if (!userProfile) return false;\n    return await canDeleteResource(userProfile, resource);\n  }, [getUserProfile, refreshKey]);\n\n  const canPerformSubPerm = useCallback(async (\n    resource: string,\n    subPermissionKey: string\n  ): Promise<boolean> => {\n    const userProfile = getUserProfile();\n    if (!userProfile) return false;\n    return await canPerformSubPermission(userProfile, resource, subPermissionKey);\n  }, [getUserProfile, refreshKey]);\n\n  const refreshPermissions = useCallback(() => {\n    setRefreshKey(prev => prev + 1);\n  }, []);\n\n  return {\n    canCreate,\n    canRead,\n    canUpdate,\n    canDelete,\n    canPerformSubPerm,\n    refreshPermissions,\n  };\n};\n\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\hooks\\useTaskFilters.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\hooks\\useTaskPermissions.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\lib\\firebase.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\lib\\utils.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\main.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\pages\\Admin.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\pages\\Auth.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\pages\\Customers.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchCustomers'. Either include it or remove the dependency array.","line":69,"column":6,"nodeType":"ArrayExpression","endLine":69,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [fetchCustomers]","fix":{"range":[4102,4104],"text":"[fetchCustomers]"}}]},{"ruleId":"prefer-const","severity":2,"message":"'filtered' is never reassigned. Use 'const' instead.","line":282,"column":9,"nodeType":"Identifier","messageId":"useConst","endLine":282,"endColumn":17,"fix":{"range":[11339,12149],"text":"const filtered = customers\n      .filter((customer) => {\n        const text = searchTerm.toLocaleLowerCase(\"tr-TR\");\n        if (\n          text &&\n          !(customer.name?.toLocaleLowerCase(\"tr-TR\") || \"\").includes(text) &&\n          !(customer.email?.toLocaleLowerCase(\"tr-TR\") || \"\").includes(text) &&\n          !(customer.company?.toLocaleLowerCase(\"tr-TR\") || \"\").includes(text)\n        ) {\n          return false;\n        }\n\n        if (quickFilter === \"needs_contact\") {\n          return !customer.email || !customer.phone;\n        }\n\n        if (quickFilter === \"vip\") {\n          return (customer as Customer & { tags?: string[] }).tags?.includes(\"vip\") || false;\n        }\n\n        if (quickFilter === \"active\") {\n          return isCustomerActive(customer);\n        }\n\n        return true;\n      });"}}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":1,"fixableWarningCount":0,"source":"import { useEffect, useMemo, useState, useCallback, useRef } from \"react\";\nimport { MainLayout } from \"@/components/Layout/MainLayout\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { SearchInput } from \"@/components/ui/search-input\";\nimport { Plus, Mail, Phone, Edit, Trash2, MoreVertical, Building2, User, Users2, Star, PhoneCall, MailCheck, Download, Package, TrendingUp, Filter, X, ChevronLeft, ChevronRight, ChevronUp, ChevronDown } from \"lucide-react\";\nimport { toast } from \"sonner\";\nimport { getCustomers, deleteCustomer, Customer } from \"@/services/firebase/customerService\";\nimport { useAuth } from \"@/contexts/AuthContext\";\nimport { AlertDialog, AlertDialogAction, AlertDialogCancel, AlertDialogContent, AlertDialogDescription, AlertDialogFooter, AlertDialogHeader, AlertDialogTitle } from \"@/components/ui/alert-dialog\";\nimport { CreateCustomerDialog } from \"@/components/Customers/CreateCustomerDialog\";\nimport { CustomerDetailModal } from \"@/components/Customers/CustomerDetailModal\";\nimport { DropdownMenu, DropdownMenuContent, DropdownMenuItem, DropdownMenuTrigger } from \"@/components/ui/dropdown-menu\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { getAllUsers, UserProfile } from \"@/services/firebase/authService\";\nimport { getSavedReports, SavedReport } from \"@/services/firebase/reportService\";\nimport { formatPhoneForDisplay } from \"@/utils/phoneNormalizer\";\nimport { getOrders, Order } from \"@/services/firebase/orderService\";\nimport { useNavigate } from \"react-router-dom\";\nimport { cn } from \"@/lib/utils\";\nimport { DetailedValueReportModal } from \"@/components/Statistics/DetailedValueReportModal\";\nimport { LoadingState } from \"@/components/ui/loading-state\";\nimport { CustomerCard } from \"@/components/Customers/CustomerCard\";\nimport { canCreateResource, canDeleteResource } from \"@/utils/permissions\";\nimport { ResponsiveTable, ResponsiveTableColumn } from \"@/components/shared/ResponsiveTable\";\nimport { Card as ResponsiveCard } from \"@/components/ui/card\";\nimport { StatCard } from \"@/components/Dashboard/StatCard\";\n\nconst Customers = () => {\n  const { user } = useAuth();\n  const navigate = useNavigate();\n  const [customers, setCustomers] = useState<Customer[]>([]);\n  const [orders, setOrders] = useState<Order[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [createDialogOpen, setCreateDialogOpen] = useState(false);\n  const [detailModalOpen, setDetailModalOpen] = useState(false);\n  const [deleteDialogOpen, setDeleteDialogOpen] = useState(false);\n  const [selectedCustomer, setSelectedCustomer] = useState<Customer | null>(null);\n  const [searchTerm, setSearchTerm] = useState(\"\");\n  const [usersMap, setUsersMap] = useState<Record<string, string>>({});\n  const [quickFilter, setQuickFilter] = useState<\"all\" | \"needs_contact\" | \"vip\" | \"active\">(\"all\");\n  const [statsModalOpen, setStatsModalOpen] = useState(false);\n  const [activeStatCard, setActiveStatCard] = useState<string | null>(null);\n  const [statsExpanded, setStatsExpanded] = useState(false);\n  const [canCreate, setCanCreate] = useState(false);\n  const [canDelete, setCanDelete] = useState(false);\n  const [sortColumn, setSortColumn] = useState<\"name\" | \"email\" | \"orderCount\" | \"totalAmount\">(\"name\");\n  const [sortDirection, setSortDirection] = useState<\"asc\" | \"desc\">(\"asc\");\n  const [columnWidths, setColumnWidths] = useState<Record<string, number>>(() => {\n    const saved = localStorage.getItem('customers-column-widths');\n    return saved ? JSON.parse(saved) : {\n      name: 250,\n      email: 200,\n      phone: 150,\n      orderCount: 120,\n      totalAmount: 150,\n      status: 120,\n      createdBy: 150,\n    };\n  });\n  const [resizingColumn, setResizingColumn] = useState<string | null>(null);\n  const resizeStartX = useRef(0);\n  const resizeStartWidth = useRef(0);\n  const listContainerRef = useRef<HTMLDivElement>(null);\n\n  useEffect(() => {\n    fetchCustomers();\n  }, []);\n\n  // Yetki: mteri oluturma\n  useEffect(() => {\n    const checkCreatePermission = async () => {\n      if (!user) {\n        setCanCreate(false);\n        setCanDelete(false);\n        return;\n      }\n      try {\n        const userProfile: UserProfile = {\n          id: user.id,\n          email: user.email,\n          emailVerified: user.emailVerified,\n          fullName: user.fullName,\n          displayName: user.fullName,\n          phone: user.phone,\n          dateOfBirth: user.dateOfBirth,\n          role: user.roles,\n          createdAt: null,\n          updatedAt: null,\n        };\n        const [createPerm, deletePerm] = await Promise.all([\n          canCreateResource(userProfile, \"customers\"),\n          canDeleteResource(userProfile, \"customers\"),\n        ]);\n        setCanCreate(createPerm);\n        setCanDelete(deletePerm);\n      } catch (error) {\n        if (import.meta.env.DEV) {\n          console.error(\"Customer create permission check error:\", error);\n        }\n        setCanCreate(false);\n        setCanDelete(false);\n      }\n    };\n    checkCreatePermission();\n  }, [user]);\n\n  const fetchCustomers = useCallback(async () => {\n    try {\n      setLoading(true);\n      // Orders' ayr ykle (daha sonra lazy load edilebilir)\n      const [customersData, usersData, quotesData] = await Promise.all([\n        getCustomers(),\n        getAllUsers(),\n        getSavedReports({ reportType: \"sales_quote\" }),\n      ]);\n      \n      // Orders' arka planda ykle (mteri kartlarnda kullanlyor ama hemen gerekli deil)\n      getOrders().then(ordersData => {\n        setOrders(ordersData);\n      }).catch(error => {\n        console.error(\"Error loading orders:\", error);\n      });\n      \n      const userMap: Record<string, string> = {};\n      usersData.forEach(u => {\n        userMap[u.id] = u.fullName || u.displayName || u.email;\n      });\n      setUsersMap(userMap);\n      \n      const customerLastQuoteMap: Record<\n        string,\n        {\n          id: string;\n          title: string;\n          date: number;\n          total: number;\n          downloadUrl?: string | null;\n        }\n      > = {};\n\n      quotesData.forEach((quote) => {\n        const metadata = (quote.metadata || {}) as Record<string, unknown>;\n        const customerId = metadata?.customerId;\n        if (!customerId) return;\n        let quoteDate: number;\n        if (quote.createdAt && typeof quote.createdAt === 'object' && 'toMillis' in quote.createdAt && typeof (quote.createdAt as { toMillis: () => number }).toMillis === 'function') {\n          quoteDate = (quote.createdAt as { toMillis: () => number }).toMillis();\n        } else if (quote.createdAt && typeof quote.createdAt === 'object' && 'toDate' in quote.createdAt && typeof (quote.createdAt as { toDate: () => Date }).toDate === 'function') {\n          quoteDate = Date.parse((quote.createdAt as { toDate: () => Date }).toDate().toISOString());\n        } else {\n          quoteDate = Date.parse(String(quote.createdAt || \"\"));\n        }\n        const total = Number(metadata?.grandTotal || 0);\n        const candidate = {\n          id: quote.id,\n          title: quote.title || \"Teklif\",\n          date: quoteDate || Date.now(),\n          total,\n          downloadUrl: quote.driveLink || quote.fileUrl,\n        };\n        const existing = customerLastQuoteMap[customerId as string];\n        if (!existing || candidate.date > existing.date) {\n          customerLastQuoteMap[customerId as string] = candidate;\n        }\n      });\n\n      const enrichedCustomers = customersData.map((customer) => ({\n        ...customer,\n        lastQuote: customerLastQuoteMap[customer.id] || null,\n      }));\n\n      setCustomers(enrichedCustomers);\n    } catch (error: unknown) {\n      if (import.meta.env.DEV) {\n        console.error(\"Fetch customers error:\", error);\n      }\n      const errorMessage = error instanceof Error ? error.message : String(error);\n      toast.error(errorMessage || \"Mteriler yklenirken hata olutu\");\n    } finally {\n      setLoading(false);\n    }\n  }, []);\n\n  const handleDelete = async () => {\n    if (!selectedCustomer) return;\n    \n    // Yetki kontrol\n    if (!canDelete) {\n      toast.error(\"Mteri silme yetkiniz yok.\");\n      setDeleteDialogOpen(false);\n      return;\n    }\n\n    try {\n      const customerIdToDelete = selectedCustomer.id;\n      await deleteCustomer(customerIdToDelete, user?.id);\n      toast.success(\"Mteri silindi\");\n      // nce state'i temizle\n      setSelectedCustomer(null);\n      setDeleteDialogOpen(false);\n      setDetailModalOpen(false);\n      // Listeyi manuel olarak gncelle (cache sorununu nlemek iin)\n      setCustomers(prev => prev.filter(c => c.id !== customerIdToDelete));\n      // Sonra listeyi yenile\n      await fetchCustomers();\n    } catch (error: unknown) {\n      if (import.meta.env.DEV) {\n        console.error(\"Delete customer error:\", error);\n      }\n      const errorMessage = error instanceof Error ? error.message : String(error);\n      toast.error(errorMessage || \"Mteri silinirken hata olutu\");\n    }\n  };\n\n  const stats = useMemo(() => {\n    const total = customers.length;\n    const totalOrders = orders.length;\n    const totalAmount = orders.reduce((sum, order) => sum + (order.totalAmount || 0), 0);\n    const activeCustomers = customers.filter((customer) => {\n      const customerOrders = orders.filter(\n        (order) => order.customerId === customer.id || order.customer_id === customer.id\n      );\n      return customerOrders.length > 0;\n    }).length;\n    return { total, totalOrders, totalAmount, activeCustomers };\n  }, [customers, orders]);\n\n  const isCustomerActive = useCallback((customer: Customer) => {\n    return orders.some(\n      (order) => order.customerId === customer.id || order.customer_id === customer.id\n    );\n  }, [orders]);\n\n  const handleSort = (column: typeof sortColumn) => {\n    if (sortColumn === column) {\n      setSortDirection(sortDirection === \"asc\" ? \"desc\" : \"asc\");\n    } else {\n      setSortColumn(column);\n      setSortDirection(\"asc\");\n    }\n  };\n\n  const handleResizeStart = (column: string, e: React.MouseEvent) => {\n    e.preventDefault();\n    e.stopPropagation();\n    setResizingColumn(column);\n    resizeStartX.current = e.clientX;\n    resizeStartWidth.current = columnWidths[column] || 100;\n  };\n\n  useEffect(() => {\n    const handleResizeMove = (e: MouseEvent) => {\n      if (!resizingColumn) return;\n      \n      const diff = e.clientX - resizeStartX.current;\n      const newWidth = Math.max(50, resizeStartWidth.current + diff);\n      \n      setColumnWidths(prev => {\n        const updated = { ...prev, [resizingColumn]: newWidth };\n        localStorage.setItem('customers-column-widths', JSON.stringify(updated));\n        return updated;\n      });\n    };\n\n    const handleResizeEnd = () => {\n      setResizingColumn(null);\n    };\n\n    if (resizingColumn) {\n      document.addEventListener('mousemove', handleResizeMove);\n      document.addEventListener('mouseup', handleResizeEnd);\n      return () => {\n        document.removeEventListener('mousemove', handleResizeMove);\n        document.removeEventListener('mouseup', handleResizeEnd);\n      };\n    }\n  }, [resizingColumn, columnWidths]);\n\n  const filteredCustomers = useMemo(() => {\n    let filtered = customers\n      .filter((customer) => {\n        const text = searchTerm.toLocaleLowerCase(\"tr-TR\");\n        if (\n          text &&\n          !(customer.name?.toLocaleLowerCase(\"tr-TR\") || \"\").includes(text) &&\n          !(customer.email?.toLocaleLowerCase(\"tr-TR\") || \"\").includes(text) &&\n          !(customer.company?.toLocaleLowerCase(\"tr-TR\") || \"\").includes(text)\n        ) {\n          return false;\n        }\n\n        if (quickFilter === \"needs_contact\") {\n          return !customer.email || !customer.phone;\n        }\n\n        if (quickFilter === \"vip\") {\n          return (customer as Customer & { tags?: string[] }).tags?.includes(\"vip\") || false;\n        }\n\n        if (quickFilter === \"active\") {\n          return isCustomerActive(customer);\n        }\n\n        return true;\n      });\n\n    // Sralama\n    filtered.sort((a, b) => {\n      let aValue: string | number = \"\";\n      let bValue: string | number = \"\";\n\n      if (sortColumn === \"name\") {\n        aValue = (a.name || \"\").toLowerCase();\n        bValue = (b.name || \"\").toLowerCase();\n      } else if (sortColumn === \"email\") {\n        aValue = (a.email || \"\").toLowerCase();\n        bValue = (b.email || \"\").toLowerCase();\n      } else if (sortColumn === \"orderCount\") {\n        const aOrders = orders.filter(o => o.customerId === a.id || o.customer_id === a.id).length;\n        const bOrders = orders.filter(o => o.customerId === b.id || o.customer_id === b.id).length;\n        aValue = aOrders;\n        bValue = bOrders;\n      } else if (sortColumn === \"totalAmount\") {\n        const aOrders = orders.filter(o => o.customerId === a.id || o.customer_id === a.id);\n        const bOrders = orders.filter(o => o.customerId === b.id || o.customer_id === b.id);\n        aValue = aOrders.reduce((sum, o) => sum + (o.totalAmount || 0), 0);\n        bValue = bOrders.reduce((sum, o) => sum + (o.totalAmount || 0), 0);\n      }\n\n      if (typeof aValue === \"string\" && typeof bValue === \"string\") {\n        return sortDirection === \"asc\" \n          ? aValue.localeCompare(bValue, \"tr-TR\")\n          : bValue.localeCompare(aValue, \"tr-TR\");\n      } else {\n        return sortDirection === \"asc\" \n          ? (aValue as number) - (bValue as number)\n          : (bValue as number) - (aValue as number);\n      }\n    });\n\n    return filtered;\n  }, [customers, searchTerm, quickFilter, orders, isCustomerActive, sortColumn, sortDirection]);\n\n  const formattedTotalAmount = useMemo(() => {\n    try {\n      return new Intl.NumberFormat(\"tr-TR\", {\n        style: \"currency\",\n        currency: \"TRY\",\n        minimumFractionDigits: 2,\n      }).format(stats.totalAmount);\n    } catch {\n      return `${stats.totalAmount?.toFixed?.(2) ?? \"0,00\"}`;\n    }\n  }, [stats.totalAmount]);\n\n  const customerStatCards = [\n    {\n      key: \"total-customers\",\n      label: \"Toplam Mteri\",\n      value: stats.total,\n      icon: Users2,\n      accent: \"bg-primary/10 text-primary\",\n      description: \"Tm mteri kaytlar\",\n      onClick: () => {\n        setQuickFilter(\"all\");\n        setSearchTerm(\"\");\n        setActiveStatCard(\"total-customers\");\n      },\n      isActive: activeStatCard === \"total-customers\",\n    },\n    {\n      key: \"total-orders\",\n      label: \"Toplam Sipari\",\n      value: stats.totalOrders,\n      icon: Package,\n      accent: \"bg-emerald-100 text-emerald-700\",\n      description: \"Sipari listesine git\",\n      onClick: () => {\n        setActiveStatCard(\"total-orders\");\n        navigate(\"/orders\");\n      },\n      isActive: activeStatCard === \"total-orders\",\n    },\n    {\n      key: \"total-amount\",\n      label: \"Toplam Tutar\",\n      value: formattedTotalAmount,\n      icon: TrendingUp,\n      accent: \"bg-amber-100 text-amber-700\",\n      description: \"Raporlar grntle\",\n      onClick: () => {\n        setActiveStatCard(\"total-amount\");\n        setStatsModalOpen(true);\n      },\n      isActive: activeStatCard === \"total-amount\",\n    },\n    {\n      key: \"active-customers\",\n      label: \"Aktif Mteri\",\n      value: stats.activeCustomers,\n      icon: Star,\n      accent: \"bg-purple-100 text-purple-700\",\n      description: \"Siparii olan mteriler\",\n      onClick: () => {\n        setQuickFilter(\"active\");\n        setActiveStatCard(\"active-customers\");\n      },\n      isActive: activeStatCard === \"active-customers\",\n    },\n  ];\n\n  if (loading) {\n    return (\n      <MainLayout>\n        <LoadingState message=\"Mteriler ykleniyor...\" />\n      </MainLayout>\n    );\n  }\n\n  return (\n    <MainLayout>\n      <div className=\"space-y-2 xs:space-y-2.5 sm:space-y-3 w-full max-w-full mx-auto px-1 xs:px-2\">\n        <div className=\"flex flex-col xs:flex-row items-start xs:items-center justify-between gap-2 xs:gap-3\">\n          <div className=\"flex-1 min-w-0\">\n            <div className=\"flex items-center justify-between gap-2 xs:gap-3\">\n              <div className=\"min-w-0 flex-1\">\n                <h1 className=\"text-lg sm:text-xl font-semibold text-foreground truncate\">Mteriler</h1>\n                <p className=\"text-muted-foreground mt-0.5 text-xs sm:text-sm\">Mteri ve tedariki listenizi ynetin</p>\n              </div>\n              {/* statistikler Alma Butonu */}\n              {!statsExpanded ? (\n                <Button\n                  variant=\"ghost\"\n                  size=\"sm\"\n                  onClick={() => setStatsExpanded(true)}\n                  className=\"h-7 px-2 gap-1 text-[11px] sm:text-xs\"\n                  aria-label=\"statistikleri gster\"\n                >\n                  <ChevronLeft className=\"h-3.5 w-3.5\" />\n                </Button>\n              ) : (\n                <Button\n                  variant=\"ghost\"\n                  size=\"sm\"\n                  onClick={() => setStatsExpanded(false)}\n                  className=\"h-7 px-2 gap-1 text-[11px] sm:text-xs\"\n                  aria-label=\"statistikleri gizle\"\n                >\n                  <ChevronRight className=\"h-3.5 w-3.5\" />\n                </Button>\n              )}\n            </div>\n          </div>\n          {canCreate && (\n            <Button \n              className=\"gap-1 w-full xs:w-auto min-h-[44px] xs:min-h-[40px] sm:min-h-8 text-[11px] sm:text-xs\" \n              onClick={() => {\n                setCreateDialogOpen(true);\n              }}\n            >\n              <Plus className=\"h-4 w-4\" />\n              <span className=\"hidden sm:inline\">Yeni Mteri</span>\n              <span className=\"sm:hidden\">Yeni</span>\n            </Button>\n          )}\n        </div>\n\n        {/* statistikler */}\n        {statsExpanded && (\n          <div className=\"grid grid-cols-2 sm:grid-cols-2 lg:grid-cols-4 gap-2 xs:gap-2.5 sm:gap-3\">\n            {customerStatCards.map((item) => {\n              const variantMap: Record<string, \"default\" | \"primary\" | \"success\" | \"warning\" | \"info\"> = {\n                \"total-customers\": \"primary\",\n                \"total-orders\": \"success\",\n                \"total-amount\": \"warning\",\n                \"active-customers\": \"info\",\n              };\n              const variant = variantMap[item.key] || \"default\";\n              const value = typeof item.value === 'function' ? (item.value as () => string | number)() : item.value;\n              \n              return (\n                <StatCard\n                  key={item.key}\n                  title={item.label}\n                  value={value}\n                  icon={item.icon}\n                  variant={variant}\n                  onClick={item.onClick}\n                  clickable\n                />\n              );\n            })}\n          </div>\n        )}\n\n        {/* Filtreler */}\n        <Card className=\"border-2\">\n          <CardContent className=\"p-2\">\n            <div className=\"flex flex-col sm:flex-row items-stretch sm:items-center gap-2 sm:gap-3 md:gap-4\">\n              {/* Arama Kutusu */}\n              <div className=\"flex-1 min-w-0 w-full sm:w-auto sm:min-w-[200px] md:min-w-[250px]\">\n                <SearchInput\n                  placeholder=\"sim, e-posta veya irket ara...\"\n                  className=\"w-full h-9 sm:h-10 text-[11px] sm:text-xs\"\n                  value={searchTerm}\n                  onChange={(e) => {\n                    setSearchTerm(e.target.value);\n                    if (e.target.value === \"\") {\n                      setActiveStatCard(null);\n                    }\n                  }}\n                />\n              </div>\n              \n              {/* Filtreler */}\n              <div className=\"w-full sm:w-auto sm:min-w-[160px] md:min-w-[180px]\">\n                <Select value={quickFilter} onValueChange={(value) => setQuickFilter(value as typeof quickFilter)}>\n                  <SelectTrigger className=\"w-full h-9 sm:h-10 text-[11px] sm:text-xs\">\n                    <SelectValue placeholder=\"Filtrele\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"all\">Tm</SelectItem>\n                    <SelectItem value=\"needs_contact\">Kontak Eksik</SelectItem>\n                    <SelectItem value=\"vip\">VIP</SelectItem>\n                    <SelectItem value=\"active\">Aktif Mteriler</SelectItem>\n                  </SelectContent>\n                </Select>\n              </div>\n              \n              {/* Filtreleri Temizle */}\n              {(searchTerm || quickFilter !== \"all\") && (\n                <Button\n                  variant=\"outline\"\n                  size=\"sm\"\n                  onClick={() => {\n                    setSearchTerm(\"\");\n                    setQuickFilter(\"all\");\n                    setActiveStatCard(null);\n                  }}\n                  className=\"h-9 sm:h-10 text-[11px] sm:text-xs\"\n                >\n                  <X className=\"h-3.5 w-3.5 sm:h-4 sm:w-4 sm:mr-2\" />\n                  <span className=\"hidden sm:inline\">Temizle</span>\n                </Button>\n              )}\n            </div>\n          </CardContent>\n        </Card>\n\n        {/* Liste Grnm */}\n        <div className=\"w-full max-w-full overflow-hidden\">\n          <div className=\"hidden md:block border border-[#DFE1E6] dark:border-[#38414A] rounded-sm bg-white dark:bg-[#1D2125] w-full overflow-hidden\">\n            <div className=\"w-full overflow-x-auto overflow-y-visible scrollbar-thin scrollbar-thumb-muted-foreground/20 scrollbar-track-transparent hover:scrollbar-thumb-muted-foreground/30 -webkit-overflow-scrolling-touch overscroll-behavior-contain\">\n              <div className=\"table border-collapse min-w-full\" style={{ tableLayout: 'fixed' }}>\n                {/* Tablo Balklar */}\n              <div className=\"table-header-group bg-[#F4F5F7] dark:bg-[#22272B]\">\n                <div className=\"table-row\">\n                  <div \n                      className=\"table-cell px-0 sm:px-0.5 md:px-1 py-2.5 sm:py-3 cursor-pointer hover:text-[#0052CC] dark:hover:text-[#4C9AFF] hover:bg-[#EBECF0] dark:hover:bg-[#2C333A] transition-all duration-200 text-xs font-semibold text-[#42526E] dark:text-[#B6C2CF] uppercase tracking-wide border-r border-[#DFE1E6] dark:border-[#38414A] relative sticky left-0 z-20 bg-[#F4F5F7] dark:bg-[#22272B]\"\n                    style={{ width: columnWidths.name || 250, minWidth: 250, maxWidth: 250 }}\n                    onClick={() => handleSort(\"name\")}\n                  >\n                    <div className=\"flex items-center gap-1.5\">\n                      sim / irket\n                      {sortColumn === \"name\" && (\n                        sortDirection === \"asc\" ? <ChevronUp className=\"h-4 w-4\" /> : <ChevronDown className=\"h-4 w-4\" />\n                      )}\n                    </div>\n                    <div \n                      className=\"absolute top-0 right-0 w-1 h-full cursor-col-resize hover:bg-[#0052CC] dark:hover:bg-[#4C9AFF] opacity-0 hover:opacity-100 transition-opacity\"\n                      onMouseDown={(e) => handleResizeStart(\"name\", e)}\n                    />\n                  </div>\n                  <div \n                      className=\"table-cell px-0 sm:px-0.5 md:px-1 py-2.5 sm:py-3 cursor-pointer hover:text-[#0052CC] dark:hover:text-[#4C9AFF] hover:bg-[#EBECF0] dark:hover:bg-[#2C333A] transition-all duration-200 text-xs font-semibold text-[#42526E] dark:text-[#B6C2CF] uppercase tracking-wide border-r border-[#DFE1E6] dark:border-[#38414A] relative\"\n                    style={{ width: columnWidths.email || 180, minWidth: 180, maxWidth: 180 }}\n                    onClick={() => handleSort(\"email\")}\n                  >\n                    <div className=\"flex items-center gap-1.5\">\n                      E-posta\n                      {sortColumn === \"email\" && (\n                        sortDirection === \"asc\" ? <ChevronUp className=\"h-4 w-4\" /> : <ChevronDown className=\"h-4 w-4\" />\n                      )}\n                    </div>\n                    <div \n                      className=\"absolute top-0 right-0 w-1 h-full cursor-col-resize hover:bg-[#0052CC] dark:hover:bg-[#4C9AFF] opacity-0 hover:opacity-100 transition-opacity\"\n                      onMouseDown={(e) => handleResizeStart(\"email\", e)}\n                    />\n                  </div>\n                  <div \n                      className=\"table-cell px-0 sm:px-0.5 md:px-1 py-2.5 sm:py-3 text-xs font-semibold text-[#42526E] dark:text-[#B6C2CF] uppercase tracking-wide border-r border-[#DFE1E6] dark:border-[#38414A] relative\"\n                    style={{ width: columnWidths.phone || 130, minWidth: 130, maxWidth: 130 }}\n                  >\n                    Telefon\n                    <div \n                      className=\"absolute top-0 right-0 w-1 h-full cursor-col-resize hover:bg-[#0052CC] dark:hover:bg-[#4C9AFF] opacity-0 hover:opacity-100 transition-opacity\"\n                      onMouseDown={(e) => handleResizeStart(\"phone\", e)}\n                    />\n                  </div>\n                  <div \n                      className=\"table-cell px-0 sm:px-0.5 md:px-1 py-2.5 sm:py-3 cursor-pointer hover:text-[#0052CC] dark:hover:text-[#4C9AFF] hover:bg-[#EBECF0] dark:hover:bg-[#2C333A] transition-all duration-200 text-xs font-semibold text-[#42526E] dark:text-[#B6C2CF] uppercase tracking-wide border-r border-[#DFE1E6] dark:border-[#38414A] relative\"\n                    style={{ width: columnWidths.orderCount || 70, minWidth: 70, maxWidth: 70 }}\n                    onClick={() => handleSort(\"orderCount\")}\n                  >\n                    <div className=\"flex items-center gap-1.5\">\n                      Sipari\n                      {sortColumn === \"orderCount\" && (\n                        sortDirection === \"asc\" ? <ChevronUp className=\"h-4 w-4\" /> : <ChevronDown className=\"h-4 w-4\" />\n                      )}\n                    </div>\n                    <div \n                      className=\"absolute top-0 right-0 w-1 h-full cursor-col-resize hover:bg-[#0052CC] dark:hover:bg-[#4C9AFF] opacity-0 hover:opacity-100 transition-opacity\"\n                      onMouseDown={(e) => handleResizeStart(\"orderCount\", e)}\n                    />\n                  </div>\n                  <div \n                      className=\"table-cell px-0 sm:px-0.5 md:px-1 py-2.5 sm:py-3 cursor-pointer hover:text-[#0052CC] dark:hover:text-[#4C9AFF] hover:bg-[#EBECF0] dark:hover:bg-[#2C333A] transition-all duration-200 text-xs font-semibold text-[#42526E] dark:text-[#B6C2CF] uppercase tracking-wide border-r border-[#DFE1E6] dark:border-[#38414A] relative\"\n                    style={{ width: columnWidths.totalAmount || 150, minWidth: 150, maxWidth: 150 }}\n                    onClick={() => handleSort(\"totalAmount\")}\n                  >\n                    <div className=\"flex items-center gap-1.5\">\n                      Toplam Tutar\n                      {sortColumn === \"totalAmount\" && (\n                        sortDirection === \"asc\" ? <ChevronUp className=\"h-4 w-4\" /> : <ChevronDown className=\"h-4 w-4\" />\n                      )}\n                    </div>\n                    <div \n                      className=\"absolute top-0 right-0 w-1 h-full cursor-col-resize hover:bg-[#0052CC] dark:hover:bg-[#4C9AFF] opacity-0 hover:opacity-100 transition-opacity\"\n                      onMouseDown={(e) => handleResizeStart(\"totalAmount\", e)}\n                    />\n                  </div>\n                  <div \n                      className=\"table-cell px-0 sm:px-0.5 md:px-1 py-2.5 sm:py-3 text-xs font-semibold text-[#42526E] dark:text-[#B6C2CF] uppercase tracking-wide border-r border-[#DFE1E6] dark:border-[#38414A] relative\"\n                    style={{ width: columnWidths.status || 70, minWidth: 70, maxWidth: 70 }}\n                  >\n                    Durum\n                    <div \n                      className=\"absolute top-0 right-0 w-1 h-full cursor-col-resize hover:bg-[#0052CC] dark:hover:bg-[#4C9AFF] opacity-0 hover:opacity-100 transition-opacity\"\n                      onMouseDown={(e) => handleResizeStart(\"status\", e)}\n                    />\n                  </div>\n                  <div \n                      className=\"table-cell px-0 sm:px-0.5 md:px-1 py-2.5 sm:py-3 text-xs font-semibold text-[#42526E] dark:text-[#B6C2CF] uppercase tracking-wide border-r border-[#DFE1E6] dark:border-[#38414A] relative\"\n                    style={{ width: columnWidths.createdBy || 140, minWidth: 140, maxWidth: 140 }}\n                  >\n                    Oluturan\n                    <div \n                      className=\"absolute top-0 right-0 w-1 h-full cursor-col-resize hover:bg-[#0052CC] dark:hover:bg-[#4C9AFF] opacity-0 hover:opacity-100 transition-opacity\"\n                      onMouseDown={(e) => handleResizeStart(\"createdBy\", e)}\n                    />\n                  </div>\n                </div>\n              </div>\n\n              {/* Tablo erii */}\n              <div \n                ref={listContainerRef}\n                className=\"table-row-group overflow-y-auto scrollbar-thin scrollbar-thumb-muted-foreground/20 scrollbar-track-transparent hover:scrollbar-thumb-muted-foreground/30 -webkit-overflow-scrolling-touch overscroll-behavior-contain\"\n                style={{ maxHeight: 'calc(100vh - 400px)' }}\n              >\n                {filteredCustomers.map((customer) => {\n                  const customerOrders = orders.filter(\n                    (order) => order.customerId === customer.id || order.customer_id === customer.id\n                  );\n                  const orderCount = customerOrders.length;\n                  const totalAmount = customerOrders.reduce((sum, order) => sum + (order.totalAmount || 0), 0);\n                  const isActive = orderCount > 0;\n\n                  return (\n                    <div\n                      key={customer.id}\n                      className=\"table-row group border-b border-[#DFE1E6] dark:border-[#38414A] hover:bg-[#F4F5F7] dark:hover:bg-[#22272B] transition-all duration-200 cursor-pointer bg-white dark:bg-[#1D2125]\"\n                      onClick={() => {\n                        // Mterinin hala listede olduundan emin ol\n                        const customerExists = customers.some(c => c.id === customer.id);\n                        if (!customerExists) {\n                          toast.error(\"Bu mteri artk mevcut deil.\");\n                          return;\n                        }\n                        setSelectedCustomer(customer);\n                        setDetailModalOpen(true);\n                      }}\n                    >\n                      <div className=\"table-cell px-0 sm:px-0.5 md:px-1 py-2.5 sm:py-3 align-middle border-r border-[#DFE1E6] dark:border-[#38414A] sticky left-0 z-10 bg-white dark:bg-[#1D2125]\">\n                        <div className=\"flex flex-col gap-1\">\n                          <span className=\"font-semibold text-sm text-[#172B4D] dark:text-[#B6C2CF]\">\n                            {customer.name}\n                          </span>\n                          {customer.company && (\n                            <span className=\"text-xs text-[#42526E] dark:text-[#B6C2CF]\">\n                              {customer.company}\n                            </span>\n                          )}\n                        </div>\n                      </div>\n                      <div className=\"table-cell px-0 sm:px-0.5 md:px-1 py-2.5 sm:py-3 align-middle border-r border-[#DFE1E6] dark:border-[#38414A]\">\n                        {customer.email ? (\n                          <div className=\"flex items-center gap-1.5\">\n                            <Mail className=\"h-3.5 w-3.5 text-[#42526E] dark:text-[#B6C2CF]\" />\n                            <span className=\"text-xs text-[#42526E] dark:text-[#B6C2CF] truncate\">\n                              {customer.email}\n                            </span>\n                          </div>\n                        ) : (\n                          <span className=\"text-xs text-[#6B778C] dark:text-[#8C9CB8]\">-</span>\n                        )}\n                      </div>\n                      <div className=\"table-cell px-0 sm:px-0.5 md:px-1 py-2.5 sm:py-3 align-middle border-r border-[#DFE1E6] dark:border-[#38414A]\">\n                        {customer.phone ? (\n                          <div className=\"flex items-center gap-1.5\">\n                            <Phone className=\"h-3.5 w-3.5 text-[#42526E] dark:text-[#B6C2CF]\" />\n                            <span className=\"text-xs text-[#42526E] dark:text-[#B6C2CF]\">\n                              {formatPhoneForDisplay(customer.phone)}\n                            </span>\n                          </div>\n                        ) : (\n                          <span className=\"text-xs text-[#6B778C] dark:text-[#8C9CB8]\">-</span>\n                        )}\n                      </div>\n                      <div className=\"table-cell px-0 sm:px-0.5 md:px-1 py-2.5 sm:py-3 align-middle border-r border-[#DFE1E6] dark:border-[#38414A]\">\n                        <div className=\"flex items-center gap-1.5\">\n                          <Package className=\"h-3.5 w-3.5 text-[#42526E] dark:text-[#B6C2CF]\" />\n                          <span className=\"text-xs font-medium text-[#42526E] dark:text-[#B6C2CF]\">\n                            {orderCount}\n                          </span>\n                        </div>\n                      </div>\n                      <div className=\"table-cell px-0 sm:px-0.5 md:px-1 py-2.5 sm:py-3 align-middle border-r border-[#DFE1E6] dark:border-[#38414A]\">\n                        <span className=\"text-xs font-semibold text-[#42526E] dark:text-[#B6C2CF]\">\n                          {new Intl.NumberFormat(\"tr-TR\", { minimumFractionDigits: 0, maximumFractionDigits: 0 }).format(totalAmount)}\n                        </span>\n                      </div>\n                      <div className=\"table-cell px-0 sm:px-0.5 md:px-1 py-2.5 sm:py-3 align-middle border-r border-[#DFE1E6] dark:border-[#38414A]\">\n                        <Badge \n                          variant={isActive ? \"default\" : \"secondary\"} \n                          className={cn(\n                            \"text-xs font-medium\",\n                            isActive \n                              ? \"bg-emerald-500/10 text-emerald-700 dark:text-emerald-400 border-emerald-500/20\" \n                              : \"bg-muted/60 text-muted-foreground border-border/50\"\n                          )}\n                        >\n                          {isActive ? \"Aktif\" : \"Pasif\"}\n                        </Badge>\n                      </div>\n                      <div className=\"table-cell px-0 sm:px-0.5 md:px-1 py-2.5 sm:py-3 align-middle border-r border-[#DFE1E6] dark:border-[#38414A]\">\n                        {customer.createdBy ? (\n                          <span className=\"text-xs text-[#42526E] dark:text-[#B6C2CF]\">\n                            {usersMap[customer.createdBy] || \"Bilinmeyen\"}\n                          </span>\n                        ) : (\n                          <span className=\"text-xs text-[#6B778C] dark:text-[#8C9CB8]\">-</span>\n                        )}\n                      </div>\n                    </div>\n                  );\n                })}\n              </div>\n              </div>\n            </div>\n          </div>\n\n          {/* Mobil Grnm */}\n          <div className=\"md:hidden space-y-3\">\n            {filteredCustomers.map((customer) => {\n              const customerOrders = orders.filter(\n                (order) => order.customerId === customer.id || order.customer_id === customer.id\n              );\n              const orderCount = customerOrders.length;\n              const totalAmount = customerOrders.reduce((sum, order) => sum + (order.totalAmount || 0), 0);\n              const isActive = orderCount > 0;\n\n              return (\n                <Card\n                  key={customer.id}\n                  className=\"cursor-pointer hover:shadow-lg transition-all\"\n                  onClick={() => {\n                    // Mterinin hala listede olduundan emin ol\n                    const customerExists = customers.some(c => c.id === customer.id);\n                    if (!customerExists) {\n                      toast.error(\"Bu mteri artk mevcut deil.\");\n                      return;\n                    }\n                    setSelectedCustomer(customer);\n                    setDetailModalOpen(true);\n                  }}\n                >\n                  <CardContent className=\"p-3 sm:p-4 space-y-2\">\n                    <div className=\"flex items-start justify-between\">\n                      <div className=\"flex-1\">\n                        <h3 className=\"font-semibold text-[11px] sm:text-xs\">{customer.name}</h3>\n                        {customer.company && (\n                          <p className=\"text-[11px] sm:text-xs text-muted-foreground mt-1\">{customer.company}</p>\n                        )}\n                      </div>\n                      <Badge \n                        variant={isActive ? \"default\" : \"secondary\"}\n                        className={cn(\n                          isActive \n                            ? \"bg-emerald-500/10 text-emerald-700 dark:text-emerald-400\" \n                            : \"bg-muted/60 text-muted-foreground\"\n                        )}\n                      >\n                        {isActive ? \"Aktif\" : \"Pasif\"}\n                      </Badge>\n                    </div>\n                    {customer.email && (\n                      <div className=\"flex items-center gap-2 text-[11px] sm:text-xs text-muted-foreground\">\n                        <Mail className=\"h-3.5 w-3.5\" />\n                        {customer.email}\n                      </div>\n                    )}\n                    {customer.phone && (\n                      <div className=\"flex items-center gap-2 text-[11px] sm:text-xs text-muted-foreground\">\n                        <Phone className=\"h-3.5 w-3.5\" />\n                        {formatPhoneForDisplay(customer.phone)}\n                      </div>\n                    )}\n                    <div className=\"flex items-center justify-between pt-2 border-t\">\n                      <div className=\"flex items-center gap-1.5\">\n                        <Package className=\"h-3.5 w-3.5 text-muted-foreground\" />\n                        <span className=\"text-[11px] sm:text-xs font-medium\">{orderCount} Sipari</span>\n                      </div>\n                      <span className=\"text-[11px] sm:text-xs font-semibold\">\n                        {new Intl.NumberFormat(\"tr-TR\", { minimumFractionDigits: 0, maximumFractionDigits: 0 }).format(totalAmount)}\n                      </span>\n                    </div>\n                  </CardContent>\n                </Card>\n              );\n            })}\n          </div>\n        </div>\n\n        {filteredCustomers.length === 0 && (\n          <div className=\"text-center py-8 sm:py-12 md:py-16 bg-muted/10 rounded-xl border border-dashed border-muted-foreground/20 px-4\">\n            <div className=\"mx-auto w-10 h-10 sm:w-12 sm:h-12 bg-muted/50 rounded-full flex items-center justify-center mb-3 sm:mb-4\">\n              <User className=\"h-5 w-5 sm:h-6 sm:w-6 text-muted-foreground\" />\n            </div>\n            <h3 className=\"text-[14px] sm:text-[15px] font-semibold text-foreground\">Mteri Bulunamad</h3>\n            <p className=\"text-[11px] sm:text-xs text-muted-foreground max-w-sm mx-auto mt-2\">\n              {searchTerm ? `\"${searchTerm}\" aramasyla eleen sonu yok.` : \"Henz kaytl mteri bulunmuyor. Yeni mteri ekleyerek balayn.\"}\n            </p>\n            {searchTerm && (\n              <Button variant=\"link\" onClick={() => setSearchTerm(\"\")} className=\"mt-2 text-[11px] sm:text-xs\">\n                Aramay temizle\n              </Button>\n            )}\n          </div>\n        )}\n      </div>\n\n      <CreateCustomerDialog\n        open={createDialogOpen}\n        onOpenChange={setCreateDialogOpen}\n        onSuccess={fetchCustomers}\n      />\n\n      {selectedCustomer && (\n        <CustomerDetailModal\n          open={detailModalOpen}\n          onOpenChange={(open) => {\n            setDetailModalOpen(open);\n            if (!open) {\n              setSelectedCustomer(null);\n            }\n          }}\n          customer={selectedCustomer}\n          onUpdate={() => {\n            fetchCustomers();\n          }}\n          onDelete={() => {\n            // nce state'i temizle\n            const deletedCustomerId = selectedCustomer?.id;\n            setSelectedCustomer(null);\n            setDetailModalOpen(false);\n            // Listeyi manuel olarak gncelle (cache sorununu nlemek iin)\n            if (deletedCustomerId) {\n              setCustomers(prev => prev.filter(c => c.id !== deletedCustomerId));\n            }\n            // Sonra listeyi yenile\n            fetchCustomers();\n          }}\n        />\n      )}\n\n      <AlertDialog open={deleteDialogOpen} onOpenChange={setDeleteDialogOpen}>\n        <AlertDialogContent>\n          <AlertDialogHeader>\n            <AlertDialogTitle>Mteriyi sil?</AlertDialogTitle>\n            <AlertDialogDescription>\n              Bu ilem geri alnamaz. Mteri kalc olarak silinecek.\n            </AlertDialogDescription>\n          </AlertDialogHeader>\n          <AlertDialogFooter>\n            <AlertDialogCancel>ptal</AlertDialogCancel>\n            <AlertDialogAction onClick={handleDelete}>Sil</AlertDialogAction>\n          </AlertDialogFooter>\n        </AlertDialogContent>\n      </AlertDialog>\n\n      <DetailedValueReportModal\n        open={statsModalOpen}\n        onOpenChange={setStatsModalOpen}\n        title=\"Mteri Deer Raporu\"\n        type=\"customers\"\n        data={customers as unknown as Record<string, unknown>[]}\n        orders={orders as unknown as Record<string, unknown>[]}\n      />\n    </MainLayout>\n  );\n};\n\nexport default Customers;\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\pages\\Dashboard.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\pages\\Index.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\pages\\NotFound.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\pages\\Notifications.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\pages\\Orders.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'page'. Either include it or remove the dependency array.","line":314,"column":6,"nodeType":"ArrayExpression","endLine":314,"endColumn":52,"suggestions":[{"desc":"Update the dependencies array to be: [statusFilter, sortBy, sortOrder, searchQuery, page]","fix":{"range":[13833,13879],"text":"[statusFilter, sortBy, sortOrder, searchQuery, page]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'isTeamLeader'. Either include it or remove the dependency array.","line":358,"column":6,"nodeType":"ArrayExpression","endLine":358,"endColumn":12,"suggestions":[{"desc":"Update the dependencies array to be: [isTeamLeader, user]","fix":{"range":[15048,15054],"text":"[isTeamLeader, user]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useEffect, useMemo, useState, useCallback } from \"react\";\nimport { MainLayout } from \"@/components/Layout/MainLayout\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader } from \"@/components/ui/card\";\nimport { Input } from \"@/components/ui/input\";\nimport { SearchInput } from \"@/components/ui/search-input\";\nimport { Plus, Edit, Trash2, ArrowUpDown, ArrowUp, ArrowDown, X, MoreVertical } from \"lucide-react\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from \"@/components/ui/table\";\nimport { ResponsiveTable, ResponsiveTableColumn } from \"@/components/shared/ResponsiveTable\";\nimport { Card as ResponsiveCard } from \"@/components/ui/card\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { DropdownMenu, DropdownMenuContent, DropdownMenuItem, DropdownMenuTrigger } from \"@/components/ui/dropdown-menu\";\nimport { toast } from \"sonner\";\nimport { getOrders, deleteOrder, getOrderItems, subscribeToOrders, Order } from \"@/services/firebase/orderService\";\nimport { getCustomerById } from \"@/services/firebase/customerService\";\nimport { Timestamp } from \"firebase/firestore\";\nimport {\n  AlertDialog,\n  AlertDialogAction,\n  AlertDialogCancel,\n  AlertDialogContent,\n  AlertDialogDescription,\n  AlertDialogFooter,\n  AlertDialogHeader,\n  AlertDialogTitle,\n} from \"@/components/ui/alert-dialog\";\nimport { CreateOrderDialog } from \"@/components/Orders/CreateOrderDialog\";\nimport { OrderDetailModal } from \"@/components/Orders/OrderDetailModal\";\nimport { CustomerDetailModal } from \"@/components/Customers/CustomerDetailModal\";\nimport { useIsMobile } from \"@/hooks/use-mobile\";\nimport { LoadingState } from \"@/components/ui/loading-state\";\nimport { CURRENCY_SYMBOLS, Currency } from \"@/utils/currency\";\nimport { useAuth } from \"@/contexts/AuthContext\";\nimport { canCreateResource, canDeleteResource, canUpdateResource } from \"@/utils/permissions\";\nimport { UserProfile } from \"@/services/firebase/authService\";\nimport { getPriorityMeta } from \"@/utils/priority\";\n\nconst Orders = () => {\n  const isMobile = useIsMobile();\n  const { user, isTeamLeader } = useAuth();\n  const [orders, setOrders] = useState<Order[]>([]);\n  const [loading, setLoading] = useState(false); // Balangta false - placeholder data ile hzl render\n  const [searchQuery, setSearchQuery] = useState(\"\");\n  const [statusFilter, setStatusFilter] = useState<string>(\"all\");\n  const [sortBy, setSortBy] = useState<string>(\"order_date\");\n  const [sortOrder, setSortOrder] = useState<\"asc\" | \"desc\">(\"desc\");\n  const [page, setPage] = useState(1);\n  const [totalPages, setTotalPages] = useState(1);\n  const [createDialogOpen, setCreateDialogOpen] = useState(false);\n  const [detailModalOpen, setDetailModalOpen] = useState(false);\n  const [deleteDialogOpen, setDeleteDialogOpen] = useState(false);\n  const [selectedOrder, setSelectedOrder] = useState<Order | null>(null);\n  const [customerModalOpen, setCustomerModalOpen] = useState(false);\n  const [customerModalData, setCustomerModalData] = useState<Awaited<ReturnType<typeof getCustomerById>> | null>(null);\n  const [canCreate, setCanCreate] = useState(false);\n  const [canUpdate, setCanUpdate] = useState(false);\n  const [canDelete, setCanDelete] = useState(false);\n\n\n  // Gerek zamanl sipari gncellemeleri iin subscribe\n  useEffect(() => {\n    const filters: { status?: string } = {};\n    if (statusFilter !== 'all') {\n      filters.status = statusFilter;\n    }\n    \n    // Defer subscription: lk render'dan 100ms sonra balat (non-blocking)\n    const timer = setTimeout(() => {\n      setLoading(true);\n      \n      // Gerek zamanl dinleme balat\n      const unsubscribe = subscribeToOrders(filters, async (firebaseOrders) => {\n      try {\n        // Null/undefined kontrol\n        if (!Array.isArray(firebaseOrders)) {\n          setOrders([]);\n          setTotalPages(1);\n          setLoading(false);\n          return;\n        }\n        \n        // Performans iin: totalAmount'u olanlar nce ile, olmayanlar sonra batch olarak ile\n        // nce totalAmount'u olanlar filtrele\n        const ordersWithTotal = firebaseOrders.filter(order => order?.totalAmount || order?.total_amount);\n        const ordersWithoutTotal = firebaseOrders.filter(order => !order?.totalAmount && !order?.total_amount);\n        \n        // TotalAmount'u olanlar hzlca ile\n        const processedWithTotal: Order[] = ordersWithTotal.map(order => ({\n          ...order,\n          totalAmount: order.totalAmount || order.total_amount,\n          total_amount: order.totalAmount || order.total_amount,\n        })) as Order[];\n        \n        // TotalAmount'u olmayanlar batch olarak ile (performans iin sadece grnen sayfa iin)\n        // Sadece grnen sayfadaki sipariler iin totalAmount hesapla\n        const startIndex = (page - 1) * 50;\n        const endIndex = startIndex + 50;\n        const visibleOrdersWithoutTotal = ordersWithoutTotal.slice(startIndex, endIndex);\n        \n        // Grnmeyen siparileri totalAmount=0 ile ekle\n        const beforeVisible = ordersWithoutTotal.slice(0, startIndex).map(order => ({\n          ...order,\n          totalAmount: 0,\n          total_amount: 0,\n        })) as Order[];\n        const afterVisible = ordersWithoutTotal.slice(endIndex).map(order => ({\n          ...order,\n          totalAmount: 0,\n          total_amount: 0,\n        })) as Order[];\n        \n        // lk render iin: totalAmount=0 ile gster, sonra hesapla\n        const validOrdersInitial = [...processedWithTotal, ...beforeVisible, ...visibleOrdersWithoutTotal.map(o => ({ ...o, totalAmount: 0, total_amount: 0 })), ...afterVisible];\n        \n        // Defer totalAmount calculation: lk render'dan sonra hesapla (200ms defer)\n        setTimeout(async () => {\n          const ordersWithCalculatedTotals = await Promise.allSettled(\n            visibleOrdersWithoutTotal.map(async (order) => {\n              if (!order?.id) return null;\n              try {\n                const items = await getOrderItems(order.id);\n                const calculatedTotal = (Array.isArray(items) ? items : []).reduce((sum, item) => {\n                  if (!item) return sum;\n                  const itemTotal = item.total || ((item.unitPrice || item.unit_price || 0) * (item.quantity || 0)) - (item.discount || 0);\n                  return sum + itemTotal;\n                }, 0);\n                \n                const calculatedQuantity = (Array.isArray(items) ? items : []).reduce((sum, item) => sum + (item?.quantity || 0), 0);\n                \n                const taxRate = order.taxRate || order.tax_rate || 0;\n                const subtotal = calculatedTotal;\n                const taxAmount = subtotal * (taxRate / 100);\n                const grandTotal = subtotal + taxAmount;\n                \n                return {\n                  ...order,\n                  totalAmount: grandTotal,\n                  total_amount: grandTotal,\n                  totalQuantity: calculatedQuantity,\n                  total_quantity: calculatedQuantity,\n                  subtotal: subtotal,\n                } as Order;\n              } catch (error: unknown) {\n                // Sessizce handle et - performans iin\n                return {\n                  ...order,\n                  totalAmount: 0,\n                  total_amount: 0,\n                } as Order;\n              }\n            })\n          );\n          \n          const calculatedOrders: Order[] = ordersWithCalculatedTotals\n            .filter((result) => result.status === 'fulfilled' && result.value !== null)\n            .map(result => (result as PromiseFulfilledResult<Order>).value);\n          \n          // Tm siparileri birletir (sralama: processedWithTotal, beforeVisible, calculatedOrders, afterVisible)\n          const validOrders = [...processedWithTotal, ...beforeVisible, ...calculatedOrders, ...afterVisible];\n          \n          // Search ve sort ilemleri frontend'de yaplacak\n          let filtered = validOrders;\n          \n          if (searchQuery) {\n            const query = searchQuery.toLocaleLowerCase('tr-TR');\n            filtered = filtered.filter((order) =>\n              order.orderNumber?.toLocaleLowerCase('tr-TR').includes(query) ||\n              order.customerName?.toLocaleLowerCase('tr-TR').includes(query) ||\n              order.customerCompany?.toLocaleLowerCase('tr-TR').includes(query)\n            );\n          }\n          \n          // Sort\n          filtered.sort((a, b) => {\n            let aValue: unknown, bValue: unknown;\n            if (sortBy === 'order_date') {\n              aValue = a.orderDate || a.createdAt;\n              bValue = b.orderDate || b.createdAt;\n            } else if (sortBy === 'created_at') {\n              aValue = a.createdAt;\n              bValue = b.createdAt;\n            } else if (sortBy === 'delivery_date') {\n              aValue = a.deliveryDate || null;\n              bValue = b.deliveryDate || null;\n              // Null deerleri en sona al\n              if (aValue === null && bValue === null) return 0;\n              if (aValue === null) return 1;\n              if (bValue === null) return -1;\n            } else if (sortBy === 'total') {\n              aValue = a.totalAmount || 0;\n              bValue = b.totalAmount || 0;\n            } else if (sortBy === 'priority') {\n              aValue = (a as Order & { priority?: number }).priority ?? 0;\n              bValue = (b as Order & { priority?: number }).priority ?? 0;\n            } else {\n              aValue = a.orderNumber || '';\n              bValue = b.orderNumber || '';\n            }\n            \n            if (aValue instanceof Timestamp) aValue = aValue.toMillis();\n            if (bValue instanceof Timestamp) bValue = bValue.toMillis();\n            if (aValue instanceof Date) aValue = aValue.getTime();\n            if (bValue instanceof Date) bValue = bValue.getTime();\n            \n            return sortOrder === 'asc' \n              ? (aValue > bValue ? 1 : -1)\n              : (aValue < bValue ? 1 : -1);\n          });\n          \n          // Pagination\n          setOrders(filtered.slice(startIndex, endIndex));\n          setTotalPages(Math.ceil(filtered.length / 50));\n        }, 200);\n        \n        // lk render iin: totalAmount=0 ile gster\n        const validOrders = validOrdersInitial;\n        \n        // lk render iin: Search ve sort ilemleri frontend'de yaplacak\n        let filtered = validOrders;\n        \n        if (searchQuery) {\n          const query = searchQuery.toLocaleLowerCase('tr-TR');\n          filtered = filtered.filter((order) =>\n            order.orderNumber?.toLocaleLowerCase('tr-TR').includes(query) ||\n            order.customerName?.toLocaleLowerCase('tr-TR').includes(query) ||\n            order.customerCompany?.toLocaleLowerCase('tr-TR').includes(query)\n          );\n        }\n        \n        // Sort (totalAmount=0 olanlar iin basit sort)\n        filtered.sort((a, b) => {\n          let aValue: unknown, bValue: unknown;\n          if (sortBy === 'order_date') {\n            aValue = a.orderDate || a.createdAt;\n            bValue = b.orderDate || b.createdAt;\n          } else if (sortBy === 'created_at') {\n            aValue = a.createdAt;\n            bValue = b.createdAt;\n          } else if (sortBy === 'delivery_date') {\n            aValue = a.deliveryDate || null;\n            bValue = b.deliveryDate || null;\n            if (aValue === null && bValue === null) return 0;\n            if (aValue === null) return 1;\n            if (bValue === null) return -1;\n          } else if (sortBy === 'total') {\n            aValue = a.totalAmount || 0;\n            bValue = b.totalAmount || 0;\n          } else if (sortBy === 'priority') {\n            aValue = (a as Order & { priority?: number }).priority ?? 0;\n            bValue = (b as Order & { priority?: number }).priority ?? 0;\n          } else {\n            aValue = a.orderNumber || '';\n            bValue = b.orderNumber || '';\n          }\n          \n          if (aValue instanceof Timestamp) aValue = aValue.toMillis();\n          if (bValue instanceof Timestamp) bValue = bValue.toMillis();\n          if (aValue instanceof Date) aValue = aValue.getTime();\n          if (bValue instanceof Date) bValue = bValue.getTime();\n          \n          return sortOrder === 'asc' \n            ? (aValue > bValue ? 1 : -1)\n            : (aValue < bValue ? 1 : -1);\n        });\n        \n        // Pagination\n        setOrders(filtered.slice(startIndex, endIndex));\n        setTotalPages(Math.ceil(filtered.length / 50));\n        setLoading(false);\n      } catch (error: unknown) {\n        if (import.meta.env.DEV) {\n          console.error(\"Real-time orders update error:\", error);\n        }\n        setLoading(false);\n      }\n    });\n    \n    // Cleanup: Component unmount olduunda unsubscribe et\n    return () => {\n      unsubscribe();\n    };\n    }, 100);\n    \n    return () => {\n      clearTimeout(timer);\n    };\n  }, [statusFilter, sortBy, sortOrder, searchQuery, page]);\n\n  const handleShowCustomer = async (customerId: string | null) => {\n    if (!customerId) return;\n    try {\n      const customer = await getCustomerById(customerId);\n      if (customer) {\n        setCustomerModalData(customer);\n        setCustomerModalOpen(true);\n      } else {\n        toast.error(\"Mteri bulunamad\");\n      }\n    } catch (error: unknown) {\n      if (import.meta.env.DEV) {\n        console.error(\"Get customer error:\", error);\n      }\n      const errorMessage = error instanceof Error ? error.message : String(error);\n      toast.error(errorMessage || \"Mteri bilgileri alnamad\");\n    }\n  };\n\n  // Reset to page 1 when filters change\n  useEffect(() => {\n    if (page !== 1) {\n      setPage(1);\n    }\n  }, [statusFilter, sortBy, sortOrder, searchQuery]);\n\n  // Permission kontrol\n  useEffect(() => {\n    const checkPermissions = async () => {\n      if (!user) {\n        setCanCreate(false);\n        setCanUpdate(false);\n        setCanDelete(false);\n        return;\n      }\n\n      const userProfile: UserProfile = {\n        id: user.id,\n        email: user.email || \"\",\n        emailVerified: user.emailVerified || false,\n        fullName: user.fullName || \"\",\n        displayName: user.fullName || \"\",\n        phone: null,\n        dateOfBirth: null,\n        role: user.roles || [],\n        createdAt: null,\n        updatedAt: null,\n      };\n\n      const [canCreateOrder, canUpdateOrder, canDeleteOrder] = await Promise.all([\n        canCreateResource(userProfile, \"orders\"),\n        canUpdateResource(userProfile, \"orders\"),\n        canDeleteResource(userProfile, \"orders\"),\n      ]);\n\n      setCanCreate(canCreateOrder);\n      setCanUpdate(canUpdateOrder);\n      setCanDelete(canDeleteOrder);\n      \n      // Ekip lideri her zaman ekleme/dzenleme/silme yapabilir\n      if (isTeamLeader) {\n        setCanCreate(true);\n        setCanUpdate(true);\n        setCanDelete(true);\n      }\n    };\n\n    checkPermissions();\n  }, [user]);\n\n  const getStatusVariant = (status: string): \"default\" | \"secondary\" | \"destructive\" | \"outline\" => {\n    switch (status) {\n      case \"delivered\":\n      case \"completed\":\n        return \"default\";\n      case \"in_production\":\n      case \"in_progress\":\n      case \"shipped\":\n      case \"quality_check\":\n        return \"secondary\";\n      case \"cancelled\":\n        return \"destructive\";\n      default:\n        return \"outline\";\n    }\n  };\n\n  const getStatusLabel = (status: string) => {\n    const labels: Record<string, string> = {\n      draft: \"Taslak\",\n      pending: \"Beklemede\",\n      confirmed: \"Onayland\",\n      planned: \"Planlanan\",\n      in_production: \"retimde\",\n      in_progress: \"retimde\",\n      quality_check: \"Kalite Kontrol\",\n      on_hold: \"Beklemede\",\n      completed: \"Tamamland\",\n      shipped: \"Kargoda\",\n      delivered: \"Teslim Edildi\",\n      cancelled: \"ptal\",\n    };\n    return labels[status] || status;\n  };\n\n  const getStatusColor = (status: string) => {\n    const colors: Record<string, string> = {\n      draft: \"bg-gray-100 text-gray-800 border-gray-300\",\n      pending: \"bg-yellow-100 text-yellow-800 border-yellow-300\",\n      confirmed: \"bg-blue-100 text-blue-800 border-blue-300\",\n      planned: \"bg-indigo-100 text-indigo-800 border-indigo-300\",\n      in_production: \"bg-orange-100 text-orange-800 border-orange-300\",\n      in_progress: \"bg-orange-100 text-orange-800 border-orange-300\",\n      quality_check: \"bg-cyan-100 text-cyan-800 border-cyan-300\",\n      on_hold: \"bg-amber-100 text-amber-800 border-amber-300\",\n      completed: \"bg-green-100 text-green-800 border-green-300\",\n      shipped: \"bg-purple-100 text-purple-800 border-purple-300\",\n      delivered: \"bg-emerald-100 text-emerald-800 border-emerald-300\",\n      cancelled: \"bg-red-100 text-red-800 border-red-300\",\n    };\n    return colors[status] || \"bg-gray-100 text-gray-800 border-gray-300\";\n  };\n\n  const handleDelete = async () => {\n    if (!selectedOrder) return;\n    \n    // Yetki kontrol\n    if (!canDelete) {\n      toast.error(\"Sipari silme yetkiniz yok.\");\n      setDeleteDialogOpen(false);\n      return;\n    }\n\n    try {\n      await deleteOrder(selectedOrder.id);\n      toast.success(\"Sipari silindi\");\n      // Real-time subscribe otomatik gncelleyecek\n      setDeleteDialogOpen(false);\n      setSelectedOrder(null);\n    } catch (error: unknown) {\n      if (import.meta.env.DEV) {\n        console.error(\"Delete order error:\", error);\n      }\n      const errorMessage = error instanceof Error ? error.message : String(error);\n      toast.error(errorMessage || \"Sipari silinirken hata olutu\");\n    }\n  };\n\n  const formatCurrency = (value?: number, currency?: Currency | string) => {\n    if (value === undefined || value === null) {\n      const symbol = currency ? (CURRENCY_SYMBOLS[currency as Currency] || \"\") : \"\";\n      return `${symbol}0,00`;\n    }\n    \n    const orderCurrency = (currency || \"TRY\") as Currency;\n    const currencyCode = orderCurrency === \"TRY\" ? \"TRY\" : orderCurrency;\n    const locale = orderCurrency === \"TRY\" ? \"tr-TR\" : \"en-US\";\n    const symbol = CURRENCY_SYMBOLS[orderCurrency] || \"\";\n    \n    try {\n      return new Intl.NumberFormat(locale, {\n        style: \"currency\",\n        currency: currencyCode,\n        minimumFractionDigits: 2,\n      }).format(value);\n    } catch {\n      return `${symbol}${value.toFixed(2)}`;\n    }\n  };\n\n\n  if (loading) {\n    return (\n      <MainLayout>\n        <LoadingState message=\"Sipariler ykleniyor...\" />\n      </MainLayout>\n    );\n  }\n\n  return (\n    <MainLayout>\n      <div className=\"space-y-2 w-full sm:w-[95%] md:w-[90%] lg:max-w-[1400px] mx-auto\">\n        <div className=\"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-1.5 sm:gap-2\">\n          <div className=\"flex-1 min-w-0\">\n            <h1 className=\"text-lg sm:text-xl font-semibold text-foreground\">Sipariler</h1>\n            <p className=\"text-muted-foreground mt-0.5 text-xs sm:text-sm\">Sipari takibi ve ynetimi</p>\n          </div>\n          {canCreate && (\n            <Button \n              className=\"gap-1 w-full sm:w-auto min-h-[36px] sm:min-h-8 text-[11px] sm:text-xs\" \n              onClick={() => {\n                setCreateDialogOpen(true);\n              }}\n            >\n              <Plus className=\"h-4 w-4\" />\n              <span className=\"hidden sm:inline\">Yeni Sipari</span>\n              <span className=\"sm:hidden\">Yeni</span>\n            </Button>\n          )}\n        </div>\n\n        <Card>\n          <CardContent className=\"p-1.5\">\n            <div className=\"flex flex-col sm:flex-row items-stretch sm:items-center gap-1.5 sm:gap-2\">\n              {/* Arama Kutusu */}\n              <div className=\"flex-1 min-w-0 w-full sm:w-auto sm:min-w-[200px] md:min-w-[250px]\">\n                <SearchInput\n                  placeholder=\"Sipari ara...\"\n                  className=\"w-full h-9 sm:h-10 text-[11px] sm:text-xs\"\n                  value={searchQuery}\n                  onChange={(e) => setSearchQuery(e.target.value)}\n                />\n              </div>\n              \n              {/* Durum Filtresi */}\n              <div className=\"w-full sm:w-auto sm:min-w-[160px] md:min-w-[180px]\">\n                <Select value={statusFilter} onValueChange={setStatusFilter}>\n                  <SelectTrigger className=\"w-full h-9 sm:h-10 text-[11px] sm:text-xs\">\n                    <SelectValue placeholder=\"Durum Filtrele\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"all\">Tm Durumlar</SelectItem>\n                    <SelectItem value=\"draft\">Taslak</SelectItem>\n                    <SelectItem value=\"pending\">Beklemede</SelectItem>\n                    <SelectItem value=\"confirmed\">Onayland</SelectItem>\n                    <SelectItem value=\"planned\">Planlanan</SelectItem>\n                    <SelectItem value=\"in_production\">retimde</SelectItem>\n                    <SelectItem value=\"in_progress\">retimde</SelectItem>\n                    <SelectItem value=\"quality_check\">Kalite Kontrol</SelectItem>\n                    <SelectItem value=\"on_hold\">Beklemede</SelectItem>\n                    <SelectItem value=\"completed\">Tamamland</SelectItem>\n                    <SelectItem value=\"shipped\">Kargoda</SelectItem>\n                    <SelectItem value=\"delivered\">Teslim Edildi</SelectItem>\n                    <SelectItem value=\"cancelled\">ptal</SelectItem>\n                  </SelectContent>\n                </Select>\n              </div>\n              \n              {/* Sralama */}\n              <div className=\"w-full sm:w-auto sm:min-w-[160px] md:min-w-[180px]\">\n                <Select value={sortBy} onValueChange={setSortBy}>\n                  <SelectTrigger className=\"w-full h-9 sm:h-10 text-[11px] sm:text-xs\">\n                    <SelectValue placeholder=\"Srala\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"order_date\">Sipari Tarihine Gre</SelectItem>\n                    <SelectItem value=\"created_at\">Oluturulma Tarihine Gre</SelectItem>\n                    <SelectItem value=\"delivery_date\">Teslimat Tarihine Gre</SelectItem>\n                    <SelectItem value=\"total\">Tutara Gre</SelectItem>\n                    <SelectItem value=\"priority\">ncelie Gre</SelectItem>\n                    <SelectItem value=\"order_number\">Sipari No</SelectItem>\n                  </SelectContent>\n                </Select>\n              </div>\n              \n              {/* Sralama Yn */}\n              <Button\n                variant=\"outline\"\n                size=\"sm\"\n                onClick={() => setSortOrder(sortOrder === \"asc\" ? \"desc\" : \"asc\")}\n                className=\"h-9 sm:h-10 text-[11px] sm:text-xs\"\n              >\n                {sortOrder === \"asc\" ? <ArrowUp className=\"h-3.5 w-3.5 sm:h-4 sm:w-4 sm:mr-2\" /> : <ArrowDown className=\"h-3.5 w-3.5 sm:h-4 sm:w-4 sm:mr-2\" />}\n                <span className=\"hidden sm:inline\">{sortOrder === \"asc\" ? \"Artan\" : \"Azalan\"}</span>\n              </Button>\n            </div>\n          </CardContent>\n        </Card>\n\n        {/* Responsive Table View */}\n        <Card>\n          <CardContent className=\"p-0\">\n            <ResponsiveTable\n              data={orders}\n              columns={[\n                {\n                  key: \"order_number\",\n                  header: \"Sipari No\",\n                  accessor: (order) => (\n                    <span className=\"font-medium text-sm whitespace-nowrap\">\n                      {order.order_number || \"-\"}\n                    </span>\n                  ),\n                  priority: \"high\",\n                  minWidth: 120,\n                  sticky: true,\n                  headerClassName: \"text-left\",\n                  cellClassName: \"text-left\",\n                },\n                {\n                  key: \"status\",\n                  header: \"Durum\",\n                  accessor: (order) => (\n                    <Badge className={`${getStatusColor(order.status)} text-xs whitespace-nowrap`}>\n                      {getStatusLabel(order.status)}\n                    </Badge>\n                  ),\n                  priority: \"high\",\n                  minWidth: 120,\n                  headerClassName: \"text-left\",\n                  cellClassName: \"text-left\",\n                },\n                {\n                  key: \"total\",\n                  header: \"Tutar\",\n                  accessor: (order) => (\n                    <span className=\"font-semibold whitespace-nowrap\">\n                      {formatCurrency(order.totalAmount || order.total_amount || 0, order.currency)}\n                    </span>\n                  ),\n                  priority: \"high\",\n                  minWidth: 120,\n                  headerClassName: \"text-left\",\n                  cellClassName: \"text-left\",\n                },\n                {\n                  key: \"customer_name\",\n                  header: \"Mteri\",\n                  accessor: (order) => (\n                    <button\n                      type=\"button\"\n                      className=\"hover:text-primary focus:outline-none truncate block text-left w-full\"\n                      onClick={(e) => {\n                        e.stopPropagation();\n                        handleShowCustomer(order.customer_id);\n                      }}\n                    >\n                      {order.customer_name || \"-\"}\n                      {order.customer_company && (\n                        <span className=\"text-muted-foreground\"> - {order.customer_company}</span>\n                      )}\n                    </button>\n                  ),\n                  priority: \"medium\",\n                  minWidth: 120,\n                  headerClassName: \"text-left\",\n                  cellClassName: \"text-left\",\n                },\n                {\n                  key: \"order_date\",\n                  header: \"Tarih\",\n                  accessor: (order) => (\n                    <span className=\"whitespace-nowrap\">\n                      {order.order_date ? new Date(order.order_date).toLocaleDateString(\"tr-TR\") : \"-\"}\n                    </span>\n                  ),\n                  priority: \"medium\",\n                  minWidth: 120,\n                  headerClassName: \"text-left\",\n                  cellClassName: \"text-left\",\n                },\n                {\n                  key: \"priority\",\n                  header: \"ncelik\",\n                  accessor: (order) => (\n                    <Badge className={`${getPriorityMeta(order.priority || 0).className} text-xs whitespace-nowrap`}>\n                      {getPriorityMeta(order.priority || 0).label}\n                    </Badge>\n                  ),\n                  priority: \"low\",\n                  minWidth: 120,\n                  headerClassName: \"text-left\",\n                  cellClassName: \"text-left\",\n                },\n              ]}\n              renderCard={(order) => (\n                <ResponsiveCard \n                  className=\"p-3 sm:p-4 cursor-pointer hover:bg-muted/50 transition-colors\"\n                  onClick={() => {\n                    setSelectedOrder(order);\n                    setDetailModalOpen(true);\n                  }}\n                >\n                  <div className=\"space-y-2\">\n                    <div className=\"flex items-start justify-between gap-2\">\n                      <div className=\"flex-1 min-w-0\">\n                        <h3 className=\"font-semibold text-sm truncate\">{order.order_number}</h3>\n                        <p className=\"text-xs text-muted-foreground truncate mt-0.5\">\n                          {order.customer_name || \"-\"}\n                        </p>\n                      </div>\n                      <Badge className={`${getStatusColor(order.status)} text-[10px] flex-shrink-0`}>\n                        {getStatusLabel(order.status)}\n                      </Badge>\n                    </div>\n                    <div className=\"flex items-center justify-between gap-2 text-xs\">\n                      <span className=\"text-muted-foreground\">\n                        {order.order_date ? new Date(order.order_date).toLocaleDateString(\"tr-TR\") : \"-\"}\n                      </span>\n                      <span className=\"font-semibold\">\n                        {formatCurrency(order.totalAmount || order.total_amount || 0, order.currency)}\n                      </span>\n                    </div>\n                  </div>\n                </ResponsiveCard>\n              )}\n              emptyMessage={searchQuery || statusFilter !== \"all\" ? \"Arama sonucu bulunamad\" : \"Henz sipari bulunmuyor\"}\n              onRowClick={(order) => {\n                setSelectedOrder(order);\n                setDetailModalOpen(true);\n              }}\n              keyExtractor={(order) => order.id}\n            />\n            {totalPages > 1 && (\n              <div className=\"flex flex-col gap-2 p-2 xs:p-3 border-t md:flex-row md:items-center md:justify-between\">\n                <div className=\"text-[11px] sm:text-xs text-muted-foreground text-center md:text-left\">\n                  Sayfa {page} / {totalPages}\n                </div>\n                <div className=\"flex gap-2 justify-center md:justify-end\">\n                  <Button\n                    variant=\"outline\"\n                    size=\"sm\"\n                    className=\"h-8 sm:h-9 text-[11px] sm:text-xs min-h-[44px] sm:min-h-[36px]\"\n                    onClick={() => setPage(p => Math.max(1, p - 1))}\n                    disabled={page === 1 || loading}\n                  >\n                    nceki\n                  </Button>\n                  <Button\n                    variant=\"outline\"\n                    size=\"sm\"\n                    className=\"h-8 sm:h-9 text-[11px] sm:text-xs min-h-[44px] sm:min-h-[36px]\"\n                    onClick={() => setPage(p => Math.min(totalPages, p + 1))}\n                    disabled={page === totalPages || loading}\n                  >\n                    Sonraki\n                  </Button>\n                </div>\n              </div>\n            )}\n          </CardContent>\n        </Card>\n      </div>\n\n      <CreateOrderDialog\n        open={createDialogOpen}\n        onOpenChange={setCreateDialogOpen}\n        onSuccess={() => {\n          // Real-time subscribe otomatik gncelleyecek\n          setCreateDialogOpen(false);\n          setSelectedOrder(null);\n        }}\n        order={selectedOrder} // Edit modu iin mevcut sipari\n      />\n\n      {selectedOrder && (\n        <OrderDetailModal\n          open={detailModalOpen}\n          onOpenChange={setDetailModalOpen}\n          order={selectedOrder}\n          onEdit={() => {\n            // Dzenleme dialog'unu a (selectedOrder zaten set edilmi)\n            setDetailModalOpen(false);\n            setCreateDialogOpen(true);\n          }}\n          onDelete={() => {\n            setDetailModalOpen(false);\n            setDeleteDialogOpen(true);\n          }}\n        />\n      )}\n\n      <CustomerDetailModal\n        open={customerModalOpen}\n        onOpenChange={setCustomerModalOpen}\n        customer={customerModalData}\n      />\n\n      <AlertDialog open={deleteDialogOpen} onOpenChange={setDeleteDialogOpen}>\n        <AlertDialogContent>\n          <AlertDialogHeader>\n            <AlertDialogTitle>Siparii sil?</AlertDialogTitle>\n            <AlertDialogDescription>\n              Bu ilem geri alnamaz. Sipari ve bal rnler kalc olarak silinecek.\n            </AlertDialogDescription>\n          </AlertDialogHeader>\n          <AlertDialogFooter>\n            <AlertDialogCancel>ptal</AlertDialogCancel>\n            <AlertDialogAction onClick={handleDelete}>Sil</AlertDialogAction>\n          </AlertDialogFooter>\n        </AlertDialogContent>\n      </AlertDialog>\n    </MainLayout>\n  );\n};\n\nexport default Orders;\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\pages\\Production.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'page'. Either include it or remove the dependency array.","line":115,"column":6,"nodeType":"ArrayExpression","endLine":115,"endColumn":39,"suggestions":[{"desc":"Update the dependencies array to be: [statusFilter, sortBy, sortOrder, page]","fix":{"range":[4403,4436],"text":"[statusFilter, sortBy, sortOrder, page]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useEffect, useState } from \"react\";\nimport { MainLayout } from \"@/components/Layout/MainLayout\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader } from \"@/components/ui/card\";\nimport { Input } from \"@/components/ui/input\";\nimport { SearchInput } from \"@/components/ui/search-input\";\nimport {\n  Plus,\n  Edit,\n  Trash2,\n  ArrowUp01,\n  ArrowDown01,\n  ChevronsUpDown,\n  CalendarDays,\n  Flag,\n  UserCircle2,\n  Package,\n  Clock3,\n  X,\n  MoreVertical,\n} from \"lucide-react\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { ResponsiveTable, ResponsiveTableColumn } from \"@/components/shared/ResponsiveTable\";\nimport { toast } from \"sonner\";\nimport { getOrders, deleteOrder, updateOrder, Order, subscribeToOrders, getOrderItems } from \"@/services/firebase/orderService\";\nimport { Timestamp } from \"firebase/firestore\";\nimport { useAuth } from \"@/contexts/AuthContext\";\nimport { canCreateResource, canUpdateResource, canDeleteResource } from \"@/utils/permissions\";\nimport { UserProfile } from \"@/services/firebase/authService\";\nimport { CURRENCY_SYMBOLS, Currency } from \"@/utils/currency\";\nimport { getPriorityMeta } from \"@/utils/priority\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { DropdownMenu, DropdownMenuContent, DropdownMenuItem, DropdownMenuTrigger } from \"@/components/ui/dropdown-menu\";\nimport {\n  AlertDialog,\n  AlertDialogAction,\n  AlertDialogCancel,\n  AlertDialogContent,\n  AlertDialogDescription,\n  AlertDialogFooter,\n  AlertDialogHeader,\n  AlertDialogTitle,\n} from \"@/components/ui/alert-dialog\";\nimport { CreateOrderDialog } from \"@/components/Production/CreateOrderDialog\";\nimport { OrderDetailModal } from \"@/components/Production/OrderDetailModal\";\nimport { LoadingState } from \"@/components/ui/loading-state\";\n\ninterface ProductionOrder {\n  id: string;\n  order_number?: string;\n  orderNumber?: string;\n  product_name?: string;\n  productName?: string;\n  quantity?: number;\n  unit?: string;\n  customer_name?: string | null;\n  customerName?: string | null;\n  customer_company?: string;\n  status: string;\n  due_date?: string;\n  dueDate?: Date | string | Timestamp;\n  priority?: number;\n  created_at?: string;\n  createdAt?: Date | Timestamp;\n  totalAmount?: number;\n  total_amount?: number;\n  currency?: string;\n}\n\ntype SortKey = \"order_number\" | \"customer_name\" | \"due_date\" | \"status\" | \"priority\" | \"created_at\";\ntype SortOrder = \"asc\" | \"desc\";\n\nconst statusOptions: Array<{ value: ProductionOrder[\"status\"]; label: string }> = [\n  { value: \"planned\", label: \"Planlanan\" },\n  { value: \"in_production\", label: \"retimde\" },\n  { value: \"quality_check\", label: \"Kalite Kontrol\" },\n  { value: \"completed\", label: \"Tamamland\" },\n  { value: \"on_hold\", label: \"Beklemede\" },\n];\n\nconst Production = () => {\n  const { isAdmin, isTeamLeader, user } = useAuth();\n  const [orders, setOrders] = useState<ProductionOrder[]>([]);\n  const [loading, setLoading] = useState(false); // Balangta false - placeholder data ile hzl render\n  const [createDialogOpen, setCreateDialogOpen] = useState(false);\n  const [detailModalOpen, setDetailModalOpen] = useState(false);\n  const [deleteDialogOpen, setDeleteDialogOpen] = useState(false);\n  const [selectedOrder, setSelectedOrder] = useState<ProductionOrder | null>(null);\n  const [searchQuery, setSearchQuery] = useState(\"\");\n  const [sortBy, setSortBy] = useState<SortKey>(\"created_at\");\n  const [sortOrder, setSortOrder] = useState<SortOrder>(\"desc\");\n  \n  const handleSort = (key: SortKey) => {\n    if (sortBy === key) {\n      setSortOrder(sortOrder === \"asc\" ? \"desc\" : \"asc\");\n    } else {\n      setSortBy(key);\n      setSortOrder(\"asc\");\n    }\n  };\n  const [statusFilter, setStatusFilter] = useState<\"all\" | ProductionOrder[\"status\"]>(\"all\");\n  const [updatingOrderId, setUpdatingOrderId] = useState<string | null>(null);\n  const [page, setPage] = useState(1);\n  const [totalPages, setTotalPages] = useState(1);\n  const [canCreate, setCanCreate] = useState(false);\n  const [canUpdate, setCanUpdate] = useState(false);\n  const [canDelete, setCanDelete] = useState(false);\n  const [ordersWithItems, setOrdersWithItems] = useState<Map<string, { productName?: string; quantity?: number; unit?: string }>>(new Map());\n\n  // Reset to page 1 when filters change\n  useEffect(() => {\n    if (page !== 1) {\n      setPage(1);\n    }\n  }, [statusFilter, sortBy, sortOrder]);\n\n  // Yetki kontrolleri\n  useEffect(() => {\n    const checkPermissions = async () => {\n      if (!user) {\n        setCanCreate(false);\n        setCanUpdate(false);\n        setCanDelete(false);\n        return;\n      }\n      try {\n        const userProfile: UserProfile = {\n          id: user.id,\n          email: user.email,\n          emailVerified: user.emailVerified,\n          fullName: user.fullName,\n          displayName: user.fullName,\n          phone: user.phone,\n          dateOfBirth: user.dateOfBirth,\n          role: user.roles,\n          createdAt: Timestamp.now(),\n          updatedAt: Timestamp.now(),\n        };\n        const [createAllowed, updateAllowed, deleteAllowed] = await Promise.all([\n          canCreateResource(userProfile, \"orders\"),\n          canUpdateResource(userProfile, \"orders\"),\n          canDeleteResource(userProfile, \"orders\"),\n        ]);\n        setCanCreate(createAllowed);\n        setCanUpdate(updateAllowed);\n        setCanDelete(deleteAllowed);\n      } catch (error) {\n        if (import.meta.env.DEV) {\n          console.error(\"Production permission check error:\", error);\n        }\n        setCanCreate(false);\n        setCanUpdate(false);\n        setCanDelete(false);\n      }\n    };\n    checkPermissions();\n  }, [user]);\n\n  // Gerek zamanl sipari gncellemeleri iin subscribe\n  useEffect(() => {\n    // Defer subscription: lk render'dan 100ms sonra balat (non-blocking)\n    const timer = setTimeout(() => {\n      setLoading(true);\n      \n      const filters: { status?: string } = {};\n      if (statusFilter !== 'all') {\n        filters.status = statusFilter;\n      }\n      \n      // Gerek zamanl dinleme balat\n      const unsubscribe = subscribeToOrders(filters, async (firebaseOrders) => {\n      try {\n        // Null/undefined kontrol\n        if (!Array.isArray(firebaseOrders)) {\n          setOrders([]);\n          setTotalPages(1);\n          setLoading(false);\n          return;\n        }\n        \n        // Search ve sort ilemleri frontend'de yaplacak\n        let filtered = firebaseOrders;\n        \n        if (searchQuery) {\n          const query = searchQuery.toLocaleLowerCase('tr-TR');\n          filtered = filtered.filter((order: Order) => {\n            const orderNum = (order.order_number || order.orderNumber || \"\").toLocaleLowerCase('tr-TR');\n            const customerName = (order.customer_name || order.customerName || \"\").toLocaleLowerCase('tr-TR');\n            // Order'da productName yok, items'da var - bu yzden sadece orderNumber ve customerName ile arama yapyoruz\n            return orderNum.includes(query) || customerName.includes(query);\n          });\n        }\n        \n        // Sort\n        filtered.sort((a, b) => {\n          let aValue: unknown, bValue: unknown;\n          if (sortBy === 'created_at') {\n            aValue = a.createdAt;\n            bValue = b.createdAt;\n          } else if (sortBy === 'priority') {\n            // Priority iin order'da priority field' yok, imdilik createdAt kullan\n            aValue = a.createdAt;\n            bValue = b.createdAt;\n          } else if (sortBy === 'due_date') {\n            aValue = a.dueDate || a.deliveryDate;\n            bValue = b.dueDate || b.deliveryDate;\n          } else {\n            aValue = a.orderNumber || '';\n            bValue = b.orderNumber || '';\n          }\n          \n          if (aValue instanceof Timestamp) aValue = aValue.toMillis();\n          if (bValue instanceof Timestamp) bValue = bValue.toMillis();\n          if (aValue instanceof Date) aValue = aValue.getTime();\n          if (bValue instanceof Date) bValue = bValue.getTime();\n          \n          return sortOrder === 'asc' \n            ? (aValue > bValue ? 1 : -1)\n            : (aValue < bValue ? 1 : -1);\n        });\n        \n        // Pagination\n        const startIndex = (page - 1) * 50;\n        const endIndex = startIndex + 50;\n        const paginatedOrders = filtered.slice(startIndex, endIndex);\n        setOrders(paginatedOrders);\n        setTotalPages(Math.ceil(filtered.length / 50));\n        \n        // lk render iin: items olmadan gster\n        setOrdersWithItems(new Map());\n        setLoading(false);\n        \n        // Defer items loading: lk render'dan sonra ykle (200ms defer)\n        setTimeout(async () => {\n          const itemsMap = new Map<string, { productName?: string; quantity?: number; unit?: string }>();\n          await Promise.all(\n            paginatedOrders.map(async (order: Order) => {\n              try {\n                const items = await getOrderItems(order.id);\n                if (items.length > 0) {\n                  const firstItem = items[0];\n                  itemsMap.set(order.id, {\n                    productName: firstItem.productName || firstItem.product_name || undefined,\n                    quantity: firstItem.quantity,\n                    unit: \"Adet\", // OrderItem'da unit yok, varsaylan olarak \"Adet\"\n                  });\n                }\n              } catch (error: unknown) {\n                if (import.meta.env.DEV) {\n                  console.error(`Error loading items for order ${order.id}:`, error);\n                }\n              }\n            })\n          );\n          setOrdersWithItems(itemsMap);\n        }, 200);\n      } catch (error: unknown) {\n        if (import.meta.env.DEV) {\n          console.error(\"Real-time production orders update error:\", error);\n        }\n        setLoading(false);\n      }\n    });\n    \n    // Cleanup: Component unmount olduunda unsubscribe et\n    return () => {\n      unsubscribe();\n    };\n    }, 100);\n    \n    return () => {\n      clearTimeout(timer);\n    };\n  }, [statusFilter, sortBy, sortOrder, searchQuery, page]);\n\n  const getStatusVariant = (status: string) => {\n    switch (status) {\n      case \"completed\":\n        return \"default\";\n      case \"in_production\":\n        return \"secondary\";\n      case \"planned\":\n        return \"outline\";\n      default:\n        return \"secondary\";\n    }\n  };\n\n  const getStatusLabel = (status: string) => {\n    const labels: Record<string, string> = {\n      planned: \"Planlanan\",\n      in_production: \"retimde\",\n      quality_check: \"Kalite Kontrol\",\n      completed: \"Tamamland\",\n      on_hold: \"Beklemede\",\n    };\n    return labels[status] || status;\n  };\n\n  const getStatusColor = (status: string) => {\n    const colors: Record<string, string> = {\n      planned: \"bg-indigo-100 text-indigo-800 border-indigo-300\",\n      in_production: \"bg-orange-100 text-orange-800 border-orange-300\",\n      quality_check: \"bg-cyan-100 text-cyan-800 border-cyan-300\",\n      completed: \"bg-green-100 text-green-800 border-green-300\",\n      on_hold: \"bg-amber-100 text-amber-800 border-amber-300\",\n    };\n    return colors[status] || \"bg-gray-100 text-gray-800 border-gray-300\";\n  };\n\nconst formatDate = (value?: string | Date | Timestamp | null | undefined) => {\n  if (!value) return \"-\";\n  \n  let date: Date | null = null;\n  \n  if (value instanceof Date) {\n    date = value;\n  } else if (typeof value === \"string\") {\n    date = new Date(value);\n  } else if (value && typeof value === \"object\") {\n    if (\"seconds\" in value && typeof value.seconds === \"number\") {\n      date = new Date(value.seconds * 1000);\n    } else if (\"toDate\" in value && typeof value.toDate === \"function\") {\n      try {\n        date = value.toDate();\n      } catch {\n        return \"-\";\n      }\n    } else if (\"_seconds\" in value && typeof value._seconds === \"number\") {\n      date = new Date(value._seconds * 1000);\n    }\n  }\n  \n  if (!date || isNaN(date.getTime())) return \"-\";\n  \n  try {\n    return date.toLocaleDateString(\"tr-TR\", {\n      day: \"2-digit\",\n      month: \"short\",\n      year: \"numeric\",\n    });\n  } catch {\n    return \"-\";\n  }\n};\n\n\nconst formatCurrency = (value?: number, currency?: Currency | string) => {\n  if (value === undefined || value === null) {\n    const symbol = currency ? (CURRENCY_SYMBOLS[currency as Currency] || \"\") : \"\";\n    return `${symbol}0,00`;\n  }\n  \n  const orderCurrency = (currency || \"TRY\") as Currency;\n  const currencyCode = orderCurrency === \"TRY\" ? \"TRY\" : orderCurrency;\n  const locale = orderCurrency === \"TRY\" ? \"tr-TR\" : \"en-US\";\n  const symbol = CURRENCY_SYMBOLS[orderCurrency] || \"\";\n  \n  try {\n    return new Intl.NumberFormat(locale, {\n      style: \"currency\",\n      currency: currencyCode,\n      minimumFractionDigits: 2,\n    }).format(value);\n  } catch {\n    return `${symbol}${value.toFixed(2)}`;\n  }\n};\nconst priorityOptions = [\n  { value: 0, label: \"0 - Dk\" },\n  { value: 1, label: \"1\" },\n  { value: 2, label: \"2 - Orta\" },\n  { value: 3, label: \"3\" },\n  { value: 4, label: \"4 - Yksek\" },\n  { value: 5, label: \"5 - Kritik\" },\n];\n\n  const handleDelete = async () => {\n    if (!selectedOrder) return;\n\n    try {\n      await deleteOrder(selectedOrder.id);\n      toast.success(\"Sipari silindi\");\n      // Subscription otomatik gncelleyecek\n      setDeleteDialogOpen(false);\n      setSelectedOrder(null);\n    } catch (error: unknown) {\n      if (import.meta.env.DEV) {\n        console.error(\"Delete production order error:\", error);\n      }\n      toast.error(error instanceof Error ? error.message : \"Sipari silinirken hata olutu\");\n    }\n  };\n\n  const handleUpdateOrder = async (orderId: string, payload: Partial<ProductionOrder>) => {\n    setUpdatingOrderId(orderId);\n    try {\n      // Yetki kontrol\n      if (!canUpdate && !isAdmin && !isTeamLeader) {\n        toast.error(\"Sipari gncelleme yetkiniz yok.\");\n        setUpdatingOrderId(null);\n        return;\n      }\n      // st yneticiler iin durum gei validasyonunu atla\n      const skipValidation = isAdmin === true || isTeamLeader || canUpdate;\n      await updateOrder(orderId, payload as Partial<Order>, user?.id, skipValidation);\n      toast.success(\"Sipari gncellendi\");\n      // Subscription otomatik gncelleyecek\n    } catch (error: unknown) {\n      if (import.meta.env.DEV) {\n        console.error(\"Update order error:\", error);\n      }\n      toast.error(error instanceof Error ? error.message : \"Sipari gncellenemedi\");\n    } finally {\n      setUpdatingOrderId(null);\n    }\n  };\n\n\n  if (loading) {\n    return (\n      <MainLayout>\n        <LoadingState message=\"retim siparileri ykleniyor...\" />\n      </MainLayout>\n    );\n  }\n\n  return (\n    <MainLayout>\n      <div className=\"space-y-2 w-full sm:w-[95%] md:w-[90%] lg:max-w-[1400px] mx-auto\">\n        <div className=\"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-1.5 sm:gap-2\">\n          <div className=\"flex-1 min-w-0\">\n            <h1 className=\"text-lg sm:text-xl font-semibold text-foreground\">retim Siparileri</h1>\n            <p className=\"text-muted-foreground mt-0.5 text-xs sm:text-sm\">retim srelerini ynetin</p>\n          </div>\n          {canCreate && (\n            <Button className=\"gap-1 w-full sm:w-auto min-h-[36px] sm:min-h-8 text-xs sm:text-sm\" onClick={() => setCreateDialogOpen(true)}>\n              <Plus className=\"h-4 w-4\" />\n              <span className=\"hidden sm:inline\">Yeni Sipari</span>\n              <span className=\"sm:hidden\">Yeni</span>\n            </Button>\n          )}\n        </div>\n\n        <Card>\n          <CardContent className=\"p-1.5\">\n            <div className=\"flex flex-col sm:flex-row items-stretch sm:items-center gap-1.5 sm:gap-2\">\n              {/* Arama Kutusu */}\n              <div className=\"flex-1 min-w-0 w-full sm:w-auto sm:min-w-[200px] md:min-w-[250px]\">\n                <SearchInput\n                  placeholder=\"Sipari ara...\"\n                  className=\"w-full h-9 sm:h-10 text-xs sm:text-sm\"\n                  value={searchQuery}\n                  onChange={(e) => setSearchQuery(e.target.value)}\n                />\n              </div>\n              \n              {/* Durum Filtresi */}\n              <div className=\"w-full sm:w-auto sm:min-w-[160px] md:min-w-[180px]\">\n                <Select value={statusFilter === \"all\" ? \"all\" : statusFilter} onValueChange={(value) => setStatusFilter(value as Order[\"status\"] | \"all\")}>\n                  <SelectTrigger className=\"w-full h-9 sm:h-10 text-xs sm:text-sm\">\n                    <SelectValue placeholder=\"Durum Filtrele\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"all\">Tm Durumlar</SelectItem>\n                    {statusOptions.map((option) => (\n                      <SelectItem key={option.value} value={option.value}>\n                        {option.label}\n                      </SelectItem>\n                    ))}\n                  </SelectContent>\n                </Select>\n              </div>\n              \n              {/* Sralama */}\n              <div className=\"w-full sm:w-auto sm:min-w-[160px] md:min-w-[180px]\">\n                <Select value={sortBy} onValueChange={(value) => setSortBy(value as SortKey)}>\n                  <SelectTrigger className=\"w-full h-9 sm:h-10 text-xs sm:text-sm\">\n                    <SelectValue placeholder=\"Srala\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"created_at\">Tarihe Gre</SelectItem>\n                    <SelectItem value=\"priority\">ncelie Gre</SelectItem>\n                    <SelectItem value=\"due_date\">Termin Tarihine Gre</SelectItem>\n                  </SelectContent>\n                </Select>\n              </div>\n              \n              {/* Sralama Yn */}\n              <Button\n                variant=\"outline\"\n                size=\"sm\"\n                onClick={() => setSortOrder(sortOrder === \"asc\" ? \"desc\" : \"asc\")}\n                className=\"h-9 sm:h-10 text-xs sm:text-sm\"\n              >\n                {sortOrder === \"asc\" ? <ArrowUp01 className=\"h-3.5 w-3.5 sm:h-4 sm:w-4 sm:mr-2\" /> : <ArrowDown01 className=\"h-3.5 w-3.5 sm:h-4 sm:w-4 sm:mr-2\" />}\n                <span className=\"hidden sm:inline\">{sortOrder === \"asc\" ? \"Artan\" : \"Azalan\"}</span>\n              </Button>\n            </div>\n          </CardContent>\n        </Card>\n\n        {/* Responsive Table View - Her zaman grnr */}\n        <Card>\n          <CardContent className=\"p-0\">\n            <div className=\"w-full overflow-hidden\">\n              <ResponsiveTable\n                data={orders}\n                columns={[\n                  {\n                    key: \"order_number\",\n                    header: \"Sipari No\",\n                    accessor: (order) => (\n                          <div className=\"flex flex-col gap-0.5\">\n                        <span className=\"text-xs font-medium\">{order.order_number || order.orderNumber || \"-\"}</span>\n                            <span className=\"md:hidden text-xs text-muted-foreground\">\n                              {order.customer_name || order.customerName || \"-\"}\n                            </span>\n                            <span className=\"lg:hidden text-xs text-muted-foreground\">\n                              {formatDate(order.due_date || order.dueDate || order.created_at || order.createdAt)}\n                            </span>\n                          </div>\n                    ),\n                    priority: \"high\",\n                    sticky: true,\n                    minWidth: 120,\n                    headerClassName: \"text-left\",\n                    cellClassName: \"text-left\",\n                  },\n                  {\n                    key: \"customer\",\n                    header: \"Mteri\",\n                    accessor: (order) => (\n                      <span className=\"text-xs font-medium truncate block w-full\">\n                          {order.customer_name || order.customerName || \"-\"}\n                          {order.customer_company && (\n                            <span className=\"text-muted-foreground\"> - {order.customer_company}</span>\n                          )}\n                      </span>\n                    ),\n                    priority: \"medium\",\n                    minWidth: 120,\n                    headerClassName: \"text-left\",\n                    cellClassName: \"text-left\",\n                  },\n                  {\n                    key: \"due_date\",\n                    header: \"Termin\",\n                    accessor: (order) => (\n                      <span className=\"text-xs font-medium\">\n                        {formatDate(order.due_date || order.dueDate || order.created_at || order.createdAt)}\n                      </span>\n                    ),\n                    priority: \"low\",\n                    minWidth: 120,\n                    headerClassName: \"text-left\",\n                    cellClassName: \"text-left\",\n                  },\n                  {\n                    key: \"status\",\n                    header: \"Durum\",\n                    accessor: (order) => (\n                      <Badge className={`${getStatusColor(order.status)} text-xs`}>\n                        {getStatusLabel(order.status)}\n                      </Badge>\n                    ),\n                    priority: \"high\",\n                    minWidth: 120,\n                    headerClassName: \"text-left\",\n                    cellClassName: \"text-left\",\n                  },\n                  {\n                    key: \"priority\",\n                    header: \"ncelik\",\n                    accessor: (order) => {\n                      const priorityMeta = getPriorityMeta(order.priority);\n                      return (\n                        <Badge className={`${priorityMeta.className} text-xs`}>\n                          {priorityMeta.label}\n                        </Badge>\n                      );\n                    },\n                    priority: \"low\",\n                    minWidth: 120,\n                    headerClassName: \"text-left\",\n                    cellClassName: \"text-left\",\n                  },\n                  {\n                    key: \"total\",\n                    header: \"Tutar\",\n                    accessor: (order) => (\n                      <span className=\"text-xs font-semibold whitespace-nowrap\">\n                        {formatCurrency(order.totalAmount || order.total_amount || 0, order.currency)}\n                      </span>\n                    ),\n                    priority: \"high\",\n                    minWidth: 120,\n                    headerClassName: \"text-left\",\n                    cellClassName: \"text-left\",\n                  },\n                ]}\n                emptyMessage={searchQuery || statusFilter !== \"all\" ? \"Arama sonucu bulunamad\" : \"Henz retim siparii bulunmuyor\"}\n                onRowClick={(order) => {\n                  setSelectedOrder(order);\n                  setDetailModalOpen(true);\n                }}\n                renderCard={(order) => {\n                  const priorityMeta = getPriorityMeta(order.priority);\n                  return (\n                    <Card \n                      className=\"cursor-pointer hover:shadow-lg transition-all\"\n                      onClick={() => {\n                        setSelectedOrder(order);\n                        setDetailModalOpen(true);\n                      }}\n                    >\n                      <CardContent className=\"p-3 sm:p-4 space-y-2\">\n                        <div className=\"flex items-start justify-between\">\n                          <div className=\"flex-1\">\n                            <h3 className=\"font-semibold text-xs sm:text-sm mb-1\">\n                              {order.order_number || order.orderNumber || \"-\"}\n                            </h3>\n                            {order.customer_name && (\n                              <p className=\"text-xs sm:text-sm text-muted-foreground\">\n                                {order.customer_name || order.customerName || \"-\"}\n                                {order.customer_company && ` - ${order.customer_company}`}\n                              </p>\n                            )}\n                          </div>\n                          <Badge className={`${getStatusColor(order.status)} text-xs`}>\n                            {getStatusLabel(order.status)}\n                          </Badge>\n                        </div>\n                        <div className=\"flex flex-col gap-1.5 pt-2 border-t\">\n                          <div className=\"flex items-center justify-between text-xs sm:text-sm\">\n                            <span className=\"text-muted-foreground\">Termin:</span>\n                            <span>\n                              {formatDate(order.due_date || order.dueDate || order.created_at || order.createdAt)}\n                            </span>\n                          </div>\n                          <div className=\"flex items-center justify-between text-xs sm:text-sm\">\n                            <span className=\"text-muted-foreground\">ncelik:</span>\n                          <Badge className={`${priorityMeta.className} text-xs`}>\n                            {priorityMeta.label}\n                          </Badge>\n                          </div>\n                          <div className=\"flex items-center justify-between text-xs sm:text-sm\">\n                            <span className=\"text-muted-foreground\">Tutar:</span>\n                            <span className=\"font-semibold\">\n                          {formatCurrency(order.totalAmount || order.total_amount || 0, order.currency)}\n                            </span>\n                          </div>\n                        </div>\n                      </CardContent>\n                    </Card>\n                  );\n                }}\n              />\n            </div>\n            {totalPages > 1 && (\n              <div className=\"flex flex-col gap-2 p-2 border-t md:flex-row md:items-center md:justify-between\">\n                <div className=\"text-[11px] sm:text-xs text-muted-foreground text-center md:text-left\">\n                  Sayfa {page} / {totalPages}\n                </div>\n                <div className=\"flex gap-2 justify-center md:justify-end\">\n                  <Button\n                    variant=\"outline\"\n                    size=\"sm\"\n                    className=\"h-8 sm:h-9 text-[11px] sm:text-xs\"\n                    onClick={() => setPage(p => Math.max(1, p - 1))}\n                    disabled={page === 1 || loading}\n                  >\n                    nceki\n                  </Button>\n                  <Button\n                    variant=\"outline\"\n                    size=\"sm\"\n                    className=\"h-8 sm:h-9 text-[11px] sm:text-xs\"\n                    onClick={() => setPage(p => Math.min(totalPages, p + 1))}\n                    disabled={page === totalPages || loading}\n                  >\n                    Sonraki\n                  </Button>\n                </div>\n              </div>\n            )}\n          </CardContent>\n        </Card>\n      </div>\n\n      <CreateOrderDialog\n        open={createDialogOpen}\n        onOpenChange={(open) => {\n          setCreateDialogOpen(open);\n          if (!open) {\n            // Dialog kapandnda selectedOrder' temizle\n            setSelectedOrder(null);\n          }\n        }}\n        onSuccess={() => {\n          // Subscription otomatik gncelleyecek\n          setCreateDialogOpen(false);\n          setSelectedOrder(null);\n        }}\n        order={selectedOrder as unknown as Order} // Edit modu iin mevcut sipari\n      />\n\n      {selectedOrder && (\n        <OrderDetailModal\n          open={detailModalOpen}\n          onOpenChange={setDetailModalOpen}\n          order={selectedOrder as unknown as Order}\n          onEdit={() => {\n            // Dzenleme dialog'unu a (selectedOrder zaten set edilmi)\n            setDetailModalOpen(false);\n            setCreateDialogOpen(true);\n          }}\n          onDelete={() => {\n            setDetailModalOpen(false);\n            setDeleteDialogOpen(true);\n          }}\n          onUpdate={() => {\n            // Subscription otomatik gncelleyecek\n          }}\n        />\n      )}\n\n      <AlertDialog open={deleteDialogOpen} onOpenChange={setDeleteDialogOpen}>\n        <AlertDialogContent>\n          <AlertDialogHeader>\n            <AlertDialogTitle>Siparii sil?</AlertDialogTitle>\n            <AlertDialogDescription>\n              Bu ilem geri alnamaz. Sipari kalc olarak silinecek.\n            </AlertDialogDescription>\n          </AlertDialogHeader>\n          <AlertDialogFooter>\n            <AlertDialogCancel>ptal</AlertDialogCancel>\n            <AlertDialogAction onClick={handleDelete}>Sil</AlertDialogAction>\n          </AlertDialogFooter>\n        </AlertDialogContent>\n      </AlertDialog>\n    </MainLayout>\n  );\n};\n\nexport default Production;\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\pages\\Products.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useCallback has a missing dependency: 'canDelete'. Either include it or remove the dependency array.","line":200,"column":6,"nodeType":"ArrayExpression","endLine":200,"endColumn":33,"suggestions":[{"desc":"Update the dependencies array to be: [canDelete, selectedProduct, user?.id]","fix":{"range":[7821,7848],"text":"[canDelete, selectedProduct, user?.id]"}}]},{"ruleId":"prefer-const","severity":2,"message":"'filtered' is never reassigned. Use 'const' instead.","line":274,"column":9,"nodeType":"Identifier","messageId":"useConst","endLine":274,"endColumn":17,"fix":{"range":[10214,10988],"text":"const filtered = products.filter((product) => {\n      const matchesSearch = \n        product.name?.toLocaleLowerCase('tr-TR').includes(debouncedSearchTerm.toLocaleLowerCase('tr-TR')) ||\n        product.sku?.toLocaleLowerCase('tr-TR').includes(debouncedSearchTerm.toLocaleLowerCase('tr-TR')) ||\n        product.category?.toLocaleLowerCase('tr-TR').includes(debouncedSearchTerm.toLocaleLowerCase('tr-TR'));\n      \n      const matchesCategory = categoryFilter === \"all\" || product.category === categoryFilter;\n      const matchesStockView =\n        stockView === \"all\" ||\n        (stockView === \"low\" && isLowStockProduct(product)) ||\n        (stockView === \"out\" && isOutOfStockProduct(product));\n      \n      return matchesSearch && matchesCategory && matchesStockView;\n    });"}}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":1,"fixableWarningCount":0,"source":"import { useEffect, useState, useMemo, useCallback, useRef } from \"react\";\nimport { MainLayout } from \"@/components/Layout/MainLayout\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { SearchInput } from \"@/components/ui/search-input\";\nimport { Plus, Package, X, AlertTriangle, TrendingUp, Box, ChevronLeft, ChevronRight, ChevronUp, ChevronDown, Building2, DollarSign, Trash2 } from \"lucide-react\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { toast } from \"sonner\";\nimport { getProducts, deleteProduct, Product } from \"@/services/firebase/productService\";\nimport { getAllUsers } from \"@/services/firebase/authService\";\nimport { useAuth } from \"@/contexts/AuthContext\";\nimport { AlertDialog, AlertDialogAction, AlertDialogCancel, AlertDialogContent, AlertDialogDescription, AlertDialogFooter, AlertDialogHeader, AlertDialogTitle } from \"@/components/ui/alert-dialog\";\nimport { CreateProductDialog } from \"@/components/Products/CreateProductDialog\";\nimport { EditProductDialog } from \"@/components/Products/EditProductDialog\";\nimport { ProductDetailModal } from \"@/components/Products/ProductDetailModal\";\nimport { DetailedValueReportModal } from \"@/components/Statistics/DetailedValueReportModal\";\nimport { LoadingState } from \"@/components/ui/loading-state\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport { cn } from \"@/lib/utils\";\nimport { ProductCard } from \"@/components/Products/ProductCard\";\nimport { CURRENCY_OPTIONS, CURRENCY_SYMBOLS, DEFAULT_CURRENCY, type Currency } from \"@/utils/currency\";\nimport { convertFromTRY } from \"@/services/exchangeRateService\";\nimport { canCreateResource, canDeleteResource } from \"@/utils/permissions\";\nimport { UserProfile } from \"@/services/firebase/authService\";\nimport { StatCard } from \"@/components/Dashboard/StatCard\";\n\nconst PRODUCT_CATEGORIES = [\n  \"Tanabilir G Paketleri\",\n  \"Kabin Tipi G Paketleri\",\n  \"Ara Tipi G Paketleri\",\n  \"Endstriyel G Paketleri\",\n  \"Gne Enerji Sistemleri\",\n] as const;\n\nconst Products = () => {\n  const { user } = useAuth();\n  const [products, setProducts] = useState<Product[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [createDialogOpen, setCreateDialogOpen] = useState(false);\n  const [editDialogOpen, setEditDialogOpen] = useState(false);\n  const [detailModalOpen, setDetailModalOpen] = useState(false);\n  const [deleteDialogOpen, setDeleteDialogOpen] = useState(false);\n  const [selectedProduct, setSelectedProduct] = useState<Product | null>(null);\n  const [searchTerm, setSearchTerm] = useState(\"\");\n  const [debouncedSearchTerm, setDebouncedSearchTerm] = useState(\"\");\n  const [categoryFilter, setCategoryFilter] = useState<string>(\"all\");\n  const [stockView, setStockView] = useState<\"all\" | \"low\" | \"out\">(\"all\");\n  const [statsModalOpen, setStatsModalOpen] = useState(false);\n  const [activeStatCard, setActiveStatCard] = useState<string | null>(null);\n  const [statsExpanded, setStatsExpanded] = useState(false);\n  const [usersMap, setUsersMap] = useState<Record<string, string>>({});\n  const [selectedCurrency, setSelectedCurrency] = useState<Currency>(() => {\n    const saved = localStorage.getItem(\"productCurrency\");\n    return (saved as Currency) || DEFAULT_CURRENCY;\n  });\n  const [canCreate, setCanCreate] = useState(false);\n  const [canDelete, setCanDelete] = useState(false);\n  const [sortColumn, setSortColumn] = useState<\"name\" | \"category\" | \"stock\" | \"price\">(\"name\");\n  const [sortDirection, setSortDirection] = useState<\"asc\" | \"desc\">(\"asc\");\n  const [columnWidths, setColumnWidths] = useState<Record<string, number>>(() => {\n    const saved = localStorage.getItem('products-column-widths');\n    return saved ? JSON.parse(saved) : {\n      name: 250,\n      category: 180,\n      sku: 120,\n      stock: 100,\n      minStock: 100,\n      price: 120,\n      status: 120,\n      createdBy: 150,\n    };\n  });\n  const [resizingColumn, setResizingColumn] = useState<string | null>(null);\n  const resizeStartX = useRef(0);\n  const resizeStartWidth = useRef(0);\n  const listContainerRef = useRef<HTMLDivElement>(null);\n\n  // Yetki kontrolleri - Firestore'dan kontrol et\n  useEffect(() => {\n    const checkPermissions = async () => {\n      if (!user) {\n        setCanCreate(false);\n        setCanDelete(false);\n        return;\n      }\n      try {\n        const userProfile: UserProfile = {\n          id: user.id,\n          email: user.email,\n          emailVerified: user.emailVerified,\n          fullName: user.fullName,\n          displayName: user.fullName,\n          phone: user.phone,\n          dateOfBirth: user.dateOfBirth,\n          role: user.roles,\n          createdAt: null,\n          updatedAt: null,\n        };\n        const [canCreateProduct, canDeleteProduct] = await Promise.all([\n          canCreateResource(userProfile, \"products\"),\n          canDeleteResource(userProfile, \"products\"),\n        ]);\n        setCanCreate(canCreateProduct);\n        setCanDelete(canDeleteProduct);\n      } catch (error: unknown) {\n        if (import.meta.env.DEV) {\n          console.error(\"Error checking product permissions:\", error);\n        }\n        setCanCreate(false);\n        setCanDelete(false);\n      }\n    };\n    checkPermissions();\n  }, [user]);\n\n  // Kullanclar lazy load et (sadece gerektiinde ykle - performans iin)\n  useEffect(() => {\n    const fetchUsers = async () => {\n      if (Object.keys(usersMap).length > 0) return; // Zaten ykl\n      // Kullanc listesini arka planda ykle (bloklamadan)\n      setTimeout(async () => {\n        try {\n          const usersData = await getAllUsers();\n          const userMap: Record<string, string> = {};\n          usersData.forEach(u => {\n            userMap[u.id] = u.fullName || u.displayName || u.email || \"Bilinmeyen\";\n          });\n          setUsersMap(userMap);\n        } catch (error) {\n          if (import.meta.env.DEV) {\n            console.error(\"Error fetching users:\", error);\n          }\n        }\n      }, 100); // 100ms gecikme ile non-blocking ykleme\n    };\n    fetchUsers();\n  }, [usersMap]);\n\n  // rnleri ykle\n  const fetchProducts = useCallback(async () => {\n    try {\n      setLoading(true);\n      const productsData = await getProducts();\n      setProducts(productsData);\n    } catch (error: unknown) {\n      // Sadece development'ta log gster\n      if (import.meta.env.DEV) {\n        console.error(\"Fetch products error:\", error);\n      }\n      const errorMessage = error instanceof Error ? error.message : String(error);\n      toast.error(errorMessage || \"rnler yklenirken hata olutu\");\n    } finally {\n      setLoading(false);\n    }\n  }, []);\n\n  useEffect(() => {\n    fetchProducts();\n  }, [fetchProducts]);\n\n  // Debounce search term\n  useEffect(() => {\n    const timer = setTimeout(() => {\n      setDebouncedSearchTerm(searchTerm);\n    }, 300);\n    return () => clearTimeout(timer);\n  }, [searchTerm]);\n\n  const handleDelete = useCallback(async () => {\n    if (!selectedProduct) return;\n    \n    // Yetki kontrol\n    if (!canDelete) {\n      toast.error(\"rn silme yetkiniz yok.\");\n      setDeleteDialogOpen(false);\n      return;\n    }\n\n    try {\n      await deleteProduct(selectedProduct.id, user?.id);\n      toast.success(\"rn silindi\");\n      // rnleri state'ten kaldr\n      setProducts(prev => prev.filter(p => p.id !== selectedProduct.id));\n      setDeleteDialogOpen(false);\n      setSelectedProduct(null);\n    } catch (error: unknown) {\n      // Sadece development'ta log gster\n      if (import.meta.env.DEV) {\n        console.error(\"Delete product error:\", error);\n      }\n      const errorMessage = error instanceof Error ? error.message : String(error);\n      toast.error(errorMessage || \"rn silinirken hata olutu\");\n    }\n  }, [selectedProduct, user?.id]);\n\n  const isLowStockProduct = useCallback((product: Product) => {\n    const stock = Number(product.stock) || 0;\n    const minStock = Number(product.minStock ?? 0);\n    return stock > 0 && stock <= minStock;\n  }, []);\n\n  const isOutOfStockProduct = useCallback((product: Product) => {\n    const stock = Number(product.stock) || 0;\n    return stock === 0;\n  }, []);\n\n  const stats = useMemo(() => {\n    const total = products.length;\n    const lowStock = products.filter((p) => isLowStockProduct(p)).length;\n    const outOfStock = products.filter((p) => isOutOfStockProduct(p)).length;\n    const totalValue = products.reduce((sum, p) => {\n      const price = p.price || 0;\n      const stock = p.stock || 0;\n      return sum + (price * stock);\n    }, 0);\n    return { total, lowStock, outOfStock, totalValue };\n  }, [products, isLowStockProduct, isOutOfStockProduct]);\n\n  const handleSort = (column: typeof sortColumn) => {\n    if (sortColumn === column) {\n      setSortDirection(sortDirection === \"asc\" ? \"desc\" : \"asc\");\n    } else {\n      setSortColumn(column);\n      setSortDirection(\"asc\");\n    }\n  };\n\n  const handleResizeStart = (column: string, e: React.MouseEvent) => {\n    e.preventDefault();\n    e.stopPropagation();\n    setResizingColumn(column);\n    resizeStartX.current = e.clientX;\n    resizeStartWidth.current = columnWidths[column] || 100;\n  };\n\n  useEffect(() => {\n    const handleResizeMove = (e: MouseEvent) => {\n      if (!resizingColumn) return;\n      \n      const diff = e.clientX - resizeStartX.current;\n      const newWidth = Math.max(50, resizeStartWidth.current + diff);\n      \n      setColumnWidths(prev => {\n        const updated = { ...prev, [resizingColumn]: newWidth };\n        localStorage.setItem('products-column-widths', JSON.stringify(updated));\n        return updated;\n      });\n    };\n\n    const handleResizeEnd = () => {\n      setResizingColumn(null);\n    };\n\n    if (resizingColumn) {\n      document.addEventListener('mousemove', handleResizeMove);\n      document.addEventListener('mouseup', handleResizeEnd);\n      return () => {\n        document.removeEventListener('mousemove', handleResizeMove);\n        document.removeEventListener('mouseup', handleResizeEnd);\n      };\n    }\n  }, [resizingColumn, columnWidths]);\n\n  const filteredProducts = useMemo(() => {\n    if (!Array.isArray(products)) {\n      return [];\n    }\n    let filtered = products.filter((product) => {\n      const matchesSearch = \n        product.name?.toLocaleLowerCase('tr-TR').includes(debouncedSearchTerm.toLocaleLowerCase('tr-TR')) ||\n        product.sku?.toLocaleLowerCase('tr-TR').includes(debouncedSearchTerm.toLocaleLowerCase('tr-TR')) ||\n        product.category?.toLocaleLowerCase('tr-TR').includes(debouncedSearchTerm.toLocaleLowerCase('tr-TR'));\n      \n      const matchesCategory = categoryFilter === \"all\" || product.category === categoryFilter;\n      const matchesStockView =\n        stockView === \"all\" ||\n        (stockView === \"low\" && isLowStockProduct(product)) ||\n        (stockView === \"out\" && isOutOfStockProduct(product));\n      \n      return matchesSearch && matchesCategory && matchesStockView;\n    });\n\n    // Sralama\n    filtered.sort((a, b) => {\n      let aValue: string | number = \"\";\n      let bValue: string | number = \"\";\n\n      if (sortColumn === \"name\") {\n        aValue = (a.name || \"\").toLowerCase();\n        bValue = (b.name || \"\").toLowerCase();\n      } else if (sortColumn === \"category\") {\n        aValue = (a.category || \"\").toLowerCase();\n        bValue = (b.category || \"\").toLowerCase();\n      } else if (sortColumn === \"stock\") {\n        aValue = Number(a.stock) || 0;\n        bValue = Number(b.stock) || 0;\n      } else if (sortColumn === \"price\") {\n        aValue = Number(a.price) || 0;\n        bValue = Number(b.price) || 0;\n      }\n\n      if (typeof aValue === \"string\" && typeof bValue === \"string\") {\n        return sortDirection === \"asc\" \n          ? aValue.localeCompare(bValue, \"tr-TR\")\n          : bValue.localeCompare(aValue, \"tr-TR\");\n      } else {\n        return sortDirection === \"asc\" \n          ? (aValue as number) - (bValue as number)\n          : (bValue as number) - (aValue as number);\n      }\n    });\n\n    return filtered;\n  }, [products, debouncedSearchTerm, categoryFilter, stockView, isLowStockProduct, isOutOfStockProduct, sortColumn, sortDirection]);\n\n  const formattedTotalValue = useMemo(() => {\n    try {\n      return `${new Intl.NumberFormat(\"tr-TR\", {\n        minimumFractionDigits: 0,\n        maximumFractionDigits: 0,\n      }).format(stats.totalValue || 0)}`;\n    } catch {\n      return `${stats.totalValue?.toFixed?.(0) ?? \"0\"}`;\n    }\n  }, [stats.totalValue]);\n\n  const productStatCards = [\n    {\n      key: \"total-products\",\n      label: \"Toplam rn\",\n      value: stats.total,\n      icon: Package,\n      accent: \"bg-primary/10 text-primary\",\n      description: \"Tm rn kaytlar\",\n      onClick: () => {\n        setStockView(\"all\");\n        setCategoryFilter(\"all\");\n        setSearchTerm(\"\");\n        setActiveStatCard(\"total-products\");\n      },\n      isActive: activeStatCard === \"total-products\",\n    },\n    {\n      key: \"low-stock\",\n      label: \"Dk Stok\",\n      value: stats.lowStock,\n      icon: AlertTriangle,\n      accent: \"bg-amber-100 text-amber-700\",\n      description: \"Kritik stok seviyeleri\",\n      onClick: () => {\n        setStockView(\"low\");\n        setCategoryFilter(\"all\");\n        setActiveStatCard(\"low-stock\");\n      },\n      isActive: activeStatCard === \"low-stock\",\n    },\n    {\n      key: \"out-of-stock\",\n      label: \"Tkenen rnler\",\n      value: stats.outOfStock,\n      icon: Box,\n      accent: \"bg-red-100 text-red-700\",\n      description: \"Stou tamamen bitenler\",\n      onClick: () => {\n        setStockView(\"out\");\n        setCategoryFilter(\"all\");\n        setActiveStatCard(\"out-of-stock\");\n      },\n      isActive: activeStatCard === \"out-of-stock\",\n    },\n    {\n      key: \"total-value\",\n      label: \"Toplam Deer\",\n      value: formattedTotalValue,\n      icon: TrendingUp,\n      accent: \"bg-emerald-100 text-emerald-700\",\n      description: \"Detayl raporlar\",\n      onClick: () => {\n        setActiveStatCard(\"total-value\");\n        setStatsModalOpen(true);\n      },\n      isActive: activeStatCard === \"total-value\",\n    },\n  ];\n\n  if (loading) {\n    return (\n      <MainLayout>\n        <LoadingState message=\"rnler ykleniyor...\" />\n      </MainLayout>\n    );\n  }\n\n  return (\n    <MainLayout>\n      <div className=\"space-y-2 w-full sm:w-[95%] md:w-[90%] lg:max-w-[1400px] mx-auto\">\n        <div className=\"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-1.5 sm:gap-2\">\n          <div className=\"flex-1 min-w-0\">\n            <div className=\"flex items-center justify-between gap-3\">\n              <div>\n                <h1 className=\"text-lg sm:text-xl font-semibold text-foreground\">rnler</h1>\n                <p className=\"text-muted-foreground mt-0.5 text-xs sm:text-sm\">Stok ve rn ynetimi</p>\n              </div>\n              {/* statistikler Alma Butonu */}\n              {!statsExpanded ? (\n                <Button\n                  variant=\"ghost\"\n                  size=\"sm\"\n                  onClick={() => setStatsExpanded(true)}\n                  className=\"h-7 px-2 gap-1 text-[11px] sm:text-xs\"\n                  aria-label=\"statistikleri gster\"\n                >\n                  <ChevronLeft className=\"h-3.5 w-3.5\" />\n                </Button>\n              ) : (\n                <Button\n                  variant=\"ghost\"\n                  size=\"sm\"\n                  onClick={() => setStatsExpanded(false)}\n                  className=\"h-7 px-2 gap-1 text-[11px] sm:text-xs\"\n                  aria-label=\"statistikleri gizle\"\n                >\n                  <ChevronRight className=\"h-3.5 w-3.5\" />\n                </Button>\n              )}\n            </div>\n          </div>\n          {canCreate && (\n          <Button \n            className=\"gap-1 w-full sm:w-auto min-h-[36px] sm:min-h-8 text-[11px] sm:text-xs\" \n            onClick={() => {\n              setCreateDialogOpen(true);\n            }}\n          >\n            <Plus className=\"h-4 w-4\" />\n            <span className=\"hidden sm:inline\">Yeni rn</span>\n            <span className=\"sm:hidden\">Yeni</span>\n          </Button>\n          )}\n        </div>\n\n        {/* statistikler */}\n        {statsExpanded && (\n          <div className=\"grid grid-cols-2 sm:grid-cols-2 lg:grid-cols-4 gap-2 xs:gap-2.5 sm:gap-3\">\n            {productStatCards.map((item) => {\n              const variantMap: Record<string, \"default\" | \"primary\" | \"success\" | \"warning\" | \"info\"> = {\n                \"total-products\": \"primary\",\n                \"low-stock\": \"warning\",\n                \"out-of-stock\": \"default\",\n                \"total-value\": \"info\",\n              };\n              const variant = variantMap[item.key] || \"default\";\n              const value = typeof item.value === 'function' ? item.value() : item.value;\n              \n              return (\n                <StatCard\n                  key={item.key}\n                  title={item.label}\n                  value={value}\n                  icon={item.icon}\n                  variant={variant}\n                  onClick={item.onClick}\n                  clickable\n                />\n              );\n            })}\n          </div>\n        )}\n\n        {/* Filtreler */}\n        <Card>\n          <CardContent className=\"p-2\">\n            <div className=\"flex flex-col sm:flex-row items-stretch sm:items-center gap-2 sm:gap-3 md:gap-4\">\n              {/* Arama Kutusu */}\n              <div className=\"flex-1 min-w-0 w-full sm:w-auto sm:min-w-[200px] md:min-w-[250px]\">\n                <SearchInput\n                  placeholder=\"rn, SKU veya kategori ara...\"\n                  className=\"w-full h-9 sm:h-10 text-[11px] sm:text-xs\"\n                  value={searchTerm}\n                  onChange={(e) => {\n                    setSearchTerm(e.target.value);\n                    if (e.target.value === \"\") {\n                      setActiveStatCard(null);\n                    }\n                  }}\n                />\n              </div>\n              \n              {/* Kategori Filtresi */}\n              <div className=\"w-full sm:w-auto sm:min-w-[160px] md:min-w-[180px]\">\n                <Select value={categoryFilter} onValueChange={(value) => {\n                  setCategoryFilter(value);\n                  setActiveStatCard(null);\n                }}>\n                  <SelectTrigger className=\"w-full h-9 sm:h-10 text-[11px] sm:text-xs\">\n                    <SelectValue placeholder=\"Kategori\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"all\">Tm Kategoriler</SelectItem>\n                    {PRODUCT_CATEGORIES.map((cat) => (\n                      <SelectItem key={cat} value={cat}>\n                        {cat}\n                      </SelectItem>\n                    ))}\n                  </SelectContent>\n                </Select>\n              </div>\n              \n              {/* Para Birimi Seici */}\n              <div className=\"w-full sm:w-auto sm:min-w-[140px] md:min-w-[150px]\">\n                <Select value={selectedCurrency} onValueChange={(value) => {\n                  setSelectedCurrency(value as Currency);\n                  localStorage.setItem(\"productCurrency\", value);\n                }}>\n                  <SelectTrigger className=\"w-full h-9 sm:h-10 text-[11px] sm:text-xs\">\n                    <SelectValue placeholder=\"Para Birimi\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    {CURRENCY_OPTIONS.map((opt) => (\n                      <SelectItem key={opt.value} value={opt.value}>\n                        {opt.label}\n                      </SelectItem>\n                    ))}\n                  </SelectContent>\n                </Select>\n              </div>\n              \n              {/* Filtreleri Temizle */}\n              {(searchTerm || categoryFilter !== \"all\" || stockView !== \"all\") && (\n                <Button\n                  variant=\"outline\"\n                  size=\"sm\"\n                  onClick={() => {\n                    setSearchTerm(\"\");\n                    setCategoryFilter(\"all\");\n                    setStockView(\"all\");\n                    setActiveStatCard(null);\n                  }}\n                  className=\"h-9 sm:h-10 text-[11px] sm:text-xs\"\n                >\n                  <X className=\"h-3.5 w-3.5 sm:h-4 sm:w-4 sm:mr-2\" />\n                  <span className=\"hidden sm:inline\">Temizle</span>\n                </Button>\n              )}\n            </div>\n          </CardContent>\n        </Card>\n\n        {/* Liste Grnm */}\n        {filteredProducts.length === 0 ? (\n          <Card>\n            <CardContent className=\"p-8 sm:p-10 md:p-12\">\n              <div className=\"text-center\">\n                <div className=\"mx-auto w-12 h-12 sm:w-14 sm:h-14 md:w-16 md:h-16 bg-muted/50 rounded-full flex items-center justify-center mb-3 sm:mb-4\">\n                  <Package className=\"h-6 w-6 sm:h-7 sm:w-7 md:h-8 md:w-8 text-muted-foreground\" />\n                </div>\n                <h3 className=\"text-[14px] sm:text-[15px] font-semibold text-foreground mb-1.5 sm:mb-2\">\n                  {searchTerm || categoryFilter !== \"all\"\n                    ? \"Arama sonucu bulunamad\"\n                    : \"Henz rn bulunmuyor\"}\n                </h3>\n                <p className=\"text-[11px] sm:text-xs text-muted-foreground max-w-md mx-auto\">\n                  {searchTerm || categoryFilter !== \"all\"\n                    ? \"Filtreleri deitirerek tekrar deneyin\"\n                    : \"Yeni rn eklemek iin yukardaki butona tklayn\"}\n                </p>\n              </div>\n            </CardContent>\n          </Card>\n        ) : (\n          <div className=\"w-full max-w-full min-w-0\">\n            <div className=\"hidden md:block border border-[#DFE1E6] dark:border-[#38414A] rounded-sm bg-white dark:bg-[#1D2125] w-full\">\n              <div className=\"table border-collapse w-full\" style={{ tableLayout: 'auto', width: '100%' }}>\n                {/* Tablo Balklar */}\n                <div className=\"table-header-group bg-[#F4F5F7] dark:bg-[#22272B]\">\n                  <div className=\"table-row\">\n                    <div \n                      className=\"table-cell px-0 sm:px-0.5 md:px-1 py-1.5 sm:py-2 cursor-pointer hover:text-[#0052CC] dark:hover:text-[#4C9AFF] hover:bg-[#EBECF0] dark:hover:bg-[#2C333A] transition-all duration-200 text-xs font-semibold text-[#42526E] dark:text-[#B6C2CF] uppercase tracking-wide border-r border-[#DFE1E6] dark:border-[#38414A] relative\"\n                      style={{ width: columnWidths.name || 250, minWidth: 200 }}\n                      onClick={() => handleSort(\"name\")}\n                    >\n                      <div className=\"flex items-center gap-1.5\">\n                        rn Ad\n                        {sortColumn === \"name\" && (\n                          sortDirection === \"asc\" ? <ChevronUp className=\"h-4 w-4\" /> : <ChevronDown className=\"h-4 w-4\" />\n                        )}\n                      </div>\n                      <div \n                        className=\"absolute top-0 right-0 w-1 h-full cursor-col-resize hover:bg-[#0052CC] dark:hover:bg-[#4C9AFF] opacity-0 hover:opacity-100 transition-opacity\"\n                        onMouseDown={(e) => handleResizeStart(\"name\", e)}\n                      />\n                    </div>\n                    <div \n                      className=\"table-cell px-0 sm:px-0.5 md:px-1 py-1.5 sm:py-2 cursor-pointer hover:text-[#0052CC] dark:hover:text-[#4C9AFF] hover:bg-[#EBECF0] dark:hover:bg-[#2C333A] transition-all duration-200 text-xs font-semibold text-[#42526E] dark:text-[#B6C2CF] uppercase tracking-wide border-r border-[#DFE1E6] dark:border-[#38414A] relative\"\n                      style={{ width: columnWidths.category || 220, minWidth: 180 }}\n                      onClick={() => handleSort(\"category\")}\n                    >\n                      <div className=\"flex items-center gap-1.5\">\n                        Kategori\n                        {sortColumn === \"category\" && (\n                          sortDirection === \"asc\" ? <ChevronUp className=\"h-4 w-4\" /> : <ChevronDown className=\"h-4 w-4\" />\n                        )}\n                      </div>\n                      <div \n                        className=\"absolute top-0 right-0 w-1 h-full cursor-col-resize hover:bg-[#0052CC] dark:hover:bg-[#4C9AFF] opacity-0 hover:opacity-100 transition-opacity\"\n                        onMouseDown={(e) => handleResizeStart(\"category\", e)}\n                      />\n                    </div>\n                    <div \n                      className=\"table-cell px-0 sm:px-0.5 md:px-1 py-1.5 sm:py-2 text-xs font-semibold text-[#42526E] dark:text-[#B6C2CF] uppercase tracking-wide border-r border-[#DFE1E6] dark:border-[#38414A] relative\"\n                      style={{ width: columnWidths.sku || 140, minWidth: 130 }}\n                    >\n                      SKU\n                      <div \n                        className=\"absolute top-0 right-0 w-1 h-full cursor-col-resize hover:bg-[#0052CC] dark:hover:bg-[#4C9AFF] opacity-0 hover:opacity-100 transition-opacity\"\n                        onMouseDown={(e) => handleResizeStart(\"sku\", e)}\n                      />\n                    </div>\n                    <div \n                      className=\"table-cell px-0 sm:px-0.5 md:px-1 py-1.5 sm:py-2 cursor-pointer hover:text-[#0052CC] dark:hover:text-[#4C9AFF] hover:bg-[#EBECF0] dark:hover:bg-[#2C333A] transition-all duration-200 text-xs font-semibold text-[#42526E] dark:text-[#B6C2CF] uppercase tracking-wide border-r border-[#DFE1E6] dark:border-[#38414A] relative\"\n                      style={{ width: columnWidths.stock || 90, minWidth: 70 }}\n                      onClick={() => handleSort(\"stock\")}\n                    >\n                      <div className=\"flex items-center gap-1.5\">\n                        Stok\n                        {sortColumn === \"stock\" && (\n                          sortDirection === \"asc\" ? <ChevronUp className=\"h-4 w-4\" /> : <ChevronDown className=\"h-4 w-4\" />\n                        )}\n                      </div>\n                      <div \n                        className=\"absolute top-0 right-0 w-1 h-full cursor-col-resize hover:bg-[#0052CC] dark:hover:bg-[#4C9AFF] opacity-0 hover:opacity-100 transition-opacity\"\n                        onMouseDown={(e) => handleResizeStart(\"stock\", e)}\n                      />\n                    </div>\n                    <div \n                      className=\"table-cell px-0 sm:px-0.5 md:px-1 py-1.5 sm:py-2 text-xs font-semibold text-[#42526E] dark:text-[#B6C2CF] uppercase tracking-wide border-r border-[#DFE1E6] dark:border-[#38414A] relative\"\n                      style={{ width: columnWidths.minStock || 90, minWidth: 70 }}\n                    >\n                      Min Stok\n                      <div \n                        className=\"absolute top-0 right-0 w-1 h-full cursor-col-resize hover:bg-[#0052CC] dark:hover:bg-[#4C9AFF] opacity-0 hover:opacity-100 transition-opacity\"\n                        onMouseDown={(e) => handleResizeStart(\"minStock\", e)}\n                      />\n                    </div>\n                    <div \n                      className=\"table-cell px-0 sm:px-0.5 md:px-1 py-1.5 sm:py-2 cursor-pointer hover:text-[#0052CC] dark:hover:text-[#4C9AFF] hover:bg-[#EBECF0] dark:hover:bg-[#2C333A] transition-all duration-200 text-xs font-semibold text-[#42526E] dark:text-[#B6C2CF] uppercase tracking-wide border-r border-[#DFE1E6] dark:border-[#38414A] relative\"\n                      style={{ width: columnWidths.price || 140, minWidth: 120 }}\n                      onClick={() => handleSort(\"price\")}\n                    >\n                      <div className=\"flex items-center gap-1.5\">\n                        Fiyat\n                        {sortColumn === \"price\" && (\n                          sortDirection === \"asc\" ? <ChevronUp className=\"h-4 w-4\" /> : <ChevronDown className=\"h-4 w-4\" />\n                        )}\n                      </div>\n                      <div \n                        className=\"absolute top-0 right-0 w-1 h-full cursor-col-resize hover:bg-[#0052CC] dark:hover:bg-[#4C9AFF] opacity-0 hover:opacity-100 transition-opacity\"\n                        onMouseDown={(e) => handleResizeStart(\"price\", e)}\n                      />\n                    </div>\n                    <div \n                      className=\"table-cell px-0 sm:px-0.5 md:px-1 py-1.5 sm:py-2 text-xs font-semibold text-[#42526E] dark:text-[#B6C2CF] uppercase tracking-wide border-r border-[#DFE1E6] dark:border-[#38414A] relative\"\n                      style={{ width: columnWidths.status || 120, minWidth: 100 }}\n                    >\n                      Durum\n                      <div \n                        className=\"absolute top-0 right-0 w-1 h-full cursor-col-resize hover:bg-[#0052CC] dark:hover:bg-[#4C9AFF] opacity-0 hover:opacity-100 transition-opacity\"\n                        onMouseDown={(e) => handleResizeStart(\"status\", e)}\n                      />\n                    </div>\n                    <div \n                      className=\"table-cell px-0 sm:px-0.5 md:px-1 py-1.5 sm:py-2 text-xs font-semibold text-[#42526E] dark:text-[#B6C2CF] uppercase tracking-wide border-r border-[#DFE1E6] dark:border-[#38414A] relative\"\n                      style={{ width: columnWidths.createdBy || 140, minWidth: 120 }}\n                    >\n                      Oluturan\n                      <div \n                        className=\"absolute top-0 right-0 w-1 h-full cursor-col-resize hover:bg-[#0052CC] dark:hover:bg-[#4C9AFF] opacity-0 hover:opacity-100 transition-opacity\"\n                        onMouseDown={(e) => handleResizeStart(\"createdBy\", e)}\n                      />\n                    </div>\n                    {canDelete && (\n                      <div \n                        className=\"table-cell px-0 sm:px-0.5 md:px-1 py-1.5 sm:py-2 text-xs font-semibold text-[#42526E] dark:text-[#B6C2CF] uppercase tracking-wide border-r border-[#DFE1E6] dark:border-[#38414A] relative\"\n                        style={{ width: 80, minWidth: 80 }}\n                      >\n                        lemler\n                      </div>\n                    )}\n                  </div>\n                </div>\n\n                {/* Tablo erii */}\n                <div \n                  ref={listContainerRef}\n                  style={{ maxHeight: 'calc(100vh - 400px)', overflowY: 'auto', display: 'table-row-group' }}\n                >\n                  {filteredProducts.map((product) => {\n                    const stock = Number(product.stock) || 0;\n                    const minStock = Number(product.minStock ?? 0);\n                    const isOutOfStock = stock === 0;\n                    const isLowStock = stock > 0 && stock <= minStock;\n                    const price = Number(product.price) || 0;\n\n                    return (\n                      <div\n                key={product.id}\n                        className=\"table-row group border-b border-[#DFE1E6] dark:border-[#38414A] hover:bg-[#F4F5F7] dark:hover:bg-[#22272B] transition-all duration-200 cursor-pointer bg-white dark:bg-[#1D2125]\"\n                        onClick={() => {\n                  setSelectedProduct(product);\n                  setDetailModalOpen(true);\n                }}\n                      >\n                        <div className=\"table-cell px-0 sm:px-0.5 md:px-1 py-1 sm:py-1.5 align-middle border-r border-[#DFE1E6] dark:border-[#38414A]\">\n                          <div className=\"flex items-center gap-2\">\n                            <span className=\"font-semibold text-sm text-[#172B4D] dark:text-[#B6C2CF]\">\n                              {product.name}\n                            </span>\n                            {isOutOfStock && (\n                              <Badge variant=\"destructive\" className=\"text-xs px-1.5 py-0.5\">\n                                Tkendi\n                              </Badge>\n                            )}\n                            {isLowStock && !isOutOfStock && (\n                              <Badge variant=\"secondary\" className=\"text-xs px-1.5 py-0.5 bg-amber-500/10 text-amber-700 dark:text-amber-400\">\n                                Dk\n                              </Badge>\n                            )}\n                          </div>\n                        </div>\n                        <div className=\"table-cell px-0 sm:px-0.5 md:px-1 py-1 sm:py-1.5 align-middle border-r border-[#DFE1E6] dark:border-[#38414A]\">\n                          {product.category ? (\n                            <div className=\"flex items-center gap-1.5\">\n                              <Building2 className=\"h-3.5 w-3.5 text-[#42526E] dark:text-[#B6C2CF]\" />\n                              <span className=\"text-xs text-[#42526E] dark:text-[#B6C2CF] truncate\">\n                                {product.category}\n                              </span>\n                            </div>\n                          ) : (\n                            <span className=\"text-xs text-[#6B778C] dark:text-[#8C9CB8]\">-</span>\n                          )}\n                        </div>\n                        <div className=\"table-cell px-0 sm:px-0.5 md:px-1 py-1 sm:py-1.5 align-middle border-r border-[#DFE1E6] dark:border-[#38414A]\">\n                          {product.sku ? (\n                            <span className=\"text-xs font-mono text-[#42526E] dark:text-[#B6C2CF]\">\n                              {product.sku}\n                            </span>\n                          ) : (\n                            <span className=\"text-xs text-[#6B778C] dark:text-[#8C9CB8]\">-</span>\n                          )}\n                        </div>\n                        <div className=\"table-cell px-0 sm:px-0.5 md:px-1 py-1 sm:py-1.5 align-middle border-r border-[#DFE1E6] dark:border-[#38414A]\">\n                          <div className=\"flex items-center gap-1.5\">\n                            <Package className=\"h-3.5 w-3.5 text-[#42526E] dark:text-[#B6C2CF]\" />\n                            <span className=\"text-xs font-medium text-[#42526E] dark:text-[#B6C2CF]\">\n                              {stock}\n                            </span>\n                          </div>\n                        </div>\n                        <div className=\"table-cell px-0 sm:px-0.5 md:px-1 py-1 sm:py-1.5 align-middle border-r border-[#DFE1E6] dark:border-[#38414A]\">\n                          <span className=\"text-xs font-medium text-[#42526E] dark:text-[#B6C2CF]\">\n                            {minStock > 0 ? minStock : \"-\"}\n                          </span>\n                        </div>\n                        <div className=\"table-cell px-0 sm:px-0.5 md:px-1 py-1 sm:py-1.5 align-middle border-r border-[#DFE1E6] dark:border-[#38414A]\">\n                          <span className=\"text-xs font-semibold text-[#42526E] dark:text-[#B6C2CF]\">\n                            {CURRENCY_SYMBOLS[selectedCurrency]}{new Intl.NumberFormat(selectedCurrency === \"TRY\" ? \"tr-TR\" : \"en-US\", { \n                              minimumFractionDigits: 0, \n                              maximumFractionDigits: 0 \n                            }).format(price)}\n                          </span>\n                        </div>\n                        <div className=\"table-cell px-0 sm:px-0.5 md:px-1 py-1 sm:py-1.5 align-middle border-r border-[#DFE1E6] dark:border-[#38414A]\">\n                          <Badge \n                            variant={isOutOfStock ? \"destructive\" : isLowStock ? \"secondary\" : \"default\"}\n                            className={cn(\n                              \"text-xs font-medium\",\n                              isOutOfStock && \"bg-destructive/10 text-destructive border-destructive/20\",\n                              isLowStock && !isOutOfStock && \"bg-amber-500/10 text-amber-700 dark:text-amber-400 border-amber-500/20\",\n                              !isOutOfStock && !isLowStock && \"bg-emerald-500/10 text-emerald-700 dark:text-emerald-400 border-emerald-500/20\"\n                            )}\n                          >\n                            {isOutOfStock ? \"Stokta Yok\" : isLowStock ? \"Stok Dk\" : \"Stokta Var\"}\n                          </Badge>\n                        </div>\n                        <div className=\"table-cell px-0 sm:px-0.5 md:px-1 py-1 sm:py-1.5 align-middle border-r border-[#DFE1E6] dark:border-[#38414A]\">\n                          {product.createdBy ? (\n                            <span className=\"text-xs text-[#42526E] dark:text-[#B6C2CF]\">\n                              {usersMap[product.createdBy] || \"Bilinmeyen\"}\n                            </span>\n                          ) : (\n                            <span className=\"text-xs text-[#6B778C] dark:text-[#8C9CB8]\">-</span>\n                          )}\n                        </div>\n                        {canDelete && (\n                          <div className=\"table-cell px-0 sm:px-0.5 md:px-1 py-1 sm:py-1.5 align-middle border-r border-[#DFE1E6] dark:border-[#38414A]\">\n                            <Button\n                              variant=\"ghost\"\n                              size=\"icon\"\n                              className=\"h-7 w-7 text-destructive hover:text-destructive hover:bg-destructive/10\"\n                              onClick={(e) => {\n                                e.stopPropagation();\n                                setSelectedProduct(product);\n                                setDeleteDialogOpen(true);\n                              }}\n                            >\n                              <Trash2 className=\"h-4 w-4\" />\n                            </Button>\n                          </div>\n                        )}\n                      </div>\n                    );\n                  })}\n                </div>\n              </div>\n            </div>\n\n            {/* Mobil Grnm */}\n            <div className=\"md:hidden space-y-3\">\n              {filteredProducts.map((product) => {\n                const stock = Number(product.stock) || 0;\n                const minStock = Number(product.minStock ?? 0);\n                const isOutOfStock = stock === 0;\n                const isLowStock = stock > 0 && stock <= minStock;\n                const price = Number(product.price) || 0;\n\n                return (\n                  <Card\n                    key={product.id}\n                    className=\"cursor-pointer hover:shadow-lg transition-all\"\n                    onClick={() => {\n                  setSelectedProduct(product);\n                      setDetailModalOpen(true);\n                    }}\n                  >\n                    <CardContent className=\"p-3 sm:p-4 space-y-2\">\n                      <div className=\"flex items-start justify-between\">\n                        <div className=\"flex-1\">\n                          <h3 className=\"font-semibold text-[11px] sm:text-xs\">{product.name}</h3>\n                          {product.category && (\n                            <p className=\"text-[11px] sm:text-xs text-muted-foreground mt-1 flex items-center gap-1\">\n                              <Building2 className=\"h-3 w-3\" />\n                              {product.category}\n                            </p>\n                          )}\n                        </div>\n                        <div className=\"flex items-center gap-2 flex-shrink-0\">\n                          <Badge \n                            variant={isOutOfStock ? \"destructive\" : isLowStock ? \"secondary\" : \"default\"}\n                            className={cn(\n                              isOutOfStock && \"bg-destructive/10 text-destructive\",\n                              isLowStock && !isOutOfStock && \"bg-amber-500/10 text-amber-700 dark:text-amber-400\",\n                              !isOutOfStock && !isLowStock && \"bg-emerald-500/10 text-emerald-700 dark:text-emerald-400\"\n                            )}\n                          >\n                            {isOutOfStock ? \"Tkendi\" : isLowStock ? \"Dk\" : \"Var\"}\n                          </Badge>\n                          {canDelete && (\n                            <Button\n                              variant=\"ghost\"\n                              size=\"icon\"\n                              className=\"h-8 w-8 text-destructive hover:text-destructive hover:bg-destructive/10\"\n                              onClick={(e) => {\n                                e.stopPropagation();\n                                setSelectedProduct(product);\n                                setDeleteDialogOpen(true);\n                              }}\n                            >\n                              <Trash2 className=\"h-4 w-4\" />\n                            </Button>\n                          )}\n                        </div>\n                      </div>\n                      {product.sku && (\n                        <p className=\"text-[11px] sm:text-xs font-mono text-muted-foreground\">SKU: {product.sku}</p>\n                      )}\n                      <div className=\"flex items-center justify-between pt-2 border-t\">\n                        <div className=\"flex items-center gap-1.5\">\n                          <Package className=\"h-3.5 w-3.5 text-muted-foreground\" />\n                          <span className=\"text-[11px] sm:text-xs font-medium\">Stok: {stock}</span>\n                          {minStock > 0 && (\n                            <span className=\"text-[11px] sm:text-xs text-muted-foreground\">(Min: {minStock})</span>\n                          )}\n                        </div>\n                        <span className=\"text-[11px] sm:text-xs font-semibold\">\n                          {CURRENCY_SYMBOLS[selectedCurrency]}{new Intl.NumberFormat(selectedCurrency === \"TRY\" ? \"tr-TR\" : \"en-US\", { \n                            minimumFractionDigits: 0, \n                            maximumFractionDigits: 0 \n                          }).format(price)}\n                        </span>\n                      </div>\n                    </CardContent>\n                  </Card>\n                );\n              })}\n            </div>\n          </div>\n        )}\n      </div>\n\n      <CreateProductDialog\n        open={createDialogOpen}\n        onOpenChange={setCreateDialogOpen}\n        onSuccess={fetchProducts}\n      />\n\n      {selectedProduct && (\n        <>\n          <EditProductDialog\n            open={editDialogOpen}\n            onOpenChange={setEditDialogOpen}\n            onSuccess={fetchProducts}\n            product={selectedProduct}\n          />\n          <ProductDetailModal\n            open={detailModalOpen}\n            onOpenChange={setDetailModalOpen}\n            product={selectedProduct}\n            onUpdate={fetchProducts}\n            onDelete={() => {\n              setDetailModalOpen(false);\n              setDeleteDialogOpen(true);\n            }}\n          />\n        </>\n      )}\n\n      <AlertDialog open={deleteDialogOpen} onOpenChange={setDeleteDialogOpen}>\n        <AlertDialogContent>\n          <AlertDialogHeader>\n            <AlertDialogTitle>rn sil?</AlertDialogTitle>\n            <AlertDialogDescription>\n              Bu ilem geri alnamaz. rn kalc olarak silinecek.\n            </AlertDialogDescription>\n          </AlertDialogHeader>\n          <AlertDialogFooter>\n            <AlertDialogCancel>ptal</AlertDialogCancel>\n            <AlertDialogAction onClick={handleDelete}>Sil</AlertDialogAction>\n          </AlertDialogFooter>\n        </AlertDialogContent>\n      </AlertDialog>\n\n      <DetailedValueReportModal\n        open={statsModalOpen}\n        onOpenChange={setStatsModalOpen}\n        title=\"rn Deer Raporu\"\n        type=\"products\"\n        data={products as unknown as Record<string, unknown>[]}\n      />\n    </MainLayout>\n  );\n};\n\nexport default Products;\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\pages\\Profile.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\pages\\Projects.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'checkPermissions'. Either include it or remove the dependency array.","line":116,"column":6,"nodeType":"ArrayExpression","endLine":116,"endColumn":12,"suggestions":[{"desc":"Update the dependencies array to be: [checkPermissions, user]","fix":{"range":[4848,4854],"text":"[checkPermissions, user]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'checkPermissions'. Either include it or remove the dependency array.","line":126,"column":6,"nodeType":"ArrayExpression","endLine":126,"endColumn":12,"suggestions":[{"desc":"Update the dependencies array to be: [checkPermissions, user]","fix":{"range":[5122,5128],"text":"[checkPermissions, user]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchProjects'. Either include it or remove the dependency array.","line":130,"column":6,"nodeType":"ArrayExpression","endLine":130,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [fetchProjects]","fix":{"range":[5178,5180],"text":"[fetchProjects]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useEffect, useState, useMemo } from \"react\";\nimport { MainLayout } from \"@/components/Layout/MainLayout\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Input } from \"@/components/ui/input\";\nimport { SearchInput } from \"@/components/ui/search-input\";\nimport { Plus, FolderKanban, Loader2, Edit, Trash2, ChevronDown, ChevronUp, X, Save } from \"lucide-react\";\nimport { toast } from \"sonner\";\nimport { getProjects, createProject, updateProject, deleteProject, Project } from \"@/services/firebase/projectService\";\nimport { useAuth } from \"@/contexts/AuthContext\";\nimport { collection, query, where, getDocs } from \"firebase/firestore\";\nimport { db } from \"@/lib/firebase\";\nimport { canCreateProject, canCreateTask, canDeleteProject, canViewPrivateProject, isMainAdmin, canDeleteResource, canEditProject } from \"@/utils/permissions\";\nimport { getDepartments } from \"@/services/firebase/departmentService\";\nimport { onPermissionCacheChange } from \"@/services/firebase/rolePermissionsService\";\nimport { UserProfile } from \"@/services/firebase/authService\";\nimport { AlertDialog, AlertDialogAction, AlertDialogCancel, AlertDialogContent, AlertDialogDescription, AlertDialogFooter, AlertDialogHeader, AlertDialogTitle } from \"@/components/ui/alert-dialog\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogFooter,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\nimport { Label } from \"@/components/ui/label\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { useNavigate, useSearchParams } from \"react-router-dom\";\nimport { TaskInlineForm } from \"@/components/Tasks/TaskInlineForm\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\nimport { Lock } from \"lucide-react\";\nimport { LoadingState } from \"@/components/ui/loading-state\";\n\nconst Projects = () => {\n  const { user } = useAuth();\n  const navigate = useNavigate();\n  const [searchParams, setSearchParams] = useSearchParams();\n  const [projects, setProjects] = useState<Project[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [createDialogOpen, setCreateDialogOpen] = useState(false);\n  const [editDialogOpen, setEditDialogOpen] = useState(false);\n  const [deleteDialogOpen, setDeleteDialogOpen] = useState(false);\n  const [selectedProject, setSelectedProject] = useState<Project | null>(null);\n  const [searchTerm, setSearchTerm] = useState(\"\");\n  const [canCreate, setCanCreate] = useState(false);\n  const [canEdit, setCanEdit] = useState(false);\n  const [canDeleteProjects, setCanDeleteProjects] = useState(false);\n  const [isSuperAdmin, setIsSuperAdmin] = useState(false);\n  const [formData, setFormData] = useState({\n    name: \"\",\n    description: \"\",\n    status: \"active\" as \"active\" | \"completed\" | \"archived\",\n    isPrivate: false,\n  });\n  const [activeProjectForm, setActiveProjectForm] = useState<string | null>(null);\n\n  const checkPermissions = async () => {\n    if (!user) {\n      setCanCreate(false);\n      setCanEdit(false);\n      setCanDeleteProjects(false);\n      setIsSuperAdmin(false);\n      return;\n    }\n    try {\n      const departments = await getDepartments();\n      const { isMainAdmin, canDeleteResource } = await import(\"@/utils/permissions\");\n      const userProfile: UserProfile = {\n        id: user.id,\n        email: user.email,\n        emailVerified: user.emailVerified,\n        fullName: user.fullName,\n        displayName: user.fullName,\n        phone: user.phone,\n        dateOfBirth: user.dateOfBirth,\n        role: user.roles,\n        createdAt: null,\n        updatedAt: null,\n      };\n      // Dummy project for permission check\n      const dummyProject: Project = {\n        id: \"\",\n        name: \"\",\n        description: null,\n        status: \"active\",\n        isPrivate: false,\n        createdBy: user.id,\n        createdAt: null,\n        updatedAt: null,\n      };\n      const [hasCreatePermission, hasEditPermission, hasDeletePermission, isMainAdminUser] = await Promise.all([\n        canCreateProject(userProfile, departments),\n        canEditProject(dummyProject, userProfile),\n        canDeleteResource(userProfile, \"projects\"),\n        isMainAdmin(userProfile),\n      ]);\n      setCanCreate(hasCreatePermission);\n      setCanEdit(hasEditPermission);\n      setCanDeleteProjects(hasDeletePermission);\n      setIsSuperAdmin(isMainAdminUser);\n    } catch (error) {\n      if (import.meta.env.DEV) {\n        console.error(\"Error checking permissions:\", error);\n      }\n      setCanCreate(false);\n      setCanEdit(false);\n      setCanDeleteProjects(false);\n      setIsSuperAdmin(false);\n    }\n  };\n\n  useEffect(() => {\n    checkPermissions();\n  }, [user]);\n\n  // Listen to permission changes in real-time\n  useEffect(() => {\n    if (!user) return;\n    const unsubscribe = onPermissionCacheChange(() => {\n      // Re-check permissions when they change\n      checkPermissions();\n    });\n    return () => unsubscribe();\n  }, [user]);\n\n  useEffect(() => {\n    fetchProjects();\n  }, []);\n\n  const fetchProjects = async () => {\n    try {\n      setLoading(true);\n      const projectsData = await getProjects();\n      \n      // Gizli projeleri filtrele: Sadece st ynetici, ynetici, oluturan ve projede grevi olanlar grebilir\n      // Ekip lideri sadece kendi oluturduu gizli projeleri grebilir\n      const filteredProjects = await Promise.all(\n        projectsData.map(async (project) => {\n          if (!project.isPrivate) return project; // Gizli olmayan projeler herkes grebilir\n          \n          // Gizli projeler iin canViewPrivateProject kontrol\n          if (user) {\n            try {\n              const userProfile: UserProfile = {\n                id: user.id,\n                email: user.email,\n                emailVerified: user.emailVerified,\n                fullName: user.fullName,\n                displayName: user.fullName,\n                phone: user.phone,\n                dateOfBirth: user.dateOfBirth,\n                role: user.roles,\n                createdAt: null,\n                updatedAt: null,\n              };\n              const canView = await canViewPrivateProject(project, userProfile);\n              if (canView) return project;\n              \n              // Projede grevi olan kullanclar grebilir (canViewPrivateProject false dndyse)\n              try {\n                const { getTasks } = await import(\"@/services/firebase/taskService\");\n                const projectTasks = await getTasks({ projectId: project.id });\n                \n                for (const task of projectTasks) {\n                  if (task.createdBy === user.id) return project;\n                  if (task.assignedUsers && task.assignedUsers.includes(user.id)) return project;\n                  const { getTaskAssignments } = await import(\"@/services/firebase/taskService\");\n                  const assignments = await getTaskAssignments(task.id);\n                  const isAssigned = assignments.some(\n                    (a) => a.assignedTo === user.id && (a.status === \"accepted\" || a.status === \"pending\")\n                  );\n                  if (isAssigned) return project;\n                }\n              } catch (error: unknown) {\n                if (import.meta.env.DEV) {\n                  console.error(\"Error checking project tasks:\", error);\n                }\n              }\n            } catch (error: unknown) {\n              if (import.meta.env.DEV) {\n                console.error(\"Error checking private project visibility:\", error);\n              }\n            }\n          }\n          \n          return null; // Dier kullanclar gizli projeleri gremez\n        })\n      );\n      \n      // Otomatik oluturulan \"Gizli Grevler\" projesini listeden kaldr\n      // Sadece kullancnn manuel oluturduu gizli projeler gsterilmeli\n      const finalProjects = filteredProjects.filter((p): p is typeof projectsData[0] => {\n        if (p === null) return false;\n        // Otomatik oluturulan \"Gizli Grevler\" projesini filtrele\n        if (p.name === \"Gizli Grevler\" && p.isPrivate === true && \n            p.description === \"Projesi olmayan gizli grevler iin otomatik oluturulan proje\") {\n          return false;\n        }\n        return true;\n      });\n      \n      setProjects(finalProjects);\n    } catch (error: unknown) {\n      if (import.meta.env.DEV) {\n        console.error(\"Fetch projects error:\", error);\n      }\n      const errorMessage = error instanceof Error ? error.message : \"Projeler yklenirken hata olutu\";\n      toast.error(errorMessage);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleCreate = async () => {\n    if (!formData.name.trim()) {\n      toast.error(\"Proje ad gereklidir\");\n      return;\n    }\n\n    if (!user?.id) {\n      toast.error(\"Kullanc bilgisi bulunamad\");\n      return;\n    }\n\n    try {\n      await createProject({\n        name: formData.name.trim(),\n        description: formData.description.trim() || null,\n        status: formData.status,\n        isPrivate: formData.isPrivate || false,\n        createdBy: user.id,\n      });\n      toast.success(\"Proje oluturuldu\");\n      setCreateDialogOpen(false);\n      setFormData({ name: \"\", description: \"\", status: \"active\", isPrivate: false });\n      await fetchProjects();\n      \n      // Eer returnTo parametresi varsa, o sayfaya geri dn\n      const returnTo = searchParams.get(\"returnTo\");\n      if (returnTo) {\n        setSearchParams({});\n        navigate(returnTo);\n      }\n    } catch (error: unknown) {\n      if (import.meta.env.DEV) {\n        console.error(\"Create project error:\", error);\n      }\n      const errorMessage = error instanceof Error ? error.message : \"Proje oluturulurken hata olutu\";\n      toast.error(errorMessage);\n    }\n  };\n\n  const handleEdit = async () => {\n    if (!selectedProject || !formData.name.trim()) {\n      toast.error(\"Proje ad gereklidir\");\n      return;\n    }\n\n    if (!user?.id) {\n      toast.error(\"Kullanc bilgisi bulunamad\");\n      return;\n    }\n\n    try {\n      await updateProject(selectedProject.id, {\n        name: formData.name.trim(),\n        description: formData.description.trim() || null,\n        status: formData.status,\n      }, user.id);\n      toast.success(\"Proje gncellendi\");\n      setEditDialogOpen(false);\n      setSelectedProject(null);\n      setFormData({ name: \"\", description: \"\", status: \"active\", isPrivate: false });\n      fetchProjects();\n    } catch (error: unknown) {\n      if (import.meta.env.DEV) {\n        console.error(\"Update project error:\", error);\n      }\n      const errorMessage = error instanceof Error ? error.message : \"Proje gncellenirken hata olutu\";\n      toast.error(errorMessage);\n    }\n  };\n\n  const handleDelete = async () => {\n    if (!selectedProject) return;\n\n    if (!user?.id) {\n      toast.error(\"Kullanc bilgisi bulunamad\");\n      return;\n    }\n\n    try {\n      await deleteProject(selectedProject.id, user.id);\n      toast.success(\"Proje silindi\");\n      fetchProjects();\n      setDeleteDialogOpen(false);\n      setSelectedProject(null);\n    } catch (error: unknown) {\n      if (import.meta.env.DEV) {\n        console.error(\"Delete project error:\", error);\n      }\n      const errorMessage = error instanceof Error ? error.message : \"Proje silinirken hata olutu\";\n      toast.error(errorMessage);\n    }\n  };\n\n  const openEditDialog = (project: Project) => {\n    setSelectedProject(project);\n    setFormData({\n      name: project.name,\n      description: project.description || \"\",\n      status: project.status,\n      isPrivate: project.isPrivate || false,\n    });\n    setEditDialogOpen(true);\n  };\n\n  const openDeleteDialog = (project: Project) => {\n    setSelectedProject(project);\n    setDeleteDialogOpen(true);\n  };\n\n  const getStatusBadge = (status: string) => {\n    switch (status) {\n      case \"active\":\n        return <Badge variant=\"default\">Aktif</Badge>;\n      case \"completed\":\n        return <Badge variant=\"secondary\">Tamamland</Badge>;\n      case \"archived\":\n        return <Badge variant=\"outline\">Arivlendi</Badge>;\n      default:\n        return <Badge>{status}</Badge>;\n    }\n  };\n\n  const filteredProjects = projects.filter((project) => {\n    const searchLower = searchTerm.toLocaleLowerCase('tr-TR');\n    const projectName = project.name?.toLocaleLowerCase('tr-TR') || \"\";\n    const projectDesc = project.description?.toLocaleLowerCase('tr-TR') || \"\";\n    \n    return projectName.includes(searchLower) || projectDesc.includes(searchLower);\n  });\n\n  // Proje istatistikleri\n  const projectStats = useMemo(() => {\n    const total = projects.length;\n    const active = projects.filter((p) => p.status === \"active\").length;\n    const completed = projects.filter((p) => p.status === \"completed\").length;\n    const archived = projects.filter((p) => p.status === \"archived\").length;\n    const privateProjects = projects.filter((p) => p.isPrivate === true).length;\n    return { total, active, completed, archived, privateProjects };\n  }, [projects]);\n\n  if (loading) {\n    return (\n      <MainLayout>\n        <LoadingState message=\"Projeler ykleniyor...\" />\n      </MainLayout>\n    );\n  }\n\n  return (\n    <MainLayout>\n      <div className=\"space-y-2 w-full sm:w-[95%] md:w-[90%] lg:max-w-[1400px] mx-auto overflow-hidden\">\n        <div className=\"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-1.5 sm:gap-2\">\n          <div className=\"flex-1 min-w-0\">\n            <h1 className=\"text-[16px] sm:text-[18px] font-semibold text-foreground\">Projeler</h1>\n            <p className=\"text-[11px] sm:text-xs text-muted-foreground mt-0.5 sm:mt-1\">\n              Projelerinizi ynetin ve grevlerinizi takip edin\n            </p>\n          </div>\n          {canCreate && (\n            <Button className=\"gap-1 w-full sm:w-auto min-h-[36px] sm:min-h-8 text-[11px] sm:text-xs\" onClick={() => {\n              setFormData({ name: \"\", description: \"\", status: \"active\", isPrivate: false });\n              setCreateDialogOpen(true);\n            }}>\n              <Plus className=\"h-4 w-4\" />\n              <span className=\"hidden sm:inline\">Yeni Proje</span>\n              <span className=\"sm:hidden\">Yeni</span>\n            </Button>\n          )}\n        </div>\n\n        {/* Proje statistikleri */}\n        <div className=\"grid gap-1.5 sm:gap-2 grid-cols-2 sm:grid-cols-3 lg:grid-cols-5\">\n          {[\n            { \n              label: \"Toplam Proje\", \n              value: projectStats.total, \n              sub: \"Tm projeler\", \n              badgeClass: \"text-primary\",\n            },\n            { \n              label: \"Aktif\", \n              value: projectStats.active, \n              sub: \"Devam eden projeler\", \n              badgeClass: \"text-emerald-600\",\n            },\n            { \n              label: \"Tamamlanan\", \n              value: projectStats.completed, \n              sub: \"Kapatlan projeler\", \n              badgeClass: \"text-blue-600\",\n            },\n            { \n              label: \"Arivlenmi\", \n              value: projectStats.archived, \n              sub: \"Arivdeki projeler\", \n              badgeClass: \"text-muted-foreground\",\n            },\n            { \n              label: \"Gizli\", \n              value: projectStats.privateProjects, \n              sub: \"Gizli projeler\", \n              badgeClass: \"text-amber-600\",\n            },\n          ].map((stat) => (\n            <Card \n              key={stat.label} \n              className=\"cursor-pointer hover:shadow-md transition-all duration-200 hover:border-primary/50\"\n            >\n              <CardContent className=\"p-3 sm:p-4\">\n                <p className=\"text-[11px] sm:text-xs text-muted-foreground mb-2 truncate\">{stat.label}</p>\n                <div className=\"text-lg sm:text-xl font-semibold mb-1\">{stat.value}</div>\n                <p className={`text-[11px] sm:text-xs font-medium ${stat.badgeClass} line-clamp-1`}>{stat.sub}</p>\n              </CardContent>\n            </Card>\n          ))}\n        </div>\n\n        {/* Filtreler */}\n        <Card>\n          <CardContent className=\"p-3 sm:p-4 md:p-5\">\n            <div className=\"flex flex-wrap items-center gap-2 sm:gap-3\">\n              <SearchInput\n                placeholder=\"Proje ara...\"\n                value={searchTerm}\n                onChange={(e) => setSearchTerm(e.target.value)}\n                containerClassName=\"flex-1 min-w-0 w-full sm:w-auto sm:min-w-[200px] md:min-w-[250px]\"\n                className=\"h-9 sm:h-10 text-[11px] sm:text-xs\"\n              />\n            </div>\n          </CardContent>\n        </Card>\n\n        {/* Proje Listesi */}\n        <Card>\n          <CardContent className=\"p-3 sm:p-4 md:p-5 overflow-hidden\">\n            <div className=\"space-y-2 sm:space-y-3 w-full max-w-full\">\n              {filteredProjects.length === 0 ? (\n                <div className=\"text-center py-6 sm:py-8 text-[11px] sm:text-xs text-muted-foreground\">\n                  {searchTerm ? \"Arama sonucu bulunamad\" : \"Henz proje yok\"}\n                </div>\n              ) : (\n                filteredProjects.map((project) => {\n                  // Silme yetkisi kontrol: Sadece yneticiler silebilir (projeyi oluturan kii bile silemez)\n                  const canDelete = isSuperAdmin || canDeleteProjects;\n                  \n                  return (\n                  <div\n                    key={project.id}\n                    className=\"flex flex-col gap-2 sm:gap-3 p-3 sm:p-4 rounded-lg border border-border hover:bg-muted/50 transition-colors w-full max-w-full overflow-hidden\"\n                  >\n                    <div className=\"flex flex-col gap-3 sm:flex-row sm:items-start sm:justify-between w-full max-w-full\">\n                      <div\n                        className=\"flex-1 cursor-pointer min-w-0\"\n                        onClick={() => navigate(`/projects/${project.id}/tasks`)}\n                      >\n                        <div className=\"flex items-center gap-2 mb-1 flex-wrap\">\n                          <FolderKanban className=\"h-5 w-5 text-primary flex-shrink-0\" />\n                          <h3 className=\"font-semibold text-foreground truncate\">{project.name}</h3>\n                          {getStatusBadge(project.status)}\n                          {project.isPrivate && (\n                            <Badge variant=\"outline\" className=\"gap-1 flex-shrink-0\">\n                              <Lock className=\"h-3 w-3\" />\n                              <span className=\"hidden sm:inline\">Gizli</span>\n                            </Badge>\n                          )}\n                        </div>\n                        {project.description && (\n                          <p className=\"text-[11px] sm:text-xs text-muted-foreground line-clamp-2 break-words\">{project.description}</p>\n                        )}\n                        <p className=\"text-[11px] sm:text-xs text-muted-foreground mt-2\">\n                          Oluturulma: {project.createdAt?.toDate?.().toLocaleDateString(\"tr-TR\")}\n                        </p>\n                      </div>\n                      <div className=\"flex flex-wrap items-center gap-2 flex-shrink-0\">\n                        {canCreate && (\n                          <Button\n                            variant=\"outline\"\n                            size=\"sm\"\n                            onClick={async (e) => {\n                              e.stopPropagation();\n                              // Double-check permission before opening form\n                              if (!user) return;\n                              try {\n                                const departments = await getDepartments();\n                                const userProfile: UserProfile = {\n                                  id: user.id,\n                                  email: user.email,\n                                  emailVerified: user.emailVerified,\n                                  fullName: user.fullName,\n                                  displayName: user.fullName,\n                                  phone: user.phone,\n                                  dateOfBirth: user.dateOfBirth,\n                                  role: user.roles,\n                                  createdAt: null,\n                                  updatedAt: null,\n                                };\n                                // SISTEM_YETKILERI.md'ye gre: Sadece Super Admin ve Team Leader grev oluturabilir\n                                const hasTaskPermission = await canCreateTask(userProfile, departments);\n                                if (!hasTaskPermission) {\n                                  toast.error(\"Grev ekleme yetkiniz yok. Sadece ynetici veya ekip lideri grev oluturabilir.\");\n                                  return;\n                                }\n                                setActiveProjectForm((prev) =>\n                                  prev === project.id ? null : project.id\n                                );\n                              } catch (error: unknown) {\n                                if (import.meta.env.DEV) {\n                                  console.error(\"Permission check error:\", error);\n                                }\n                                toast.error(\"Yetki kontrol yaplamad\");\n                              }\n                            }}\n                          >\n                            {activeProjectForm === project.id ? (\n                              <>\n                                <ChevronUp className=\"h-4 w-4 mr-1\" />\n                                Formu Kapat\n                              </>\n                            ) : (\n                              <>\n                                <Plus className=\"h-4 w-4 mr-1\" />\n                                Grev Ekle\n                              </>\n                            )}\n                          </Button>\n                        )}\n                        {(canEdit || project.createdBy === user?.id) && (\n                          <Button\n                            variant=\"ghost\"\n                            size=\"sm\"\n                            onClick={(e) => {\n                              e.stopPropagation();\n                              openEditDialog(project);\n                            }}\n                          >\n                            <Edit className=\"h-4 w-4\" />\n                          </Button>\n                        )}\n                      </div>\n                    </div>\n                    {activeProjectForm === project.id && (\n                      <Dialog open={true} onOpenChange={() => setActiveProjectForm(null)}>\n                        <DialogContent className=\"!max-w-[100vw] sm:!max-w-[85vw] !w-[100vw] sm:!w-[85vw] !h-[100vh] sm:!h-[80vh] !max-h-[100vh] sm:!max-h-[80vh] !left-0 sm:!left-[7.5vw] !top-0 sm:!top-[10vh] !right-0 sm:!right-auto !bottom-0 sm:!bottom-auto !translate-x-0 !translate-y-0 overflow-hidden !p-0 gap-0 bg-white flex flex-col !m-0 !rounded-none sm:!rounded-lg !border-0 sm:!border\">\n                          {/* DialogTitle ve DialogDescription DialogContent'in direkt child' olmal (Radix UI gereksinimi) */}\n                          <DialogTitle className=\"sr-only\">\n                            Yeni Grev\n                          </DialogTitle>\n                          <DialogDescription className=\"sr-only\">\n                            Proje iin yeni grev oluturun\n                          </DialogDescription>\n                          \n                          <div className=\"flex flex-col h-full min-h-0\">\n                            <DialogHeader className=\"p-3 sm:p-4 border-b bg-white flex-shrink-0 relative pr-12 sm:pr-16\">\n                              <h2 className=\"text-[14px] sm:text-[15px] font-semibold text-foreground\">Yeni Grev</h2>\n                            </DialogHeader>\n                            <div className=\"flex-1 overflow-hidden bg-gray-50/50 p-3 sm:p-4 min-h-0\">\n                              <div className=\"max-w-full mx-auto h-full overflow-y-auto\">\n                                <TaskInlineForm\n                                  mode=\"create\"\n                                  projectId={project.id}\n                                  defaultStatus=\"pending\"\n                                  onCancel={() => setActiveProjectForm(null)}\n                                  onSuccess={async (taskId) => {\n                                    setActiveProjectForm(null);\n                                    // Firestore'da grevin kaydedilmesi iin ksa bir gecikme\n                                    // Tm projeler sayfasnda yeni grevin grnmesi iin bekle\n                                    await new Promise(resolve => setTimeout(resolve, 1500));\n                                    if (taskId) {\n                                      navigate(`/projects/${project.id}/tasks?highlight=${taskId}`);\n                                    } else {\n                                      fetchProjects();\n                                    }\n                                  }}\n                                  className=\"border-0 shadow-none p-0\"\n                                />\n                              </div>\n                            </div>\n                          </div>\n                        </DialogContent>\n                      </Dialog>\n                    )}\n                  </div>\n                  );\n                })\n              )}\n            </div>\n          </CardContent>\n        </Card>\n\n        {/* Create Dialog */}\n        <Dialog open={createDialogOpen} onOpenChange={setCreateDialogOpen}>\n          <DialogContent className=\"!max-w-[100vw] sm:!max-w-[85vw] !w-[100vw] sm:!w-[85vw] !h-[100vh] sm:!h-[80vh] !max-h-[100vh] sm:!max-h-[80vh] !left-0 sm:!left-[7.5vw] !top-0 sm:!top-[10vh] !right-0 sm:!right-auto !bottom-0 sm:!bottom-auto !translate-x-0 !translate-y-0 overflow-hidden !p-0 gap-0 bg-white flex flex-col !m-0 !rounded-none sm:!rounded-lg !border-0 sm:!border\">\n            {/* DialogTitle ve DialogDescription DialogContent'in direkt child' olmal (Radix UI gereksinimi) */}\n            <DialogTitle className=\"sr-only\">\n              Yeni Proje\n            </DialogTitle>\n            <DialogDescription className=\"sr-only\">\n              Yeni proje oluturun\n            </DialogDescription>\n            \n            <div className=\"flex flex-col h-full min-h-0\">\n              {/* Header */}\n              <DialogHeader className=\"p-3 sm:p-4 border-b bg-white flex-shrink-0 relative pr-12 sm:pr-16\">\n                <div className=\"flex items-center justify-between gap-3\">\n                  <div className=\"flex items-center gap-2 sm:gap-3 flex-1 min-w-0\">\n                    <div className=\"h-8 w-8 sm:h-10 sm:w-10 rounded-lg bg-primary/10 flex items-center justify-center border border-primary/20 flex-shrink-0\">\n                      <FolderKanban className=\"h-4 w-4 sm:h-5 sm:w-5 text-primary\" />\n                    </div>\n                    <h2 className=\"text-[14px] sm:text-[15px] font-semibold text-foreground truncate\">\n                      Yeni Proje\n                    </h2>\n                  </div>\n                  <div className=\"flex flex-wrap gap-2 flex-shrink-0\">\n                    <Button\n                      variant=\"outline\"\n                      size=\"sm\"\n                      className=\"border-primary/20 hover:bg-primary/5 rounded-lg px-3 py-1.5 font-medium text-[11px] sm:text-xs flex-shrink-0\"\n                      onClick={() => setCreateDialogOpen(false)}\n                    >\n                      <X className=\"h-3 w-3 sm:h-4 sm:w-4 mr-1.5 flex-shrink-0\" />\n                      ptal\n                    </Button>\n                    <Button\n                      variant=\"default\"\n                      size=\"sm\"\n                      className=\"bg-primary hover:bg-primary/90 rounded-lg px-3 py-1.5 font-medium text-[11px] sm:text-xs flex-shrink-0 text-white\"\n                      onClick={handleCreate}\n                    >\n                      <Save className=\"h-3 w-3 sm:h-4 sm:w-4 mr-1.5 flex-shrink-0\" />\n                      Olutur\n                    </Button>\n                  </div>\n                </div>\n              </DialogHeader>\n            \n              {/* Content */}\n              <div className=\"flex-1 overflow-hidden bg-gray-50/50 p-3 sm:p-4 min-h-0\">\n                <div className=\"max-w-full mx-auto h-full overflow-y-auto\">\n                  <Card>\n                    <CardHeader>\n                      <CardTitle className=\"text-[14px] sm:text-[15px]\">Proje Bilgileri</CardTitle>\n                    </CardHeader>\n                    <CardContent className=\"space-y-4\">\n                      <div className=\"space-y-2\">\n                        <Label htmlFor=\"create-name\" className=\"text-[11px] sm:text-xs\" showRequired>\n                          Proje Ad\n                        </Label>\n                        <Input\n                          id=\"create-name\"\n                          value={formData.name}\n                          onChange={(e) => setFormData({ ...formData, name: e.target.value })}\n                          placeholder=\"Proje ad\"\n                          className=\"min-h-[44px] sm:min-h-0\"\n                          required\n                        />\n                      </div>\n                      <div className=\"space-y-2\">\n                        <Label htmlFor=\"create-description\" className=\"text-[11px] sm:text-xs\">Aklama</Label>\n                        <Textarea\n                          id=\"create-description\"\n                          value={formData.description}\n                          onChange={(e) => setFormData({ ...formData, description: e.target.value })}\n                          placeholder=\"Proje aklamas\"\n                          rows={4}\n                          className=\"min-h-[100px] sm:min-h-[120px]\"\n                        />\n                      </div>\n                      <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-4\">\n                        <div className=\"space-y-2\">\n                          <Label htmlFor=\"create-status\" className=\"text-[11px] sm:text-xs\">Durum</Label>\n                          <Select\n                            value={formData.status}\n                            onValueChange={(value: \"active\" | \"completed\" | \"archived\") =>\n                              setFormData({ ...formData, status: value })\n                            }\n                          >\n                            <SelectTrigger id=\"create-status\" className=\"min-h-[44px] sm:min-h-0\">\n                              <SelectValue />\n                            </SelectTrigger>\n                            <SelectContent>\n                              <SelectItem value=\"active\">Aktif</SelectItem>\n                              <SelectItem value=\"completed\">Tamamland</SelectItem>\n                              <SelectItem value=\"archived\">Arivlendi</SelectItem>\n                            </SelectContent>\n                          </Select>\n                        </div>\n                        <div className=\"flex items-center space-x-2 pt-8\">\n                          <Checkbox\n                            id=\"create-private\"\n                            checked={formData.isPrivate}\n                            onCheckedChange={(checked) => setFormData({ ...formData, isPrivate: checked as boolean })}\n                          />\n                          <Label\n                            htmlFor=\"create-private\"\n                            className=\"text-[11px] sm:text-xs font-normal cursor-pointer text-muted-foreground flex items-center gap-1\"\n                          >\n                            <Lock className=\"h-3 w-3\" />\n                            Gizli Proje\n                          </Label>\n                        </div>\n                      </div>\n                      <div className=\"text-[11px] sm:text-xs text-muted-foreground\">\n                        Gizli projeler sadece oluturan ve yneticiler tarafndan grlebilir.\n                      </div>\n                    </CardContent>\n                  </Card>\n                </div>\n              </div>\n            </div>\n          </DialogContent>\n        </Dialog>\n\n        {/* Edit Dialog */}\n        <Dialog open={editDialogOpen} onOpenChange={setEditDialogOpen}>\n          <DialogContent className=\"!max-w-[100vw] sm:!max-w-[85vw] !w-[100vw] sm:!w-[85vw] !h-[100vh] sm:!h-[80vh] !max-h-[100vh] sm:!max-h-[80vh] !left-0 sm:!left-[7.5vw] !top-0 sm:!top-[10vh] !right-0 sm:!right-auto !bottom-0 sm:!bottom-auto !translate-x-0 !translate-y-0 overflow-hidden !p-0 gap-0 bg-white flex flex-col !m-0 !rounded-none sm:!rounded-lg !border-0 sm:!border\">\n            {/* DialogTitle ve DialogDescription DialogContent'in direkt child' olmal (Radix UI gereksinimi) */}\n            <DialogTitle className=\"sr-only\">\n              Proje Dzenle\n            </DialogTitle>\n            <DialogDescription className=\"sr-only\">\n              Proje bilgilerini dzenleyin\n            </DialogDescription>\n            \n            <div className=\"flex flex-col h-full min-h-0\">\n              {/* Header */}\n              <DialogHeader className=\"p-3 sm:p-4 border-b bg-white flex-shrink-0 relative pr-12 sm:pr-16\">\n                <div className=\"flex items-center justify-between gap-3\">\n                  <div className=\"flex items-center gap-2 sm:gap-3 flex-1 min-w-0\">\n                    <div className=\"h-8 w-8 sm:h-10 sm:w-10 rounded-lg bg-primary/10 flex items-center justify-center border border-primary/20 flex-shrink-0\">\n                      <FolderKanban className=\"h-4 w-4 sm:h-5 sm:w-5 text-primary\" />\n                    </div>\n                    <h2 className=\"text-[14px] sm:text-[15px] font-semibold text-foreground truncate\">\n                      Proje Dzenle\n                    </h2>\n                  </div>\n                  <div className=\"flex flex-wrap gap-2 flex-shrink-0\">\n                    <Button\n                      variant=\"outline\"\n                      size=\"sm\"\n                      className=\"border-primary/20 hover:bg-primary/5 rounded-lg px-3 py-1.5 font-medium text-[11px] sm:text-xs flex-shrink-0\"\n                      onClick={() => setEditDialogOpen(false)}\n                    >\n                      <X className=\"h-3 w-3 sm:h-4 sm:w-4 mr-1.5 flex-shrink-0\" />\n                      ptal\n                    </Button>\n                    <Button\n                      variant=\"default\"\n                      size=\"sm\"\n                      className=\"bg-primary hover:bg-primary/90 rounded-lg px-3 py-1.5 font-medium text-[11px] sm:text-xs flex-shrink-0 text-white\"\n                      onClick={handleEdit}\n                    >\n                      <Save className=\"h-3 w-3 sm:h-4 sm:w-4 mr-1.5 flex-shrink-0\" />\n                      Kaydet\n                    </Button>\n                  </div>\n                </div>\n              </DialogHeader>\n            \n              {/* Content */}\n              <div className=\"flex-1 overflow-hidden bg-gray-50/50 p-3 sm:p-4 min-h-0\">\n                <div className=\"max-w-full mx-auto h-full overflow-y-auto\">\n                  <Card>\n                    <CardHeader>\n                      <CardTitle className=\"text-[14px] sm:text-[15px]\">Proje Bilgileri</CardTitle>\n                    </CardHeader>\n                    <CardContent className=\"space-y-4\">\n                      <div className=\"space-y-2\">\n                        <Label htmlFor=\"edit-name\" className=\"text-[11px] sm:text-xs\" showRequired>\n                          Proje Ad\n                        </Label>\n                        <Input\n                          id=\"edit-name\"\n                          value={formData.name}\n                          onChange={(e) => setFormData({ ...formData, name: e.target.value })}\n                          placeholder=\"Proje ad\"\n                          className=\"min-h-[44px] sm:min-h-0\"\n                          required\n                        />\n                      </div>\n                      <div className=\"space-y-2\">\n                        <Label htmlFor=\"edit-description\" className=\"text-[11px] sm:text-xs\">Aklama</Label>\n                        <Textarea\n                          id=\"edit-description\"\n                          value={formData.description}\n                          onChange={(e) => setFormData({ ...formData, description: e.target.value })}\n                          placeholder=\"Proje aklamas\"\n                          rows={4}\n                          className=\"min-h-[100px] sm:min-h-[120px]\"\n                        />\n                      </div>\n                      <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-4\">\n                        <div className=\"space-y-2\">\n                          <Label htmlFor=\"edit-status\" className=\"text-[11px] sm:text-xs\">Durum</Label>\n                          <Select\n                            value={formData.status}\n                            onValueChange={(value: \"active\" | \"completed\" | \"archived\") =>\n                              setFormData({ ...formData, status: value })\n                            }\n                          >\n                            <SelectTrigger id=\"edit-status\" className=\"min-h-[44px] sm:min-h-0\">\n                              <SelectValue />\n                            </SelectTrigger>\n                            <SelectContent>\n                              <SelectItem value=\"active\">Aktif</SelectItem>\n                              <SelectItem value=\"completed\">Tamamland</SelectItem>\n                              <SelectItem value=\"archived\">Arivlendi</SelectItem>\n                            </SelectContent>\n                          </Select>\n                        </div>\n                        <div className=\"flex items-center space-x-2 pt-8\">\n                          <Checkbox\n                            id=\"edit-private\"\n                            checked={formData.isPrivate}\n                            onCheckedChange={(checked) => setFormData({ ...formData, isPrivate: checked as boolean })}\n                          />\n                          <Label\n                            htmlFor=\"edit-private\"\n                            className=\"text-[11px] sm:text-xs font-normal cursor-pointer text-muted-foreground flex items-center gap-1\"\n                          >\n                            <Lock className=\"h-3 w-3\" />\n                            Gizli Proje\n                          </Label>\n                        </div>\n                      </div>\n                      <div className=\"text-[11px] sm:text-xs text-muted-foreground\">\n                        Gizli projeler sadece oluturan ve yneticiler tarafndan grlebilir.\n                      </div>\n                    </CardContent>\n                  </Card>\n                </div>\n              </div>\n            </div>\n          </DialogContent>\n        </Dialog>\n\n        {/* Delete Dialog */}\n        <AlertDialog open={deleteDialogOpen} onOpenChange={setDeleteDialogOpen}>\n          <AlertDialogContent>\n            <AlertDialogHeader>\n              <AlertDialogTitle>Projeyi Sil</AlertDialogTitle>\n              <AlertDialogDescription>\n                {selectedProject && (\n                  <>\n                    <strong>{selectedProject.name}</strong> projesini silmek istediinizden emin misiniz?\n                    Bu ilem geri alnamaz.\n                  </>\n                )}\n              </AlertDialogDescription>\n            </AlertDialogHeader>\n            <AlertDialogFooter>\n              <AlertDialogCancel>ptal</AlertDialogCancel>\n              <AlertDialogAction onClick={handleDelete} className=\"bg-destructive text-destructive-foreground\">\n                Sil\n              </AlertDialogAction>\n            </AlertDialogFooter>\n          </AlertDialogContent>\n        </AlertDialog>\n      </div>\n    </MainLayout>\n  );\n};\n\nexport default Projects;\n\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\pages\\RawMaterials.tsx","messages":[{"ruleId":"prefer-const","severity":2,"message":"'timeoutId' is never reassigned. Use 'const' instead.","line":385,"column":5,"nodeType":"Identifier","messageId":"useConst","endLine":385,"endColumn":14}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect, useMemo, useRef, useCallback } from \"react\";\nimport { useNavigate } from \"react-router-dom\";\nimport { useAuth } from \"@/contexts/AuthContext\";\nimport { MainLayout } from \"@/components/Layout/MainLayout\";\nimport { useSidebarContext } from \"@/contexts/SidebarContext\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { SearchInput } from \"@/components/ui/search-input\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Progress } from \"@/components/ui/progress\";\nimport { \n  Plus, Package, AlertTriangle, Edit, Trash2, X, User, \n  TrendingDown, TrendingUp, AlertCircle, Filter, BarChart3, Loader2,\n  ChevronRight, ChevronLeft\n} from \"lucide-react\";\nimport { toast } from \"sonner\";\nimport { getRawMaterials, deleteRawMaterial, RawMaterial } from \"@/services/firebase/materialService\";\nimport { getAllUsers, UserProfile } from \"@/services/firebase/authService\";\nimport { canCreateResource, canDeleteResource } from \"@/utils/permissions\";\nimport { CreateRawMaterialDialog } from \"@/components/RawMaterials/CreateRawMaterialDialog\";\nimport { EditRawMaterialDialog } from \"@/components/RawMaterials/EditRawMaterialDialog\";\nimport { RawMaterialDetailModal } from \"@/components/RawMaterials/RawMaterialDetailModal\";\nimport { DetailedValueReportModal } from \"@/components/Statistics/DetailedValueReportModal\";\nimport { LoadingState } from \"@/components/ui/loading-state\";\nimport { cn } from \"@/lib/utils\";\nimport { Tooltip, TooltipContent, TooltipProvider, TooltipTrigger } from \"@/components/ui/tooltip\";\nimport { ResponsiveTable, ResponsiveTableColumn } from \"@/components/shared/ResponsiveTable\";\nimport { StatCard } from \"@/components/Dashboard/StatCard\";\nimport {\n  AlertDialog,\n  AlertDialogAction,\n  AlertDialogCancel,\n  AlertDialogContent,\n  AlertDialogDescription,\n  AlertDialogFooter,\n  AlertDialogHeader,\n  AlertDialogTitle,\n} from \"@/components/ui/alert-dialog\";\n\nconst RawMaterials = () => {\n  const { user } = useAuth();\n  const navigate = useNavigate();\n  const sidebarContext = useSidebarContext();\n  const tableRef = useRef<HTMLDivElement>(null);\n  const [materials, setMaterials] = useState<RawMaterial[]>([]);\n  const [searchQuery, setSearchQuery] = useState(\"\");\n  const [stockView, setStockView] = useState<\"all\" | \"normal\" | \"low\" | \"out\">(\"all\");\n  const [createDialogOpen, setCreateDialogOpen] = useState(false);\n  const [editDialogOpen, setEditDialogOpen] = useState(false);\n  const [detailModalOpen, setDetailModalOpen] = useState(false);\n  const [selectedMaterial, setSelectedMaterial] = useState<RawMaterial | null>(null);\n  const [loading, setLoading] = useState(false); // Balangta false - placeholder data ile hzl render\n  const [page, setPage] = useState(1);\n  const [limit] = useState(50);\n  const [deleteDialogOpen, setDeleteDialogOpen] = useState(false);\n  const [materialToDelete, setMaterialToDelete] = useState<RawMaterial | null>(null);\n  const [statsModalOpen, setStatsModalOpen] = useState(false);\n  const [activeStatCard, setActiveStatCard] = useState<string | null>(null);\n  const [statsExpanded, setStatsExpanded] = useState(false);\n  const [users, setUsers] = useState<UserProfile[]>([]);\n  const [canCreate, setCanCreate] = useState(false);\n  const [canDelete, setCanDelete] = useState(false);\n\n  // Yetki kontrolleri - Firestore'dan kontrol et\n  useEffect(() => {\n    const checkPermissions = async () => {\n      if (!user) {\n        setCanCreate(false);\n        setCanDelete(false);\n        return;\n      }\n      try {\n        const userProfile: UserProfile = {\n          id: user.id,\n          email: user.email,\n          emailVerified: user.emailVerified,\n          fullName: user.fullName,\n          displayName: user.fullName,\n          phone: null,\n          dateOfBirth: null,\n          role: user.roles || [],\n          createdAt: null,\n          updatedAt: null,\n        };\n        const [canCreateMaterial, canDeleteMaterial] = await Promise.all([\n          canCreateResource(userProfile, \"raw_materials\"),\n          canDeleteResource(userProfile, \"raw_materials\"),\n        ]);\n        setCanCreate(canCreateMaterial);\n        setCanDelete(canDeleteMaterial);\n      } catch (error: unknown) {\n        if (import.meta.env.DEV) {\n          console.error(\"Error checking raw material permissions:\", error);\n        }\n        setCanCreate(false);\n        setCanDelete(false);\n      }\n    };\n    checkPermissions();\n  }, [user]);\n\n  // Kullanclar lazy load et (sadece gerektiinde ykle - performans iin)\n  useEffect(() => {\n    const fetchUsers = async () => {\n      if (users.length > 0) return; // Zaten ykl\n      // Kullanc listesini arka planda ykle (bloklamadan)\n      setTimeout(async () => {\n        try {\n          const allUsers = await getAllUsers();\n          setUsers(allUsers);\n        } catch (error) {\n          console.error(\"Error fetching users:\", error);\n        }\n      }, 50); // 50ms gecikme ile non-blocking ykleme (daha hzl)\n    };\n    fetchUsers();\n  }, [users.length]);\n\n  // Materyalleri ykle\n  const fetchMaterials = useCallback(async () => {\n    // Defer materials loading: lk render'dan 100ms sonra ykle (non-blocking)\n    setLoading(true);\n    await new Promise(resolve => setTimeout(resolve, 100));\n    \n    try {\n      const materialsData = await getRawMaterials();\n      // Kullanc adlarn ekle\n      const materialsWithUserNames = materialsData.map((material) => {\n        if (!material.createdBy) {\n          return {\n            ...material,\n            created_by_name: \"-\",\n          };\n        }\n        const creator = users.find((u) => u.id === material.createdBy);\n        return {\n          ...material,\n          created_by_name: creator\n            ? creator.fullName || creator.displayName || creator.email || \"-\"\n            : \"-\",\n        };\n      });\n      setMaterials(materialsWithUserNames);\n    } catch (error: unknown) {\n      if (import.meta.env.DEV) {\n        console.error(\"Fetch materials error:\", error);\n      }\n      const errorMessage = error instanceof Error ? error.message : String(error);\n      toast.error(errorMessage || \"Hammaddeler yklenirken hata olutu\");\n      setMaterials([]);\n    } finally {\n      setLoading(false);\n    }\n  }, [users]);\n\n  useEffect(() => {\n    // Materyalleri ykle (kullanclar yklenmesini beklemeden)\n    // Kullanc adlar sonra eklenecek\n    fetchMaterials();\n  }, [fetchMaterials]);\n\n  const getCategoryLabel = (category: string) => {\n    const labels: Record<string, string> = {\n      chemical: \"Kimyasal\",\n      metal: \"Metal\",\n      plastic: \"Plastik\",\n      electronic: \"Elektronik\",\n      packaging: \"Ambalaj\",\n      other: \"Dier\"\n    };\n    return labels[category] || category;\n  };\n\n  const getStockStatus = (stock: number, min_stock: number) => {\n    const stockNum = Number(stock) || 0;\n    const minStockNum = Number(min_stock) || 0;\n    \n    if (isNaN(stockNum) || isNaN(minStockNum)) {\n      return { label: \"Bilinmiyor\", variant: \"outline\" as const, color: \"text-gray-600\", bgColor: \"bg-gray-50\" };\n    }\n    \n    if (stockNum === 0) return { label: \"Tkendi\", variant: \"destructive\" as const, color: \"text-red-600\", bgColor: \"bg-red-50\" };\n    if (stockNum < minStockNum) return { label: \"Dk\", variant: \"secondary\" as const, color: \"text-yellow-600\", bgColor: \"bg-yellow-50\" };\n    return { label: \"Normal\", variant: \"default\" as const, color: \"text-green-600\", bgColor: \"bg-green-50\" };\n  };\n\n  const getStockFlags = (stock: number, minStock: number) => {\n    const stockNum = Number(stock) || 0;\n    const minStockNum = Number(minStock) || 0;\n    const isOut = stockNum === 0;\n    const isLow = stockNum > 0 && stockNum < minStockNum;\n    const isNormal = !isOut && !isLow;\n    return { isOut, isLow, isNormal };\n  };\n\n  const filteredMaterials = useMemo(() => {\n    if (!Array.isArray(materials)) {\n      return [];\n    }\n    return materials.filter(m => {\n      const stock = Number(m.currentStock !== undefined ? m.currentStock : m.stock) || 0;\n      const minStock = Number(m.minStock !== undefined ? m.minStock : m.min_stock) || 0;\n      const { isLow, isOut, isNormal } = getStockFlags(stock, minStock);\n      \n      if (stockView === \"low\" && !isLow) return false;\n      if (stockView === \"out\" && !isOut) return false;\n      if (stockView === \"normal\" && !isNormal) return false;\n      if (searchQuery) {\n        const query = searchQuery.toLowerCase();\n        const nameMatch = m.name?.toLowerCase().includes(query) || false;\n        const skuMatch = (m.sku || m.code)?.toLowerCase().includes(query) || false;\n        if (!nameMatch && !skuMatch) {\n          return false;\n        }\n      }\n      return true;\n    });\n  }, [materials, searchQuery, stockView]);\n\n  // statistikler - her zaman tm materials zerinden hesaplanr (filtreleme etkilemez)\n  const stats = useMemo(() => {\n    if (!Array.isArray(materials)) {\n      return { total: 0, lowStock: 0, outOfStock: 0, normalStock: 0, totalValue: 0 };\n    }\n    const total = materials.length;\n    const lowStock = materials.filter(m => {\n      const stock = Number(m.currentStock !== undefined ? m.currentStock : m.stock) || 0;\n      const minStock = Number(m.minStock !== undefined ? m.minStock : m.min_stock) || 0;\n      return !isNaN(stock) && !isNaN(minStock) && stock < minStock && stock > 0;\n    }).length;\n    const outOfStock = materials.filter(m => {\n      const stock = Number(m.currentStock !== undefined ? m.currentStock : m.stock) || 0;\n      return !isNaN(stock) && stock === 0;\n    }).length;\n    const normalStock = total - lowStock - outOfStock;\n    const totalValue = materials.reduce((sum, m) => {\n      const stock = Number(m.currentStock !== undefined ? m.currentStock : m.stock) || 0;\n      const cost = Number(m.unitPrice !== undefined ? m.unitPrice : m.cost) || 0;\n      const value = stock * cost;\n      return sum + (isNaN(value) ? 0 : value);\n    }, 0);\n    \n    return { total, lowStock, outOfStock, normalStock, totalValue };\n  }, [materials]);\n\n  const formattedMaterialValue = useMemo(() => {\n    try {\n      return `${new Intl.NumberFormat(\"tr-TR\", {\n        minimumFractionDigits: 0,\n        maximumFractionDigits: 0,\n      }).format(stats.totalValue || 0)}`;\n    } catch {\n      return `${stats.totalValue?.toFixed?.(0) ?? \"0\"}`;\n    }\n  }, [stats.totalValue]);\n\n  const rawMaterialStatCards = [\n    {\n      key: \"total-materials\",\n      label: \"Toplam Hammadde\",\n      value: stats.total,\n      accent: \"bg-blue-100 text-blue-700\",\n      icon: Package,\n      description: \"Tm kaytlar\",\n      onClick: () => {\n        setStockView(\"all\");\n        setSearchQuery(\"\");\n        setActiveStatCard(\"total-materials\");\n      },\n      isActive: activeStatCard === \"total-materials\",\n    },\n    {\n      key: \"normal-stock\",\n      label: \"Normal Stok\",\n      value: stats.normalStock,\n      accent: \"bg-green-100 text-green-700\",\n      icon: TrendingUp,\n      description: \"Stok seviyesi yeterli\",\n      onClick: () => {\n        setStockView(\"normal\");\n        setActiveStatCard(\"normal-stock\");\n      },\n      isActive: activeStatCard === \"normal-stock\",\n    },\n    {\n      key: \"low-stock\",\n      label: \"Dk Stok\",\n      value: stats.lowStock,\n      accent: \"bg-yellow-100 text-yellow-700\",\n      icon: AlertTriangle,\n      description: \"Min seviyenin altnda\",\n      onClick: () => {\n        setStockView(\"low\");\n        setActiveStatCard(\"low-stock\");\n      },\n      isActive: activeStatCard === \"low-stock\",\n    },\n    {\n      key: \"out-stock\",\n      label: \"Tkenen\",\n      value: stats.outOfStock,\n      accent: \"bg-red-100 text-red-700\",\n      icon: AlertCircle,\n      description: \"Stou sfrlananlar\",\n      onClick: () => {\n        setStockView(\"out\");\n        setActiveStatCard(\"out-stock\");\n      },\n      isActive: activeStatCard === \"out-stock\",\n    },\n    {\n      key: \"total-value\",\n      label: \"Toplam Deer\",\n      value: formattedMaterialValue,\n      accent: \"bg-purple-100 text-purple-700\",\n      icon: BarChart3,\n      description: \"Detayl raporlar\",\n      onClick: () => {\n        setActiveStatCard(\"total-value\");\n        setStatsModalOpen(true);\n      },\n      isActive: activeStatCard === \"total-value\",\n    },\n  ];\n\n  const totalPages = Math.ceil(filteredMaterials.length / limit);\n  const paginatedMaterials = filteredMaterials.slice((page - 1) * limit, page * limit);\n\n  const handleDeleteClick = (material: RawMaterial) => {\n    setMaterialToDelete(material);\n    setDeleteDialogOpen(true);\n  };\n\n  const handleDelete = async () => {\n    if (!materialToDelete) return;\n    \n    // Yetki kontrol\n    if (!canDelete) {\n      toast.error(\"Hammadde silme yetkiniz yok.\");\n      setDeleteDialogOpen(false);\n      return;\n    }\n    \n    try {\n      await deleteRawMaterial(materialToDelete.id);\n      toast.success(\"Hammadde silindi\");\n      fetchMaterials();\n      setDeleteDialogOpen(false);\n      setMaterialToDelete(null);\n    } catch (error: unknown) {\n      if (import.meta.env.DEV) {\n        console.error(\"Delete material error:\", error);\n      }\n      toast.error(error instanceof Error ? error.message : \"Hammadde silinirken hata olutu\");\n    }\n  };\n\n  useEffect(() => {\n    setPage(1);\n  }, [searchQuery, stockView]);\n\n  // erik smyorsa sidebar' otomatik kapat\n  useEffect(() => {\n    if (!sidebarContext || loading) return;\n    \n    let timeoutId: NodeJS.Timeout;\n    let resizeTimeoutId: NodeJS.Timeout;\n    let resizeObserver: ResizeObserver | null = null;\n    \n    const checkOverflow = () => {\n      if (!tableRef.current || typeof window === \"undefined\") return;\n      \n      // ResponsiveTable kullanld iin container geniliini kontrol et\n      const containerWidth = tableRef.current.clientWidth;\n      const scrollWidth = tableRef.current.scrollWidth;\n      \n      // Eer ierik genilii container geniliinden bykse sidebar' kapat\n      if (scrollWidth > containerWidth + 10) { // 10px tolerans\n        sidebarContext.closeSidebar();\n      }\n    };\n\n    // lk yklemede kontrol et\n    timeoutId = setTimeout(checkOverflow, 300);\n    \n    // ResizeObserver ile container deiikliklerini izle\n    if (typeof ResizeObserver !== \"undefined\" && tableRef.current) {\n      resizeObserver = new ResizeObserver(() => {\n        clearTimeout(resizeTimeoutId);\n        resizeTimeoutId = setTimeout(checkOverflow, 150);\n      });\n      resizeObserver.observe(tableRef.current);\n    }\n    \n    // Window resize event'i\n    const handleResize = () => {\n      clearTimeout(resizeTimeoutId);\n      resizeTimeoutId = setTimeout(checkOverflow, 150);\n    };\n    \n    window.addEventListener('resize', handleResize);\n    \n    return () => {\n      clearTimeout(timeoutId);\n      clearTimeout(resizeTimeoutId);\n      window.removeEventListener('resize', handleResize);\n      if (resizeObserver) {\n        resizeObserver.disconnect();\n      }\n    };\n  }, [paginatedMaterials, sidebarContext, loading]);\n\n  const getStockPercentage = (stock: number, min_stock: number, max_stock?: number) => {\n    const stockNum = Number(stock) || 0;\n    const minStockNum = Number(min_stock) || 0;\n    const maxStockNum = max_stock ? (Number(max_stock) || 0) : undefined;\n    \n    if (isNaN(stockNum) || isNaN(minStockNum)) return 0;\n    \n    if (maxStockNum && !isNaN(maxStockNum) && maxStockNum > 0) {\n      const percentage = (stockNum / maxStockNum) * 100;\n      return isNaN(percentage) ? 0 : Math.min(100, Math.max(0, percentage));\n    }\n    if (minStockNum > 0) {\n      const percentage = (stockNum / (minStockNum * 2)) * 100;\n      return isNaN(percentage) ? 0 : Math.min(100, Math.max(0, percentage));\n    }\n    return stockNum > 0 ? 50 : 0;\n  };\n\n  return (\n    <MainLayout>\n      <div className=\"space-y-2 w-full sm:w-[95%] md:w-[90%] lg:max-w-[1400px] mx-auto\">\n        <div className=\"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-1.5 sm:gap-2\">\n          <div className=\"flex-1 min-w-0\">\n            <div className=\"flex items-center justify-between gap-3\">\n              <div>\n                <h1 className=\"text-lg sm:text-xl font-semibold text-foreground break-words\">Hammadde Ynetimi</h1>\n                <p className=\"text-xs sm:text-sm text-muted-foreground mt-0.5 sm:mt-1\">Hammadde stoklarn ynetin ve takip edin</p>\n              </div>\n              {/* statistikler Alma Butonu */}\n              {!statsExpanded ? (\n                <Button\n                  variant=\"ghost\"\n                  size=\"sm\"\n                  onClick={() => setStatsExpanded(true)}\n                  className=\"h-7 px-2 gap-1 text-xs sm:text-sm\"\n                  aria-label=\"statistikleri gster\"\n                >\n                  <ChevronLeft className=\"h-3.5 w-3.5\" />\n                </Button>\n              ) : (\n                <Button\n                  variant=\"ghost\"\n                  size=\"sm\"\n                  onClick={() => setStatsExpanded(false)}\n                  className=\"h-7 px-2 gap-1 text-xs sm:text-sm\"\n                  aria-label=\"statistikleri gizle\"\n                >\n                  <ChevronRight className=\"h-3.5 w-3.5\" />\n                </Button>\n              )}\n            </div>\n          </div>\n          {canCreate && (\n            <Button \n              className=\"gap-1 w-full sm:w-auto min-h-[36px] sm:min-h-8 text-xs sm:text-sm\" \n              onClick={() => {\n                setCreateDialogOpen(true);\n              }}\n            >\n              <Plus className=\"h-4 w-4\" />\n              <span className=\"hidden sm:inline\">Yeni Hammadde</span>\n              <span className=\"sm:hidden\">Yeni</span>\n            </Button>\n          )}\n        </div>\n\n        {/* statistikler */}\n        {statsExpanded && (\n          <div className=\"grid grid-cols-2 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-2 xs:gap-2.5 sm:gap-2.5 md:gap-3\">\n            {rawMaterialStatCards.map((item) => {\n              const variantMap: Record<string, \"default\" | \"primary\" | \"success\" | \"warning\" | \"info\"> = {\n                \"total-materials\": \"primary\",\n                \"normal-stock\": \"success\",\n                \"low-stock\": \"warning\",\n                \"out-stock\": \"default\",\n                \"total-value\": \"info\",\n              };\n              const variant = variantMap[item.key] || \"default\";\n              const value = typeof item.value === 'function' ? item.value() : item.value;\n              \n              return (\n                <StatCard\n                  key={item.key}\n                  title={item.label}\n                  value={value}\n                  icon={item.icon}\n                  variant={variant}\n                  onClick={item.onClick}\n                  clickable\n                />\n              );\n            })}\n          </div>\n        )}\n\n        {/* Filtreler */}\n        <Card>\n          <CardContent className=\"p-1.5\">\n            <div className=\"flex flex-col sm:flex-row items-stretch sm:items-center gap-1.5 sm:gap-2\">\n              {/* Arama Kutusu */}\n              <div className=\"flex-1 min-w-0 w-full sm:w-auto sm:min-w-[200px] md:min-w-[250px]\">\n                <SearchInput\n                  placeholder=\"Ara (isim, stok kodu)...\"\n                  className=\"w-full h-9 sm:h-10 text-xs sm:text-sm\"\n                  value={searchQuery}\n                  onChange={(e) => setSearchQuery(e.target.value)}\n                />\n              </div>\n              \n              {/* Filtreleri Temizle */}\n              {(searchQuery || stockView !== \"all\") && (\n                <Button\n                  variant=\"outline\"\n                  size=\"sm\"\n                  onClick={() => {\n                    setSearchQuery(\"\");\n                    setStockView(\"all\");\n                    setActiveStatCard(null);\n                  }}\n                  className=\"h-9 sm:h-10 text-xs sm:text-sm\"\n                >\n                  <X className=\"h-3.5 w-3.5 sm:h-4 sm:w-4 sm:mr-2\" />\n                  <span className=\"hidden sm:inline\">Temizle</span>\n                </Button>\n              )}\n            </div>\n          </CardContent>\n        </Card>\n\n        {/* Tablo */}\n        <Card className=\"overflow-hidden\">\n          <CardContent className=\"p-0 overflow-hidden\">\n            {loading ? (\n              <LoadingState message=\"Hammaddeler ykleniyor...\" />\n            ) : paginatedMaterials.length === 0 ? (\n              <div className=\"text-center py-12 bg-muted/30 rounded-lg border border-dashed\">\n                <div className=\"flex flex-col items-center gap-3\">\n                  <div className=\"rounded-full bg-muted p-4\">\n                    <Package className=\"h-12 w-12 text-muted-foreground/50\" />\n                  </div>\n                  <p className=\"text-xs sm:text-sm text-muted-foreground font-medium\">\n                    {searchQuery || stockView !== \"all\"\n                      ? \"Arama sonucu bulunamad\"\n                      : \"Henz hammadde bulunmuyor\"}\n                  </p>\n                  <p className=\"text-xs sm:text-sm text-muted-foreground/70 max-w-md\">\n                    {searchQuery || stockView !== \"all\"\n                      ? \"Filtreleri deitirerek tekrar deneyin\"\n                      : \"Yeni hammadde eklemek iin yukardaki butona tklayn\"}\n                  </p>\n                </div>\n              </div>\n            ) : (\n              <>\n                <div ref={tableRef} className=\"w-full\">\n                  <ResponsiveTable\n                    data={paginatedMaterials}\n                    columns={[\n                      {\n                        key: \"name\",\n                        header: \"Malzeme Ad\",\n                        accessor: (material) => (\n                              <div className=\"flex items-center justify-start gap-1.5 min-w-0 w-full\">\n                                <Package className=\"h-3.5 w-3.5 text-muted-foreground flex-shrink-0\" />\n                                <TooltipProvider>\n                                  <Tooltip>\n                                    <TooltipTrigger asChild>\n                                      <span className=\"truncate text-xs font-semibold\" title={material.name}>\n                                        {material.name}\n                                      </span>\n                                    </TooltipTrigger>\n                                    <TooltipContent>\n                                      <p>{material.name}</p>\n                                    </TooltipContent>\n                                  </Tooltip>\n                                </TooltipProvider>\n                              </div>\n                        ),\n                        priority: \"high\",\n                        sticky: true,\n                        minWidth: 200,\n                        headerClassName: \"text-left\",\n                        cellClassName: \"text-left\",\n                      },\n                      {\n                        key: \"description\",\n                        header: \"Aklamalar\",\n                        accessor: (material) => (\n                              <TooltipProvider>\n                                <Tooltip>\n                                  <TooltipTrigger asChild>\n                                    <p className=\"text-xs text-muted-foreground line-clamp-2 truncate text-left w-full\" title={material.description || material.notes || \"-\"}>\n                                      {material.description || material.notes || \"-\"}\n                                    </p>\n                                  </TooltipTrigger>\n                                  {(material.description || material.notes) && (\n                                    <TooltipContent className=\"max-w-xs\">\n                                      <p>{material.description || material.notes}</p>\n                                    </TooltipContent>\n                                  )}\n                                </Tooltip>\n                              </TooltipProvider>\n                        ),\n                        priority: \"medium\",\n                        minWidth: 200,\n                        headerClassName: \"text-left\",\n                        cellClassName: \"text-left\",\n                      },\n                      {\n                        key: \"stock\",\n                        header: \"Mevcut\",\n                        accessor: (material) => {\n                          const currentStock = Number(material.currentStock !== undefined ? material.currentStock : material.stock) || 0;\n                          const minStock = Number(material.minStock !== undefined ? material.minStock : material.min_stock) || 0;\n                          const stockStatus = getStockStatus(currentStock, minStock);\n                          return (\n                              <div className=\"flex items-center justify-start gap-1.5 w-full\">\n                              <span className={cn(stockStatus.color, \"text-xs font-semibold whitespace-nowrap\")}>\n                                  {currentStock} {material.unit}\n                                </span>\n                                <Badge\n                                  variant={stockStatus.variant}\n                                  className={cn(\n                                    \"font-medium text-xs px-1.5 py-0.5 flex-shrink-0\",\n                                    stockStatus.variant === \"destructive\" && \"bg-red-500 hover:bg-red-600 text-white\",\n                                    stockStatus.variant === \"secondary\" && \"bg-yellow-500 hover:bg-yellow-600 text-white\",\n                                    stockStatus.variant === \"default\" && \"bg-green-500 hover:bg-green-600 text-white\"\n                                  )}\n                                >\n                                  {stockStatus.label}\n                                </Badge>\n                              </div>\n                          );\n                        },\n                        priority: \"high\",\n                        minWidth: 200,\n                        headerClassName: \"text-left\",\n                        cellClassName: \"text-left\",\n                      },\n                      {\n                        key: \"createdBy\",\n                        header: \"Oluturan\",\n                        accessor: (material) => (\n                          material.createdBy ? (\n                                <div className=\"flex items-center justify-start gap-1 w-full\">\n                                  <User className=\"h-3 w-3 text-muted-foreground flex-shrink-0\" />\n                                  <span className=\"text-xs text-muted-foreground truncate\">\n                                    {users.find(u => u.id === material.createdBy)?.fullName || \n                                     users.find(u => u.id === material.createdBy)?.displayName || \n                                     users.find(u => u.id === material.createdBy)?.email || \n                                     \"Bilinmeyen\"}\n                                  </span>\n                                </div>\n                              ) : (\n                                <span className=\"text-xs text-muted-foreground\">-</span>\n                          )\n                        ),\n                        priority: \"low\",\n                        minWidth: 200,\n                        headerClassName: \"text-left\",\n                        cellClassName: \"text-left\",\n                      },\n                      {\n                        key: \"actions\",\n                        header: \"lemler\",\n                        headerClassName: \"text-left\",\n                        cellClassName: \"text-left\",\n                        accessor: (material) => (\n                          <div className=\"flex items-center justify-start gap-1 w-full\" onClick={(e) => e.stopPropagation()}>\n                                <TooltipProvider>\n                                  <Tooltip>\n                                    <TooltipTrigger asChild>\n                                      <Button\n                                        variant=\"outline\"\n                                        size=\"sm\"\n                                        className=\"h-7 w-7 sm:h-8 sm:w-8 p-0\"\n                                        onClick={(e) => {\n                                          e.stopPropagation();\n                                          setSelectedMaterial(material);\n                                          setEditDialogOpen(true);\n                                        }}\n                                      >\n                                        <Edit className=\"h-3.5 w-3.5\" />\n                                      </Button>\n                                    </TooltipTrigger>\n                                    <TooltipContent>\n                                      <p>Dzenle</p>\n                                    </TooltipContent>\n                                  </Tooltip>\n                                </TooltipProvider>\n                            {canDelete && (\n                                <TooltipProvider>\n                                  <Tooltip>\n                                    <TooltipTrigger asChild>\n                                        <Button\n                                          variant=\"outline\"\n                                          size=\"sm\"\n                                          className=\"h-7 w-7 sm:h-8 sm:w-8 p-0 text-destructive hover:text-destructive hover:bg-destructive/10\"\n                                          onClick={(e) => {\n                                            e.stopPropagation();\n                                            handleDeleteClick(material);\n                                          }}\n                                        >\n                                          <Trash2 className=\"h-3.5 w-3.5\" />\n                                        </Button>\n                                    </TooltipTrigger>\n                                    <TooltipContent>\n                                      <p>Sil</p>\n                                    </TooltipContent>\n                                  </Tooltip>\n                                </TooltipProvider>\n                            )}\n                              </div>\n                        ),\n                        priority: \"high\",\n                        minWidth: 200,\n                      },\n                    ]}\n                    emptyMessage=\"Kayt bulunamad\"\n                    onRowClick={(material) => {\n                      setSelectedMaterial(material);\n                      setDetailModalOpen(true);\n                    }}\n                    renderCard={(material) => {\n                      const currentStock = Number(material.currentStock !== undefined ? material.currentStock : material.stock) || 0;\n                      const minStock = Number(material.minStock !== undefined ? material.minStock : material.min_stock) || 0;\n                      const stockStatus = getStockStatus(currentStock, minStock);\n                      return (\n                        <Card \n                          className={cn(\n                            \"cursor-pointer hover:shadow-lg transition-all\",\n                            stockStatus.bgColor\n                          )}\n                          onClick={() => {\n                            setSelectedMaterial(material);\n                            setDetailModalOpen(true);\n                          }}\n                        >\n                          <CardContent className=\"p-3 sm:p-4 space-y-2\">\n                            <div className=\"flex items-start justify-between\">\n                              <div className=\"flex-1 min-w-0\">\n                                <div className=\"flex items-center gap-1.5 mb-1\">\n                                  <Package className=\"h-3.5 w-3.5 text-muted-foreground flex-shrink-0\" />\n                                  <h3 className=\"font-semibold text-xs sm:text-sm truncate\">{material.name}</h3>\n                                </div>\n                                {(material.description || material.notes) && (\n                                  <p className=\"text-xs sm:text-sm text-muted-foreground line-clamp-2\">\n                                    {material.description || material.notes}\n                                  </p>\n                                )}\n                              </div>\n                              <Badge\n                                variant={stockStatus.variant}\n                                className={cn(\n                                  \"font-medium text-xs px-1.5 py-0.5 flex-shrink-0\",\n                                  stockStatus.variant === \"destructive\" && \"bg-red-500 hover:bg-red-600 text-white\",\n                                  stockStatus.variant === \"secondary\" && \"bg-yellow-500 hover:bg-yellow-600 text-white\",\n                                  stockStatus.variant === \"default\" && \"bg-green-500 hover:bg-green-600 text-white\"\n                                )}\n                              >\n                                {stockStatus.label}\n                              </Badge>\n                            </div>\n                            <div className=\"flex flex-col gap-1.5 pt-2 border-t\">\n                              <div className=\"flex items-center justify-between text-xs sm:text-sm\">\n                                <span className=\"text-muted-foreground\">Mevcut Stok:</span>\n                                <span className={cn(\"font-semibold\", stockStatus.color)}>\n                                  {currentStock} {material.unit}\n                                </span>\n                              </div>\n                              {material.createdBy && (\n                                <div className=\"flex items-center justify-between text-xs sm:text-sm\">\n                                  <span className=\"text-muted-foreground\">Oluturan:</span>\n                                  <span className=\"truncate ml-2\">\n                                    {users.find(u => u.id === material.createdBy)?.fullName || \n                                     users.find(u => u.id === material.createdBy)?.displayName || \n                                     users.find(u => u.id === material.createdBy)?.email || \n                                     \"Bilinmeyen\"}\n                                  </span>\n                                </div>\n                              )}\n                              <div className=\"flex justify-end gap-1 pt-2\" onClick={(e) => e.stopPropagation()}>\n                                <Button\n                                  variant=\"outline\"\n                                  size=\"sm\"\n                                  className=\"h-8 w-8 p-0\"\n                                  onClick={(e) => {\n                                    e.stopPropagation();\n                                    setSelectedMaterial(material);\n                                    setEditDialogOpen(true);\n                                  }}\n                                >\n                                  <Edit className=\"h-3.5 w-3.5\" />\n                                </Button>\n                                {canDelete && (\n                                  <Button\n                                    variant=\"outline\"\n                                    size=\"sm\"\n                                    className=\"h-8 w-8 p-0 text-destructive hover:text-destructive hover:bg-destructive/10\"\n                                    onClick={(e) => {\n                                      e.stopPropagation();\n                                      handleDeleteClick(material);\n                                    }}\n                                  >\n                                    <Trash2 className=\"h-3.5 w-3.5\" />\n                                  </Button>\n                                )}\n                              </div>\n                            </div>\n                          </CardContent>\n                        </Card>\n                      );\n                    }}\n                  />\n                </div>\n                \n                {totalPages > 1 && (\n                    <div className=\"flex flex-col sm:flex-row items-center justify-between gap-3 p-4 border-t\">\n                    <div className=\"text-xs sm:text-sm text-muted-foreground text-center sm:text-left\">\n                      Toplam {filteredMaterials.length} hammadde gsteriliyor\n                    </div>\n                    <div className=\"flex items-center gap-2 w-full sm:w-auto justify-center sm:justify-end\">\n                      <Button\n                        variant=\"outline\"\n                        size=\"sm\"\n                        onClick={() => setPage((prev) => Math.max(1, prev - 1))}\n                        disabled={page === 1}\n                        className=\"text-xs sm:text-sm\"\n                      >\n                        nceki\n                      </Button>\n                      <span className=\"text-xs sm:text-sm text-muted-foreground px-3\">\n                        Sayfa {page} / {totalPages}\n                      </span>\n                      <Button\n                        variant=\"outline\"\n                        size=\"sm\"\n                        onClick={() => setPage((prev) => Math.min(totalPages, prev + 1))}\n                        disabled={page === totalPages}\n                        className=\"text-xs sm:text-sm\"\n                      >\n                        Sonraki\n                      </Button>\n                    </div>\n                  </div>\n                )}\n              </>\n            )}\n          </CardContent>\n        </Card>\n\n        <CreateRawMaterialDialog\n          open={createDialogOpen}\n          onOpenChange={setCreateDialogOpen}\n          onSuccess={fetchMaterials}\n        />\n\n        {selectedMaterial && (\n          <>\n            <EditRawMaterialDialog\n              open={editDialogOpen}\n              onOpenChange={setEditDialogOpen}\n              material={selectedMaterial}\n              onSuccess={() => {\n                fetchMaterials();\n                setEditDialogOpen(false);\n              }}\n            />\n            <RawMaterialDetailModal\n              open={detailModalOpen}\n              onOpenChange={setDetailModalOpen}\n              material={selectedMaterial}\n              onEdit={() => {\n                setDetailModalOpen(false);\n                setEditDialogOpen(true);\n              }}\n              onDelete={() => {\n                fetchMaterials();\n                setDetailModalOpen(false);\n              }}\n            />\n          </>\n        )}\n\n        <AlertDialog open={deleteDialogOpen} onOpenChange={setDeleteDialogOpen}>\n          <AlertDialogContent>\n            <AlertDialogHeader>\n              <AlertDialogTitle className=\"text-[16px] sm:text-[18px]\">Hammadde Sil</AlertDialogTitle>\n              <AlertDialogDescription className=\"text-xs sm:text-sm\">\n                \"{materialToDelete?.name}\" hammaddesini silmek istediinize emin misiniz? Bu ilem geri alnamaz.\n              </AlertDialogDescription>\n            </AlertDialogHeader>\n            <AlertDialogFooter>\n              <AlertDialogCancel className=\"text-xs sm:text-sm\">ptal</AlertDialogCancel>\n              <AlertDialogAction\n                onClick={handleDelete}\n                className=\"text-xs sm:text-sm bg-destructive text-destructive-foreground hover:bg-destructive/90\"\n              >\n                Sil\n              </AlertDialogAction>\n            </AlertDialogFooter>\n          </AlertDialogContent>\n        </AlertDialog>\n\n        <DetailedValueReportModal\n          open={statsModalOpen}\n          onOpenChange={setStatsModalOpen}\n          title=\"Hammadde Deer Raporu\"\n          type=\"rawMaterials\"\n          data={materials as unknown as Record<string, unknown>[]}\n        />\n      </div>\n    </MainLayout>\n  );\n};\n\nexport default RawMaterials;\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\pages\\Reports.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchSavedReports'. Either include it or remove the dependency array.","line":33,"column":6,"nodeType":"ArrayExpression","endLine":33,"endColumn":12,"suggestions":[{"desc":"Update the dependencies array to be: [fetchSavedReports, user]","fix":{"range":[2244,2250],"text":"[fetchSavedReports, user]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect, lazy, Suspense } from \"react\";\nimport { MainLayout } from \"@/components/Layout/MainLayout\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { FileText, TrendingUp, Package, Users, Download } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\n// Lazy load dialog components to avoid loading pdfGenerator.ts on initial page load\nconst SalesReportDialog = lazy(() => import(\"@/components/Reports/SalesReportDialog\").then(module => ({ default: module.SalesReportDialog })));\nconst ProductionReportDialog = lazy(() => import(\"@/components/Reports/ProductionReportDialog\").then(module => ({ default: module.ProductionReportDialog })));\nconst CustomerReportDialog = lazy(() => import(\"@/components/Reports/CustomerReportDialog\").then(module => ({ default: module.CustomerReportDialog })));\nconst FinancialReportDialog = lazy(() => import(\"@/components/Reports/FinancialReportDialog\").then(module => ({ default: module.FinancialReportDialog })));\nconst SalesQuoteForm = lazy(() => import(\"@/components/Reports/SalesQuoteForm\").then(module => ({ default: module.SalesQuoteForm })));\n// apiClient moved to legacy_before_firebase_migration\n// Reports should use Firebase services\nimport { toast } from \"sonner\";\nimport { useAuth } from \"@/contexts/AuthContext\";\n\nconst Reports = () => {\n  const { user } = useAuth();\n  const [salesDialogOpen, setSalesDialogOpen] = useState(false);\n  const [productionDialogOpen, setProductionDialogOpen] = useState(false);\n  const [customerDialogOpen, setCustomerDialogOpen] = useState(false);\n  const [financialDialogOpen, setFinancialDialogOpen] = useState(false);\n  const [quoteDialogOpen, setQuoteDialogOpen] = useState(false);\n  const [savedReports, setSavedReports] = useState<Array<{ id: string; title: string; reportType: string; createdAt?: unknown; fileUrl?: string; fileName?: string; [key: string]: unknown }>>([]);\n  const [reportsIndexLink, setReportsIndexLink] = useState<string | null>(null);\n  const [auditIndexLink, setAuditIndexLink] = useState<string | null>(null);\n  const [downloading, setDownloading] = useState<string | null>(null);\n\n  useEffect(() => {\n    if (user) {\n      fetchSavedReports();\n    }\n  }, [user]);\n\n  const parseIndexLink = (message?: string) => {\n    if (!message) return null;\n    const match = message.match(/https:\\/\\/[^\\s]+/);\n    return match ? match[0] : null;\n  };\n\n  const fetchSavedReports = async () => {\n    try {\n      const { getSavedReports } = await import(\"@/services/firebase/reportService\");\n      const reports = await getSavedReports({ createdBy: user?.id });\n      setSavedReports(reports as unknown as Array<{ id: string; title: string; reportType: string; createdAt?: unknown; fileUrl?: string; fileName?: string; [key: string]: unknown }>);\n      setReportsIndexLink(null);\n    } catch (error: unknown) {\n      if (import.meta.env.DEV) {\n        console.error(\"Fetch saved reports error:\", error);\n      }\n      const link = parseIndexLink(error instanceof Error ? error.message : String(error));\n      if (link) {\n        setReportsIndexLink(link);\n        toast.warning(\"Raporlar iin Firestore indexi oluturmanz gerekiyor.\");\n      }\n      // Hata durumunda bo array brak\n      setSavedReports([]);\n    }\n  };\n\n  const downloadReport = async (report: { id: string; title: string; createdAt?: unknown; fileUrl?: string; fileName?: string; [key: string]: unknown }) => {\n    setDownloading(report.id);\n    try {\n      const fileUrl = typeof report.fileUrl === 'string' ? report.fileUrl : undefined;\n      const fileName = typeof report.fileName === 'string' ? report.fileName : undefined;\n      if (fileUrl) {\n        // Firebase Storage'dan indirme\n        const a = document.createElement(\"a\");\n        a.href = fileUrl;\n        a.download = fileName || `rapor-${report.id}.pdf`;\n        document.body.appendChild(a);\n        a.click();\n        document.body.removeChild(a);\n        toast.success(\"Rapor indiriliyor...\");\n      } else {\n        toast.error(\"Rapor dosyas bulunamad\");\n      }\n    } catch (error: unknown) {\n      if (import.meta.env.DEV) {\n        console.error(\"Download report error:\", error);\n      }\n      toast.error(error instanceof Error ? error.message : \"Rapor indirilemedi\");\n    } finally {\n      setDownloading(null);\n    }\n  };\n\n  const getReportTypeLabel = (type: string) => {\n    const labels: Record<string, string> = {\n      sales: \"Sat\",\n      production: \"retim\",\n      customer: \"Mteri\",\n      financial: \"Mali\"\n    };\n    return labels[type] || type;\n  };\n\n  const reportTypes = [\n    {\n      icon: TrendingUp,\n      title: \"Sat Raporu\",\n      description: \"Gnlk, haftalk ve aylk sat analizleri\",\n      color: \"primary\",\n      onClick: () => setSalesDialogOpen(true)\n    },\n    {\n      icon: FileText,\n      title: \"Sat Teklifi\",\n      description: \"Teklif formunu dzenleyip PDF olarak indir\",\n      color: \"default\",\n      onClick: () => setQuoteDialogOpen(true)\n    },\n    {\n      icon: Package,\n      title: \"retim Raporu\",\n      description: \"retim sreleri ve tamamlanma oranlar\",\n      color: \"success\",\n      onClick: () => setProductionDialogOpen(true)\n    },\n    {\n      icon: Users,\n      title: \"Mteri Raporu\",\n      description: \"Mteri analizleri ve davran raporlar\",\n      color: \"info\",\n      onClick: () => setCustomerDialogOpen(true)\n    },\n    {\n      icon: FileText,\n      title: \"Mali Rapor\",\n      description: \"Gelir-gider ve kar-zarar analizi\",\n      color: \"warning\",\n      onClick: () => setFinancialDialogOpen(true)\n    },\n  ];\n\n  return (\n    <MainLayout>\n      <div className=\"space-y-2 w-full sm:w-[95%] md:w-[90%] lg:max-w-[1400px] mx-auto\">\n        <div>\n            <h1 className=\"text-[16px] sm:text-[18px] font-semibold text-foreground leading-tight\">Raporlar</h1>\n          <p className=\"text-[11px] sm:text-xs text-muted-foreground mt-0.5 sm:mt-1 leading-snug\"> analizleri ve raporlama</p>\n        </div>\n\n        <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-2 sm:gap-3\">\n          {reportTypes.map((report, index) => (\n            <Card key={index} className=\"hover:shadow-lg transition-all duration-300 cursor-pointer touch-manipulation min-h-[44px]\" onClick={report.onClick}>\n              <CardHeader className=\"p-2\">\n                <div className=\"flex items-center gap-2 sm:gap-3\">\n                  <div className=\"p-2 sm:p-2.5 rounded-lg bg-primary/10 flex-shrink-0\">\n                    <report.icon className=\"h-4 w-4 sm:h-5 sm:w-5 text-primary\" />\n                  </div>\n                  <CardTitle className=\"text-[14px] sm:text-[15px] leading-tight\">{report.title}</CardTitle>\n                </div>\n              </CardHeader>\n              <CardContent className=\"p-2 pt-0\">\n                <p className=\"text-[11px] sm:text-xs text-muted-foreground mb-2 sm:mb-3\">{report.description}</p>\n                <Button\n                  className=\"w-full sm:w-auto min-h-[36px] sm:min-h-8 text-[11px] sm:text-xs\"\n                  variant=\"outline\"\n                  onClick={(e) => {\n                    e.stopPropagation();\n                    report.onClick();\n                  }}\n                >\n                  Rapor Olutur\n                </Button>\n              </CardContent>\n            </Card>\n          ))}\n        </div>\n\n        {/* Lazy load dialogs only when they are opened */}\n        {salesDialogOpen && (\n          <Suspense fallback={null}>\n        <SalesReportDialog open={salesDialogOpen} onOpenChange={(open) => { setSalesDialogOpen(open); if (!open) fetchSavedReports(); }} />\n          </Suspense>\n        )}\n        {productionDialogOpen && (\n          <Suspense fallback={null}>\n        <ProductionReportDialog open={productionDialogOpen} onOpenChange={(open) => { setProductionDialogOpen(open); if (!open) fetchSavedReports(); }} />\n          </Suspense>\n        )}\n        {customerDialogOpen && (\n          <Suspense fallback={null}>\n        <CustomerReportDialog open={customerDialogOpen} onOpenChange={(open) => { setCustomerDialogOpen(open); if (!open) fetchSavedReports(); }} />\n          </Suspense>\n        )}\n        {financialDialogOpen && (\n          <Suspense fallback={null}>\n        <FinancialReportDialog open={financialDialogOpen} onOpenChange={(open) => { setFinancialDialogOpen(open); if (!open) fetchSavedReports(); }} />\n          </Suspense>\n        )}\n        {quoteDialogOpen && (\n          <Suspense fallback={null}>\n        <SalesQuoteForm open={quoteDialogOpen} onOpenChange={setQuoteDialogOpen} />\n          </Suspense>\n        )}\n\n        {reportsIndexLink && (\n          <div className=\"rounded-lg border border-amber-500 bg-amber-50 p-4 text-[11px] sm:text-xs text-amber-900 space-y-2\">\n            <div className=\"font-semibold\">Firestore index gerekli</div>\n            <p>\n              Kaytl raporlar grebilmek iin Firestoreda aadaki linkteki indexi oluturup Active\n              olmasn beklemelisiniz:\n            </p>\n            <a\n              href={reportsIndexLink}\n              target=\"_blank\"\n              rel=\"noreferrer\"\n              className=\"inline-flex items-center gap-2 text-amber-900 font-medium underline\"\n            >\n              Indexi a\n              <Download className=\"h-4 w-4\" />\n            </a>\n            <p className=\"text-[11px] sm:text-xs text-amber-800\">\n              Index building durumundan active olana kadar birka dakika srebilir. Tamamlandktan sonra liste\n              otomatik olarak alacaktr.\n            </p>\n          </div>\n        )}\n\n        <Card>\n          <CardHeader className=\"p-2\">\n            <CardTitle className=\"text-[14px] sm:text-[15px] leading-tight\">Son Oluturulan Raporlar</CardTitle>\n          </CardHeader>\n          <CardContent className=\"p-2\">\n            {savedReports.length === 0 ? (\n              <p className=\"text-[11px] sm:text-xs text-muted-foreground text-center py-6 sm:py-8\">Henz rapor oluturulmam</p>\n            ) : (\n              <div className=\"space-y-2 sm:space-y-3 max-h-[60vh] overflow-y-auto pr-2\">\n                {savedReports.map((report) => (\n                  <div\n                    key={report.id}\n                    className=\"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-2 sm:gap-3 p-2.5 sm:p-3 rounded-lg border border-border hover:bg-muted/50 transition-colors\"\n                  >\n                    <div className=\"flex items-center gap-2 sm:gap-3 flex-1 min-w-0\">\n                      <FileText className=\"h-4 w-4 sm:h-5 sm:w-5 text-primary flex-shrink-0\" />\n                      <div className=\"flex-1 min-w-0\">\n                        <p className=\"font-medium text-[11px] sm:text-xs truncate\">{report.title}</p>\n                        <p className=\"text-[11px] sm:text-xs text-muted-foreground\">\n                          {getReportTypeLabel(report.reportType)}  {report.createdAt \n                            ? (report.createdAt instanceof Date \n                                ? report.createdAt \n                                : (report.createdAt && typeof report.createdAt === 'object' && 'toDate' in report.createdAt && typeof (report.createdAt as { toDate: () => Date }).toDate === 'function') \n                                  ? (report.createdAt as { toDate: () => Date }).toDate() \n                                  : new Date()\n                              ).toLocaleDateString('tr-TR')\n                            : '-'}\n                        </p>\n                      </div>\n                    </div>\n                    <Button \n                      variant=\"ghost\" \n                      size=\"sm\"\n                      className=\"h-8 sm:h-9 text-[11px] sm:text-xs w-full sm:w-auto\"\n                      onClick={() => downloadReport(report)}\n                      disabled={downloading === report.id}\n                    >\n                      <Download className=\"h-3.5 w-3.5 sm:h-4 sm:w-4 sm:mr-2\" />\n                      <span className=\"hidden sm:inline\">{downloading === report.id ? \"ndiriliyor...\" : \"ndir\"}</span>\n                      <span className=\"sm:hidden\">{downloading === report.id ? \"...\" : \"ndir\"}</span>\n                    </Button>\n                  </div>\n                ))}\n              </div>\n            )}\n          </CardContent>\n        </Card>\n      </div>\n    </MainLayout>\n  );\n};\n\nexport default Reports;\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\pages\\Requests.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchData'. Either include it or remove the dependency array.","line":76,"column":6,"nodeType":"ArrayExpression","endLine":76,"endColumn":12,"suggestions":[{"desc":"Update the dependencies array to be: [fetchData, user]","fix":{"range":[2790,2796],"text":"[fetchData, user]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useEffect, useState } from \"react\";\nimport { MainLayout } from \"@/components/Layout/MainLayout\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Tabs, TabsList, TabsTrigger, TabsContent } from \"@/components/ui/tabs\";\nimport { useAuth } from \"@/contexts/AuthContext\";\nimport { getRequests, updateRequestStatus, deleteRequest, Request } from \"@/services/firebase/requestService\";\nimport { RequestModal } from \"@/components/Requests/RequestModal\";\nimport { Plus, CheckCircle2, XCircle, Clock, Trash2, Loader2 } from \"lucide-react\";\nimport { format } from \"date-fns\";\nimport { tr } from \"date-fns/locale\";\nimport { toast } from \"sonner\";\nimport { getAllUsers } from \"@/services/firebase/authService\";\nimport { cn } from \"@/lib/utils\";\nimport { ResponsiveTable, ResponsiveTableColumn } from \"@/components/shared/ResponsiveTable\";\nimport {\n  AlertDialog,\n  AlertDialogAction,\n  AlertDialogCancel,\n  AlertDialogContent,\n  AlertDialogDescription,\n  AlertDialogFooter,\n  AlertDialogHeader,\n  AlertDialogTitle,\n} from \"@/components/ui/alert-dialog\";\n\nconst Requests = () => {\n  const { user, isAdmin, isTeamLeader, isSuperAdmin } = useAuth();\n  const [requests, setRequests] = useState<Request[]>([]);\n  const [usersMap, setUsersMap] = useState<Record<string, string>>({});\n  const [loading, setLoading] = useState(true);\n  const [modalOpen, setModalOpen] = useState(false);\n  const [activeTab, setActiveTab] = useState(\"my_requests\");\n  const [processingId, setProcessingId] = useState<string | null>(null);\n  const [deleteConfirmOpen, setDeleteConfirmOpen] = useState(false);\n  const [requestToDelete, setRequestToDelete] = useState<string | null>(null);\n\n  const canManage = isAdmin || isTeamLeader;\n\n  const fetchData = async () => {\n    if (!user) return;\n    setLoading(true);\n    try {\n      // Filtreleme parametrelerini ayarla\n      const filters = {\n        isSuperAdmin: isSuperAdmin || false,\n        createdBy: user.id, // Kullanc kendi taleplerini grmeli\n        assignedTo: user.id, // Ynetici/Lider kendisine atananlar grmeli\n      };\n\n      const allRequests = await getRequests(filters);\n      \n      setRequests(allRequests);\n\n      // Kullanc isimlerini al\n      const users = await getAllUsers();\n      const uMap: Record<string, string> = {};\n      users.forEach(u => uMap[u.id] = u.fullName || u.email);\n      setUsersMap(uMap);\n\n    } catch (error) {\n      if (import.meta.env.DEV) {\n        console.error(\"Fetch requests error:\", error);\n      }\n      toast.error(\"Talepler yklenirken hata olutu\");\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  useEffect(() => {\n    if (user) {\n      fetchData();\n    }\n  }, [user]);\n\n  // Sekmelere gre filtreleme\n  const myRequests = requests.filter(r => r.createdBy === user?.id);\n  const incomingRequests = canManage ? requests.filter(r => (r.assignedTo === user?.id || isSuperAdmin) && r.status === \"pending\") : [];\n  const historyRequests = canManage ? requests.filter(r => (r.assignedTo === user?.id || isSuperAdmin) && r.status !== \"pending\") : [];\n\n  const handleStatusUpdate = async (requestId: string, status: \"approved\" | \"rejected\") => {\n    if (!user) return;\n    setProcessingId(requestId);\n    try {\n      let reason = \"\";\n      if (status === \"rejected\") {\n        reason = prompt(\"Reddetme sebebi (istee bal):\") || \"\";\n      }\n\n      await updateRequestStatus(requestId, status, user.id, reason);\n      toast.success(status === \"approved\" ? \"Talep onayland\" : \"Talep reddedildi\");\n      fetchData();\n    } catch (error) {\n      if (import.meta.env.DEV) {\n        console.error(\"Update status error:\", error);\n      }\n      toast.error(\"lem baarsz\");\n    } finally {\n      setProcessingId(null);\n    }\n  };\n\n  const handleDelete = async () => {\n      if (!requestToDelete) return;\n      try {\n          await deleteRequest(requestToDelete);\n          toast.success(\"Talep silindi\");\n          setDeleteConfirmOpen(false);\n          setRequestToDelete(null);\n          fetchData();\n      } catch (error) {\n          toast.error(\"Silme ilemi baarsz\");\n      }\n  };\n\n  const getStatusBadge = (status: string) => {\n    switch (status) {\n      case \"approved\":\n        return <Badge className=\"bg-emerald-500 hover:bg-emerald-600\"><CheckCircle2 className=\"w-3 h-3 mr-1\" /> Onayland</Badge>;\n      case \"rejected\":\n        return <Badge variant=\"destructive\"><XCircle className=\"w-3 h-3 mr-1\" /> Reddedildi</Badge>;\n      default:\n        return <Badge variant=\"secondary\" className=\"bg-yellow-100 text-yellow-800 hover:bg-yellow-200\"><Clock className=\"w-3 h-3 mr-1\" /> Bekliyor</Badge>;\n    }\n  };\n\n  const getTypeLabel = (type: string) => {\n    const types: Record<string, string> = {\n        leave: \"zin\",\n        purchase: \"Satn Alma\",\n        advance: \"Avans\",\n        expense: \"Masraf\",\n        other: \"Dier\"\n    };\n    return types[type] || type;\n  };\n\n  const renderTable = (data: Request[], showActions: boolean = false) => {\n    const columns: ResponsiveTableColumn<Request>[] = [\n      {\n        key: \"type\",\n        header: \"Tr\",\n        accessor: (req) => <span className=\"font-medium\">{getTypeLabel(req.type)}</span>,\n        priority: \"high\",\n        minWidth: 140,\n        headerClassName: \"text-left\",\n        cellClassName: \"text-left\",\n      },\n      {\n        key: \"title\",\n        header: \"Balk\",\n        accessor: (req) => (\n          <div className=\"flex flex-col gap-1 max-w-[300px]\">\n            <span className=\"font-medium\">{req.title}</span>\n            {req.description && (\n              <span className=\"text-xs sm:text-sm text-muted-foreground whitespace-normal break-words\">\n                {req.description}\n              </span>\n            )}\n          </div>\n        ),\n        priority: \"high\",\n        minWidth: 180,\n        headerClassName: \"text-left\",\n        cellClassName: \"text-left\",\n      },\n      {\n        key: \"createdBy\",\n        header: \"Talep Eden\",\n        accessor: (req) => <span>{usersMap[req.createdBy] || \"Bilinmiyor\"}</span>,\n        priority: \"medium\",\n        minWidth: 140,\n        headerClassName: \"text-left\",\n        cellClassName: \"text-left\",\n      },\n      {\n        key: \"date\",\n        header: \"Tarih\",\n        accessor: (req) => (\n          <span>\n            {req.createdAt instanceof Object \n              ? format(req.createdAt.toDate(), \"d MMM yyyy\", { locale: tr })\n              : \"-\"}\n          </span>\n        ),\n        priority: \"medium\",\n        minWidth: 140,\n        headerClassName: \"text-left\",\n        cellClassName: \"text-left\",\n      },\n      {\n        key: \"amount\",\n        header: \"Tutar/Detay\",\n        accessor: (req) => (\n          <div>\n            {req.amount ? `${req.amount} ${req.currency}` : \"-\"}\n            {req.startDate && (\n              <div className=\"text-xs sm:text-sm text-muted-foreground\">\n                {format(req.startDate.toDate(), \"d MMM\", { locale: tr })} \n                {req.endDate ? ` - ${format(req.endDate.toDate(), \"d MMM\", { locale: tr })}` : \"\"}\n              </div>\n            )}\n          </div>\n        ),\n        priority: \"low\",\n        minWidth: 140,\n        headerClassName: \"text-left\",\n        cellClassName: \"text-left\",\n      },\n      {\n        key: \"status\",\n        header: \"Durum\",\n        accessor: (req) => (\n          <div className=\"flex flex-col gap-1.5\">\n            {getStatusBadge(req.status)}\n            {req.rejectionReason && (\n              <span className=\"text-xs sm:text-sm text-red-600 font-medium max-w-[150px]\">\n                {req.rejectionReason}\n              </span>\n            )}\n            {req.approvedBy && (\n              <div className=\"flex flex-col gap-0.5 mt-1\">\n                <span className={cn(\n                  \"text-xs sm:text-sm font-medium\",\n                  req.status === \"rejected\" ? \"text-red-700\" : \"text-emerald-700\"\n                )}>\n                  {req.status === \"rejected\" ? \"Cevaplayan\" : \"Onaylayan\"}: {usersMap[req.approvedBy] || \"Bilinmiyor\"}\n                </span>\n                {req.approvedAt && (\n                  <span className=\"text-xs sm:text-sm text-muted-foreground\">\n                    {req.approvedAt instanceof Object \n                      ? format(req.approvedAt.toDate(), \"d MMM yyyy HH:mm\", { locale: tr })\n                      : \"-\"}\n                  </span>\n                )}\n              </div>\n            )}\n          </div>\n        ),\n        priority: \"high\",\n        minWidth: 180,\n        headerClassName: \"text-left\",\n        cellClassName: \"text-left\",\n      },\n    ];\n\n    if (showActions) {\n      columns.push({\n        key: \"actions\",\n        header: \"lemler\",\n        accessor: (req) => (\n          <div className=\"flex justify-start gap-2\">\n            {req.status === \"pending\" && (\n              <>\n                <Button \n                  size=\"sm\" \n                  className=\"bg-emerald-600 hover:bg-emerald-700 text-white min-h-[44px] min-w-[44px] sm:min-h-0 sm:min-w-0 sm:h-8 sm:w-8 p-0\"\n                  onClick={(e) => {\n                    e.stopPropagation();\n                    handleStatusUpdate(req.id, \"approved\");\n                  }}\n                  disabled={!!processingId}\n                >\n                  {processingId === req.id ? <Loader2 className=\"w-4 h-4 animate-spin\" /> : <CheckCircle2 className=\"w-4 h-4\" />}\n                </Button>\n                <Button \n                  size=\"sm\" \n                  variant=\"destructive\"\n                  className=\"min-h-[44px] min-w-[44px] sm:min-h-0 sm:min-w-0 sm:h-8 sm:w-8 p-0\"\n                  onClick={(e) => {\n                    e.stopPropagation();\n                    handleStatusUpdate(req.id, \"rejected\");\n                  }}\n                  disabled={!!processingId}\n                >\n                  {processingId === req.id ? <Loader2 className=\"w-4 h-4 animate-spin\" /> : <XCircle className=\"w-4 h-4\" />}\n                </Button>\n              </>\n            )}\n          </div>\n        ),\n        headerClassName: \"text-left\",\n        cellClassName: \"text-left\",\n        priority: \"high\",\n        minWidth: 140,\n      });\n    }\n\n    return (\n      <ResponsiveTable\n        data={data}\n        columns={columns}\n        emptyMessage=\"Kayt bulunamad\"\n        renderCard={(req) => (\n          <Card className=\"cursor-pointer hover:shadow-lg transition-all\">\n            <CardContent className=\"p-3 sm:p-4 space-y-2\">\n              <div className=\"flex items-start justify-between\">\n                <div className=\"flex-1\">\n                  <div className=\"flex items-center gap-2 mb-1\">\n                    <Badge variant=\"outline\" className=\"text-[10px]\">\n                      {getTypeLabel(req.type)}\n                    </Badge>\n                    {getStatusBadge(req.status)}\n                  </div>\n                  <h3 className=\"font-semibold text-[11px] sm:text-xs mb-1\">{req.title}</h3>\n                  {req.description && (\n                    <p className=\"text-[11px] sm:text-xs text-muted-foreground line-clamp-2\">\n                      {req.description}\n                    </p>\n                  )}\n                </div>\n              </div>\n              <div className=\"flex flex-col gap-1.5 pt-2 border-t\">\n                <div className=\"flex items-center justify-between text-[11px] sm:text-xs\">\n                  <span className=\"text-muted-foreground\">Talep Eden:</span>\n                  <span className=\"font-medium\">{usersMap[req.createdBy] || \"Bilinmiyor\"}</span>\n                </div>\n                <div className=\"flex items-center justify-between text-[11px] sm:text-xs\">\n                  <span className=\"text-muted-foreground\">Tarih:</span>\n                  <span>\n                    {req.createdAt instanceof Object \n                      ? format(req.createdAt.toDate(), \"d MMM yyyy\", { locale: tr })\n                      : \"-\"}\n                  </span>\n                </div>\n                {req.amount && (\n                  <div className=\"flex items-center justify-between text-[11px] sm:text-xs\">\n                    <span className=\"text-muted-foreground\">Tutar:</span>\n                    <span className=\"font-semibold\">{req.amount} {req.currency}</span>\n                  </div>\n                )}\n                {req.startDate && (\n                  <div className=\"flex items-center justify-between text-[11px] sm:text-xs\">\n                    <span className=\"text-muted-foreground\">Tarih Aral:</span>\n                    <span>\n                      {format(req.startDate.toDate(), \"d MMM\", { locale: tr })} \n                      {req.endDate ? ` - ${format(req.endDate.toDate(), \"d MMM\", { locale: tr })}` : \"\"}\n                    </span>\n                  </div>\n                )}\n                {showActions && req.status === \"pending\" && (\n                  <div className=\"flex justify-end gap-2 pt-2\">\n                    <Button \n                      size=\"sm\" \n                      className=\"bg-emerald-600 hover:bg-emerald-700 text-white min-h-[44px] flex-1 sm:flex-initial sm:min-h-0 sm:h-8 sm:w-8\"\n                      onClick={(e) => {\n                        e.stopPropagation();\n                        handleStatusUpdate(req.id, \"approved\");\n                      }}\n                      disabled={!!processingId}\n                    >\n                      {processingId === req.id ? <Loader2 className=\"w-4 h-4 animate-spin\" /> : <CheckCircle2 className=\"w-4 h-4\" />}\n                    </Button>\n                    <Button \n                      size=\"sm\" \n                      variant=\"destructive\"\n                      className=\"min-h-[44px] flex-1 sm:flex-initial sm:min-h-0 sm:h-8 sm:w-8\"\n                      onClick={(e) => {\n                        e.stopPropagation();\n                        handleStatusUpdate(req.id, \"rejected\");\n                      }}\n                      disabled={!!processingId}\n                    >\n                      {processingId === req.id ? <Loader2 className=\"w-4 h-4 animate-spin\" /> : <XCircle className=\"w-4 h-4\" />}\n                    </Button>\n                  </div>\n                )}\n                {!showActions && req.createdBy === user?.id && req.status === \"pending\" && (\n                  <div className=\"flex justify-end pt-2\">\n                    <Button\n                      size=\"sm\"\n                      variant=\"ghost\"\n                      className=\"h-8 w-8 p-0 text-muted-foreground hover:text-destructive\"\n                      onClick={(e) => {\n                        e.stopPropagation();\n                        setRequestToDelete(req.id);\n                        setDeleteConfirmOpen(true);\n                      }}\n                    >\n                      <Trash2 className=\"w-4 h-4\" />\n                    </Button>\n                  </div>\n                )}\n              </div>\n            </CardContent>\n          </Card>\n        )}\n      />\n    );\n  };\n\n  return (\n    <MainLayout>\n      <div className=\"space-y-2 w-full sm:w-[95%] md:w-[90%] lg:max-w-[1400px] mx-auto\">\n        <div className=\"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-1.5 sm:gap-2\">\n          <div className=\"flex-1 min-w-0\">\n            <h1 className=\"text-[16px] sm:text-[18px] font-semibold text-foreground\">Talep Ynetimi</h1>\n            <p className=\"text-muted-foreground mt-0.5 text-[11px] sm:text-xs\">\n              zin, satn alma ve dier taleplerinizi ynetin.\n            </p>\n          </div>\n          <Button onClick={() => setModalOpen(true)} className=\"w-full sm:w-auto min-h-[36px] sm:min-h-8 gap-1 text-[11px] sm:text-xs\">\n            <Plus className=\"h-4 w-4\" />\n            <span className=\"hidden sm:inline\">Yeni Talep</span>\n            <span className=\"sm:hidden\">Yeni</span>\n          </Button>\n        </div>\n\n        <Tabs defaultValue=\"my_requests\" onValueChange={setActiveTab} className=\"w-full\">\n          <div className=\"overflow-x-auto pb-2 -mx-4 px-4 sm:mx-0 sm:px-0 sm:pb-0\">\n            <TabsList className=\"w-full sm:w-auto\">\n              <TabsTrigger value=\"my_requests\" className=\"min-h-[44px] sm:min-h-0\">Taleplerim</TabsTrigger>\n              {canManage && <TabsTrigger value=\"incoming\" className=\"min-h-[44px] sm:min-h-0\">Gelen Talepler ({incomingRequests.length})</TabsTrigger>}\n              {canManage && <TabsTrigger value=\"history\" className=\"min-h-[44px] sm:min-h-0\">Talep Gemii</TabsTrigger>}\n            </TabsList>\n          </div>\n\n          <TabsContent value=\"my_requests\" className=\"mt-4\">\n            <Card>\n              <CardHeader>\n                <CardTitle>Taleplerim</CardTitle>\n              </CardHeader>\n              <CardContent>\n                {renderTable(myRequests)}\n              </CardContent>\n            </Card>\n          </TabsContent>\n\n          {canManage && (\n            <>\n              <TabsContent value=\"incoming\" className=\"mt-3 sm:mt-4\">\n                <Card>\n                  <CardHeader>\n                    <CardTitle>Onay Bekleyen Talepler</CardTitle>\n                  </CardHeader>\n                  <CardContent>\n                    {renderTable(incomingRequests, true)}\n                  </CardContent>\n                </Card>\n              </TabsContent>\n\n              <TabsContent value=\"history\" className=\"mt-3 sm:mt-4\">\n                <Card>\n                  <CardHeader>\n                    <CardTitle>Tm Talep Gemii</CardTitle>\n                  </CardHeader>\n                  <CardContent>\n                    {renderTable(historyRequests, false)}\n                  </CardContent>\n                </Card>\n              </TabsContent>\n            </>\n          )}\n        </Tabs>\n\n        <RequestModal \n            open={modalOpen} \n            onOpenChange={setModalOpen} \n            onSuccess={fetchData}\n        />\n\n        <AlertDialog open={deleteConfirmOpen} onOpenChange={setDeleteConfirmOpen}>\n            <AlertDialogContent>\n                <AlertDialogHeader>\n                    <AlertDialogTitle>Emin misiniz?</AlertDialogTitle>\n                    <AlertDialogDescription>\n                        Bu talebi silmek istediinize emin misiniz? Bu ilem geri alnamaz.\n                    </AlertDialogDescription>\n                </AlertDialogHeader>\n                <AlertDialogFooter>\n                    <AlertDialogCancel>ptal</AlertDialogCancel>\n                    <AlertDialogAction onClick={handleDelete} className=\"bg-destructive text-destructive-foreground hover:bg-destructive/90\">\n                        Sil\n                    </AlertDialogAction>\n                </AlertDialogFooter>\n            </AlertDialogContent>\n        </AlertDialog>\n\n      </div>\n    </MainLayout>\n  );\n};\n\nexport default Requests;","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\pages\\ResetPassword.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\pages\\Settings.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\pages\\TaskDetail.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchTaskDetails'. Either include it or remove the dependency array.","line":35,"column":6,"nodeType":"ArrayExpression","endLine":35,"endColumn":10,"suggestions":[{"desc":"Update the dependencies array to be: [fetchTaskDetails, id]","fix":{"range":[1338,1342],"text":"[fetchTaskDetails, id]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useEffect, useState } from \"react\";\nimport { useParams, useNavigate } from \"react-router-dom\";\nimport { MainLayout } from \"@/components/Layout/MainLayout\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Avatar, AvatarFallback } from \"@/components/ui/avatar\";\nimport { Separator } from \"@/components/ui/separator\";\nimport { toast } from \"sonner\";\nimport { getTaskById, getTaskAssignments } from \"@/services/firebase/taskService\";\nimport { getAllUsers, UserProfile } from \"@/services/firebase/authService\";\nimport { Timestamp } from \"firebase/firestore\";\nimport { ArrowLeft, CheckCircle2, Clock, AlertCircle, Calendar, User } from \"lucide-react\";\nimport { format } from \"date-fns\";\n\ninterface AssignedUser {\n  id: string;\n  full_name: string;\n  email: string;\n  accepted_at: string | null;\n  completed_at: string | null;\n}\n\nconst TaskDetail = () => {\n  const { id } = useParams();\n  const navigate = useNavigate();\n  const [task, setTask] = useState<Awaited<ReturnType<typeof getTaskById>>>(null);\n  const [assignedUsers, setAssignedUsers] = useState<AssignedUser[]>([]);\n  const [loading, setLoading] = useState(true);\n\n  useEffect(() => {\n    if (id) {\n      fetchTaskDetails();\n    }\n  }, [id]);\n\n  const fetchTaskDetails = async () => {\n    if (!id) return;\n    \n    try {\n      const [taskData, assignments, allUsers] = await Promise.all([\n        getTaskById(id),\n        getTaskAssignments(id),\n        getAllUsers(),\n      ]);\n\n      if (!taskData) {\n        toast.error(\"Grev bulunamad\");\n        navigate(\"/tasks\");\n        return;\n      }\n\n      // UI formatna evir\n      const taskUI = {\n        ...taskData,\n        due_date: taskData.dueDate\n          ? taskData.dueDate instanceof Timestamp\n            ? taskData.dueDate.toDate().toISOString()\n            : new Date(taskData.dueDate).toISOString()\n          : null,\n        created_at: taskData.createdAt instanceof Timestamp\n          ? taskData.createdAt.toDate().toISOString()\n          : new Date(taskData.createdAt).toISOString(),\n      };\n\n      setTask(taskUI);\n\n      const users: AssignedUser[] = assignments.map((assignment) => {\n        const userProfile = allUsers.find((u) => u.id === assignment.assignedTo);\n        return {\n          id: assignment.assignedTo,\n          full_name: userProfile?.fullName || userProfile?.displayName || \"\",\n          email: userProfile?.email || \"\",\n          accepted_at: assignment.acceptedAt\n            ? assignment.acceptedAt instanceof Timestamp\n              ? assignment.acceptedAt.toDate().toISOString()\n              : new Date(assignment.acceptedAt).toISOString()\n            : null,\n          completed_at: assignment.completedAt\n            ? assignment.completedAt instanceof Timestamp\n              ? assignment.completedAt.toDate().toISOString()\n              : new Date(assignment.completedAt).toISOString()\n            : null,\n        };\n      });\n\n      setAssignedUsers(users);\n    } catch (error: unknown) {\n      if (import.meta.env.DEV) {\n        console.error(\"Fetch task details error:\", error);\n      }\n      toast.error(\"Grev detaylar yklenirken hata: \" + (error instanceof Error ? error.message : \"Bilinmeyen hata\"));\n      navigate(\"/tasks\");\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const getStatusIcon = (status: string) => {\n    switch (status) {\n      case \"completed\":\n        return <CheckCircle2 className=\"h-6 w-6 text-success\" />;\n      case \"in_progress\":\n        return <Clock className=\"h-6 w-6 text-warning\" />;\n      default:\n        return <AlertCircle className=\"h-6 w-6 text-muted-foreground\" />;\n    }\n  };\n\n  const getStatusLabel = (status: string) => {\n    const labels: Record<string, string> = {\n      pending: \"Beklemede\",\n      in_progress: \"Devam Ediyor\",\n      completed: \"Tamamland\",\n      cancelled: \"ptal\",\n    };\n    return labels[status] || status;\n  };\n\n  const getInitials = (name: string) => {\n    return name\n      .split(\" \")\n      .map(n => n[0])\n      .join(\"\")\n      .toUpperCase()\n      .slice(0, 2);\n  };\n\n  if (loading) {\n    return (\n      <MainLayout>\n        <div className=\"flex items-center justify-center h-64\">\n          <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-primary\"></div>\n        </div>\n      </MainLayout>\n    );\n  }\n\n  if (!task) return null;\n\n  return (\n    <MainLayout>\n      <div className=\"space-y-2\">\n        <div className=\"flex items-center gap-2 sm:gap-3 md:gap-4\">\n          <Button variant=\"ghost\" size=\"icon\" className=\"h-9 w-9 sm:h-10 sm:w-10\" onClick={() => navigate(\"/tasks\")}>\n            <ArrowLeft className=\"h-4 w-4 sm:h-5 sm:w-5\" />\n          </Button>\n          <div className=\"flex-1 min-w-0\">\n            <h1 className=\"text-[16px] sm:text-[18px] font-bold text-foreground\">Grev Detay</h1>\n          </div>\n        </div>\n\n        <div className=\"grid gap-1.5 sm:gap-2 grid-cols-1 md:grid-cols-3\">\n          <div className=\"md:col-span-2 space-y-2\">\n            <Card>\n              <CardHeader className=\"p-2\">\n                <div className=\"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-2 sm:gap-3\">\n                  <div className=\"flex items-center gap-2 sm:gap-3 flex-1 min-w-0\">\n                    <div className=\"flex-shrink-0\">{getStatusIcon(task.status)}</div>\n                    <CardTitle className=\"text-[14px] sm:text-[15px] truncate\">{task.title}</CardTitle>\n                  </div>\n                  <Badge variant={task.priority >= 3 ? \"destructive\" : \"secondary\"} className=\"h-5 px-2 py-0 text-[11px] font-normal leading-tight flex-shrink-0\">\n                    ncelik {task.priority}\n                  </Badge>\n                </div>\n              </CardHeader>\n              <CardContent className=\"p-2 space-y-2\">\n                <div>\n                  <h3 className=\"font-semibold mb-1.5 sm:mb-2 text-sm sm:text-base\">Durum</h3>\n                  <Badge variant=\"outline\" className=\"h-5 px-2 py-0 text-[11px] font-normal leading-tight\">{getStatusLabel(task.status)}</Badge>\n                </div>\n\n                {task.description && (\n                  <div>\n                    <h3 className=\"font-semibold mb-1.5 sm:mb-2 text-sm sm:text-base\">Aklama</h3>\n                    <p className=\"text-xs sm:text-sm md:text-base text-muted-foreground\">{task.description}</p>\n                  </div>\n                )}\n\n                <Separator />\n\n                <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-1.5 sm:gap-2\">\n                  <div>\n                    <h3 className=\"font-semibold mb-1.5 sm:mb-2 text-sm sm:text-base flex items-center gap-1.5 sm:gap-2\">\n                      <Calendar className=\"h-3.5 w-3.5 sm:h-4 sm:w-4\" />\n                      Oluturulma Tarihi\n                    </h3>\n                    <p className=\"text-xs sm:text-sm md:text-base text-muted-foreground\">\n                      {format(task.createdAt.toDate(), \"dd MMMM yyyy HH:mm\")}\n                    </p>\n                  </div>\n                  {task.dueDate && (\n                    <div>\n                      <h3 className=\"font-semibold mb-1.5 sm:mb-2 text-sm sm:text-base flex items-center gap-1.5 sm:gap-2\">\n                        <Calendar className=\"h-3.5 w-3.5 sm:h-4 sm:w-4\" />\n                        Biti Tarihi\n                      </h3>\n                      <p className=\"text-xs sm:text-sm md:text-base text-muted-foreground\">\n                        {format(task.dueDate.toDate(), \"dd MMMM yyyy HH:mm\")}\n                      </p>\n                    </div>\n                  )}\n                </div>\n              </CardContent>\n            </Card>\n          </div>\n\n          <div>\n            <Card>\n              <CardHeader className=\"p-2\">\n                <CardTitle className=\"flex items-center gap-1.5 sm:gap-2 text-[14px] sm:text-[15px]\">\n                  <User className=\"h-4 w-4 sm:h-5 sm:w-5\" />\n                  Grevdeki Kiiler ({assignedUsers.length})\n                </CardTitle>\n              </CardHeader>\n              <CardContent className=\"p-2\">\n                <div className=\"space-y-2 sm:space-y-3\">\n                  {assignedUsers.map((assignedUser) => (\n                    <div\n                      key={assignedUser.id}\n                      className=\"flex items-center gap-2 sm:gap-3 p-2 sm:p-3 rounded-lg border border-border\"\n                    >\n                      <Avatar className=\"h-8 w-8 sm:h-10 sm:w-10\">\n                        <AvatarFallback className=\"text-xs sm:text-sm\">\n                          {getInitials(assignedUser.full_name)}\n                        </AvatarFallback>\n                      </Avatar>\n                      <div className=\"flex-1 min-w-0\">\n                        <div className=\"font-medium truncate text-xs sm:text-sm md:text-base\">{assignedUser.full_name}</div>\n                        <div className=\"text-[10px] sm:text-xs md:text-sm text-muted-foreground truncate\">\n                          {assignedUser.email}\n                        </div>\n                        <div className=\"mt-1\">\n                          {assignedUser.completed_at && (\n                            <Badge variant=\"default\" className=\"bg-success text-[10px] sm:text-xs\">\n                              Tamamland\n                            </Badge>\n                          )}\n                          {assignedUser.accepted_at && !assignedUser.completed_at && (\n                            <Badge variant=\"secondary\" className=\"text-[10px] sm:text-xs\">\n                              Kabul Edildi\n                            </Badge>\n                          )}\n                          {!assignedUser.accepted_at && (\n                            <Badge variant=\"outline\" className=\"text-[10px] sm:text-xs\">\n                              Bekliyor\n                            </Badge>\n                          )}\n                        </div>\n                      </div>\n                    </div>\n                  ))}\n                  {assignedUsers.length === 0 && (\n                    <p className=\"text-center py-4 text-[10px] sm:text-xs md:text-sm text-muted-foreground\">\n                      Henz kimse atanmad\n                    </p>\n                  )}\n                </div>\n              </CardContent>\n            </Card>\n          </div>\n        </div>\n      </div>\n    </MainLayout>\n  );\n};\n\nexport default TaskDetail;\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\pages\\Tasks.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'checkCreatePermission' and 'fetchProject'. Either include them or remove the dependency array.","line":531,"column":6,"nodeType":"ArrayExpression","endLine":531,"endColumn":40,"suggestions":[{"desc":"Update the dependencies array to be: [user, projectId, taskTypeFromUrl, checkCreatePermission, fetchProject]","fix":{"range":[22903,22937],"text":"[user, projectId, taskTypeFromUrl, checkCreatePermission, fetchProject]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'cachedProjects'. Either include it or remove the dependency array.","line":690,"column":6,"nodeType":"ArrayExpression","endLine":690,"endColumn":49,"suggestions":[{"desc":"Update the dependencies array to be: [user, cachedProjects.length, isSuperAdmin, cachedProjects]","fix":{"range":[28741,28784],"text":"[user, cachedProjects.length, isSuperAdmin, cachedProjects]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'cachedUsers'. Either include it or remove the dependency array.","line":870,"column":6,"nodeType":"ArrayExpression","endLine":870,"endColumn":69,"suggestions":[{"desc":"Update the dependencies array to be: [user, projectId, taskTypeFromUrl, filterFromUrl, isSuperAdmin, cachedUsers]","fix":{"range":[37037,37100],"text":"[user, projectId, taskTypeFromUrl, filterFromUrl, isSuperAdmin, cachedUsers]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'checkCreatePermission'. Either include it or remove the dependency array.","line":961,"column":6,"nodeType":"ArrayExpression","endLine":961,"endColumn":12,"suggestions":[{"desc":"Update the dependencies array to be: [checkCreatePermission, user]","fix":{"range":[39977,39983],"text":"[checkCreatePermission, user]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1859,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1859,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[75244,75247],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[75244,75247],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useMemo has missing dependencies: 'filterTasks' and 'sortTasks'. Either include them or remove the dependency array.","line":2013,"column":6,"nodeType":"ArrayExpression","endLine":2013,"endColumn":147,"suggestions":[{"desc":"Update the dependencies array to be: [activeFilter, filterTasks, tasksForStatsAndDisplay, sortTasks]","fix":{"range":[83048,83189],"text":"[activeFilter, filterTasks, tasksForStatsAndDisplay, sortTasks]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useMemo has missing dependencies: 'filterTasks' and 'sortTasks'. Either include them or remove the dependency array.","line":2026,"column":6,"nodeType":"ArrayExpression","endLine":2026,"endColumn":147,"suggestions":[{"desc":"Update the dependencies array to be: [activeFilter, filterTasks, tasksForStatsAndDisplay, sortTasks]","fix":{"range":[83791,83932],"text":"[activeFilter, filterTasks, tasksForStatsAndDisplay, sortTasks]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useMemo has missing dependencies: 'filterTasks' and 'sortTasks'. Either include them or remove the dependency array.","line":2037,"column":6,"nodeType":"ArrayExpression","endLine":2037,"endColumn":147,"suggestions":[{"desc":"Update the dependencies array to be: [activeFilter, filterTasks, tasksForStatsAndDisplay, sortTasks]","fix":{"range":[84396,84537],"text":"[activeFilter, filterTasks, tasksForStatsAndDisplay, sortTasks]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":2056,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2056,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[85119,85122],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[85119,85122],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":2057,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2057,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[85142,85145],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[85142,85145],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-case-declarations","severity":2,"message":"Unexpected lexical declaration in case block.","line":2077,"column":11,"nodeType":"VariableDeclaration","messageId":"unexpected","endLine":2077,"endColumn":66,"suggestions":[{"messageId":"addBrackets","fix":{"range":[85708,86070],"text":"{ const aDue = (a as any).dueDate || (a as any).due_date;\n          const bDue = (b as any).dueDate || (b as any).due_date;\n          aValue = aDue ? (aDue instanceof Timestamp ? aDue.toDate().getTime() : new Date(aDue).getTime()) : 0;\n          bValue = bDue ? (bDue instanceof Timestamp ? bDue.toDate().getTime() : new Date(bDue).getTime()) : 0;\n          break; }"},"desc":"Add {} brackets around the case block."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":2077,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2077,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[85727,85730],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[85727,85730],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":2077,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2077,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[85749,85752],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[85749,85752],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-case-declarations","severity":2,"message":"Unexpected lexical declaration in case block.","line":2078,"column":11,"nodeType":"VariableDeclaration","messageId":"unexpected","endLine":2078,"endColumn":66,"suggestions":[{"messageId":"addBrackets","fix":{"range":[85708,86070],"text":"{ const aDue = (a as any).dueDate || (a as any).due_date;\n          const bDue = (b as any).dueDate || (b as any).due_date;\n          aValue = aDue ? (aDue instanceof Timestamp ? aDue.toDate().getTime() : new Date(aDue).getTime()) : 0;\n          bValue = bDue ? (bDue instanceof Timestamp ? bDue.toDate().getTime() : new Date(bDue).getTime()) : 0;\n          break; }"},"desc":"Add {} brackets around the case block."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":2078,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2078,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[85793,85796],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[85793,85796],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":2078,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2078,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[85815,85818],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[85815,85818],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-case-declarations","severity":2,"message":"Unexpected lexical declaration in case block.","line":2083,"column":11,"nodeType":"VariableDeclaration","messageId":"unexpected","endLine":2083,"endColumn":74,"suggestions":[{"messageId":"addBrackets","fix":{"range":[86107,86517],"text":"{ const aCreated = (a as any).createdAt || (a as any).created_at;\n          const bCreated = (b as any).createdAt || (b as any).created_at;\n          aValue = aCreated ? (aCreated instanceof Timestamp ? aCreated.toDate().getTime() : new Date(aCreated).getTime()) : 0;\n          bValue = bCreated ? (bCreated instanceof Timestamp ? bCreated.toDate().getTime() : new Date(bCreated).getTime()) : 0;\n          break; }"},"desc":"Add {} brackets around the case block."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":2083,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2083,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[86130,86133],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[86130,86133],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":2083,"column":58,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2083,"endColumn":61,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[86154,86157],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[86154,86157],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-case-declarations","severity":2,"message":"Unexpected lexical declaration in case block.","line":2084,"column":11,"nodeType":"VariableDeclaration","messageId":"unexpected","endLine":2084,"endColumn":74,"suggestions":[{"messageId":"addBrackets","fix":{"range":[86107,86517],"text":"{ const aCreated = (a as any).createdAt || (a as any).created_at;\n          const bCreated = (b as any).createdAt || (b as any).created_at;\n          aValue = aCreated ? (aCreated instanceof Timestamp ? aCreated.toDate().getTime() : new Date(aCreated).getTime()) : 0;\n          bValue = bCreated ? (bCreated instanceof Timestamp ? bCreated.toDate().getTime() : new Date(bCreated).getTime()) : 0;\n          break; }"},"desc":"Add {} brackets around the case block."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":2084,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2084,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[86204,86207],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[86204,86207],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":2084,"column":58,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2084,"endColumn":61,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[86228,86231],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[86228,86231],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useMemo has a missing dependency: 'applySorting'. Either include it or remove the dependency array.","line":2125,"column":6,"nodeType":"ArrayExpression","endLine":2125,"endColumn":150,"suggestions":[{"desc":"Update the dependencies array to be: [activeFilter, allFirebaseTasks, applySorting, filteredAndSortedMyTasks, filteredAndSortedArchivedTasks, filteredAndSortedAllTasks]","fix":{"range":[87703,87847],"text":"[activeFilter, allFirebaseTasks, applySorting, filteredAndSortedMyTasks, filteredAndSortedArchivedTasks, filteredAndSortedAllTasks]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'filterableProjects'. Either include it or remove the dependency array.","line":2403,"column":6,"nodeType":"ArrayExpression","endLine":2403,"endColumn":23,"suggestions":[{"desc":"Update the dependencies array to be: [filterableProjects, selectedProject]","fix":{"range":[99644,99661],"text":"[filterableProjects, selectedProject]"}}]},{"ruleId":"no-constant-binary-expression","severity":2,"message":"Unexpected constant truthiness on the left-hand side of a `&&` expression.","line":3802,"column":20,"nodeType":"LogicalExpression","messageId":"constantShortCircuit","endLine":3802,"endColumn":52},{"ruleId":"no-constant-binary-expression","severity":2,"message":"Unexpected constant truthiness on the left-hand side of a `&&` expression.","line":3802,"column":20,"nodeType":"Literal","messageId":"constantShortCircuit","endLine":3802,"endColumn":25}],"suppressedMessages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'commentCounts'. Either include it or remove the dependency array.","line":2164,"column":6,"nodeType":"ArrayExpression","endLine":2164,"endColumn":35,"suggestions":[{"desc":"Update the dependencies array to be: [commentCounts, listData, visibleItemsCount]","fix":{"range":[89136,89165],"text":"[commentCounts, listData, visibleItemsCount]"}}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'taskDeletePermissions'. Either include it or remove the dependency array.","line":2218,"column":6,"nodeType":"ArrayExpression","endLine":2218,"endColumn":41,"suggestions":[{"desc":"Update the dependencies array to be: [listData, visibleItemsCount, user, taskDeletePermissions]","fix":{"range":[91001,91036],"text":"[listData, visibleItemsCount, user, taskDeletePermissions]"}}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":17,"fatalErrorCount":0,"warningCount":9,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useEffect, useMemo, useState, useCallback, useRef } from \"react\";\nimport { MainLayout } from \"@/components/Layout/MainLayout\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Avatar, AvatarFallback } from \"@/components/ui/avatar\";\nimport { Input } from \"@/components/ui/input\";\nimport { SearchInput } from \"@/components/ui/search-input\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogFooter, DialogDescription } from \"@/components/ui/dialog\";\nimport { Label } from \"@/components/ui/label\";\nimport { toast } from \"sonner\";\nimport { useAuth } from \"@/contexts/AuthContext\";\nimport { usePermissions } from \"@/hooks/usePermissions\";\nimport {\n  getTasks,\n  subscribeToTasks,\n  deleteTask,\n  updateTaskStatus,\n  updateTask,\n  assignTask,\n  getTaskAssignments,\n  acceptTaskAssignment,\n  rejectTaskAssignment,\n  archiveTask,\n  getTaskComments,\n  Task as FirebaseTask,\n  TaskAssignment as FirebaseTaskAssignment,\n} from \"@/services/firebase/taskService\";\nimport { getRequests, Request as UserRequest } from \"@/services/firebase/requestService\";\nimport { getAllUsers, UserProfile } from \"@/services/firebase/authService\";\nimport { Timestamp } from \"firebase/firestore\";\nimport { CheckCircle2, Clock, AlertCircle, Users, Trash2, Loader2, X, Flame, CalendarDays, Plus, Archive, Lock, CheckSquare, MoreVertical, CircleDot, Edit, Check, Square, BarChart3, ChevronUp, ChevronLeft, Bell, Filter, Zap, LayoutGrid, ArrowLeft, Folder, ChevronDown, Home, ChevronRight, List, RefreshCw, ArrowRight, MessageSquare, Activity, Minus } from \"lucide-react\";\nimport { AlertDialog, AlertDialogAction, AlertDialogCancel, AlertDialogContent, AlertDialogDescription, AlertDialogFooter, AlertDialogHeader, AlertDialogTitle, AlertDialogTrigger } from \"@/components/ui/alert-dialog\";\nimport { DropdownMenu, DropdownMenuContent, DropdownMenuItem, DropdownMenuTrigger } from \"@/components/ui/dropdown-menu\";\nimport { Collapsible, CollapsibleContent, CollapsibleTrigger } from \"@/components/ui/collapsible\";\nimport { Popover, PopoverContent, PopoverTrigger } from \"@/components/ui/popover\";\nimport { Command, CommandEmpty, CommandGroup, CommandInput, CommandItem, CommandList } from \"@/components/ui/command\";\nimport { TaskInlineForm } from \"@/components/Tasks/TaskInlineForm\";\nimport { Tabs, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { TaskBoard } from \"@/components/Tasks/TaskBoard\";\nimport { addDays, isAfter, isBefore, startOfDay } from \"date-fns\";\nimport { canCreateTask, canCreateProject, canDeleteProject, isMainAdmin, canUpdateResource, canViewPrivateTask, canEditTask, canDeleteTask, isAdmin } from \"@/utils/permissions\";\nimport { getDepartments } from \"@/services/firebase/departmentService\";\nimport { onPermissionCacheChange } from \"@/services/firebase/rolePermissionsService\";\nimport { useParams, useNavigate, useSearchParams } from \"react-router-dom\";\nimport { getProjectById, getProjects, createProject, deleteProject, Project } from \"@/services/firebase/projectService\";\nimport { cn } from \"@/lib/utils\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { getPriorityOption, convertOldPriorityToNew, convertNewPriorityToOld, PRIORITY_OPTIONS, PriorityLevel } from \"@/utils/priority\";\n// PieChart kaldrld - artk kullanlmyor\n// Yeni modler import'lar\nimport {\n  getFirstName as getFirstNameHelper,\n  normalizeStatus as normalizeStatusHelper,\n  getStatusLabel as getStatusLabelHelper,\n  formatDateSafe as formatDateSafeHelper,\n  isTaskOverdue as isTaskOverdueHelper,\n  isTaskDueSoon as isTaskDueSoonHelper,\n  getInitials as getInitialsHelper,\n  formatTaskKey as formatTaskKeyHelper,\n  getPriorityDisplay as getPriorityDisplayHelper,\n  getPriorityColor as getPriorityColorHelper,\n  getStatusConfig,\n  TASK_STATUS_WORKFLOW,\n} from \"@/utils/taskHelpers\";\nimport { logError, getErrorMessage } from \"@/utils/errorHandling\";\n\n\ninterface Task {\n  id: string;\n  title: string;\n  description: string | null;\n  status: string;\n  priority: number;\n  due_date: string | null;\n  created_at: string;\n  production_order_number?: string | null;\n  production_order_customer?: string | null;\n  production_order_priority?: number | null;\n  production_order_due_date?: string | null;\n  approvalStatus?: \"pending\" | \"approved\" | \"rejected\";\n  createdBy?: string;\n  projectId?: string | null;\n  isArchived?: boolean;\n  is_archived?: boolean;\n}\n\n// Tam isimden sadece ismi kar (soyisim olmadan)\nconst getFirstName = (fullName: string | null | undefined): string => {\n  if (!fullName) return \"\";\n  return fullName.split(\" \")[0] || fullName;\n};\n\n// Firebase Task'i UI Task formatna evir\nconst convertFirebaseTaskToUITask = (\n  firebaseTask: FirebaseTask,\n  assignments: FirebaseTaskAssignment[],\n  users: UserProfile[]\n): Task & { assignment?: TaskAssignment; assignedUsers?: Profile[] } => {\n  const assignedUsers = assignments\n    .map((a) => {\n      const user = users.find((u) => u.id === a.assignedTo);\n      return user\n        ? {\n          id: user.id,\n          full_name: user.fullName || user.displayName,\n          email: user.email,\n        }\n        : null;\n    })\n    .filter((u): u is Profile => u !== null);\n\n  return {\n    id: firebaseTask.id,\n    title: firebaseTask.title,\n    description: firebaseTask.description || null,\n    status: firebaseTask.status,\n    priority: firebaseTask.priority,\n    due_date: firebaseTask.dueDate\n      ? (firebaseTask.dueDate instanceof Timestamp\n        ? firebaseTask.dueDate.toDate().toISOString()\n        : new Date(firebaseTask.dueDate).toISOString())\n      : null,\n    created_at: firebaseTask.createdAt instanceof Timestamp\n      ? firebaseTask.createdAt.toDate().toISOString()\n      : new Date(firebaseTask.createdAt).toISOString(),\n    assignedUsers,\n    approvalStatus: firebaseTask.approvalStatus,\n    createdBy: firebaseTask.createdBy,\n    projectId: firebaseTask.projectId,\n    isArchived: firebaseTask.isArchived,\n    is_archived: firebaseTask.isArchived, // Eski format destei\n  };\n};\n\ninterface TaskAssignment {\n  id: string;\n  task_id: string;\n  assigned_to: string;\n  assigned_at: string;\n  accepted_at: string | null;\n  completed_at: string | null;\n  rejected_at?: string | null;\n  rejection_reason?: string | null;\n}\n\ninterface Profile {\n  id: string;\n  full_name: string;\n  email: string;\n}\n\n// Grev durum workflow'u - 4 aama\ntype StatusItem = {\n  value: string;\n  label: string;\n  icon: typeof CircleDot;\n  color: string;\n};\n\nconst taskStatusWorkflow: StatusItem[] = [\n  { value: \"pending\", label: \"Yaplacak\", icon: CircleDot, color: \"text-amber-500\" },\n  { value: \"in_progress\", label: \"Devam Ediyor\", icon: Clock, color: \"text-blue-500\" },\n  { value: \"completed\", label: \"Tamamland\", icon: CheckCircle2, color: \"text-emerald-600\" },\n  { value: \"approved\", label: \"Onayland\", icon: CheckCircle2, color: \"text-green-600\" },\n];\n\nconst Tasks = () => {\n  const { user } = useAuth();\n  const [isSuperAdmin, setIsSuperAdmin] = useState(false);\n  const [canUpdate, setCanUpdate] = useState(false);\n\n  // Permission state'lerini Firestore'dan kontrol et\n  useEffect(() => {\n    const checkPermissions = async () => {\n      if (!user) {\n        setIsSuperAdmin(false);\n        setCanUpdate(false);\n        return;\n      }\n      try {\n        const userProfile: UserProfile = {\n          id: user.id,\n          email: user.email,\n          emailVerified: user.emailVerified,\n          fullName: user.fullName,\n          displayName: user.fullName,\n          phone: user.phone,\n          dateOfBirth: user.dateOfBirth,\n          role: user.roles,\n          createdAt: Timestamp.now(),\n          updatedAt: Timestamp.now(),\n        };\n        const [isMainAdminUser, hasUpdatePermission] = await Promise.all([\n          isMainAdmin(userProfile),\n          canUpdateResource(userProfile, \"tasks\"),\n        ]);\n        setIsSuperAdmin(isMainAdminUser);\n        setCanUpdate(hasUpdatePermission);\n      } catch (error: unknown) {\n        if (import.meta.env.DEV) {\n          console.error(\"Error checking permissions:\", error);\n        }\n        setIsSuperAdmin(false);\n        setCanUpdate(false);\n      }\n    };\n    checkPermissions();\n  }, [user]);\n  const { canRead } = usePermissions();\n  const { projectId } = useParams<{ projectId?: string }>();\n  const navigate = useNavigate();\n  const [searchParams, setSearchParams] = useSearchParams();\n  const taskIdFromUrl = searchParams.get('taskId');\n  const taskTypeFromUrl = searchParams.get('type');\n  const filterFromUrl = searchParams.get('filter');\n  const viewFromUrl = searchParams.get('view');\n  const projectFromUrl = searchParams.get('project');\n\n  const [myTasks, setMyTasks] = useState<(Task & { assignment: TaskAssignment; assignedUsers?: Profile[] })[]>([]);\n  const [createdTasks, setCreatedTasks] = useState<(Task & { assignedUsers?: Profile[] })[]>([]);\n  const [archivedTasks, setArchivedTasks] = useState<(Task & { assignedUsers?: Profile[] })[]>([]);\n  const [userRequests, setUserRequests] = useState<UserRequest[]>([]);\n  const [allTasks, setAllTasks] = useState<(Task & { assignedUsers?: Profile[] })[]>([]);\n  const [allFirebaseTasks, setAllFirebaseTasks] = useState<FirebaseTask[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n  const [selectedTaskId, setSelectedTaskId] = useState<string | null>(null);\n  // Optimistic updates iin state\n  const [optimisticUpdates, setOptimisticUpdates] = useState<Map<string, { status: string; timestamp: number }>>(new Map());\n  // Toplu ilemler iin state\n  const [isMultiSelectMode, setIsMultiSelectMode] = useState(false);\n  const [selectedTaskIds, setSelectedTaskIds] = useState<Set<string>>(new Set());\n  // Advanced search iin state\n  const [advancedSearchOpen, setAdvancedSearchOpen] = useState(false);\n  const [advancedSearchFilters, setAdvancedSearchFilters] = useState({\n    title: \"\",\n    description: \"\",\n    status: \"all\",\n    priority: \"all\",\n    projectId: \"all\",\n    assignedTo: \"all\",\n    dueDateFrom: \"\",\n    dueDateTo: \"\",\n  });\n  // Performans optimizasyonu: Liste grnm iin grnen e says\n  const [visibleItemsCount, setVisibleItemsCount] = useState(50);\n  const listContainerRef = useRef<HTMLDivElement>(null);\n  // Mini dashboard iin state\n  const [statsExpanded, setStatsExpanded] = useState(false); // Balangta kapal\n  // Browser notifications iin state\n  const [notificationPermission, setNotificationPermission] = useState<NotificationPermission>(\"default\");\n  const previousTaskStatusesRef = useRef<Map<string, string>>(new Map());\n  // Undo zellii iin state\n  const [deletedTasks, setDeletedTasks] = useState<Array<{ task: FirebaseTask; timestamp: number }>>([]);\n  const undoTimeoutRef = useRef<NodeJS.Timeout | null>(null);\n  // Filtreler iin collapsible state\n  const [filtersExpanded, setFiltersExpanded] = useState(true);\n  const [advancedFiltersExpanded, setAdvancedFiltersExpanded] = useState(false);\n  // Uyarlar iin state\n  const [pendingApprovalsCount, setPendingApprovalsCount] = useState(0);\n  const [pendingAssignmentsCount, setPendingAssignmentsCount] = useState(0);\n  const [upcomingDeadlinesCount, setUpcomingDeadlinesCount] = useState(0);\n  // Cache iin state'ler\n  const [cachedUsers, setCachedUsers] = useState<UserProfile[]>([]);\n  const [cachedProjects, setCachedProjects] = useState<Project[]>([]);\n  const [usersCacheTimestamp, setUsersCacheTimestamp] = useState<number>(0);\n  const [projectsCacheTimestamp, setProjectsCacheTimestamp] = useState<number>(0);\n  // Comment counts cache - taskId -> comment count\n  const [commentCounts, setCommentCounts] = useState<Map<string, number>>(new Map());\n  // Assignment cache - taskId -> assignments mapping (ref kullanarak re-render' nle)\n  const assignmentsCacheRef = useRef<Map<string, FirebaseTaskAssignment[]>>(new Map());\n  const assignmentsCacheTimestampRef = useRef<number>(0);\n  // Filterable projects cache (ref kullanarak re-render' nle)\n  const filterableProjectsCacheRef = useRef<Project[]>([]);\n  const filterableProjectsCacheTimestampRef = useRef<number>(0);\n  // Project task checks cache - projectId -> boolean (kullancnn projede grevi var m)\n  const projectTaskChecksCacheRef = useRef<Map<string, boolean>>(new Map());\n  const [selectedTaskInitialStatus, setSelectedTaskInitialStatus] = useState<\"pending\" | \"in_progress\" | \"completed\">(\"pending\");\n  const [inlineFormVisible, setInlineFormVisible] = useState(false);\n  const [inlineFormMode, setInlineFormMode] = useState<\"create\" | \"edit\">(\"create\");\n  const [inlineFormTaskId, setInlineFormTaskId] = useState<string | null>(null);\n  const [inlineFormDefaultStatus, setInlineFormDefaultStatus] = useState<\"pending\" | \"in_progress\" | \"completed\">(\"pending\");\n  const [viewMode, setViewMode] = useState<\"list\" | \"board\">(\n    viewFromUrl === \"list\" ? \"list\" : (viewFromUrl === \"board\" ? \"board\" : \"list\")\n  );\n\n  const openInlineForm = useCallback((\n    mode: \"create\" | \"edit\",\n    taskId?: string | null,\n    status: \"pending\" | \"in_progress\" | \"completed\" = \"pending\"\n  ) => {\n    setInlineFormMode(mode);\n    setInlineFormTaskId(taskId || null);\n    setInlineFormDefaultStatus(status);\n    setInlineFormVisible(true);\n  }, []);\n\n  const closeInlineForm = useCallback(() => {\n    setInlineFormVisible(false);\n    setInlineFormTaskId(null);\n  }, []);\n\n  const scrollToInlineForm = useCallback(() => {\n    requestAnimationFrame(() => {\n      window.scrollTo({ top: 0, behavior: \"smooth\" });\n    });\n  }, []);\n\n  const openTaskDetail = useCallback((taskId: string, initialStatus?: string) => {\n    if (taskId === \"new\") {\n      const normalizedStatus: \"pending\" | \"in_progress\" | \"completed\" =\n        initialStatus && [\"pending\", \"in_progress\", \"completed\"].includes(initialStatus)\n          ? (initialStatus as \"pending\" | \"in_progress\" | \"completed\")\n          : \"pending\";\n      openInlineForm(\"create\", null, normalizedStatus);\n      return;\n    }\n\n    // Hem liste hem pano grnmnde TaskInlineForm alacak\n    openInlineForm(\"edit\", taskId);\n  }, [openInlineForm]);\n\n  const handleInlineSuccess = useCallback(async () => {\n    // Real-time subscribe otomatik gncelleyecek\n    closeInlineForm();\n  }, [closeInlineForm]);\n  const [searchTerm, setSearchTerm] = useState(\"\");\n  // Arama gemii ve favori filtreler iin state\n  const [searchHistory, setSearchHistory] = useState<string[]>([]);\n  const [favoriteFilters, setFavoriteFilters] = useState<Array<{ name: string; filters: Record<string, unknown> }>>([]);\n  const [recentlyViewedTasks, setRecentlyViewedTasks] = useState<string[]>([]);\n  const [statusFilter, setStatusFilter] = useState<string>(\"all\");\n  const [sortBy, setSortBy] = useState<string>(\"created_at\");\n  // Jira tarz sralama iin state'ler\n  const [sortColumn, setSortColumn] = useState<string | null>(null);\n  const [sortDirection, setSortDirection] = useState<\"asc\" | \"desc\">(\"desc\");\n  const [deletingId, setDeletingId] = useState<string | null>(null);\n  const [openDropdownMenuId, setOpenDropdownMenuId] = useState<string | null>(null);\n  // Sabit stun genilikleri\n  const columnWidths = {\n    title: 250,\n    project: 180,\n    status: 140,\n    assignee: 140,\n    priority: 110,\n    dueDate: 110,\n  };\n  const [focusFilter, setFocusFilter] = useState<\"all\" | \"due_soon\" | \"overdue\" | \"high_priority\">(\"all\");\n  // Filtre tipi: all, my-tasks, general, pool, archive\n  const [activeFilter, setActiveFilter] = useState<\"all\" | \"my-tasks\" | \"general\" | \"pool\" | \"archive\">(\n    filterFromUrl === \"my-tasks\" ? \"my-tasks\" :\n      filterFromUrl === \"general\" ? \"general\" :\n        filterFromUrl === \"pool\" ? \"pool\" :\n          filterFromUrl === \"archive\" ? \"archive\" : \"all\"\n  );\n  // Seili proje: \"all\", \"general\", veya proje ID'si\n  const [selectedProject, setSelectedProject] = useState<string>(\n    projectFromUrl || (projectId ? projectId : (taskTypeFromUrl === 'general' ? \"general\" : \"all\"))\n  );\n  const [projectFilter, setProjectFilter] = useState<string>(\"all\");\n  const [assignedUserFilter, setAssignedUserFilter] = useState<string>(\"all\");\n  const [rejectDialogOpen, setRejectDialogOpen] = useState(false);\n  const [rejectingAssignment, setRejectingAssignment] = useState<TaskAssignment | null>(null);\n  const [rejectionReason, setRejectionReason] = useState(\"\");\n  const [rejecting, setRejecting] = useState(false);\n  const [canCreate, setCanCreate] = useState(false);\n  const [createProjectDialogOpen, setCreateProjectDialogOpen] = useState(false);\n  const [deleteProjectDialogOpen, setDeleteProjectDialogOpen] = useState(false);\n  const [projectToDelete, setProjectToDelete] = useState<Project | null>(null);\n  const [newProjectName, setNewProjectName] = useState(\"\");\n  const [newProjectDescription, setNewProjectDescription] = useState(\"\");\n  const [canCreateProjectState, setCanCreateProjectState] = useState(false);\n  const [canDeleteProjectState, setCanDeleteProjectState] = useState(false);\n  const [canAccessTeamManagement, setCanAccessTeamManagement] = useState(false);\n  const [project, setProject] = useState<Project | null>(null);\n  const [projects, setProjects] = useState<Map<string, Project>>(new Map());\n  const [filterableProjects, setFilterableProjects] = useState<Project[]>([]);\n  // En son ilem yaplan projeyi takip et\n  const lastUsedProjectRef = useRef<string | null>(null);\n  // Proje dropdown iin state\n  const [projectDropdownOpen, setProjectDropdownOpen] = useState(false);\n  const [projectSearchQuery, setProjectSearchQuery] = useState(\"\");\n\n  useEffect(() => {\n    // URL'deki filter parametresine gre sekme deitir\n    if (filterFromUrl === \"my-tasks\") {\n      setActiveFilter(\"my-tasks\");\n    } else if (filterFromUrl === \"general\") {\n      setActiveFilter(\"general\");\n    } else if (filterFromUrl === \"pool\") {\n      setActiveFilter(\"pool\");\n    } else if (filterFromUrl === \"archive\") {\n      setActiveFilter(\"archive\");\n    } else {\n      setActiveFilter(\"all\");\n    }\n  }, [filterFromUrl]);\n\n  // URL'deki project parametresine gre seili projeyi ayarla\n  useEffect(() => {\n    if (projectFromUrl) {\n      setSelectedProject(projectFromUrl);\n      setProjectFilter(projectFromUrl === \"general\" ? \"general\" : projectFromUrl);\n    } else if (projectId) {\n      setSelectedProject(projectId);\n      setProjectFilter(projectId);\n    } else if (taskTypeFromUrl === 'general') {\n      setSelectedProject(\"general\");\n      setProjectFilter(\"general\");\n    } else {\n      setSelectedProject(\"all\");\n      setProjectFilter(\"all\");\n    }\n  }, [projectFromUrl, projectId, taskTypeFromUrl]);\n\n  useEffect(() => {\n    if (taskIdFromUrl && allTasks.length > 0) {\n      const task = allTasks.find(t => t.id === taskIdFromUrl);\n      if (task && selectedTaskId !== taskIdFromUrl) {\n        // Sadece farkl bir grev seildiyse a (sonsuz dngy nle)\n        openTaskDetail(taskIdFromUrl, task.status);\n      }\n    }\n  }, [taskIdFromUrl, allTasks, openTaskDetail, selectedTaskId]);\n\n  // Klavye ksayollar ve navigasyon\n  const [focusedTaskIndex, setFocusedTaskIndex] = useState<number>(-1);\n  const taskRefs = useRef<(HTMLElement | null)[]>([]);\n\n\n  // URL'den view parametresini oku ve viewMode'u ayarla (sadece ilk yklemede)\n  const viewModeInitialized = useRef(false);\n  useEffect(() => {\n    if (!viewModeInitialized.current) {\n      if (viewFromUrl === \"board\") {\n        setViewMode(\"board\");\n      } else if (viewFromUrl === \"list\") {\n        setViewMode(\"list\");\n      } else {\n        // viewFromUrl yoksa varsaylan olarak list alr\n        setViewMode(\"list\");\n      }\n      viewModeInitialized.current = true;\n    }\n  }, [viewFromUrl]);\n\n  // View mode deitiinde URL'i gncelle (sadece kullanc etkileimi sonras)\n  useEffect(() => {\n    // lk yklemede URL gncellemesi yapma\n    if (!viewModeInitialized.current) return;\n\n    const newParams = new URLSearchParams(searchParams);\n    const currentView = newParams.get(\"view\");\n    const newView = viewMode === \"board\" ? \"board\" : \"list\";\n\n    // Sadece deiiklik varsa gncelle (sonsuz dngy nle)\n    if (currentView !== newView) {\n      if (newView === \"list\") {\n        // Liste varsaylan olduu iin URL'den kaldr\n        newParams.delete(\"view\");\n      } else {\n        newParams.set(\"view\", newView);\n      }\n      setSearchParams(newParams, { replace: true });\n    }\n  }, [viewMode, searchParams, setSearchParams]);\n\n  // Seili proje deitiinde URL'i gncelle\n  useEffect(() => {\n    const newParams = new URLSearchParams(searchParams);\n    const currentProject = newParams.get(\"project\");\n    const newProject = selectedProject === \"all\" ? null : selectedProject;\n\n    // Sadece deiiklik varsa gncelle (sonsuz dngy nle)\n    if (currentProject !== newProject) {\n      if (newProject === null) {\n        newParams.delete(\"project\");\n      } else {\n        newParams.set(\"project\", newProject);\n      }\n      setSearchParams(newParams, { replace: true });\n    }\n  }, [selectedProject, searchParams, setSearchParams]);\n\n  // Filtre deitiinde URL'i gncelle\n  useEffect(() => {\n    const newParams = new URLSearchParams(searchParams);\n    const currentFilter = newParams.get(\"filter\");\n    const newFilter = activeFilter === \"all\" ? null : activeFilter;\n\n    // Sadece deiiklik varsa gncelle (sonsuz dngy nle)\n    if (currentFilter !== newFilter) {\n      if (newFilter === null) {\n        newParams.delete(\"filter\");\n      } else {\n        newParams.set(\"filter\", newFilter);\n      }\n      setSearchParams(newParams, { replace: true });\n    }\n  }, [activeFilter, searchParams, setSearchParams]);\n\n  // Browser notifications izni kontrol\n  useEffect(() => {\n    if (\"Notification\" in window) {\n      setNotificationPermission(Notification.permission);\n    }\n  }, []);\n\n  useEffect(() => {\n    if (user) {\n      // \"Genel Grevler\" sayfasndaysak (type=general), proje detay sayfas deil\n      // Bu durumda projectId undefined olmal ve fetchProject arlmamal\n      if (taskTypeFromUrl === 'general') {\n        // \"Genel Grevler\" sayfasndaysak, proje filtresini \"general\" yap\n        // Ama proje detay sayfas deil, bu yzden fetchProject arlmayacak\n        setProjectFilter(\"general\");\n      } else if (projectId) {\n        // Sadece gerek bir proje ID'si varsa (ve \"general\" deilse) fetchProject ar\n        fetchProject();\n        // Proje detay sayfasndaysak, proje filtresini otomatik olarak o projeye ayarla\n        setProjectFilter(projectId);\n      } else {\n        // Proje detay sayfasnda deilsek ve \"Genel Grevler\" sayfasnda deilsek, proje filtresini \"all\" yap\n        setProjectFilter(\"all\");\n      }\n      checkCreatePermission();\n    }\n  }, [user, projectId, taskTypeFromUrl]);\n\n  // Kullanclar ve projeleri ykle (subscription callback'inden ayr)\n  useEffect(() => {\n    if (!user) return;\n\n    const loadUsersAndProjects = async () => {\n      const now = Date.now();\n      const USERS_PROJECTS_CACHE_DURATION = 5 * 60 * 1000; // 5 dakika\n      const shouldRefreshUsers = !cachedUsers.length || (now - usersCacheTimestamp) > USERS_PROJECTS_CACHE_DURATION;\n      const shouldRefreshProjects = !cachedProjects.length || (now - projectsCacheTimestamp) > USERS_PROJECTS_CACHE_DURATION;\n\n      if (shouldRefreshUsers) {\n        try {\n          const allUsers = await getAllUsers();\n          setCachedUsers(allUsers);\n          setUsersCacheTimestamp(now);\n        } catch (error: unknown) {\n          if (import.meta.env.DEV) {\n            console.error(\"Error loading users:\", error);\n          }\n        }\n      }\n\n      if (shouldRefreshProjects) {\n        try {\n          const allProjectsData = await getProjects();\n          setCachedProjects(allProjectsData);\n          setProjectsCacheTimestamp(now);\n\n          // Projeleri Map'e evir (hzl eriim iin)\n          const projectsMap = new Map<string, Project>();\n          (Array.isArray(allProjectsData) ? allProjectsData : []).forEach((p) => {\n            if (p?.id) {\n              projectsMap.set(p.id, p);\n            }\n          });\n          setProjects(projectsMap);\n        } catch (error: unknown) {\n          if (import.meta.env.DEV) {\n            console.error(\"Error loading projects:\", error);\n          }\n        }\n      }\n    };\n\n    loadUsersAndProjects();\n  }, [user, cachedUsers.length, cachedProjects.length, usersCacheTimestamp, projectsCacheTimestamp]);\n\n  // Requests'i ykle\n  useEffect(() => {\n    if (!user?.id) return;\n\n    const loadRequests = async () => {\n      try {\n        const myRequestsData = await getRequests({ createdBy: user.id });\n        setUserRequests(myRequestsData);\n      } catch (error) {\n        if (import.meta.env.DEV) {\n          if (import.meta.env.DEV) {\n            console.error(\"Error loading requests:\", error);\n          }\n        }\n      }\n    };\n\n    loadRequests();\n  }, [user?.id]);\n\n  // Filtrelenebilir projeleri hesapla (ayr useEffect - performans iin)\n  useEffect(() => {\n    if (!user || !cachedProjects.length) return;\n\n    const calculateFilterableProjects = async () => {\n      const now = Date.now();\n      const FILTERABLE_PROJECTS_CACHE_DURATION = 5 * 60 * 1000; // 5 dakika\n      const shouldRefresh = !filterableProjectsCacheRef.current.length ||\n        (now - filterableProjectsCacheTimestampRef.current) > FILTERABLE_PROJECTS_CACHE_DURATION;\n\n      if (!shouldRefresh) {\n        // Cache'den al\n        const lastUsedProjectId = localStorage.getItem('lastUsedProjectId');\n        if (lastUsedProjectId) {\n          lastUsedProjectRef.current = lastUsedProjectId;\n        }\n        const sortedProjects = [...filterableProjectsCacheRef.current].sort((a, b) => {\n          if (a.id === lastUsedProjectRef.current) return -1;\n          if (b.id === lastUsedProjectRef.current) return 1;\n          return 0;\n        });\n        setFilterableProjects(sortedProjects);\n        return;\n      }\n\n      const filterableProjectsList = await Promise.allSettled(\n        cachedProjects.map(async (project) => {\n          if (!project?.id) return null;\n\n          try {\n            if (project.name?.toLowerCase() === \"gizli grevler\") return null;\n            if (!project.isPrivate) return project;\n            if (isSuperAdmin) return project;\n            if (user?.id && project.createdBy === user.id) return project;\n            // Team Leader kontrol - Firestore'dan (canUpdate projects)\n            // Bu kontrol async olduu iin burada yaplamaz, yukarda zaten kontrol ediliyor\n\n            if (user?.id) {\n              const cachedCheck = projectTaskChecksCacheRef.current.get(project.id);\n              if (cachedCheck !== undefined) {\n                return cachedCheck ? project : null;\n              }\n\n              try {\n                const projectTasks = await getTasks({ projectId: project.id });\n                const hasTaskInProject = Array.isArray(projectTasks) && projectTasks.some((task) => {\n                  if (!task) return false;\n                  if (task.createdBy === user.id) return true;\n                  if (Array.isArray(task.assignedUsers) && task.assignedUsers.includes(user.id)) return true;\n                  return false;\n                });\n                projectTaskChecksCacheRef.current.set(project.id, hasTaskInProject);\n                if (hasTaskInProject) return project;\n              } catch {\n                projectTaskChecksCacheRef.current.set(project.id, false);\n              }\n            }\n            return null;\n          } catch (error: unknown) {\n            if (import.meta.env.DEV) {\n              console.error(`Error processing project ${project.id}:`, error);\n            }\n            return null;\n          }\n        })\n      );\n\n      const validProjects = filterableProjectsList\n        .filter((result): result is PromiseFulfilledResult<Project | null> => result.status === 'fulfilled')\n        .map(result => result.value)\n        .filter((p): p is Project => p !== null);\n\n      filterableProjectsCacheRef.current = validProjects;\n      filterableProjectsCacheTimestampRef.current = now;\n\n      const lastUsedProjectId = localStorage.getItem('lastUsedProjectId');\n      if (lastUsedProjectId) {\n        lastUsedProjectRef.current = lastUsedProjectId;\n      }\n\n      const sortedProjects = [...validProjects].sort((a, b) => {\n        if (a.id === lastUsedProjectRef.current) return -1;\n        if (b.id === lastUsedProjectRef.current) return 1;\n        return 0;\n      });\n\n      setFilterableProjects(sortedProjects);\n    };\n\n    calculateFilterableProjects();\n  }, [user, cachedProjects.length, isSuperAdmin]);\n\n  // Gerek zamanl grev gncellemeleri iin subscribe\n  useEffect(() => {\n    if (!user) return;\n\n    // Eer 'type=general' ise sadece \"general\" projesine ait grevleri al\n    // \"Benim Grevlerim\" sekmesi iin (filterFromUrl === 'my-tasks') tm grevleri al (proje filtresi olmadan)\n    // Proje detay sayfasndayken: projectId filtresi ile grevleri al\n    // Dier durumlarda tm grevleri al\n    const taskFilters = taskTypeFromUrl === 'general'\n      ? { projectId: \"general\" }\n      : filterFromUrl === 'my-tasks'\n        ? {} // \"Benim Grevlerim\" sekmesi iin tm grevleri al\n        : projectId\n          ? { projectId } // Proje detay sayfasndayken projectId filtresi ile al\n          : {}; // Normal \"Tm Grevler\" sayfasnda tm grevleri al\n\n    // Gerek zamanl dinleme balat\n    const unsubscribe = subscribeToTasks(taskFilters, async (firebaseTasks) => {\n      try {\n        const now = Date.now();\n\n        // Kullanclar ve projeleri cache'den al (ayr useEffect'lerde ykleniyor)\n        const allUsers = cachedUsers;\n\n        // Her grev iin assignments'lar al - Cache kullan ve sadece yeni/deien grevler iin al\n        const ASSIGNMENTS_CACHE_DURATION = 2 * 60 * 1000; // 2 dakika\n        const validFirebaseTasks = (Array.isArray(firebaseTasks) ? firebaseTasks : []).filter(t => t?.id);\n\n        // Hangi grevler iin assignment alnmas gerektiini belirle\n        const tasksNeedingAssignments = validFirebaseTasks.filter((firebaseTask) => {\n          const cached = assignmentsCacheRef.current.get(firebaseTask.id);\n          const cacheAge = now - assignmentsCacheTimestampRef.current;\n          // Cache yoksa veya cache eskiyse veya grev gncellenmise assignment al\n          return !cached || cacheAge > ASSIGNMENTS_CACHE_DURATION ||\n            (firebaseTask.updatedAt && cached && firebaseTask.updatedAt.toMillis() > assignmentsCacheTimestampRef.current);\n        });\n\n        // Sadece gerekli grevler iin assignment'lar al (batch)\n        if (tasksNeedingAssignments.length > 0) {\n          const newAssignments = await Promise.all(\n            tasksNeedingAssignments.map(async (firebaseTask) => {\n              if (!firebaseTask?.id) return null;\n              try {\n                const assignments = await getTaskAssignments(firebaseTask.id);\n                return { taskId: firebaseTask.id, assignments: Array.isArray(assignments) ? assignments : [] };\n              } catch (error: unknown) {\n                if (import.meta.env.DEV) {\n                  console.error(`Error fetching assignments for task ${firebaseTask.id}:`, error);\n                }\n                return { taskId: firebaseTask.id, assignments: [] };\n              }\n            })\n          );\n\n          // Cache'i gncelle\n          newAssignments.forEach((item) => {\n            if (item) {\n              assignmentsCacheRef.current.set(item.taskId, item.assignments);\n            }\n          });\n          assignmentsCacheTimestampRef.current = now;\n        }\n\n        // Yorum saylarn ykle (batch - performans iin sadece grnen grevler iin)\n        const commentCountsMap = new Map<string, number>();\n        try {\n          // Sadece grnen grevler iin yorum says ykle (ilk 50 grev)\n          const tasksToLoad = validFirebaseTasks.slice(0, Math.min(50, validFirebaseTasks.length));\n          const batchSize = 10;\n          for (let i = 0; i < tasksToLoad.length; i += batchSize) {\n            const batch = tasksToLoad.slice(i, i + batchSize);\n            await Promise.all(\n              batch.map(async (firebaseTask) => {\n                if (!firebaseTask?.id) return;\n                try {\n                  const comments = await getTaskComments(firebaseTask.id);\n                  commentCountsMap.set(firebaseTask.id, Array.isArray(comments) ? comments.length : 0);\n                } catch (error: unknown) {\n                  if (import.meta.env.DEV) {\n                    console.error(`Error fetching comments for task ${firebaseTask.id}:`, error);\n                  }\n                  commentCountsMap.set(firebaseTask.id, 0);\n                }\n              })\n            );\n          }\n          setCommentCounts(commentCountsMap);\n        } catch (error: unknown) {\n          if (import.meta.env.DEV) {\n            console.error(\"Error loading comment counts:\", error);\n          }\n        }\n\n        // Tm grevler iin assignment'lar cache'den al\n        const tasksWithAssignments = validFirebaseTasks.map((firebaseTask) => {\n          const assignments = assignmentsCacheRef.current.get(firebaseTask.id) || [];\n          return { firebaseTask, assignments };\n        });\n\n        // Null deerleri filtrele\n        const validTasksWithAssignments = tasksWithAssignments.filter((t): t is { firebaseTask: FirebaseTask; assignments: FirebaseTaskAssignment[] } => t !== null);\n\n        // Grevleri kategorilere ayr\n        const myTasksList: (Task & { assignment: TaskAssignment; assignedUsers?: Profile[] })[] = [];\n        const createdTasksList: (Task & { assignedUsers?: Profile[] })[] = [];\n        const archivedTasksList: (Task & { assignedUsers?: Profile[] })[] = [];\n        const allTasksList: (Task & { assignedUsers?: Profile[] })[] = [];\n\n        validTasksWithAssignments.forEach(({ firebaseTask, assignments }) => {\n          if (!firebaseTask) return;\n          const uiTask = convertFirebaseTaskToUITask(firebaseTask, Array.isArray(assignments) ? assignments : [], Array.isArray(allUsers) ? allUsers : []);\n          allTasksList.push(uiTask);\n\n          // Arivlenmi grevler\n          if (firebaseTask.isArchived) {\n            archivedTasksList.push(uiTask);\n            return;\n          }\n\n          // \"Benim Grevlerim\" sekmesi iin: Sadece kullancya atanan grevler\n          const activeAssignments = (Array.isArray(assignments) ? assignments : []).filter((a) => a?.status !== \"rejected\");\n          const myAssignment = activeAssignments.find((a) => a?.assignedTo === user?.id);\n\n          if (myAssignment) {\n            myTasksList.push({\n              ...uiTask,\n              assignment: {\n                id: myAssignment.id,\n                task_id: myAssignment.taskId,\n                assigned_to: myAssignment.assignedTo,\n                assigned_at: myAssignment.assignedAt instanceof Timestamp\n                  ? myAssignment.assignedAt.toDate().toISOString()\n                  : new Date(myAssignment.assignedAt).toISOString(),\n                accepted_at: myAssignment.acceptedAt instanceof Timestamp\n                  ? myAssignment.acceptedAt.toDate().toISOString()\n                  : myAssignment.acceptedAt\n                    ? new Date(myAssignment.acceptedAt).toISOString()\n                    : null,\n                completed_at: myAssignment.completedAt instanceof Timestamp\n                  ? myAssignment.completedAt.toDate().toISOString()\n                  : myAssignment.completedAt\n                    ? new Date(myAssignment.completedAt).toISOString()\n                    : null,\n                rejected_at: myAssignment.rejectionReason ? new Date().toISOString() : undefined,\n                rejection_reason: myAssignment.rejectionReason || undefined,\n              },\n            });\n          }\n\n          // Oluturulan grevler\n          if (firebaseTask.createdBy === user.id) {\n            createdTasksList.push(uiTask);\n          }\n        });\n\n        // Firebase'den gelen grevler zaten silinmemi grevler (deleteDoc ile silinenler Firestore'dan kaldrlyor)\n        setAllFirebaseTasks(firebaseTasks);\n        setMyTasks(myTasksList);\n        setCreatedTasks(createdTasksList);\n        setArchivedTasks(archivedTasksList);\n        setAllTasks(allTasksList);\n        setLoading(false);\n      } catch (error: unknown) {\n        if (import.meta.env.DEV) {\n          if (import.meta.env.DEV) {\n            console.error(\"Real-time tasks update error:\", error);\n          }\n        }\n        const errorMessage = error instanceof Error ? error.message : String(error) || \"Grevler gncellenirken hata olutu\";\n        setError(errorMessage);\n        setLoading(false);\n      }\n    });\n\n    // Cleanup: Component unmount olduunda unsubscribe et\n    return () => {\n      unsubscribe();\n    };\n  }, [user, projectId, taskTypeFromUrl, filterFromUrl, isSuperAdmin]);\n\n  const fetchProject = async () => {\n    if (!projectId) return;\n    try {\n      const projectData = await getProjectById(projectId);\n      setProject(projectData);\n    } catch (error: unknown) {\n      if (import.meta.env.DEV) {\n        if (import.meta.env.DEV) {\n          console.error(\"Fetch project error:\", error);\n        }\n      }\n      const errorMessage = error instanceof Error ? error.message : String(error);\n      toast.error(errorMessage || \"Proje yklenirken hata olutu\");\n    }\n  };\n\n  // Check permissions for team management access\n  useEffect(() => {\n    const checkTeamManagementPermission = async () => {\n      if (!user) {\n        setCanAccessTeamManagement(false);\n        return;\n      }\n      try {\n        const canReadDepts = await canRead(\"departments\");\n        // Team Leader kontrol - Firestore'dan (canUpdate departments)\n        const { canUpdateResource } = await import(\"@/utils/permissions\");\n        const userProfile: UserProfile = {\n          id: user.id,\n          email: user.email,\n          emailVerified: user.emailVerified,\n          fullName: user.fullName,\n          displayName: user.fullName,\n          phone: user.phone,\n          dateOfBirth: user.dateOfBirth,\n          role: user.roles,\n          createdAt: Timestamp.now(),\n          updatedAt: Timestamp.now(),\n        };\n        const canUpdateDepts = await canUpdateResource(userProfile, \"departments\");\n        setCanAccessTeamManagement(canReadDepts || canUpdateDepts);\n      } catch (error) {\n        if (import.meta.env.DEV) {\n          console.error(\"Error checking team management permission:\", error);\n        }\n        setCanAccessTeamManagement(false);\n      }\n    };\n    checkTeamManagementPermission();\n  }, [user, canRead]);\n\n  const checkCreatePermission = async () => {\n    if (!user) {\n      setCanCreate(false);\n      return;\n    }\n    try {\n      const departments = await getDepartments();\n      // User' UserProfile formatna evir\n      const userProfile: UserProfile = {\n        id: user.id,\n        email: user.email,\n        emailVerified: user.emailVerified,\n        fullName: user.fullName,\n        displayName: user.fullName,\n        phone: user.phone,\n        dateOfBirth: user.dateOfBirth,\n        role: user.roles,\n        createdAt: Timestamp.now(),\n        updatedAt: Timestamp.now(),\n      };\n      const hasPermission = await canCreateTask(userProfile, departments);\n      setCanCreate(hasPermission);\n    } catch (error) {\n      if (import.meta.env.DEV) {\n        console.error(\"Permission check error:\", error);\n      }\n      setCanCreate(false);\n    }\n  };\n\n  // Listen to permission changes in real-time\n  useEffect(() => {\n    if (!user) return;\n    const unsubscribe = onPermissionCacheChange(() => {\n      // Re-check permissions when they change\n      checkCreatePermission();\n    });\n    return () => unsubscribe();\n  }, [user]);\n\n  // Proje oluturma ve silme yetkilerini kontrol et\n  useEffect(() => {\n    const checkProjectPermissions = async () => {\n      if (!user) {\n        setCanCreateProjectState(false);\n        setCanDeleteProjectState(false);\n        return;\n      }\n      try {\n        const departments = await getDepartments();\n        const userProfile: UserProfile = {\n          id: user.id,\n          email: user.email,\n          emailVerified: user.emailVerified,\n          fullName: user.fullName,\n          displayName: user.fullName,\n          phone: user.phone,\n          dateOfBirth: user.dateOfBirth,\n          role: user.roles,\n          createdAt: Timestamp.now(),\n          updatedAt: Timestamp.now(),\n        };\n        const canCreate = await canCreateProject(userProfile, departments);\n        // canDeleteProject iin bir dummy project objesi olutur (sadece yetki kontrol iin)\n        const dummyProject: Project = {\n          id: \"\",\n          name: \"\",\n          description: null,\n          status: \"active\",\n          isPrivate: false,\n          createdBy: user.id,\n          createdAt: Timestamp.now(),\n          updatedAt: Timestamp.now(),\n        };\n        const canDelete = await canDeleteProject(dummyProject, userProfile);\n        setCanCreateProjectState(canCreate);\n        setCanDeleteProjectState(canDelete);\n      } catch (error) {\n        if (import.meta.env.DEV) {\n          console.error(\"Error checking project permissions:\", error);\n        }\n        setCanCreateProjectState(false);\n        setCanDeleteProjectState(false);\n      }\n    };\n    checkProjectPermissions();\n  }, [user]);\n\n  const fetchTasks = async () => {\n    if (!user) return;\n\n    try {\n      setLoading(true);\n\n      // Eer 'type=general' ise sadece \"general\" projesine ait grevleri al\n      // \"Benim Grevlerim\" sekmesi iin (filterFromUrl === 'my-tasks') tm grevleri al (proje filtresi olmadan)\n      // Proje detay sayfasndayken: projectId filtresi ile grevleri al (yeni eklenen grevlerin grnmesi iin)\n      // Dier durumlarda tm grevleri al\n      const taskFilters = taskTypeFromUrl === 'general'\n        ? { projectId: \"general\" }\n        : filterFromUrl === 'my-tasks'\n          ? {} // \"Benim Grevlerim\" sekmesi iin tm grevleri al\n          : projectId\n            ? { projectId } // Proje detay sayfasndayken projectId filtresi ile al\n            : {}; // Normal \"Tm Grevler\" sayfasnda tm grevleri al\n\n      // Tm grevleri, kullanclar, projeleri ve talepleri paralel olarak al\n      // Performans iin: lk yklemede sadece 100 grev ykle (pagination iin)\n      const [allFirebaseTasks, allUsers, allProjectsData, myRequestsData] = await Promise.all([\n        getTasks({ ...taskFilters, limit: 100 }), // Limit ekle (100 grev)\n        getAllUsers(),\n        getProjects(),\n        getRequests({ createdBy: user.id }),\n      ]);\n\n      // Projeleri Map'e evir (hzl eriim iin)\n      const projectsMap = new Map<string, Project>();\n      allProjectsData.forEach((p) => {\n        projectsMap.set(p.id, p);\n      });\n      setProjects(projectsMap);\n\n      // Filtrelenebilir projeleri belirle (gizli projeler iin yetki kontrol) - Promise.allSettled ile gvenli\n      const filterableProjectsList = await Promise.allSettled(\n        (Array.isArray(allProjectsData) ? allProjectsData : []).map(async (project) => {\n          if (!project?.id) return null;\n\n          try {\n            // Otomatik oluturulan \"Gizli Grevler\" projesini filtrele\n            if (project.name?.toLowerCase() === \"gizli grevler\") {\n              return null;\n            }\n\n            // Gizli olmayan projeler herkes grebilir\n            if (!project.isPrivate) return project;\n\n            // st yneticiler tm projeleri grebilir\n            if (isSuperAdmin) return project;\n\n            // Oluturan grebilir\n            if (user?.id && project.createdBy === user.id) return project;\n\n            // Ekip lideri iin projede grevi olan kullanclar kontrol yaplmaz (sadece kendi oluturduu gizli projeleri grebilir)\n            // Team Leader kontrol - Firestore'dan (canUpdate projects)\n            // Bu kontrol async olduu iin burada yaplamaz, yukarda zaten kontrol ediliyor\n\n            // Projede grevi olan kullanclar grebilir (ekip lideri hari)\n            if (user?.id) {\n              try {\n                const projectTasks = await getTasks({ projectId: project.id });\n                const hasTaskInProject = Array.isArray(projectTasks) && projectTasks.some((task) => {\n                  if (!task) return false;\n                  if (task.createdBy === user.id) return true;\n                  if (Array.isArray(task.assignedUsers) && task.assignedUsers.includes(user.id)) return true;\n                  return false;\n                });\n\n                if (hasTaskInProject) return project;\n\n                // Daha detayl kontrol iin assignments'lar da kontrol et\n                for (const task of projectTasks) {\n                  if (!task?.id) continue;\n                  try {\n                    const assignments = await getTaskAssignments(task.id);\n                    const isAssigned = Array.isArray(assignments) && assignments.some(a => a?.assignedTo === user?.id);\n                    if (isAssigned) return project;\n                  } catch {\n                    // Hata durumunda devam et\n                  }\n                }\n              } catch {\n                // Hata durumunda projeyi gsterme\n              }\n            }\n\n            return null;\n          } catch (error: unknown) {\n            if (import.meta.env.DEV) {\n              console.error(`Error processing project ${project.id}:`, error);\n            }\n            return null;\n          }\n        })\n      );\n\n      // Promise.allSettled sonularn ile\n      const validProjects = filterableProjectsList\n        .filter((result): result is PromiseFulfilledResult<Project | null> => result.status === 'fulfilled')\n        .map(result => result.value)\n        .filter((p): p is Project => p !== null);\n\n      setFilterableProjects(validProjects);\n\n      setUserRequests(myRequestsData);\n\n      // Her grev iin assignments'lar al - Promise.allSettled ile gvenli\n      const tasksWithAssignments = await Promise.allSettled(\n        (Array.isArray(allFirebaseTasks) ? allFirebaseTasks : []).map(async (task) => {\n          if (!task?.id) return null;\n          try {\n            const assignments = await getTaskAssignments(task.id);\n            return { task, assignments: Array.isArray(assignments) ? assignments : [] };\n          } catch (error: unknown) {\n            if (import.meta.env.DEV) {\n              console.error(`Error fetching assignments for task ${task.id}:`, error);\n            }\n            return { task, assignments: [] };\n          }\n        })\n      );\n\n      // Promise.allSettled sonularn ile\n      const validTasksWithAssignments = tasksWithAssignments\n        .filter((result): result is PromiseFulfilledResult<{ task: FirebaseTask; assignments: FirebaseTaskAssignment[] } | null> =>\n          result.status === 'fulfilled' && result.value !== null\n        )\n        .map(result => result.value as { task: FirebaseTask; assignments: FirebaseTaskAssignment[] });\n\n      // UI formatna evir\n      const incomingTasks = validTasksWithAssignments.map(({ task, assignments }) =>\n        convertFirebaseTaskToUITask(task, Array.isArray(assignments) ? assignments : [], Array.isArray(allUsers) ? allUsers : [])\n      );\n\n      // Eer 'type=general' ise, sadece \"general\" projesine ait grevleri gster\n      // (projectId null veya undefined olan grevler dahil edilmemeli)\n      let filteredIncomingTasks = taskTypeFromUrl === 'general'\n        ? incomingTasks.filter(t => t.projectId === \"general\" && t.projectId !== null && t.projectId !== undefined)\n        : incomingTasks;\n\n      // KRTK: Eer bir proje detay sayfasndaysak, sadece o projeye ait grevleri gster\n      // Bu filtreleme en bata yaplmal, dier filtrelemelerden nce\n      if (projectId) {\n        const currentProject = projectsMap.get(projectId);\n        filteredIncomingTasks = filteredIncomingTasks.filter((task) => {\n          // projectId kesin olarak elemeli, null veya undefined olmamal\n          if (!task.projectId || task.projectId !== projectId) {\n            return false;\n          }\n\n          // KRTK: \"general\" projesine ait grevler hibir projede grnmemeli (sadece \"Genel Grevler\" sayfasnda)\n          if (task.projectId === \"general\") {\n            return false; // \"general\" projesine ait grevler proje detay sayfalarnda grnmemeli\n          }\n\n          // KRTK: Gizli projeler iin sadece gizli grevler grnmeli\n          // Bu kontrol burada yapmalyz, nk gizli olmayan grevler gizli projeye atanm olsa bile grnmemeli\n          if (currentProject?.isPrivate) {\n            const firebaseTask = allFirebaseTasks.find((t) => t.id === task.id);\n            // Gizli projede sadece gizli grevler grnmeli\n            if (!firebaseTask?.isPrivate) {\n              return false; // Gizli olmayan grevler gizli projede grnmemeli\n            }\n          }\n\n          return true;\n        });\n      }\n\n      // KRTK: Eer 'type=general' ise, visibleTasks filtresinde de kontrol yaplmal\n      // nk baz grevler yukardaki filtrelemelerden gemi olabilir ama hala \"general\" projesine ait olmayabilir\n\n      // Arivlenmi grevleri ayr\n      // KRTK: Eer bir proje detay sayfasndaysak veya \"Genel Grevler\" sayfasndaysak, \n      // arivlenmi grevler de o filtreye gre filtrelenmeli\n      const archived = filteredIncomingTasks.filter((task) => {\n        const firebaseTask = allFirebaseTasks.find((t) => t.id === task.id);\n        if (firebaseTask?.isArchived !== true) {\n          return false;\n        }\n\n        // Eer bir proje detay sayfasndaysak, sadece o projeye ait arivlenmi grevleri gster\n        if (projectId) {\n          if (!task.projectId || task.projectId !== projectId) {\n            return false;\n          }\n          // \"general\" projesine ait grevler proje detay sayfalarnda grnmemeli\n          if (task.projectId === \"general\") {\n            return false;\n          }\n        }\n\n        // Eer \"Genel Grevler\" sayfasndaysak, sadece \"general\" projesine ait arivlenmi grevleri gster\n        if (taskTypeFromUrl === 'general') {\n          if (task.projectId !== \"general\") {\n            return false;\n          }\n        }\n\n        return true;\n      });\n      setArchivedTasks(archived);\n\n      // Arivlenmemi grevleri gster\n      const active = filteredIncomingTasks.filter((task) => {\n        const firebaseTask = allFirebaseTasks.find((t) => t.id === task.id);\n        return firebaseTask?.isArchived !== true;\n      });\n\n      // \"Tm Grevler\" sekmesi iin: Gizli grevleri ve onlyInMyTasks grevlerini tamamen filtrele\n      // Eer bir proje detay sayfasndaysak (projectId varsa), sadece o projeye ait grevleri gster\n      // Eer \"Tm Grevler\" sekmesindeysek (projectId yoksa), gizli olmayan grevleri gster\n      // Eer \"Genel Grevler\" sayfasndaysak (taskTypeFromUrl === 'general'), sadece \"general\" projesine ait grevleri gster\n      const visibleTasks = active.filter((task) => {\n        const firebaseTask = allFirebaseTasks.find((t) => t.id === task.id);\n\n        // onlyInMyTasks grevleri \"Tm Grevler\" sekmesinde ve proje detay sayfasnda grnmez\n        if (firebaseTask?.onlyInMyTasks) {\n          return false;\n        }\n\n        // KRTK: \"Genel Grevler\" sayfas kontrol\n        // Eer 'type=general' ise, sadece \"general\" projesine ait grevler gsterilmeli\n        if (taskTypeFromUrl === 'general') {\n          // Sadece \"general\" projesine ait grevler gsterilmeli\n          if (task.projectId !== \"general\" || !task.projectId) {\n            return false;\n          }\n          // Gizli grevler \"Genel Grevler\" sayfasnda gzkmemeli\n          if (firebaseTask?.isPrivate) {\n            return false;\n          }\n          return true;\n        }\n\n        // Eer bir proje detay sayfasndaysak, sadece o projeye ait grevleri gster\n        // NOT: Bu filtreleme zaten yukarda yapld ama ekstra gvenlik iin burada da kontrol ediyoruz\n        if (projectId) {\n          // KRTK: Grevin bu projeye ait olup olmadn kesin olarak kontrol et\n          // projectId null, undefined veya farkl bir deer ise gsterilmemeli\n          if (!task.projectId || task.projectId !== projectId) {\n            return false;\n          }\n\n          // KRTK: \"general\" projesine ait grevler hibir projede grnmemeli (sadece \"Genel Grevler\" sayfasnda)\n          if (task.projectId === \"general\") {\n            return false; // \"general\" projesine ait grevler proje detay sayfalarnda grnmemeli\n          }\n\n          // Gizli projeler iin: Sadece gizli grevler grnmeli\n          const currentProject = projectsMap.get(projectId);\n          if (currentProject?.isPrivate) {\n            // Gizli projede sadece gizli grevler grnmeli\n            if (!firebaseTask?.isPrivate) {\n              return false; // Gizli olmayan grevler gizli projede grnmemeli\n            }\n          }\n\n          // Normal projelerde: Grev bu projeye ait\n          return true;\n        }\n\n        // \"Tm Grevler\" sekmesi: Gizli grevler hi gzkmemeli\n        if (firebaseTask?.isPrivate) {\n          return false; // Gizli grevler \"Tm Grevler\" sekmesinde gzkmemeli\n        }\n\n        // Gizli olmayan grevler \"Tm Grevler\" sekmesinde gzkmeli\n        return true;\n      });\n\n      // KURAL: Her grev sadece kendi bulunduu projenin ierisinde ve \"Tm Grevler\" sekmesinde gzkmeli\n      // Gizli grevler sadece kendi projelerinde gzkmeli, \"Tm Grevler\" sekmesinde gzkmemeli\n      // Eer bir proje detay sayfasndaysak, allTasks o projeye ait tm grevleri iermeli\n      // Eer \"Genel Grevler\" sayfasndaysak, allTasks bo olmal (nk myTasks kullanlacak)\n      if (taskTypeFromUrl === 'general') {\n        // \"Genel Grevler\" sayfasnda \"Tm Grevler\" sekmesi gsterilmemeli\n        // Bu durumda allTasks bo olmal\n        setAllTasks([]);\n      } else if (projectId) {\n        // Proje detay sayfasnda, o projeye ait tm grevleri allTasks'a ekle\n        // Bu sayede proje detay sayfasnda tm grevler grnebilir\n        const projectTasks = visibleTasks.filter((task) => {\n          // Zaten visibleTasks iinde proje filtresi uygulanm, ama ekstra kontrol\n          return task.projectId === projectId;\n        });\n        setAllTasks(projectTasks);\n      } else {\n        // Normal \"Tm Grevler\" sayfasnda tm grevleri gster\n        setAllTasks(visibleTasks);\n      }\n\n      // KRTK: \"Benim Grevlerim\" sekmesi iin sadece o anki profil tarafndan oluturulan veya o profile atanm grevler\n      // 1. Kullancnn oluturduu grevler\n      // 2. Kullancya atanan ve kabul edilen grevler\n      // 3. onlyInMyTasks flag'li grevler (sadece oluturan grebilir)\n      const myAcceptedTasks: (Task & { assignment: TaskAssignment; assignedUsers?: Profile[] })[] = [];\n      const addedTaskIds = new Set<string>(); // Duplicate'leri nlemek iin\n\n      for (const { task, assignments } of validTasksWithAssignments) {\n        // Arivlenmi grevleri atla\n        if (task.isArchived) {\n          continue;\n        }\n\n        // KRTK: Eer bir proje detay sayfasndaysak, sadece o projeye ait grevleri dahil et\n        if (projectId) {\n          if (!task.projectId || task.projectId !== projectId) {\n            continue; // Bu projeye ait deilse atla\n          }\n          // \"general\" projesine ait grevler proje detay sayfalarnda grnmemeli\n          if (task.projectId === \"general\") {\n            continue;\n          }\n        }\n\n        // KRTK: Eer \"Genel Grevler\" sayfasndaysak, sadece \"general\" projesine ait grevleri dahil et\n        if (taskTypeFromUrl === 'general') {\n          if (task.projectId !== \"general\") {\n            continue; // \"general\" projesine ait deilse atla\n          }\n          // Gizli grevler \"Genel Grevler\" sayfasnda grnmemeli\n          if (task.isPrivate) {\n            continue;\n          }\n        }\n\n        // Zaten eklenmi grevleri atla (duplicate kontrol)\n        if (addedTaskIds.has(task.id)) {\n          continue;\n        }\n\n        // 1. Kullancnn oluturduu grevler (oluturan kii her zaman grebilir)\n        if (task.createdBy === user.id) {\n          const uiTask = convertFirebaseTaskToUITask(task, assignments, allUsers);\n\n          // Eer kullancya atanm bir assignment varsa onu kullan, yoksa oluturan olarak ekle\n          const userAssignment = assignments.find(\n            (a) => a.assignedTo === user.id && a.status === \"accepted\"\n          );\n\n          if (userAssignment) {\n            // Kullancya atanm ve kabul edilmi\n            myAcceptedTasks.push({\n              ...uiTask,\n              assignment: {\n                id: userAssignment.id,\n                task_id: userAssignment.taskId,\n                assigned_to: userAssignment.assignedTo,\n                assigned_at: userAssignment.assignedAt instanceof Timestamp\n                  ? userAssignment.assignedAt.toDate().toISOString()\n                  : new Date(userAssignment.assignedAt).toISOString(),\n                accepted_at: userAssignment.acceptedAt instanceof Timestamp\n                  ? userAssignment.acceptedAt.toDate().toISOString()\n                  : userAssignment.acceptedAt\n                    ? new Date(userAssignment.acceptedAt).toISOString()\n                    : null,\n                completed_at: userAssignment.completedAt instanceof Timestamp\n                  ? userAssignment.completedAt.toDate().toISOString()\n                  : userAssignment.completedAt\n                    ? new Date(userAssignment.completedAt).toISOString()\n                    : null,\n                rejected_at: undefined,\n                rejection_reason: userAssignment.rejectionReason || null,\n              },\n            });\n          } else {\n            // Sadece oluturan, atanmam\n            myAcceptedTasks.push({\n              ...uiTask,\n              assignment: {\n                id: \"\",\n                task_id: task.id,\n                assigned_to: user.id,\n                assigned_at: task.createdAt instanceof Timestamp\n                  ? task.createdAt.toDate().toISOString()\n                  : new Date(task.createdAt).toISOString(),\n                accepted_at: task.createdAt instanceof Timestamp\n                  ? task.createdAt.toDate().toISOString()\n                  : new Date(task.createdAt).toISOString(),\n                completed_at: null,\n                rejected_at: undefined,\n                rejection_reason: null,\n              },\n            });\n          }\n\n          addedTaskIds.add(task.id);\n          continue;\n        }\n\n        // 2. Sadece benim grevlerim flag'ine sahip grevleri ekle (sadece oluturan grebilir)\n        // NEML: onlyInMyTasks flag'li grevler sadece oluturan kiiye gsterilmeli\n        if (task.onlyInMyTasks) {\n          // Sadece oluturan kii grebilir (yukarda zaten kontrol edildi ama ekstra gvenlik)\n          if (task.createdBy === user.id) {\n            const uiTask = convertFirebaseTaskToUITask(task, assignments, allUsers);\n            myAcceptedTasks.push({\n              ...uiTask,\n              assignment: {\n                id: \"\",\n                task_id: task.id,\n                assigned_to: user.id,\n                assigned_at: task.createdAt instanceof Timestamp\n                  ? task.createdAt.toDate().toISOString()\n                  : new Date(task.createdAt).toISOString(),\n                accepted_at: task.createdAt instanceof Timestamp\n                  ? task.createdAt.toDate().toISOString()\n                  : new Date(task.createdAt).toISOString(),\n                completed_at: null,\n                rejected_at: undefined,\n                rejection_reason: null,\n              },\n            });\n            addedTaskIds.add(task.id);\n          }\n          // onlyInMyTasks flag'li grevler iin devam et (baka kontrol yapma)\n          continue;\n        }\n\n        // 3. Kullancya atanan ve kabul edilen grevleri bul\n        // NEML: Sadece kabul edilen (accepted) grevler \"Benim Grevlerim\" sekmesinde gsterilmeli\n        const userAssignment = assignments.find(\n          (a) => a.assignedTo === user.id && a.status === \"accepted\"\n        );\n\n        if (userAssignment) {\n          const uiTask = convertFirebaseTaskToUITask(task, assignments, allUsers);\n          myAcceptedTasks.push({\n            ...uiTask,\n            assignment: {\n              id: userAssignment.id,\n              task_id: userAssignment.taskId,\n              assigned_to: userAssignment.assignedTo,\n              assigned_at: userAssignment.assignedAt instanceof Timestamp\n                ? userAssignment.assignedAt.toDate().toISOString()\n                : new Date(userAssignment.assignedAt).toISOString(),\n              accepted_at: userAssignment.acceptedAt instanceof Timestamp\n                ? userAssignment.acceptedAt.toDate().toISOString()\n                : userAssignment.acceptedAt\n                  ? new Date(userAssignment.acceptedAt).toISOString()\n                  : null,\n              completed_at: userAssignment.completedAt instanceof Timestamp\n                ? userAssignment.completedAt.toDate().toISOString()\n                : userAssignment.completedAt\n                  ? new Date(userAssignment.completedAt).toISOString()\n                  : null,\n              rejected_at: undefined,\n              rejection_reason: userAssignment.rejectionReason || null,\n            },\n          });\n          addedTaskIds.add(task.id);\n        }\n      }\n\n      setMyTasks(myAcceptedTasks);\n\n      // Oluturduum grevler - BO (artk gsterilmiyor, sadece proje altnda ve \"Tm Grevler\" sekmesinde gzkyor)\n      setCreatedTasks([]);\n    } catch (error: unknown) {\n      if (import.meta.env.DEV) {\n        console.error(\"Fetch tasks error:\", error);\n      }\n      const errorMessage = error instanceof Error ? error.message : String(error) || \"Grevler yklenirken hata olutu\";\n      setError(errorMessage);\n      setLoading(false);\n\n      // Offline durumu kontrol\n      const isOffline = !navigator.onLine;\n      if (isOffline) {\n        toast.error(\"nternet balantnz yok. Ltfen balantnz kontrol edin.\", {\n          action: {\n            label: \"Cache'den Gster\",\n            onClick: () => {\n              // Cache'den grevleri gster (zaten allTasks state'inde var)\n              toast.info(\"Cache'den grevler gsteriliyor\");\n            }\n          },\n          duration: 5000,\n        });\n      } else {\n        toast.error(errorMessage, {\n          action: {\n            label: \"Tekrar Dene\",\n            onClick: () => {\n              setError(null);\n              fetchTasks();\n            }\n          },\n          duration: 5000,\n        });\n      }\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleDeleteTask = async (taskId: string) => {\n    if (!taskId || taskId.trim() === \"\") {\n      toast.error(\"Geersiz grev ID\");\n      return;\n    }\n    if (!user?.id) {\n      toast.error(\"Kullanc bilgisi bulunamad\");\n      return;\n    }\n    setDeletingId(taskId);\n    try {\n      await deleteTask(taskId, user.id);\n      toast.success(\"Grev baaryla silindi\");\n      // Real-time subscribe otomatik gncelleyecek\n    } catch (error: unknown) {\n      if (import.meta.env.DEV) {\n        console.error(\"Delete task error:\", error);\n      }\n      const errorMessage = error instanceof Error ? error.message : String(error);\n      toast.error(errorMessage || \"Grev silinirken hata olutu\", {\n        action: {\n          label: \"Tekrar Dene\",\n          onClick: () => handleDeleteTask(taskId),\n        },\n      });\n    } finally {\n      setDeletingId(null);\n    }\n  };\n\n  const handleCreateProject = async () => {\n    if (!newProjectName.trim()) {\n      toast.error(\"Proje ad gereklidir\");\n      return;\n    }\n    if (!user?.id) {\n      toast.error(\"Kullanc bilgisi bulunamad\");\n      return;\n    }\n    try {\n      await createProject({\n        name: newProjectName.trim(),\n        description: newProjectDescription.trim() || null,\n        status: \"active\",\n        isPrivate: false,\n        createdBy: user.id,\n      });\n      toast.success(\"Proje oluturuldu\");\n      setCreateProjectDialogOpen(false);\n      setNewProjectName(\"\");\n      setNewProjectDescription(\"\");\n      // Projeleri yeniden ykle\n      const projects = await getProjects({ status: \"active\" });\n      setFilterableProjects(projects);\n    } catch (error: unknown) {\n      if (import.meta.env.DEV) {\n        console.error(\"Create project error:\", error);\n      }\n      const errorMessage = error instanceof Error ? error.message : String(error);\n      toast.error(errorMessage || \"Proje oluturulurken hata olutu\");\n    }\n  };\n\n  const handleDeleteProject = async () => {\n    if (!projectToDelete || !user?.id) return;\n\n    // Proje ID kontrol\n    if (!projectToDelete.id || projectToDelete.id.trim() === \"\") {\n      toast.error(\"Proje ID'si geersiz\");\n      setDeleteProjectDialogOpen(false);\n      setProjectToDelete(null);\n      return;\n    }\n\n    try {\n      await deleteProject(projectToDelete.id, user.id);\n      toast.success(\"Proje silindi\");\n      setDeleteProjectDialogOpen(false);\n      setProjectToDelete(null);\n      // Eer silinen proje seiliyse, \"Tm Projeler\"e ge\n      if (selectedProject === projectToDelete.id) {\n        setSelectedProject(\"all\");\n        setProjectFilter(\"all\");\n      }\n      // Projeleri yeniden ykle\n      const projects = await getProjects({ status: \"active\" });\n      setFilterableProjects(projects);\n    } catch (error: unknown) {\n      if (import.meta.env.DEV) {\n        console.error(\"Delete project error:\", error);\n      }\n      const errorMessage = error instanceof Error ? error.message : String(error);\n\n      // Eer proje zaten silinmise, sessizce devam et\n      if (errorMessage.includes(\"Proje bulunamad\") || errorMessage.includes(\"zaten silinmi\")) {\n        toast.success(\"Proje silindi\");\n        setDeleteProjectDialogOpen(false);\n        setProjectToDelete(null);\n        // Projeleri yeniden ykle\n        const projects = await getProjects({ status: \"active\" });\n        setFilterableProjects(projects);\n        return;\n      }\n\n      toast.error(errorMessage || \"Proje silinirken hata olutu\");\n    }\n  };\n\n  const handleArchiveTask = async (taskId: string) => {\n    if (!user?.id) {\n      toast.error(\"Kullanc bilgisi bulunamad\");\n      return;\n    }\n    if (!taskId || taskId.trim() === \"\") {\n      toast.error(\"Geersiz grev ID\");\n      return;\n    }\n    try {\n      await archiveTask(taskId, user.id);\n      toast.success(\"Grev arivlendi\");\n      // Real-time subscribe otomatik gncelleyecek\n    } catch (error: unknown) {\n      if (import.meta.env.DEV) {\n        console.error(\"Archive task error:\", error);\n      }\n      toast.error(error instanceof Error ? error.message : \"Grev arivlenirken hata olutu\", {\n        action: {\n          label: \"Tekrar Dene\",\n          onClick: () => handleArchiveTask(taskId),\n        },\n      });\n    }\n  };\n\n  const handleRejectTask = async () => {\n    if (!rejectingAssignment || !rejectionReason.trim() || rejectionReason.trim().length < 20) {\n      toast.error(\"Reddetme sebebi en az 20 karakter olmaldr\");\n      return;\n    }\n\n    setRejecting(true);\n    try {\n      // Task ID'yi assignment'tan al\n      const taskId = rejectingAssignment.task_id;\n      await rejectTaskAssignment(taskId, rejectingAssignment.id, rejectionReason.trim());\n      toast.success(\"Grev reddedildi\");\n      setRejectDialogOpen(false);\n      setRejectionReason(\"\");\n      setRejectingAssignment(null);\n      // Real-time subscribe otomatik gncelleyecek\n    } catch (error: unknown) {\n      if (import.meta.env.DEV) {\n        console.error(\"Reject task error:\", error);\n      }\n      toast.error(error instanceof Error ? error.message : \"Grev reddedilemedi\");\n    } finally {\n      setRejecting(false);\n    }\n  };\n\n  // Standardize edilmi durum renkleri ve ikonlar\n  const getStatusIcon = (status: string) => {\n    const statusConfig: Record<string, { icon: typeof CheckCircle2; color: string; bgColor: string }> = {\n      pending: {\n        icon: CircleDot,\n        color: \"text-amber-500\",\n        bgColor: \"bg-amber-50 border-amber-200\"\n      },\n      in_progress: {\n        icon: Clock,\n        color: \"text-blue-500\",\n        bgColor: \"bg-blue-50 border-blue-200\"\n      },\n      completed: {\n        icon: CheckCircle2,\n        color: \"text-emerald-600\",\n        bgColor: \"bg-emerald-50 border-emerald-200\"\n      },\n      approved: {\n        icon: CheckCircle2,\n        color: \"text-green-600\",\n        bgColor: \"bg-green-50 border-green-200\"\n      },\n    };\n\n    const config = statusConfig[status] || {\n      icon: AlertCircle,\n      color: \"text-muted-foreground\",\n      bgColor: \"bg-muted border-border\"\n    };\n    const Icon = config.icon;\n\n    return (\n      <div className={cn(\"rounded-full p-1.5 border\", config.bgColor)} aria-label={getStatusLabel(status)}>\n        <Icon className={cn(\"h-3 w-3\", config.color)} />\n      </div>\n    );\n  };\n\n  // Normalize status - remove \"column_\" prefix if present\n  const normalizeStatus = (status: string | undefined | null): string => {\n    if (!status) return \"pending\";\n    // Eer \"column_\" ile balyorsa, bu bir column ID'sidir (saysal olabilir)\n    if (status.startsWith(\"column_\")) {\n      const statusFromColumn = status.replace(\"column_\", \"\");\n      // Geerli status deerlerini kontrol et (pending, in_progress, completed, approved, cancelled)\n      if ([\"pending\", \"in_progress\", \"completed\", \"approved\", \"cancelled\"].includes(statusFromColumn)) {\n        return statusFromColumn === \"cancelled\" ? \"pending\" : statusFromColumn;\n      }\n      // Saysal ID veya geersiz deer ise \"pending\" olarak kabul et\n      return \"pending\";\n    }\n    // Geerli status deerlerini kontrol et\n    if ([\"pending\", \"in_progress\", \"completed\", \"approved\", \"cancelled\"].includes(status)) {\n      return status === \"cancelled\" ? \"pending\" : status;\n    }\n    return \"pending\"; // Fallback\n  };\n\n  const getStatusLabel = (status: string) => {\n    // nce status' normalize et (column_ prefix'ini kaldr)\n    const normalized = normalizeStatus(status);\n    const labels: Record<string, string> = {\n      pending: \"Yaplacak\",\n      in_progress: \"Devam Ediyor\",\n      completed: \"Tamamland\",\n      approved: \"Onayland\",\n    };\n    return labels[normalized] || normalized;\n  };\n\n  // Tarih formatlama fonksiyonu\n  const formatDateSafe = (dateInput?: string | Date | Timestamp | null) => {\n    if (!dateInput) return \"-\";\n    let date: Date;\n    if (dateInput instanceof Timestamp) {\n      date = dateInput.toDate();\n    } else if (dateInput instanceof Date) {\n      date = dateInput;\n    } else {\n      date = new Date(dateInput);\n    }\n    if (Number.isNaN(date.getTime())) return \"-\";\n    return date.toLocaleDateString(\"tr-TR\", { day: \"2-digit\", month: \"short\", year: \"numeric\" });\n  };\n\n  const getPriorityColor = (priority: number) => {\n    if (priority >= 3) return \"text-destructive\";\n    if (priority === 2) return \"text-warning\";\n    return \"text-muted-foreground\";\n  };\n\n  const isTaskOverdue = (task: Task | FirebaseTask) => {\n    const dueDate = 'due_date' in task && task.due_date\n      ? new Date(task.due_date)\n      : ('dueDate' in task && task.dueDate\n        ? (task.dueDate instanceof Timestamp ? task.dueDate.toDate() : new Date(task.dueDate))\n        : null);\n    if (!dueDate) return false;\n    return isBefore(dueDate, new Date()) && task.status !== \"completed\";\n  };\n\n  const isTaskDueSoon = (task: Task | FirebaseTask) => {\n    const dueDate = 'due_date' in task && task.due_date\n      ? new Date(task.due_date)\n      : ('dueDate' in task && task.dueDate\n        ? (task.dueDate instanceof Timestamp ? task.dueDate.toDate() : new Date(task.dueDate))\n        : null);\n    if (!dueDate) return false;\n    const today = startOfDay(new Date());\n    const threeDaysAfter = addDays(today, 3);\n    return (\n      !isTaskOverdue(task) &&\n      (isAfter(dueDate, today) || dueDate.getTime() === today.getTime()) &&\n      isBefore(dueDate, threeDaysAfter) &&\n      task.status !== \"completed\"\n    );\n  };\n\n  const formatDueDate = (value?: string | null) => {\n    if (!value) return \"-\";\n    try {\n      return new Date(value).toLocaleDateString(\"tr-TR\", {\n        day: \"2-digit\",\n        month: \"short\",\n      });\n    } catch {\n      return value;\n    }\n  };\n\n  // Tablo toplam geniliini hesapla\n  const totalTableWidth = Object.values(columnWidths).reduce((sum, width) => sum + width, 0);\n\n  const getInitials = (name: string) => {\n    return name\n      .split(\" \")\n      .map(n => n[0])\n      .join(\"\")\n      .toUpperCase()\n      .slice(0, 2);\n  };\n\n  // Jira tarz Key format (rn: TASK-123)\n  const formatTaskKey = (taskId: string) => {\n    // ID'nin son 6 karakterini al ve byk harfe evir\n    const shortId = taskId.slice(-6).toUpperCase();\n    return `TASK-${shortId}`;\n  };\n\n  // ncelik gsterimi iin helper - Eski sistem (1-5) varsa yeni sisteme (0-5) evir\n  const getPriorityDisplay = (priority: number | undefined) => {\n    if (!priority) {\n      const option = getPriorityOption(0);\n      return { label: option.label, icon: ChevronDown, color: option.color };\n    }\n    // Eski sistem (1-5) varsa yeni sisteme (0-5) evir\n    const newPriority = convertOldPriorityToNew(priority);\n    const option = getPriorityOption(newPriority);\n    // Icon seimi: 0-1 = down, 2-3 = minus, 4-5 = up\n    const icon = newPriority <= 1 ? ChevronDown : newPriority <= 3 ? Minus : ChevronUp;\n    return { label: option.label, icon, color: option.color };\n  };\n\n  const filterTasks = (tasks: (Task | FirebaseTask)[]) => {\n    if (!Array.isArray(tasks)) {\n      return [];\n    }\n    return tasks.filter(task => {\n      if (!task) return false;\n\n      // Silinmi grevleri filtrele: allFirebaseTasks iinde olmayan grevler silinmi demektir\n      if (Array.isArray(allFirebaseTasks) && allFirebaseTasks.length > 0) {\n        const firebaseTaskIds = new Set(allFirebaseTasks.map(t => t?.id).filter((id): id is string => !!id));\n        if (!firebaseTaskIds.has(task.id)) {\n          return false; // Silinmi grev\n        }\n      }\n\n      const searchLower = (searchTerm || \"\").toLocaleLowerCase('tr-TR');\n      const taskTitle = (task.title || \"\").toLocaleLowerCase('tr-TR');\n      const taskDesc = (task.description || \"\").toLocaleLowerCase('tr-TR');\n\n      const matchesSearch = !searchTerm || searchTerm.trim() === \"\" || taskTitle.includes(searchLower) || taskDesc.includes(searchLower);\n\n      // Status filtresi: cancelled grevler \"approved\" kolonunda gsterildii iin zel kontrol\n      let matchesStatus = statusFilter === \"all\" || task.status === statusFilter;\n      if (statusFilter === \"approved\") {\n        // \"approved\" filtresi seildiinde, hem approved hem cancelled grevleri gster\n        matchesStatus = task.status === \"approved\" || task.status === \"cancelled\" ||\n          (task.status === \"completed\" && (task as any).approvalStatus === \"approved\");\n      } else if (statusFilter !== \"all\") {\n        // Dier filtreler iin normal kontrol\n        matchesStatus = task.status === statusFilter;\n      }\n\n      const matchesFocus = (\n        focusFilter === \"all\" ||\n        (focusFilter === \"due_soon\" && isTaskDueSoon(task)) ||\n        (focusFilter === \"overdue\" && isTaskOverdue(task)) ||\n        (focusFilter === \"high_priority\" && (() => {\n          const taskPriority = task.priority || 0;\n          // Eski sistem (1-5) varsa yeni sisteme (0-5) evir\n          const newPriority = convertOldPriorityToNew(taskPriority);\n          // Yksek ncelik: 3 (Yksek) ve zeri\n          return newPriority >= 3;\n        })())\n      );\n\n      // Proje filtresi - selectedProject state'ine gre\n      let matchesProject = true;\n      if (selectedProject === \"all\") {\n        matchesProject = true;\n      } else if (selectedProject === \"general\") {\n        matchesProject = task.projectId === \"general\" || !task.projectId;\n      } else {\n        matchesProject = task.projectId === selectedProject;\n      }\n\n      // Kii filtresi - atanan kiilere gre\n      let matchesAssignedUser = true;\n      if (assignedUserFilter !== \"all\") {\n        const taskAssignments = assignmentsCacheRef.current.get(task.id) || [];\n        const assignedUserIds = taskAssignments.map(a => a.assignedTo);\n        matchesAssignedUser = assignedUserIds.includes(assignedUserFilter);\n      }\n\n      // activeFilter kontrolleri kaldrld nk:\n      // - pool, archive, my-tasks filtreleri zaten tasksForStatsAndDisplay iinde uygulanm\n      // - general filtresi zaten selectedProject === \"general\" ile uygulanm\n      // Burada sadece arama, durum, odak, proje ve kii filtrelerini uyguluyoruz\n      // Hem liste hem pano grnmnde ayn filtreler uygulanr\n      return matchesSearch && matchesStatus && matchesFocus && matchesProject && matchesAssignedUser;\n    });\n  };\n\n  const sortTasks = (tasks: (Task | FirebaseTask)[]) => {\n    if (!Array.isArray(tasks)) {\n      return [];\n    }\n    return [...tasks].sort((a, b) => {\n      if (!a || !b) return 0;\n\n      if (sortBy === \"priority\") {\n        const aPriority = a.priority || 0;\n        const bPriority = b.priority || 0;\n        return bPriority - aPriority;\n      }\n      if (sortBy === \"due_date\") {\n        const aDueDate = 'due_date' in a && a.due_date ? a.due_date : ('dueDate' in a && a.dueDate ? (a.dueDate instanceof Timestamp ? a.dueDate.toDate().toISOString() : new Date(a.dueDate).toISOString()) : null);\n        const bDueDate = 'due_date' in b && b.due_date ? b.due_date : ('dueDate' in b && b.dueDate ? (b.dueDate instanceof Timestamp ? b.dueDate.toDate().toISOString() : new Date(b.dueDate).toISOString()) : null);\n        if (!aDueDate) return 1;\n        if (!bDueDate) return -1;\n        const aDate = typeof aDueDate === 'string' ? new Date(aDueDate).getTime() : 0;\n        const bDate = typeof bDueDate === 'string' ? new Date(bDueDate).getTime() : 0;\n        if (isNaN(aDate)) return 1;\n        if (isNaN(bDate)) return -1;\n        return aDate - bDate;\n      }\n      // created_at sralamas\n      const aCreatedVal = 'created_at' in a && a.created_at ? a.created_at : ('createdAt' in a && a.createdAt ? (a.createdAt instanceof Timestamp ? a.createdAt.toDate() : a.createdAt) : null);\n      const bCreatedVal = 'created_at' in b && b.created_at ? b.created_at : ('createdAt' in b && b.createdAt ? (b.createdAt instanceof Timestamp ? b.createdAt.toDate() : b.createdAt) : null);\n      const aCreated = aCreatedVal ? (aCreatedVal instanceof Date ? aCreatedVal.getTime() : (typeof aCreatedVal === 'string' ? new Date(aCreatedVal).getTime() : 0)) : 0;\n      const bCreated = bCreatedVal ? (bCreatedVal instanceof Date ? bCreatedVal.getTime() : (typeof bCreatedVal === 'string' ? new Date(bCreatedVal).getTime() : 0)) : 0;\n      if (isNaN(aCreated)) return 1;\n      if (isNaN(bCreated)) return -1;\n      return bCreated - aCreated;\n    });\n  };\n\n  // statistiklerin baz ald grev setini hesapla (tm grevler ve panoda kullanlacak)\n  // Bu grev seti, istatistiklerin hesapland ve grevlerin gsterildii ayn kaynak olmal\n  const tasksForStatsAndDisplay = useMemo(() => {\n    // Filtre tipine gre grev listesini belirle\n    let tasks: (Task | FirebaseTask)[] = [];\n    if (activeFilter === \"archive\") {\n      tasks = Array.isArray(archivedTasks) ? archivedTasks.filter(t => t) : [];\n    } else if (activeFilter === \"my-tasks\") {\n      // \"Benim Grevlerim\" filtresinde grevleri kullan\n      tasks = (Array.isArray(myTasks) ? myTasks : [])\n        .filter(t => t)\n        .map((task) => {\n          if (!task) return null;\n          const taskWithAssignment = task as Task & { assignment?: TaskAssignment; assignedUsers?: Profile[] };\n          const { assignment, ...taskWithoutAssignment } = taskWithAssignment;\n          return taskWithoutAssignment;\n        })\n        .filter((t): t is Task & { assignedUsers?: Profile[] } => t !== null);\n    } else if (activeFilter === \"pool\") {\n      // Grev havuzunda sadece isInPool=true olan grevler\n      tasks = (Array.isArray(allTasks) ? allTasks : [])\n        .filter(task => {\n          if (!task?.id) return false;\n          const firebaseTask = (Array.isArray(allFirebaseTasks) ? allFirebaseTasks : []).find(t => t?.id === task.id);\n          return firebaseTask?.isInPool === true && !firebaseTask?.onlyInMyTasks;\n        });\n    } else {\n      // all veya general\n      tasks = Array.isArray(allTasks) ? allTasks.filter(t => t) : [];\n    }\n\n    // Silinmi grevleri filtrele: allFirebaseTasks iinde olmayan grevler silinmi demektir\n    // Firebase'de deleteDoc ile silinen grevler Firestore'dan kaldrlyor, bu yzden allFirebaseTasks'ta olmayan grevler silinmi demektir\n    // allFirebaseTasks yklenmise, silinmi grevleri kesinlikle filtrele\n    if (Array.isArray(allFirebaseTasks) && allFirebaseTasks.length > 0) {\n      const firebaseTaskIds = new Set(allFirebaseTasks.map(t => t?.id).filter((id): id is string => !!id));\n      tasks = tasks.filter((task: FirebaseTask) => {\n        if (!task?.id) return false;\n        // Eer grev allFirebaseTasks iinde yoksa, silinmi demektir - kesinlikle filtrele\n        return firebaseTaskIds.has(task.id);\n      });\n    }\n    // allFirebaseTasks bosa (henz yklenmemi), grevleri olduu gibi brak\n    // nk henz yklenmedii iin silinmi grevleri filtreleyemeyiz\n    // Ama filterTasks iinde de kontrol yaplyor, bu yzden ift kontrol var\n\n    // Arivlenmi grevleri filtrele (archive filtresi aktif deilse)\n    if (activeFilter !== \"archive\") {\n      tasks = tasks.filter((task: FirebaseTask) => task && !task.isArchived && !('is_archived' in task && task.is_archived));\n    }\n\n    // Proje filtresi uygula (selectedProject state'ine gre)\n    if (selectedProject && selectedProject !== \"all\") {\n      if (selectedProject === \"general\") {\n        tasks = tasks.filter((task: FirebaseTask) => task && (task.projectId === \"general\" || !task.projectId));\n      } else {\n        tasks = tasks.filter((task: FirebaseTask) => task && task.projectId === selectedProject);\n      }\n    }\n\n    return tasks;\n  }, [allTasks, myTasks, archivedTasks, activeFilter, allFirebaseTasks, selectedProject]);\n\n  const filteredAndSortedMyTasks = useMemo(() => {\n    // statistiklerin baz ald grev setini kullan (tasksForStatsAndDisplay)\n    // Ama sadece \"Benim Grevlerim\" filtresi iin\n    if (activeFilter !== \"my-tasks\") {\n      return [];\n    }\n\n    // statistiklerin kulland filtrelemeyi koru, sadece ek filtreleri uygula (arama, durum, odak, proje, kii)\n    // Hem liste hem pano grnmnde ayn filtreleri ve sralamay uygula\n    const filtered = filterTasks(tasksForStatsAndDisplay);\n    return sortTasks(filtered);\n  }, [tasksForStatsAndDisplay, searchTerm, statusFilter, focusFilter, sortBy, activeFilter, selectedProject, assignedUserFilter, allFirebaseTasks]);\n\n  const filteredAndSortedAllTasks = useMemo(() => {\n    // statistiklerin baz ald grev setini kullan (tasksForStatsAndDisplay)\n    // \"Tm Grevler\" sekmesi veya proje detay sayfas iin\n    if (activeFilter === \"my-tasks\" || activeFilter === \"archive\") {\n      return [];\n    }\n\n    // statistiklerin kulland filtrelemeyi koru, sadece ek filtreleri uygula (arama, durum, odak, proje, kii)\n    // Hem liste hem pano grnmnde ayn filtreleri ve sralamay uygula\n    const filtered = filterTasks(tasksForStatsAndDisplay);\n    return sortTasks(filtered) as (Task | FirebaseTask)[];\n  }, [tasksForStatsAndDisplay, searchTerm, statusFilter, focusFilter, sortBy, activeFilter, selectedProject, assignedUserFilter, allFirebaseTasks]);\n\n  // Arivlenmi grevler iin filtrelenmi ve sralanm liste\n  const filteredAndSortedArchivedTasks = useMemo(() => {\n    if (activeFilter !== \"archive\") {\n      return [];\n    }\n    // statistiklerin baz ald grev setini kullan (tasksForStatsAndDisplay)\n    // Hem liste hem pano grnmnde ayn filtreleri ve sralamay uygula\n    const filtered = filterTasks(tasksForStatsAndDisplay);\n    return sortTasks(filtered) as (Task | FirebaseTask)[];\n  }, [tasksForStatsAndDisplay, searchTerm, statusFilter, focusFilter, sortBy, activeFilter, selectedProject, assignedUserFilter, allFirebaseTasks]);\n\n  // Sralama fonksiyonu\n  const handleSort = (column: string) => {\n    if (sortColumn === column) {\n      // Ayn kolona tklandnda yn deitir\n      setSortDirection(sortDirection === \"asc\" ? \"desc\" : \"asc\");\n    } else {\n      // Yeni kolona tklandnda varsaylan olarak desc\n      setSortColumn(column);\n      setSortDirection(\"desc\");\n    }\n  };\n\n  // Sralama uygulama fonksiyonu\n  const applySorting = (data: (Task | FirebaseTask)[]): (Task | FirebaseTask)[] => {\n    if (!sortColumn) return data;\n\n    const sorted = [...data].sort((a, b) => {\n      let aValue: any;\n      let bValue: any;\n\n      switch (sortColumn) {\n        case \"key\":\n          aValue = a.id;\n          bValue = b.id;\n          break;\n        case \"title\":\n          aValue = (a.title || \"\").toLowerCase();\n          bValue = (b.title || \"\").toLowerCase();\n          break;\n        case \"status\":\n          aValue = normalizeStatus(a.status || \"pending\");\n          bValue = normalizeStatus(b.status || \"pending\");\n          break;\n        case \"priority\":\n          aValue = a.priority || 0;\n          bValue = b.priority || 0;\n          break;\n        case \"dueDate\":\n          const aDue = (a as any).dueDate || (a as any).due_date;\n          const bDue = (b as any).dueDate || (b as any).due_date;\n          aValue = aDue ? (aDue instanceof Timestamp ? aDue.toDate().getTime() : new Date(aDue).getTime()) : 0;\n          bValue = bDue ? (bDue instanceof Timestamp ? bDue.toDate().getTime() : new Date(bDue).getTime()) : 0;\n          break;\n        case \"createdAt\":\n          const aCreated = (a as any).createdAt || (a as any).created_at;\n          const bCreated = (b as any).createdAt || (b as any).created_at;\n          aValue = aCreated ? (aCreated instanceof Timestamp ? aCreated.toDate().getTime() : new Date(aCreated).getTime()) : 0;\n          bValue = bCreated ? (bCreated instanceof Timestamp ? bCreated.toDate().getTime() : new Date(bCreated).getTime()) : 0;\n          break;\n        default:\n          return 0;\n      }\n\n      if (aValue < bValue) return sortDirection === \"asc\" ? -1 : 1;\n      if (aValue > bValue) return sortDirection === \"asc\" ? 1 : -1;\n      return 0;\n    });\n\n    return sorted;\n  };\n\n  // Filtre tipine gre grev listesini belirle\n  const listData = useMemo(() => {\n    let data: (Task | FirebaseTask)[] = [];\n    if (activeFilter === \"my-tasks\") {\n      data = filteredAndSortedMyTasks;\n    } else if (activeFilter === \"archive\") {\n      data = filteredAndSortedArchivedTasks;\n    } else {\n      // all, general, pool iin filteredAndSortedAllTasks kullan\n      data = filteredAndSortedAllTasks;\n    }\n\n    // Son bir kontrol: Silinmi grevleri kesinlikle filtrele\n    if (Array.isArray(allFirebaseTasks) && allFirebaseTasks.length > 0) {\n      const firebaseTaskIds = new Set(allFirebaseTasks.map(t => t?.id).filter((id): id is string => !!id));\n      data = data.filter((task: Task | FirebaseTask) => {\n        if (!task || typeof task !== 'object' || !('id' in task)) return false;\n        return firebaseTaskIds.has(task.id as string);\n      });\n    }\n\n    // Sralama uygula\n    data = applySorting(data);\n\n    return data;\n  }, [activeFilter, filteredAndSortedMyTasks, filteredAndSortedAllTasks, filteredAndSortedArchivedTasks, allFirebaseTasks, sortColumn, sortDirection]);\n\n  // Yorum saylarn lazy load et (grnen grevler iin) - listData tanmndan sonra\n  useEffect(() => {\n    if (!listData || listData.length === 0) return;\n\n    const loadCommentCounts = async () => {\n      const visibleTasks = listData.slice(0, visibleItemsCount);\n      const tasksToLoad = visibleTasks.filter((task) => !commentCounts.has(task.id));\n\n      if (tasksToLoad.length === 0) return;\n\n      // Batch olarak ykle (10'ar 10'ar)\n      const batchSize = 10;\n      for (let i = 0; i < tasksToLoad.length; i += batchSize) {\n        const batch = tasksToLoad.slice(i, i + batchSize);\n        const counts = await Promise.all(\n          batch.map(async (task) => {\n            try {\n              const comments = await getTaskComments(task.id);\n              return { taskId: task.id, count: Array.isArray(comments) ? comments.length : 0 };\n            } catch {\n              return { taskId: task.id, count: 0 };\n            }\n          })\n        );\n\n        setCommentCounts(prev => {\n          const newMap = new Map(prev);\n          counts.forEach(({ taskId, count }) => {\n            newMap.set(taskId, count);\n          });\n          return newMap;\n        });\n      }\n    };\n\n    loadCommentCounts();\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [listData, visibleItemsCount]);\n\n  // Silme yetkilerini lazy load et (grnen grevler iin)\n  const [taskDeletePermissions, setTaskDeletePermissions] = useState<Map<string, boolean>>(new Map());\n  useEffect(() => {\n    if (!listData || listData.length === 0 || !user) return;\n\n    const loadDeletePermissions = async () => {\n      const visibleTasks = listData.slice(0, visibleItemsCount);\n      const tasksToLoad = visibleTasks.filter((task) => !taskDeletePermissions.has(task.id));\n\n      if (tasksToLoad.length === 0) return;\n\n      const userProfile: UserProfile = {\n        id: user.id,\n        email: user.email,\n        emailVerified: user.emailVerified,\n        fullName: user.fullName,\n        displayName: user.fullName,\n        phone: user.phone,\n        dateOfBirth: user.dateOfBirth,\n        role: user.roles || [],\n        createdAt: null,\n        updatedAt: null,\n      };\n\n      // Batch olarak ykle (10'ar 10'ar)\n      const batchSize = 10;\n      for (let i = 0; i < tasksToLoad.length; i += batchSize) {\n        const batch = tasksToLoad.slice(i, i + batchSize);\n        const permissions = await Promise.all(\n          batch.map(async (task) => {\n            try {\n              // FirebaseTask' Task tipine cast et (aslnda ayn tip)\n              const canDelete = await canDeleteTask(task as FirebaseTask, userProfile);\n              return { taskId: task.id, canDelete };\n            } catch {\n              return { taskId: task.id, canDelete: false };\n            }\n          })\n        );\n\n        setTaskDeletePermissions(prev => {\n          const newMap = new Map(prev);\n          permissions.forEach(({ taskId, canDelete }) => {\n            newMap.set(taskId, canDelete);\n          });\n          return newMap;\n        });\n      }\n    };\n\n    loadDeletePermissions();\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [listData, visibleItemsCount, user]);\n\n  // Liste deitiinde visible items count'u sfrla (listData tanmndan sonra tand)\n\n  // Grev durumu deiikliklerinde browser notification gnder\n  useEffect(() => {\n    if (notificationPermission === \"granted\" && user && allTasks.length > 0) {\n      allTasks.forEach((task) => {\n        const previousStatus = previousTaskStatusesRef.current.get(task.id);\n        if (previousStatus && previousStatus !== task.status && task.status) {\n          // Durum deiti, bildirim gnder\n          const statusNames: Record<string, string> = {\n            pending: \"Yaplacak\",\n            in_progress: \"Devam Ediyor\",\n            completed: \"Tamamland\",\n          };\n          try {\n            new Notification(\"Grev Durumu Gncellendi\", {\n              body: `${task.title} grevi \"${statusNames[task.status] || task.status}\" durumuna gncellendi`,\n              icon: \"/rev-favicon.png\",\n              tag: `task-${task.id}`,\n              badge: \"/rev-favicon.png\",\n            });\n          } catch (error: unknown) {\n            if (import.meta.env.DEV) {\n              console.error(\"Browser notification error:\", error);\n            }\n          }\n        }\n        previousTaskStatusesRef.current.set(task.id, task.status);\n      });\n    }\n  }, [allTasks, notificationPermission, user]);\n\n  const boardTasks = useMemo(() => {\n    // listData zaten tm filtreleri (arama, durum, odak, proje) ve sralamay uygulam durumda\n    // tasksForStatsAndDisplay iinde zaten allFirebaseTasks ile senkronize edilmi\n    // Direkt olarak listData'y kullan, ek filtreleme yapma - liste ve pano ayn grevleri gstermeli\n\n    if (!Array.isArray(listData) || listData.length === 0) {\n      return [];\n    }\n\n    // Son bir kontrol: Silinmi grevleri kesinlikle filtrele\n    let filteredListData = listData;\n    if (Array.isArray(allFirebaseTasks) && allFirebaseTasks.length > 0) {\n      const firebaseTaskIds = new Set(allFirebaseTasks.map(t => t?.id).filter((id): id is string => !!id));\n      filteredListData = listData.filter((task: FirebaseTask) => {\n        if (!task?.id) return false;\n        return firebaseTaskIds.has(task.id);\n      });\n    }\n\n    // listData zaten filtrelenmi ve sralanm, TaskBoard'un bekledii formata evir\n    // Ek filtreleme yapma - listData zaten doru ekilde filtrelenmi\n    const boardTasksResult = filteredListData\n      .map((task) => {\n        // assignment' kaldr ve TaskBoard formatna evir\n        const taskWithExtras = task as unknown as Task & { assignment?: TaskAssignment; assignedUsers?: Profile[] };\n        const { assignment, assignedUsers, ...taskWithoutAssignment } = taskWithExtras;\n\n        // Firebase task' bul (isInPool ve poolRequests iin)\n        const firebaseTask = Array.isArray(allFirebaseTasks) ? allFirebaseTasks.find(t => t?.id === task.id) : null;\n\n        // TaskBoard'un bekledii formata evir (assignments array'i olutur)\n        const boardTask: { id: string; title: string; status: string; priority: number; dueDate?: string; createdAt: string; assignedUsers?: Array<{ id: string; full_name: string }>; labels?: Array<{ name: string; color: string }>; projectId?: string | null; isInPool?: boolean; poolRequests?: string[]; createdBy?: string } = {\n          id: task.id,\n          title: task.title || \"\",\n          status: task.status || \"pending\",\n          priority: task.priority || 0,\n          dueDate: (() => {\n            const taskObj = task as { due_date?: string; dueDate?: Timestamp | Date | string };\n            if ('due_date' in taskObj && taskObj.due_date && typeof taskObj.due_date === 'string') return taskObj.due_date;\n            if ('dueDate' in taskObj && taskObj.dueDate) {\n              if (taskObj.dueDate instanceof Timestamp) return taskObj.dueDate.toDate().toISOString();\n              if (taskObj.dueDate instanceof Date) return taskObj.dueDate.toISOString();\n              if (typeof taskObj.dueDate === 'string') return taskObj.dueDate;\n            }\n            return undefined;\n          })(),\n          createdAt: (() => {\n            const taskObj = task as { created_at?: string; createdAt?: Timestamp | Date | string };\n            if ('created_at' in taskObj && taskObj.created_at && typeof taskObj.created_at === 'string') return taskObj.created_at;\n            if ('createdAt' in taskObj && taskObj.createdAt) {\n              if (taskObj.createdAt instanceof Timestamp) return taskObj.createdAt.toDate().toISOString();\n              if (taskObj.createdAt instanceof Date) return taskObj.createdAt.toISOString();\n              if (typeof taskObj.createdAt === 'string') return taskObj.createdAt;\n            }\n            return new Date().toISOString();\n          })(),\n          projectId: task.projectId || null,\n          assignedUsers: Array.isArray(assignedUsers) ? assignedUsers\n            .filter((u): u is Profile => {\n              if (!u || typeof u !== 'object') return false;\n              return 'id' in u && 'full_name' in u && typeof (u as { id: unknown; full_name: unknown }).id === 'string' && typeof (u as { id: unknown; full_name: unknown }).full_name === 'string';\n            })\n            .map((u: Profile) => ({\n              id: u.id as string,\n              full_name: u.full_name as string,\n            })) : [],\n          labels: [],\n          // Grev havuzu bilgilerini ekle\n          isInPool: firebaseTask?.isInPool === true,\n          poolRequests: Array.isArray(firebaseTask?.poolRequests) ? firebaseTask.poolRequests : [],\n          // Grevi oluturan kii bilgisini ekle\n          createdBy: firebaseTask?.createdBy || task.createdBy || (task as { created_by?: string }).created_by,\n        };\n\n        return boardTask;\n      });\n\n    return boardTasksResult;\n  }, [listData, allFirebaseTasks]);\n\n  // quickFilters kaldrld - artk kullanlmyor (ncelikli filtre istatistiklerde)\n\n  // Mevcut durumun index'ini bul\n  const getCurrentStatusIndex = (status: string, approvalStatus?: \"pending\" | \"approved\" | \"rejected\") => {\n    // nce status' normalize et (column_ prefix'ini kaldr)\n    const normalized = normalizeStatus(status);\n    // Eer grev tamamland ve onaylandysa, \"Onayland\" aamasn gster\n    if (normalized === \"completed\" && approvalStatus === \"approved\") {\n      return 3; // \"Onayland\" index'i\n    }\n    // Eer grev tamamland ama onaylanmadysa, \"Tamamland\" aamasn gster\n    if (normalized === \"completed\") {\n      return 2; // \"Tamamland\" index'i\n    }\n    const index = taskStatusWorkflow.findIndex((statusItem) => statusItem.value === normalized);\n    // Eer bulunamazsa, \"pending\" olarak kabul et (index 0)\n    if (index === -1) {\n      if (import.meta.env.DEV) {\n        console.warn(\"Tasks: Status workflow'da bulunamad:\", {\n          original: status,\n          normalized,\n          availableStatuses: taskStatusWorkflow.map(s => s.value),\n        });\n      }\n      return 0;\n    }\n    return index;\n  };\n\n  // Bir sonraki durumu bul\n  const getNextStatus = (currentStatus: string, approvalStatus?: \"pending\" | \"approved\" | \"rejected\") => {\n    const currentIndex = getCurrentStatusIndex(currentStatus, approvalStatus);\n\n    // Eer grev \"completed\" durumundaysa, \"approved\" durumuna direkt gei yaplamaz\n    // Sadece \"Onaya Gnder\" butonu gsterilir\n    const normalizedStatus = normalizeStatus(currentStatus);\n    if (normalizedStatus === \"completed\") {\n      return null;\n    }\n\n    if (currentIndex === -1 || currentIndex >= taskStatusWorkflow.length - 1) {\n      return null;\n    }\n    const nextStatus = taskStatusWorkflow[currentIndex + 1];\n\n    // \"approved\" durumuna direkt gei yaplamaz - sadece onay sreci ile geilebilir\n    if (nextStatus && nextStatus.value === \"approved\") {\n      return null;\n    }\n\n    return nextStatus;\n  };\n\n  // Proje seildiinde sralamay gncelle (sadece proje deitiinde)\n  useEffect(() => {\n    if (selectedProject && selectedProject !== \"all\" && selectedProject !== \"general\" && filterableProjects.length > 0) {\n      const lastUsedProjectId = localStorage.getItem('lastUsedProjectId');\n      if (lastUsedProjectId && lastUsedProjectId !== selectedProject) {\n        // En son kullanlan projeyi gncelle\n        lastUsedProjectRef.current = selectedProject;\n        localStorage.setItem('lastUsedProjectId', selectedProject);\n\n        // Projeleri yeniden srala\n        const sortedProjects = [...filterableProjects].sort((a, b) => {\n          if (a.id === selectedProject) return -1;\n          if (b.id === selectedProject) return 1;\n          return 0;\n        });\n        setFilterableProjects(sortedProjects);\n      }\n    }\n  }, [selectedProject]);\n\n  // Dropdown kapandnda arama sorgusunu temizle\n  useEffect(() => {\n    if (!projectDropdownOpen) {\n      setProjectSearchQuery(\"\");\n    }\n  }, [projectDropdownOpen]);\n\n  const handleStatusChange = async (taskId: string, status: string) => {\n    if (!user?.id) {\n      toast.error(\"Kullanc bilgisi bulunamad\");\n      return;\n    }\n    if (!taskId || taskId.trim() === \"\" || !status || status.trim() === \"\") {\n      toast.error(\"Geersiz grev veya durum\");\n      return;\n    }\n\n    // Status' normalize et (column_ prefix'ini kaldr)\n    const normalizedStatus = normalizeStatus(status);\n\n    // \"approved\" durumuna direkt gei yaplamaz - sadece onay sreci ile geilebilir\n    if (normalizedStatus === \"approved\") {\n      toast.error(\"Grev 'Onayland' durumuna direkt geirilemez. Ltfen 'Onaya Gnder' butonunu kullann.\");\n      return;\n    }\n\n    // Optimistic update: UI' hemen gncelle\n    const task = Array.isArray(allTasks) ? allTasks.find(t => t?.id === taskId) : null;\n    if (!task) {\n      toast.error(\"Grev bulunamad\");\n      return;\n    }\n\n    const previousStatus = task.status || \"pending\";\n\n    // Optimistic update state'ini gncelle (normalize edilmi status ile)\n    setOptimisticUpdates(prev => {\n      const newMap = new Map(prev);\n      newMap.set(taskId, { status: normalizedStatus, timestamp: Date.now() });\n      return newMap;\n    });\n\n    // Optimistic update: Local state'i gncelle (normalize edilmi status ile)\n    const updateTaskInState = <T extends { id: string; status: string }>(taskList: T[]): T[] => {\n      return taskList.map(t =>\n        t.id === taskId ? { ...t, status: normalizedStatus } as T : t\n      );\n    };\n\n    setAllTasks(prev => updateTaskInState(prev as Array<{ id: string; status: string }>) as typeof prev);\n    setMyTasks(prev => updateTaskInState(prev as Array<{ id: string; status: string }>) as typeof prev);\n    setCreatedTasks(prev => updateTaskInState(prev as Array<{ id: string; status: string }>) as typeof prev);\n    setArchivedTasks(prev => updateTaskInState(prev as Array<{ id: string; status: string }>) as typeof prev);\n\n    try {\n      // Yetki kontrol: SADECE grev yeleri (rejected hari) ve grevi oluturan durum deitirebilir\n      // Yneticiler iin zel durum YOK - sadece grev yeleri durum deitirebilir\n      // Personel, ekip lideri, ynetici - grev yesi olduu grevin durumunu deitirebilir\n\n      const isCreator = task.createdBy === user.id;\n\n      // Grevin atanan kullanclarn kontrol et (rejected hari)\n      const taskAssignments = await getTaskAssignments(taskId);\n      const assignedUserIds = Array.isArray(taskAssignments)\n        ? taskAssignments\n          .filter(a => a?.status !== \"rejected\")\n          .map(a => a?.assignedTo)\n          .filter((id): id is string => !!id)\n        : [];\n      const isAssignedFromAssignments = assignedUserIds.includes(user.id);\n\n      // Fallback: task.assignedUsers array'inden kontrol\n      const isInTaskAssignedUsers = Array.isArray(task.assignedUsers) && task.assignedUsers.some((u) => {\n        if (typeof u === 'string') {\n          return u === user.id;\n        }\n        if (typeof u === 'object' && u !== null && 'id' in u) {\n          return (u as { id: string }).id === user.id;\n        }\n        return false;\n      });\n\n      const isAssigned = isAssignedFromAssignments || isInTaskAssignedUsers;\n\n      // Sadece grev yesi (rejected hari) veya oluturan ise izin var\n      if (!isAssigned && !isCreator) {\n        toast.error(\"Durum deitirme yetkiniz yok. Sadece grev yesi olduunuz grevlerin durumunu deitirebilirsiniz.\");\n        return;\n      }\n\n      // Durum gncellemesini yap (normalize edilmi status ile)\n      await updateTaskStatus(\n        taskId,\n        normalizedStatus as \"pending\" | \"in_progress\" | \"completed\"\n      );\n\n      // Baar mesaj gster\n      const statusNames: Record<string, string> = {\n        pending: \"Yaplacak\",\n        in_progress: \"Devam Ediyor\",\n        completed: \"Tamamland\",\n      };\n      toast.success(`Grev durumu \"${statusNames[status] || status}\" olarak gncellendi`);\n\n      // Optimistic update'i temizle (baarl oldu)\n      setOptimisticUpdates(prev => {\n        const newMap = new Map(prev);\n        newMap.delete(taskId);\n        return newMap;\n      });\n\n      // subscribeToTasks zaten real-time gncellemeleri dinliyor, \n      // bu yzden fetchTasks() arsna gerek yok\n    } catch (error: unknown) {\n      const errorMsg = error instanceof Error ? error.message : String(error);\n\n      // Firestore izin hatasn kullancya gster\n      if (errorMsg.includes(\"Missing or insufficient permissions\") || errorMsg.includes(\"permission-denied\") || errorMsg.includes(\"Firestore gvenlik kurallar\")) {\n        toast.error(\"Grev durumunu deitirme izniniz yok. Firestore gvenlik kurallar grev yelerine izin vermiyor. Ltfen yneticinizle iletiime gein.\");\n      } else {\n        toast.error(errorMsg || \"Grev durumu gncellenemedi\");\n      }\n\n      if (import.meta.env.DEV) {\n        console.error(\"Update task status error:\", error);\n      }\n\n      // Rollback: Hata durumunda nceki duruma geri dn\n      const rollbackTaskInState = <T extends { id: string; status: string }>(taskList: T[]): T[] => {\n        return taskList.map(t =>\n          t.id === taskId ? { ...t, status: previousStatus } as T : t\n        );\n      };\n\n      setAllTasks(prev => rollbackTaskInState(prev as Array<{ id: string; status: string }>) as typeof prev);\n      setMyTasks(prev => rollbackTaskInState(prev as Array<{ id: string; status: string }>) as typeof prev);\n      setCreatedTasks(prev => rollbackTaskInState(prev as Array<{ id: string; status: string }>) as typeof prev);\n      setArchivedTasks(prev => rollbackTaskInState(prev as Array<{ id: string; status: string }>) as typeof prev);\n\n      // Optimistic update'i temizle\n      setOptimisticUpdates(prev => {\n        const newMap = new Map(prev);\n        newMap.delete(taskId);\n        return newMap;\n      });\n\n      const errorMessage = error instanceof Error ? error.message : \"Durum gncellenemedi\";\n      toast.error(errorMessage, {\n        action: {\n          label: \"Tekrar Dene\",\n          onClick: () => {\n            handleStatusChange(taskId, status);\n          }\n        },\n        duration: 5000,\n      });\n    }\n  };\n\n\n  // Geri alma ilemi - sadece yneticiler iin, belirli bir duruma geri alr\n  const handleRevertStatus = async (taskId: string, targetStatus: string) => {\n    if (!user) return;\n\n    if (!isSuperAdmin) {\n      toast.error(\"Sadece yneticiler durumu geri alabilir.\");\n      return;\n    }\n\n    // \"Onayland\" durumuna geri alnamaz\n    if (targetStatus === \"approved\") {\n      toast.error(\"Onayland durumuna geri alnamaz.\");\n      return;\n    }\n\n    try {\n      const task = allTasks.find(t => t.id === taskId);\n      if (!task) {\n        toast.error(\"Grev bulunamad\");\n        return;\n      }\n\n      // Eer onay bekleniyorsa, geri alnamaz\n      if (task.approvalStatus === \"pending\") {\n        toast.error(\"Onay bekleyen grevler geri alnamaz.\");\n        return;\n      }\n\n      // Status' normalize et\n      const normalizedTaskStatus = normalizeStatus(task.status);\n      const normalizedTargetStatus = normalizeStatus(targetStatus);\n\n      const currentIndex = getCurrentStatusIndex(normalizedTaskStatus, task.approvalStatus);\n      const targetIndex = taskStatusWorkflow.findIndex(s => s.value === normalizedTargetStatus);\n\n      if (targetIndex === -1) {\n        toast.error(\"Geersiz durum.\");\n        return;\n      }\n\n      // Sadece geriye doru geri alnabilir (mevcut durumdan nceki durumlara)\n      if (targetIndex >= currentIndex) {\n        toast.error(\"Sadece nceki durumlara geri alabilirsiniz.\");\n        return;\n      }\n\n      const targetStatusItem = taskStatusWorkflow[targetIndex];\n      // normalizedTargetStatus zaten yukarda tanmlanm, tekrar tanmlamaya gerek yok\n\n      await updateTaskStatus(\n        taskId,\n        normalizedTargetStatus as \"pending\" | \"in_progress\" | \"completed\"\n      );\n\n      // Optimistic update: Local state'i gncelle\n      const updateTaskInState = <T extends { id: string; status: string }>(taskList: T[]): T[] => {\n        return taskList.map(t =>\n          t.id === taskId ? { ...t, status: normalizedTargetStatus } as T : t\n        );\n      };\n\n      setAllTasks(prev => updateTaskInState(prev as Array<{ id: string; status: string }>) as typeof prev);\n      setMyTasks(prev => updateTaskInState(prev as Array<{ id: string; status: string }>) as typeof prev);\n      setCreatedTasks(prev => updateTaskInState(prev as Array<{ id: string; status: string }>) as typeof prev);\n      setArchivedTasks(prev => updateTaskInState(prev as Array<{ id: string; status: string }>) as typeof prev);\n\n      toast.success(`Grev durumu ${targetStatusItem.label} olarak geri alnd.`);\n    } catch (error: unknown) {\n      if (import.meta.env.DEV) {\n        console.error(\"Revert status error:\", error);\n      }\n      toast.error(\"Durum geri alnamad: \" + (error instanceof Error ? error.message : \"Bilinmeyen hata\"));\n    }\n  };\n\n  // Sayfa bal iin aktif filtreyi belirle\n  const getPageTitle = () => {\n    if (activeFilter === \"my-tasks\") return \"Benim Grevlerim\";\n    if (activeFilter === \"general\") return \"Genel Grevler\";\n    if (activeFilter === \"pool\") return \"Grev Havuzu\";\n    if (activeFilter === \"archive\") return \"Ariv\";\n    if (selectedProject && selectedProject !== \"all\" && selectedProject !== \"general\") {\n      const project = filterableProjects.find(p => p.id === selectedProject);\n      return project?.name || \"Grevler\";\n    }\n    return \"Grevler\";\n  };\n\n  // Breadcrumb iin proje adn al\n  const getProjectName = () => {\n    if (selectedProject && selectedProject !== \"all\" && selectedProject !== \"general\") {\n      const project = filterableProjects.find(p => p.id === selectedProject);\n      return project?.name || null;\n    }\n    return null;\n  };\n\n  if (loading) {\n    return (\n      <MainLayout>\n        <div className=\"space-y-4\">\n          {/* Skeleton: Balk ve Breadcrumb */}\n          <div className=\"space-y-2\">\n            <Skeleton className=\"h-4 w-48\" />\n            <Skeleton className=\"h-6 w-64\" />\n          </div>\n\n          {/* Skeleton: Filtre Card */}\n          <Card className=\"border\">\n            <CardContent className=\"p-3\">\n              <div className=\"space-y-3\">\n                <Skeleton className=\"h-8 w-full\" />\n                <Skeleton className=\"h-7 w-full\" />\n                <Skeleton className=\"h-7 w-full\" />\n                <Skeleton className=\"h-7 w-full\" />\n              </div>\n            </CardContent>\n          </Card>\n\n          {/* Skeleton: Grev Kartlar */}\n          <div className=\"space-y-2\">\n            {[1, 2, 3, 4, 5].map((i) => (\n              <Card key={i} className=\"border\">\n                <CardContent className=\"p-3\">\n                  <div className=\"flex items-center gap-3\">\n                    <Skeleton className=\"h-8 w-8 rounded-full\" />\n                    <div className=\"flex-1 space-y-2\">\n                      <Skeleton className=\"h-4 w-3/4\" />\n                      <Skeleton className=\"h-3 w-1/2\" />\n                    </div>\n                    <Skeleton className=\"h-7 w-7 rounded\" />\n                  </div>\n                </CardContent>\n              </Card>\n            ))}\n          </div>\n        </div>\n      </MainLayout>\n    );\n  }\n\n  return (\n    <MainLayout disableScroll={false}>\n      <div className={cn(\n        \"space-y-2 w-[90%] max-w-[90%] mx-auto\",\n        viewMode === \"board\" ? \"pb-0\" : \"pb-8\"\n      )}>\n        {/* Hata Durumu */}\n        {error && (\n          <Card className=\"border-destructive bg-destructive/5\">\n            <CardContent className=\"p-3 sm:p-4\">\n              <div className=\"flex items-start gap-3\">\n                <AlertCircle className=\"h-5 w-5 text-destructive mt-0.5 flex-shrink-0\" />\n                <div className=\"flex-1\">\n                  <h3 className=\"font-semibold text-destructive mb-1\">Hata Olutu</h3>\n                  <p className=\"text-[11px] sm:text-xs text-muted-foreground mb-3\">{error}</p>\n                  <Button\n                    variant=\"outline\"\n                    size=\"sm\"\n                    onClick={() => {\n                      setError(null);\n                      setLoading(true);\n                      fetchTasks();\n                    }}\n                    className=\"h-8\"\n                  >\n                    <RefreshCw className=\"h-4 w-4 mr-2\" />\n                    Tekrar Dene\n                  </Button>\n                </div>\n                <Button\n                  variant=\"ghost\"\n                  size=\"sm\"\n                  onClick={() => setError(null)}\n                  className=\"h-8 w-8 p-0\"\n                >\n                  <X className=\"h-4 w-4\" />\n                </Button>\n              </div>\n            </CardContent>\n          </Card>\n        )}\n\n        {/* Sayfa Bal - Sade */}\n        <div className=\"flex items-center justify-between gap-3\">\n          <h1 className=\"text-[16px] sm:text-[18px] font-semibold text-foreground\" id=\"page-title\">\n            {getPageTitle()}\n          </h1>\n          {/* statistikler Alma Butonu */}\n          {!statsExpanded ? (\n            <Button\n              variant=\"ghost\"\n              size=\"sm\"\n              onClick={() => setStatsExpanded(true)}\n              className=\"h-7 px-2 gap-1 text-[11px] sm:text-xs\"\n              aria-label=\"statistikleri gster\"\n            >\n              <ChevronLeft className=\"h-3.5 w-3.5\" />\n            </Button>\n          ) : (\n            <Button\n              variant=\"ghost\"\n              size=\"sm\"\n              onClick={() => setStatsExpanded(false)}\n              className=\"h-7 px-2 gap-1 text-[11px] sm:text-xs\"\n              aria-label=\"statistikleri gizle\"\n            >\n              <ChevronRight className=\"h-3.5 w-3.5\" />\n            </Button>\n          )}\n        </div>\n\n        {/* Uyarlar Banner - Kompakt */}\n        {(pendingApprovalsCount > 0 || pendingAssignmentsCount > 0 || upcomingDeadlinesCount > 0) && (\n          <div className=\"flex flex-wrap items-center gap-2 text-[11px] sm:text-xs px-2 py-1.5 bg-amber-50/30 dark:bg-amber-950/10 border border-amber-200/50 dark:border-amber-800/30 rounded-md\">\n            {pendingApprovalsCount > 0 && (\n              <Badge variant=\"outline\" className=\"text-[10px] h-5 px-1.5 bg-amber-100/50 dark:bg-amber-900/50 border-amber-300/50 dark:border-amber-700/50\">\n                {pendingApprovalsCount} onay\n              </Badge>\n            )}\n            {pendingAssignmentsCount > 0 && (\n              <Badge variant=\"outline\" className=\"text-xs h-5 px-1.5 bg-blue-100/50 dark:bg-blue-900/50 border-blue-300/50 dark:border-blue-700/50\">\n                {pendingAssignmentsCount} atama\n              </Badge>\n            )}\n            {upcomingDeadlinesCount > 0 && (\n              <Badge variant=\"outline\" className=\"text-xs h-5 px-1.5 bg-orange-100/50 dark:bg-orange-900/50 border-orange-300/50 dark:border-orange-700/50\">\n                {upcomingDeadlinesCount} deadline\n              </Badge>\n            )}\n          </div>\n        )}\n\n        {/* statistikler - Sade */}\n        {statsExpanded && (\n          <Card className=\"border shadow-sm -mt-2\">\n            <CardContent className=\"p-2\">\n              <div className=\"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-2\">\n                {/* Tm */}\n                <div\n                  className=\"flex items-center gap-2 p-2 rounded border border-border/50 cursor-pointer hover:bg-muted/50 transition-colors\"\n                  onClick={() => {\n                    setStatusFilter(\"all\");\n                    setFocusFilter(\"all\");\n                    setSelectedProject(\"all\");\n                    setProjectFilter(\"all\");\n                  }}\n                >\n                  <CheckSquare className=\"h-4 w-4 text-muted-foreground\" />\n                  <div>\n                    <p className=\"text-[11px] sm:text-xs text-muted-foreground\">Tm</p>\n                    <p className=\"text-lg sm:text-xl font-semibold\">{listData.length}</p>\n                  </div>\n                </div>\n\n                {/* Aktif */}\n                <div\n                  className=\"flex items-center gap-2 p-2 rounded border border-border/50 cursor-pointer hover:bg-muted/50 transition-colors\"\n                  onClick={() => {\n                    setStatusFilter(\"all\");\n                    setFocusFilter(\"all\");\n                  }}\n                >\n                  <Clock className=\"h-4 w-4 text-blue-600\" />\n                  <div>\n                    <p className=\"text-[11px] sm:text-xs text-muted-foreground\">Aktif</p>\n                    <p className=\"text-lg sm:text-xl font-semibold text-blue-600\">\n                      {listData.filter((task: Task | FirebaseTask | unknown) => {\n                        if (!task || typeof task !== 'object') return false;\n                        const t = task as { status?: string; isArchived?: boolean; is_archived?: boolean };\n                        return (t.status === \"pending\" || t.status === \"in_progress\") &&\n                          !t.isArchived && !t.is_archived;\n                      }).length}\n                    </p>\n                  </div>\n                </div>\n\n                {/* Onay Bekleyen */}\n                <div\n                  className=\"flex items-center gap-2 p-2 rounded border border-border/50 cursor-pointer hover:bg-muted/50 transition-colors\"\n                  onClick={() => {\n                    setStatusFilter(\"completed\");\n                  }}\n                >\n                  <AlertCircle className=\"h-4 w-4 text-orange-600\" />\n                  <div>\n                    <p className=\"text-[11px] sm:text-xs text-muted-foreground\">Onay Bekleyen</p>\n                    <p className=\"text-lg sm:text-xl font-semibold text-orange-600\">\n                      {listData.filter((task: Task | FirebaseTask | unknown) => {\n                        if (!task || typeof task !== 'object') return false;\n                        const t = task as { status?: string; approvalStatus?: string };\n                        return t.status === \"completed\" && t.approvalStatus === \"pending\";\n                      }).length}\n                    </p>\n                  </div>\n                </div>\n\n                {/* Tamamlanan */}\n                <div\n                  className=\"flex items-center gap-2 p-2 rounded border border-border/50 cursor-pointer hover:bg-muted/50 transition-colors\"\n                  onClick={() => {\n                    setStatusFilter(\"completed\");\n                    setFocusFilter(\"all\");\n                  }}\n                >\n                  <CheckCircle2 className=\"h-4 w-4 text-emerald-600\" />\n                  <div>\n                    <p className=\"text-[11px] sm:text-xs text-muted-foreground\">Tamamlanan</p>\n                    <p className=\"text-lg sm:text-xl font-semibold text-emerald-600\">\n                      {listData.filter((task: Task | FirebaseTask | unknown) => {\n                        if (!task || typeof task !== 'object') return false;\n                        return (task as { status?: string }).status === \"completed\";\n                      }).length}\n                    </p>\n                  </div>\n                </div>\n\n                {/* Geciken */}\n                <div\n                  className=\"flex items-center gap-2 p-2 rounded border border-border/50 cursor-pointer hover:bg-muted/50 transition-colors\"\n                  onClick={() => {\n                    setStatusFilter(\"all\");\n                    setFocusFilter(\"overdue\");\n                  }}\n                >\n                  <AlertCircle className=\"h-4 w-4 text-red-600\" />\n                  <div>\n                    <p className=\"text-[11px] sm:text-xs text-muted-foreground\">Geciken</p>\n                    <p className=\"text-lg sm:text-xl font-semibold text-red-600\">\n                      {listData.filter((task: Task | FirebaseTask | unknown) => {\n                        if (!task || typeof task !== 'object') return false;\n                        return isTaskOverdue(task as Task | FirebaseTask);\n                      }).length}\n                    </p>\n                  </div>\n                </div>\n\n                {/* Yaklaan */}\n                <div\n                  className=\"flex items-center gap-2 p-2 rounded border border-border/50 cursor-pointer hover:bg-muted/50 transition-colors\"\n                  onClick={() => {\n                    setStatusFilter(\"all\");\n                    setFocusFilter(\"due_soon\");\n                  }}\n                >\n                  <CalendarDays className=\"h-4 w-4 text-amber-600\" />\n                  <div>\n                    <p className=\"text-[11px] sm:text-xs text-muted-foreground\">Yaklaan</p>\n                    <p className=\"text-lg sm:text-xl font-semibold text-amber-600\">\n                      {listData.filter((task: Task | FirebaseTask | unknown) => {\n                        if (!task || typeof task !== 'object') return false;\n                        return isTaskDueSoon(task as Task | FirebaseTask);\n                      }).length}\n                    </p>\n                  </div>\n                </div>\n\n                {/* ncelikli */}\n                <div\n                  className=\"flex items-center gap-2 p-2 rounded border border-border/50 cursor-pointer hover:bg-muted/50 transition-colors\"\n                  onClick={() => {\n                    setStatusFilter(\"all\");\n                    setFocusFilter(\"high_priority\");\n                  }}\n                >\n                  <Flame className=\"h-4 w-4 text-purple-600\" />\n                  <div>\n                    <p className=\"text-[11px] sm:text-xs text-muted-foreground\">ncelikli</p>\n                    <p className=\"text-lg sm:text-xl font-semibold text-purple-600\">\n                      {listData.filter((task: Task | FirebaseTask | unknown) => {\n                        if (!task || typeof task !== 'object') return false;\n                        const t = task as { priority?: number };\n                        const taskPriority = t.priority || 0;\n                        // Eski sistem (1-5) varsa yeni sisteme (0-5) evir\n                        const newPriority = convertOldPriorityToNew(taskPriority);\n                        // Yksek ncelik: 3 (Yksek) ve zeri\n                        return newPriority >= 3;\n                      }).length}\n                    </p>\n                  </div>\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n        )}\n\n        {/* Toplu lemler Toolbar */}\n        {isMultiSelectMode && selectedTaskIds.size > 0 && (\n          <Card className=\"border bg-primary/5 flex-shrink-0\">\n            <CardContent className=\"p-3\">\n              <div className=\"flex items-center justify-between flex-wrap gap-3\">\n                <div className=\"flex items-center gap-3\">\n                  <span className=\"text-[11px] sm:text-xs font-medium text-foreground\">\n                    {selectedTaskIds.size} grev seildi\n                  </span>\n                  <Button\n                    variant=\"ghost\"\n                    size=\"sm\"\n                    onClick={() => {\n                      setSelectedTaskIds(new Set());\n                      setIsMultiSelectMode(false);\n                    }}\n                    className=\"h-7 text-[11px] sm:text-xs\"\n                  >\n                    <X className=\"h-3.5 w-3.5 mr-1\" />\n                    Seimi Temizle\n                  </Button>\n                </div>\n                <div className=\"flex items-center gap-2\">\n                  <Button\n                    variant=\"outline\"\n                    size=\"sm\"\n                    onClick={async () => {\n                      if (selectedTaskIds.size === 0) return;\n                      const status = prompt(\"Yeni durum sein:\\n1. pending (Yaplacak)\\n2. in_progress (Devam Ediyor)\\n3. completed (Tamamland)\");\n                      if (!status || ![\"pending\", \"in_progress\", \"completed\"].includes(status)) return;\n\n                      const tasksToUpdate = Array.from(selectedTaskIds);\n                      for (const taskId of tasksToUpdate) {\n                        try {\n                          await handleStatusChange(taskId, status);\n                        } catch (error: unknown) {\n                          if (import.meta.env.DEV) {\n                            console.error(`Failed to update task ${taskId}:`, error);\n                          }\n                        }\n                      }\n                      setSelectedTaskIds(new Set());\n                      setIsMultiSelectMode(false);\n                      toast.success(`${tasksToUpdate.length} grev durumu gncellendi`);\n                    }}\n                    className=\"h-7 text-[11px] sm:text-xs\"\n                    disabled={selectedTaskIds.size === 0}\n                  >\n                    <CheckCircle2 className=\"h-3.5 w-3.5 mr-1\" />\n                    Durum Deitir\n                  </Button>\n                  <Button\n                    variant=\"outline\"\n                    size=\"sm\"\n                    onClick={async () => {\n                      if (selectedTaskIds.size === 0) return;\n                      if (!confirm(`${selectedTaskIds.size} grevi arivlemek istediinize emin misiniz?`)) return;\n\n                      const tasksToArchive = Array.from(selectedTaskIds);\n                      for (const taskId of tasksToArchive) {\n                        try {\n                          if (user) {\n                            await archiveTask(taskId, user.id);\n                          }\n                        } catch (error: unknown) {\n                          if (import.meta.env.DEV) {\n                            console.error(`Failed to archive task ${taskId}:`, error);\n                          }\n                        }\n                      }\n                      setSelectedTaskIds(new Set());\n                      setIsMultiSelectMode(false);\n                      toast.success(`${tasksToArchive.length} grev arivlendi`);\n                    }}\n                    className=\"h-7 text-[11px] sm:text-xs\"\n                    disabled={selectedTaskIds.size === 0}\n                  >\n                    <Archive className=\"h-3.5 w-3.5 mr-1\" />\n                    Arivle\n                  </Button>\n                  <Button\n                    variant=\"destructive\"\n                    size=\"sm\"\n                    onClick={async () => {\n                      if (selectedTaskIds.size === 0) return;\n                      if (!confirm(`${selectedTaskIds.size} grevi silmek istediinize emin misiniz? Bu ilem geri alnamaz.`)) return;\n\n                      const tasksToDelete = Array.from(selectedTaskIds);\n                      for (const taskId of tasksToDelete) {\n                        try {\n                          await deleteTask(taskId);\n                        } catch (error: unknown) {\n                          if (import.meta.env.DEV) {\n                            console.error(`Failed to delete task ${taskId}:`, error);\n                          }\n                        }\n                      }\n                      setSelectedTaskIds(new Set());\n                      setIsMultiSelectMode(false);\n                      toast.success(`${tasksToDelete.length} grev silindi`);\n                    }}\n                    className=\"h-7 text-[11px] sm:text-xs\"\n                    disabled={selectedTaskIds.size === 0}\n                  >\n                    <Trash2 className=\"h-3.5 w-3.5 mr-1\" />\n                    Sil\n                  </Button>\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n        )}\n\n        {/* Kompakt Filtre Bar - Profesyonel Tek Satr Tasarm */}\n        <Card className=\"border shadow-sm my-0\">\n          <CardContent className=\"p-1.5\">\n            <div className=\"flex flex-col gap-1\">\n              {/* st Satr: Proje Tabs ve Ana Aksiyonlar */}\n              <div className=\"flex items-center gap-1.5 flex-wrap\">\n                {/* Temizle Butonu - Sadece aktif filtre varsa gster */}\n                {(statusFilter !== \"all\" || focusFilter !== \"all\" || selectedProject !== \"all\" || assignedUserFilter !== \"all\") && (\n                  <Button\n                    variant=\"ghost\"\n                    size=\"sm\"\n                    onClick={() => {\n                      setStatusFilter(\"all\");\n                      setSortBy(\"created_at\");\n                      setFocusFilter(\"all\");\n                      setSelectedProject(\"all\");\n                      setProjectFilter(\"all\");\n                      setAssignedUserFilter(\"all\");\n                    }}\n                    className=\"h-7 text-xs px-2 gap-1 text-muted-foreground hover:text-foreground transition-colors\"\n                    aria-label=\"Filtreleri temizle\"\n                    title=\"Filtreleri Temizle\"\n                  >\n                    <X className=\"h-3.5 w-3.5\" />\n                    <span className=\"hidden sm:inline\">Temizle</span>\n                  </Button>\n                )}\n                {/* Proje Seimi - Arama Yaplabilen Dropdown */}\n                <Popover open={projectDropdownOpen} onOpenChange={setProjectDropdownOpen}>\n                  <PopoverTrigger asChild>\n                    <Button\n                      variant=\"outline\"\n                      role=\"combobox\"\n                      aria-expanded={projectDropdownOpen}\n                      className=\"h-7 text-xs px-2.5 border-border/50 hover:border-primary/50 transition-colors min-w-[180px] justify-between\"\n                    >\n                      <div className=\"flex items-center gap-1.5\">\n                        <Folder className=\"h-3.5 w-3.5 text-muted-foreground\" />\n                        <span className=\"truncate\">\n                          {selectedProject === \"all\" ? \"Tm Projeler\" :\n                            selectedProject === \"general\" ? \"Genel Grevler\" :\n                              filterableProjects.find(p => p.id === selectedProject)?.name || \"Proje Sein\"}\n                        </span>\n                      </div>\n                      <ChevronDown className=\"ml-2 h-3.5 w-3.5 shrink-0 opacity-50\" />\n                    </Button>\n                  </PopoverTrigger>\n                  <PopoverContent className=\"w-[var(--radix-popover-trigger-width)] sm:w-[400px] p-0\" align=\"start\" side=\"bottom\" sideOffset={4}>\n                    <Command shouldFilter={false}>\n                      <CommandInput\n                        placeholder=\"Proje ara...\"\n                        value={projectSearchQuery}\n                        onValueChange={setProjectSearchQuery}\n                        className=\"text-[11px] sm:text-xs\"\n                      />\n                      <CommandList className=\"max-h-[300px]\">\n                        <CommandEmpty>\n                          {projectSearchQuery ? \"Proje bulunamad.\" : \"Proje bulunamad.\"}\n                        </CommandEmpty>\n                        <CommandGroup>\n                          <CommandItem\n                            value=\"all\"\n                            onSelect={() => {\n                              setSelectedProject(\"all\");\n                              setProjectFilter(\"all\");\n                              setProjectDropdownOpen(false);\n                              setProjectSearchQuery(\"\");\n                            }}\n                            className=\"cursor-pointer\"\n                          >\n                            <div className=\"flex items-center gap-2 w-full\">\n                              <CheckSquare className=\"h-4 w-4\" />\n                              <span>Tm Projeler</span>\n                              {selectedProject === \"all\" && (\n                                <Check className=\"ml-auto h-4 w-4\" />\n                              )}\n                            </div>\n                          </CommandItem>\n                          <CommandItem\n                            value=\"general\"\n                            onSelect={() => {\n                              setSelectedProject(\"general\");\n                              setProjectFilter(\"general\");\n                              setActiveFilter(\"general\");\n                              setProjectDropdownOpen(false);\n                              setProjectSearchQuery(\"\");\n                            }}\n                            className=\"cursor-pointer\"\n                          >\n                            <div className=\"flex items-center gap-2 w-full\">\n                              <Folder className=\"h-4 w-4\" />\n                              <span>Genel Grevler</span>\n                              {selectedProject === \"general\" && (\n                                <Check className=\"ml-auto h-4 w-4\" />\n                              )}\n                            </div>\n                          </CommandItem>\n                        </CommandGroup>\n                        {filterableProjects.length > 0 && (\n                          <CommandGroup heading=\"Projeler\">\n                            {filterableProjects\n                              .filter((project) => {\n                                if (!projectSearchQuery) return true;\n                                const query = projectSearchQuery.toLowerCase();\n                                return project.name?.toLowerCase().includes(query);\n                              })\n                              .map((project) => (\n                                <CommandItem\n                                  key={project.id}\n                                  value={project.id}\n                                  onSelect={() => {\n                                    setSelectedProject(project.id);\n                                    setProjectFilter(project.id);\n                                    setProjectDropdownOpen(false);\n                                    setProjectSearchQuery(\"\");\n                                    // En son kullanlan projeyi localStorage'a kaydet\n                                    localStorage.setItem('lastUsedProjectId', project.id);\n                                    lastUsedProjectRef.current = project.id;\n                                    // Projeleri yeniden srala\n                                    const sortedProjects = [...filterableProjects].sort((a, b) => {\n                                      if (a.id === project.id) return -1;\n                                      if (b.id === project.id) return 1;\n                                      return 0;\n                                    });\n                                    setFilterableProjects(sortedProjects);\n                                  }}\n                                  className=\"cursor-pointer\"\n                                >\n                                  <div className=\"flex items-center gap-2 w-full group\">\n                                    {project.isPrivate && <Lock className=\"h-3.5 w-3.5 text-muted-foreground\" />}\n                                    <span className=\"flex-1\">{project.name}</span>\n                                    {project.id === lastUsedProjectRef.current && (\n                                      <Badge variant=\"outline\" className=\"text-[9px] h-4 px-1\">\n                                        Son\n                                      </Badge>\n                                    )}\n                                    {selectedProject === project.id && (\n                                      <Check className=\"ml-2 h-4 w-4\" />\n                                    )}\n                                    {canDeleteProjectState && (\n                                      <Button\n                                        variant=\"ghost\"\n                                        size=\"sm\"\n                                        className=\"h-6 w-6 p-0 ml-auto\"\n                                        onClick={(e) => {\n                                          e.stopPropagation();\n                                          e.preventDefault();\n                                          setProjectToDelete(project);\n                                          setDeleteProjectDialogOpen(true);\n                                          setProjectDropdownOpen(false);\n                                        }}\n                                        title=\"Projeyi sil\"\n                                      >\n                                        <Trash2 className=\"h-3.5 w-3.5 text-destructive\" />\n                                      </Button>\n                                    )}\n                                  </div>\n                                </CommandItem>\n                              ))}\n                          </CommandGroup>\n                        )}\n                        {/* Proje Ekle Seenei - Yneticiler ve Ekip Liderleri iin */}\n                        {canCreateProjectState && (\n                          <CommandGroup>\n                            <CommandItem\n                              value=\"create-project\"\n                              onSelect={() => {\n                                setCreateProjectDialogOpen(true);\n                                setProjectDropdownOpen(false);\n                              }}\n                              className=\"cursor-pointer text-primary\"\n                            >\n                              <div className=\"flex items-center gap-2 w-full\">\n                                <Plus className=\"h-4 w-4\" />\n                                <span>Proje Ekle</span>\n                              </div>\n                            </CommandItem>\n                          </CommandGroup>\n                        )}\n                      </CommandList>\n                    </Command>\n                  </PopoverContent>\n                </Popover>\n\n                {/* Kii Filtresi - Atanan kiilere gre */}\n                <Popover>\n                  <PopoverTrigger asChild>\n                    <Button\n                      variant=\"outline\"\n                      role=\"combobox\"\n                      className=\"h-7 text-xs px-2.5 border-border/50 hover:border-primary/50 transition-colors min-w-[160px] justify-between\"\n                    >\n                      <div className=\"flex items-center gap-1.5\">\n                        <Users className=\"h-3.5 w-3.5 text-muted-foreground\" />\n                        <span className=\"truncate\">\n                          {assignedUserFilter === \"all\"\n                            ? \"Tm Kiiler\"\n                            : cachedUsers.find(u => u.id === assignedUserFilter)\n                              ? getFirstName(cachedUsers.find(u => u.id === assignedUserFilter)?.fullName || cachedUsers.find(u => u.id === assignedUserFilter)?.displayName) || cachedUsers.find(u => u.id === assignedUserFilter)?.email || \"Kii Sein\"\n                              : \"Kii Sein\"}\n                        </span>\n                      </div>\n                      <ChevronDown className=\"ml-2 h-3.5 w-3.5 shrink-0 opacity-50\" />\n                    </Button>\n                  </PopoverTrigger>\n                  <PopoverContent className=\"w-[var(--radix-popover-trigger-width)] sm:w-[300px] p-0\" align=\"start\" side=\"bottom\" sideOffset={4}>\n                    <Command>\n                      <CommandInput placeholder=\"Kii ara...\" className=\"text-[11px] sm:text-xs !h-9 !py-2\" />\n                      <CommandList className=\"max-h-[300px]\">\n                        <CommandEmpty className=\"text-[10px] sm:text-[11px] py-4\">Kii bulunamad</CommandEmpty>\n                        <CommandGroup>\n                          <CommandItem\n                            value=\"all\"\n                            onSelect={() => {\n                              setAssignedUserFilter(\"all\");\n                            }}\n                            className=\"cursor-pointer px-2 py-1.5\"\n                          >\n                            <div className=\"flex items-center gap-2 w-full\">\n                              <Users className=\"h-3 w-3\" />\n                              <span className=\"text-[11px] sm:text-xs\">Tm Kiiler</span>\n                              {assignedUserFilter === \"all\" && (\n                                <Check className=\"ml-auto h-3 w-3\" />\n                              )}\n                            </div>\n                          </CommandItem>\n                        </CommandGroup>\n                        <CommandGroup heading=\"Kiiler\">\n                          {cachedUsers.map((user) => (\n                            <CommandItem\n                              key={user.id}\n                              value={user.id}\n                              onSelect={() => {\n                                setAssignedUserFilter(user.id);\n                              }}\n                              className=\"cursor-pointer px-2 py-1.5\"\n                            >\n                              <div className=\"flex items-center gap-2 w-full\">\n                                <Avatar className=\"h-5 w-5\">\n                                  <AvatarFallback className=\"text-[9px]\">\n                                    {getInitials(user.fullName || user.email)}\n                                  </AvatarFallback>\n                                </Avatar>\n                                <span className=\"flex-1 truncate text-[11px] sm:text-xs\" title={user.fullName || user.email}>\n                                  {user.fullName || user.displayName || user.email}\n                                </span>\n                                {assignedUserFilter === user.id && (\n                                  <Check className=\"ml-auto h-3 w-3\" />\n                                )}\n                              </div>\n                            </CommandItem>\n                          ))}\n                        </CommandGroup>\n                      </CommandList>\n                    </Command>\n                  </PopoverContent>\n                </Popover>\n\n                {/* Sa Taraf: Kategori - yiletirilmi */}\n                <div className=\"flex items-center gap-1.5 flex-shrink-0\">\n                  {/* Kategori Filtresi - yiletirilmi */}\n                  <DropdownMenu>\n                    <DropdownMenuTrigger asChild>\n                      <Button\n                        variant=\"outline\"\n                        size=\"sm\"\n                        className=\"h-7 text-xs px-2.5 gap-1.5 border-border/50 hover:border-primary/50 transition-colors\"\n                      >\n                        <Folder className=\"h-3.5 w-3.5\" />\n                        <span className=\"hidden sm:inline\">\n                          {activeFilter === \"all\" && \"Tm\"}\n                          {activeFilter === \"my-tasks\" && \"Benim\"}\n                          {activeFilter === \"pool\" && \"Havuz\"}\n                          {activeFilter === \"archive\" && \"Ariv\"}\n                        </span>\n                        <span className=\"sm:hidden\">\n                          {activeFilter === \"all\" && \"Tm\"}\n                          {activeFilter === \"my-tasks\" && \"Benim\"}\n                          {activeFilter === \"pool\" && \"Havuz\"}\n                          {activeFilter === \"archive\" && \"Ariv\"}\n                        </span>\n                        <ChevronDown className=\"h-3 w-3\" />\n                      </Button>\n                    </DropdownMenuTrigger>\n                    <DropdownMenuContent align=\"end\" className=\"w-56\">\n                      <DropdownMenuItem\n                        onClick={() => setActiveFilter(\"all\")}\n                        className={activeFilter === \"all\" ? \"bg-accent font-medium\" : \"\"}\n                      >\n                        <div className=\"flex items-center gap-2\">\n                          <CheckSquare className=\"h-4 w-4\" />\n                          <span>Tm Grevler</span>\n                        </div>\n                      </DropdownMenuItem>\n                      <DropdownMenuItem\n                        onClick={() => setActiveFilter(\"my-tasks\")}\n                        className={activeFilter === \"my-tasks\" ? \"bg-accent font-medium\" : \"\"}\n                      >\n                        <div className=\"flex items-center gap-2\">\n                          <Users className=\"h-4 w-4\" />\n                          <span>Benim Grevlerim</span>\n                        </div>\n                      </DropdownMenuItem>\n                      <DropdownMenuItem\n                        onClick={() => setActiveFilter(\"pool\")}\n                        className={activeFilter === \"pool\" ? \"bg-accent font-medium\" : \"\"}\n                      >\n                        <div className=\"flex items-center gap-2\">\n                          <Zap className=\"h-4 w-4\" />\n                          <span>Grev Havuzu</span>\n                        </div>\n                      </DropdownMenuItem>\n                      {canAccessTeamManagement && (\n                        <DropdownMenuItem\n                          onClick={() => setActiveFilter(\"archive\")}\n                          className={activeFilter === \"archive\" ? \"bg-accent font-medium\" : \"\"}\n                        >\n                          <div className=\"flex items-center gap-2\">\n                            <Archive className=\"h-4 w-4\" />\n                            <span>Ariv</span>\n                          </div>\n                        </DropdownMenuItem>\n                      )}\n                    </DropdownMenuContent>\n                  </DropdownMenu>\n                </div>\n\n                {/* Sa Taraf: Grnm Toggle ve Yeni Grev Butonu */}\n                <div className=\"flex items-center gap-1.5 ml-auto\">\n                  {/* Grnm Toggle - Yaz Olarak */}\n                  <div className=\"flex items-center gap-0.5 border border-border/50 rounded-lg p-0.5 bg-muted/20\">\n                    <Button\n                      variant={viewMode === \"list\" ? \"default\" : \"ghost\"}\n                      size=\"sm\"\n                      onClick={() => {\n                        setViewMode(\"list\");\n                        const newParams = new URLSearchParams(searchParams);\n                        newParams.delete(\"view\");\n                        setSearchParams(newParams, { replace: true });\n                      }}\n                      className=\"h-7 text-xs px-2.5 transition-all font-medium\"\n                      aria-label=\"Liste grnm\"\n                      title=\"Liste Grnm\"\n                    >\n                      Liste\n                    </Button>\n                    <Button\n                      variant={viewMode === \"board\" ? \"default\" : \"ghost\"}\n                      size=\"sm\"\n                      onClick={() => {\n                        setViewMode(\"board\");\n                        const newParams = new URLSearchParams(searchParams);\n                        newParams.set(\"view\", \"board\");\n                        setSearchParams(newParams, { replace: true });\n                      }}\n                      className=\"h-7 text-xs px-2.5 transition-all font-medium\"\n                      aria-label=\"Pano grnm\"\n                      title=\"Pano Grnm\"\n                    >\n                      Pano\n                    </Button>\n                  </div>\n\n                  {/* Yeni Grev Butonu - Personel gremez */}\n                  {canCreate && !(user?.roles?.includes(\"personnel\")) && (\n                    <Button\n                      size=\"sm\"\n                      className=\"h-7 text-xs px-2.5 gap-1.5 font-medium shadow-sm hover:shadow transition-all\"\n                      onClick={async () => {\n                        if (!user) return;\n                        try {\n                          const departments = await getDepartments();\n                          const userProfile: UserProfile = {\n                            id: user.id,\n                            email: user.email,\n                            emailVerified: user.emailVerified,\n                            fullName: user.fullName,\n                            displayName: user.fullName,\n                            phone: user.phone,\n                            dateOfBirth: user.dateOfBirth,\n                            role: user.roles,\n                            createdAt: Timestamp.now(),\n                            updatedAt: Timestamp.now(),\n                          };\n                          const hasPermission = await canCreateTask(userProfile, departments);\n                          if (!hasPermission) {\n                            toast.error(\"Grev oluturma yetkiniz yok\");\n                            return;\n                          }\n                          openInlineForm(\"create\");\n                        } catch (error: unknown) {\n                          if (import.meta.env.DEV) {\n                            console.error(\"Permission check error:\", error);\n                          }\n                          toast.error(\"Yetki kontrol yaplamad\");\n                        }\n                      }}\n                    >\n                      <Plus className=\"h-3.5 w-3.5\" />\n                      <span className=\"hidden sm:inline\">Yeni Grev</span>\n                      <span className=\"sm:hidden\">Yeni</span>\n                    </Button>\n                  )}\n                </div>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n\n        <Dialog open={inlineFormVisible} onOpenChange={setInlineFormVisible}>\n          <DialogContent className=\"!max-w-[100vw] sm:!max-w-[95vw] md:!max-w-[85vw] !w-[100vw] sm:!w-[95vw] md:!w-[85vw] !h-[100vh] sm:!h-[90vh] md:!h-[80vh] !max-h-[100vh] sm:!max-h-[90vh] md:!max-h-[80vh] !left-0 sm:!left-[2.5vw] md:!left-[7.5vw] !top-0 sm:!top-[5vh] md:!top-[10vh] !right-0 sm:!right-auto !bottom-0 sm:!bottom-auto !translate-x-0 !translate-y-0 overflow-hidden !p-0 gap-0 bg-white flex flex-col !m-0 !rounded-none sm:!rounded-lg !border-0 sm:!border\">\n            <div className=\"flex flex-col h-full min-h-0\">\n              <DialogHeader className=\"p-3 sm:p-4 md:p-6 border-b bg-white flex-shrink-0\">\n                <DialogTitle className=\"text-[16px] sm:text-[18px] md:text-[20px] font-semibold text-foreground\">\n                  {inlineFormMode === \"edit\" ? \"Grevi Dzenle\" : \"Yeni Grev\"}\n                </DialogTitle>\n                <DialogDescription className=\"sr-only\">\n                  {inlineFormMode === \"edit\" ? \"Grev bilgilerini dzenleyin\" : \"Yeni grev oluturun\"}\n                </DialogDescription>\n              </DialogHeader>\n              <div className=\"flex-1 overflow-hidden bg-gray-50/50 p-3 sm:p-4 md:p-6 min-h-0\">\n                <div className=\"max-w-full mx-auto h-full overflow-y-auto overflow-x-hidden\">\n                  <div className=\"space-y-4 sm:space-y-6\">\n                    {/* Status Timeline - Sadece edit modunda ve task verisi varsa gster */}\n                    {inlineFormMode === \"edit\" && inlineFormTaskId && (() => {\n                      const currentTask = allTasks.find(t => t.id === inlineFormTaskId);\n                      if (!currentTask) return null;\n\n                      // Status' normalize et (column_ prefix'ini kaldr)\n                      const rawStatus = currentTask.status || \"pending\";\n                      const currentStatus = normalizeStatus(rawStatus);\n                      const currentIndex = getCurrentStatusIndex(currentStatus, currentTask.approvalStatus);\n                      const nextStatus = getNextStatus(currentStatus, currentTask.approvalStatus);\n                      const usersMap = cachedUsers.reduce((acc, u) => {\n                        acc[u.id] = u.fullName || u.email || u.id;\n                        return acc;\n                      }, {} as Record<string, string>);\n\n                      return (\n                        <Card className=\"border-primary/20 shadow-md\">\n                          <CardHeader className=\"space-y-2 sm:space-y-1 p-4 sm:p-6 bg-gradient-to-r from-primary/5 via-primary/3 to-transparent border-b border-primary/10\">\n                            <div className=\"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2 sm:gap-3\">\n                              <div className=\"flex-1 min-w-0\">\n                                <CardTitle className=\"text-[15px] sm:text-[16px] md:text-[17px] mb-1.5 sm:mb-1 font-semibold flex items-center gap-2\">\n                                  <div className=\"w-2 h-2 rounded-full bg-primary\" />\n                                  Grev Durumu\n                                </CardTitle>\n                                <p className=\"text-[11px] sm:text-xs text-muted-foreground leading-relaxed mt-1.5\">\n                                  {(() => {\n                                    // Eer grev onaylandysa\n                                    if (currentStatus === \"completed\" && currentTask.approvalStatus === \"approved\") {\n                                      return \"Grev onayland ve tamamland.\";\n                                    }\n                                    // Eer grev tamamland ve onaya gnderildiyse\n                                    if (currentStatus === \"completed\" && currentTask.approvalStatus === \"pending\") {\n                                      return \"Grev tamamland ve onay bekleniyor.\";\n                                    }\n                                    // Eer grev tamamland ama onaya gnderilmediyse\n                                    if (currentStatus === \"completed\") {\n                                      return \"Grev tamamland. Onaya gndermek iin butona tklayn.\";\n                                    }\n                                    // Dier durumlar iin normal mesaj\n                                    if (nextStatus) {\n                                      return `${getStatusLabel(currentStatus)} aamasndasnz. Sradaki adm: ${nextStatus.label}`;\n                                    }\n                                    return \"Workflow tamamland.\";\n                                  })()}\n                                </p>\n                              </div>\n                              <div className=\"text-[10px] sm:text-[11px] text-muted-foreground sm:text-right flex-shrink-0 flex items-center gap-1.5 sm:flex-col sm:items-end\">\n                                <span className=\"hidden sm:inline\">Son gncelleyen:</span>\n                                <span className=\"font-semibold text-foreground\">\n                                  {(() => {\n                                    const taskWithStatus = currentTask as unknown as FirebaseTask & { updatedBy?: string; statusUpdatedBy?: string };\n                                    const lastEditorId = taskWithStatus.updatedBy || taskWithStatus.statusUpdatedBy;\n                                    const lastEditorName = lastEditorId\n                                      ? (usersMap[lastEditorId] || lastEditorId)\n                                      : (user?.fullName || \"-\");\n                                    if (lastEditorName && lastEditorName.length > 20) {\n                                      return lastEditorName.split(\" \")[0] || lastEditorName.substring(0, 20) + \"...\";\n                                    }\n                                    return lastEditorName;\n                                  })()}\n                                </span>\n                              </div>\n                            </div>\n                          </CardHeader>\n                          <CardContent className=\"p-4 sm:p-6 md:p-8\">\n                            <div className=\"space-y-4 sm:space-y-5\">\n                              {/* Status Timeline */}\n                              <div className=\"w-full py-4 sm:py-6\">\n                                <div className=\"flex items-center justify-between gap-2 sm:gap-3\">\n                                  {taskStatusWorkflow.map((statusItem, index) => {\n                                    const Icon = statusItem.icon;\n                                    const isActive = index === currentIndex;\n                                    const isCompleted = index < currentIndex;\n                                    // Onayland durumuna geri alnamaz, sadece yneticiler dier durumlara geri alabilir\n                                    const canRevert = isSuperAdmin && index < currentIndex &&\n                                      statusItem.value !== \"approved\" &&\n                                      currentTask.approvalStatus !== \"pending\";\n\n                                    return (\n                                      <div key={statusItem.value} className=\"flex items-center flex-1 min-w-0\">\n                                        <div className=\"flex flex-col items-center flex-1 min-w-0\">\n                                          <button\n                                            type=\"button\"\n                                            onClick={canRevert ? () => handleRevertStatus(inlineFormTaskId, statusItem.value) : undefined}\n                                            disabled={!canRevert}\n                                            className={cn(\n                                              \"w-12 h-12 sm:w-14 sm:h-14 md:w-16 md:h-16 rounded-full flex items-center justify-center border-2 border-solid transition-all duration-200 flex-shrink-0 touch-manipulation\",\n                                              isActive && \"bg-primary text-white border-primary shadow-lg ring-2 ring-primary/20\",\n                                              isCompleted && statusItem.value === \"approved\"\n                                                ? \"bg-green-600 text-white border-green-600 shadow-md\"\n                                                : isCompleted && statusItem.value === \"completed\"\n                                                  ? \"bg-emerald-500 text-white border-emerald-500 shadow-md\"\n                                                  : isCompleted && \"bg-emerald-500 text-white border-emerald-500 shadow-md\",\n                                              !isActive && !isCompleted && statusItem.value === \"pending\"\n                                                ? \"bg-white dark:bg-gray-800 border-amber-500 text-amber-600 dark:text-amber-500 hover:border-amber-600 hover:shadow-md hover:bg-amber-50 dark:hover:bg-amber-950/20\"\n                                                : !isActive && !isCompleted && statusItem.value === \"in_progress\"\n                                                  ? \"bg-white dark:bg-gray-800 border-blue-500 text-blue-600 dark:text-blue-500 hover:border-blue-600 hover:shadow-md hover:bg-blue-50 dark:hover:bg-blue-950/20\"\n                                                  : !isActive && !isCompleted && statusItem.value === \"completed\"\n                                                    ? \"bg-white dark:bg-gray-800 border-emerald-500 text-emerald-600 dark:text-emerald-500 hover:border-emerald-600 hover:shadow-md hover:bg-emerald-50 dark:hover:bg-emerald-950/20\"\n                                                    : !isActive && !isCompleted && statusItem.value === \"approved\"\n                                                      ? \"bg-white dark:bg-gray-800 border-green-500 text-green-600 dark:text-green-500 hover:border-green-600 hover:shadow-md hover:bg-green-50 dark:hover:bg-green-950/20\"\n                                                      : !isActive && !isCompleted && \"bg-white dark:bg-gray-800 border-gray-300 dark:border-gray-600 text-gray-500 hover:border-gray-400\",\n                                              canRevert && \"cursor-pointer hover:shadow-lg active:scale-95\",\n                                              !canRevert && \"cursor-default\"\n                                            )}\n                                            title={canRevert ? `${statusItem.label} durumuna geri al` : undefined}\n                                          >\n                                            <Icon className={cn(\n                                              \"h-5 w-5 sm:h-6 sm:w-6 md:h-7 md:w-7\",\n                                              isActive || isCompleted ? \"text-white\" : \"currentColor\"\n                                            )} />\n                                          </button>\n                                          <p className={cn(\n                                            \"text-[10px] sm:text-[11px] md:text-xs mt-2.5 sm:mt-3 text-center font-semibold leading-tight px-1 break-words\",\n                                            isActive ? \"text-primary\" : isCompleted && statusItem.value === \"approved\"\n                                              ? \"text-green-600 dark:text-green-500\"\n                                              : isCompleted && statusItem.value === \"completed\"\n                                                ? \"text-emerald-600 dark:text-emerald-500\"\n                                                : isCompleted\n                                                  ? \"text-emerald-600 dark:text-emerald-500\"\n                                                  : statusItem.value === \"pending\" ? \"text-amber-600 dark:text-amber-500\" :\n                                                    statusItem.value === \"in_progress\" ? \"text-blue-600 dark:text-blue-500\" :\n                                                      statusItem.value === \"completed\" ? \"text-emerald-600 dark:text-emerald-500\" :\n                                                        statusItem.value === \"approved\" ? \"text-green-600 dark:text-green-500\" :\n                                                          \"text-gray-600 dark:text-gray-400\"\n                                          )}>\n                                            {statusItem.label}\n                                          </p>\n                                        </div>\n                                        {index < taskStatusWorkflow.length - 1 && (\n                                          <div className={cn(\n                                            \"h-0.5 sm:h-1 flex-1 mx-2 sm:mx-3 mt-6 sm:mt-7 md:mt-8 min-w-[20px] border-t-2 border-dashed\",\n                                            isCompleted\n                                              ? taskStatusWorkflow[index + 1]?.value === \"approved\"\n                                                ? \"border-green-600\"\n                                                : \"border-emerald-500\"\n                                              : \"border-gray-300 dark:border-gray-600\"\n                                          )} />\n                                        )}\n                                      </div>\n                                    );\n                                  })}\n                                </div>\n                              </div>\n\n                              {/* Next Status Button / Onaya Gnder Button */}\n                              {(() => {\n                                // Eer grev onaylandysa ve tamamlandysa, buton gsterilmez\n                                if (currentStatus === \"completed\" && currentTask.approvalStatus === \"approved\") {\n                                  return null;\n                                }\n\n                                // Buton grev yeleri (personel, ekip lideri, ynetici) ve grevi oluturan tarafndan grntlenebilir\n                                // assignedUsers array'i bazen string array, bazen Profile array olabilir\n                                let isAssigned = false;\n                                if (currentTask.assignedUsers && Array.isArray(currentTask.assignedUsers)) {\n                                  isAssigned = currentTask.assignedUsers.some((u) => {\n                                    if (typeof u === 'string') {\n                                      return u === user?.id;\n                                    }\n                                    if (typeof u === 'object' && u !== null && 'id' in u) {\n                                      return (u as { id: string }).id === user?.id;\n                                    }\n                                    return false;\n                                  });\n                                }\n\n                                // Eer assignedUsers array'inde bulunamazsa, assignments cache'inden kontrol et\n                                if (!isAssigned && inlineFormTaskId && user?.id) {\n                                  const taskAssignments = assignmentsCacheRef.current.get(inlineFormTaskId) || [];\n                                  isAssigned = taskAssignments.some(a => a.assignedTo === user.id && a.status !== \"rejected\");\n                                }\n\n                                // Grevi oluturan kii de butonu grebilir\n                                const isCreator = currentTask.createdBy === user?.id;\n\n                                // Sadece grev yeleri (rejected hari) veya oluturan butonu grebilir\n                                if (!isAssigned && !isCreator) return null;\n\n                                // Dier durumlar iin normal gei butonu (pending -> in_progress, in_progress -> completed)\n                                // Sadece grev yeleri butonu grebilir (isAssigned kontrol yukarda yapld)\n                                // Onay bekliyor durumunda buton gsterilmez, dier durumlarda gsterilir\n                                if (nextStatus && currentTask.approvalStatus !== \"pending\") {\n                                  return (\n                                    <div className=\"flex justify-center pt-4 sm:pt-5 border-t border-primary/10\">\n                                      <Button\n                                        onClick={() => handleStatusChange(inlineFormTaskId, nextStatus.value)}\n                                        className=\"gap-2 bg-primary hover:bg-primary/90 text-white font-semibold shadow-lg hover:shadow-xl transition-all duration-200 w-full sm:w-auto min-w-[140px] sm:min-w-[160px] min-h-[44px] sm:min-h-[48px] text-sm sm:text-base px-6 sm:px-8 rounded-lg group\"\n                                        size=\"lg\"\n                                      >\n                                        {(() => {\n                                          const NextIcon = nextStatus.icon;\n                                          return <NextIcon className=\"h-4 w-4 sm:h-5 sm:w-5 transition-transform group-hover:scale-110\" />;\n                                        })()}\n                                        <ArrowRight className=\"h-4 w-4 sm:h-5 sm:w-5 transition-transform group-hover:translate-x-1\" />\n                                        <span className=\"font-semibold text-xs sm:text-sm md:text-base whitespace-nowrap\">{nextStatus.label} Aamasna Ge</span>\n                                      </Button>\n                                    </div>\n                                  );\n                                }\n\n                                return null;\n                              })()}\n\n                            </div>\n                          </CardContent>\n                        </Card>\n                      );\n                    })()}\n\n                    <TaskInlineForm\n                      key={`${inlineFormMode}-${inlineFormTaskId || \"new\"}`}\n                      mode={inlineFormMode}\n                      projectId={projectId || null}\n                      taskId={inlineFormMode === \"edit\" ? inlineFormTaskId : undefined}\n                      defaultStatus={inlineFormDefaultStatus}\n                      onCancel={closeInlineForm}\n                      onSuccess={handleInlineSuccess}\n                      className=\"border-0 shadow-none p-0\"\n                      showOnlyInMyTasks={activeFilter === \"my-tasks\"}\n                    />\n                  </div>\n                </div>\n              </div>\n            </div>\n          </DialogContent>\n        </Dialog>\n\n        {/* Liste veya Pano Grnm - Ayn erik */}\n        {viewMode === \"list\" ? (\n          <div className=\"w-full max-w-full min-w-0 overflow-x-auto\">\n            {/* Tablo Yaps */}\n            <div className=\"hidden md:block border border-[#DFE1E6] dark:border-[#38414A] rounded-sm bg-white dark:bg-[#1D2125]\" style={{ width: '100%', minWidth: `${totalTableWidth}px` }}>\n              {/* Tablo - Balklar ve erik Ayn Tabloda */}\n              <div className=\"table border-collapse\" style={{ tableLayout: 'fixed', width: '100%', minWidth: `${totalTableWidth}px` }}>\n                {/* Tablo Balklar */}\n                <div className=\"table-header-group bg-[#F4F5F7] dark:bg-[#22272B] border-b-2 border-[#DFE1E6] dark:border-[#38414A] sticky top-0 z-10 shadow-sm\">\n                  <div className=\"table-row\">\n                    <div\n                      className=\"table-cell px-3 sm:px-4 md:px-5 py-2.5 sm:py-3 cursor-pointer hover:text-[#0052CC] dark:hover:text-[#4C9AFF] hover:bg-[#EBECF0] dark:hover:bg-[#2C333A] transition-all duration-200 text-[10px] sm:text-[11px] font-semibold text-[#42526E] dark:text-[#B6C2CF] uppercase tracking-wide border-r border-[#DFE1E6] dark:border-[#38414A]\"\n                      style={{ width: columnWidths.title }}\n                      onClick={() => handleSort(\"title\")}\n                    >\n                      <div className=\"flex items-center gap-1\">\n                        Balk\n                        {sortColumn === \"title\" && (\n                          sortDirection === \"asc\" ? <ChevronUp className=\"h-3 w-3\" /> : <ChevronDown className=\"h-3 w-3\" />\n                        )}\n                      </div>\n                    </div>\n                    <div\n                      className=\"table-cell px-2 py-1 text-[10px] sm:text-[11px] font-semibold text-[#42526E] dark:text-[#B6C2CF] uppercase tracking-wide border-r border-[#DFE1E6] dark:border-[#38414A]\"\n                      style={{ width: columnWidths.project }}\n                    >\n                      Proje\n                    </div>\n                    <div\n                      className=\"table-cell px-3 sm:px-4 md:px-5 py-2.5 sm:py-3 cursor-pointer hover:text-[#0052CC] dark:hover:text-[#4C9AFF] hover:bg-[#EBECF0] dark:hover:bg-[#2C333A] transition-all duration-200 text-[10px] sm:text-[11px] font-semibold text-[#42526E] dark:text-[#B6C2CF] uppercase tracking-wide border-r border-[#DFE1E6] dark:border-[#38414A]\"\n                      style={{ width: columnWidths.status }}\n                      onClick={() => handleSort(\"status\")}\n                    >\n                      <div className=\"flex items-center gap-1\">\n                        Durum\n                        {sortColumn === \"status\" && (\n                          sortDirection === \"asc\" ? <ChevronUp className=\"h-3 w-3\" /> : <ChevronDown className=\"h-3 w-3\" />\n                        )}\n                      </div>\n                    </div>\n                    <div\n                      className=\"table-cell px-2 py-1 text-[10px] sm:text-[11px] font-semibold text-[#42526E] dark:text-[#B6C2CF] uppercase tracking-wide border-r border-[#DFE1E6] dark:border-[#38414A]\"\n                      style={{ width: columnWidths.assignee }}\n                    >\n                      Atanan\n                    </div>\n                    <div\n                      className=\"table-cell px-3 sm:px-4 md:px-5 py-2.5 sm:py-3 cursor-pointer hover:text-[#0052CC] dark:hover:text-[#4C9AFF] hover:bg-[#EBECF0] dark:hover:bg-[#2C333A] transition-all duration-200 text-[10px] sm:text-[11px] font-semibold text-[#42526E] dark:text-[#B6C2CF] uppercase tracking-wide border-r border-[#DFE1E6] dark:border-[#38414A]\"\n                      style={{ width: columnWidths.priority }}\n                      onClick={() => handleSort(\"priority\")}\n                    >\n                      <div className=\"flex items-center gap-1\">\n                        ncelik\n                        {sortColumn === \"priority\" && (\n                          sortDirection === \"asc\" ? <ChevronUp className=\"h-3 w-3\" /> : <ChevronDown className=\"h-3 w-3\" />\n                        )}\n                      </div>\n                    </div>\n                    <div\n                      className=\"table-cell px-3 sm:px-4 md:px-5 py-2.5 sm:py-3 cursor-pointer hover:text-[#0052CC] dark:hover:text-[#4C9AFF] hover:bg-[#EBECF0] dark:hover:bg-[#2C333A] transition-all duration-200 text-[10px] sm:text-[11px] font-semibold text-[#42526E] dark:text-[#B6C2CF] uppercase tracking-wide border-r border-[#DFE1E6] dark:border-[#38414A]\"\n                      style={{ width: columnWidths.dueDate }}\n                      onClick={() => handleSort(\"dueDate\")}\n                    >\n                      <div className=\"flex items-center gap-1\">\n                        Biti Tarihi\n                        {sortColumn === \"dueDate\" && (\n                          sortDirection === \"asc\" ? <ChevronUp className=\"h-3 w-3\" /> : <ChevronDown className=\"h-3 w-3\" />\n                        )}\n                      </div>\n                    </div>\n                  </div>\n                </div>\n\n                {/* Tablo erii - Ayn Tablo inde */}\n                <div\n                  ref={listContainerRef}\n                  style={{ maxHeight: 'calc(100vh - 400px)', overflowY: 'auto', display: 'table-row-group' }}\n                  onScroll={(e) => {\n                    // Infinite scroll: Kullanc listenin sonuna yaklatnda daha fazla e ykle\n                    const target = e.currentTarget;\n                    const scrollBottom = target.scrollHeight - target.scrollTop - target.clientHeight;\n                    if (scrollBottom < 500 && visibleItemsCount < listData.length) {\n                      setVisibleItemsCount(prev => Math.min(prev + 25, listData.length));\n                    }\n                  }}\n                >\n                  {/* \"Bana Atanan\" sekmesi kaldrld - grevler sadece proje altnda ve \"Tm Grevler\" sekmesinde gzkyor */}\n                  {false && userRequests.length > 0 && (\n                    <div className=\"mb-6\">\n                      <h3 className=\"text-[15px] sm:text-[16px] font-semibold mb-3 flex items-center gap-2\">\n                        <span className=\"w-2 h-2 rounded-full bg-blue-500\"></span>\n                        Taleplerim\n                      </h3>\n                      <div className=\"grid gap-3 grid-cols-1 sm:grid-cols-2 lg:grid-cols-3\">\n                        {userRequests.map(req => (\n                          <div key={req.id} className=\"p-4 rounded-lg border bg-white hover:shadow-sm transition-shadow cursor-pointer\" onClick={() => navigate('/requests')}>\n                            <div className=\"flex justify-between items-start mb-2\">\n                              <Badge variant=\"outline\">{req.type === 'leave' ? 'zin' : req.type === 'purchase' ? 'Satn Alma' : 'Dier'}</Badge>\n                              <Badge className={\n                                req.status === 'approved' ? 'bg-emerald-500' :\n                                  req.status === 'rejected' ? 'bg-destructive' : 'bg-yellow-500'\n                              }>\n                                {req.status === 'approved' ? 'Onayland' : req.status === 'rejected' ? 'Reddedildi' : 'Bekliyor'}\n                              </Badge>\n                            </div>\n                            <h4 className=\"font-medium truncate\">{req.title}</h4>\n                            <p className=\"text-[11px] sm:text-xs text-muted-foreground truncate\">{req.description}</p>\n                            <div className=\"mt-2 text-[11px] sm:text-xs text-muted-foreground\">\n                              {req.createdAt instanceof Object ? new Date(req.createdAt.seconds * 1000).toLocaleDateString('tr-TR') : '-'}\n                            </div>\n                          </div>\n                        ))}\n                      </div>\n                      <div className=\"my-4 border-b\" />\n                      <h3 className=\"text-[15px] sm:text-[16px] font-semibold mb-3 flex items-center gap-2\">\n                        <span className=\"w-2 h-2 rounded-full bg-emerald-500\"></span>\n                        Grevlerim\n                      </h3>\n                    </div>\n                  )}\n\n                  {(Array.isArray(listData) ? listData.slice(0, visibleItemsCount) : []).map((task: FirebaseTask) => {\n                    const overdue = isTaskOverdue(task);\n                    const dueSoon = isTaskDueSoon(task);\n                    const optimisticUpdate = optimisticUpdates.get(task.id);\n                    // Status' normalize et (column_ prefix'ini kaldr)\n                    const rawStatus = optimisticUpdate ? optimisticUpdate.status : task.status;\n                    let displayStatus = normalizeStatus(rawStatus);\n                    // Eer grev tamamland ve onaylandysa, \"Onayland\" olarak gster\n                    if (displayStatus === \"completed\" && task.approvalStatus === \"approved\") {\n                      displayStatus = \"approved\";\n                    }\n                    const isOptimistic = !!optimisticUpdate;\n                    const isSelected = selectedTaskIds.has(task.id);\n                    // Geciken grevler iin daha belirgin grsel iaret\n                    const overdueClass = overdue ? \"ring-2 ring-destructive/50 bg-destructive/5\" : \"\";\n                    // Yaklaan grevler iin subtle uyar\n                    const dueSoonClass = dueSoon && !overdue ? \"bg-amber-50/50 dark:bg-amber-950/10\" : \"\";\n\n                    // Atanan kullanclar bul\n                    const taskAssignments = assignmentsCacheRef.current.get(task.id) || [];\n                    const assignedUserIds = taskAssignments.map(a => a.assignedTo);\n                    const assignedUsers = cachedUsers.filter(u => assignedUserIds.includes(u.id));\n\n                    // Due date'i al\n                    const taskObj = task as { due_date?: string; dueDate?: Timestamp | Date | string };\n                    let dueDate: string | null = null;\n                    if ('due_date' in taskObj && taskObj.due_date && typeof taskObj.due_date === 'string') {\n                      dueDate = taskObj.due_date;\n                    } else if ('dueDate' in taskObj && taskObj.dueDate) {\n                      if (taskObj.dueDate instanceof Timestamp) {\n                        dueDate = taskObj.dueDate.toDate().toISOString();\n                      } else if (taskObj.dueDate instanceof Date) {\n                        dueDate = taskObj.dueDate.toISOString();\n                      } else if (typeof taskObj.dueDate === 'string') {\n                        dueDate = taskObj.dueDate;\n                      }\n                    }\n\n                    const priorityDisplay = getPriorityDisplay(task.priority);\n\n                    // Silme yetkisi kontrol\n                    const canDeleteThisTask = taskDeletePermissions.get(task.id) ?? false;\n\n                    // Grev dzenleme yetkisi kontrol\n                    // Personel rolndeki kullanclar dzenleme yapamaz\n                    // Sadece grevi oluturan kii, super admin veya canUpdate yetkisi olanlar dzenleyebilir\n                    const isPersonnel = user?.roles?.includes(\"personnel\") || false;\n                    const canEditThisTask = !isPersonnel && (isSuperAdmin || canUpdate || task.createdBy === user?.id);\n\n                    // Durum deitirme yetkisi kontrol\n                    // SADECE grev yesi (rejected hari) veya oluturan durum deitirebilir\n                    // Yneticiler iin zel durum YOK\n                    const isCreator = task.createdBy === user?.id;\n                    // nce taskAssignments'tan kontrol et (rejected hari)\n                    const isAssignedFromAssignments = taskAssignments.some(a => a.assignedTo === user?.id && a.status !== \"rejected\");\n                    // Fallback: task.assignedUsers array'inden kontrol et\n                    const isAssignedFromTask = Array.isArray(task.assignedUsers) && task.assignedUsers.includes(user?.id || \"\");\n                    const isAssigned = isAssignedFromAssignments || isAssignedFromTask;\n                    const canChangeStatusForThisTask = isAssigned || isCreator;\n\n                    return (\n                      <article\n                        key={task.id}\n                        ref={(el: HTMLElement | null) => {\n                          const index = listData.slice(0, visibleItemsCount).findIndex(t => t.id === task.id);\n                          if (index >= 0) {\n                            taskRefs.current[index] = el;\n                          }\n                        }}\n                        className={cn(\n                          \"table-row group\",\n                          \"border-b border-[#DFE1E6] dark:border-[#38414A] hover:bg-[#F4F5F7] dark:hover:bg-[#22272B] transition-all duration-200 cursor-pointer\",\n                          \"bg-white dark:bg-[#1D2125]\",\n                          isSelected && \"bg-[#E3FCEF] dark:bg-[#1C3329] border-l-4 border-l-[#006644] dark:border-l-[#4BCE97]\",\n                          overdue && \"bg-[#FFEBE6] dark:bg-[#3D2115] border-l-4 border-l-[#DE350B] dark:border-l-[#FF5630]\",\n                          dueSoon && !overdue && \"bg-[#FFF7E6] dark:bg-[#3D2E1A] border-l-4 border-l-[#FF8B00] dark:border-l-[#F5CD47]\",\n                          isOptimistic && \"opacity-60\",\n                          focusedTaskIndex === listData.slice(0, visibleItemsCount).findIndex(t => t.id === task.id) && \"ring-2 ring-[#0052CC] dark:ring-[#4C9AFF] ring-offset-2 shadow-md\"\n                        )}\n                        role=\"article\"\n                        aria-labelledby={`task-title-${task.id}`}\n                        tabIndex={focusedTaskIndex === listData.slice(0, visibleItemsCount).findIndex(t => t.id === task.id) ? 0 : -1}\n                        onClick={() => !isMultiSelectMode && openTaskDetail(task.id, task.status)}\n                      >\n                        {/* Title */}\n                        <div\n                          className=\"table-cell px-2 py-1 align-middle border-r border-[#DFE1E6] dark:border-[#38414A] cursor-pointer\"\n                          style={{ width: columnWidths.title }}\n                          onClick={(e) => {\n                            e.stopPropagation();\n                            openTaskDetail(task.id, task.status);\n                          }}\n                        >\n                          <h3\n                            id={`task-title-${task.id}`}\n                            className=\"font-semibold text-[11px] sm:text-xs text-[#172B4D] dark:text-[#B6C2CF] line-clamp-1 hover:text-[#0052CC] dark:hover:text-[#4C9AFF] transition-colors leading-tight\"\n                          >\n                            {task.title}\n                          </h3>\n                        </div>\n\n                        {/* Project */}\n                        <div className=\"table-cell px-2 py-1 align-middle border-r border-[#DFE1E6] dark:border-[#38414A]\" style={{ width: columnWidths.project }}>\n                          {task.projectId && projects && projects.has(task.projectId) ? (\n                            <Badge\n                              variant=\"outline\"\n                              className=\"h-3.5 px-1.5 text-[9px] font-medium border-[#DFE1E6] dark:border-[#38414A] text-[#42526E] dark:text-[#B6C2CF] bg-[#F4F5F7] dark:bg-[#22272B] leading-tight inline-flex\"\n                            >\n                              {projects.get(task.projectId)?.name || task.projectId}\n                            </Badge>\n                          ) : (\n                            <span className=\"text-[10px] sm:text-[11px] text-[#6B778C] dark:text-[#8C9CB8]\">-</span>\n                          )}\n                        </div>\n\n                        {/* Status - Inline Editable */}\n                        <div onClick={(e) => e.stopPropagation()} className=\"table-cell px-2 py-1 align-middle border-r border-[#DFE1E6] dark:border-[#38414A]\" style={{ width: columnWidths.status }}>\n                          <Select\n                            value={displayStatus}\n                            onValueChange={(newStatus) => {\n                              handleStatusChange(task.id, newStatus);\n                            }}\n                            disabled={!canChangeStatusForThisTask}\n                          >\n                            <SelectTrigger\n                              className={cn(\n                                \"h-auto min-h-[24px] px-1.5 py-0.5 text-[10px] sm:text-xs border-0 bg-transparent rounded-full w-full transition-all duration-200 flex items-center justify-center group\",\n                                canChangeStatusForThisTask\n                                  ? \"hover:bg-[#EBECF0] dark:hover:bg-[#2C333A] cursor-pointer hover:shadow-md focus:ring-2 focus:ring-[#0052CC]/50 focus:ring-offset-2 active:scale-[0.97] focus-visible:outline-none\"\n                                  : \"cursor-not-allowed opacity-60\"\n                              )}\n                            >\n                              <SelectValue>\n                                <Badge\n                                  variant=\"secondary\"\n                                  className={cn(\n                                    \"h-3.5 px-1.5 text-[9px] sm:text-[10px] font-semibold border-0 leading-tight rounded-full inline-flex items-center justify-center gap-0.5 transition-all duration-200 shadow-sm whitespace-nowrap\",\n                                    displayStatus === \"approved\" && \"bg-[#E3FCEF] text-[#006644] dark:bg-[#1C3329] dark:text-[#4BCE97] hover:bg-[#D3FCE3] dark:hover:bg-[#2A4A3A]\",\n                                    displayStatus === \"completed\" && \"bg-[#E3FCEF] text-[#006644] dark:bg-[#1C3329] dark:text-[#4BCE97] hover:bg-[#D3FCE3] dark:hover:bg-[#2A4A3A]\",\n                                    displayStatus === \"in_progress\" && \"bg-[#DEEBFF] text-[#0052CC] dark:bg-[#1C2B41] dark:text-[#4C9AFF] hover:bg-[#CEDBEF] dark:hover:bg-[#2A3B51]\",\n                                    displayStatus === \"pending\" && \"bg-[#DEEBFF] text-[#0052CC] dark:bg-[#1C2B41] dark:text-[#4C9AFF] hover:bg-[#CEDBEF] dark:hover:bg-[#2A3B51]\",\n                                    isOptimistic && \"opacity-50\",\n                                    canChangeStatusForThisTask && \"group-hover:shadow-md\"\n                                  )}\n                                >\n                                  {(() => {\n                                    const statusItem = taskStatusWorkflow.find(s => s.value === displayStatus);\n                                    if (statusItem) {\n                                      const Icon = statusItem.icon;\n                                      return (\n                                        <>\n                                          <Icon className=\"h-3 w-3 flex-shrink-0\" />\n                                          <span className=\"whitespace-nowrap text-[9px] sm:text-[10px]\">{getStatusLabel(displayStatus)}</span>\n                                        </>\n                                      );\n                                    }\n                                    return <span className=\"whitespace-nowrap text-[9px] sm:text-[10px]\">{getStatusLabel(displayStatus)}</span>;\n                                  })()}\n                                </Badge>\n                              </SelectValue>\n                            </SelectTrigger>\n                            <SelectContent className=\"min-w-[180px] p-1.5 shadow-lg border border-[#DFE1E6] dark:border-[#38414A] rounded-lg\">\n                              {taskStatusWorkflow.map((statusItem) => {\n                                const Icon = statusItem.icon;\n                                const isSelected = statusItem.value === displayStatus;\n                                return (\n                                  <SelectItem\n                                    key={statusItem.value}\n                                    value={statusItem.value}\n                                    className={cn(\n                                      \"cursor-pointer rounded-md px-3 py-2.5 transition-all duration-150\",\n                                      \"hover:bg-[#EBECF0] dark:hover:bg-[#2C333A] hover:text-foreground\",\n                                      \"focus:bg-[#EBECF0] dark:focus:bg-[#2C333A] focus:text-foreground\",\n                                      \"focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[#0052CC]/50 focus-visible:ring-offset-1\",\n                                      \"data-[highlighted]:bg-[#EBECF0] data-[highlighted]:dark:bg-[#2C333A] data-[highlighted]:text-foreground\",\n                                      isSelected && \"bg-[#EBECF0] dark:bg-[#2C333A] font-semibold\"\n                                    )}\n                                  >\n                                    <div className=\"flex items-center gap-2.5\">\n                                      <Icon className={cn(\"h-3 w-3 flex-shrink-0\", statusItem.color)} />\n                                      <span className=\"text-[10px] sm:text-[11px] font-medium\">{statusItem.label}</span>\n                                    </div>\n                                  </SelectItem>\n                                );\n                              })}\n                            </SelectContent>\n                          </Select>\n                        </div>\n\n                        {/* Assignee - Inline Editable - Tm atanan kiileri gster */}\n                        <div className=\"table-cell px-2 py-1 align-middle border-r border-[#DFE1E6] dark:border-[#38414A]\" style={{ width: columnWidths.assignee }} onClick={(e) => e.stopPropagation()}>\n                          <Popover>\n                            <PopoverTrigger asChild>\n                              <button className=\"flex items-center gap-1 hover:opacity-80 transition-opacity w-full\">\n                                {assignedUsers.length > 0 ? (\n                                  <div className=\"flex items-center gap-1 flex-wrap\">\n                                    {assignedUsers.map((user, index) => {\n                                      const firstName = getFirstName(user.fullName);\n                                      return (\n                                        <span\n                                          key={user.id}\n                                          className=\"text-[10px] sm:text-[11px] text-[#42526E] dark:text-[#B6C2CF] font-medium truncate max-w-[120px]\"\n                                          title={user.fullName || user.email}\n                                        >\n                                          {firstName || user.email}\n                                          {index < assignedUsers.length - 1 && <span className=\"text-[#6B778C] dark:text-[#8C9CB8] ml-0.5\">,</span>}\n                                        </span>\n                                      );\n                                    })}\n                                  </div>\n                                ) : (\n                                  <span className=\"text-[10px] sm:text-[11px] text-[#6B778C] dark:text-[#8C9CB8] cursor-pointer hover:text-[#0052CC] dark:hover:text-[#4C9AFF] transition-colors\">-</span>\n                                )}\n                              </button>\n                            </PopoverTrigger>\n                            <PopoverContent className=\"w-64 p-1.5\" align=\"start\">\n                              <div className=\"space-y-1.5\">\n                                <div className=\"text-[10px] sm:text-[11px] font-semibold mb-1.5 px-1\">Kullanc Ata</div>\n                                <Command>\n                                  <CommandInput placeholder=\"Kullanc ara...\" className=\"text-[11px] sm:text-xs !h-9 !py-2\" />\n                                  <CommandList>\n                                    <CommandEmpty className=\"text-[10px] sm:text-[11px] py-4\">Kullanc bulunamad</CommandEmpty>\n                                    <CommandGroup>\n                                      {cachedUsers.map((user) => {\n                                        const isAssigned = assignedUserIds.includes(user.id);\n                                        return (\n                                          <CommandItem\n                                            key={user.id}\n                                            onSelect={async () => {\n                                              if (!isAssigned && user?.id) {\n                                                try {\n                                                  await assignTask(task.id, user.id, user?.id || \"\");\n                                                  const firstName = getFirstName(user.fullName || user.displayName);\n                                                  toast.success(`${firstName || user.email} greve atand`);\n                                                } catch (error) {\n                                                  toast.error(\"Kullanc atanrken hata olutu\");\n                                                }\n                                              }\n                                            }}\n                                            className={cn(\"px-2 py-1.5\", isAssigned && \"opacity-50\")}\n                                          >\n                                            <div className=\"flex items-center gap-2 w-full\">\n                                              <Avatar className=\"h-5 w-5\">\n                                                <AvatarFallback className=\"text-[9px]\">\n                                                  {getInitials(user.fullName || user.email)}\n                                                </AvatarFallback>\n                                              </Avatar>\n                                              <span className=\"flex-1 text-[11px] sm:text-xs\" title={user.fullName || user.email}>\n                                                {getFirstName(user.fullName || user.displayName) || user.email}\n                                              </span>\n                                              {isAssigned && <Check className=\"h-3 w-3 text-primary\" />}\n                                            </div>\n                                          </CommandItem>\n                                        );\n                                      })}\n                                    </CommandGroup>\n                                  </CommandList>\n                                </Command>\n                              </div>\n                            </PopoverContent>\n                          </Popover>\n                        </div>\n\n                        {/* Priority - Inline Editable */}\n                        <div onClick={(e) => e.stopPropagation()} className=\"table-cell px-2 py-1 align-middle border-r border-[#DFE1E6] dark:border-[#38414A]\" style={{ width: columnWidths.priority }}>\n                          <Select\n                            value={String(task.priority || 1)}\n                            onValueChange={async (newPriority) => {\n                              try {\n                                // Yeni 0-5 sistemini eski 1-5 sistemine evir (backend uyumluluu iin)\n                                const oldPriority = convertNewPriorityToOld(Number(newPriority) as PriorityLevel);\n                                await updateTask(task.id, { priority: oldPriority as 1 | 2 | 3 | 4 | 5 }, user?.id);\n                                toast.success(\"ncelik gncellendi\");\n                              } catch (error) {\n                                toast.error(\"ncelik gncellenirken hata olutu\");\n                              }\n                            }}\n                            disabled={!canEditThisTask}\n                          >\n                            <SelectTrigger\n                              className={cn(\n                                \"h-auto min-h-[22px] px-1.5 py-0.5 text-[10px] sm:text-[11px] border-0 bg-transparent rounded-md w-full transition-all duration-200 group\",\n                                canEditThisTask\n                                  ? \"hover:bg-[#EBECF0] dark:hover:bg-[#2C333A] cursor-pointer hover:shadow-sm focus:ring-2 focus:ring-[#0052CC]/50 focus:ring-offset-2 active:scale-[0.97] focus-visible:outline-none\"\n                                  : \"cursor-not-allowed opacity-60\"\n                              )}\n                            >\n                              <SelectValue>\n                                <span className={cn(\"text-[10px] sm:text-[11px] font-medium\", priorityDisplay.color)}>\n                                  {priorityDisplay.label}\n                                </span>\n                              </SelectValue>\n                            </SelectTrigger>\n                            <SelectContent className=\"min-w-[160px] p-1.5 shadow-lg border border-[#DFE1E6] dark:border-[#38414A] rounded-lg\">\n                              {[\n                                { value: \"1\", label: \"ok Dk\", icon: ChevronDown, color: \"text-blue-600 dark:text-blue-400\", bgColor: \"bg-blue-50 dark:bg-blue-950/30\" },\n                                { value: \"2\", label: \"Dk\", icon: ChevronDown, color: \"text-blue-600 dark:text-blue-400\", bgColor: \"bg-blue-50 dark:bg-blue-950/30\" },\n                                { value: \"3\", label: \"Orta\", icon: Minus, color: \"text-gray-600 dark:text-gray-400\", bgColor: \"bg-gray-50 dark:bg-gray-900/30\" },\n                                { value: \"4\", label: \"Yksek\", icon: ChevronUp, color: \"text-red-600 dark:text-red-400\", bgColor: \"bg-red-50 dark:bg-red-950/30\" },\n                                { value: \"5\", label: \"Kritik\", icon: ChevronUp, color: \"text-red-600 dark:text-red-400\", bgColor: \"bg-red-50 dark:bg-red-950/30\" },\n                              ].map((priorityItem) => {\n                                const Icon = priorityItem.icon;\n                                const isSelected = priorityItem.value === String(task.priority || 1);\n                                return (\n                                  <SelectItem\n                                    key={priorityItem.value}\n                                    value={priorityItem.value}\n                                    className={cn(\n                                      \"cursor-pointer rounded-md px-3 py-2.5 transition-all duration-150\",\n                                      \"hover:bg-[#EBECF0] dark:hover:bg-[#2C333A] hover:text-foreground\",\n                                      \"focus:bg-[#EBECF0] dark:focus:bg-[#2C333A] focus:text-foreground\",\n                                      \"focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[#0052CC]/50 focus-visible:ring-offset-1\",\n                                      \"data-[highlighted]:bg-[#EBECF0] data-[highlighted]:dark:bg-[#2C333A] data-[highlighted]:text-foreground\",\n                                      isSelected && \"bg-[#EBECF0] dark:bg-[#2C333A] font-semibold\"\n                                    )}\n                                  >\n                                    <div className=\"flex items-center gap-2.5\">\n                                      <div className={cn(\"p-1 rounded-md\", priorityItem.bgColor)}>\n                                        <Icon className={cn(\"h-3 w-3\", priorityItem.color)} />\n                                      </div>\n                                      <span className=\"text-[10px] sm:text-[11px] font-medium\">{priorityItem.label}</span>\n                                    </div>\n                                  </SelectItem>\n                                );\n                              })}\n                            </SelectContent>\n                          </Select>\n                        </div>\n\n                        {/* Due Date */}\n                        <div className=\"table-cell px-2 py-1 align-middle border-r border-[#DFE1E6] dark:border-[#38414A]\" style={{ width: columnWidths.dueDate }}>\n                          {dueDate ? (\n                            <div className={cn(\n                              \"inline-flex items-center gap-1 px-1.5 py-0.5 rounded-full text-[10px] sm:text-[11px] font-medium leading-tight\",\n                              overdue\n                                ? \"bg-[#FFEBE6] text-[#DE350B] dark:bg-[#3D2115] dark:text-[#FF5630] border border-[#FF5630]/30\"\n                                : dueSoon\n                                  ? \"bg-[#FFF7E6] text-[#FF8B00] dark:bg-[#3D2E1A] dark:text-[#F5CD47] border border-[#FF8B00]/30\"\n                                  : \"text-[#42526E] dark:text-[#B6C2CF]\"\n                            )}>\n                              {overdue && <AlertCircle className=\"h-3 w-3\" />}\n                              {!overdue && <CalendarDays className=\"h-3 w-3\" />}\n                              <span className=\"whitespace-nowrap\">{formatDueDate(dueDate)}</span>\n                            </div>\n                          ) : (\n                            <span className=\"text-[10px] sm:text-[11px] text-[#6B778C] dark:text-[#8C9CB8]\">-</span>\n                          )}\n                        </div>\n                      </article>\n                    );\n                  })}\n                </div>\n              </div>\n            </div>\n\n            {/* Mobil Grnm - Basitletirilmi */}\n            {(Array.isArray(listData) ? listData.slice(0, visibleItemsCount) : []).map((task: FirebaseTask) => {\n              const overdue = isTaskOverdue(task);\n              const dueSoon = isTaskDueSoon(task);\n              const optimisticUpdate = optimisticUpdates.get(task.id);\n              const rawStatus = optimisticUpdate ? optimisticUpdate.status : task.status;\n              let displayStatus = normalizeStatus(rawStatus);\n              // Eer grev tamamland ve onaylandysa, \"Onayland\" olarak gster\n              if (displayStatus === \"completed\" && task.approvalStatus === \"approved\") {\n                displayStatus = \"approved\";\n              }\n              const isOptimistic = !!optimisticUpdate;\n              const isSelected = selectedTaskIds.has(task.id);\n\n              const taskAssignments = assignmentsCacheRef.current.get(task.id) || [];\n              const assignedUserIds = taskAssignments.map(a => a.assignedTo);\n              const assignedUsers = cachedUsers.filter(u => assignedUserIds.includes(u.id));\n\n              const taskObj = task as { due_date?: string; dueDate?: Timestamp | Date | string };\n              let dueDate: string | null = null;\n              if ('due_date' in taskObj && taskObj.due_date && typeof taskObj.due_date === 'string') {\n                dueDate = taskObj.due_date;\n              } else if ('dueDate' in taskObj && taskObj.dueDate) {\n                if (taskObj.dueDate instanceof Timestamp) {\n                  dueDate = taskObj.dueDate.toDate().toISOString();\n                } else if (taskObj.dueDate instanceof Date) {\n                  dueDate = taskObj.dueDate.toISOString();\n                } else if (typeof taskObj.dueDate === 'string') {\n                  dueDate = taskObj.dueDate;\n                }\n              }\n\n              const priorityDisplay = getPriorityDisplay(task.priority);\n\n              // Silme yetkisi kontrol\n              const canDeleteThisTask = taskDeletePermissions.get(task.id) ?? false;\n\n              return (\n                <article\n                  key={`mobile-${task.id}`}\n                  className={cn(\n                    \"md:hidden p-1.5 border-b border-[#DFE1E6] dark:border-[#38414A] w-full\",\n                    \"bg-white dark:bg-[#1D2125]\",\n                    isSelected ? \"bg-[#E3FCEF] dark:bg-[#1C3329]\" : \"\",\n                    overdue && \"bg-[#FFEBE6] dark:bg-[#3D2115]\",\n                    dueSoon && !overdue && \"bg-[#FFF7E6] dark:bg-[#3D2E1A]\",\n                    \"hover:bg-[#F4F5F7] dark:hover:bg-[#22272B] transition-colors\",\n                    isOptimistic && \"opacity-75 animate-pulse\"\n                  )}\n                  onClick={() => openTaskDetail(task.id, task.status)}\n                >\n                  <div className=\"flex items-start gap-1.5\">\n                    <div className=\"flex-shrink-0 scale-75\">\n                      {getStatusIcon(displayStatus)}\n                    </div>\n                    <div className=\"flex-1 min-w-0\">\n                      <div className=\"flex items-center gap-1.5 mb-0.5\">\n                        <h3 className=\"font-medium text-[12px] text-[#172B4D] dark:text-[#B6C2CF] line-clamp-1 flex-1 leading-tight\">\n                          {task.title}\n                        </h3>\n                        <span className=\"text-[10px] font-mono text-[#42526E] dark:text-[#B6C2CF]\">\n                          {formatTaskKey(task.id)}\n                        </span>\n                      </div>\n                      <div className=\"flex items-center gap-1 flex-wrap\">\n                        <Badge\n                          variant=\"secondary\"\n                          className={cn(\n                            \"h-4 px-1.5 py-0 text-[10px] font-normal border-0 leading-tight\",\n                            displayStatus === \"approved\" && \"bg-[#E3FCEF] text-[#006644] dark:bg-[#1C3329] dark:text-[#4BCE97]\",\n                            displayStatus === \"completed\" && \"bg-[#E3FCEF] text-[#006644] dark:bg-[#1C3329] dark:text-[#4BCE97]\",\n                            displayStatus === \"in_progress\" && \"bg-[#DEEBFF] text-[#0052CC] dark:bg-[#1C2B41] dark:text-[#4C9AFF]\",\n                            displayStatus === \"pending\" && \"bg-[#F4F5F7] text-[#42526E] dark:bg-[#2C333A] dark:text-[#B6C2CF]\"\n                          )}\n                        >\n                          {getStatusLabel(displayStatus)}\n                        </Badge>\n                        <Badge\n                          className={cn(\n                            \"h-4 px-1.5 py-0 text-[10px] font-normal border-0 leading-tight\",\n                            task.priority === 5 && \"bg-[#FFEBE6] text-[#BF2600] dark:bg-[#3D2115] dark:text-[#FF5630]\",\n                            task.priority === 4 && \"bg-[#FFE6E6] text-[#DE350B] dark:bg-[#3D2115] dark:text-[#FF5630]\",\n                            task.priority === 3 && \"bg-[#FFF7E6] text-[#FF8B00] dark:bg-[#3D2E1A] dark:text-[#F5CD47]\",\n                            task.priority === 2 && \"bg-[#E3FCEF] text-[#006644] dark:bg-[#1C3329] dark:text-[#4BCE97]\",\n                            (!task.priority || task.priority === 1) && \"bg-[#F4F5F7] text-[#42526E] dark:bg-[#2C333A] dark:text-[#B6C2CF]\"\n                          )}\n                        >\n                          {priorityDisplay.label}\n                        </Badge>\n                        {dueDate && (\n                          <time\n                            dateTime={dueDate}\n                            className={cn(\n                              \"text-[10px] flex items-center gap-0.5 leading-tight\",\n                              overdue ? \"text-[#DE350B] dark:text-[#FF5630]\" : dueSoon ? \"text-[#FF8B00] dark:text-[#F5CD47]\" : \"text-[#42526E] dark:text-[#B6C2CF]\"\n                            )}\n                          >\n                            <CalendarDays className=\"h-2.5 w-2.5\" />\n                            {formatDueDate(dueDate)}\n                          </time>\n                        )}\n                        {assignedUsers.length > 0 && (\n                          <div className=\"flex items-center -space-x-0.5\">\n                            {assignedUsers.slice(0, 2).map((user) => (\n                              <Avatar key={user.id} className=\"h-4 w-4 border border-[#DFE1E6] dark:border-[#38414A]\" title={user.fullName || user.email}>\n                                <AvatarFallback className=\"text-[8px] bg-[#DFE1E6] dark:bg-[#38414A] text-[#42526E] dark:text-[#B6C2CF]\">\n                                  {getInitials(user.fullName || user.email)}\n                                </AvatarFallback>\n                              </Avatar>\n                            ))}\n                          </div>\n                        )}\n                      </div>\n                    </div>\n                  </div>\n                </article>\n              );\n            })}\n\n            {/* Infinite scroll loading indicator */}\n            {listData.length > visibleItemsCount && (\n              <div className=\"py-8 text-center\">\n                <Button\n                  variant=\"outline\"\n                  onClick={() => setVisibleItemsCount(prev => Math.min(prev + 25, listData.length))}\n                  className=\"text-sm transition-all duration-200 hover:scale-105\"\n                >\n                  <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />\n                  Daha Fazla Ykle ({listData.length - visibleItemsCount} grev kald)\n                </Button>\n              </div>\n            )}\n\n            {listData.length === 0 && (\n              <div\n                className=\"py-16 sm:py-20 text-center text-muted-foreground border-2 border-dashed rounded-xl bg-muted/30\"\n                role=\"status\"\n                aria-live=\"polite\"\n              >\n                <div className=\"flex flex-col items-center gap-4 max-w-md mx-auto px-4\">\n                  <div className=\"rounded-full bg-muted p-4\">\n                    <CheckSquare className=\"h-12 w-12 sm:h-16 sm:w-16 text-muted-foreground/50\" aria-hidden=\"true\" />\n                  </div>\n                  <div className=\"space-y-2\">\n                    <h2 className=\"text-[18px] sm:text-[20px] font-semibold text-foreground\">\n                      {searchTerm || statusFilter !== \"all\" || focusFilter !== \"all\"\n                        ? \"Filtre kriterlerinize uyan grev bulunamad\"\n                        : activeFilter === \"my-tasks\"\n                          ? \"Henz size atanan grev yok\"\n                          : activeFilter === \"archive\"\n                            ? \"Arivde grev bulunmuyor\"\n                            : \"Henz grev bulunmuyor\"}\n                    </h2>\n                    <p className=\"text-sm sm:text-base text-muted-foreground\">\n                      {searchTerm || statusFilter !== \"all\" || focusFilter !== \"all\" || selectedProject !== \"all\"\n                        ? \"Aktif filtreleriniz sonu bulamad. Filtreleri deitirerek tekrar deneyin.\"\n                        : activeFilter === \"my-tasks\"\n                          ? \"Size atanan grevler burada grnecek\"\n                          : activeFilter === \"archive\"\n                            ? \"Arivlenen grevler burada grnecek\"\n                            : \"lk grevinizi oluturarak balayabilirsiniz\"}\n                    </p>\n                    {/* Aktif filtreleri gster */}\n                    {(searchTerm || statusFilter !== \"all\" || focusFilter !== \"all\" || selectedProject !== \"all\") && (\n                      <div className=\"flex flex-wrap items-center justify-center gap-2 mt-3\">\n                        <span className=\"text-xs text-muted-foreground font-medium\">Aktif Filtreler:</span>\n                        {searchTerm && (\n                          <Badge variant=\"secondary\" className=\"text-xs\">\n                            Arama: \"{searchTerm}\"\n                          </Badge>\n                        )}\n                        {statusFilter !== \"all\" && (\n                          <Badge variant=\"secondary\" className=\"text-xs\">\n                            Durum: {getStatusLabel(statusFilter)}\n                          </Badge>\n                        )}\n                        {focusFilter !== \"all\" && (\n                          <Badge variant=\"secondary\" className=\"text-xs\">\n                            Odak: {focusFilter === \"due_soon\" ? \"Yaklaan\" : focusFilter === \"overdue\" ? \"Gecikti\" : focusFilter === \"high_priority\" ? \"Yksek ncelik\" : focusFilter}\n                          </Badge>\n                        )}\n                        {selectedProject !== \"all\" && (\n                          <Badge variant=\"secondary\" className=\"text-xs\">\n                            Proje: {selectedProject === \"general\" ? \"Genel\" : projects?.get(selectedProject)?.name || selectedProject}\n                          </Badge>\n                        )}\n                      </div>\n                    )}\n                  </div>\n                  {(searchTerm || statusFilter !== \"all\" || focusFilter !== \"all\" || selectedProject !== \"all\") ? (\n                    <Button\n                      variant=\"outline\"\n                      onClick={() => {\n                        setSearchTerm(\"\");\n                        setStatusFilter(\"all\");\n                        setFocusFilter(\"all\");\n                        setSelectedProject(\"all\");\n                        setProjectFilter(\"all\");\n                      }}\n                      className=\"mt-2\"\n                      aria-label=\"Filtreleri temizle\"\n                    >\n                      <X className=\"h-4 w-4 mr-2\" />\n                      Filtreleri Temizle\n                    </Button>\n                  ) : canCreate ? (\n                    <Button\n                      onClick={async () => {\n                        if (!user) return;\n                        try {\n                          const departments = await getDepartments();\n                          const userProfile: UserProfile = {\n                            id: user.id,\n                            email: user.email,\n                            emailVerified: user.emailVerified,\n                            fullName: user.fullName,\n                            displayName: user.fullName,\n                            phone: user.phone,\n                            dateOfBirth: user.dateOfBirth,\n                            role: user.roles,\n                            createdAt: Timestamp.now(),\n                            updatedAt: Timestamp.now(),\n                          };\n                          const hasPermission = await canCreateTask(userProfile, departments);\n                          if (!hasPermission) {\n                            toast.error(\"Grev oluturma yetkiniz yok\");\n                            return;\n                          }\n                          openInlineForm(\"create\");\n                        } catch (error: unknown) {\n                          console.error(\"Permission check error:\", error);\n                          toast.error(\"Yetki kontrol yaplamad\");\n                        }\n                      }}\n                      className=\"mt-2\"\n                      aria-label=\"Yeni grev olutur\"\n                    >\n                      <Plus className=\"h-4 w-4 mr-2\" />\n                      lk Grevinizi Oluturun\n                    </Button>\n                  ) : null}\n                </div>\n              </div>\n            )}\n          </div>\n        ) : (\n          <div className=\"w-full max-w-full min-w-0\">\n            <TaskBoard\n              tasks={boardTasks}\n              onTaskClick={(taskId, initialStatus) => openTaskDetail(taskId, initialStatus)}\n              onStatusChange={handleStatusChange}\n              showArchived={activeFilter === \"archive\"}\n            />\n          </div>\n        )}\n\n        {/* Advanced Search Dialog */}\n        <Dialog open={advancedSearchOpen} onOpenChange={setAdvancedSearchOpen}>\n          <DialogContent className=\"max-w-2xl max-h-[90vh] overflow-y-auto\">\n            <DialogHeader>\n              <DialogTitle>Gelimi Arama</DialogTitle>\n              <DialogDescription>\n                Grevleri detayl kriterlere gre arayn ve filtreleyin\n              </DialogDescription>\n            </DialogHeader>\n            <div className=\"space-y-4 py-4\">\n              <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-4\">\n                <div>\n                  <Label htmlFor=\"search-title\">Balk</Label>\n                  <Input\n                    id=\"search-title\"\n                    value={advancedSearchFilters.title}\n                    onChange={(e) => setAdvancedSearchFilters(prev => ({ ...prev, title: e.target.value }))}\n                    placeholder=\"Balkta ara...\"\n                    className=\"mt-1\"\n                  />\n                </div>\n                <div>\n                  <Label htmlFor=\"search-description\">Aklama</Label>\n                  <Input\n                    id=\"search-description\"\n                    value={advancedSearchFilters.description}\n                    onChange={(e) => setAdvancedSearchFilters(prev => ({ ...prev, description: e.target.value }))}\n                    placeholder=\"Aklamada ara...\"\n                    className=\"mt-1\"\n                  />\n                </div>\n                <div>\n                  <Label htmlFor=\"search-status\">Durum</Label>\n                  <Select\n                    value={advancedSearchFilters.status}\n                    onValueChange={(value) => setAdvancedSearchFilters(prev => ({ ...prev, status: value }))}\n                  >\n                    <SelectTrigger className=\"mt-1\">\n                      <SelectValue />\n                    </SelectTrigger>\n                    <SelectContent>\n                      <SelectItem value=\"all\">Tm Durumlar</SelectItem>\n                      <SelectItem value=\"pending\">Beklemede</SelectItem>\n                      <SelectItem value=\"in_progress\">Devam Ediyor</SelectItem>\n                      <SelectItem value=\"completed\">Tamamland</SelectItem>\n                    </SelectContent>\n                  </Select>\n                </div>\n                <div>\n                  <Label htmlFor=\"search-priority\">ncelik</Label>\n                  <Select\n                    value={advancedSearchFilters.priority}\n                    onValueChange={(value) => setAdvancedSearchFilters(prev => ({ ...prev, priority: value }))}\n                  >\n                    <SelectTrigger className=\"mt-1\">\n                      <SelectValue />\n                    </SelectTrigger>\n                    <SelectContent>\n                      <SelectItem value=\"all\">Tm ncelikler</SelectItem>\n                      {PRIORITY_OPTIONS.map((opt) => (\n                        <SelectItem key={opt.value} value={opt.value.toString()}>\n                          {opt.label} ({opt.value})\n                        </SelectItem>\n                      ))}\n                    </SelectContent>\n                  </Select>\n                </div>\n                <div>\n                  <Label htmlFor=\"search-project\">Proje</Label>\n                  <Select\n                    value={advancedSearchFilters.projectId}\n                    onValueChange={(value) => setAdvancedSearchFilters(prev => ({ ...prev, projectId: value }))}\n                  >\n                    <SelectTrigger className=\"mt-1\">\n                      <SelectValue />\n                    </SelectTrigger>\n                    <SelectContent>\n                      <SelectItem value=\"all\">Tm Projeler</SelectItem>\n                      <SelectItem value=\"general\">Genel Grevler</SelectItem>\n                      {filterableProjects.map(proj => (\n                        <SelectItem key={proj.id} value={proj.id}>{proj.name}</SelectItem>\n                      ))}\n                    </SelectContent>\n                  </Select>\n                </div>\n                <div>\n                  <Label htmlFor=\"search-assigned\">Atanan Kii</Label>\n                  <Select\n                    value={advancedSearchFilters.assignedTo}\n                    onValueChange={(value) => setAdvancedSearchFilters(prev => ({ ...prev, assignedTo: value }))}\n                  >\n                    <SelectTrigger className=\"mt-1\">\n                      <SelectValue />\n                    </SelectTrigger>\n                    <SelectContent>\n                      <SelectItem value=\"all\">Tm Kullanclar</SelectItem>\n                      {cachedUsers.map(user => (\n                        <SelectItem key={user.id} value={user.id}>{user.fullName || user.email}</SelectItem>\n                      ))}\n                    </SelectContent>\n                  </Select>\n                </div>\n                <div>\n                  <Label htmlFor=\"search-due-from\">Biti Tarihi (Balang)</Label>\n                  <Input\n                    id=\"search-due-from\"\n                    type=\"date\"\n                    value={advancedSearchFilters.dueDateFrom}\n                    onChange={(e) => setAdvancedSearchFilters(prev => ({ ...prev, dueDateFrom: e.target.value }))}\n                    className=\"mt-1\"\n                  />\n                </div>\n                <div>\n                  <Label htmlFor=\"search-due-to\">Biti Tarihi (Biti)</Label>\n                  <Input\n                    id=\"search-due-to\"\n                    type=\"date\"\n                    value={advancedSearchFilters.dueDateTo}\n                    onChange={(e) => setAdvancedSearchFilters(prev => ({ ...prev, dueDateTo: e.target.value }))}\n                    className=\"mt-1\"\n                  />\n                </div>\n              </div>\n            </div>\n            <DialogFooter>\n              <Button\n                variant=\"outline\"\n                onClick={() => {\n                  setAdvancedSearchFilters({\n                    title: \"\",\n                    description: \"\",\n                    status: \"all\",\n                    priority: \"all\",\n                    projectId: \"all\",\n                    assignedTo: \"all\",\n                    dueDateFrom: \"\",\n                    dueDateTo: \"\",\n                  });\n                  setSearchTerm(\"\");\n                  setStatusFilter(\"all\");\n                  setSelectedProject(\"all\");\n                }}\n              >\n                Temizle\n              </Button>\n              <Button\n                onClick={() => {\n                  // Advanced search filtrelerini uygula\n                  let searchText = \"\";\n                  if (advancedSearchFilters.title) searchText += advancedSearchFilters.title + \" \";\n                  if (advancedSearchFilters.description) searchText += advancedSearchFilters.description + \" \";\n                  setSearchTerm(searchText.trim());\n                  if (advancedSearchFilters.status !== \"all\") setStatusFilter(advancedSearchFilters.status);\n                  if (advancedSearchFilters.projectId !== \"all\") {\n                    setSelectedProject(advancedSearchFilters.projectId);\n                    setProjectFilter(advancedSearchFilters.projectId);\n                  }\n                  setAdvancedSearchOpen(false);\n                  toast.success(\"Arama filtreleri uyguland\");\n                }}\n              >\n                Ara\n              </Button>\n            </DialogFooter>\n          </DialogContent>\n        </Dialog>\n\n        {/* Create Project Dialog */}\n        <Dialog open={createProjectDialogOpen} onOpenChange={setCreateProjectDialogOpen}>\n          <DialogContent>\n            <DialogHeader>\n              <DialogTitle>Yeni Proje Olutur</DialogTitle>\n              <DialogDescription>\n                Yeni bir proje oluturun. Proje ad zorunludur.\n              </DialogDescription>\n            </DialogHeader>\n            <div className=\"space-y-4\">\n              <div>\n                <Label htmlFor=\"project_name\">\n                  Proje Ad <span className=\"text-destructive\">*</span>\n                </Label>\n                <Input\n                  id=\"project_name\"\n                  value={newProjectName}\n                  onChange={(e) => setNewProjectName(e.target.value)}\n                  placeholder=\"Proje adn girin...\"\n                  className=\"mt-2\"\n                />\n              </div>\n              <div>\n                <Label htmlFor=\"project_description\">Aklama</Label>\n                <Textarea\n                  id=\"project_description\"\n                  value={newProjectDescription}\n                  onChange={(e) => setNewProjectDescription(e.target.value)}\n                  placeholder=\"Proje aklamas (istee bal)...\"\n                  rows={3}\n                  className=\"mt-2\"\n                />\n              </div>\n            </div>\n            <DialogFooter>\n              <Button\n                variant=\"outline\"\n                onClick={() => {\n                  setCreateProjectDialogOpen(false);\n                  setNewProjectName(\"\");\n                  setNewProjectDescription(\"\");\n                }}\n              >\n                ptal\n              </Button>\n              <Button\n                onClick={handleCreateProject}\n                disabled={!newProjectName.trim()}\n              >\n                Olutur\n              </Button>\n            </DialogFooter>\n          </DialogContent>\n        </Dialog>\n\n        {/* Delete Project Dialog */}\n        <AlertDialog open={deleteProjectDialogOpen} onOpenChange={setDeleteProjectDialogOpen}>\n          <AlertDialogContent>\n            <AlertDialogHeader>\n              <AlertDialogTitle>Projeyi Sil</AlertDialogTitle>\n              <AlertDialogDescription>\n                \"{projectToDelete?.name}\" projesini silmek istediinize emin misiniz? Bu ilem geri alnamaz ve projeye ait tm grevler de silinecektir.\n              </AlertDialogDescription>\n            </AlertDialogHeader>\n            <AlertDialogFooter>\n              <AlertDialogCancel onClick={() => setProjectToDelete(null)}>\n                ptal\n              </AlertDialogCancel>\n              <AlertDialogAction\n                onClick={handleDeleteProject}\n                className=\"bg-destructive text-destructive-foreground hover:bg-destructive/90\"\n              >\n                Sil\n              </AlertDialogAction>\n            </AlertDialogFooter>\n          </AlertDialogContent>\n        </AlertDialog>\n\n        {/* Reject Task Dialog */}\n        <Dialog open={rejectDialogOpen} onOpenChange={setRejectDialogOpen}>\n          <DialogContent>\n            <DialogHeader>\n              <DialogTitle>Grevi Reddet</DialogTitle>\n              <DialogDescription>\n                Grevi reddetmek iin ltfen en az 20 karakterlik bir sebep belirtin.\n              </DialogDescription>\n            </DialogHeader>\n            <div className=\"space-y-4\">\n              <div>\n                <Label htmlFor=\"rejection_reason\">\n                  Reddetme Sebebi <span className=\"text-destructive\">*</span> (En az 20 karakter)\n                </Label>\n                <Textarea\n                  id=\"rejection_reason\"\n                  value={rejectionReason}\n                  onChange={(e) => setRejectionReason(e.target.value)}\n                  placeholder=\"Grevi neden reddettiinizi aklayn (en az 20 karakter)...\"\n                  rows={4}\n                  className=\"mt-2\"\n                />\n                <p className=\"text-xs text-muted-foreground mt-1\">\n                  {rejectionReason.length}/20 karakter\n                </p>\n              </div>\n            </div>\n            <DialogFooter>\n              <Button\n                variant=\"outline\"\n                onClick={() => {\n                  setRejectDialogOpen(false);\n                  setRejectionReason(\"\");\n                  setRejectingAssignment(null);\n                }}\n              >\n                ptal\n              </Button>\n              <Button\n                variant=\"destructive\"\n                onClick={handleRejectTask}\n                disabled={rejecting || rejectionReason.trim().length < 20}\n              >\n                {rejecting ? \"leniyor...\" : \"Reddet\"}\n              </Button>\n            </DialogFooter>\n          </DialogContent>\n        </Dialog>\n\n      </div>\n    </MainLayout>\n  );\n};\n\nexport default Tasks;\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\pages\\TasksArchive.tsx","messages":[{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useEffect\" is called conditionally. React Hooks must be called in the exact same order in every component render. Did you accidentally call a React Hook after an early return?","line":108,"column":3,"nodeType":"Identifier","endLine":108,"endColumn":12},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchData'. Either include it or remove the dependency array.","line":110,"column":6,"nodeType":"ArrayExpression","endLine":110,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [fetchData]","fix":{"range":[4347,4349],"text":"[fetchData]"}}]},{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useMemo\" is called conditionally. React Hooks must be called in the exact same order in every component render. Did you accidentally call a React Hook after an early return?","line":230,"column":25,"nodeType":"Identifier","endLine":230,"endColumn":32},{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useMemo\" is called conditionally. React Hooks must be called in the exact same order in every component render. Did you accidentally call a React Hook after an early return?","line":241,"column":25,"nodeType":"Identifier","endLine":241,"endColumn":32}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useEffect, useMemo, useState } from \"react\";\nimport { MainLayout } from \"@/components/Layout/MainLayout\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Avatar, AvatarFallback } from \"@/components/ui/avatar\";\nimport { SearchInput } from \"@/components/ui/search-input\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { toast } from \"sonner\";\nimport { useAuth } from \"@/contexts/AuthContext\";\nimport { Navigate } from \"react-router-dom\";\nimport {\n  getTasks,\n  Task as FirebaseTask,\n  unarchiveTask,\n  deleteTask,\n} from \"@/services/firebase/taskService\";\nimport { getAllUsers, UserProfile } from \"@/services/firebase/authService\";\nimport { Archive, CheckSquare, FolderKanban, Search, X, Trash2, MoreVertical } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { EmptyState } from \"@/components/ui/empty-state\";\nimport { LoadingState } from \"@/components/ui/loading-state\";\nimport { format } from \"date-fns\";\nimport { tr } from \"date-fns/locale\";\nimport { cn } from \"@/lib/utils\";\nimport { TaskInlineForm } from \"@/components/Tasks/TaskInlineForm\";\nimport { AlertDialog, AlertDialogAction, AlertDialogCancel, AlertDialogContent, AlertDialogDescription, AlertDialogFooter, AlertDialogHeader, AlertDialogTitle } from \"@/components/ui/alert-dialog\";\nimport { DropdownMenu, DropdownMenuContent, DropdownMenuItem, DropdownMenuTrigger } from \"@/components/ui/dropdown-menu\";\n\ninterface Task {\n  id: string;\n  title: string;\n  description: string | null;\n  status: string;\n  priority: number;\n  due_date: string | null;\n  created_at: string;\n  updated_at: string;\n  project_id: string | null;\n  is_archived?: boolean;\n  assignedUsers?: { id: string; full_name: string }[];\n}\n\nconst STORAGE_KEY = \"taskBoardState_v1\";\n\nconst TasksArchive = () => {\n  const { user } = useAuth();\n  const [canAccess, setCanAccess] = useState(false);\n  const [loadingAccess, setLoadingAccess] = useState(true);\n  const [archivedTasks, setArchivedTasks] = useState<Task[]>([]);\n  const [archivedLists, setArchivedLists] = useState<Array<{ id: string; name: string; isArchived?: boolean; [key: string]: unknown }>>([]);\n  const [loading, setLoading] = useState(true);\n  const [searchTerm, setSearchTerm] = useState(\"\");\n  const [activeTab, setActiveTab] = useState<\"tasks\" | \"lists\">(\"tasks\");\n  const [usersMap, setUsersMap] = useState<Record<string, string>>({});\n  const [selectedTaskId, setSelectedTaskId] = useState<string | null>(null);\n  const [deleteDialogOpen, setDeleteDialogOpen] = useState(false);\n  const [taskToDelete, setTaskToDelete] = useState<string | null>(null);\n  const [inlineFormVisible, setInlineFormVisible] = useState(false);\n  const [inlineFormTaskId, setInlineFormTaskId] = useState<string | null>(null);\n\n  // Eriim kontrol - Firestore'dan\n  useEffect(() => {\n    const checkAccess = async () => {\n      if (!user) {\n        setCanAccess(false);\n        setLoadingAccess(false);\n        return;\n      }\n      try {\n        const { isMainAdmin, canUpdateResource } = await import(\"@/utils/permissions\");\n        const userProfile: UserProfile = {\n          id: user.id,\n          email: user.email,\n          emailVerified: user.emailVerified,\n          fullName: user.fullName,\n          displayName: user.fullName,\n          phone: user.phone,\n          dateOfBirth: user.dateOfBirth,\n          role: user.roles,\n          createdAt: null,\n          updatedAt: null,\n        };\n        const [isMainAdminUser, canUpdateTasks] = await Promise.all([\n          isMainAdmin(userProfile),\n          canUpdateResource(userProfile, \"tasks\"),\n        ]);\n        setCanAccess(isMainAdminUser || canUpdateTasks);\n      } catch (error: unknown) {\n        if (import.meta.env.DEV) {\n          console.error(\"Error checking archive access:\", error);\n        }\n        setCanAccess(false);\n      } finally {\n        setLoadingAccess(false);\n      }\n    };\n    checkAccess();\n  }, [user]);\n\n  // Sadece ynetici ve ekip lideri eriebilir\n  if (loadingAccess) {\n    return <div className=\"flex items-center justify-center h-screen\"><Loader2 className=\"h-8 w-8 animate-spin\" /></div>;\n  }\n  if (!canAccess) {\n    return <Navigate to=\"/\" replace />;\n  }\n\n  useEffect(() => {\n    fetchData();\n  }, []);\n\n  const fetchData = async () => {\n    if (!user) return;\n    setLoading(true);\n    try {\n      // Arivlenmi grevleri getir\n      const allTasks = await getTasks();\n      const archived = allTasks.filter((task: FirebaseTask) => task.isArchived === true);\n      \n      // Kullanc bilgilerini getir\n      const allUsers = await getAllUsers();\n      const userMap: Record<string, string> = {};\n      allUsers.forEach((u) => {\n        userMap[u.id] = u.fullName || u.displayName || u.email;\n      });\n      setUsersMap(userMap);\n\n      // Grevleri formatla\n      const formattedTasks: Task[] = archived.map((task: FirebaseTask) => ({\n        id: task.id,\n        title: task.title,\n        description: task.description || null,\n        status: task.status,\n        priority: task.priority || 3,\n        due_date: task.dueDate?.toDate?.()?.toISOString() || null,\n        created_at: task.createdAt?.toDate?.()?.toISOString() || new Date().toISOString(),\n        updated_at: task.updatedAt?.toDate?.()?.toISOString() || new Date().toISOString(),\n        project_id: task.projectId || null,\n        is_archived: task.isArchived,\n        assignedUsers: task.assignedUsers?.map((userId: string) => ({\n          id: userId,\n          full_name: userMap[userId] || \"Bilinmeyen\",\n        })) || [],\n      }));\n\n      setArchivedTasks(formattedTasks);\n\n      // Arivlenmi listeleri localStorage'dan getir\n      try {\n        const savedState = localStorage.getItem(STORAGE_KEY);\n        if (savedState) {\n          const boardState = JSON.parse(savedState);\n          const archivedColumns = boardState.columns?.filter((col: { id: string; name: string; isArchived?: boolean; [key: string]: unknown }) => col.isArchived === true) || [];\n          setArchivedLists(archivedColumns);\n        }\n      } catch (error) {\n        if (import.meta.env.DEV) {\n          console.error(\"Error loading archived lists:\", error);\n        }\n      }\n    } catch (error: unknown) {\n      if (import.meta.env.DEV) {\n        console.error(\"Fetch archive data error:\", error);\n      }\n      toast.error(error instanceof Error ? error.message : \"Ariv verileri yklenirken hata olutu\");\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleUnarchiveTask = async (taskId: string) => {\n    if (!user?.id) return;\n    try {\n      await unarchiveTask(taskId, user.id);\n      toast.success(\"Grev arivden karld\");\n      await fetchData();\n    } catch (error: unknown) {\n      if (import.meta.env.DEV) {\n        console.error(\"Unarchive task error:\", error);\n      }\n      toast.error(error instanceof Error ? error.message : \"Grev arivden karlamad\");\n    }\n  };\n\n  const handleDeleteTask = async () => {\n    if (!taskToDelete || !user?.id) return;\n    try {\n      await deleteTask(taskToDelete, user.id);\n      toast.success(\"Grev silindi\");\n      setDeleteDialogOpen(false);\n      setTaskToDelete(null);\n      await fetchData();\n    } catch (error: unknown) {\n      if (import.meta.env.DEV) {\n        console.error(\"Delete task error:\", error);\n      }\n      toast.error(error instanceof Error ? error.message : \"Grev silinemedi\");\n    }\n  };\n\n  const openTaskDetail = (taskId: string, initialStatus?: string) => {\n    setInlineFormTaskId(taskId);\n    setInlineFormVisible(true);\n  };\n\n  const closeTaskDetail = () => {\n    setInlineFormVisible(false);\n    setInlineFormTaskId(null);\n  };\n\n  const handleUnarchiveList = (listId: string) => {\n    try {\n      const savedState = localStorage.getItem(STORAGE_KEY);\n      if (savedState) {\n        const boardState = JSON.parse(savedState);\n        const updatedColumns = boardState.columns.map((col: { id: string; name: string; isArchived?: boolean; [key: string]: unknown }) =>\n          col.id === listId ? { ...col, isArchived: false } : col\n        );\n        boardState.columns = updatedColumns;\n        localStorage.setItem(STORAGE_KEY, JSON.stringify(boardState));\n        toast.success(\"Liste arivden karld\");\n        fetchData();\n      }\n    } catch (error) {\n      console.error(\"Error unarchiving list:\", error);\n      toast.error(\"Liste arivden karlamad\");\n    }\n  };\n\n  const filteredTasks = useMemo(() => {\n    if (!searchTerm) return archivedTasks;\n    const term = searchTerm.toLowerCase();\n    return archivedTasks.filter(\n      (task) =>\n        task.title.toLowerCase().includes(term) ||\n        task.description?.toLowerCase().includes(term) ||\n        task.assignedUsers?.some((u) => u.full_name.toLowerCase().includes(term))\n    );\n  }, [archivedTasks, searchTerm]);\n\n  const filteredLists = useMemo(() => {\n    if (!searchTerm) return archivedLists;\n    const term = searchTerm.toLowerCase();\n    return archivedLists.filter((list) =>\n      list.title?.toLowerCase().includes(term)\n    );\n  }, [archivedLists, searchTerm]);\n\n  if (loading) {\n    return (\n      <MainLayout>\n        <LoadingState message=\"Ariv ykleniyor...\" />\n      </MainLayout>\n    );\n  }\n\n  return (\n    <MainLayout>\n      <div className=\"space-y-3 sm:space-y-4\">\n        <div>\n          <h1 className=\"text-[16px] sm:text-[18px] font-bold text-foreground flex items-center gap-1.5 sm:gap-2\">\n            <Archive className=\"h-5 w-5 sm:h-6 sm:w-6 md:h-7 md:w-7\" />\n            Ariv\n          </h1>\n          <p className=\"text-muted-foreground mt-0.5 sm:mt-1 text-xs sm:text-sm\">\n            Arivlenmi grevler ve listeler\n          </p>\n        </div>\n\n        <Tabs value={activeTab} onValueChange={(value) => setActiveTab(value as \"tasks\" | \"lists\")} className=\"w-full\">\n          <Card>\n            <CardHeader className=\"p-3 sm:p-4 md:p-5\">\n              <div className=\"flex flex-col sm:flex-row items-stretch sm:items-center justify-between gap-2 sm:gap-3 md:gap-4\">\n                <div className=\"flex-1 min-w-0 w-full sm:w-auto\">\n                  <SearchInput\n                    placeholder=\"Arivde ara...\"\n                    value={searchTerm}\n                    onChange={(e) => setSearchTerm(e.target.value)}\n                    className=\"w-full h-9 sm:h-10 text-xs sm:text-sm\"\n                  />\n                </div>\n                <TabsList className=\"w-full sm:w-auto\">\n                  <TabsTrigger value=\"tasks\" className=\"gap-1 sm:gap-2 flex-1 sm:flex-initial min-h-[44px] sm:min-h-0 text-[14px] sm:text-[15px]\">\n                    <CheckSquare className=\"h-3.5 w-3.5 sm:h-4 sm:w-4 flex-shrink-0\" />\n                    <span>Grevler</span>\n                    <span className=\"ml-1\">({filteredTasks.length})</span>\n                  </TabsTrigger>\n                  <TabsTrigger value=\"lists\" className=\"gap-1 sm:gap-2 flex-1 sm:flex-initial min-h-[44px] sm:min-h-0 text-[14px] sm:text-[15px]\">\n                    <FolderKanban className=\"h-3.5 w-3.5 sm:h-4 sm:w-4 flex-shrink-0\" />\n                    <span>Listeler</span>\n                    <span className=\"ml-1\">({filteredLists.length})</span>\n                  </TabsTrigger>\n                </TabsList>\n              </div>\n            </CardHeader>\n            <CardContent className=\"p-3 sm:p-4 md:p-5\">\n              <TabsContent value=\"tasks\" className=\"mt-0\">\n              {filteredTasks.length === 0 ? (\n                <EmptyState\n                  icon={Archive}\n                  title={searchTerm ? \"Arama sonucu bulunamad\" : \"Henz arivlenmi grev yok\"}\n                  description={searchTerm ? \"Farkl bir arama terimi deneyin\" : \"Arivlenmi grevler burada grnecek\"}\n                  variant=\"card\"\n                />\n              ) : (\n                <div className=\"space-y-3\">\n                  {filteredTasks.map((task) => (\n                    <div\n                      key={task.id}\n                      className=\"p-3 sm:p-4 rounded-lg border bg-card hover:shadow-md transition-shadow cursor-pointer\"\n                      onClick={() => openTaskDetail(task.id, task.status)}\n                    >\n                      <div className=\"flex flex-col sm:flex-row sm:items-start sm:justify-between gap-2.5 sm:gap-3\">\n                        <div className=\"flex-1 min-w-0\">\n                          <div className=\"flex flex-col sm:flex-row sm:items-start gap-2 sm:gap-3 mb-2\">\n                            <h3 className=\"font-semibold text-sm sm:text-base flex-1 break-words\">{task.title}</h3>\n                            <Badge variant=\"outline\" className=\"flex-shrink-0 self-start sm:self-auto h-5 px-2 py-0 text-[11px] font-normal leading-tight\">\n                              {task.status === \"pending\" && \"Beklemede\"}\n                              {task.status === \"in_progress\" && \"Devam Ediyor\"}\n                              {task.status === \"completed\" && \"Tamamland\"}\n                              {task.status === \"cancelled\" && \"ptal\"}\n                            </Badge>\n                          </div>\n                          {task.description && (\n                            <p className=\"text-xs sm:text-sm text-muted-foreground mb-3 line-clamp-2 break-words\">\n                              {task.description}\n                            </p>\n                          )}\n                          <div className=\"flex flex-col sm:flex-row sm:flex-wrap sm:items-center gap-2 sm:gap-4 text-xs text-muted-foreground\">\n                            {task.due_date && (\n                              <span className=\"whitespace-nowrap\">\n                                {format(new Date(task.due_date), \"d MMMM yyyy\", { locale: tr })}\n                              </span>\n                            )}\n                            {task.assignedUsers && task.assignedUsers.length > 0 && (\n                              <div className=\"flex items-center gap-2\">\n                                <span className=\"hidden sm:inline\">Atananlar:</span>\n                                <div className=\"flex -space-x-2\">\n                                  {task.assignedUsers.slice(0, 3).map((user) => (\n                                    <Avatar key={user.id} className=\"h-6 w-6 border-2 border-background\">\n                                      <AvatarFallback className=\"text-xs\">\n                                        {user.full_name.charAt(0).toUpperCase()}\n                                      </AvatarFallback>\n                                    </Avatar>\n                                  ))}\n                                  {task.assignedUsers.length > 3 && (\n                                    <div className=\"h-6 w-6 rounded-full border-2 border-background bg-muted flex items-center justify-center text-xs\">\n                                      +{task.assignedUsers.length - 3}\n                                    </div>\n                                  )}\n                                </div>\n                              </div>\n                            )}\n                          </div>\n                        </div>\n                        <div className=\"flex items-center gap-2 flex-shrink-0\" onClick={(e) => e.stopPropagation()}>\n                          <DropdownMenu>\n                            <DropdownMenuTrigger asChild>\n                              <Button\n                                variant=\"ghost\"\n                                size=\"icon\"\n                                className=\"h-8 w-8 opacity-70 hover:opacity-100\"\n                              >\n                                <MoreVertical className=\"h-4 w-4\" />\n                              </Button>\n                            </DropdownMenuTrigger>\n                            <DropdownMenuContent align=\"end\">\n                              <DropdownMenuItem\n                                onClick={(e) => {\n                                  e.stopPropagation();\n                                  handleUnarchiveTask(task.id);\n                                }}\n                                className=\"cursor-pointer\"\n                              >\n                                <X className=\"h-4 w-4 mr-2\" />\n                                Arivden kar\n                              </DropdownMenuItem>\n                              <DropdownMenuItem\n                                onClick={(e) => {\n                                  e.stopPropagation();\n                                  setTaskToDelete(task.id);\n                                  setDeleteDialogOpen(true);\n                                }}\n                                className=\"cursor-pointer text-destructive focus:text-destructive\"\n                              >\n                                <Trash2 className=\"h-4 w-4 mr-2\" />\n                                Sil\n                              </DropdownMenuItem>\n                            </DropdownMenuContent>\n                          </DropdownMenu>\n                        </div>\n                      </div>\n                    </div>\n                  ))}\n                </div>\n              )}\n            </TabsContent>\n            <TabsContent value=\"lists\" className=\"mt-0\">\n              {filteredLists.length === 0 ? (\n                <EmptyState\n                  icon={FolderKanban}\n                  title={searchTerm ? \"Arama sonucu bulunamad\" : \"Henz arivlenmi liste yok\"}\n                  description={searchTerm ? \"Farkl bir arama terimi deneyin\" : \"Arivlenmi listeler burada grnecek\"}\n                  variant=\"card\"\n                />\n              ) : (\n                <div className=\"space-y-3\">\n                  {filteredLists.map((list) => (\n                    <div\n                      key={list.id}\n                      className=\"p-3 sm:p-4 rounded-lg border bg-card hover:shadow-md transition-shadow\"\n                    >\n                      <div className=\"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2.5 sm:gap-3\">\n                        <div className=\"flex-1 min-w-0\">\n                          <h3 className=\"font-semibold text-sm sm:text-base mb-1 break-words\">{list.title}</h3>\n                          <p className=\"text-xs sm:text-sm text-muted-foreground\">\n                            {list.taskIds?.length || 0} grev\n                          </p>\n                        </div>\n                        <Button\n                          variant=\"outline\"\n                          size=\"sm\"\n                          onClick={() => handleUnarchiveList(list.id)}\n                          className=\"flex-shrink-0 w-full sm:w-auto min-h-[44px] sm:min-h-0\"\n                        >\n                          <X className=\"h-4 w-4 mr-2\" />\n                          <span className=\"hidden sm:inline\">Arivden kar</span>\n                          <span className=\"sm:hidden\">kar</span>\n                        </Button>\n                      </div>\n                    </div>\n                  ))}\n                </div>\n              )}\n              </TabsContent>\n            </CardContent>\n          </Card>\n        </Tabs>\n\n        {/* Task Inline Form */}\n        {inlineFormVisible && (\n          <TaskInlineForm\n            mode=\"edit\"\n            taskId={inlineFormTaskId || undefined}\n            onCancel={closeTaskDetail}\n            onSuccess={() => {\n              closeTaskDetail();\n              fetchData();\n            }}\n          />\n        )}\n\n        {/* Delete Confirmation Dialog */}\n        <AlertDialog open={deleteDialogOpen} onOpenChange={setDeleteDialogOpen}>\n          <AlertDialogContent>\n            <AlertDialogHeader>\n              <AlertDialogTitle>Grevi Sil</AlertDialogTitle>\n              <AlertDialogDescription>\n                Bu grevi silmek istediinize emin misiniz? Bu ilem geri alnamaz ve grev kalc olarak silinecektir.\n              </AlertDialogDescription>\n            </AlertDialogHeader>\n            <AlertDialogFooter>\n              <AlertDialogCancel>ptal</AlertDialogCancel>\n              <AlertDialogAction\n                onClick={handleDeleteTask}\n                className=\"bg-destructive text-destructive-foreground hover:bg-destructive/90\"\n              >\n                Sil\n              </AlertDialogAction>\n            </AlertDialogFooter>\n          </AlertDialogContent>\n        </AlertDialog>\n      </div>\n    </MainLayout>\n  );\n};\n\nexport default TasksArchive;\n\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\pages\\TeamManagement.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useCallback has a missing dependency: 'CACHE_DURATION'. Either include it or remove the dependency array.","line":217,"column":6,"nodeType":"ArrayExpression","endLine":217,"endColumn":33,"suggestions":[{"desc":"Update the dependencies array to be: [user.id, CACHE_DURATION, isMainAdminUser]","fix":{"range":[8850,8877],"text":"[user.id, CACHE_DURATION, isMainAdminUser]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect, useRef, useCallback, useMemo, lazy, Suspense } from \"react\";\nimport { MainLayout } from \"@/components/Layout/MainLayout\";\nimport { Users, UserPlus, TrendingUp, Clock, Loader2, CheckCircle2, FileText, CheckSquare, BarChart3, RefreshCw, Info, Award, ChevronLeft, ChevronRight } from \"lucide-react\";\n\n// Lazy load child components for better performance\nconst PendingTaskApprovals = lazy(() => import(\"@/components/Team/PendingTaskApprovals\").then(m => ({ default: m.PendingTaskApprovals })));\nconst TeamMembers = lazy(() => import(\"@/components/Team/TeamMembers\").then(m => ({ default: m.TeamMembers })));\nconst AuditLogs = lazy(() => import(\"@/components/Admin/AuditLogs\").then(m => ({ default: m.AuditLogs })));\nconst TeamStatsView = lazy(() => import(\"@/components/Team/TeamStatsView\").then(m => ({ default: m.TeamStatsView })));\nimport { StatCard } from \"@/components/Dashboard/StatCard\";\nimport { useAuth } from \"@/contexts/AuthContext\";\nimport { Navigate } from \"react-router-dom\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { getAllUsers } from \"@/services/firebase/authService\";\nimport { getDepartments } from \"@/services/firebase/departmentService\";\nimport { getTasks } from \"@/services/firebase/taskService\";\nimport { getPendingTeamRequests, getAllPendingTeamRequests } from \"@/services/firebase/teamApprovalService\";\nimport { UserProfile } from \"@/services/firebase/authService\";\nimport { toast } from \"sonner\";\nimport { isMainAdmin, canUpdateResource } from \"@/utils/permissions\";\nimport { Button } from \"@/components/ui/button\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Tooltip, TooltipContent, TooltipProvider, TooltipTrigger } from \"@/components/ui/tooltip\";\n\nconst TeamManagement = () => {\n  const { user } = useAuth();\n  const [canAccess, setCanAccess] = useState(false);\n  const [isMainAdminUser, setIsMainAdminUser] = useState(false);\n  const [loading, setLoading] = useState(true);\n  \n  const [stats, setStats] = useState({\n    totalMembers: 0,\n    pendingApprovals: 0,\n    pendingRequests: 0,\n    activeTasks: 0,\n    completedTasks: 0,\n    totalTasks: 0,\n  });\n  const [loadingStats, setLoadingStats] = useState(false); // Balangta false - placeholder data ile hzl render\n  \n  // Hero ksmndaki istatistikler iin state (sadan sola alr/kapanr, default kapal)\n  const [heroStatsExpanded, setHeroStatsExpanded] = useState(false);\n  \n  // Ekip seimi iin state\n  const [selectedTeamFilter, setSelectedTeamFilter] = useState<string>(\"all\");\n  const [allDepartments, setAllDepartments] = useState<Awaited<ReturnType<typeof getDepartments>>>([]);\n  \n  // Ortak filtreleme state'leri\n  const [departmentFilter, setDepartmentFilter] = useState<string>(\"all\");\n  \n  // Cache iin ref'ler\n  const usersCacheRef = useRef<UserProfile[]>([]);\n  const departmentsCacheRef = useRef<Awaited<ReturnType<typeof getDepartments>>>([]);\n  const tasksCacheRef = useRef<Awaited<ReturnType<typeof getTasks>>>([]);\n  const cacheTimestampRef = useRef<number>(0);\n  const CACHE_DURATION = 2 * 60 * 1000; // 2 dakika\n\n  // Eriim kontrol - Firestore'dan\n  // Optimized: Lazy load permissions utils, cache result\n  useEffect(() => {\n    const checkAccess = async () => {\n      if (!user) {\n        setCanAccess(false);\n        setLoading(false);\n        return;\n      }\n      try {\n        // Lazy load permissions utils (non-blocking)\n        const { isMainAdmin, canUpdateResource } = await import(\"@/utils/permissions\");\n        const userProfile: UserProfile = {\n          id: user.id,\n          email: user.email,\n          emailVerified: user.emailVerified,\n          fullName: user.fullName,\n          displayName: user.fullName,\n          phone: user.phone,\n          dateOfBirth: user.dateOfBirth,\n          role: user.roles,\n          createdAt: null,\n          updatedAt: null,\n        };\n        // Parallel permission checks\n        const [isMainAdminResult, canUpdateDepts] = await Promise.all([\n          isMainAdmin(userProfile),\n          canUpdateResource(userProfile, \"departments\"),\n        ]);\n        setIsMainAdminUser(isMainAdminResult);\n        setCanAccess(isMainAdminResult || canUpdateDepts);\n      } catch (error: unknown) {\n        if (import.meta.env.DEV) {\n          console.error(\"Error checking team management access:\", error);\n        }\n        setCanAccess(false);\n      } finally {\n        setLoading(false);\n      }\n    };\n    // Defer access check slightly (50ms) to allow initial render\n    const timer = setTimeout(checkAccess, 50);\n    return () => clearTimeout(timer);\n  }, [user]);\n\n  const fetchStats = useCallback(async () => {\n    if (!user?.id) {\n      setLoadingStats(false);\n      return;\n    }\n    setLoadingStats(true);\n    try {\n      const now = Date.now();\n      const shouldRefresh = !usersCacheRef.current.length || \n                           (now - cacheTimestampRef.current) > CACHE_DURATION;\n      \n      let allUsers = usersCacheRef.current;\n      let allDepts = departmentsCacheRef.current;\n      let allTasks = tasksCacheRef.current;\n      \n      if (shouldRefresh) {\n        // Progressive loading: nce kritik veriler, sonra tasks\n        const [fetchedUsers, fetchedDepts] = await Promise.all([\n          getAllUsers(),\n          getDepartments(),\n        ]);\n        \n        // Tasks'i defer et - daha az kritik, limit ile\n        const fetchedTasks = await getTasks({ limit: 100 }); // Limit ekle (tm grevler yerine 100)\n        \n        // Cache'e kaydet\n        usersCacheRef.current = fetchedUsers;\n        departmentsCacheRef.current = fetchedDepts;\n        tasksCacheRef.current = fetchedTasks;\n        cacheTimestampRef.current = now;\n        \n        allUsers = fetchedUsers;\n        allDepts = fetchedDepts;\n        allTasks = fetchedTasks;\n      }\n      \n      // Requests'i her zaman al (cache'lenmez nk sk deiir)\n      const requests = await (isMainAdminUser ? getAllPendingTeamRequests() : getPendingTeamRequests(user.id));\n\n      let teamMembers: UserProfile[] = [];\n      if (isMainAdminUser) {\n        teamMembers = allUsers;\n      } else {\n        const managedDepartments = allDepts.filter(d => d.managerId === user.id);\n        \n        if (managedDepartments.length === 0) {\n          teamMembers = [];\n        } else {\n          const managedDeptIds = managedDepartments.map(d => d.id);\n          \n          teamMembers = allUsers.filter(u => {\n            if (u.approvedTeams && u.approvedTeams.some(deptId => managedDeptIds.includes(deptId))) {\n              return true;\n            }\n            if (u.pendingTeams && u.pendingTeams.some(deptId => managedDeptIds.includes(deptId))) {\n              return true;\n            }\n            if (u.departmentId && managedDeptIds.includes(u.departmentId)) {\n              return true;\n            }\n            return false;\n          });\n        }\n      }\n\n      let relevantTasks = allTasks;\n      if (!isMainAdminUser) {\n        const managedDepartments = allDepts.filter(d => d.managerId === user.id);\n        \n        if (managedDepartments.length > 0) {\n          const managedDeptIds = managedDepartments.map(d => d.id);\n        const teamMemberIds = allUsers\n            .filter(u => {\n              if (u.approvedTeams && u.approvedTeams.some(deptId => managedDeptIds.includes(deptId))) {\n                return true;\n              }\n              if (u.pendingTeams && u.pendingTeams.some(deptId => managedDeptIds.includes(deptId))) {\n                return true;\n              }\n              if (u.departmentId && managedDeptIds.includes(u.departmentId)) {\n                return true;\n              }\n              return false;\n            })\n          .map(u => u.id);\n        relevantTasks = allTasks.filter(t => \n          teamMemberIds.includes(t.createdBy) || t.createdBy === user.id\n        );\n        } else {\n          relevantTasks = allTasks.filter(t => t.createdBy === user.id);\n        }\n      }\n\n      const pendingTasks = relevantTasks.filter(t => t.approvalStatus === \"pending\");\n      const completedTasks = relevantTasks.filter(t => t.status === \"completed\").length;\n      const activeTasks = relevantTasks.filter(t => t.status === \"in_progress\").length;\n\n      setStats({\n        totalMembers: teamMembers.length,\n        pendingApprovals: pendingTasks.length,\n        pendingRequests: requests.length,\n        activeTasks: activeTasks,\n        completedTasks: completedTasks,\n        totalTasks: relevantTasks.length,\n      });\n    } catch (error: unknown) {\n      if (import.meta.env.DEV) {\n        console.error(\"Error fetching stats:\", error);\n      }\n      toast.error(\"statistikler yklenirken hata olutu\");\n    } finally {\n      setLoadingStats(false);\n    }\n  }, [user?.id, isMainAdminUser]);\n\n  const handleRefresh = useCallback(async () => {\n    if (loadingStats) return;\n    try {\n      // Clear cache\n      usersCacheRef.current = [];\n      departmentsCacheRef.current = [];\n      tasksCacheRef.current = [];\n      cacheTimestampRef.current = 0;\n      \n      await fetchStats();\n      toast.success(\"Veriler yenilendi\");\n    } catch (error) {\n      toast.error(\"Veriler yenilenirken hata olutu\");\n    }\n  }, [loadingStats, fetchStats]);\n\n  // Departmanlar ykle - Hem admin hem de filtreleme iin gerekli\n  // Defer et: lk render'dan sonra ykle (non-blocking)\n  useEffect(() => {\n    const loadDepartments = async () => {\n      try {\n        // lk render'dan 100ms sonra ykle (non-blocking)\n        await new Promise(resolve => setTimeout(resolve, 100));\n        const depts = await getDepartments();\n        setAllDepartments(depts);\n      } catch (error) {\n        if (import.meta.env.DEV) {\n          console.error(\"Error loading departments:\", error);\n        }\n      }\n    };\n    loadDepartments();\n  }, []);\n\n  useEffect(() => {\n    if (canAccess && user?.id) {\n      // Defer stats loading: lk render'dan 200ms sonra ykle (non-blocking)\n      const timer = setTimeout(() => {\n        fetchStats();\n      }, 200);\n      return () => clearTimeout(timer);\n    }\n  }, [canAccess, fetchStats, user?.id]);\n\n\n  // Keyboard shortcuts\n  useEffect(() => {\n    const handleKeyPress = (e: KeyboardEvent) => {\n      // Ctrl/Cmd + R to refresh - only if not in input/textarea\n      if ((e.ctrlKey || e.metaKey) && e.key === 'r') {\n        const target = e.target as HTMLElement;\n        if (target.tagName !== 'INPUT' && target.tagName !== 'TEXTAREA' && !target.isContentEditable) {\n          e.preventDefault();\n          handleRefresh();\n        }\n      }\n    };\n\n    window.addEventListener('keydown', handleKeyPress);\n    return () => window.removeEventListener('keydown', handleKeyPress);\n  }, [handleRefresh]);\n\n\n\n  // En aktif yeleri hesapla\n  const [mostActiveMembers, setMostActiveMembers] = useState<Array<{\n    member: UserProfile;\n    totalTasks: number;\n    completedTasks: number;\n    completionRate: number;\n  }>>([]);\n\n  useEffect(() => {\n    // Defer most active members calculation: lk render'dan sonra hesapla\n    const timer = setTimeout(() => {\n      const allUsers = usersCacheRef.current;\n      const allTasks = tasksCacheRef.current;\n      \n      if (!allUsers.length || !allTasks.length) {\n        setMostActiveMembers([]);\n        return;\n      }\n      \n      const memberTaskCounts = allUsers.map(member => {\n        const memberTasks = allTasks.filter(t => t.createdBy === member.id);\n        const completedCount = memberTasks.filter(t => t.status === \"completed\").length;\n        return {\n          member,\n          totalTasks: memberTasks.length,\n          completedTasks: completedCount,\n          completionRate: memberTasks.length > 0 ? (completedCount / memberTasks.length) * 100 : 0,\n        };\n      }).sort((a, b) => b.completedTasks - a.completedTasks).slice(0, 5);\n      \n      setMostActiveMembers(memberTaskCounts);\n    }, 300); // 300ms defer\n    \n    return () => clearTimeout(timer);\n  }, [loadingStats]);\n\n\n  // Sadece ynetici veya ekip liderleri eriebilir\n  if (loading) {\n    return (\n      <MainLayout>\n        <div className=\"flex items-center justify-center h-[calc(100vh-200px)]\">\n          <div className=\"text-center space-y-4\">\n            <div className=\"relative\">\n              <Loader2 className=\"h-12 w-12 animate-spin text-primary mx-auto\" />\n              <div className=\"absolute inset-0 flex items-center justify-center\">\n                <div className=\"h-6 w-6 rounded-full bg-primary/20\"></div>\n              </div>\n            </div>\n            <div>\n              <p className=\"text-[11px] sm:text-xs font-medium text-foreground\">Ykleniyor...</p>\n              <p className=\"text-[11px] sm:text-xs text-muted-foreground mt-1\">Ekip ynetimi hazrlanyor</p>\n            </div>\n          </div>\n        </div>\n      </MainLayout>\n    );\n  }\n  if (!canAccess) {\n    return <Navigate to=\"/\" replace />;\n  }\n\n  return (\n    <MainLayout>\n      <div className=\"space-y-2 w-full sm:w-[95%] md:w-[90%] lg:max-w-[1400px] mx-auto\">\n        {/* Header Section */}\n        <div className=\"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-2 pb-2 border-b\">\n          <div className=\"flex items-center gap-3 flex-1 min-w-0\">\n            <h1 className=\"text-[16px] sm:text-[18px] font-semibold text-foreground\">Ekip Ynetimi</h1>\n          </div>\n        </div>\n\n        {/* Ortak Filtreler */}\n        <div className=\"flex flex-row items-center justify-between gap-2 pb-2 border-b\">\n          <div className=\"flex flex-row items-center gap-2\">\n            <Select value={departmentFilter} onValueChange={setDepartmentFilter}>\n              <SelectTrigger className=\"w-full sm:w-[200px] h-9 text-[11px] sm:text-xs\">\n                <SelectValue placeholder=\"Departman Filtrele\" />\n              </SelectTrigger>\n              <SelectContent>\n                <SelectItem value=\"all\">Tm Departmanlar</SelectItem>\n                {allDepartments.map((dept) => (\n                  <SelectItem key={dept.id} value={dept.id}>\n                    {dept.name}\n                  </SelectItem>\n                ))}\n              </SelectContent>\n            </Select>\n            {isMainAdminUser && (\n              <Select value={selectedTeamFilter} onValueChange={setSelectedTeamFilter}>\n                <SelectTrigger className=\"w-full sm:w-[200px] h-9 text-[11px] sm:text-xs\">\n                  <SelectValue placeholder=\"Ekip seiniz\" />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"all\">Tm Ekipler</SelectItem>\n                  {allDepartments.map((dept) => (\n                    <SelectItem key={dept.id} value={dept.id}>\n                      {dept.name}\n                    </SelectItem>\n                  ))}\n                </SelectContent>\n              </Select>\n            )}\n          </div>\n          {/* Hero statistikler Alma Butonu */}\n          {!heroStatsExpanded ? (\n            <Button\n              variant=\"ghost\"\n              size=\"sm\"\n              onClick={() => setHeroStatsExpanded(true)}\n              className=\"h-7 px-2 gap-1 text-[11px] sm:text-xs\"\n              aria-label=\"statistikleri gster\"\n            >\n              <ChevronLeft className=\"h-3.5 w-3.5\" />\n            </Button>\n          ) : (\n            <Button\n              variant=\"ghost\"\n              size=\"sm\"\n              onClick={() => setHeroStatsExpanded(false)}\n              className=\"h-7 px-2 gap-1 text-[11px] sm:text-xs\"\n              aria-label=\"statistikleri gizle\"\n            >\n              <ChevronRight className=\"h-3.5 w-3.5\" />\n            </Button>\n          )}\n        </div>\n\n        {/* Hero statistik Kartlar - Sadan Sola Alp Kapanan */}\n        {heroStatsExpanded && (\n          <div className=\"grid gap-2 grid-cols-2 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-6\">\n            {loadingStats ? (\n              <>\n                {[...Array(6)].map((_, i) => (\n                  <Card key={i} className=\"animate-pulse border\">\n                    <CardContent className=\"p-2\">\n                      <div className=\"h-3 bg-muted rounded w-2/3 mb-1.5\"></div>\n                      <div className=\"h-7 bg-muted rounded w-1/2 mb-1\"></div>\n                      <div className=\"h-2 bg-muted rounded w-full\"></div>\n                    </CardContent>\n                  </Card>\n                ))}\n              </>\n            ) : (\n              <>\n                <StatCard\n                  title=\"Toplam ye\"\n                  value={stats.totalMembers}\n                  icon={Users}\n                  variant=\"primary\"\n                />\n                <StatCard\n                  title=\"Bekleyen Onaylar\"\n                  value={stats.pendingApprovals}\n                  icon={Clock}\n                  variant=\"warning\"\n                />\n                <StatCard\n                  title=\"Aktif Grevler\"\n                  value={stats.activeTasks}\n                  icon={TrendingUp}\n                  variant=\"success\"\n                />\n                <StatCard\n                  title=\"Tamamlanan\"\n                  value={stats.completedTasks}\n                  icon={CheckCircle2}\n                  variant=\"success\"\n                />\n                <StatCard\n                  title=\"Toplam Grev\"\n                  value={stats.totalTasks}\n                  icon={FileText}\n                  variant=\"primary\"\n                />\n                <StatCard\n                  title=\"Katlm stekleri\"\n                  value={stats.pendingRequests}\n                  icon={UserPlus}\n                  variant=\"info\"\n                />\n              </>\n            )}\n          </div>\n        )}\n\n        {/* Two Column Layout - Sol: Grev Onaylar + statistikler, Sa: En Aktif yeler + Loglar */}\n        <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-2 min-w-0 items-stretch\">\n          {/* Sol Stun - Grev Onaylar ve statistikler */}\n          <div className=\"lg:col-span-1 space-y-2 min-w-0 flex flex-col h-full\">\n            {/* Grev Onaylar Blm */}\n            <Card className=\"border shadow-sm hover:shadow-md transition-shadow duration-200 flex-1 flex flex-col\">\n              <div className=\"px-3 pt-1.5 pb-1 border-b bg-muted/30\">\n                <div className=\"flex items-center gap-2\">\n                  <div className=\"p-1.5 rounded-md bg-primary/10\">\n                    <CheckSquare className=\"h-4 w-4 text-primary\" />\n                  </div>\n                  <h3 className=\"text-[11px] sm:text-xs font-semibold text-foreground\">Grev Onaylar</h3>\n                </div>\n              </div>\n              <CardContent className=\"p-2 flex-1 flex flex-col min-h-0\">\n                <Suspense fallback={<div className=\"flex items-center justify-center p-4\"><Loader2 className=\"h-5 w-5 animate-spin text-muted-foreground\" /></div>}>\n                  <PendingTaskApprovals />\n                </Suspense>\n                </CardContent>\n              </Card>\n\n            {/* statistikler Blm */}\n            <Card className=\"border shadow-sm hover:shadow-md transition-shadow duration-200 flex-1 flex flex-col\">\n              <div className=\"px-3 pt-1.5 pb-1 border-b bg-muted/30\">\n                <div className=\"flex items-center gap-2\">\n                  <div className=\"p-1.5 rounded-md bg-primary/10\">\n                    <BarChart3 className=\"h-4 w-4 text-primary\" />\n                  </div>\n                  <h3 className=\"text-[11px] sm:text-xs font-semibold text-foreground\">statistikler</h3>\n                </div>\n              </div>\n              <CardContent className=\"p-2 flex-1 flex flex-col min-h-0\">\n                <Suspense fallback={<div className=\"flex items-center justify-center p-4\"><Loader2 className=\"h-5 w-5 animate-spin text-muted-foreground\" /></div>}>\n                  <TeamStatsView selectedTeamFilter={selectedTeamFilter} />\n                </Suspense>\n                </CardContent>\n              </Card>\n          </div>\n\n          {/* Sa Stun - En Aktif yeler ve Loglar */}\n          <div className=\"lg:col-span-1 space-y-2 min-w-0 flex flex-col h-full\">\n\n            {/* En Aktif yeler Blm */}\n            {mostActiveMembers.length > 0 && (\n              <Card className=\"border shadow-sm hover:shadow-md transition-shadow duration-200 flex-shrink-0\">\n                <div className=\"px-3 pt-1.5 pb-1 border-b bg-muted/30\">\n                  <div className=\"flex items-center gap-2\">\n                    <div className=\"p-1.5 rounded-md bg-primary/10\">\n                      <Award className=\"h-4 w-4 text-primary\" />\n                    </div>\n                    <h3 className=\"text-[11px] sm:text-xs font-semibold text-foreground\">En Aktif yeler</h3>\n                  </div>\n                </div>\n                <CardContent className=\"p-2\">\n                  <div className=\"space-y-1.5\">\n                    {mostActiveMembers.map(({ member, totalTasks, completedTasks, completionRate }, index) => (\n                      <div key={member.id} className=\"flex items-center justify-between p-2 rounded-lg bg-muted/50 hover:bg-muted transition-colors\">\n                        <div className=\"flex items-center gap-3\">\n                          <div className=\"flex items-center justify-center w-8 h-8 rounded-full bg-primary/10 text-primary font-semibold text-xs\">\n                            {index + 1}\n                          </div>\n                          <div>\n                            <p className=\"text-[11px] sm:text-xs font-medium\">{member.fullName || member.email}</p>\n                            <p className=\"text-[11px] sm:text-xs text-muted-foreground\">\n                              {completedTasks} tamamlanan / {totalTasks} toplam\n                            </p>\n                          </div>\n                        </div>\n                        <Badge variant=\"secondary\" className=\"text-[10px] px-2 py-1\">\n                          {completionRate.toFixed(0)}%\n                        </Badge>\n                      </div>\n                    ))}\n                  </div>\n                </CardContent>\n              </Card>\n            )}\n\n            {/* Ekip Loglar Blm */}\n            <Card className=\"border shadow-sm hover:shadow-md transition-shadow duration-200 flex-1 flex flex-col\">\n              <div className=\"px-3 pt-1.5 pb-1 border-b bg-muted/30\">\n                <div className=\"flex items-center gap-2\">\n                  <div className=\"p-1.5 rounded-md bg-primary/10\">\n                    <FileText className=\"h-4 w-4 text-primary\" />\n                  </div>\n                  <h3 className=\"text-[11px] sm:text-xs font-semibold text-foreground\">Ekip Loglar</h3>\n                </div>\n              </div>\n              <CardContent className=\"p-2 flex-1 flex flex-col min-h-0\">\n                <Suspense fallback={<div className=\"flex items-center justify-center p-4\"><Loader2 className=\"h-5 w-5 animate-spin text-muted-foreground\" /></div>}>\n                  <AuditLogs \n                    mode={isMainAdminUser ? \"admin\" : \"team\"} \n                    userId={user?.id}\n                    selectedTeamFilter={isMainAdminUser ? selectedTeamFilter : undefined}\n                  />\n                </Suspense>\n                </CardContent>\n              </Card>\n          </div>\n        </div>\n\n        {/* Ekip yeleri Blm - Tam Genilik */}\n        <Card className=\"border shadow-sm hover:shadow-md transition-shadow duration-200 w-full\">\n          <div className=\"px-3 pt-1.5 pb-1 border-b bg-muted/30\">\n            <div className=\"flex items-center gap-2\">\n              <div className=\"p-1.5 rounded-md bg-primary/10\">\n                <Users className=\"h-4 w-4 text-primary\" />\n              </div>\n              <h3 className=\"text-[11px] sm:text-xs font-semibold text-foreground\">Ekip yeleri</h3>\n            </div>\n          </div>\n          <CardContent className=\"p-2\">\n            <Suspense fallback={<div className=\"flex items-center justify-center p-4\"><Loader2 className=\"h-5 w-5 animate-spin text-muted-foreground\" /></div>}>\n              <TeamMembers departmentFilter={departmentFilter} />\n            </Suspense>\n          </CardContent>\n        </Card>\n\n      </div>\n    </MainLayout>\n  );\n};\n\nexport default TeamManagement;\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\pages\\VerifyEmail.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\pages\\VerifyEmailPrompt.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\pages\\Warranty.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\services\\driveService.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":16,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":16,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[510,513],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[510,513],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Google Drive Service - Firebase Authentication Entegrasyonu\n * Firebase Authentication ile giri yapldnda Google Access Token kullanr\n * Ayr OAuth flow'a gerek yok\n */\n\nimport { auth } from \"@/lib/firebase\";\nimport { GoogleAuthProvider, signInWithPopup, getAdditionalUserInfo } from \"firebase/auth\";\n\nexport type DriveUploadType = \"report\" | \"task\" | \"general\";\n\nexport interface DriveUploadOptions {\n  fileName?: string;\n  type?: DriveUploadType;\n  folderId?: string;\n  metadata?: Record<string, any>;\n  makePublic?: boolean;\n}\n\nexport interface DriveUploadResponse {\n  success: boolean;\n  fileId: string;\n  webViewLink?: string;\n  webContentLink?: string;\n}\n\n// Token storage key\nconst DRIVE_TOKEN_KEY = \"revium_drive_token\";\nconst DRIVE_TOKEN_EXPIRY_KEY = \"revium_drive_token_expiry\";\n\n/**\n * Firebase Authentication'dan Google Access Token al\n */\nconst getGoogleAccessToken = async (): Promise<string> => {\n  if (!auth?.currentUser) {\n    throw new Error(\"Kullanc giri yapmam. Ltfen nce giri yapn.\");\n  }\n\n  const user = auth.currentUser;\n  \n  // Kullanc Google provider ile giri yapm m kontrol et\n  const isGoogleProvider = user.providerData.some(\n    (provider) => provider.providerId === \"google.com\"\n  );\n\n  if (!isGoogleProvider) {\n    // Google provider ile giri yaplmam, Google ile balan\n    const provider = new GoogleAuthProvider();\n    provider.addScope(\"https://www.googleapis.com/auth/drive.file\");\n    \n    try {\n      const credential = await signInWithPopup(auth, provider);\n      const oauthCredential = GoogleAuthProvider.credentialFromResult(credential);\n      \n      if (!oauthCredential?.accessToken) {\n        throw new Error(\"Google Drive eriim token' alnamad\");\n      }\n\n      // Token' kaydet\n      const expiresIn = 3600; // 1 saat\n      saveToken(oauthCredential.accessToken, expiresIn);\n      \n      return oauthCredential.accessToken;\n    } catch (error: unknown) {\n      if (import.meta.env.DEV) {\n        if (import.meta.env.DEV) {\n          console.error(\"Google token alma hatas:\", error);\n        }\n      }\n      \n      if (error && typeof error === 'object' && 'code' in error && (error as { code: string }).code === \"auth/popup-closed-by-user\") {\n        throw new Error(\"Google balants iptal edildi.\");\n      }\n      \n      throw new Error(error instanceof Error ? error.message : \"Google token alnamad\");\n    }\n  }\n\n  // Google provider ile giri yaplm, mevcut token' kullan\n  // Firebase Authentication'dan Google Access Token almak iin\n  // kullancnn ID token'n kullanarak Google OAuth token' alabiliriz\n  // Ancak bu mmkn deil, bu yzden kullancy yeniden Google ile giri yapmaya ynlendirmeliyiz\n  // Ya da stored token' kullan\n  \n  // Stored token yoksa, kullancy Google ile yeniden giri yapmaya ynlendir\n  const storedToken = getStoredToken();\n  if (!storedToken) {\n    // Token yok, kullancy Google ile balanmaya ynlendir\n    const provider = new GoogleAuthProvider();\n    provider.addScope(\"https://www.googleapis.com/auth/drive.file\");\n    \n    try {\n      const credential = await signInWithPopup(auth, provider);\n      const oauthCredential = GoogleAuthProvider.credentialFromResult(credential);\n      \n      if (!oauthCredential?.accessToken) {\n        throw new Error(\"Google Drive eriim token' alnamad\");\n      }\n\n      // Token' kaydet\n      const expiresIn = 3600; // 1 saat\n      saveToken(oauthCredential.accessToken, expiresIn);\n      \n      return oauthCredential.accessToken;\n    } catch (error: unknown) {\n      if (import.meta.env.DEV) {\n        if (import.meta.env.DEV) {\n          console.error(\"Google token alma hatas:\", error);\n        }\n      }\n      \n      if (error && typeof error === 'object' && 'code' in error && (error as { code: string }).code === \"auth/popup-closed-by-user\") {\n        throw new Error(\"Google balants iptal edildi.\");\n      }\n      \n      throw new Error(error instanceof Error ? error.message : \"Google token alnamad\");\n    }\n  }\n\n  return storedToken;\n};\n\n/**\n * Access token' localStorage'a kaydet\n */\nconst saveToken = (token: string, expiresIn: number): void => {\n  const expiryTime = Date.now() + expiresIn * 1000;\n  localStorage.setItem(DRIVE_TOKEN_KEY, token);\n  localStorage.setItem(DRIVE_TOKEN_EXPIRY_KEY, expiryTime.toString());\n};\n\n/**\n * Access token' localStorage'dan al\n */\nconst getStoredToken = (): string | null => {\n  const token = localStorage.getItem(DRIVE_TOKEN_KEY);\n  const expiry = localStorage.getItem(DRIVE_TOKEN_EXPIRY_KEY);\n\n  if (!token || !expiry) {\n    return null;\n  }\n\n  // Token sresi dolmu mu kontrol et\n  if (Date.now() > parseInt(expiry, 10)) {\n    localStorage.removeItem(DRIVE_TOKEN_KEY);\n    localStorage.removeItem(DRIVE_TOKEN_EXPIRY_KEY);\n    return null;\n  }\n\n  return token;\n};\n\n/**\n * Access token' al veya yenile\n */\nconst getAccessToken = async (): Promise<string> => {\n  // nce stored token' kontrol et\n  const storedToken = getStoredToken();\n  if (storedToken) {\n    return storedToken;\n  }\n\n  // Yeni token al (Firebase Authentication'dan)\n  return await getGoogleAccessToken();\n};\n\n/**\n * Kullancy Google Drive'a yetkilendir (Google ile giri)\n */\nexport const authorizeDrive = async (): Promise<boolean> => {\n  try {\n    if (!auth) {\n      throw new Error(\"Firebase Authentication balatlmam\");\n    }\n\n    const provider = new GoogleAuthProvider();\n    provider.addScope(\"https://www.googleapis.com/auth/drive.file\");\n    \n    const credential = await signInWithPopup(auth, provider);\n    const oauthCredential = GoogleAuthProvider.credentialFromResult(credential);\n    \n    if (!oauthCredential?.accessToken) {\n      throw new Error(\"Google Drive eriim token' alnamad\");\n    }\n\n    // Token' kaydet\n    const expiresIn = 3600; // 1 saat\n    saveToken(oauthCredential.accessToken, expiresIn);\n    \n    return true;\n  } catch (error: unknown) {\n    if (import.meta.env.DEV) {\n      if (import.meta.env.DEV) {\n        console.error(\"Drive authorization error:\", error);\n      }\n    }\n    \n    if (error && typeof error === 'object' && 'code' in error && (error as { code: string }).code === \"auth/popup-closed-by-user\") {\n      throw new Error(\"Google balants iptal edildi.\");\n    }\n    \n    throw new Error(error?.message || \"Google Drive yetkilendirmesi baarsz oldu\");\n  }\n};\n\n/**\n * Kullancnn Drive yetkilendirmesi var m kontrol et\n */\nexport const isDriveAuthorized = async (): Promise<boolean> => {\n  try {\n    // Token var m kontrol et\n    const token = getStoredToken();\n    if (token) {\n      return true;\n    }\n\n    // Kullanc Google provider ile giri yapm m kontrol et\n    if (auth?.currentUser) {\n      const isGoogleProvider = auth.currentUser.providerData.some(\n        (provider) => provider.providerId === \"google.com\"\n      );\n      return isGoogleProvider;\n    }\n\n    return false;\n  } catch {\n    return false;\n  }\n};\n\n/**\n * Drive yetkilendirmesini kaldr\n */\nexport const revokeDriveAccess = async (): Promise<void> => {\n  try {\n    localStorage.removeItem(DRIVE_TOKEN_KEY);\n    localStorage.removeItem(DRIVE_TOKEN_EXPIRY_KEY);\n  } catch (error) {\n    if (import.meta.env.DEV) {\n      console.error(\"Drive revoke error:\", error);\n    }\n  }\n};\n\n/**\n * Dosyay Google Drive'a ykle\n */\nexport const uploadFileToDrive = async (\n  file: File | Blob,\n  options: DriveUploadOptions = {}\n): Promise<DriveUploadResponse> => {\n  try {\n    // Access token al\n    const accessToken = await getAccessToken();\n\n    // Dosyay File'a evir\n    const fileBlob = file instanceof File ? file : new File([file], options.fileName || \"file\", { type: file.type });\n\n    // Metadata olutur\n    const metadata: Record<string, unknown> = {\n      name: options.fileName || fileBlob.name,\n      mimeType: fileBlob.type || \"application/octet-stream\",\n    };\n\n    // Klasr ID'si varsa ekle\n    if (options.folderId) {\n      metadata.parents = [options.folderId];\n    } else if (options.type === \"task\") {\n      const taskFolderId = import.meta.env.VITE_GOOGLE_DRIVE_TASKS_FOLDER_ID;\n      if (taskFolderId) {\n        metadata.parents = [taskFolderId];\n      }\n    } else if (options.type === \"report\") {\n      const reportFolderId = import.meta.env.VITE_GOOGLE_DRIVE_REPORTS_FOLDER_ID;\n      if (reportFolderId) {\n        metadata.parents = [reportFolderId];\n      }\n    }\n\n    // Metadata properties ekle\n    if (options.metadata) {\n      metadata.properties = options.metadata;\n    }\n\n    // Multipart upload iin boundary olutur\n    const boundary = \"----WebKitFormBoundary\" + Math.random().toString(36).substring(2);\n    const delimiter = \"\\r\\n--\" + boundary + \"\\r\\n\";\n    const closeDelimiter = \"\\r\\n--\" + boundary + \"--\";\n\n    // Multipart body olutur (doru format)\n    const metadataPart = `Content-Type: application/json; charset=UTF-8\\r\\n\\r\\n${JSON.stringify(metadata)}`;\n    const filePart = `Content-Type: ${fileBlob.type || \"application/octet-stream\"}\\r\\n\\r\\n`;\n\n    // File' ArrayBuffer'a evir\n    const fileBuffer = await fileBlob.arrayBuffer();\n    const fileUint8 = new Uint8Array(fileBuffer);\n\n    // Multipart body'yi manuel olutur (string + binary)\n    const textEncoder = new TextEncoder();\n    const parts: Uint8Array[] = [\n      textEncoder.encode(delimiter),\n      textEncoder.encode(metadataPart),\n      textEncoder.encode(delimiter),\n      textEncoder.encode(filePart),\n      fileUint8,\n      textEncoder.encode(closeDelimiter),\n    ];\n\n    // Tm paralar birletir\n    const totalLength = parts.reduce((sum, part) => sum + part.length, 0);\n    const combined = new Uint8Array(totalLength);\n    let offset = 0;\n    for (const part of parts) {\n      combined.set(part, offset);\n      offset += part.length;\n    }\n\n    // Body'yi Blob'a evir\n    const bodyBlob = new Blob([combined], { type: `multipart/related; boundary=${boundary}` });\n\n    // Drive API'ye ykle\n    const response = await fetch(\"https://www.googleapis.com/upload/drive/v3/files?uploadType=multipart&fields=id,webViewLink,webContentLink\", {\n      method: \"POST\",\n      headers: {\n        Authorization: `Bearer ${accessToken}`,\n        \"Content-Type\": `multipart/related; boundary=${boundary}`,\n      },\n      body: bodyBlob,\n    });\n\n    if (!response.ok) {\n      const errorData = await response.json().catch(() => ({}));\n      let errorMessage = errorData.error?.message || \"Dosya ykleme baarsz oldu\";\n\n      if (response.status === 401) {\n        // Token geersiz, temizle ve tekrar dene\n        localStorage.removeItem(DRIVE_TOKEN_KEY);\n        localStorage.removeItem(DRIVE_TOKEN_EXPIRY_KEY);\n        errorMessage = \"Yetkilendirme hatas. Ltfen tekrar deneyin.\";\n      } else if (response.status === 403) {\n        errorMessage = \"Google Drive izni yok. Ltfen yetkilendirme yapn.\";\n      } else if (response.status === 507) {\n        errorMessage = \"Google Drive depolama kotas dolmu.\";\n      }\n\n      throw new Error(errorMessage);\n    }\n\n    const result = await response.json();\n\n    if (!result.id) {\n      throw new Error(\"Dosya ykleme baarsz oldu\");\n    }\n\n    const fileId = result.id;\n\n    // Public link isteniyorsa izin ver\n    if (options.makePublic !== false) {\n      try {\n        await fetch(`https://www.googleapis.com/drive/v3/files/${fileId}/permissions`, {\n          method: \"POST\",\n          headers: {\n            Authorization: `Bearer ${accessToken}`,\n            \"Content-Type\": \"application/json\",\n          },\n          body: JSON.stringify({\n            role: \"reader\",\n            type: \"anyone\",\n          }),\n        });\n      } catch (permError) {\n        if (import.meta.env.DEV) {\n          console.warn(\"Public permission eklenemedi:\", permError);\n        }\n        // Public permission hatas dosya yklemesini engellemez\n      }\n    }\n\n    // Web view link'i olutur\n    const webViewLink = result.webViewLink || `https://drive.google.com/file/d/${fileId}/view`;\n\n    return {\n      success: true,\n      fileId: fileId,\n      webViewLink: webViewLink,\n      webContentLink: result.webContentLink,\n    };\n  } catch (error: unknown) {\n    if (import.meta.env.DEV) {\n      console.error(\"Drive upload error:\", error);\n    }\n\n    let errorMessage = \"Google Drive yklemesi baarsz oldu\";\n\n    if (error?.message) {\n      errorMessage = error.message;\n    } else if (typeof error === \"string\") {\n      errorMessage = error;\n    }\n\n    // zel hata mesajlar\n    if (errorMessage.includes(\"auth\") || errorMessage.includes(\"unauthorized\") || errorMessage.includes(\"401\")) {\n      errorMessage = \"Google Drive yetkilendirmesi gerekli. Ltfen Google ile giri yapn.\";\n    } else if (errorMessage.includes(\"quota\") || errorMessage.includes(\"storage\") || errorMessage.includes(\"507\")) {\n      errorMessage = \"Google Drive depolama kotas dolmu. Ltfen depolama alann kontrol edin.\";\n    } else if (errorMessage.includes(\"403\")) {\n      errorMessage = \"Google Drive izni yok. Ltfen Google ile giri yapn.\";\n    }\n\n    throw new Error(errorMessage);\n  }\n};\n\n/**\n * Drive'dan dosya sil\n */\nexport const deleteDriveFile = async (fileId: string): Promise<void> => {\n  if (!fileId || fileId.trim() === \"\") {\n    throw new Error(\"Geerli bir Drive dosya ID'si gerekli\");\n  }\n\n  try {\n    // Access token al\n    const accessToken = await getAccessToken();\n\n    const response = await fetch(`https://www.googleapis.com/drive/v3/files/${fileId}`, {\n      method: \"DELETE\",\n      headers: {\n        Authorization: `Bearer ${accessToken}`,\n      },\n    });\n\n    if (!response.ok) {\n      const errorData = await response.json().catch(() => ({}));\n      let errorMessage = errorData.error?.message || \"Drive dosyas silinemedi\";\n\n      if (response.status === 401) {\n        // Token geersiz, temizle\n        localStorage.removeItem(DRIVE_TOKEN_KEY);\n        localStorage.removeItem(DRIVE_TOKEN_EXPIRY_KEY);\n        errorMessage = \"Yetkilendirme hatas. Ltfen tekrar deneyin.\";\n      }\n\n      throw new Error(errorMessage);\n    }\n  } catch (error: unknown) {\n    if (import.meta.env.DEV) {\n      if (import.meta.env.DEV) {\n        console.error(\"Drive delete error:\", error);\n      }\n    }\n\n    let errorMessage = \"Drive dosyas silinemedi\";\n    if (error instanceof Error && error.message) {\n      errorMessage = error.message;\n    } else if (typeof error === \"string\") {\n      errorMessage = error;\n    }\n\n    throw new Error(errorMessage);\n  }\n};\n\n/**\n * OAuth URL al (eski API uyumluluu iin)\n * @deprecated Artk Firebase Authentication kullanlyor\n */\nexport const getDriveAuthUrl = async (): Promise<string> => {\n  // Firebase Authentication ile Google giri yap\n  await authorizeDrive();\n  return window.location.href;\n};\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\services\\emailService.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\services\\exchangeRateService.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\services\\firebase\\adminSettingsService.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\services\\firebase\\auditLogsService.ts","messages":[{"ruleId":"prefer-const","severity":2,"message":"'logs' is never reassigned. Use 'const' instead.","line":368,"column":15,"nodeType":"Identifier","messageId":"useConst","endLine":368,"endColumn":19,"fix":{"range":[11033,11371],"text":"const logs = snapshot.docs\n            .map((docSnap) => {\n              const logData = docSnap.data() as Omit<AuditLog, \"id\">;\n              return {\n                id: docSnap.id,\n                ...logData,\n              } as AuditLog;\n            })\n            .filter((log) => log.userId && allRelevantUserIds.includes(log.userId));"}}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":1,"fixableWarningCount":0,"source":"import { db } from \"@/lib/firebase\";\nimport {\n  collection,\n  doc,\n  getDocs,\n  addDoc,\n  query,\n  where,\n  orderBy,\n  limit,\n  Timestamp,\n  or,\n  deleteDoc,\n  writeBatch,\n} from \"firebase/firestore\";\nimport { getUserProfile, getAllUsers, UserProfile } from \"./authService\";\nimport { getDepartments, Department } from \"./departmentService\";\n\nexport interface AuditLog {\n  id: string;\n  userId: string | null;\n  action: \"CREATE\" | \"UPDATE\" | \"DELETE\";\n  tableName: string;\n  recordId: string | null;\n  oldData: unknown;\n  newData: unknown;\n  createdAt: Timestamp;\n  userName?: string;\n  userEmail?: string;\n  metadata?: Record<string, unknown>;\n}\n\nconst AUDIT_LOGS_COLLECTION = \"audit_logs\";\n\n/**\n * Create an audit log entry\n */\nexport const createAuditLog = async (\n  action: \"CREATE\" | \"UPDATE\" | \"DELETE\",\n  tableName: string,\n  recordId: string | null,\n  oldData: unknown = null,\n  newData: unknown = null,\n  userId: string | null = null,\n  metadata?: Record<string, unknown>\n): Promise<string> => {\n  try {\n    const logsRef = collection(db, AUDIT_LOGS_COLLECTION);\n    const newLog: {\n      userId: string | null;\n      action: \"CREATE\" | \"UPDATE\" | \"DELETE\";\n      tableName: string;\n      recordId: string | null;\n      oldData: unknown;\n      newData: unknown;\n      createdAt: Timestamp;\n      metadata?: Record<string, unknown>;\n    } = {\n      userId,\n      action,\n      tableName,\n      recordId,\n      oldData,\n      newData,\n      createdAt: Timestamp.now(),\n    };\n    \n    if (metadata) {\n      newLog.metadata = metadata;\n    }\n    \n    const docRef = await addDoc(logsRef, newLog);\n    return docRef.id;\n  } catch (error: unknown) {\n    if (import.meta.env.DEV) {\n      console.error(\"Error creating audit log:\", error);\n    }\n    // Don't throw - audit logs shouldn't break the main flow\n    return \"\";\n  }\n};\n\n/**\n * Get audit logs with filters\n */\nexport const getAuditLogs = async (options?: {\n  limit?: number;\n  action?: \"CREATE\" | \"UPDATE\" | \"DELETE\";\n  tableName?: string;\n  userId?: string;\n}): Promise<AuditLog[]> => {\n  try {\n    const logsRef = collection(db, AUDIT_LOGS_COLLECTION);\n    let q = query(logsRef, orderBy(\"createdAt\", \"desc\"));\n    \n    // Default limit: 100 (performans iin)\n    const queryLimit = options?.limit || 100;\n    q = query(q, limit(queryLimit));\n    \n    if (options?.action) {\n      q = query(q, where(\"action\", \"==\", options.action));\n    }\n    \n    if (options?.tableName) {\n      q = query(q, where(\"tableName\", \"==\", options.tableName));\n    }\n    \n    if (options?.userId) {\n      q = query(q, where(\"userId\", \"==\", options.userId));\n    }\n    \n    const snapshot = await getDocs(q);\n    const logs: AuditLog[] = [];\n    const userIds = new Set<string>();\n    \n    // nce tm loglar topla ve userId'leri biriktir\n    for (const docSnap of snapshot.docs) {\n      const logData = docSnap.data() as Omit<AuditLog, \"id\">;\n      const log: AuditLog = {\n        id: docSnap.id,\n        ...logData,\n      };\n      \n      if (log.userId) {\n        userIds.add(log.userId);\n      }\n      \n      logs.push(log);\n    }\n    \n    // Tm kullanclar bir kerede al\n    const userMap = new Map<string, { fullName?: string; email: string }>();\n    if (userIds.size > 0) {\n      try {\n        const allUsers = await getAllUsers();\n        allUsers.forEach(user => {\n          if (userIds.has(user.id)) {\n            userMap.set(user.id, {\n              fullName: user.fullName || user.displayName,\n              email: user.email,\n            });\n          }\n        });\n      } catch (error: unknown) {\n        if (import.meta.env.DEV) {\n          console.error(\"Error fetching users:\", error);\n        }\n      }\n    }\n    \n    // User bilgilerini loglara ekle\n    logs.forEach(log => {\n      if (log.userId) {\n        const userInfo = userMap.get(log.userId);\n        if (userInfo) {\n          log.userName = userInfo.fullName || userInfo.email;\n          log.userEmail = userInfo.email;\n        }\n      }\n    });\n    \n    return logs;\n  } catch (error: unknown) {\n    // Index hatas durumunda basit query dene\n    if (error?.code === 'failed-precondition' || error?.message?.includes('index')) {\n      console.warn(\"Audit logs index bulunamad, basit query kullanlyor\");\n      try {\n        const queryLimit = options?.limit || 100;\n        const simpleQuery = query(collection(db, AUDIT_LOGS_COLLECTION), orderBy(\"createdAt\", \"desc\"), limit(queryLimit));\n        const snapshot = await getDocs(simpleQuery);\n        let logs = snapshot.docs.map((docSnap) => {\n          const logData = docSnap.data() as Omit<AuditLog, \"id\">;\n          return {\n            id: docSnap.id,\n            ...logData,\n          } as AuditLog;\n        });\n        \n        // Client-side filtreleme\n        if (options?.action) {\n          logs = logs.filter(l => l.action === options.action);\n        }\n        if (options?.tableName) {\n          logs = logs.filter(l => l.tableName === options.tableName);\n        }\n        if (options?.userId) {\n          logs = logs.filter(l => l.userId === options.userId);\n        }\n        \n        // Tarihe gre srala (zaten orderBy var ama emin olmak iin)\n        logs.sort((a, b) => {\n          const aDate = a.createdAt?.toMillis() || 0;\n          const bDate = b.createdAt?.toMillis() || 0;\n          return bDate - aDate;\n        });\n        \n        // Tm kullanclar bir kerede al\n        const userIds = new Set(logs.map(log => log.userId).filter(Boolean) as string[]);\n        const userMap = new Map<string, { fullName?: string; email: string }>();\n        if (userIds.size > 0) {\n          try {\n            const allUsers = await getAllUsers();\n            allUsers.forEach(user => {\n              if (userIds.has(user.id)) {\n                userMap.set(user.id, {\n                  fullName: user.fullName || user.displayName,\n                  email: user.email,\n                });\n              }\n            });\n          } catch (error: unknown) {\n            if (import.meta.env.DEV) {\n              console.error(\"Error fetching users:\", error);\n            }\n          }\n        }\n        \n        // User bilgilerini loglara ekle\n        logs.forEach(log => {\n          if (log.userId) {\n            const userInfo = userMap.get(log.userId);\n            if (userInfo) {\n              log.userName = userInfo.fullName || userInfo.email;\n              log.userEmail = userInfo.email;\n            }\n          }\n        });\n        \n        return logs;\n      } catch (fallbackError: unknown) {\n        if (import.meta.env.DEV) {\n          console.error(\"Fallback query de baarsz:\", fallbackError);\n        }\n        return [];\n      }\n    }\n    if (import.meta.env.DEV) {\n      console.error(\"Error getting audit logs:\", error);\n    }\n    const errorMessage = error instanceof Error ? error.message : \"Audit loglar yklenemedi\";\n    throw new Error(errorMessage);\n  }\n};\n\n/**\n * Get recent activities (last 10 logs)\n */\nexport const getRecentActivities = async (): Promise<AuditLog[]> => {\n  return getAuditLogs({ limit: 10 });\n};\n\n/**\n * Ekip yelerinin loglarn getir (ekip lideri iin)\n * Ekip liderinin kendi loglarn ve ynettii ekiplerdeki yelerin loglarn dndrr\n */\nexport const getTeamMemberLogs = async (teamLeaderId: string): Promise<{\n  logs: AuditLog[];\n  teamInfo: {\n    managedTeams: Array<{ id: string; name: string }>;\n    teamMembers: Array<{ id: string; name: string; email: string }>;\n  };\n}> => {\n  try {\n    const [departments, allUsers] = await Promise.all([\n      getDepartments(),\n      getAllUsers(),\n    ]);\n    \n    // Ekip liderinin ynettii ekipleri bul\n    const managedTeams = departments.filter((dept) => dept.managerId === teamLeaderId);\n    \n    const teamInfo = {\n      managedTeams: managedTeams.map(team => ({ id: team.id, name: team.name })),\n      teamMembers: [] as Array<{ id: string; name: string; email: string }>,\n    };\n    \n    if (managedTeams.length === 0) {\n      return { logs: [], teamInfo };\n    }\n    \n    const teamIds = managedTeams.map((team) => team.id);\n    \n    // Bu ekiplere ait kullanclar bul\n    const teamMembers = allUsers.filter((user) => {\n      const approvedTeams = user.approvedTeams || [];\n      const pendingTeams = user.pendingTeams || [];\n      return [...approvedTeams, ...pendingTeams].some((teamId) => teamIds.includes(teamId));\n    });\n    \n    // Ekip yeleri bilgilerini kaydet\n    teamInfo.teamMembers = teamMembers.map(member => ({\n      id: member.id,\n      name: member.fullName || member.email,\n      email: member.email,\n    }));\n    \n    const teamMemberIds = teamMembers.map((member) => member.id);\n    \n    // Ekip liderinin kendi loglarn da dahil et\n    const allRelevantUserIds = [...teamMemberIds, teamLeaderId];\n    \n    // Tm loglar al ve filtrele (limit ile)\n    try {\n      const logsRef = collection(db, AUDIT_LOGS_COLLECTION);\n      const snapshot = await getDocs(query(logsRef, orderBy(\"createdAt\", \"desc\"), limit(500))); // Max 500 log\n      \n      const logs: AuditLog[] = [];\n      const userIds = new Set<string>();\n      \n      // nce tm loglar topla ve userId'leri biriktir\n      for (const docSnap of snapshot.docs) {\n        const logData = docSnap.data() as Omit<AuditLog, \"id\">;\n        \n        // Ekip yelerinin ve ekip liderinin loglarn al\n        if (logData.userId && allRelevantUserIds.includes(logData.userId)) {\n          const log: AuditLog = {\n            id: docSnap.id,\n            ...logData,\n          };\n          \n          if (log.userId) {\n            userIds.add(log.userId);\n          }\n          \n          logs.push(log);\n        }\n      }\n      \n      // Tm kullanclar bir kerede al\n      const userMap = new Map<string, { fullName?: string; email: string }>();\n      if (userIds.size > 0) {\n        try {\n          const allUsers = await getAllUsers();\n          allUsers.forEach(user => {\n            if (userIds.has(user.id)) {\n              userMap.set(user.id, {\n                fullName: user.fullName || user.displayName,\n                email: user.email,\n              });\n            }\n          });\n        } catch (error: unknown) {\n          if (import.meta.env.DEV) {\n            console.error(\"Error fetching users:\", error);\n          }\n        }\n      }\n      \n      // User bilgilerini loglara ekle\n      logs.forEach(log => {\n        if (log.userId) {\n          const userInfo = userMap.get(log.userId);\n          if (userInfo) {\n            log.userName = userInfo.fullName || userInfo.email;\n            log.userEmail = userInfo.email;\n          }\n        }\n      });\n      \n      return { logs, teamInfo };\n    } catch (error: unknown) {\n      // Index hatas durumunda basit query dene\n      if (error?.code === 'failed-precondition' || error?.message?.includes('index')) {\n        console.warn(\"Team member logs index bulunamad, basit query kullanlyor\");\n        try {\n          const simpleQuery = query(collection(db, AUDIT_LOGS_COLLECTION), orderBy(\"createdAt\", \"desc\"));\n          const snapshot = await getDocs(simpleQuery);\n          let logs = snapshot.docs\n            .map((docSnap) => {\n              const logData = docSnap.data() as Omit<AuditLog, \"id\">;\n              return {\n                id: docSnap.id,\n                ...logData,\n              } as AuditLog;\n            })\n            .filter((log) => log.userId && allRelevantUserIds.includes(log.userId));\n          \n          // Tarihe gre srala\n          logs.sort((a, b) => {\n            const aDate = a.createdAt?.toMillis() || 0;\n            const bDate = b.createdAt?.toMillis() || 0;\n            return bDate - aDate;\n          });\n          \n          // Tm kullanclar bir kerede al\n          const userIds = new Set(logs.map(log => log.userId).filter(Boolean) as string[]);\n          const userMap = new Map<string, { fullName?: string; email: string }>();\n          if (userIds.size > 0) {\n              try {\n              const allUsers = await getAllUsers();\n              allUsers.forEach(user => {\n                if (userIds.has(user.id)) {\n                  userMap.set(user.id, {\n                    fullName: user.fullName || user.displayName,\n                    email: user.email,\n                  });\n                }\n              });\n              } catch (error: unknown) {\n              console.error(\"Error fetching users:\", error);\n              }\n          }\n          \n          // User bilgilerini loglara ekle\n          logs.forEach(log => {\n            if (log.userId) {\n              const userInfo = userMap.get(log.userId);\n              if (userInfo) {\n                log.userName = userInfo.fullName || userInfo.email;\n                log.userEmail = userInfo.email;\n            }\n          }\n          });\n          \n          return { logs, teamInfo };\n        } catch (fallbackError: unknown) {\n          if (import.meta.env.DEV) {\n            console.error(\"Fallback query de baarsz:\", fallbackError);\n          }\n          return { logs: [], teamInfo };\n        }\n      }\n      throw error;\n    }\n  } catch (error: unknown) {\n    if (import.meta.env.DEV) {\n      console.error(\"Error getting team member logs:\", error);\n    }\n    return { logs: [], teamInfo: { managedTeams: [], teamMembers: [] } };\n  }\n};\n\n/**\n * Belirli bir kullancnn loglarn getir (yetki kontrol ile)\n */\nexport const getUserLogsWithPermission = async (\n  viewerId: string,\n  targetUserId: string\n): Promise<AuditLog[]> => {\n  try {\n    const [viewer, targetUser, departments, allUsers] = await Promise.all([\n      getUserProfile(viewerId),\n      getUserProfile(targetUserId),\n      getDepartments(),\n      getAllUsers(),\n    ]);\n    \n    if (!viewer) {\n      throw new Error(\"Grntleyen kullanc bulunamad\");\n    }\n    \n    // Kullanc kendi loglarn grebilir\n    if (viewer.id === targetUserId) {\n      return getAuditLogs({ userId: targetUserId });\n    }\n    \n    // Ana yneticiler tm loglar grebilir\n    if (viewer.role?.includes(\"main_admin\") || viewer.role?.includes(\"super_admin\")) {\n      return getAuditLogs({ userId: targetUserId });\n    }\n    \n    // Super Admin tm loglar grebilir\n    if (viewer.role?.includes(\"super_admin\") || viewer.role?.includes(\"main_admin\")) {\n      return getAuditLogs({ userId: targetUserId });\n    }\n    \n    // Ekip liderleri ekip yelerinin loglarn grebilir\n    const managedTeams = departments.filter((dept) => dept.managerId === viewer.id);\n    if (managedTeams.length > 0) {\n      const teamIds = managedTeams.map((team) => team.id);\n      const targetUserTeams = [\n        ...(targetUser?.approvedTeams || []),\n        ...(targetUser?.pendingTeams || []),\n      ];\n      \n      const isTeamMember = targetUserTeams.some((teamId) => teamIds.includes(teamId));\n      \n      if (isTeamMember) {\n        return getAuditLogs({ userId: targetUserId });\n      }\n    }\n    \n    // Yetki yok\n    throw new Error(\"Bu kullancnn loglarn grntleme yetkiniz yok\");\n  } catch (error: unknown) {\n    if (import.meta.env.DEV) {\n      console.error(\"Error getting user logs with permission:\", error);\n    }\n    throw error;\n  }\n};\n\n/**\n * Kullancnn tm loglarn sil\n */\nexport const deleteUserLogs = async (userId: string): Promise<void> => {\n  try {\n    const logsRef = collection(db, AUDIT_LOGS_COLLECTION);\n    \n    // Kullancnn tm loglarn bul\n    const q = query(logsRef, where(\"userId\", \"==\", userId));\n    const snapshot = await getDocs(q);\n    \n    // Batch write ile tm loglar sil (500'den fazla ise birden fazla batch)\n    const batchSize = 500;\n    const docs = snapshot.docs;\n    \n    for (let i = 0; i < docs.length; i += batchSize) {\n      const batch = writeBatch(db);\n      const batchDocs = docs.slice(i, i + batchSize);\n      \n      batchDocs.forEach((docSnap) => {\n        batch.delete(docSnap.ref);\n      });\n      \n      await batch.commit();\n    }\n  } catch (error: unknown) {\n    if (import.meta.env.DEV) {\n      console.error(\"Error deleting user logs:\", error);\n    }\n    // Log silme hatas kullanc silme ilemini engellemez\n    throw error;\n  }\n};\n\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\services\\firebase\\authService.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":78,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":78,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1896,1899],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1896,1899],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":189,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":189,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6842,6845],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6842,6845],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":211,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":211,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7994,7997],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7994,7997],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":272,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":272,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10203,10206],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10203,10206],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"prefer-const","severity":2,"message":"'lastLoginUpdateTime' is never reassigned. Use 'const' instead.","line":1793,"column":5,"nodeType":"Identifier","messageId":"useConst","endLine":1793,"endColumn":45,"fix":{"range":[70722,70779],"text":"const lastLoginUpdateTime: Map<string, number> = new Map();"}},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1888,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1888,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[74323,74326],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[74323,74326],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":2715,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2715,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[105161,105164],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[105161,105164],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":7,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":1,"fixableWarningCount":0,"source":"/**\n * Firebase Authentication Service\n * Kullanc kayt, giri, k ve profil ynetimi\n */\n\nimport {\n  signInWithEmailAndPassword,\n  createUserWithEmailAndPassword,\n  signOut as firebaseSignOut,\n  sendEmailVerification,\n  sendPasswordResetEmail,\n  onAuthStateChanged,\n  updateProfile,\n  User as FirebaseUser,\n  GoogleAuthProvider,\n  signInWithPopup,\n} from \"firebase/auth\";\nimport {\n  collection,\n  doc,\n  getDoc,\n  getDocs,\n  setDoc,\n  updateDoc,\n  deleteDoc,\n  serverTimestamp,\n  query,\n  orderBy,\n  limit,\n  writeBatch,\n  where,\n  Timestamp,\n} from \"firebase/firestore\";\nimport { auth, firestore } from \"@/lib/firebase\";\nimport { logAudit } from \"@/utils/auditLogger\";\nimport {\n  REQUIRE_EMAIL_VERIFICATION,\n  ALLOW_DELETED_ACCOUNT_REREGISTRATION,\n  AUTO_SEND_VERIFICATION_EMAIL,\n  RESEND_VERIFICATION_ON_LOGIN\n} from \"@/config/auth\";\n\nexport interface UserProfile {\n  id: string;\n  email: string;\n  displayName: string;\n  fullName?: string;\n  phone?: string;\n  dateOfBirth?: string;\n  role: string[];\n  departmentId?: string;\n  pendingTeams?: string[]; // Onay bekleyen ekipler (department IDs)\n  approvedTeams?: string[]; // Onaylanm ekipler (department IDs)\n  teamLeaderIds?: string[]; // Ekip lideri olduu ekipler (opsiyonel)\n  emailVerified: boolean;\n  createdAt: Timestamp | Date | null;\n  updatedAt: Timestamp | Date | null;\n  lastLoginAt?: Timestamp | Date | null; // Son giri zaman\n}\n\n/**\n * Kullanc kayd\n */\nexport const register = async (\n  email: string,\n  password: string,\n  fullName: string,\n  phone?: string,\n  dateOfBirth?: string,\n  selectedTeamId?: string\n): Promise<{ success: boolean; message?: string; user?: UserProfile | null }> => {\n  try {\n    if (!auth || !firestore) {\n      throw new Error('Firebase is not initialized');\n    }\n\n    // nce email'in kaytl olup olmadn Firestore'dan kontrol et (hzl)\n    let existingUserDoc: { id: string; data: any } | null = null;\n    try {\n      const usersRef = collection(firestore, \"users\");\n      const q = query(usersRef, where(\"email\", \"==\", email), limit(1));\n      const querySnapshot = await getDocs(q);\n\n      if (!querySnapshot.empty) {\n        const doc = querySnapshot.docs[0];\n        const userData = doc.data();\n\n        // Silinmi hesap kontrol - config'e gre yeniden kayt izni ver\n        if (userData.deleted === true) {\n          if (ALLOW_DELETED_ACCOUNT_REREGISTRATION) {\n            // Silinmi hesap - config'e gre yeni kayt olabilir, existingUserDoc'u null yap\n            existingUserDoc = null;\n          } else {\n            // Silinmi hesaplarn yeniden kayd kapal\n            return {\n              success: false,\n              message: \"Bu e-posta adresi daha nce kullanlm ve hesap silinmi. Yeni bir e-posta adresi kullann.\",\n              user: null,\n            };\n          }\n        } else {\n          existingUserDoc = { id: doc.id, data: userData };\n        }\n      }\n    } catch (checkError) {\n      // Firestore kontrol baarsz olsa bile devam et (permission hatas normal)\n      // Giri yapmadan email kontrol yapamayabiliriz, bu durumda Firebase Auth kontrol yaplacak\n      const errorCode = (checkError as { code?: string })?.code;\n      if (errorCode !== 'permission-denied' && import.meta.env.DEV) {\n        console.warn(\"Email kontrol yaplrken hata:\", checkError);\n      }\n    }\n\n    let firebaseUser: FirebaseUser | null = null;\n    let isExistingUser = false;\n\n    if (existingUserDoc) {\n      // Email zaten kaytl - mevcut kullanc ile giri yapmay dene\n      try {\n        const loginResult = await signInWithEmailAndPassword(auth, email, password);\n        firebaseUser = loginResult.user;\n        isExistingUser = true;\n\n        // Firebase Auth'daki user objesini reload et (emailVerified deerinin gncel olmas iin)\n        // reload() user objesini gnceller, bu yzden ayn objeyi kullanmalyz\n        try {\n          if (import.meta.env.DEV) {\n            console.log(\"Register - User reload ncesi emailVerified:\", firebaseUser.emailVerified);\n          }\n          await firebaseUser.reload();\n          // reload() sonras firebaseUser objesi gncellenmi olmal\n          // Ayrca auth.currentUser' da kontrol et (bazen daha gncel olabilir)\n          if (auth.currentUser) {\n            firebaseUser = auth.currentUser;\n          }\n          if (import.meta.env.DEV) {\n            console.log(\"Register - User reload sonras emailVerified:\", firebaseUser.emailVerified);\n            console.log(\"Register - auth.currentUser emailVerified:\", auth.currentUser?.emailVerified);\n          }\n        } catch (reloadError) {\n          if (import.meta.env.DEV) {\n            console.warn(\"User reload hatas (devam ediliyor):\", reloadError);\n          }\n          // Reload hatas olsa bile devam et\n        }\n\n        // Email dorulanm m kontrol et - Firebase Auth en gncel kaynak\n        const userData = existingUserDoc.data;\n        const wasDeleted = userData.deleted === true;\n        // Firebase Auth'daki emailVerified deeri en gncel olandr, ncelikli kontrol\n        // reload() sonras firebaseUser.emailVerified gncellenmi olmal\n        // Eer hala false ise, Firestore'daki deere de bak (senkronizasyon sorunu olabilir)\n        let emailVerified = firebaseUser.emailVerified;\n        // Eer Firebase Auth'da false ama Firestore'da true ise, Firestore'a gven\n        // (Firebase Auth daha gncel olmal ama senkronizasyon sorunu olabilir)\n        if (!emailVerified && userData.emailVerified === true) {\n          if (import.meta.env.DEV) {\n            console.warn(\"Register - Firebase Auth'da emailVerified false ama Firestore'da true, Firestore'a gveniliyor\");\n          }\n          // Firestore'daki deere gven ama Firebase Auth' da gncelle\n          emailVerified = true;\n        }\n\n        if (import.meta.env.DEV) {\n          console.log(\"Register - Mevcut kullanc email dorulama kontrol:\", {\n            firebaseEmailVerified: firebaseUser.emailVerified,\n            firestoreEmailVerified: userData.emailVerified,\n            emailVerified,\n            wasDeleted,\n            userId: firebaseUser.uid,\n            email: firebaseUser.email,\n          });\n        }\n\n        // Eer email dorulanmsa, direkt hata mesaj dndr (kayt olmaya alyor)\n        if (emailVerified && !wasDeleted) {\n          await firebaseSignOut(auth);\n          return {\n            success: false,\n            message: \"Bu hesap zaten var, dorulanm. Giri yapabilirsiniz.\",\n            user: null,\n          };\n        }\n\n        // Email dorulanmamsa veya silinmise devam et (aadaki kod devam edecek)\n      } catch (loginError: unknown) {\n        // ifre yanl - email zaten kaytl ama ifre yanl\n        const customError = new Error(\"Bu hesap zaten kaytl. Ltfen giri yapmay deneyin.\");\n        (customError as any).code = 'auth/email-already-in-use';\n        throw customError;\n      }\n    } else {\n      // Email kaytl deil veya silinmi - yeni kullanc olutur\n      try {\n        const userCredential = await createUserWithEmailAndPassword(auth, email, password);\n        firebaseUser = userCredential.user;\n        isExistingUser = false;\n      } catch (createError: unknown) {\n        // Eer email zaten Firebase Auth'da varsa (silinmi hesap olabilir)\n        const errorCode = (createError as { code?: string })?.code;\n        if (errorCode === 'auth/email-already-in-use') {\n          // Firebase Auth'da email var ama Firestore'da silinmi\n          // Giri yapmay dene ve Firestore'u gncelle\n          try {\n            const loginResult = await signInWithEmailAndPassword(auth, email, password);\n            firebaseUser = loginResult.user;\n            isExistingUser = false; // Yeni kayt olarak ilem yap (silinmi hesap tekrar kayt oluyor)\n          } catch (loginError: unknown) {\n            // ifre yanl\n            const customError = new Error(\"Bu hesap zaten kaytl. Ltfen giri yapmay deneyin.\");\n            (customError as any).code = 'auth/email-already-in-use';\n            throw customError;\n          }\n        } else {\n          throw createError;\n        }\n      }\n    }\n\n    if (!firebaseUser) {\n      throw new Error('Kullanc oluturulamad veya bulunamad');\n    }\n\n    const userId = firebaseUser.uid;\n\n    // Firestore'da kullanc profili olutur (sadece yeni kullanc iin)\n    const userProfileData: Record<string, unknown> = {\n      email: email,\n      displayName: fullName,\n      fullName: fullName,\n      role: [\"viewer\"], // Varsaylan rol\n      emailVerified: false, // Email dorulama zorunlu, balangta false\n      needsEmailVerification: true, // Yeni kayt olan kullanclar iin email dorulamas zorunlu\n      createdAt: serverTimestamp(),\n      updatedAt: serverTimestamp(),\n      pendingTeams: selectedTeamId ? [selectedTeamId] : [],\n      approvedTeams: [],\n    };\n\n    // Opsiyonel alanlar sadece tanmlysa ve bo deilse ekle\n    if (phone && phone.trim() !== '') {\n      userProfileData.phone = phone.trim();\n    }\n    if (dateOfBirth && dateOfBirth.trim() !== '') {\n      userProfileData.dateOfBirth = dateOfBirth.trim();\n    }\n\n    const userDocRef = doc(firestore, \"users\", userId);\n\n    // Firestore yazma, display name gncelleme ve email dorulama gnderme ilemlerini paralel yap\n    const promises: Promise<void>[] = [];\n    let emailVerificationError: Error | null = null;\n\n    // Firestore yazma ilemi (hzl - gereksiz getDoc kaldrld)\n    const firestorePromise = (async () => {\n      if (isExistingUser && existingUserDoc) {\n        // Mevcut kullanc - sadece gncelleme yap\n        // Email dorulama durumu: Firebase Auth en gncel kaynak\n        const userData = existingUserDoc.data;\n        // Firebase Auth'daki emailVerified deeri en gncel olandr, ncelikli kontrol\n        const emailVerified = firebaseUser.emailVerified;\n\n        if (import.meta.env.DEV) {\n          console.log(\"Register - Mevcut kullanc Firestore gncelleme ncesi:\", {\n            email,\n            firebaseEmailVerified: firebaseUser.emailVerified,\n            firestoreEmailVerified: userData.emailVerified,\n            emailVerified,\n          });\n        }\n\n        const updateData: any = {\n          displayName: fullName,\n          fullName: fullName,\n          updatedAt: serverTimestamp(),\n        };\n\n        // Opsiyonel alanlar sadece tanmlysa ekle\n        if (phone && phone.trim() !== '') {\n          updateData.phone = phone.trim();\n        }\n        if (dateOfBirth && dateOfBirth.trim() !== '') {\n          updateData.dateOfBirth = dateOfBirth.trim();\n        }\n        if (selectedTeamId) {\n          updateData.pendingTeams = [selectedTeamId];\n        }\n\n        // Email dorulama durumunu Firebase Auth'dan al ve Firestore'a senkronize et\n        if (emailVerified) {\n          // Email dorulanmsa needsEmailVerification flag'ini false yap\n          updateData.needsEmailVerification = false;\n          updateData.emailVerified = true;\n\n          if (import.meta.env.DEV) {\n            console.log(\"Register - Mevcut kullanc iin email dorulanm, needsEmailVerification: false set ediliyor\");\n          }\n        } else {\n          // Email dorulanmamsa needsEmailVerification flag'ini true yap\n          updateData.needsEmailVerification = true;\n          updateData.emailVerified = false;\n\n          if (import.meta.env.DEV) {\n            console.log(\"Register - Mevcut kullanc iin email dorulanmam, needsEmailVerification: true set ediliyor\");\n          }\n        }\n\n        // undefined deerleri temizle (Firestore undefined kabul etmez)\n        const cleanUpdateData: Record<string, unknown> = {};\n        for (const [key, value] of Object.entries(updateData)) {\n          if (value !== undefined) {\n            cleanUpdateData[key] = value;\n          }\n        }\n\n        await updateDoc(userDocRef, cleanUpdateData);\n\n        if (import.meta.env.DEV) {\n          console.log(\"Register - Firestore gncellemesi tamamland\", {\n            email,\n            needsEmailVerification: updateData.needsEmailVerification,\n            emailVerified: updateData.emailVerified,\n          });\n        }\n      } else {\n        // Yeni kullanc veya silinmi hesap tekrar kayt oluyor\n        // Silinmi hesap iin sfrdan kayt oluyor gibi devam et\n        // undefined deerleri temizle (Firestore undefined kabul etmez)\n        const cleanUserProfileData: Record<string, unknown> = {\n          ...userProfileData,\n          deleted: false, // Silinmi flag'ini kaldr\n          needsEmailVerification: true, // Silinmi hesap iin de email dorulamas zorunlu\n          emailVerified: false, // Email dorulamas yaplmal\n        };\n\n        // undefined deerleri kaldr\n        for (const [key, value] of Object.entries(cleanUserProfileData)) {\n          if (value === undefined) {\n            delete cleanUserProfileData[key];\n          }\n        }\n\n        // setDoc merge: true ile alr, eer dokman varsa gnceller, yoksa oluturur\n        await setDoc(userDocRef, cleanUserProfileData, { merge: true });\n\n        if (import.meta.env.DEV) {\n          console.log(\"Register - Yeni kullanc veya silinmi hesap iin kayt\", {\n            email,\n            isExistingUser,\n            firebaseEmailVerified: firebaseUser.emailVerified,\n          });\n        }\n      }\n    })();\n    promises.push(firestorePromise);\n\n    // Display name gncelleme\n    if (fullName) {\n      promises.push(updateProfile(firebaseUser, { displayName: fullName }).catch((error) => {\n        if (import.meta.env.DEV) {\n          console.error(\"Display name gncellenirken hata:\", error);\n        }\n        // Hata olsa bile devam et\n      }));\n    }\n\n    // Email dorulama gnder (sadece email dorulanmamsa ve AUTO_SEND_VERIFICATION_EMAIL true ise)\n    // Config'e gre email gnderimi kontrol edilir\n    if (AUTO_SEND_VERIFICATION_EMAIL && !firebaseUser.emailVerified) {\n      const emailPromise = sendEmailVerification(firebaseUser)\n        .then(() => {\n          if (import.meta.env.DEV) {\n            console.log(\"Email dorulama maili gnderildi:\", email);\n          }\n        })\n        .catch((verifyError: unknown) => {\n          const errorCode = (verifyError as { code?: string })?.code;\n          const errorMsg = verifyError instanceof Error ? verifyError.message : String(verifyError);\n\n          if (import.meta.env.DEV) {\n            console.error(\"Email dorulama maili gnderilirken hata:\", verifyError);\n          }\n\n          // Hatay kaydet\n          let errorMessage = \"Email dorulama maili gnderilemedi.\";\n          if (errorCode === 'auth/too-many-requests') {\n            errorMessage = \"ok fazla istek yapld. Ltfen bir sre sonra tekrar deneyin.\";\n          } else if (errorCode === 'auth/network-request-failed') {\n            errorMessage = \"A hatas. nternet balantnz kontrol edin.\";\n          } else if (errorMsg) {\n            errorMessage = errorMsg;\n          }\n\n          emailVerificationError = new Error(errorMessage + \" Ltfen daha sonra tekrar deneyin.\");\n        });\n\n      // Email gnderme ilemini timeout ile snrlandr (2 saniye - hzl ama gvenilir)\n      const emailWithTimeout = Promise.race([\n        emailPromise,\n        new Promise<void>((resolve) => {\n          setTimeout(() => {\n            if (import.meta.env.DEV) {\n              console.warn(\"Email gnderme ilemi timeout (2 saniye), background'da devam ediyor...\");\n            }\n            resolve();\n          }, 2000); // 2 saniye timeout\n        })\n      ]);\n\n      promises.push(emailWithTimeout);\n    }\n\n    // Tm paralel ilemleri bekle (Firestore yazma, display name, email gnderme)\n    const results = await Promise.allSettled(promises);\n\n    // Firestore gncellemesinin baarl olduundan emin ol\n    if (import.meta.env.DEV) {\n      const firestoreResult = results[0];\n      if (firestoreResult.status === 'rejected') {\n        console.error(\"Register - Firestore gncellemesi baarsz:\", firestoreResult.reason);\n      } else {\n        console.log(\"Register - Firestore gncellemesi baarl\");\n      }\n    }\n\n    // Email gnderim hatas varsa frlat\n    if (emailVerificationError) {\n      throw emailVerificationError;\n    }\n\n    // Firestore gncellemesinin tamamlandndan emin olmak iin ksa bir bekleme\n    // (Firestore'un eventual consistency zellii nedeniyle)\n    await new Promise(resolve => setTimeout(resolve, 100));\n\n    // Eer ekip seildiyse, ekip liderine ve yneticilere bildirim gnder\n    if (selectedTeamId) {\n      try {\n        const { getDepartmentById } = await import(\"./departmentService\");\n        const { createNotification } = await import(\"./notificationService\");\n        const department = await getDepartmentById(selectedTeamId);\n\n        if (department) {\n          const requesterName = fullName || email || \"Bir kullanc\";\n          const teamName = department.name || \"ekip\";\n\n          const notificationPromises: Promise<void>[] = [];\n\n          // Ekip liderine bildirim gnder\n          if (department.managerId) {\n            notificationPromises.push(\n              createNotification({\n                userId: department.managerId,\n                type: \"system\",\n                title: \"Yeni katlm istei\",\n                message: `${requesterName} \"${teamName}\" ekibine katlmak iin istek gnderdi. stei onaylamak veya reddetmek iin Ekip yeleri sayfasn ziyaret edin.`,\n                read: false,\n                metadata: {\n                  teamId: selectedTeamId,\n                  teamName: teamName,\n                  requesterId: userId,\n                  requesterName: requesterName,\n                  requesterEmail: email,\n                },\n              }).then(() => { }).catch(err => {\n                if (import.meta.env.DEV) {\n                  console.error(\"Error sending notification to team leader:\", err);\n                }\n              })\n            );\n          }\n\n          // Yneticilere (super_admin, main_admin) bildirim gnder\n          try {\n            const allUsers = await getAllUsers();\n            const admins = allUsers.filter(u =>\n              u.role?.includes(\"super_admin\") || u.role?.includes(\"main_admin\")\n            );\n\n            for (const admin of admins) {\n              notificationPromises.push(\n                createNotification({\n                  userId: admin.id,\n                  type: \"system\",\n                  title: \"Yeni ekip katlm istei\",\n                  message: `${requesterName} \"${teamName}\" ekibine katlmak iin istek gnderdi. stei onaylamak veya reddetmek iin Ekip Onay Ynetimi sayfasn ziyaret edin.`,\n                  read: false,\n                  metadata: {\n                    teamId: selectedTeamId,\n                    teamName: teamName,\n                    requesterId: userId,\n                    requesterName: requesterName,\n                    requesterEmail: email,\n                  },\n                }).then(() => { }).catch(err => {\n                  if (import.meta.env.DEV) {\n                    console.error(`Error sending notification to admin ${admin.id}:`, err);\n                  }\n                })\n              );\n            }\n          } catch (adminError) {\n            if (import.meta.env.DEV) {\n              console.error(\"Error getting admins for notification:\", adminError);\n            }\n          }\n\n          // Tm bildirimleri paralel gnder (await etmeden, arka planda)\n          Promise.allSettled(notificationPromises).catch(() => {\n            // Bildirim hatas kayt ilemini engellemez\n          });\n        }\n      } catch (notifError) {\n        if (import.meta.env.DEV) {\n          console.error(\"Error sending team request notifications:\", notifError);\n        }\n        // Bildirim hatas kayt ilemini engellemez\n      }\n    }\n\n    // Mevcut kullanc iin mesaj farkl olabilir\n    // Email zaten dorulanmsa dorulama mesaj gsterme\n    let successMessage: string;\n    if (isExistingUser) {\n      // Mevcut kullanc kayt olmaya alyor - \"bu hesap zaten var\" mesaj gster\n      if (firebaseUser.emailVerified) {\n        successMessage = \"Bu hesap zaten var, dorulanm. Giri yapabilirsiniz.\";\n      } else {\n        successMessage = \"Hesap var ama dorulama yaplmam. Dorulama maili gnderildi. Ltfen e-postanz ve spam kutusunu kontrol edin.\";\n      }\n    } else {\n      // lk yeni kayt - sadece dorulama maili bildirimi\n      if (firebaseUser.emailVerified) {\n        successMessage = \"Kayt baarl!\";\n      } else {\n        successMessage = \"Dorulama maili gnderildi. Dorulama yaptktan sonra giri yapabilirsiniz. Ltfen e-postanz ve spam kutusunu kontrol edin.\";\n      }\n    }\n\n    return {\n      success: true,\n      message: successMessage,\n      user: {\n        id: userId,\n        email: email,\n        displayName: fullName,\n        fullName: fullName,\n        phone: phone || undefined,\n        dateOfBirth: dateOfBirth || undefined,\n        role: [\"viewer\"],\n        pendingTeams: selectedTeamId ? [selectedTeamId] : [],\n        approvedTeams: [],\n        emailVerified: firebaseUser.emailVerified || false,\n        createdAt: new Date(),\n        updatedAt: new Date(),\n      },\n    };\n  } catch (error: unknown) {\n    // Firebase hata kodlarn Trke'ye evir\n    let errorMessage = \"Kayt baarsz\";\n    const errorCode = (error as { code?: string })?.code;\n    const errorMsg = error instanceof Error ? error.message : String(error);\n\n    // Beklenen hatalar iin sessizce devam et, sadece beklenmeyen hatalar iin log gster\n    const isExpectedError = [\n      'auth/email-already-in-use',\n      'auth/invalid-email',\n      'auth/weak-password',\n      'auth/operation-not-allowed',\n      'auth/invalid-credential',\n      'auth/user-disabled',\n      'auth/too-many-requests'\n    ].includes(errorCode || '');\n\n    // Detayl hata loglama (sadece beklenmeyen hatalar iin)\n    if (!isExpectedError && import.meta.env.DEV) {\n      console.error(\"Register error details:\", {\n        code: errorCode,\n        message: errorMsg,\n        error: error\n      });\n    }\n\n    if (errorCode === 'auth/email-already-in-use') {\n      // Email zaten kaytl - dorulanmam kullanc olabilir, giri yapmay dene\n      // Bu beklenen bir durum, console'da hata gsterme\n      try {\n        const loginResult = await signInWithEmailAndPassword(auth, email, password);\n        let existingUser = loginResult.user;\n\n        // Firebase Auth'daki user objesini reload et (emailVerified deerinin gncel olmas iin)\n        // reload() user objesini gnceller, bu yzden ayn objeyi kullanmalyz\n        try {\n          if (import.meta.env.DEV) {\n            console.log(\"Register - auth/email-already-in-use User reload ncesi emailVerified:\", existingUser.emailVerified);\n          }\n          await existingUser.reload();\n          // reload() sonras existingUser objesi gncellenmi olmal\n          // Ayrca auth.currentUser' da kontrol et (bazen daha gncel olabilir)\n          if (auth.currentUser) {\n            existingUser = auth.currentUser;\n          }\n          if (import.meta.env.DEV) {\n            console.log(\"Register - auth/email-already-in-use User reload sonras emailVerified:\", existingUser.emailVerified);\n            console.log(\"Register - auth/email-already-in-use auth.currentUser emailVerified:\", auth.currentUser?.emailVerified);\n          }\n        } catch (reloadError) {\n          if (import.meta.env.DEV) {\n            console.warn(\"User reload hatas (devam ediliyor):\", reloadError);\n          }\n          // Reload hatas olsa bile devam et\n        }\n\n        // Email dorulanmamsa veya hesap silinmise, Firestore'u gncelle ve dorulama email'i gnder\n        const userDoc = await getDoc(doc(firestore!, \"users\", existingUser.uid));\n        const existingData = userDoc.exists() ? userDoc.data() : null;\n        const wasDeleted = existingData?.deleted === true;\n\n        // Firebase Auth'daki emailVerified deeri en gncel olandr, ncelikli kontrol\n        // reload() sonras existingUser.emailVerified gncellenmi olmal\n        // Eer hala false ise, Firestore'daki deere de bak (senkronizasyon sorunu olabilir)\n        let emailVerified = existingUser.emailVerified;\n        // Eer Firebase Auth'da false ama Firestore'da true ise, Firestore'a gven\n        // (Firebase Auth daha gncel olmal ama senkronizasyon sorunu olabilir)\n        if (!emailVerified && existingData?.emailVerified === true) {\n          if (import.meta.env.DEV) {\n            console.warn(\"Register - auth/email-already-in-use Firebase Auth'da emailVerified false ama Firestore'da true, Firestore'a gveniliyor\");\n          }\n          // Firestore'daki deere gven ama Firebase Auth' da gncelle\n          emailVerified = true;\n        }\n\n        if (import.meta.env.DEV) {\n          console.log(\"Register - auth/email-already-in-use email dorulama kontrol:\", {\n            firebaseEmailVerified: existingUser.emailVerified,\n            firestoreEmailVerified: existingData?.emailVerified,\n            emailVerified,\n            wasDeleted,\n            userId: existingUser.uid,\n            email: existingUser.email,\n          });\n        }\n\n        // Eer email dorulanmsa ve hesap silinmemise, direkt hata mesaj dndr\n        if (emailVerified && !wasDeleted) {\n          await firebaseSignOut(auth);\n          return {\n            success: false,\n            message: \"Bu hesap zaten var, dorulanm. Giri yapabilirsiniz.\",\n            user: null,\n          };\n        }\n\n        if (!emailVerified || wasDeleted) {\n          if (userDoc.exists()) {\n            // Firestore'u gncelle\n            const updateDataForExisting: Record<string, unknown> = {\n              displayName: fullName,\n              fullName: fullName,\n              updatedAt: serverTimestamp(),\n            };\n\n            // Opsiyonel alanlar sadece tanmlysa ekle\n            if (phone && phone.trim() !== '') {\n              updateDataForExisting.phone = phone.trim();\n            }\n            if (dateOfBirth && dateOfBirth.trim() !== '') {\n              updateDataForExisting.dateOfBirth = dateOfBirth.trim();\n            }\n            if (selectedTeamId) {\n              updateDataForExisting.pendingTeams = [selectedTeamId];\n            }\n\n            // Silinmi hesap tekrar kayt oluyorsa, deleted flag'ini kaldr\n            if (wasDeleted) {\n              updateDataForExisting.deleted = false;\n              updateDataForExisting.needsEmailVerification = true;\n              updateDataForExisting.emailVerified = false;\n            }\n\n            // undefined deerleri temizle (Firestore undefined kabul etmez)\n            const cleanUpdateDataForExisting: Record<string, unknown> = {};\n            for (const [key, value] of Object.entries(updateDataForExisting)) {\n              if (value !== undefined) {\n                cleanUpdateDataForExisting[key] = value;\n              }\n            }\n\n            await updateDoc(doc(firestore!, \"users\", existingUser.uid), cleanUpdateDataForExisting);\n          } else {\n            // Firestore'da yoksa olutur\n            const newUserData: Record<string, unknown> = {\n              email: email,\n              displayName: fullName,\n              fullName: fullName,\n              role: [\"viewer\"],\n              emailVerified: false,\n              createdAt: serverTimestamp(),\n              updatedAt: serverTimestamp(),\n              pendingTeams: selectedTeamId ? [selectedTeamId] : [],\n              approvedTeams: [],\n            };\n\n            // Opsiyonel alanlar sadece tanmlysa ekle\n            if (phone && phone.trim() !== '') {\n              newUserData.phone = phone.trim();\n            }\n            if (dateOfBirth && dateOfBirth.trim() !== '') {\n              newUserData.dateOfBirth = dateOfBirth.trim();\n            }\n\n            // undefined deerleri temizle (Firestore undefined kabul etmez)\n            const cleanNewUserData: Record<string, unknown> = {};\n            for (const [key, value] of Object.entries(newUserData)) {\n              if (value !== undefined) {\n                cleanNewUserData[key] = value;\n              }\n            }\n\n            await setDoc(doc(firestore!, \"users\", existingUser.uid), cleanNewUserData);\n          }\n\n          // Eer ekip seildiyse, ekip liderine ve yneticilere bildirim gnder\n          if (selectedTeamId) {\n            try {\n              const { getDepartmentById } = await import(\"./departmentService\");\n              const { createNotification } = await import(\"./notificationService\");\n              const department = await getDepartmentById(selectedTeamId);\n\n              if (department) {\n                const requesterName = fullName || email || \"Bir kullanc\";\n                const teamName = department.name || \"ekip\";\n\n                const notificationPromises: Promise<void>[] = [];\n\n                // Ekip liderine bildirim gnder\n                if (department.managerId) {\n                  notificationPromises.push(\n                    createNotification({\n                      userId: department.managerId,\n                      type: \"system\",\n                      title: \"Yeni katlm istei\",\n                      message: `${requesterName} \"${teamName}\" ekibine katlmak iin istek gnderdi. stei onaylamak veya reddetmek iin Ekip yeleri sayfasn ziyaret edin.`,\n                      read: false,\n                      metadata: {\n                        teamId: selectedTeamId,\n                        teamName: teamName,\n                        requesterId: existingUser.uid,\n                        requesterName: requesterName,\n                        requesterEmail: email,\n                      },\n                    }).then(() => { }).catch(err => {\n                      if (import.meta.env.DEV) {\n                        console.error(\"Error sending notification to team leader:\", err);\n                      }\n                    })\n                  );\n                }\n\n                // Yneticilere (super_admin, main_admin) bildirim gnder\n                try {\n                  const allUsers = await getAllUsers();\n                  const admins = allUsers.filter(u =>\n                    u.role?.includes(\"super_admin\") || u.role?.includes(\"main_admin\")\n                  );\n\n                  for (const admin of admins) {\n                    notificationPromises.push(\n                      createNotification({\n                        userId: admin.id,\n                        type: \"system\",\n                        title: \"Yeni ekip katlm istei\",\n                        message: `${requesterName} \"${teamName}\" ekibine katlmak iin istek gnderdi. stei onaylamak veya reddetmek iin Ekip Onay Ynetimi sayfasn ziyaret edin.`,\n                        read: false,\n                        metadata: {\n                          teamId: selectedTeamId,\n                          teamName: teamName,\n                          requesterId: existingUser.uid,\n                          requesterName: requesterName,\n                          requesterEmail: email,\n                        },\n                      }).then(() => { }).catch(err => {\n                        if (import.meta.env.DEV) {\n                          console.error(`Error sending notification to admin ${admin.id}:`, err);\n                        }\n                      })\n                    );\n                  }\n                } catch (adminError) {\n                  if (import.meta.env.DEV) {\n                    console.error(\"Error getting admins for notification:\", adminError);\n                  }\n                }\n\n                // Tm bildirimleri paralel gnder (await etmeden, arka planda)\n                Promise.allSettled(notificationPromises).catch(() => {\n                  // Bildirim hatas kayt ilemini engellemez\n                });\n              }\n            } catch (notifError) {\n              if (import.meta.env.DEV) {\n                console.error(\"Error sending team request notifications:\", notifError);\n              }\n              // Bildirim hatas kayt ilemini engellemez\n            }\n          }\n\n          // Display name ve email dorulama mailini paralel gnder (hzlandrma)\n          const updatePromises: Promise<void>[] = [];\n          let emailVerificationError: Error | null = null;\n\n          updatePromises.push(updateProfile(existingUser, { displayName: fullName }).catch((error) => {\n            if (import.meta.env.DEV) {\n              console.error(\"Display name gncellenirken hata:\", error);\n            }\n          }));\n\n          // Dorulama email'i gnder\n          updatePromises.push(\n            sendEmailVerification(existingUser)\n              .then(() => {\n                if (import.meta.env.DEV) {\n                  console.log(\"Email dorulama maili gnderildi (mevcut kullanc):\", email);\n                }\n              })\n              .catch((verifyError) => {\n                if (import.meta.env.DEV) {\n                  console.error(\"Email dorulama maili gnderilirken hata:\", verifyError);\n                }\n                emailVerificationError = new Error(\"Email dorulama maili gnderilemedi. Ltfen daha sonra tekrar deneyin veya Firebase Console'da email ayarlarn kontrol edin.\");\n              })\n          );\n\n          // Tm paralel ilemleri bekle\n          await Promise.allSettled(updatePromises);\n\n          // Email gnderim hatas varsa frlat\n          if (emailVerificationError) {\n            await firebaseSignOut(auth);\n            throw emailVerificationError;\n          }\n\n          // k yap (kullanc email dorulamadan giri yapamaz)\n          await firebaseSignOut(auth);\n\n          return {\n            success: true,\n            message: \"Hesap var ama dorulama yaplmam. Dorulama maili gnderildi. Ltfen e-postanz ve spam kutusunu kontrol edin.\",\n            user: {\n              id: existingUser.uid,\n              email: email,\n              displayName: fullName,\n              fullName: fullName,\n              phone: phone || undefined,\n              dateOfBirth: dateOfBirth || undefined,\n              role: [\"viewer\"],\n              pendingTeams: selectedTeamId ? [selectedTeamId] : [],\n              approvedTeams: [],\n              emailVerified: false,\n              createdAt: new Date(),\n              updatedAt: new Date(),\n            },\n          };\n        }\n      } catch (loginError: unknown) {\n        // Giri baarsz (ifre yanl veya baka bir hata)\n        // Email zaten kaytl olduu iin \"bu hesap zaten kaytl\" mesaj gster\n        errorMessage = \"Bu hesap zaten kaytl. Ltfen giri yapmay deneyin.\";\n      }\n    } else if (errorCode === 'auth/invalid-email') {\n      errorMessage = \"Geersiz e-posta adresi. Ltfen geerli bir e-posta adresi girin.\";\n    } else if (errorCode === 'auth/weak-password') {\n      errorMessage = \"ifre ok zayf. ifre en az 8 karakter, 1 byk harf, 1 kk harf ve 1 rakam iermelidir.\";\n    } else if (errorCode === 'auth/operation-not-allowed') {\n      errorMessage = \"E-posta/ifre ile kayt u anda devre d. Ltfen yneticiye bavurun.\";\n    } else if (errorCode === 'auth/invalid-credential') {\n      // Email zaten kaytl ama ifre yanl - \"bu hesap zaten kaytl\" mesaj gster\n      errorMessage = \"Bu hesap zaten kaytl. Ltfen giri yapmay deneyin.\";\n    } else if (errorCode === 'auth/user-disabled') {\n      errorMessage = \"Bu hesap devre d braklm. Ltfen yneticiye bavurun.\";\n    } else if (errorCode === 'auth/too-many-requests') {\n      errorMessage = \"ok fazla istek yapld. Ltfen bir sre sonra tekrar deneyin.\";\n    } else if (errorCode === 'auth/network-request-failed') {\n      errorMessage = \"A hatas. nternet balantnz kontrol edin.\";\n    } else if (errorCode === 'auth/internal-error') {\n      errorMessage = \"Sunucu hatas. Ltfen daha sonra tekrar deneyin.\";\n    } else if (errorCode === 'permission-denied' || errorMsg.includes('permissions')) {\n      errorMessage = \"Firestore izin hatas. Ltfen Firebase Console'da Security Rules'u kontrol edin. Detaylar: \" + (errorMsg || \"zin reddedildi\");\n    } else if (errorMsg.includes('Unsupported field value: undefined')) {\n      errorMessage = \"Form verilerinde eksik veya geersiz alanlar var. Ltfen tm zorunlu alanlar doldurun ve tekrar deneyin.\";\n    } else if (errorMsg.includes('invalid data')) {\n      errorMessage = \"Gnderilen veriler geersiz. Ltfen tm alanlar kontrol edip tekrar deneyin.\";\n    } else if (errorMsg) {\n      errorMessage = errorMsg;\n    }\n\n    // Sadece beklenmeyen hatalar iin console.error gster\n    // auth/email-already-in-use beklenen bir durum ve handle ediliyor, console'da gsterme\n    if (!isExpectedError && import.meta.env.DEV) {\n      console.error(\"Register error:\", error);\n    } else if (errorCode === 'auth/email-already-in-use' && import.meta.env.DEV) {\n      // Email zaten kaytl durumu handle edildi, sadece debug iin log\n      console.debug(\"Email zaten kaytl, giri yapmay deniyoruz...\");\n    }\n\n    return {\n      success: false,\n      message: errorMessage,\n      user: null,\n    };\n  }\n};\n\n/**\n * Kullanc girii\n */\nexport const login = async (\n  email: string,\n  password: string\n): Promise<{ success: boolean; message?: string; user?: UserProfile | null }> => {\n  try {\n    if (!auth || !firestore) {\n      throw new Error('Firebase is not initialized');\n    }\n    // Firebase Auth ile giri yap\n    const userCredential = await signInWithEmailAndPassword(auth, email, password);\n    let firebaseUser = userCredential.user;\n\n    // Firebase Auth'daki user objesini reload et (emailVerified deerinin gncel olmas iin)\n    try {\n      if (import.meta.env.DEV) {\n        console.log(\"Login - User reload ncesi emailVerified:\", firebaseUser.emailVerified);\n      }\n      await firebaseUser.reload();\n      // reload() sonras firebaseUser objesi gncellenmi olmal\n      // Ayrca auth.currentUser' da kontrol et (bazen daha gncel olabilir)\n      if (auth.currentUser) {\n        firebaseUser = auth.currentUser;\n      }\n      if (import.meta.env.DEV) {\n        console.log(\"Login - User reload sonras emailVerified:\", firebaseUser.emailVerified);\n        console.log(\"Login - auth.currentUser emailVerified:\", auth.currentUser?.emailVerified);\n      }\n    } catch (reloadError) {\n      if (import.meta.env.DEV) {\n        console.warn(\"Login - User reload hatas (devam ediliyor):\", reloadError);\n      }\n      // Reload hatas olsa bile devam et\n    }\n\n    // nce direkt Firestore'dan silinmi kullanc kontrol yap\n    try {\n      const userDoc = await getDoc(doc(firestore, \"users\", firebaseUser.uid));\n      if (userDoc.exists()) {\n        const userData = userDoc.data();\n        if (userData.deleted === true) {\n          // Hemen k yap\n          try {\n            await firebaseSignOut(auth);\n          } catch (signOutError) {\n            if (import.meta.env.DEV) {\n              if (import.meta.env.DEV) {\n                console.error(\"k yaplrken hata:\", signOutError);\n              }\n            }\n          }\n          return {\n            success: false,\n            message: \"Bu hesap silinmi. Giri yapamazsnz.\",\n            user: null,\n          };\n        }\n      }\n    } catch (checkError) {\n      console.error(\"Kullanc kontrol hatas:\", checkError);\n      // Kontrol hatas olsa bile devam et, getUserProfile kontrol edecek\n    }\n\n    try {\n      let userProfile: UserProfile | null = null;\n      let isDeletedAccount = false;\n\n      // getUserProfile() arsn try-catch ile sarmalayalm\n      // nk silinmi kullanc iin hata frlatyor\n      try {\n        userProfile = await getUserProfile(firebaseUser.uid);\n      } catch (profileError: unknown) {\n        // Eer hata mesaj \"silinmi\" ieriyorsa, silinmi hesap\n        const errorMsg = profileError instanceof Error ? profileError.message : String(profileError);\n        if (errorMsg.includes(\"silinmi\")) {\n          isDeletedAccount = true;\n        } else {\n          // Dier hatalar iin null olarak devam et\n          if (import.meta.env.DEV) {\n            console.warn(\"getUserProfile hatas (devam ediliyor):\", profileError);\n          }\n        }\n      }\n\n      // Eer silinmi hesap ise, uyar ver ve k yap\n      if (isDeletedAccount) {\n        try {\n          await firebaseSignOut(auth);\n        } catch (signOutError) {\n          if (import.meta.env.DEV) {\n            console.error(\"k yaplrken hata:\", signOutError);\n          }\n        }\n        return {\n          success: false,\n          message: \"Bu hesap silinmi. Giri yapamazsnz.\",\n          user: null,\n        };\n      }\n\n      // Eer userProfile null ise, Firestore'dan direkt kontrol et\n      // nk null dnmesi sadece silinmi hesap anlamna gelmez\n      // (dokman yoksa, permission hatas varsa da null dnebilir)\n      if (!userProfile) {\n        // Firestore'dan direkt kontrol et - silinmi mi deil mi?\n        try {\n          const userDocCheck = await getDoc(doc(firestore, \"users\", firebaseUser.uid));\n          if (userDocCheck.exists()) {\n            const userDataCheck = userDocCheck.data();\n            // Eer dokman varsa ve silinmise, o zaman silinmi hesap uyars ver\n            if (userDataCheck.deleted === true) {\n              try {\n                await firebaseSignOut(auth);\n              } catch (signOutError) {\n                if (import.meta.env.DEV) {\n                  console.error(\"k yaplrken hata:\", signOutError);\n                }\n              }\n              return {\n                success: false,\n                message: \"Bu hesap silinmi. Giri yapamazsnz.\",\n                user: null,\n              };\n            }\n            // Dokman var ama getUserProfile null dnd - tekrar deneyelim\n            // Belki Firestore eventual consistency nedeniyle gecikti\n            await new Promise(resolve => setTimeout(resolve, 200));\n            try {\n              userProfile = await getUserProfile(firebaseUser.uid);\n            } catch (retryError: unknown) {\n              // Eer hata mesaj \"silinmi\" ieriyorsa, silinmi hesap\n              const errorMsg = retryError instanceof Error ? retryError.message : String(retryError);\n              if (errorMsg.includes(\"silinmi\")) {\n                try {\n                  await firebaseSignOut(auth);\n                } catch (signOutError) {\n                  if (import.meta.env.DEV) {\n                    console.error(\"k yaplrken hata:\", signOutError);\n                  }\n                }\n                return {\n                  success: false,\n                  message: \"Bu hesap silinmi. Giri yapamazsnz.\",\n                  user: null,\n                };\n              }\n              // Dier hatalar iin null olarak devam et\n              if (import.meta.env.DEV) {\n                console.warn(\"getUserProfile retry hatas (devam ediliyor):\", retryError);\n              }\n            }\n          } else {\n            // Dokman yoksa, profil oluturulmam olabilir\n            // Yeni kayt olmu ama Firestore'a yazlmam - profil olutur\n            await setDoc(doc(firestore, \"users\", firebaseUser.uid), {\n              email: firebaseUser.email || email,\n              displayName: firebaseUser.displayName || \"\",\n              fullName: firebaseUser.displayName || \"\",\n              role: [\"viewer\"],\n              emailVerified: firebaseUser.emailVerified || false,\n              needsEmailVerification: !firebaseUser.emailVerified,\n              createdAt: serverTimestamp(),\n              updatedAt: serverTimestamp(),\n              pendingTeams: [],\n              approvedTeams: [],\n            });\n            // Profili tekrar al\n            await new Promise(resolve => setTimeout(resolve, 200));\n            try {\n              userProfile = await getUserProfile(firebaseUser.uid);\n            } catch (profileRetryError: unknown) {\n              // Eer hata mesaj \"silinmi\" ieriyorsa, silinmi hesap\n              const errorMsg = profileRetryError instanceof Error ? profileRetryError.message : String(profileRetryError);\n              if (errorMsg.includes(\"silinmi\")) {\n                try {\n                  await firebaseSignOut(auth);\n                } catch (signOutError) {\n                  if (import.meta.env.DEV) {\n                    console.error(\"k yaplrken hata:\", signOutError);\n                  }\n                }\n                return {\n                  success: false,\n                  message: \"Bu hesap silinmi. Giri yapamazsnz.\",\n                  user: null,\n                };\n              }\n              // Dier hatalar iin null olarak devam et\n              if (import.meta.env.DEV) {\n                console.warn(\"getUserProfile profil oluturma sonras hatas (devam ediliyor):\", profileRetryError);\n              }\n            }\n          }\n        } catch (profileCheckError) {\n          // Firestore kontrol baarsz olsa bile devam et\n          // Email dorulama kontrol yaplacak\n          if (import.meta.env.DEV) {\n            console.warn(\"Profil kontrol hatas (devam ediliyor):\", profileCheckError);\n          }\n        }\n      }\n\n      // Eer hala userProfile null ise, email dorulama kontrolne devam et\n      // (aadaki kod devam edecek, email dorulama kontrol yaplacak)\n\n      // Email dorulamas kontrol - email dorulanmamsa giri yaplamaz\n      // NCE Firestore'dan kontrol et (needsEmailVerification flag'i iin)\n      // Firestore'un eventual consistency zellii nedeniyle birka kez deneyebiliriz\n      let userDoc = await getDoc(doc(firestore, \"users\", firebaseUser.uid));\n      let needsEmailVerification = false;\n      let retryCount = 0;\n      const maxRetries = 2;\n\n      // Eer dokman yoksa veya needsEmailVerification undefined ise, birka kez daha dene\n      while (retryCount < maxRetries && (!userDoc.exists() || userDoc.data()?.needsEmailVerification === undefined)) {\n        if (import.meta.env.DEV) {\n          console.log(`Login - Firestore dokman kontrol ediliyor (retry ${retryCount + 1}/${maxRetries})`);\n        }\n        await new Promise(resolve => setTimeout(resolve, 200)); // 200ms bekle\n        userDoc = await getDoc(doc(firestore, \"users\", firebaseUser.uid));\n        retryCount++;\n      }\n\n      if (userDoc.exists()) {\n        const userData = userDoc.data();\n        // needsEmailVerification kontrol: true, \"true\", 1 gibi deerleri kabul et\n        needsEmailVerification = userData.needsEmailVerification === true ||\n          userData.needsEmailVerification === \"true\" ||\n          userData.needsEmailVerification === 1;\n\n        if (import.meta.env.DEV) {\n          console.log(\"Login - Email dorulama kontrol:\", {\n            needsEmailVerification,\n            rawNeedsEmailVerification: userData.needsEmailVerification,\n            firebaseEmailVerified: firebaseUser.emailVerified,\n            firestoreEmailVerified: userData.emailVerified,\n            userProfileEmailVerified: userProfile?.emailVerified,\n            retryCount,\n            userData: {\n              needsEmailVerification: userData.needsEmailVerification,\n              emailVerified: userData.emailVerified,\n            }\n          });\n        }\n      } else {\n        if (import.meta.env.DEV) {\n          console.warn(\"Login - Firestore dokman bulunamad, email dorulama kontrol yaplamyor\");\n        }\n      }\n\n      // Email dorulama durumu: Firebase Auth en gncel kaynak, bu yzden ncelikli\n      // SIKI KONTROL: Email dorulanmamsa MUTLAKA giri yaplamaz (needsEmailVerification flag'ine bakmadan)\n      // reload() sonras firebaseUser.emailVerified gncellenmi olmal\n      // Eer hala false ise, Firestore'daki deere de bak (senkronizasyon sorunu olabilir)\n      let emailVerified = firebaseUser.emailVerified;\n      // Eer Firebase Auth'da false ama Firestore'da true ise, Firestore'a gven\n      // (Firebase Auth daha gncel olmal ama senkronizasyon sorunu olabilir)\n      if (!emailVerified && userDoc.exists()) {\n        const userData = userDoc.data();\n        if (userData.emailVerified === true) {\n          if (import.meta.env.DEV) {\n            console.warn(\"Login - Firebase Auth'da emailVerified false ama Firestore'da true, Firestore'a gveniliyor\");\n          }\n          // Firestore'daki deere gven ama Firebase Auth' da gncelle\n          emailVerified = true;\n        }\n      }\n\n      // Email dorulama kontrol: Config'e gre email dorulamas zorunlu mu?\n      // Kayt ve login senkronize almal - her ikisi de ayn mant kullanmal\n      if (REQUIRE_EMAIL_VERIFICATION && !emailVerified) {\n        if (import.meta.env.DEV) {\n          console.log(\"Login - Email dorulama gerekli (REQUIRE_EMAIL_VERIFICATION=true), giri engelleniyor\", {\n            emailVerified,\n            needsEmailVerification,\n            firebaseEmailVerified: firebaseUser.emailVerified,\n          });\n        }\n\n        // Eer needsEmailVerification flag'i false veya undefined ise, Firestore'u gncelle\n        // (Kayt srasnda set edilmi olmal ama senkronizasyon iin tekrar set et)\n        if (!needsEmailVerification) {\n          try {\n            await updateDoc(doc(firestore, \"users\", firebaseUser.uid), {\n              needsEmailVerification: true,\n              emailVerified: false,\n              updatedAt: serverTimestamp(),\n            });\n            if (import.meta.env.DEV) {\n              console.log(\"Login - needsEmailVerification flag'i Firestore'da gncellendi (true)\");\n            }\n          } catch (updateError) {\n            if (import.meta.env.DEV) {\n              console.error(\"Login - needsEmailVerification flag gncellenirken hata:\", updateError);\n            }\n            // Hata olsa bile devam et, email gndermeye al\n          }\n        }\n\n        // Dorulama email'i tekrar gnder - RESEND_VERIFICATION_ON_LOGIN config'e gre\n        if (RESEND_VERIFICATION_ON_LOGIN) {\n          try {\n            await sendEmailVerification(firebaseUser);\n            if (import.meta.env.DEV) {\n              console.log(\"Email dorulama maili gnderildi (giri denemesi):\", email);\n            }\n          } catch (verifyError: unknown) {\n            const errorCode = (verifyError as { code?: string })?.code;\n            const errorMsg = verifyError instanceof Error ? verifyError.message : String(verifyError);\n\n            if (import.meta.env.DEV) {\n              console.error(\"Dorulama email'i gnderilirken hata:\", verifyError);\n            }\n\n            // Email gnderilemedi, kullancya bilgi ver\n            let errorMessage = \"Email dorulama maili gnderilemedi.\";\n            if (errorCode === 'auth/too-many-requests') {\n              errorMessage = \"ok fazla istek yapld. Ltfen bir sre sonra tekrar deneyin.\";\n            } else if (errorCode === 'auth/network-request-failed') {\n              errorMessage = \"A hatas. nternet balantnz kontrol edin.\";\n            } else if (errorMsg) {\n              errorMessage = errorMsg;\n            }\n\n            // k yap (kullanc email dorulamadan giri yapamaz)\n            try {\n              await firebaseSignOut(auth);\n            } catch (signOutError) {\n              if (import.meta.env.DEV) {\n                console.error(\"k yaplrken hata:\", signOutError);\n              }\n            }\n\n            return {\n              success: false,\n              message: errorMessage + \" Ltfen daha sonra tekrar deneyin veya spam kutunuzu kontrol edin.\",\n              user: null,\n            };\n          }\n        }\n\n        // k yap (kullanc email dorulamadan giri yapamaz)\n        try {\n          await firebaseSignOut(auth);\n        } catch (signOutError) {\n          if (import.meta.env.DEV) {\n            console.error(\"k yaplrken hata:\", signOutError);\n          }\n        }\n\n        return {\n          success: false,\n          message: \"E-posta adresinizi dorulamalsnz. Dorulama e-postas gnderildi. Ltfen e-postanz ve spam kutusunu kontrol edin.\",\n          user: null,\n        };\n      } else if (!emailVerified) {\n        // Email dorulama zorunlu deil ama email dorulanmam - uyar log'u\n        if (import.meta.env.DEV) {\n          console.log(\"Login - Email dorulanmam ama REQUIRE_EMAIL_VERIFICATION=false, giri izin verildi\");\n        }\n      } else {\n        // Email doruland - giri yaplabilir\n        if (import.meta.env.DEV) {\n          console.log(\"Login - Email dorulama kontrol geildi:\", {\n            needsEmailVerification,\n            emailVerified,\n            firebaseEmailVerified: firebaseUser.emailVerified,\n          });\n        }\n      }\n\n      // Email dorulama durumunu Firestore ile senkronize et\n      // Firebase Auth'daki emailVerified deeri Firestore'dan daha gncel olabilir\n      if (emailVerified) {\n        // Email dorulandysa needsEmailVerification flag'ini kaldr ve Firestore'u gncelle\n        try {\n          await updateDoc(doc(firestore, \"users\", firebaseUser.uid), {\n            needsEmailVerification: false,\n            emailVerified: true,\n            updatedAt: serverTimestamp(),\n          });\n          // userProfile'i gncelle (eer varsa)\n          if (userProfile) {\n            userProfile.emailVerified = true;\n          }\n        } catch (updateError) {\n          if (import.meta.env.DEV) {\n            console.error(\"EmailVerified flag gncellenirken hata:\", updateError);\n          }\n        }\n      }\n\n      // Eer userProfile hala null ise, tekrar al\n      if (!userProfile) {\n        try {\n          userProfile = await getUserProfile(firebaseUser.uid);\n        } catch (profileError: unknown) {\n          // Eer hata mesaj \"silinmi\" ieriyorsa, silinmi hesap\n          const errorMsg = profileError instanceof Error ? profileError.message : String(profileError);\n          if (errorMsg.includes(\"silinmi\")) {\n            try {\n              await firebaseSignOut(auth);\n            } catch (signOutError) {\n              if (import.meta.env.DEV) {\n                console.error(\"k yaplrken hata:\", signOutError);\n              }\n            }\n            return {\n              success: false,\n              message: \"Bu hesap silinmi. Giri yapamazsnz.\",\n              user: null,\n            };\n          }\n          // Dier hatalar iin null olarak devam et\n          if (import.meta.env.DEV) {\n            console.warn(\"getUserProfile hatas (devam ediliyor):\", profileError);\n          }\n        }\n        // Hala null ise, hata ver\n        if (!userProfile) {\n          try {\n            await firebaseSignOut(auth);\n          } catch (signOutError) {\n            if (import.meta.env.DEV) {\n              console.error(\"k yaplrken hata:\", signOutError);\n            }\n          }\n          return {\n            success: false,\n            message: \"Kullanc profili alnamad. Ltfen tekrar deneyin.\",\n            user: null,\n          };\n        }\n      }\n\n      // Son giri zamann gncelle - serverTimestamp() kullanarak sunucu zamann kaydet\n      try {\n        const oldLastLoginAt = userProfile.lastLoginAt;\n        // serverTimestamp() kullanarak Firebase sunucusunun zamann kaydet (daha doru)\n        await updateDoc(doc(firestore, \"users\", firebaseUser.uid), {\n          lastLoginAt: serverTimestamp(),\n        });\n\n        // Profili yeniden ykle (gncellenmi lastLoginAt ile)\n        // Not: serverTimestamp() async olduu iin hemen okumak doru zaman vermeyebilir\n        // Bu yzden bir miktar bekleyip tekrar ykleyelim veya client-side timestamp ile gncelleyelim\n        await new Promise(resolve => setTimeout(resolve, 100)); // 100ms bekle\n\n        const updatedProfile = await getUserProfile(firebaseUser.uid);\n        if (updatedProfile) {\n          userProfile = updatedProfile;\n        }\n\n        // Giri logunu kaydet (retry mekanizmas ile)\n        try {\n          const loginTime = new Date().toISOString();\n          const oldLastLoginAtValue = oldLastLoginAt ? (oldLastLoginAt instanceof Timestamp ? oldLastLoginAt.toDate().toISOString() : String(oldLastLoginAt)) : null;\n\n          let retryCount = 0;\n          const maxRetries = 2;\n          while (retryCount <= maxRetries) {\n            try {\n              await logAudit(\n                \"UPDATE\",\n                \"user_logins\",\n                firebaseUser.uid,\n                firebaseUser.uid,\n                oldLastLoginAtValue ? { lastLoginAt: oldLastLoginAtValue } : null,\n                null,\n                {\n                  action: \"LOGIN\",\n                  method: \"EMAIL\",\n                  email: email,\n                  timestamp: loginTime\n                }\n              );\n              break; // Baarl oldu, dngden k\n            } catch (retryError) {\n              retryCount++;\n              if (retryCount > maxRetries) {\n                if (import.meta.env.DEV) {\n                  console.error(\"Giri logu kaydedilirken hata (tm denemeler baarsz):\", retryError);\n                }\n              } else {\n                // Ksa bir bekleme sonras tekrar dene\n                await new Promise(resolve => setTimeout(resolve, 100 * retryCount));\n              }\n            }\n          }\n        } catch (logError) {\n          if (import.meta.env.DEV) {\n            console.error(\"Giri logu kaydedilirken beklenmeyen hata:\", logError);\n          }\n          // Log hatas girii engellememeli\n        }\n      } catch (updateError) {\n        if (import.meta.env.DEV) {\n          console.error(\"Son giri zaman gncellenirken hata:\", updateError);\n        }\n        // Hata olsa bile giri devam etsin\n      }\n\n      return {\n        success: true,\n        user: userProfile,\n      };\n    } catch (profileError: unknown) {\n      // Silinmi kullanc hatas\n      if (profileError instanceof Error && profileError.message?.includes(\"silinmi\")) {\n        try {\n          await firebaseSignOut(auth);\n        } catch (signOutError) {\n          if (import.meta.env.DEV) {\n            console.error(\"k yaplrken hata:\", signOutError);\n          }\n        }\n        return {\n          success: false,\n          message: \"Bu hesap silinmi. Giri yapamazsnz.\",\n          user: null,\n        };\n      }\n      // Dier hatalar iin tekrar frlat\n      throw profileError;\n    }\n  } catch (error: unknown) {\n    if (import.meta.env.DEV) {\n      console.error(\"Login error:\", error);\n    }\n\n    const errorMsg = error instanceof Error ? error.message : String(error);\n    // Eer zaten k yapldysa (silinmi kullanc), hata mesajn dndr\n    if (errorMsg.includes(\"silinmi\")) {\n      return {\n        success: false,\n        message: \"Bu hesap silinmi. Giri yapamazsnz.\",\n        user: null,\n      };\n    }\n\n    // Firebase hata kodlarn Trke'ye evir\n    let errorMessage = \"Giri baarsz\";\n    const errorObj = error && typeof error === 'object' ? error as { code?: string; message?: string } : null;\n\n    if (errorObj?.code === 'auth/user-not-found') {\n      errorMessage = \"Bu e-posta adresi kaytl deil. Ltfen kayt olun.\";\n    } else if (errorObj?.code === 'auth/wrong-password' || errorObj?.code === 'auth/invalid-credential') {\n      errorMessage = \"E-posta adresi veya ifre hatal. Ltfen bilgilerinizi kontrol edip tekrar deneyin.\";\n    } else if (errorObj?.code === 'auth/invalid-email') {\n      errorMessage = \"Geersiz e-posta adresi. Ltfen geerli bir e-posta adresi girin.\";\n    } else if (errorObj?.code === 'auth/user-disabled') {\n      errorMessage = \"Bu hesap devre d braklm. Ltfen yneticiye bavurun.\";\n    } else if (errorObj?.code === 'auth/too-many-requests') {\n      errorMessage = \"ok fazla baarsz giri denemesi. Ltfen birka dakika sonra tekrar deneyin.\";\n    } else if (errorObj?.code === 'auth/network-request-failed') {\n      errorMessage = \"nternet balantnz kontrol edin ve tekrar deneyin.\";\n    } else if (errorObj?.message) {\n      errorMessage = errorObj.message;\n    }\n\n    return {\n      success: false,\n      message: errorMessage,\n      user: null,\n    };\n  }\n};\n\n/**\n * Kullanc k\n */\nexport const logout = async (): Promise<{ success: boolean; message?: string }> => {\n  try {\n    if (!auth) {\n      return { success: false, message: 'Firebase Auth is not initialized' };\n    }\n\n    // k yapmadan nce kullanc ID'sini al\n    const userId = auth.currentUser?.uid;\n    const userEmail = auth.currentUser?.email;\n\n    // k logunu kaydet (k yapmadan nce, retry mekanizmas ile)\n    if (userId) {\n      try {\n        const logoutTime = new Date().toISOString();\n\n        let retryCount = 0;\n        const maxRetries = 2;\n        while (retryCount <= maxRetries) {\n          try {\n            await logAudit(\n              \"UPDATE\",\n              \"user_logins\",\n              userId,\n              userId,\n              null,\n              null,\n              {\n                action: \"LOGOUT\",\n                timestamp: logoutTime,\n                email: userEmail || null\n              }\n            );\n            break; // Baarl oldu, dngden k\n          } catch (retryError) {\n            retryCount++;\n            if (retryCount > maxRetries) {\n              if (import.meta.env.DEV) {\n                console.error(\"k logu kaydedilirken hata (tm denemeler baarsz):\", retryError);\n              }\n            } else {\n              // Ksa bir bekleme sonras tekrar dene\n              await new Promise(resolve => setTimeout(resolve, 100 * retryCount));\n            }\n          }\n        }\n      } catch (logError) {\n        if (import.meta.env.DEV) {\n          console.error(\"k logu kaydedilirken beklenmeyen hata:\", logError);\n        }\n        // Log hatas k engellememeli\n      }\n    }\n\n    await firebaseSignOut(auth);\n    return { success: true };\n  } catch (error: unknown) {\n    console.error(\"Logout error:\", error);\n    return {\n      success: false,\n      message: (error && typeof error === 'object' && 'message' in error ? (error as { message?: string }).message : undefined) || \"k baarsz\",\n    };\n  }\n};\n\n/**\n * ifre sfrlama\n */\nexport const resetPassword = async (email: string): Promise<{ success: boolean; message?: string }> => {\n  try {\n    if (!auth || !firestore) {\n      throw new Error('Firebase is not initialized');\n    }\n\n    // nce email'in kaytl olup olmadn Firestore'dan kontrol et\n    // Gvenlik nedeniyle Firebase Auth'da direkt kontrol yapamayz ama Firestore'dan kontrol edebiliriz\n    try {\n      const usersRef = collection(firestore, \"users\");\n      const q = query(usersRef, where(\"email\", \"==\", email), limit(1));\n      const querySnapshot = await getDocs(q);\n\n      if (querySnapshot.empty) {\n        // Email kaytl deil\n        return {\n          success: false,\n          message: \"Bu e-posta adresi kaytl deil. Ltfen kayt olun.\",\n        };\n      }\n\n      // Email kaytl, silinmi hesap kontrol\n      const userDoc = querySnapshot.docs[0];\n      const userData = userDoc.data();\n      if (userData.deleted === true) {\n        return {\n          success: false,\n          message: \"Bu hesap silinmi. Ltfen yeni bir hesap oluturun.\",\n        };\n      }\n    } catch (checkError) {\n      // Firestore kontrol baarsz olsa bile devam et\n      // Firebase Auth kendi kontroln yapacak\n      if (import.meta.env.DEV) {\n        console.warn(\"Email kontrol yaplrken hata:\", checkError);\n      }\n    }\n\n    // Firebase'in ifre sfrlama e-postasn gnder\n    await sendPasswordResetEmail(auth, email);\n    return {\n      success: true,\n      message: \"ifre sfrlama e-postas gnderildi. Ltfen e-postanz ve spam kutusunu kontrol edin.\"\n    };\n  } catch (error: unknown) {\n    if (import.meta.env.DEV) {\n      console.error(\"Reset password error:\", error);\n    }\n    // Firebase hata kodlarn Trke'ye evir\n    let errorMessage = \"ifre sfrlama baarsz\";\n    const errorObj = error && typeof error === 'object' && 'code' in error ? error as { code?: string; message?: string } : null;\n    if (errorObj?.code === 'auth/user-not-found') {\n      errorMessage = \"Bu e-posta adresi kaytl deil. Ltfen kayt olun.\";\n    } else if (errorObj?.code === 'auth/invalid-email') {\n      errorMessage = \"Geersiz e-posta adresi. Ltfen geerli bir e-posta adresi girin.\";\n    } else if (errorObj?.code === 'auth/too-many-requests') {\n      errorMessage = \"ok fazla istek yapld. Ltfen bir sre sonra tekrar deneyin.\";\n    } else if (errorObj?.message) {\n      errorMessage = errorObj.message;\n    }\n    return {\n      success: false,\n      message: errorMessage,\n    };\n  }\n};\n\n/**\n * Kullanc profilini Firestore'dan al\n */\nexport const getUserProfile = async (userId: string, allowDeleted: boolean = false): Promise<UserProfile | null> => {\n  try {\n    if (!firestore) {\n      console.error('Firestore is not initialized');\n      return null;\n    }\n    const userDoc = await getDoc(doc(firestore, \"users\", userId));\n\n    if (!userDoc.exists()) {\n      return null;\n    }\n\n    const data = userDoc.data();\n    const firebaseUser = auth?.currentUser || null;\n\n    // Silinmi kullanc kontrol\n    if (data.deleted === true) {\n      // Eer allowDeleted true ise, silinmi kullanc bilgilerini dndr (sadece okuma iin)\n      if (allowDeleted) {\n        return {\n          id: userId,\n          email: data.email || \"\",\n          displayName: \"Silinmi Kullanc\",\n          fullName: \"Silinmi Kullanc\",\n          phone: null,\n          dateOfBirth: null,\n          role: [],\n          departmentId: null,\n          emailVerified: false,\n          createdAt: data.createdAt,\n          updatedAt: data.updatedAt,\n        };\n      }\n      // Mevcut kullanc kendi profilini alyorsa ve silinmise, otomatik k yap\n      if (firebaseUser && firebaseUser.uid === userId && auth) {\n        // k yap, await ile bekle\n        try {\n          await firebaseSignOut(auth);\n        } catch (signOutError) {\n          if (import.meta.env.DEV) {\n            console.error(\"k yaplrken hata:\", signOutError);\n          }\n          // k hatas olsa bile devam et\n        }\n      }\n      throw new Error(\"Bu hesap silinmi. Giri yapamazsnz.\");\n    }\n\n    // Rolleri roles collection'ndaki tanmlarla senkronize et\n    const { getRoles } = await import(\"./rolePermissionsService\");\n    const definedRoles = await getRoles();\n    const definedRoleKeys = new Set(definedRoles.map(r => r.key));\n    const userRoles = (data.role || []) as string[];\n    const validRoles = userRoles.filter(role => definedRoleKeys.has(role));\n    const finalRoles = validRoles.length > 0 ? validRoles : [\"personnel\"];\n\n    // Eer roller deitiyse, veritabann gncelle\n    if (JSON.stringify(userRoles) !== JSON.stringify(finalRoles)) {\n      await updateDoc(userDoc.ref, { role: finalRoles });\n    }\n\n    return {\n      id: userId,\n      email: data.email || firebaseUser?.email || \"\",\n      displayName: data.displayName || firebaseUser?.displayName || \"\",\n      fullName: data.fullName,\n      phone: data.phone,\n      dateOfBirth: data.dateOfBirth,\n      role: finalRoles,\n      departmentId: data.departmentId,\n      emailVerified: firebaseUser?.emailVerified || data.emailVerified || false,\n      createdAt: data.createdAt,\n      updatedAt: data.updatedAt,\n      lastLoginAt: data.lastLoginAt,\n    };\n  } catch (error: unknown) {\n    // Permission hatalarn sessizce handle et (giri yapmadan normal)\n    const errorObj = error && typeof error === 'object' ? error as { code?: string; message?: string } : null;\n\n    if (errorObj?.code === 'permission-denied' || errorObj?.message?.includes('permissions')) {\n      // Permission hatas beklenen bir durum (giri yapmadan), sessizce handle et\n      if (import.meta.env.DEV) {\n        console.debug(\"Permission hatas (beklenen): Kullanc giri yapmam olabilir\");\n      }\n    } else if (import.meta.env.DEV) {\n      console.error(\"Get user profile error:\", error);\n    }\n\n    return null;\n  }\n};\n\n/**\n * Kullanc profilini gncelle\n */\nexport const updateUserProfile = async (\n  userId: string,\n  updates: Partial<Omit<UserProfile, \"id\" | \"email\" | \"emailVerified\" | \"createdAt\" | \"updatedAt\">>,\n  updatedBy?: string | null\n): Promise<{ success: boolean; message?: string }> => {\n  try {\n    if (!firestore) {\n      throw new Error('Firestore is not initialized');\n    }\n\n    // Eski veriyi al (audit log iin)\n    const oldProfile = await getUserProfile(userId);\n\n    // Firestore undefined deerleri kabul etmez, bu yzden undefined alanlar temizle\n    const cleanUpdates: Record<string, unknown> = {\n      updatedAt: serverTimestamp(),\n    };\n\n    Object.keys(updates).forEach((key) => {\n      const value = (updates as Record<string, unknown>)[key];\n      if (value !== undefined) {\n        cleanUpdates[key] = value;\n      }\n    });\n\n    await updateDoc(doc(firestore, \"users\", userId), cleanUpdates);\n\n    // Firebase Auth'ta displayName gncelle\n    if (updates.displayName && auth?.currentUser) {\n      await updateProfile(auth.currentUser, {\n        displayName: updates.displayName,\n      });\n    }\n\n    // Audit log (rol deiiklikleri hari - rol deiiklikleri UserManagement'da ayr loglanyor)\n    const logUserId = updatedBy || auth?.currentUser?.uid;\n    if (logUserId && oldProfile) {\n      // Rol deiiklii kontrol - eer sadece rol deitiyse log ekleme\n      const hasRoleChange = updates.role && JSON.stringify(updates.role) !== JSON.stringify(oldProfile.role);\n      const hasOtherChanges = Object.keys(updates).some(key => key !== \"role\");\n\n      // Eer rol deiiklii varsa ve baka deiiklik yoksa log ekleme (rol deiiklikleri UserManagement'da loglanyor)\n      if (!hasRoleChange || hasOtherChanges) {\n        const newProfile = await getUserProfile(userId);\n        await logAudit(\n          \"UPDATE\",\n          \"users\",\n          userId,\n          logUserId,\n          oldProfile,\n          newProfile,\n          { action: \"update_profile\", changedFields: Object.keys(updates).filter(k => k !== \"role\") }\n        );\n      }\n    }\n\n    return { success: true };\n  } catch (error: unknown) {\n    console.error(\"Update user profile error:\", error);\n    return {\n      success: false,\n      message: (error && typeof error === 'object' && 'message' in error ? (error as { message?: string }).message : undefined) || \"Profil gncellenemedi\",\n    };\n  }\n};\n\n/**\n * Kullanc profilini gncelle (alias for updateUserProfile)\n */\nexport const updateFirebaseUserProfile = updateUserProfile;\n\n/**\n * Auth state deiikliklerini dinle\n */\n// Son giri zamann gncellemek iin kullanlan flag (duplicate gncellemeleri nlemek iin)\nlet lastLoginUpdateTime: Map<string, number> = new Map();\n\nexport const onAuthChange = (callback: (user: UserProfile | null) => void) => {\n  if (!auth) {\n    if (import.meta.env.DEV) {\n      console.error('Firebase Auth is not initialized');\n      console.warn('Firebase yaplandrmas eksik olabilir. Ltfen .env dosyasn kontrol edin.');\n    }\n    // Hemen callback ar (loading state'i false yapmak iin)\n    // Firebase balatlamazsa kullanc auth sayfasna ynlendirilecek\n    setTimeout(() => callback(null), 0);\n    return () => { }; // Return empty unsubscribe function\n  }\n\n  // Firestore kontrol - opsiyonel ama nerilir\n  if (!firestore) {\n    if (import.meta.env.DEV) {\n      console.warn('Firestore is not initialized - baz zellikler almayabilir');\n    }\n    // Firestore olmadan da devam edebiliriz, sadece user profile alnamaz\n  }\n\n  // Timeout: Eer 3 saniye iinde auth state gelmezse callback(null) ar\n  let timeoutFired = false;\n  const timeout = setTimeout(() => {\n    if (!timeoutFired) {\n      console.warn('Auth state timeout - callback(null) arlyor');\n      timeoutFired = true;\n      callback(null);\n    }\n  }, 3000);\n\n  const unsubscribe = onAuthStateChanged(auth, (firebaseUser) => {\n    // Async callback'i promise olarak wrap et ve unhandled rejection'lar yakala\n    (async () => {\n      try {\n        // Timeout'u iptal et - auth state geldi\n        if (!timeoutFired) {\n          clearTimeout(timeout);\n          timeoutFired = true;\n        }\n\n        if (firebaseUser) {\n          // nce direkt Firestore'dan silinmi kullanc kontrol yap\n          if (firestore) {\n            try {\n              const userDoc = await getDoc(doc(firestore, \"users\", firebaseUser.uid));\n              if (userDoc.exists()) {\n                const userData = userDoc.data();\n                if (userData.deleted === true) {\n                  // Hemen k yap\n                  try {\n                    await firebaseSignOut(auth);\n                  } catch (signOutError) {\n                    if (import.meta.env.DEV) {\n                      if (import.meta.env.DEV) {\n                        console.error(\"k yaplrken hata:\", signOutError);\n                      }\n                    }\n                  }\n                  callback(null);\n                  return;\n                }\n              }\n            } catch (checkError) {\n              if (import.meta.env.DEV) {\n                console.error(\"Kullanc kontrol hatas:\", checkError);\n              }\n              // Kontrol hatas olsa bile devam et, getUserProfile kontrol edecek\n            }\n          }\n\n          try {\n            let userProfile = await getUserProfile(firebaseUser.uid);\n            // Eer userProfile null ise (silinmi kullanc), k yap\n            if (!userProfile) {\n              try {\n                await firebaseSignOut(auth);\n              } catch (signOutError) {\n                if (import.meta.env.DEV) {\n                  if (import.meta.env.DEV) {\n                    console.error(\"k yaplrken hata:\", signOutError);\n                  }\n                }\n              }\n              callback(null);\n              return;\n            }\n\n            // Email dorulandysa needsEmailVerification flag'ini kaldr ve emailVerified'i gncelle\n            if (firestore && firebaseUser.emailVerified) {\n              try {\n                const userDoc = await getDoc(doc(firestore, \"users\", firebaseUser.uid));\n                if (userDoc.exists()) {\n                  const userData = userDoc.data();\n                  const updateData: any = {};\n\n                  // Email dorulandysa flag'leri gncelle\n                  if (userData.needsEmailVerification === true) {\n                    updateData.needsEmailVerification = false;\n                  }\n                  if (!userData.emailVerified || userData.emailVerified === false) {\n                    updateData.emailVerified = true;\n                  }\n\n                  // Eer gncellenecek bir ey varsa gncelle\n                  if (Object.keys(updateData).length > 0) {\n                    updateData.updatedAt = serverTimestamp();\n                    await updateDoc(doc(firestore, \"users\", firebaseUser.uid), updateData);\n\n                    // Firestore gncellendikten sonra userProfile'i yeniden ykle\n                    // Bylece gncellenmi emailVerified deeri kullanlr\n                    userProfile = await getUserProfile(firebaseUser.uid);\n                    if (!userProfile) {\n                      callback(null);\n                      return;\n                    }\n                  }\n                }\n              } catch (updateError) {\n                if (import.meta.env.DEV) {\n                  console.error(\"Email dorulama flag gncellenirken hata:\", updateError);\n                }\n              }\n            }\n\n            // Son giri zamann gncelle (sadece gerektiinde, duplicate gncellemeleri nlemek iin)\n            // Not: login() ve signInWithGoogle() fonksiyonlarnda zaten gncelleniyor,\n            // burada sadece sayfa yenilendiinde veya baka bir cihazdan giri yapldnda gncellenmeli\n            const now = Date.now();\n            const lastUpdate = lastLoginUpdateTime.get(firebaseUser.uid) || 0;\n            const timeSinceLastUpdate = now - lastUpdate;\n\n            // Eer son gncellemeden 1 dakikadan fazla zaman getiyse veya hi gncellenmemise\n            // (1 dakika yeterli, nk login() ve signInWithGoogle() zaten gncelliyor)\n            if (timeSinceLastUpdate > 1 * 60 * 1000 || lastUpdate === 0) {\n              try {\n                // Mevcut lastLoginAt deerini kontrol et\n                const currentLastLogin = userProfile.lastLoginAt;\n                let shouldUpdate = false;\n\n                // Eer lastLoginAt yoksa veya geersizse mutlaka gncelle\n                if (!currentLastLogin) {\n                  shouldUpdate = true;\n                } else {\n                  // Eer lastLoginAt ok eskiyse (30 dakikadan fazla) gncelle\n                  try {\n                    let loginDate: Date;\n                    if (currentLastLogin instanceof Timestamp) {\n                      loginDate = currentLastLogin.toDate();\n                    } else if (currentLastLogin && typeof currentLastLogin === 'object' && 'toDate' in currentLastLogin && typeof (currentLastLogin as { toDate: () => Date }).toDate === 'function') {\n                      loginDate = (currentLastLogin as { toDate: () => Date }).toDate();\n                    } else if (currentLastLogin && typeof currentLastLogin === 'object' && '_seconds' in currentLastLogin) {\n                      const seconds = Number((currentLastLogin as { _seconds?: number })._seconds || 0);\n                      const nanoseconds = Number((currentLastLogin as { _nanoseconds?: number })._nanoseconds || 0);\n                      loginDate = new Timestamp(seconds, nanoseconds).toDate();\n                    } else {\n                      shouldUpdate = true; // Geersiz format, gncelle\n                    }\n\n                    if (!shouldUpdate && loginDate) {\n                      const diffInMinutes = Math.floor((now - loginDate.getTime()) / (1000 * 60));\n                      // Eer son giri 30 dakikadan fazla nceyse gncelle\n                      if (diffInMinutes > 30) {\n                        shouldUpdate = true;\n                      }\n                    }\n                  } catch (parseError) {\n                    // Parse hatas varsa gncelle\n                    shouldUpdate = true;\n                  }\n                }\n\n                if (shouldUpdate) {\n                  // serverTimestamp() kullanarak sunucu zamann kaydet\n                  await updateDoc(doc(firestore, \"users\", firebaseUser.uid), {\n                    lastLoginAt: serverTimestamp(),\n                  });\n                  lastLoginUpdateTime.set(firebaseUser.uid, now);\n\n                  // Profili yeniden ykle (gncellenmi lastLoginAt ile)\n                  await new Promise(resolve => setTimeout(resolve, 200)); // 200ms bekle (serverTimestamp ilemesi iin)\n                  const updatedProfile = await getUserProfile(firebaseUser.uid);\n                  if (updatedProfile) {\n                    userProfile = updatedProfile;\n                  }\n                }\n              } catch (updateError) {\n                if (import.meta.env.DEV) {\n                  console.error(\"Son giri zaman gncellenirken hata (onAuthChange):\", updateError);\n                }\n                // Hata olsa bile devam et\n              }\n            }\n\n            callback(userProfile);\n          } catch (error: unknown) {\n            // Silinmi kullanc ise k yap\n            const errorObj = error && typeof error === 'object' ? error as { message?: string } : null;\n            if (errorObj?.message?.includes(\"silinmi\")) {\n              try {\n                await firebaseSignOut(auth);\n              } catch (signOutError) {\n                if (import.meta.env.DEV) {\n                  if (import.meta.env.DEV) {\n                    console.error(\"k yaplrken hata:\", signOutError);\n                  }\n                }\n              }\n              callback(null);\n            } else {\n              // Dier hatalar iin de callback(null) ar\n              if (import.meta.env.DEV) {\n                console.error(\"onAuthChange callback hatas:\", error);\n              }\n              callback(null);\n            }\n          }\n        } else {\n          callback(null);\n        }\n      } catch (error: unknown) {\n        // En d seviye hata yakalama - unhandled promise rejection'lar nle\n        if (import.meta.env.DEV) {\n          console.error(\"onAuthChange async callback hatas:\", error);\n        }\n        // Hata durumunda callback(null) ar\n        try {\n          callback(null);\n        } catch (callbackError) {\n          // Callback ars bile baarsz olursa sessizce handle et\n          if (import.meta.env.DEV) {\n            console.error(\"onAuthChange callback ars hatas:\", callbackError);\n          }\n        }\n      }\n    })().catch((error) => {\n      // Promise rejection'lar yakala\n      if (import.meta.env.DEV) {\n        console.error(\"onAuthChange promise rejection:\", error);\n      }\n      try {\n        callback(null);\n      } catch (callbackError) {\n        if (import.meta.env.DEV) {\n          console.error(\"onAuthChange callback ars hatas (promise rejection):\", callbackError);\n        }\n      }\n    });\n  });\n\n  // Return unsubscribe function that also clears timeout\n  return () => {\n    if (!timeoutFired) {\n      clearTimeout(timeout);\n    }\n    unsubscribe();\n  };\n};\n\n/**\n * Mevcut kullancy al\n */\nexport const getCurrentUser = (): FirebaseUser | null => {\n  return auth?.currentUser || null;\n};\n\n/**\n * Tm kullanclar listele\n */\nexport const getAllUsers = async (): Promise<UserProfile[]> => {\n  try {\n    if (!firestore) {\n      throw new Error('Firestore is not initialized');\n    }\n\n    // Sadece authenticated kullanclar iin al\n    const { getAuth } = await import(\"firebase/auth\");\n    const { auth } = await import(\"@/lib/firebase\");\n    const currentAuth = auth || getAuth();\n\n    if (!currentAuth?.currentUser) {\n      // Giri yapmam kullanclar iin bo array dndr\n      return [];\n    }\n\n    // nce roles collection'ndan tanml rolleri al\n    const { getRoles } = await import(\"./rolePermissionsService\");\n    const definedRoles = await getRoles();\n    const definedRoleKeys = new Set(definedRoles.map(r => r.key));\n\n    // nce orderBy ile deneyelim (index varsa hzl olur)\n    // Performans iin limit ekle (500 kayt)\n    try {\n      const q = query(collection(firestore, \"users\"), orderBy(\"displayName\", \"asc\"), limit(500));\n      const snapshot = await getDocs(q);\n\n      const users = snapshot.docs\n        .map((doc) => {\n          const data = doc.data();\n          // Silinmi kullanclar filtrele\n          if (data.deleted === true) {\n            return null;\n          }\n\n          // Kullancnn rolleri sadece tanml rollerden olsun\n          const userRoles = (data.role || []) as string[];\n          const validRoles = userRoles.filter(role => definedRoleKeys.has(role));\n          const finalRoles = validRoles.length > 0 ? validRoles : [\"personnel\"];\n\n          // Eer roller deitiyse, veritabann gncelle (async, await etmeden)\n          if (JSON.stringify(userRoles) !== JSON.stringify(finalRoles)) {\n            updateDoc(doc.ref, { role: finalRoles }).catch(err => {\n              console.error(`Error syncing roles for user ${doc.id}:`, err);\n            });\n          }\n\n          return {\n            id: doc.id,\n            email: data.email || \"\",\n            displayName: data.displayName || data.fullName || \"\",\n            fullName: data.fullName || data.displayName || \"\",\n            phone: data.phone || \"\",\n            dateOfBirth: data.dateOfBirth || \"\",\n            role: finalRoles,\n            departmentId: data.departmentId || \"\",\n            pendingTeams: data.pendingTeams || [],\n            approvedTeams: data.approvedTeams || [],\n            teamLeaderIds: data.teamLeaderIds || [],\n            emailVerified: data.emailVerified || false,\n            createdAt: data.createdAt || null,\n            updatedAt: data.updatedAt || null,\n            lastLoginAt: data.lastLoginAt || null,\n          } as UserProfile;\n        })\n        .filter((user): user is UserProfile => user !== null && !!user.id && !!(user.displayName || user.fullName || user.email)); // Geerli kullanclar filtrele (email varsa da kabul et)\n\n      return users;\n    } catch (orderByError: unknown) {\n      // Index hatas varsa orderBy olmadan al (sessizce handle et)\n      if (import.meta.env.DEV) {\n        const errorObj = orderByError && typeof orderByError === 'object' ? orderByError as { code?: string; message?: string } : null;\n        if (errorObj?.code !== 'permission-denied') {\n          console.warn(\"OrderBy failed, fetching without order:\", errorObj?.message || orderByError);\n        }\n      }\n      // nce roles collection'ndan tanml rolleri al\n      const { getRoles } = await import(\"./rolePermissionsService\");\n      const definedRoles = await getRoles();\n      const definedRoleKeys = new Set(definedRoles.map(r => r.key));\n\n      // Performans iin limit ekle (500 kayt)\n      const q = query(collection(firestore, \"users\"), limit(500));\n      const snapshot = await getDocs(q);\n      const users = snapshot.docs\n        .map((doc) => {\n          const data = doc.data();\n          // Silinmi kullanclar filtrele\n          if (data.deleted === true) {\n            return null;\n          }\n\n          // Kullancnn rolleri sadece tanml rollerden olsun\n          const userRoles = (data.role || []) as string[];\n          const validRoles = userRoles.filter(role => definedRoleKeys.has(role));\n\n          // Eer hi geerli rol yoksa, varsaylan rol ekle\n          const finalRoles = validRoles.length > 0 ? validRoles : [\"personnel\"];\n\n          // Eer roller deitiyse, veritabann gncelle\n          if (JSON.stringify(userRoles) !== JSON.stringify(finalRoles)) {\n            // Async olarak gncelle (await etmeden)\n            updateDoc(doc.ref, { role: finalRoles }).catch(err => {\n              console.error(`Error syncing roles for user ${doc.id}:`, err);\n            });\n          }\n\n          return {\n            id: doc.id,\n            email: data.email || \"\",\n            displayName: data.displayName || data.fullName || \"\",\n            fullName: data.fullName || data.displayName || \"\",\n            phone: data.phone || \"\",\n            dateOfBirth: data.dateOfBirth || \"\",\n            role: finalRoles,\n            departmentId: data.departmentId || \"\",\n            pendingTeams: data.pendingTeams || [],\n            approvedTeams: data.approvedTeams || [],\n            teamLeaderIds: data.teamLeaderIds || [],\n            emailVerified: data.emailVerified || false,\n            createdAt: data.createdAt || null,\n            updatedAt: data.updatedAt || null,\n            lastLoginAt: data.lastLoginAt || null,\n          } as UserProfile;\n        })\n        .filter((user): user is UserProfile => user !== null && !!user.id && !!(user.displayName || user.fullName || user.email)); // Geerli kullanclar filtrele (email varsa da kabul et)\n\n      // Client-side sorting\n      return users.sort((a, b) => {\n        const nameA = (a.displayName || a.fullName || \"\").toLowerCase();\n        const nameB = (b.displayName || b.fullName || \"\").toLowerCase();\n        return nameA.localeCompare(nameB, \"tr\");\n      });\n    }\n  } catch (error: unknown) {\n    // Permission hatalarn sessizce handle et (giri yapmadan normal)\n    const errorObj = error && typeof error === 'object' ? error as { code?: string; message?: string } : null;\n\n    if (errorObj?.code === 'permission-denied' || errorObj?.message?.includes('permissions')) {\n      // Permission hatas beklenen bir durum (giri yapmadan), sessizce handle et\n      if (import.meta.env.DEV) {\n        console.debug(\"Permission hatas (beklenen): Kullanc giri yapmam olabilir\");\n      }\n    } else if (errorObj?.code === 'unavailable' || errorObj?.message?.includes('network')) {\n      if (import.meta.env.DEV) {\n        console.warn(\" Firestore balant hatas! nternet balantnz kontrol edin.\");\n      }\n    } else {\n      if (import.meta.env.DEV) {\n        console.error(\" Kullanc listesi alnamad:\", errorObj?.message || error);\n      }\n    }\n\n    // Hata durumunda bo array dndr, uygulama kmesin\n    return [];\n  }\n};\n\n/**\n * Google ile giri yap\n */\nexport const signInWithGoogle = async (): Promise<{ success: boolean; message?: string; user?: UserProfile | null }> => {\n  try {\n    if (!auth) {\n      throw new Error('Firebase Auth is not initialized');\n    }\n    const provider = new GoogleAuthProvider();\n    provider.addScope(\"https://www.googleapis.com/auth/drive.file\"); // Drive scope added\n    const result = await signInWithPopup(auth, provider);\n    const firebaseUser = result.user;\n\n    // nce direkt Firestore'dan silinmi kullanc kontrol yap\n    try {\n      const userDoc = await getDoc(doc(firestore, \"users\", firebaseUser.uid));\n      if (userDoc.exists()) {\n        const userData = userDoc.data();\n        if (userData.deleted === true) {\n          // Hemen k yap\n          try {\n            await firebaseSignOut(auth);\n          } catch (signOutError) {\n            if (import.meta.env.DEV) {\n              if (import.meta.env.DEV) {\n                console.error(\"k yaplrken hata:\", signOutError);\n              }\n            }\n          }\n          return {\n            success: false,\n            message: \"Bu hesap silinmi. Giri yapamazsnz.\",\n            user: null,\n          };\n        }\n      }\n    } catch (checkError) {\n      console.error(\"Kullanc kontrol hatas:\", checkError);\n      // Kontrol hatas olsa bile devam et, getUserProfile kontrol edecek\n    }\n\n    // Check if user profile exists, create if not\n    try {\n      let userProfile = await getUserProfile(firebaseUser.uid);\n\n      // Eer kullanc silinmise\n      if (!userProfile) {\n        try {\n          await firebaseSignOut(auth);\n        } catch (signOutError) {\n          if (import.meta.env.DEV) {\n            console.error(\"k yaplrken hata:\", signOutError);\n          }\n        }\n        return {\n          success: false,\n          message: \"Bu hesap silinmi. Giri yapamazsnz.\",\n          user: null,\n        };\n      }\n\n      // Kullanc profilini gncelle - serverTimestamp() kullanarak sunucu zamann kaydet\n      const oldLastLoginAt = userProfile.lastLoginAt;\n      // serverTimestamp() kullanarak Firebase sunucusunun zamann kaydet (daha doru)\n      await updateDoc(doc(firestore, \"users\", firebaseUser.uid), {\n        displayName: firebaseUser.displayName,\n        fullName: firebaseUser.displayName,\n        emailVerified: firebaseUser.emailVerified,\n        updatedAt: serverTimestamp(),\n        lastLoginAt: serverTimestamp(),\n      });\n\n      // Profili yeniden ykle (gncellenmi lastLoginAt ile)\n      // Not: serverTimestamp() async olduu iin hemen okumak doru zaman vermeyebilir\n      // Bu yzden bir miktar bekleyip tekrar ykleyelim\n      await new Promise(resolve => setTimeout(resolve, 100)); // 100ms bekle\n\n      const updatedProfile = await getUserProfile(firebaseUser.uid);\n      if (updatedProfile) {\n        userProfile = updatedProfile;\n      }\n\n      // Giri logunu kaydet (retry mekanizmas ile)\n      try {\n        const loginTime = new Date().toISOString();\n        const oldLastLoginAtValue = oldLastLoginAt ? (oldLastLoginAt instanceof Timestamp ? oldLastLoginAt.toDate().toISOString() : String(oldLastLoginAt)) : null;\n\n        let retryCount = 0;\n        const maxRetries = 2;\n        while (retryCount <= maxRetries) {\n          try {\n            await logAudit(\n              \"UPDATE\",\n              \"user_logins\",\n              firebaseUser.uid,\n              firebaseUser.uid,\n              oldLastLoginAtValue ? { lastLoginAt: oldLastLoginAtValue } : null,\n              null,\n              {\n                action: \"LOGIN\",\n                method: \"GOOGLE\",\n                email: firebaseUser.email || null,\n                timestamp: loginTime\n              }\n            );\n            break; // Baarl oldu, dngden k\n          } catch (retryError) {\n            retryCount++;\n            if (retryCount > maxRetries) {\n              if (import.meta.env.DEV) {\n                console.error(\"Giri logu kaydedilirken hata (tm denemeler baarsz):\", retryError);\n              }\n            } else {\n              // Ksa bir bekleme sonras tekrar dene\n              await new Promise(resolve => setTimeout(resolve, 100 * retryCount));\n            }\n          }\n        }\n      } catch (logError) {\n        if (import.meta.env.DEV) {\n          console.error(\"Giri logu kaydedilirken beklenmeyen hata:\", logError);\n        }\n        // Log hatas girii engellememeli\n      }\n\n      return {\n        success: true,\n        user: userProfile,\n      };\n    } catch (profileError: unknown) {\n      // Silinmi kullanc hatas\n      if (profileError instanceof Error && profileError.message?.includes(\"silinmi\")) {\n        try {\n          await firebaseSignOut(auth);\n        } catch (signOutError) {\n          if (import.meta.env.DEV) {\n            console.error(\"k yaplrken hata:\", signOutError);\n          }\n        }\n        return {\n          success: false,\n          message: \"Bu hesap silinmi. Giri yapamazsnz.\",\n          user: null,\n        };\n      }\n      // Eer profil yoksa yeni profil olutur\n      const newUserProfile = {\n        id: firebaseUser.uid,\n        email: firebaseUser.email || \"\",\n        displayName: firebaseUser.displayName || \"\",\n        fullName: firebaseUser.displayName || \"\",\n        role: [\"viewer\"], // Default role\n        emailVerified: firebaseUser.emailVerified,\n        createdAt: serverTimestamp(),\n        updatedAt: serverTimestamp(),\n        pendingTeams: [],\n        approvedTeams: [],\n      };\n      await setDoc(doc(firestore, \"users\", firebaseUser.uid), newUserProfile);\n\n      return {\n        success: true,\n        user: newUserProfile as UserProfile,\n      };\n    }\n  } catch (error: unknown) {\n    console.error(\"Google Sign-In error:\", error);\n    let errorMessage = \"Google ile giri baarsz\";\n    const errorObj = error && typeof error === 'object' ? error as { code?: string; message?: string } : null;\n    if (errorObj?.code === 'auth/popup-closed-by-user') {\n      errorMessage = \"Google giri penceresi kapatld.\";\n    } else if (errorObj?.message) {\n      errorMessage = errorObj.message;\n    }\n    return {\n      success: false,\n      message: errorMessage,\n      user: null,\n    };\n  }\n};\n\n/**\n * Email dorulama e-postas gnder\n */\nexport const sendVerificationEmail = async (): Promise<{ success: boolean; message?: string }> => {\n  try {\n    if (!auth) {\n      return { success: false, message: 'Firebase Auth is not initialized' };\n    }\n    const user = auth.currentUser;\n    if (!user) {\n      return { success: false, message: \"Kullanc oturum amam\" };\n    }\n\n    // Email zaten dorulanmsa gnderme\n    if (user.emailVerified) {\n      return { success: false, message: \"Email zaten dorulanm\" };\n    }\n\n    await sendEmailVerification(user);\n    if (import.meta.env.DEV) {\n      console.log(\"Email dorulama maili gnderildi (manuel):\", user.email);\n    }\n    return { success: true, message: \"Dorulama e-postas gnderildi. Ltfen e-postanz ve spam kutusunu kontrol edin.\" };\n  } catch (error: unknown) {\n    const errorCode = (error as { code?: string })?.code;\n    const errorMsg = error instanceof Error ? error.message : String(error);\n\n    if (import.meta.env.DEV) {\n      console.error(\"Send verification email error:\", error);\n    }\n\n    // Firebase hata kodlarn Trke'ye evir\n    let errorMessage = \"Email dorulama maili gnderilemedi\";\n    if (errorCode === 'auth/too-many-requests') {\n      errorMessage = \"ok fazla istek yapld. Ltfen bir sre sonra tekrar deneyin.\";\n    } else if (errorCode === 'auth/network-request-failed') {\n      errorMessage = \"A hatas. nternet balantnz kontrol edin.\";\n    } else if (errorMsg) {\n      errorMessage = errorMsg;\n    }\n    return {\n      success: false,\n      message: (error && typeof error === 'object' && 'message' in error ? (error as { message?: string }).message : undefined) || \"Dorulama e-postas gnderilemedi\",\n    };\n  }\n};\n\n/**\n * Kullancy tamamen sil (sadece super_admin)\n * - Firebase Auth'dan siler (Cloud Function gerekir)\n * - Firestore users collection'nda soft delete yapar\n * - Tm loglar siler\n * - Grevlerden kullancy karr\n * - Bildirimlerini siler\n * - Ekip ilikilerini temizler\n * - Eer greve kimse kalmamsa havuza alr\n */\nexport const deleteUser = async (userId: string, deletedBy: string): Promise<void> => {\n  try {\n    if (!auth || !firestore) {\n      throw new Error(\"Firebase is not initialized\");\n    }\n\n    // Kullanc profilini al (silinmi bile olsa bilgileri grmek iin allowDeleted: true)\n    const userProfile = await getUserProfile(userId, true);\n    if (!userProfile) {\n      throw new Error(\"Kullanc bulunamad\");\n    }\n\n    // Zaten silinmise hata ver\n    const userDoc = await getDoc(doc(firestore, \"users\", userId));\n    if (userDoc.exists() && userDoc.data()?.deleted === true) {\n      throw new Error(\"Bu kullanc zaten silinmi.\");\n    }\n\n    // Silen kiinin yetkisini kontrol et (super_admin olmal)\n    const deleterProfile = await getUserProfile(deletedBy);\n    if (!deleterProfile || (!deleterProfile.role?.includes(\"super_admin\") && !deleterProfile.role?.includes(\"main_admin\"))) {\n      throw new Error(\"Kullanc silme yetkiniz yok. Sadece ana yneticiler kullanc silebilir.\");\n    }\n\n    // Kendini silmeye alyorsa engelle\n    if (userId === deletedBy) {\n      throw new Error(\"Kendi hesabnz silemezsiniz.\");\n    }\n\n    // Orijinal verileri sakla (audit log iin)\n    const originalData = {\n      email: userProfile.email,\n      displayName: userProfile.displayName,\n      fullName: userProfile.fullName,\n      phone: userProfile.phone,\n      role: userProfile.role,\n      departmentId: userProfile.departmentId,\n    };\n\n    // 1. Tm grevlerden kullancy kar ve gerekirse havuza al\n    try {\n      const { removeUserFromAllTasks } = await import(\"./taskService\");\n      await removeUserFromAllTasks(userId);\n    } catch (taskError) {\n      if (import.meta.env.DEV) {\n        console.warn(\"Grevlerden kullanc karlrken hata:\", taskError);\n      }\n      // Devam et, kritik deil\n    }\n\n    // 2. Tm loglar sil (opsiyonel - GDPR iin log tutmak gerekebilir)\n    try {\n      const { deleteUserLogs } = await import(\"./auditLogsService\");\n      await deleteUserLogs(userId);\n    } catch (logError) {\n      if (import.meta.env.DEV) {\n        console.warn(\"Loglar silinirken hata:\", logError);\n      }\n      // Devam et, kritik deil\n    }\n\n    // 3. Kullancnn tm bildirimlerini sil\n    try {\n      const { deleteUserNotifications } = await import(\"./notificationService\");\n      if (typeof deleteUserNotifications === 'function') {\n        await deleteUserNotifications(userId);\n      }\n    } catch (notifError) {\n      if (import.meta.env.DEV) {\n        console.warn(\"Bildirimler silinirken hata:\", notifError);\n      }\n      // Devam et, kritik deil\n    }\n\n    // 4. Ekip ilikilerini temizle (departmentlarda manager ise)\n    try {\n      const { getDepartments, updateDepartment } = await import(\"./departmentService\");\n      const departments = await getDepartments();\n\n      for (const dept of departments) {\n        if (dept.managerId === userId) {\n          // Bu departmanda manager ise, manager' null yap\n          await updateDepartment(dept.id, { managerId: null });\n          if (import.meta.env.DEV) {\n            console.log(`Departman ${dept.id} manager' temizlendi`);\n          }\n        }\n      }\n    } catch (deptError) {\n      if (import.meta.env.DEV) {\n        console.warn(\"Ekip ilikileri temizlenirken hata:\", deptError);\n      }\n      // Devam et, kritik deil\n    }\n\n    // 5. Firestore'da soft delete yap\n    // Kullancy silmek yerine \"deleted\" flag'i ekleyelim\n    // Bylece kullanc giri yapamaz ama veriler korunur (GDPR uyumluluu iin)\n    const userRef = doc(firestore, \"users\", userId);\n\n    await updateDoc(userRef, {\n      deleted: true,\n      deletedAt: serverTimestamp(),\n      deletedBy: deletedBy,\n      // Orijinal email'i koruyoruz (yeniden kayt kontrol iin gerekli)\n      // email: userProfile.email, // DETRME\n      displayName: \"Silinmi Kullanc\",\n      fullName: \"Silinmi Kullanc\",\n      phone: null,\n      dateOfBirth: null,\n      role: [],\n      departmentId: null,\n      pendingTeams: [],\n      approvedTeams: [],\n      teamLeaderIds: [],\n      // Orijinal verileri metadata olarak sakla (gerekirse geri yklemek iin)\n      _originalData: originalData,\n    });\n\n    // 6. Audit log olutur\n    try {\n      const { logSecurityEvent } = await import(\"@/utils/auditLogger\");\n      await logSecurityEvent(\n        \"ACCOUNT_DELETE\",\n        deletedBy,\n        {\n          targetUserId: userId,\n          deletedAt: new Date().toISOString(),\n          reason: \"Kullanc ynetici tarafndan silindi\",\n          originalEmail: userProfile?.email // Logda email'i tutmak faydal olabilir\n        }\n      );\n    } catch (auditError) {\n      if (import.meta.env.DEV) {\n        console.error(\"Audit log oluturulurken hata:\", auditError);\n      }\n      // Devam et, silme ilemi tamamland\n    }\n\n    if (import.meta.env.DEV) {\n      console.log(`Kullanc ${userId} baaryla silindi (soft delete)`);\n    }\n\n  } catch (error: unknown) {\n    console.error(\"Delete user error:\", error);\n    throw error;\n  }\n};\n\n/**\n * Silinmi kullancy geri ykle (sadece super_admin)\n * Soft delete ile silinmi kullanclar geri ykler\n */\nexport const restoreUser = async (userId: string, restoredBy: string): Promise<void> => {\n  try {\n    if (!auth || !firestore) {\n      throw new Error(\"Firebase is not initialized\");\n    }\n\n    // Geri ykleyen kiinin yetkisini kontrol et\n    const restorerProfile = await getUserProfile(restoredBy);\n    if (!restorerProfile || (!restorerProfile.role?.includes(\"super_admin\") && !restorerProfile.role?.includes(\"main_admin\"))) {\n      throw new Error(\"Kullanc geri ykleme yetkiniz yok. Sadece ana yneticiler kullanc geri ykleyebilir.\");\n    }\n\n    // Kullanc dokmann al\n    const userRef = doc(firestore, \"users\", userId);\n    const userDoc = await getDoc(userRef);\n\n    if (!userDoc.exists()) {\n      throw new Error(\"Kullanc bulunamad\");\n    }\n\n    const userData = userDoc.data();\n\n    if (userData.deleted !== true) {\n      throw new Error(\"Bu kullanc silinmemi, geri ykleme gerekmiyor.\");\n    }\n\n    // Orijinal verileri al\n    const originalData = userData._originalData || {};\n\n    // Geri ykle\n    await updateDoc(userRef, {\n      deleted: false,\n      deletedAt: null,\n      deletedBy: null,\n      displayName: originalData.displayName || userData.email?.split(\"@\")[0] || \"Kullanc\",\n      fullName: originalData.fullName || originalData.displayName || userData.email?.split(\"@\")[0] || \"Kullanc\",\n      phone: originalData.phone || null,\n      role: originalData.role || [\"viewer\"],\n      departmentId: originalData.departmentId || null,\n      pendingTeams: [],\n      approvedTeams: [],\n      teamLeaderIds: [],\n      restoredAt: serverTimestamp(),\n      restoredBy: restoredBy,\n      _originalData: null, // Temizle\n      updatedAt: serverTimestamp(),\n    });\n\n    // Audit log\n    try {\n      const { logSecurityEvent } = await import(\"@/utils/auditLogger\");\n      await logSecurityEvent(\n        \"ACCOUNT_RESTORE\",\n        restoredBy,\n        {\n          targetUserId: userId,\n          restoredAt: new Date().toISOString(),\n        }\n      );\n    } catch (auditError) {\n      if (import.meta.env.DEV) {\n        console.error(\"Audit log oluturulurken hata:\", auditError);\n      }\n    }\n\n    if (import.meta.env.DEV) {\n      console.log(`Kullanc ${userId} baaryla geri yklendi`);\n    }\n\n  } catch (error: unknown) {\n    console.error(\"Restore user error:\", error);\n    throw error;\n  }\n};\n\n/**\n * Silinmi kullanclar listele (sadece super_admin iin)\n */\nexport const getDeletedUsers = async (): Promise<UserProfile[]> => {\n  try {\n    if (!firestore) {\n      throw new Error(\"Firestore is not initialized\");\n    }\n\n    const usersRef = collection(firestore, \"users\");\n    const q = query(usersRef, where(\"deleted\", \"==\", true), limit(100));\n    const snapshot = await getDocs(q);\n\n    return snapshot.docs.map((doc) => {\n      const data = doc.data();\n      return {\n        id: doc.id,\n        email: data.email || \"\",\n        displayName: data._originalData?.displayName || \"Silinmi Kullanc\",\n        fullName: data._originalData?.fullName || \"Silinmi Kullanc\",\n        phone: data._originalData?.phone || null,\n        role: [],\n        emailVerified: false,\n        createdAt: data.createdAt || null,\n        updatedAt: data.updatedAt || null,\n        deletedAt: data.deletedAt || null,\n        deletedBy: data.deletedBy || null,\n      } as UserProfile & { deletedAt?: any; deletedBy?: string };\n    });\n\n  } catch (error: unknown) {\n    console.error(\"Get deleted users error:\", error);\n    return [];\n  }\n};\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\services\\firebase\\customerNoteService.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\services\\firebase\\customerService.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":309,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":309,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8327,8330],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8327,8330],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":406,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":406,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10970,10973],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10970,10973],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Firebase Customer Service\n * Mteri ynetimi ilemleri\n */\n\nimport {\n  collection,\n  doc,\n  getDoc,\n  getDocs,\n  addDoc,\n  updateDoc,\n  deleteDoc,\n  query,\n  where,\n  orderBy,\n  limit,\n  serverTimestamp,\n  Timestamp,\n} from \"firebase/firestore\";\nimport { firestore } from \"@/lib/firebase\";\nimport { logAudit } from \"@/utils/auditLogger\";\n\nexport interface Customer {\n  id: string;\n  name: string;\n  company?: string | null;\n  email?: string | null;\n  phone?: string | null;\n  address?: string | null;\n  taxId?: string | null;\n  notes?: string | null;\n  createdAt: Timestamp;\n  updatedAt: Timestamp;\n  createdBy: string;\n}\n\n/**\n * Tm mterileri listele\n */\nexport const getCustomers = async (): Promise<Customer[]> => {\n  try {\n    if (!firestore) {\n      throw new Error(\"Firebase Firestore balatlamad. Ltfen .env dosyasnda Firebase yaplandrmasn kontrol edin.\");\n    }\n    \n    // orderBy kullanmadan nce index gerektirebilir, bu yzden nce basit sorgu deneyelim\n    // Performans iin limit ekle (500 kayt)\n    try {\n      const q = query(collection(firestore, \"customers\"), orderBy(\"createdAt\", \"desc\"), limit(500));\n      const snapshot = await getDocs(q);\n      const customers = snapshot.docs.map((doc) => ({\n        id: doc.id,\n        ...doc.data(),\n      })) as Customer[];\n      \n      // Duplicate kontrol - ayn ID'ye sahip mterileri filtrele\n      const uniqueCustomers = customers.filter((customer, index, self) =>\n        index === self.findIndex((c) => c.id === customer.id)\n      );\n      \n      return uniqueCustomers;\n    } catch (orderByError: unknown) {\n      // Index hatas varsa orderBy olmadan al\n      if (import.meta.env.DEV) {\n        if (import.meta.env.DEV) {\n          console.warn(\"OrderBy failed, fetching customers without order:\", orderByError);\n        }\n      }\n      const q = query(collection(firestore, \"customers\"), limit(500));\n      const snapshot = await getDocs(q);\n      const customers = snapshot.docs.map((doc) => ({\n        id: doc.id,\n        ...doc.data(),\n      })) as Customer[];\n      \n      // Duplicate kontrol - ayn ID'ye sahip mterileri filtrele\n      const uniqueCustomers = customers.filter((customer, index, self) =>\n        index === self.findIndex((c) => c.id === customer.id)\n      );\n      \n      // Client-side sorting\n      return uniqueCustomers.sort((a, b) => {\n        const aTime = a.createdAt?.toMillis() || 0;\n        const bTime = b.createdAt?.toMillis() || 0;\n        return bTime - aTime; // Descending order\n      });\n    }\n  } catch (error) {\n    if (import.meta.env.DEV) {\n      if (import.meta.env.DEV) {\n        console.error(\"Get customers error:\", error);\n      }\n    }\n    throw error;\n  }\n};\n\n/**\n * Mteri detayn al\n */\nexport const getCustomerById = async (customerId: string): Promise<Customer | null> => {\n  try {\n    const customerDoc = await getDoc(doc(firestore, \"customers\", customerId));\n    \n    if (!customerDoc.exists()) {\n      return null;\n    }\n\n    return {\n      id: customerDoc.id,\n      ...customerDoc.data(),\n    } as Customer;\n  } catch (error) {\n    if (import.meta.env.DEV) {\n      if (import.meta.env.DEV) {\n        console.error(\"Get customer by id error:\", error);\n      }\n    }\n    throw error;\n  }\n};\n\n/**\n * Yeni mteri olutur\n */\nexport const createCustomer = async (\n  customerData: Omit<Customer, \"id\" | \"createdAt\" | \"updatedAt\">\n): Promise<Customer> => {\n  try {\n    const docRef = await addDoc(collection(firestore, \"customers\"), {\n      ...customerData,\n      createdAt: serverTimestamp(),\n      updatedAt: serverTimestamp(),\n    });\n\n    const createdCustomer = await getCustomerById(docRef.id);\n    if (!createdCustomer) {\n      throw new Error(\"Mteri oluturulamad\");\n    }\n\n    // Audit log\n    await logAudit(\"CREATE\", \"customers\", docRef.id, customerData.createdBy, null, createdCustomer);\n\n    // Aktivite log ekle\n    if (customerData.createdBy) {\n      try {\n        const { getUserProfile } = await import(\"./authService\");\n        const userProfile = await getUserProfile(customerData.createdBy);\n        const userName = userProfile?.fullName || userProfile?.displayName || userProfile?.email;\n        const userEmail = userProfile?.email;\n        \n        await addCustomerActivity(\n          docRef.id,\n          customerData.createdBy,\n          \"created\",\n          `bu mteriyi oluturdu`,\n          { customerName: customerData.name },\n          userName,\n          userEmail\n        );\n      } catch (error) {\n        if (import.meta.env.DEV) {\n          console.error(\"Add customer activity error:\", error);\n        }\n      }\n    }\n\n    return createdCustomer;\n  } catch (error) {\n    if (import.meta.env.DEV) {\n      if (import.meta.env.DEV) {\n        console.error(\"Create customer error:\", error);\n      }\n    }\n    throw error;\n  }\n};\n\n/**\n * Mteriyi gncelle\n */\nexport const updateCustomer = async (\n  customerId: string,\n  updates: Partial<Omit<Customer, \"id\" | \"createdAt\" | \"createdBy\">>,\n  userId?: string\n): Promise<void> => {\n  try {\n    // Eski veriyi al\n    const oldCustomer = await getCustomerById(customerId);\n    \n    await updateDoc(doc(firestore, \"customers\", customerId), {\n      ...updates,\n      updatedAt: serverTimestamp(),\n    });\n    \n    // Yeni veriyi al\n    const newCustomer = await getCustomerById(customerId);\n    \n    // Audit log\n    if (userId) {\n      await logAudit(\"UPDATE\", \"customers\", customerId, userId, oldCustomer, newCustomer);\n    }\n\n    // Aktivite log ekle\n    if (userId && oldCustomer) {\n      try {\n        const { getUserProfile } = await import(\"./authService\");\n        const userProfile = await getUserProfile(userId);\n        const userName = userProfile?.fullName || userProfile?.displayName || userProfile?.email;\n        const userEmail = userProfile?.email;\n\n        const changedFields = Object.keys(updates).filter(key => {\n          const oldValue = (oldCustomer as Record<string, unknown>)[key];\n          const newValue = (updates as Record<string, unknown>)[key];\n          return oldValue !== newValue;\n        });\n        \n        if (changedFields.length > 0) {\n          await addCustomerActivity(\n            customerId,\n            userId,\n            \"updated\",\n            `bu mteriyi gncelledi`,\n            { changedFields },\n            userName,\n            userEmail\n          );\n        }\n      } catch (error) {\n        if (import.meta.env.DEV) {\n          console.error(\"Add customer activity error:\", error);\n        }\n      }\n    }\n  } catch (error) {\n    console.error(\"Update customer error:\", error);\n    throw error;\n  }\n};\n\n/**\n * Mteriyi sil\n */\nexport const deleteCustomer = async (customerId: string, userId?: string): Promise<void> => {\n  try {\n    // Eski veriyi al\n    const oldCustomer = await getCustomerById(customerId);\n    \n    // Aktivite log ekle (silmeden nce)\n    if (userId && oldCustomer) {\n      try {\n        const { getUserProfile } = await import(\"./authService\");\n        const userProfile = await getUserProfile(userId);\n        const userName = userProfile?.fullName || userProfile?.displayName || userProfile?.email;\n        const userEmail = userProfile?.email;\n        \n        await addCustomerActivity(\n          customerId,\n          userId,\n          \"deleted\",\n          `bu mteriyi sildi`,\n          { customerName: oldCustomer.name },\n          userName,\n          userEmail\n        );\n      } catch (error) {\n        if (import.meta.env.DEV) {\n          console.error(\"Add customer activity error:\", error);\n        }\n      }\n    }\n    \n    await deleteDoc(doc(firestore, \"customers\", customerId));\n    \n    // Audit log\n    if (userId) {\n      await logAudit(\"DELETE\", \"customers\", customerId, userId, oldCustomer, null);\n    }\n  } catch (error) {\n    if (import.meta.env.DEV) {\n      console.error(\"Delete customer error:\", error);\n    }\n    throw error;\n  }\n};\n\n// Customer Comments and Activities\n\nexport interface CustomerComment {\n  id: string;\n  customerId: string;\n  userId: string;\n  userName?: string;\n  userEmail?: string;\n  content: string;\n  createdAt: Timestamp;\n  updatedAt?: Timestamp | null;\n}\n\nexport interface CustomerActivity {\n  id: string;\n  customerId: string;\n  userId: string;\n  userName?: string;\n  userEmail?: string;\n  action: string;\n  description: string;\n  metadata?: Record<string, any>;\n  createdAt: Timestamp;\n}\n\n/**\n * Mteri yorumu ekle\n */\nexport const addCustomerComment = async (\n  customerId: string,\n  userId: string,\n  content: string,\n  userName?: string,\n  userEmail?: string\n): Promise<CustomerComment> => {\n  try {\n    const commentData: Omit<CustomerComment, \"id\"> = {\n      customerId,\n      userId,\n      userName,\n      userEmail,\n      content,\n      createdAt: Timestamp.now(),\n      updatedAt: null,\n    };\n\n    const docRef = await addDoc(\n      collection(firestore, \"customers\", customerId, \"comments\"),\n      commentData\n    );\n\n    // Activity log ekle\n    await addCustomerActivity(customerId, userId, \"commented\", `yorum ekledi`, { commentId: docRef.id }, userName, userEmail);\n\n    // Mteriyi oluturan kiiye bildirim gnder (yorum ekleyen kii hari)\n    try {\n      const customer = await getCustomerById(customerId);\n      if (customer?.createdBy && customer.createdBy !== userId) {\n        const { createNotification } = await import(\"@/services/firebase/notificationService\");\n        await createNotification({\n          userId: customer.createdBy,\n          type: \"comment_added\",\n          title: \"Mterinize Yorum Eklendi\",\n          message: `${userName || userEmail || \"Bir kullanc\"} \"${customer.name}\" mterinize yorum ekledi: ${content.substring(0, 100)}${content.length > 100 ? \"...\" : \"\"}`,\n          read: false,\n          relatedId: customerId,\n          metadata: { commentId: docRef.id, commenterId: userId, commenterName: userName, commenterEmail: userEmail },\n        });\n      }\n    } catch (error) {\n      if (import.meta.env.DEV) {\n        console.error(\"Send comment notification error:\", error);\n      }\n    }\n\n    return {\n      id: docRef.id,\n      ...commentData,\n    };\n  } catch (error) {\n    if (import.meta.env.DEV) {\n      console.error(\"Add customer comment error:\", error);\n    }\n    throw error;\n  }\n};\n\n/**\n * Mteri yorumlarn al\n */\nexport const getCustomerComments = async (customerId: string): Promise<CustomerComment[]> => {\n  try {\n    const snapshot = await getDocs(\n      query(\n        collection(firestore, \"customers\", customerId, \"comments\"),\n        orderBy(\"createdAt\", \"desc\")\n      )\n    );\n    return snapshot.docs.map((doc) => ({\n      id: doc.id,\n      ...doc.data(),\n    })) as CustomerComment[];\n  } catch (error) {\n    if (import.meta.env.DEV) {\n      console.error(\"Get customer comments error:\", error);\n    }\n    throw error;\n  }\n};\n\n/**\n * Mteri aktivite log ekle\n */\nexport const addCustomerActivity = async (\n  customerId: string,\n  userId: string,\n  action: string,\n  description: string,\n  metadata?: Record<string, any>,\n  userName?: string,\n  userEmail?: string\n): Promise<string> => {\n  try {\n    const activityData: Omit<CustomerActivity, \"id\"> = {\n      customerId,\n      userId,\n      userName,\n      userEmail,\n      action,\n      description,\n      metadata: metadata || {},\n      createdAt: Timestamp.now(),\n    };\n\n    const docRef = await addDoc(\n      collection(firestore, \"customers\", customerId, \"activities\"),\n      activityData\n    );\n\n    return docRef.id;\n  } catch (error) {\n    if (import.meta.env.DEV) {\n      console.error(\"Add customer activity error:\", error);\n    }\n    return \"\";\n  }\n};\n\n/**\n * Mteri aktivite loglarn al\n */\nexport const getCustomerActivities = async (customerId: string): Promise<CustomerActivity[]> => {\n  try {\n    const snapshot = await getDocs(\n      query(\n        collection(firestore, \"customers\", customerId, \"activities\"),\n        orderBy(\"createdAt\", \"desc\")\n      )\n    );\n    return snapshot.docs.map((doc) => ({\n      id: doc.id,\n      ...doc.data(),\n    })) as CustomerActivity[];\n  } catch (error) {\n    if (import.meta.env.DEV) {\n      console.error(\"Get customer activities error:\", error);\n    }\n    throw error;\n  }\n};\n\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\services\\firebase\\departmentService.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\services\\firebase\\materialCategoryService.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\services\\firebase\\materialService.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":556,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":556,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[17421,17424],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[17421,17424],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":647,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":647,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[19955,19958],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[19955,19958],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Firebase Raw Material Service\n * Hammade ynetimi ilemleri\n */\n\nimport {\n  collection,\n  doc,\n  getDoc,\n  getDocs,\n  addDoc,\n  updateDoc,\n  deleteDoc,\n  query,\n  orderBy,\n  limit,\n  serverTimestamp,\n  Timestamp,\n} from \"firebase/firestore\";\nimport { firestore } from \"@/lib/firebase\";\nimport { logAudit } from \"@/utils/auditLogger\";\nimport { handlePermissionError, isPermissionError, getPermissionErrorMessage } from \"@/utils/errorLogger\";\nimport { auth } from \"@/lib/firebase\";\n\nexport interface RawMaterial {\n  id: string;\n  name: string;\n  code?: string | null;\n  sku?: string | null; // SKU kodu (code ile ayn ama eski sistem uyumluluu iin)\n  category?: string | null; // Kategori\n  unit: string; // 'kg', 'm', 'adet', vb.\n  currentStock: number;\n  stock?: number | null; // currentStock ile ayn (eski sistem uyumluluu iin)\n  minStock?: number | null;\n  min_stock?: number | null; // minStock ile ayn (eski sistem uyumluluu iin)\n  maxStock?: number | null;\n  max_stock?: number | null; // maxStock ile ayn (eski sistem uyumluluu iin)\n  cost?: number | null; // unitPrice ile ayn (eski sistem uyumluluu iin)\n  unitPrice?: number | null; // Birim fiyat\n  vatRate?: number | null; // KDV yzdesi\n  totalPrice?: number | null; // Toplam fiyat (KDV dahil)\n  currency?: string | null; // Para birimi: 'TRY', 'USD', 'EUR', vb.\n  currencies?: string[]; // Para birimleri: ['TRY', 'USD', 'EUR', vb.] (eski sistem uyumluluu iin)\n  brand?: string | null; // Marka\n  link?: string | null; // Link/URL\n  supplier?: string | null;\n  purchasedBy?: string | null; // Satn alan kii (user ID)\n  location?: string | null; // Hammadde konumu\n  notes?: string | null;\n  description?: string | null; // Aklama\n  deleted?: boolean | null; // Silinmi mi? (eski sistem uyumluluu iin)\n  isDeleted?: boolean | null; // Silinmi mi? (eski sistem uyumluluu iin)\n  createdBy?: string | null; // Oluturan kullanc ID\n  createdAt: Timestamp;\n  updatedAt: Timestamp;\n}\n\nexport interface MaterialTransaction {\n  id: string;\n  materialId: string;\n  type: \"in\" | \"out\";\n  quantity: number;\n  reason: string;\n  relatedOrderId?: string | null;\n  createdAt: Timestamp;\n  createdBy: string;\n}\n\n/**\n * Tm hammaddeleri listele\n */\nexport const getRawMaterials = async (includeDeleted: boolean = false): Promise<RawMaterial[]> => {\n  try {\n    // Performans iin limit ekle (500 kayt)\n    let q;\n    if (includeDeleted) {\n      q = query(collection(firestore, \"rawMaterials\"), orderBy(\"createdAt\", \"desc\"), limit(500));\n    } else {\n      // Silinmi olmayan hammaddeleri getir\n      q = query(\n        collection(firestore, \"rawMaterials\"),\n        orderBy(\"createdAt\", \"desc\"),\n        limit(500)\n      );\n    }\n    const snapshot = await getDocs(q);\n    const materials: RawMaterial[] = [];\n    \n    for (const docSnapshot of snapshot.docs) {\n      const data = docSnapshot.data();\n      if (!data || typeof data !== 'object') continue;\n      \n      // Silinmi hammaddeleri atla (eer includeDeleted false ise)\n      if (!includeDeleted) {\n        const deleted = data.deleted === true || data.isDeleted === true;\n        if (deleted) {\n          continue;\n        }\n      }\n      \n      const material: RawMaterial = {\n        id: docSnapshot.id,\n        name: data.name || \"\",\n        code: data.code || data.sku || null,\n        sku: data.sku || data.code || null,\n        category: data.category || \"other\",\n        unit: data.unit || \"Adet\",\n        currentStock: data.currentStock !== undefined ? data.currentStock : (data.stock || 0),\n        stock: data.stock !== undefined ? data.stock : (data.currentStock || 0),\n        minStock: data.minStock !== undefined ? data.minStock : (data.min_stock || 0),\n        min_stock: data.min_stock !== undefined ? data.min_stock : (data.minStock || 0),\n        maxStock: data.maxStock !== undefined ? data.maxStock : (data.max_stock || null),\n        max_stock: data.max_stock !== undefined ? data.max_stock : (data.maxStock || null),\n        cost: data.cost !== undefined ? data.cost : (data.unitPrice || null),\n        unitPrice: data.unitPrice !== undefined ? data.unitPrice : (data.cost || null),\n        totalPrice: data.totalPrice !== undefined ? data.totalPrice : null,\n        brand: data.brand || null,\n        link: data.link || null,\n        purchasedBy: data.purchasedBy || null,\n        location: data.location || null,\n        currency: data.currency || null,\n        currencies: data.currencies || null,\n        notes: data.notes || null,\n        description: data.description || null,\n        createdBy: data.createdBy || null,\n        createdAt: data.createdAt || Timestamp.now(),\n        updatedAt: data.updatedAt || Timestamp.now(),\n      };\n      materials.push(material);\n    }\n    \n    return materials;\n  } catch (error: unknown) {\n    if (import.meta.env.DEV) {\n      if (import.meta.env.DEV) {\n        console.error(\"Get raw materials error:\", error);\n      }\n    }\n    if (isPermissionError(error)) {\n      throw handlePermissionError(error, {\n        operation: \"read\",\n        collection: \"rawMaterials\",\n        userId: auth?.currentUser?.uid,\n      });\n    }\n    throw error;\n  }\n};\n\n/**\n * Hammade detayn al\n */\nexport const getRawMaterialById = async (materialId: string): Promise<RawMaterial | null> => {\n  try {\n    const materialDoc = await getDoc(doc(firestore, \"rawMaterials\", materialId));\n    \n    if (!materialDoc.exists()) {\n      return null;\n    }\n\n    const data = materialDoc.data() as Omit<RawMaterial, \"id\">;\n    return {\n      id: materialDoc.id,\n      name: data.name || \"\",\n      code: data.code || data.sku || null,\n      sku: data.sku || data.code || null,\n      category: data.category || \"other\",\n      unit: data.unit || \"Adet\",\n      currentStock: data.currentStock !== undefined ? data.currentStock : (data.stock || 0),\n      stock: data.stock !== undefined ? data.stock : (data.currentStock || 0),\n      minStock: data.minStock !== undefined ? data.minStock : (data.min_stock || 0),\n      min_stock: data.min_stock !== undefined ? data.min_stock : (data.minStock || 0),\n      maxStock: data.maxStock !== undefined ? data.maxStock : (data.max_stock || null),\n      max_stock: data.max_stock !== undefined ? data.max_stock : (data.maxStock || null),\n      cost: data.cost !== undefined ? data.cost : (data.unitPrice || null),\n      unitPrice: data.unitPrice !== undefined ? data.unitPrice : (data.cost || null),\n      totalPrice: data.totalPrice !== undefined ? data.totalPrice : null,\n      brand: data.brand || null,\n      link: data.link || null,\n      purchasedBy: data.purchasedBy || null,\n      location: data.location || null,\n      currency: data.currency || null,\n      currencies: data.currencies || null,\n      notes: data.notes || null,\n      description: data.description || null,\n      createdBy: data.createdBy || null,\n      createdAt: data.createdAt || Timestamp.now(),\n      updatedAt: data.updatedAt || Timestamp.now(),\n    } as RawMaterial;\n  } catch (error: unknown) {\n    if (import.meta.env.DEV) {\n      if (import.meta.env.DEV) {\n        console.error(\"Get raw material by id error:\", error);\n      }\n    }\n    if (isPermissionError(error)) {\n      throw handlePermissionError(error, {\n        operation: \"read\",\n        collection: \"rawMaterials\",\n        documentId: materialId,\n        userId: auth?.currentUser?.uid,\n      });\n    }\n    throw error;\n  }\n};\n\n/**\n * Yeni hammade olutur\n */\nexport const createRawMaterial = async (\n  materialData: Omit<RawMaterial, \"id\" | \"createdAt\" | \"updatedAt\">\n): Promise<RawMaterial> => {\n  try {\n    const userId = auth?.currentUser?.uid;\n    \n    const docRef = await addDoc(collection(firestore, \"rawMaterials\"), {\n      ...materialData,\n      createdBy: userId || materialData.createdBy || null,\n      createdAt: serverTimestamp(),\n      updatedAt: serverTimestamp(),\n    });\n\n    const createdMaterial = await getRawMaterialById(docRef.id);\n    if (!createdMaterial) {\n      throw new Error(\"Hammade oluturulamad\");\n    }\n\n    // Audit log\n    if (userId) {\n      await logAudit(\"CREATE\", \"raw_materials\", docRef.id, userId, null, createdMaterial);\n    }\n\n    // Aktivite log ekle\n    const finalUserId = userId || materialData.createdBy || auth?.currentUser?.uid;\n    if (finalUserId) {\n      try {\n        const { getUserProfile } = await import(\"./authService\");\n        const userProfile = await getUserProfile(finalUserId);\n        const userName = userProfile?.fullName || userProfile?.displayName || userProfile?.email;\n        const userEmail = userProfile?.email;\n        \n        await addMaterialActivity(\n          docRef.id,\n          finalUserId,\n          \"created\",\n          `bu hammadeyi oluturdu`,\n          { materialName: materialData.name },\n          userName,\n          userEmail\n        );\n      } catch (error) {\n        if (import.meta.env.DEV) {\n          console.error(\"Add material activity error:\", error);\n        }\n      }\n    }\n\n    return createdMaterial;\n  } catch (error: unknown) {\n    if (import.meta.env.DEV) {\n      if (import.meta.env.DEV) {\n        console.error(\"Create raw material error:\", error);\n      }\n    }\n    if (isPermissionError(error)) {\n      throw handlePermissionError(error, {\n        operation: \"create\",\n        collection: \"rawMaterials\",\n        userId: auth?.currentUser?.uid,\n        data: materialData,\n      });\n    }\n    throw error;\n  }\n};\n\n/**\n * Hammadeyi gncelle\n */\nexport const updateRawMaterial = async (\n  materialId: string,\n  updates: Partial<Omit<RawMaterial, \"id\" | \"createdAt\">>,\n  userId?: string\n): Promise<void> => {\n  try {\n    // Eski veriyi al\n    const oldMaterial = await getRawMaterialById(materialId);\n    \n    await updateDoc(doc(firestore, \"rawMaterials\", materialId), {\n      ...updates,\n      updatedAt: serverTimestamp(),\n    });\n    \n    // Yeni veriyi al\n    const newMaterial = await getRawMaterialById(materialId);\n    \n    // Audit log\n    if (userId) {\n      await logAudit(\"UPDATE\", \"raw_materials\", materialId, userId, oldMaterial, newMaterial);\n    }\n\n    // Aktivite log ekle\n    const finalUserId = userId || auth?.currentUser?.uid;\n    if (finalUserId && oldMaterial) {\n      try {\n        const { getUserProfile } = await import(\"./authService\");\n        const userProfile = await getUserProfile(finalUserId);\n        const userName = userProfile?.fullName || userProfile?.displayName || userProfile?.email;\n        const userEmail = userProfile?.email;\n\n        const changedFields = Object.keys(updates).filter(key => {\n          const oldValue = (oldMaterial as Record<string, unknown>)[key];\n          const newValue = (updates as Record<string, unknown>)[key];\n          return oldValue !== newValue;\n        });\n        \n        if (changedFields.length > 0) {\n          await addMaterialActivity(\n            materialId,\n            finalUserId,\n            \"updated\",\n            `bu hammadeyi gncelledi`,\n            { changedFields },\n            userName,\n            userEmail\n          );\n        }\n      } catch (error) {\n        if (import.meta.env.DEV) {\n          console.error(\"Add material activity error:\", error);\n        }\n      }\n    }\n  } catch (error: unknown) {\n    if (import.meta.env.DEV) {\n      if (import.meta.env.DEV) {\n        console.error(\"Update raw material error:\", error);\n      }\n    }\n    if (isPermissionError(error)) {\n      throw handlePermissionError(error, {\n        operation: \"update\",\n        collection: \"rawMaterials\",\n        documentId: materialId,\n        userId: userId || auth?.currentUser?.uid,\n        data: updates,\n      });\n    }\n    throw error;\n  }\n};\n\n/**\n * Hammadeyi sil\n */\nexport const deleteRawMaterial = async (materialId: string, userId?: string): Promise<void> => {\n  try {\n    // Eski veriyi al\n    const oldMaterial = await getRawMaterialById(materialId);\n    \n    // Aktivite log ekle (silmeden nce)\n    const finalUserId = userId || auth?.currentUser?.uid;\n    if (finalUserId && oldMaterial) {\n      try {\n        const { getUserProfile } = await import(\"./authService\");\n        const userProfile = await getUserProfile(finalUserId);\n        const userName = userProfile?.fullName || userProfile?.displayName || userProfile?.email;\n        const userEmail = userProfile?.email;\n        \n        await addMaterialActivity(\n          materialId,\n          finalUserId,\n          \"deleted\",\n          `bu hammadeyi sildi`,\n          { materialName: oldMaterial.name },\n          userName,\n          userEmail\n        );\n      } catch (error) {\n        if (import.meta.env.DEV) {\n          console.error(\"Add material activity error:\", error);\n        }\n      }\n    }\n    \n    await deleteDoc(doc(firestore, \"rawMaterials\", materialId));\n    \n    // Audit log\n    if (userId) {\n      await logAudit(\"DELETE\", \"raw_materials\", materialId, userId, oldMaterial, null);\n    }\n  } catch (error: unknown) {\n    if (import.meta.env.DEV) {\n      console.error(\"Delete raw material error:\", error);\n    }\n    if (isPermissionError(error)) {\n      throw handlePermissionError(error, {\n        operation: \"delete\",\n        collection: \"rawMaterials\",\n        documentId: materialId,\n        userId: userId || auth?.currentUser?.uid,\n      });\n    }\n    throw error;\n  }\n};\n\n/**\n * Stok hareketi ekle\n * @param transactionData - lem verisi\n * @param skipStockUpdate - Stok gncellemesini atla (stok zaten gncellenmise true)\n */\nexport const addMaterialTransaction = async (\n  transactionData: Omit<MaterialTransaction, \"id\" | \"createdAt\">,\n  skipStockUpdate: boolean = false\n): Promise<MaterialTransaction> => {\n  try {\n    const materialId = transactionData.materialId;\n    \n    // Stok hareketini ekle\n    const docRef = await addDoc(\n      collection(firestore, \"rawMaterials\", materialId, \"transactions\"),\n      {\n        ...transactionData,\n        createdAt: serverTimestamp(),\n      }\n    );\n\n    // Stok miktarn gncelle (eer skipStockUpdate false ise)\n    if (!skipStockUpdate) {\n      const material = await getRawMaterialById(materialId);\n      if (material) {\n        const newStock =\n          transactionData.type === \"in\"\n            ? material.currentStock + transactionData.quantity\n            : material.currentStock - transactionData.quantity;\n\n        await updateRawMaterial(materialId, {\n          currentStock: newStock,\n        });\n      }\n    }\n\n    const createdTransaction = {\n      id: docRef.id,\n      materialId: transactionData.materialId,\n      type: transactionData.type,\n      quantity: transactionData.quantity,\n      reason: transactionData.reason,\n      relatedOrderId: transactionData.relatedOrderId || null,\n      createdBy: transactionData.createdBy,\n      createdAt: Timestamp.now(),\n    } as MaterialTransaction;\n\n    // Audit log\n    try {\n      const { logAudit } = await import(\"@/utils/auditLogger\");\n      await logAudit(\n        \"CREATE\",\n        \"material_transactions\",\n        docRef.id,\n        transactionData.createdBy,\n        null,\n        {\n          type: transactionData.type,\n          quantity: transactionData.quantity,\n          reason: transactionData.reason,\n        },\n        {\n          materialId: transactionData.materialId,\n          relatedOrderId: transactionData.relatedOrderId || null,\n        }\n      );\n    } catch (logError) {\n      if (import.meta.env.DEV) {\n        console.error(\"Material transaction audit log error:\", logError);\n      }\n      // Log hatas ilemi engellememeli\n    }\n\n    return createdTransaction;\n  } catch (error: unknown) {\n    if (import.meta.env.DEV) {\n      console.error(\"Add material transaction error:\", error);\n    }\n    if (isPermissionError(error)) {\n      throw handlePermissionError(error, {\n        operation: \"create\",\n        collection: \"rawMaterials/transactions\",\n        userId: transactionData.createdBy,\n        data: transactionData,\n      });\n    }\n    throw error;\n  }\n};\n\n/**\n * Hammade hareketlerini al\n */\nexport const getMaterialTransactions = async (materialId: string): Promise<MaterialTransaction[]> => {\n  try {\n    const snapshot = await getDocs(\n      collection(firestore, \"rawMaterials\", materialId, \"transactions\")\n    );\n    return snapshot.docs.map((doc) => {\n      const data = doc.data() as Omit<MaterialTransaction, \"id\">;\n      return {\n        id: doc.id,\n        materialId: data.materialId || \"\",\n        type: data.type || \"out\",\n        quantity: data.quantity || 0,\n        reason: data.reason || \"\",\n        relatedOrderId: data.relatedOrderId || null,\n        createdAt: data.createdAt || Timestamp.now(),\n        createdBy: data.createdBy || \"\",\n      } as MaterialTransaction;\n    });\n  } catch (error: unknown) {\n    if (import.meta.env.DEV) {\n      console.error(\"Get material transactions error:\", error);\n    }\n    if (isPermissionError(error)) {\n      throw handlePermissionError(error, {\n        operation: \"read\",\n        collection: \"rawMaterials/transactions\",\n        userId: auth?.currentUser?.uid,\n      });\n    }\n    throw error;\n  }\n};\n\n// Material Comments and Activities\n\nexport interface MaterialComment {\n  id: string;\n  materialId: string;\n  userId: string;\n  userName?: string;\n  userEmail?: string;\n  content: string;\n  createdAt: Timestamp;\n  updatedAt?: Timestamp | null;\n}\n\nexport interface MaterialActivity {\n  id: string;\n  materialId: string;\n  userId: string;\n  userName?: string;\n  userEmail?: string;\n  action: string;\n  description: string;\n  metadata?: Record<string, any>;\n  createdAt: Timestamp;\n}\n\n/**\n * Hammadde yorumu ekle\n */\nexport const addMaterialComment = async (\n  materialId: string,\n  userId: string,\n  content: string,\n  userName?: string,\n  userEmail?: string\n): Promise<MaterialComment> => {\n  try {\n    const commentData: Omit<MaterialComment, \"id\"> = {\n      materialId,\n      userId,\n      userName,\n      userEmail,\n      content,\n      createdAt: Timestamp.now(),\n      updatedAt: null,\n    };\n\n    const docRef = await addDoc(\n      collection(firestore, \"rawMaterials\", materialId, \"comments\"),\n      commentData\n    );\n\n    // Activity log ekle\n    await addMaterialActivity(materialId, userId, \"commented\", `yorum ekledi`, { commentId: docRef.id }, userName, userEmail);\n\n    // Hammadeyi oluturan kiiye bildirim gnder (yorum ekleyen kii hari)\n    try {\n      const material = await getRawMaterialById(materialId);\n      if (material?.createdBy && material.createdBy !== userId) {\n        const { createNotification } = await import(\"@/services/firebase/notificationService\");\n        await createNotification({\n          userId: material.createdBy,\n          type: \"comment_added\",\n          title: \"Hammadenize Yorum Eklendi\",\n          message: `${userName || userEmail || \"Bir kullanc\"} \"${material.name}\" hammadenize yorum ekledi: ${content.substring(0, 100)}${content.length > 100 ? \"...\" : \"\"}`,\n          read: false,\n          relatedId: materialId,\n          metadata: { commentId: docRef.id, commenterId: userId, commenterName: userName, commenterEmail: userEmail },\n        });\n      }\n    } catch (error) {\n      console.error(\"Send comment notification error:\", error);\n    }\n\n    return {\n      id: docRef.id,\n      ...commentData,\n    };\n  } catch (error) {\n    console.error(\"Add material comment error:\", error);\n    throw error;\n  }\n};\n\n/**\n * Hammadde yorumlarn al\n */\nexport const getMaterialComments = async (materialId: string): Promise<MaterialComment[]> => {\n  try {\n    const snapshot = await getDocs(\n      query(\n        collection(firestore, \"rawMaterials\", materialId, \"comments\"),\n        orderBy(\"createdAt\", \"desc\")\n      )\n    );\n    return snapshot.docs.map((doc) => ({\n      id: doc.id,\n      ...doc.data(),\n    })) as MaterialComment[];\n  } catch (error) {\n    console.error(\"Get material comments error:\", error);\n    throw error;\n  }\n};\n\n/**\n * Hammadde aktivite log ekle\n */\nexport const addMaterialActivity = async (\n  materialId: string,\n  userId: string,\n  action: string,\n  description: string,\n  metadata?: Record<string, any>,\n  userName?: string,\n  userEmail?: string\n): Promise<string> => {\n  try {\n    const activityData: Omit<MaterialActivity, \"id\"> = {\n      materialId,\n      userId,\n      userName,\n      userEmail,\n      action,\n      description,\n      metadata: metadata || {},\n      createdAt: Timestamp.now(),\n    };\n\n    const docRef = await addDoc(\n      collection(firestore, \"rawMaterials\", materialId, \"activities\"),\n      activityData\n    );\n\n    return docRef.id;\n  } catch (error) {\n    console.error(\"Add material activity error:\", error);\n    return \"\";\n  }\n};\n\n/**\n * Hammadde aktivite loglarn al\n */\nexport const getMaterialActivities = async (materialId: string): Promise<MaterialActivity[]> => {\n  try {\n    const snapshot = await getDocs(\n      query(\n        collection(firestore, \"rawMaterials\", materialId, \"activities\"),\n        orderBy(\"createdAt\", \"desc\")\n      )\n    );\n    return snapshot.docs.map((doc) => ({\n      id: doc.id,\n      ...doc.data(),\n    })) as MaterialActivity[];\n  } catch (error) {\n    console.error(\"Get material activities error:\", error);\n    throw error;\n  }\n};\n\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\services\\firebase\\notificationService.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":88,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":88,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2635,2638],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2635,2638],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":93,"column":22,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":93,"endColumn":25,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2899,2902],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2899,2902],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"prefer-const","severity":2,"message":"'q' is never reassigned. Use 'const' instead.","line":327,"column":9,"nodeType":"Identifier","messageId":"useConst","endLine":327,"endColumn":10,"fix":{"range":[9828,9849],"text":"const q = buildQuery();"}}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":1,"fixableWarningCount":0,"source":"/**\n * Firebase Notification Service\n * Bildirim ynetimi ilemleri\n */\n\nimport {\n  collection,\n  doc,\n  getDoc,\n  getDocs,\n  addDoc,\n  updateDoc,\n  deleteDoc,\n  query,\n  where,\n  orderBy,\n  limit,\n  serverTimestamp,\n  Timestamp,\n  onSnapshot,\n  Unsubscribe,\n  QueryConstraint,\n} from \"firebase/firestore\";\nimport { firestore } from \"@/lib/firebase\";\nimport { sendNotificationEmail } from \"@/services/emailService\";\n\nexport interface Notification {\n  id: string;\n  userId: string;\n  type: \"task_assigned\" | \"task_updated\" | \"task_completed\" | \"task_created\" | \"task_deleted\" | \"task_pool_request\" | \"order_created\" | \"order_updated\" | \"role_changed\" | \"system\" | \"task_approval\" | \"comment_added\";\n  title: string;\n  message: string;\n  read: boolean;\n  relatedId?: string | null; // task ID, order ID, vb.\n  metadata?: Record<string, unknown> | null; // assignment_id, vb. iin\n  createdAt: Timestamp;\n}\n\n/**\n * Kullancnn bildirimlerini al\n */\nexport const getNotifications = async (\n  userId: string,\n  options?: { unreadOnly?: boolean; limit?: number }\n): Promise<Notification[]> => {\n  try {\n    // Firestore index gereksinimleri: equality filtreler nce, sonra orderBy\n    // Index: read (ASC), userId (ASC), createdAt (DESC)\n    let q = query(\n      collection(firestore, \"notifications\"),\n      where(\"userId\", \"==\", userId)\n    );\n\n    if (options?.unreadOnly) {\n      q = query(q, where(\"read\", \"==\", false));\n    }\n\n    // orderBy her zaman en sonda olmal\n    q = query(q, orderBy(\"createdAt\", \"desc\"));\n\n    if (options?.limit) {\n      q = query(q, limit(options.limit));\n    }\n\n    const snapshot = await getDocs(q);\n    return snapshot.docs.map((doc) => ({\n      id: doc.id,\n      ...doc.data(),\n    })) as Notification[];\n  } catch (error: unknown) {\n    const isIndexError =\n      typeof error === \"object\" &&\n      error !== null &&\n      \"code\" in error &&\n      (error as { code?: string }).code === \"failed-precondition\" &&\n      \"message\" in error &&\n      typeof (error as { message?: string }).message === \"string\" &&\n      (error as { message: string }).message.includes(\"index\");\n\n    if (isIndexError) {\n      // Index hatas durumunda bo array dndr (ilemin devam etmesini engelleme)\n      // Index oluturulana kadar bildirimler grnmeyecek ama sistem almaya devam edecek\n      // Hatalar sessizce handle et - sadece development'ta ilk kez gster\n      if (import.meta.env.DEV) {\n        const message = (error as { message: string }).message;\n        const indexUrl = message.match(/https:\\/\\/[^\\s]+/)?.[0];\n        // Sadece ilk kez gster (tekrar tekrar loglamay nle)\n        if (!(window as any).__firestoreIndexWarningShown) {\n          console.debug(\" Firestore index eksik. Bildirimler index oluturulana kadar grnmeyecek.\");\n          if (indexUrl) {\n            console.debug(\"Index oluturma linki:\", indexUrl);\n          }\n          (window as any).__firestoreIndexWarningShown = true;\n        }\n      }\n      return [];\n    }\n\n    // Dier hatalar iin de bo array dndr (sistemin almaya devam etmesi iin)\n    // Sadece gerek hatalar logla (index hatas deilse)\n    if (import.meta.env.DEV) {\n      console.debug(\"Get notifications error (non-index):\", error);\n    }\n    return [];\n  }\n};\n\n/**\n * Okunmam bildirim saysn al\n */\nexport const getUnreadNotificationCount = async (userId: string): Promise<number> => {\n  try {\n    const q = query(\n      collection(firestore, \"notifications\"),\n      where(\"userId\", \"==\", userId),\n      where(\"read\", \"==\", false)\n    );\n    const snapshot = await getDocs(q);\n    return snapshot.size;\n  } catch (error: unknown) {\n    if (import.meta.env.DEV) console.error(\"Get unread notification count error:\", error);\n    throw error;\n  }\n};\n\n/**\n * Bildirim olutur\n */\nexport const createNotification = async (\n  notificationData: Omit<Notification, \"id\" | \"createdAt\">\n): Promise<Notification> => {\n  try {\n    const docRef = await addDoc(collection(firestore, \"notifications\"), {\n      ...notificationData,\n      createdAt: serverTimestamp(),\n    });\n\n    const createdNotification = await getDoc(docRef);\n    if (!createdNotification.exists()) {\n      throw new Error(\"Bildirim oluturulamad\");\n    }\n\n    const notification = {\n      id: createdNotification.id,\n      ...createdNotification.data(),\n    } as Notification;\n\n    // Bildirim baaryla oluturuldu, hemen dndr\n    // Email gnderimi arka planda yaplacak (hem Cloud Functions hem de manuel fallback)\n\n    // Email gnderimini arka planda balat (await etme)\n    // nce Cloud Functions denenecek, eer almyorsa manuel email gnderimi yaplacak\n    Promise.resolve().then(async () => {\n      try {\n        const userDoc = await getDoc(doc(firestore, \"users\", notificationData.userId));\n        if (userDoc.exists()) {\n          const userData = userDoc.data();\n          if (userData?.email) {\n            // Manuel email gnderimi (Cloud Functions almyorsa fallback)\n            // Hata olsa bile sessizce devam et\n            try {\n              const emailResult = await sendNotificationEmail(\n                userData.email,\n                notificationData.title,\n                notificationData.message,\n                notificationData.type,\n                notificationData.relatedId || null,\n                notificationData.metadata || null\n              );\n\n              // Email gnderim sonucunu logla (sadece baarl olduunda)\n              if (import.meta.env.DEV && emailResult.success) {\n                console.log(` Bildirim maili gnderildi: ${userData.email}`);\n              }\n            } catch (emailError: unknown) {\n              // Email gnderilemedi - sessizce devam et\n              // Cloud Functions da email gnderebilir, bu yzden kritik deil\n            }\n          }\n        }\n      } catch (error) {\n        // Hata olsa bile sessizce devam et\n      }\n    }).catch(() => {\n      // Promise rejection' yakala ama hibir ey yapma\n    });\n\n    // Bildirimi hemen dndr (email gnderimi arka planda devam edecek)\n    return notification;\n  } catch (error: unknown) {\n    if (import.meta.env.DEV) console.error(\"Create notification error:\", error);\n    throw error;\n  }\n};\n\n/**\n * Bildirimi gncelle\n */\nexport const updateNotification = async (\n  notificationId: string,\n  updates: Partial<Omit<Notification, \"id\" | \"userId\" | \"createdAt\">>\n): Promise<void> => {\n  try {\n    await updateDoc(doc(firestore, \"notifications\", notificationId), updates);\n  } catch (error: unknown) {\n    if (import.meta.env.DEV) console.error(\"Update notification error:\", error);\n    throw error;\n  }\n};\n\n/**\n * Bildirimi okundu olarak iaretle\n */\nexport const markNotificationAsRead = async (notificationId: string): Promise<void> => {\n  try {\n    await updateDoc(doc(firestore, \"notifications\", notificationId), {\n      read: true,\n    });\n  } catch (error: unknown) {\n    if (import.meta.env.DEV) console.error(\"Mark notification as read error:\", error);\n    throw error;\n  }\n};\n\n/**\n * Tm bildirimleri okundu olarak iaretle\n */\nexport const markAllNotificationsAsRead = async (userId: string): Promise<void> => {\n  try {\n    const q = query(\n      collection(firestore, \"notifications\"),\n      where(\"userId\", \"==\", userId),\n      where(\"read\", \"==\", false)\n    );\n    const snapshot = await getDocs(q);\n\n    const batch = snapshot.docs.map((doc) =>\n      updateDoc(doc.ref, { read: true })\n    );\n\n    await Promise.all(batch);\n  } catch (error: unknown) {\n    if (import.meta.env.DEV) console.error(\"Mark all notifications as read error:\", error);\n    throw error;\n  }\n};\n\n/**\n * Bildirimi sil\n */\nexport const deleteNotification = async (notificationId: string): Promise<void> => {\n  try {\n    await deleteDoc(doc(firestore, \"notifications\", notificationId));\n  } catch (error: unknown) {\n    if (import.meta.env.DEV) console.error(\"Delete notification error:\", error);\n    throw error;\n  }\n};\n\n/**\n * Kullancnn tm bildirimlerini sil\n * Kullanc hesab silindiinde arlr\n */\nexport const deleteUserNotifications = async (userId: string): Promise<void> => {\n  try {\n    const q = query(\n      collection(firestore, \"notifications\"),\n      where(\"userId\", \"==\", userId)\n    );\n    const snapshot = await getDocs(q);\n\n    if (snapshot.empty) {\n      if (import.meta.env.DEV) {\n        console.log(`Kullanc ${userId} iin silinecek bildirim bulunamad`);\n      }\n      return;\n    }\n\n    // Tm bildirimleri paralel sil\n    const deletePromises = snapshot.docs.map((docSnapshot) =>\n      deleteDoc(doc(firestore, \"notifications\", docSnapshot.id))\n    );\n\n    await Promise.all(deletePromises);\n\n    if (import.meta.env.DEV) {\n      console.log(`${snapshot.size} bildirim silindi (kullanc: ${userId})`);\n    }\n  } catch (error: unknown) {\n    if (import.meta.env.DEV) console.error(\"Delete user notifications error:\", error);\n    // Hata frlatma - bu ilem kritik deil, ana ilem devam etmeli\n  }\n};\n\n/**\n * Bildirimleri gerek zamanl olarak dinle\n * @param userId Kullanc ID'si\n * @param options Bildirim seenekleri\n * @param callback Bildirimler deitiinde arlacak callback\n * @returns Unsubscribe fonksiyonu\n */\nexport const subscribeToNotifications = (\n  userId: string,\n  options: { unreadOnly?: boolean; limit?: number } = {},\n  callback: (notifications: Notification[]) => void\n): Unsubscribe => {\n  try {\n    const notificationsRef = collection(firestore, \"notifications\");\n\n    const buildQuery = () => {\n      const constraints: QueryConstraint[] = [\n        where(\"userId\", \"==\", userId),\n        orderBy(\"createdAt\", \"desc\")\n      ];\n\n      if (options?.unreadOnly) {\n        constraints.push(where(\"read\", \"==\", false));\n      }\n\n      if (options?.limit) {\n        constraints.push(limit(options.limit));\n      }\n\n      return query(notificationsRef, ...constraints);\n    };\n\n    let q = buildQuery();\n\n    // onSnapshot ile gerek zamanl dinleme\n    const unsubscribe = onSnapshot(\n      q,\n      (snapshot) => {\n        try {\n          const notifications = snapshot.docs.map((doc) => ({\n            id: doc.id,\n            ...doc.data(),\n          })) as Notification[];\n\n          callback(notifications);\n        } catch (error: unknown) {\n          if (import.meta.env.DEV) console.error(\"Subscribe to notifications error:\", error);\n          callback([]);\n        }\n      },\n      (error) => {\n        // 404 ve network hatalarn sessizce handle et (Firestore otomatik yeniden balanacak)\n        // Production'da da sessizce handle et - bu normal Firestore long-polling davran\n        if (error?.code === 'unavailable' ||\n          error?.code === 'not-found' ||\n          error?.message?.includes('404') ||\n          error?.message?.includes('network') ||\n          error?.message?.includes('transport errored')) {\n          // Sessizce handle et - Firestore otomatik olarak yeniden balanacak\n          // Production'da console'a yazma (performans ve grlt azaltma)\n          callback([]);\n          return;\n        }\n\n        // Sadece gerek hatalar logla\n        if (import.meta.env.DEV) {\n          console.error(\"Notifications snapshot error:\", error);\n        }\n        // Index hatas durumunda basit query dene\n        if (error?.code === 'failed-precondition' || error?.message?.includes('index')) {\n          try {\n            const simpleQuery = query(\n              notificationsRef,\n              where(\"userId\", \"==\", userId),\n              orderBy(\"createdAt\", \"desc\")\n            );\n            const fallbackUnsubscribe = onSnapshot(\n              simpleQuery,\n              (snapshot) => {\n                try {\n                  let notifications = snapshot.docs.map((doc) => ({\n                    id: doc.id,\n                    ...doc.data(),\n                  })) as Notification[];\n\n                  // Client-side filtreleme\n                  if (options?.unreadOnly) {\n                    notifications = notifications.filter(n => !n.read);\n                  }\n                  if (options?.limit) {\n                    notifications = notifications.slice(0, options.limit);\n                  }\n\n                  callback(notifications);\n                } catch (err: unknown) {\n                  if (import.meta.env.DEV) console.error(\"Fallback subscribe to notifications error:\", err);\n                  callback([]);\n                }\n              },\n              (err: unknown) => {\n                if (import.meta.env.DEV) console.error(\"Fallback notifications snapshot error:\", err);\n                callback([]);\n              }\n            );\n            return fallbackUnsubscribe;\n          } catch (fallbackError: unknown) {\n            if (import.meta.env.DEV) console.error(\"Fallback query setup error:\", fallbackError);\n            callback([]);\n          }\n        } else {\n          callback([]);\n        }\n      }\n    );\n\n    return unsubscribe;\n  } catch (error: unknown) {\n    if (import.meta.env.DEV) console.error(\"Subscribe to notifications setup error:\", error);\n    return () => { };\n  }\n};\n\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\services\\firebase\\orderService.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":530,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":530,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[17373,17376],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[17373,17376],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":535,"column":57,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":535,"endColumn":60,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[17563,17566],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[17563,17566],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"prefer-const","severity":2,"message":"'q' is never reassigned. Use 'const' instead.","line":900,"column":9,"nodeType":"Identifier","messageId":"useConst","endLine":900,"endColumn":10,"fix":{"range":[29065,29086],"text":"const q = buildQuery();"}},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1017,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1017,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[32792,32795],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[32792,32795],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1109,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1109,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[35323,35326],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[35323,35326],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":5,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":1,"fixableWarningCount":0,"source":"/**\n * Firebase Order Service\n * Sipari ynetimi ilemleri\n */\n\nimport {\n  collection,\n  doc,\n  getDoc,\n  getDocs,\n  addDoc,\n  updateDoc,\n  deleteDoc,\n  query,\n  where,\n  orderBy,\n  limit,\n  serverTimestamp,\n  Timestamp,\n  onSnapshot,\n  Unsubscribe,\n  QueryConstraint,\n  FieldValue,\n  writeBatch,\n} from \"firebase/firestore\";\nimport { firestore } from \"@/lib/firebase\";\nimport { logAudit } from \"@/utils/auditLogger\";\n\nexport interface OrderItem {\n  id: string;\n  productId?: string | null;\n  product_id?: string | null; // Alias\n  productName?: string | null;\n  product_name?: string | null; // Alias\n  quantity: number;\n  unitPrice: number;\n  unit_price?: number; // Alias\n  discount?: number;\n  discountType?: \"amount\" | \"percentage\"; // ndirim tipi: tutar veya yzde\n  total: number;\n  category?: string | null;\n}\n\nexport interface Order {\n  id: string;\n  orderNumber: string;\n  order_number?: string; // Alias\n  customerId?: string | null;\n  customer_id?: string | null; // Alias\n  customerName?: string | null;\n  customer_name?: string | null; // Alias\n  customerCompany?: string | null;\n  customer_company?: string | null; // Alias\n  status: \"draft\" | \"pending\" | \"confirmed\" | \"planned\" | \"in_production\" | \"quality_check\" | \"completed\" | \"shipped\" | \"delivered\" | \"cancelled\" | \"on_hold\";\n  approvalStatus?: \"pending\" | \"approved\" | \"rejected\";\n  approvalRequestedBy?: string;\n  approvalRequestedAt?: Timestamp;\n  approvedBy?: string;\n  approvedAt?: Timestamp;\n  rejectedBy?: string;\n  rejectedAt?: Timestamp;\n  rejectionReason?: string;\n  statusUpdatedBy?: string;\n  statusUpdatedAt?: Timestamp;\n  subtotal?: number;\n  taxAmount?: number;\n  discountTotal?: number;\n  itemsCount?: number;\n  totalQuantity?: number;\n  totalAmount?: number;\n  total_amount?: number; // Alias\n  taxRate?: number;\n  tax_rate?: number; // Alias\n  items_count?: number; // Alias\n  total_quantity?: number; // Alias\n  currency?: string;\n  orderDate?: Timestamp | null;\n  order_date?: string | null; // Alias (string format)\n  deliveryDate?: Timestamp | null;\n  delivery_date?: string | null; // Alias (string format)\n  receivedDate?: Timestamp | null; // Teslim alnan tarih\n  received_date?: string | null; // Alias (string format)\n  dueDate?: Timestamp | null;\n  due_date?: string | null; // Alias (string format)\n  notes?: string | null;\n  paymentTerms?: string | null;\n  payment_terms?: string | null; // Alias\n  createdAt: Timestamp;\n  created_at?: string; // Alias (string format)\n  updatedAt: Timestamp;\n  updated_at?: string; // Alias (string format)\n  createdBy: string;\n  created_by?: string; // Alias\n  customerEmail?: string | null;\n  customer_email?: string | null; // Alias\n  customerPhone?: string | null;\n  customer_phone?: string | null; // Alias\n  shippingAddress?: string | null;\n  shipping_address?: string | null; // Alias\n  deliveryAddress?: string | null;\n  delivery_address?: string | null; // Alias\n  shippingNotes?: string | null;\n  shipping_notes?: string | null; // Alias\n  deliveryNotes?: string | null;\n  delivery_notes?: string | null; // Alias\n  priority?: number | null;\n  deductMaterials?: boolean; // Hammadde drme (varsaylan: true)\n}\n\n/**\n * Tm siparileri listele\n */\nexport const getOrders = async (filters?: {\n  customerId?: string;\n  status?: string;\n}): Promise<Order[]> => {\n  try {\n    // Performans iin limit ekle (500 kayt)\n    let q = query(collection(firestore, \"orders\"), orderBy(\"createdAt\", \"desc\"), limit(500));\n\n    if (filters?.customerId) {\n      q = query(q, where(\"customerId\", \"==\", filters.customerId));\n    }\n\n    if (filters?.status) {\n      q = query(q, where(\"status\", \"==\", filters.status));\n    }\n\n    const snapshot = await getDocs(q);\n    return snapshot.docs.map((doc) => ({\n      id: doc.id,\n      ...doc.data(),\n    })) as Order[];\n  } catch (error: unknown) {\n    // Index hatas durumunda basit query dene\n    const errorMessage = error instanceof Error ? error.message : String(error);\n    const errorCode = (error as { code?: string })?.code;\n    if (errorCode === 'failed-precondition' || errorMessage.includes('index')) {\n      if (import.meta.env.DEV) {\n        console.warn(\"Orders index bulunamad, basit query kullanlyor\");\n      }\n      try {\n        const simpleQuery = query(collection(firestore, \"orders\"), orderBy(\"createdAt\", \"desc\"), limit(500));\n        const snapshot = await getDocs(simpleQuery);\n        let orders = snapshot.docs.map((doc) => ({\n          id: doc.id,\n          ...doc.data(),\n        })) as Order[];\n        \n        // Client-side filtreleme\n        if (filters?.customerId) {\n          orders = orders.filter(o => o.customerId === filters.customerId);\n        }\n        if (filters?.status) {\n          orders = orders.filter(o => o.status === filters.status);\n        }\n        \n        return orders;\n      } catch (fallbackError) {\n        if (import.meta.env.DEV) {\n          console.error(\"Fallback query de baarsz:\", fallbackError);\n        }\n        // Son are: filtreleme olmadan (limit ile)\n        const snapshot = await getDocs(query(collection(firestore, \"orders\"), limit(500)));\n        let orders = snapshot.docs.map((doc) => ({\n          id: doc.id,\n          ...doc.data(),\n        })) as Order[];\n        \n        // Client-side filtreleme\n        if (filters?.customerId) {\n          orders = orders.filter(o => o.customerId === filters.customerId);\n        }\n        if (filters?.status) {\n          orders = orders.filter(o => o.status === filters.status);\n        }\n        \n        // Tarihe gre srala\n        orders.sort((a, b) => {\n          const aDate = a.createdAt?.toMillis() || 0;\n          const bDate = b.createdAt?.toMillis() || 0;\n          return bDate - aDate;\n        });\n        \n        return orders;\n      }\n    }\n    if (import.meta.env.DEV) {\n      console.error(\"Get orders error:\", error);\n    }\n    throw error;\n  }\n};\n\n/**\n * Sipari detayn al\n */\nexport const getOrderById = async (orderId: string): Promise<Order | null> => {\n  try {\n    const orderDoc = await getDoc(doc(firestore, \"orders\", orderId));\n    \n    if (!orderDoc.exists()) {\n      return null;\n    }\n\n    return {\n      id: orderDoc.id,\n      ...orderDoc.data(),\n    } as Order;\n  } catch (error) {\n    if (import.meta.env.DEV) {\n      console.error(\"Get order by id error:\", error);\n    }\n    throw error;\n  }\n};\n\n/**\n * Sipari kalemlerini al\n */\nexport const getOrderItems = async (orderId: string): Promise<OrderItem[]> => {\n  try {\n    const snapshot = await getDocs(collection(firestore, \"orders\", orderId, \"items\"));\n    return snapshot.docs.map((doc) => ({\n      id: doc.id,\n      ...doc.data(),\n    })) as OrderItem[];\n  } catch (error) {\n    if (import.meta.env.DEV) {\n      console.error(\"Get order items error:\", error);\n    }\n    throw error;\n  }\n};\n\n/**\n * Sipari kalemini gncelle\n */\nexport const updateOrderItem = async (\n  orderId: string,\n  itemId: string,\n  updates: Partial<Omit<OrderItem, \"id\">>,\n  userId?: string\n): Promise<void> => {\n  try {\n    // Eski veriyi al\n    const itemDoc = await getDoc(doc(firestore, \"orders\", orderId, \"items\", itemId));\n    const oldItem = itemDoc.data() as OrderItem | undefined;\n    \n    await updateDoc(doc(firestore, \"orders\", orderId, \"items\", itemId), updates);\n    \n    // Audit log\n    if (userId) {\n      const newItem = { ...oldItem, ...updates } as OrderItem;\n      await logAudit(\n        \"UPDATE\",\n        \"order_items\",\n        itemId,\n        userId,\n        oldItem || null,\n        newItem,\n        { orderId }\n      );\n    }\n  } catch (error) {\n    if (import.meta.env.DEV) {\n      console.error(\"Update order item error:\", error);\n    }\n    throw error;\n  }\n};\n\n/**\n * Yeni sipari olutur\n */\nexport const createOrder = async (\n  orderData: Omit<Order, \"id\" | \"createdAt\" | \"updatedAt\"> & { deductMaterials?: boolean },\n  items?: Omit<OrderItem, \"id\">[]\n): Promise<Order> => {\n  try {\n    const docRef = await addDoc(collection(firestore, \"orders\"), {\n      ...orderData,\n      createdAt: serverTimestamp(),\n      updatedAt: serverTimestamp(),\n    });\n\n    // Sipari kalemlerini batch write ile ekle (optimize edildi)\n    if (items && items.length > 0) {\n      const batch = writeBatch(firestore);\n      const itemsCollection = collection(firestore, \"orders\", docRef.id, \"items\");\n      \n      // Tm item'lar batch'e ekle\n      const itemRefs: string[] = [];\n      for (const item of items) {\n        const itemRef = doc(itemsCollection);\n        batch.set(itemRef, item);\n        itemRefs.push(itemRef.id);\n      }\n      \n      // Batch'i commit et\n      await batch.commit();\n      \n      // Audit log'lar toplu olarak ekle (paralel)\n      if (orderData.createdBy && itemRefs.length > 0) {\n        await Promise.all(\n          itemRefs.map((itemId, index) =>\n            logAudit(\n              \"CREATE\",\n              \"order_items\",\n              itemId,\n              orderData.createdBy,\n              null,\n              items[index],\n              { orderId: docRef.id }\n            ).catch((error) => {\n              // Audit log hatas sipari oluturmay engellemez\n              if (import.meta.env.DEV) {\n                console.error(`Audit log error for item ${itemId}:`, error);\n              }\n            })\n          )\n        );\n      }\n    }\n\n    // Gereksiz re-fetch kaldrld - order' direkt olutur\n    const createdOrder: Order = {\n      id: docRef.id,\n      ...orderData,\n      createdAt: Timestamp.now(),\n      updatedAt: Timestamp.now(),\n    } as Order;\n\n    // Hammadde drme kontrol: PROD- ile balayan sipariler veya deductMaterials=true olan sipariler\n    const isProductionOrder = orderData.orderNumber?.startsWith(\"PROD-\") || orderData.order_number?.startsWith(\"PROD-\");\n    const shouldDeductMaterials = isProductionOrder || orderData.deductMaterials === true;\n    \n    if (shouldDeductMaterials && items && items.length > 0) {\n      try {\n        const { getProductRecipes } = await import(\"@/services/firebase/recipeService\");\n        const { getRawMaterialById, updateRawMaterial, addMaterialTransaction } = await import(\"@/services/firebase/materialService\");\n        \n        // Tm reeteleri paralel olarak topla\n        const allRecipePromises = items\n          .filter(item => item.product_id || item.productId)\n          .map(async (item) => {\n            const productId = item.product_id || item.productId;\n            const quantity = item.quantity || 1;\n            const recipes = await getProductRecipes(productId);\n            return recipes.map(recipe => ({\n              recipe,\n              quantity,\n              productName: item.product_name || 'rn',\n              item,\n            }));\n          });\n        \n        const allRecipeArrays = await Promise.all(allRecipePromises);\n        const allRecipes = allRecipeArrays.flat();\n        \n        // Tm material'lar paralel olarak ek\n        const materialIds = [...new Set(allRecipes.map(r => r.recipe.rawMaterialId).filter(Boolean))];\n        const materialPromises = materialIds.map(id => getRawMaterialById(id!));\n        const materials = await Promise.all(materialPromises);\n        const materialMap = new Map(materials.filter(Boolean).map(m => [m!.id, m!]));\n        \n        // Material gncellemelerini ve transaction'lar hazrla\n        const materialUpdates: Array<{\n          materialId: string;\n          newStock: number;\n          totalQuantity: number;\n          reason: string;\n        }> = [];\n        \n        // Her reete iin gncelleme bilgilerini topla\n        for (const { recipe, quantity, productName } of allRecipes) {\n          if (recipe.rawMaterialId) {\n            const material = materialMap.get(recipe.rawMaterialId);\n            if (material) {\n              const totalQuantity = recipe.quantityPerUnit * quantity;\n              \n              // Stok kontrol\n              if (material.currentStock < totalQuantity) {\n                if (import.meta.env.DEV) {\n                  console.warn(`Yetersiz stok: ${material.name} iin ${totalQuantity} gerekli, ${material.currentStock} mevcut`);\n                }\n              }\n              \n              const newStock = Math.max(0, material.currentStock - totalQuantity);\n              \n              // Ayn material iin miktarlar topla (eer birden fazla reete varsa)\n              const existingUpdate = materialUpdates.find(u => u.materialId === recipe.rawMaterialId);\n              if (existingUpdate) {\n                existingUpdate.newStock = Math.max(0, existingUpdate.newStock - totalQuantity);\n                existingUpdate.totalQuantity += totalQuantity;\n              } else {\n                materialUpdates.push({\n                  materialId: recipe.rawMaterialId,\n                  newStock,\n                  totalQuantity,\n                  reason: `${isProductionOrder ? 'retim siparii' : 'Sipari'}: ${orderData.orderNumber || docRef.id} - ${productName} (${quantity} adet)`,\n                });\n              }\n            }\n          }\n        }\n        \n        // Tm material gncellemelerini paralel yap\n        await Promise.all(\n          materialUpdates.map(async (update) => {\n            try {\n              await updateRawMaterial(update.materialId, {\n                currentStock: update.newStock,\n              });\n              \n              // Stok hareketi kayd ekle (stok zaten gncellendi, skipStockUpdate: true)\n              await addMaterialTransaction({\n                materialId: update.materialId,\n                type: \"out\",\n                quantity: update.totalQuantity,\n                reason: update.reason,\n                relatedOrderId: docRef.id,\n                createdBy: orderData.createdBy,\n              }, true); // skipStockUpdate: true - stok zaten gncellendi\n            } catch (error) {\n              // Bir material gncellemesi hatas dierlerini engellemez\n              if (import.meta.env.DEV) {\n                console.error(`Material update error for ${update.materialId}:`, error);\n              }\n            }\n          })\n        );\n      } catch (error) {\n        if (import.meta.env.DEV) {\n          console.error(\"Hammadde stok drme hatas:\", error);\n        }\n        // Hata olsa bile sipari oluturulmu olacak, sadece log\n      }\n    }\n\n    // Audit log\n    await logAudit(\"CREATE\", \"orders\", docRef.id, orderData.createdBy, null, createdOrder);\n\n    // Aktivite log ekle\n    if (orderData.createdBy) {\n      try {\n        const { getUserProfile } = await import(\"@/services/firebase/authService\");\n        const userProfile = await getUserProfile(orderData.createdBy);\n        const userName = userProfile?.fullName || userProfile?.displayName || userProfile?.email;\n        const userEmail = userProfile?.email;\n        \n        await addOrderActivity(\n          docRef.id,\n          orderData.createdBy,\n          \"created\",\n          `bu siparii oluturdu`,\n          { orderNumber: orderData.orderNumber || orderData.order_number },\n          userName,\n          userEmail\n        );\n      } catch (error) {\n        if (import.meta.env.DEV) {\n          console.error(\"Add order activity error:\", error);\n        }\n      }\n    }\n\n    return createdOrder;\n  } catch (error) {\n    if (import.meta.env.DEV) {\n      console.error(\"Create order error:\", error);\n    }\n    throw error;\n  }\n};\n\n/**\n * Sipari durumu gei validasyonu\n */\nconst isValidStatusTransition = (currentStatus: string, newStatus: string): boolean => {\n  const validTransitions: Record<string, string[]> = {\n    draft: [\"pending\", \"cancelled\"],\n    pending: [\"confirmed\", \"cancelled\"],\n    confirmed: [\"in_production\", \"on_hold\", \"cancelled\"],\n    planned: [\"in_production\", \"pending\", \"on_hold\", \"cancelled\"], // Production order iin\n    in_production: [\"quality_check\", \"completed\", \"on_hold\", \"cancelled\"],\n    quality_check: [\"completed\", \"in_production\", \"on_hold\", \"cancelled\"],\n    completed: [], // retim siparileri iin tamamland durumundan sonra gei yok\n    on_hold: [\"in_production\", \"cancelled\"],\n    shipped: [\"delivered\"],\n    delivered: [\"completed\", \"quality_check\", \"in_production\"],\n    cancelled: [],\n  };\n\n  const allowedStatuses = validTransitions[currentStatus] || [];\n  return allowedStatuses.includes(newStatus);\n};\n\n/**\n * Siparii gncelle\n */\nexport const updateOrder = async (\n  orderId: string,\n  updates: Partial<Omit<Order, \"id\" | \"createdAt\" | \"createdBy\">>,\n  userId?: string,\n  skipStatusValidation?: boolean\n): Promise<void> => {\n  try {\n    // Eski veriyi al\n    const oldOrder = await getOrderById(orderId);\n    \n    if (!oldOrder) {\n      throw new Error(\"Sipari bulunamad\");\n    }\n\n    // Status deiiklii varsa validasyon yap (st yneticiler iin atlanabilir)\n    if (updates.status && updates.status !== oldOrder.status) {\n      // st yneticiler iin validasyonu atla\n      if (!skipStatusValidation && !isValidStatusTransition(oldOrder.status, updates.status)) {\n        throw new Error(\n          `Geersiz durum geii: ${oldOrder.status}  ${updates.status}. ` +\n          `Geerli geiler: ${getValidStatusTransitions(oldOrder.status).join(\", \")}`\n        );\n      }\n    }\n    \n    // Status deiiklii varsa statusUpdatedBy ve statusUpdatedAt ekle\n    const updateData: Partial<Order> & { statusUpdatedBy?: string; statusUpdatedAt?: FieldValue | Timestamp } = {\n      ...updates,\n      updatedAt: serverTimestamp() as any,\n    };\n    \n    if (updates.status && updates.status !== oldOrder.status && userId) {\n      updateData.statusUpdatedBy = userId;\n      updateData.statusUpdatedAt = serverTimestamp() as any;\n    }\n    \n    await updateDoc(doc(firestore, \"orders\", orderId), updateData);\n    \n    // Yeni veriyi al\n    const newOrder = await getOrderById(orderId);\n    \n    // Audit log\n    if (userId) {\n      await logAudit(\"UPDATE\", \"orders\", orderId, userId, oldOrder, newOrder);\n    }\n\n    // Aktivite log ekle\n    if (userId) {\n      try {\n        const { getUserProfile } = await import(\"@/services/firebase/authService\");\n        const userProfile = await getUserProfile(userId);\n        const userName = userProfile?.fullName || userProfile?.displayName || userProfile?.email;\n        const userEmail = userProfile?.email;\n\n        // Durum deiiklii aktivitesi\n        if (updates.status && updates.status !== oldOrder.status) {\n          const statusLabels: Record<string, string> = {\n            draft: \"Taslak\",\n            pending: \"Beklemede\",\n            confirmed: \"Onayland\",\n            planned: \"Planlanan\",\n            in_production: \"retimde\",\n            quality_check: \"Kalite Kontrol\",\n            completed: \"Tamamland\",\n            shipped: \"Kargoda\",\n            delivered: \"Teslim Edildi\",\n            on_hold: \"Beklemede\",\n            cancelled: \"ptal\",\n          };\n          const oldStatusLabel = statusLabels[oldOrder.status] || oldOrder.status;\n          const newStatusLabel = statusLabels[updates.status] || updates.status;\n          await addOrderActivity(\n            orderId,\n            userId,\n            \"status_changed\",\n            `bu siparii ${oldStatusLabel} durumundan ${newStatusLabel} durumuna tad`,\n            { oldStatus: oldOrder.status, newStatus: updates.status },\n            userName,\n            userEmail\n          );\n        } else {\n          // Genel gncelleme aktivitesi\n          const changedFields = Object.keys(updates).filter(key => {\n            const oldValue = (oldOrder as unknown as Record<string, unknown>)[key];\n            const newValue = (updates as Record<string, unknown>)[key];\n            return oldValue !== newValue;\n          });\n          \n          if (changedFields.length > 0) {\n            await addOrderActivity(\n              orderId,\n              userId,\n              \"updated\",\n              `bu siparii gncelledi`,\n              { changedFields },\n              userName,\n              userEmail\n            );\n          }\n        }\n      } catch (error) {\n        // Aktivite log hatas ana ilemi etkilememeli\n        console.error(\"Add order activity error:\", error);\n      }\n    }\n\n    // Siparii tanmlayan kiiye bildirim gnder (gncelleyen kii hari)\n    if (oldOrder.createdBy && oldOrder.createdBy !== userId) {\n      try {\n        const { createNotification } = await import(\"@/services/firebase/notificationService\");\n        const { getUserProfile } = await import(\"@/services/firebase/authService\");\n        \n        const updaterProfile = userId ? await getUserProfile(userId) : null;\n        const updaterName = updaterProfile?.fullName || updaterProfile?.displayName || updaterProfile?.email || \"Bir kullanc\";\n        \n        let message = `\"${oldOrder.orderNumber || oldOrder.order_number || orderId}\" siparii gncellendi.`;\n        \n        // Status deiiklii varsa zel mesaj\n        if (updates.status && updates.status !== oldOrder.status) {\n          const statusLabels: Record<string, string> = {\n            draft: \"Taslak\",\n            pending: \"Beklemede\",\n            confirmed: \"Onayland\",\n            in_production: \"retimde\",\n            quality_check: \"Kalite Kontrol\",\n            completed: \"Tamamland\",\n            shipped: \"Kargoda\",\n            delivered: \"Teslim Edildi\",\n            cancelled: \"ptal\",\n            on_hold: \"Beklemede\",\n          };\n          const oldStatusLabel = statusLabels[oldOrder.status] || oldOrder.status;\n          const newStatusLabel = statusLabels[updates.status] || updates.status;\n          const updateTime = new Date().toLocaleString('tr-TR', { day: 'numeric', month: 'long', year: 'numeric', hour: '2-digit', minute: '2-digit' });\n          message = `\"${oldOrder.orderNumber || oldOrder.order_number || orderId}\" sipari numaral sipariin durumu \"${oldStatusLabel}\" durumundan \"${newStatusLabel}\" durumuna gncellendi.\\n\\nlem Zaman: ${updateTime}`;\n        } else {\n          const updateTime = new Date().toLocaleString('tr-TR', { day: 'numeric', month: 'long', year: 'numeric', hour: '2-digit', minute: '2-digit' });\n          message = `\"${oldOrder.orderNumber || oldOrder.order_number || orderId}\" sipari numaral sipari gncellendi.\\n\\nlem Zaman: ${updateTime}`;\n        }\n        \n        await createNotification({\n          userId: oldOrder.createdBy,\n          type: \"order_updated\",\n          title: \"Sipariiniz gncellendi\",\n          message: `${updaterName} kullancs tarafndan ${message}`,\n          read: false,\n          relatedId: orderId,\n          metadata: { \n            updatedBy: userId,\n            statusChanged: updates.status && updates.status !== oldOrder.status,\n            oldStatus: oldOrder.status,\n            newStatus: updates.status || oldOrder.status,\n            updatedAt: new Date(),\n          },\n        });\n      } catch (notifError) {\n        console.error(\"Sipari gncelleme bildirimi gnderilemedi:\", notifError);\n        // Bildirim hatas sipari gncellemesini engellemez\n      }\n    }\n  } catch (error) {\n    console.error(\"Update order error:\", error);\n    throw error;\n  }\n};\n\n/**\n * Sipari tamamlanma onay iste\n */\nexport const requestOrderCompletion = async (\n  orderId: string,\n  userId: string\n): Promise<void> => {\n  try {\n    // Eski veriyi al\n    const oldOrder = await getOrderById(orderId);\n    \n    await updateDoc(doc(firestore, \"orders\", orderId), {\n      approvalStatus: \"pending\",\n      approvalRequestedBy: userId,\n      approvalRequestedAt: serverTimestamp(),\n      updatedAt: serverTimestamp(),\n    });\n    \n    // Audit log\n    if (userId) {\n      const newOrder = await getOrderById(orderId);\n      await logAudit(\n        \"UPDATE\",\n        \"orders\",\n        orderId,\n        userId,\n        oldOrder,\n        newOrder,\n        { action: \"request_completion\", approvalStatus: \"pending\" }\n      );\n    }\n    \n    // Opsiyonel: Bildirim gnderilebilir\n  } catch (error) {\n    console.error(\"Request order completion error:\", error);\n    throw error;\n  }\n};\n\n/**\n * Sipari tamamlanmasn onayla\n */\nexport const approveOrderCompletion = async (\n  orderId: string,\n  userId: string\n): Promise<void> => {\n  try {\n    // Eski veriyi al\n    const oldOrder = await getOrderById(orderId);\n    \n    await updateDoc(doc(firestore, \"orders\", orderId), {\n      status: \"completed\",\n      approvalStatus: \"approved\",\n      approvedBy: userId,\n      approvedAt: serverTimestamp(),\n      updatedAt: serverTimestamp(),\n    });\n    \n    // Audit log\n    if (userId) {\n      const newOrder = await getOrderById(orderId);\n      await logAudit(\n        \"UPDATE\",\n        \"orders\",\n        orderId,\n        userId,\n        oldOrder,\n        newOrder,\n        { action: \"approve_completion\", approvalStatus: \"approved\" }\n      );\n    }\n    \n    // Opsiyonel: Bildirim\n  } catch (error) {\n    console.error(\"Approve order completion error:\", error);\n    throw error;\n  }\n};\n\n/**\n * Sipari tamamlanmasn reddet\n */\nexport const rejectOrderCompletion = async (\n  orderId: string,\n  userId: string,\n  reason?: string\n): Promise<void> => {\n  try {\n    // Eski veriyi al\n    const oldOrder = await getOrderById(orderId);\n    \n    await updateDoc(doc(firestore, \"orders\", orderId), {\n      status: \"in_production\", // Geri dndr\n      approvalStatus: \"rejected\",\n      rejectedBy: userId,\n      rejectedAt: serverTimestamp(),\n      rejectionReason: reason || null,\n      updatedAt: serverTimestamp(),\n    });\n    \n    // Audit log\n    if (userId) {\n      const newOrder = await getOrderById(orderId);\n      await logAudit(\n        \"UPDATE\",\n        \"orders\",\n        orderId,\n        userId,\n        oldOrder,\n        newOrder,\n        { action: \"reject_completion\", approvalStatus: \"rejected\", reason: reason || null }\n      );\n    }\n    \n    // Opsiyonel: Bildirim\n  } catch (error) {\n    console.error(\"Reject order completion error:\", error);\n    throw error;\n  }\n};\n\n/**\n * Geerli durum geilerini al\n */\nexport const getValidStatusTransitions = (currentStatus: string): string[] => {\n  const validTransitions: Record<string, string[]> = {\n    draft: [\"pending\", \"cancelled\"],\n    pending: [\"confirmed\", \"cancelled\"],\n    confirmed: [\"in_production\", \"on_hold\", \"cancelled\"],\n    planned: [\"in_production\", \"pending\", \"on_hold\", \"cancelled\"], // Production order iin\n    in_production: [\"quality_check\", \"completed\", \"on_hold\", \"cancelled\"],\n    quality_check: [\"completed\", \"in_production\", \"on_hold\", \"cancelled\"],\n    completed: [], // retim siparileri iin tamamland durumundan sonra gei yok\n    on_hold: [\"in_production\", \"cancelled\"],\n    shipped: [\"delivered\"],\n    delivered: [\"completed\", \"quality_check\", \"in_production\"],\n    cancelled: [],\n  };\n\n  return validTransitions[currentStatus] || [];\n};\n\n/**\n * Sipari durumunu gncelle (validasyon ile)\n */\nexport const updateOrderStatus = async (\n  orderId: string,\n  newStatus: Order[\"status\"],\n  userId?: string\n): Promise<void> => {\n  try {\n    await updateOrder(orderId, { status: newStatus }, userId);\n  } catch (error) {\n    console.error(\"Update order status error:\", error);\n    throw error;\n  }\n};\n\n/**\n * Siparii sil\n */\nexport const deleteOrder = async (orderId: string, userId?: string): Promise<void> => {\n  try {\n    // Eski veriyi al\n    const oldOrder = await getOrderById(orderId);\n    \n    // Aktivite log ekle (silmeden nce)\n    if (userId && oldOrder) {\n      try {\n        const { getUserProfile } = await import(\"@/services/firebase/authService\");\n        const userProfile = await getUserProfile(userId);\n        const userName = userProfile?.fullName || userProfile?.displayName || userProfile?.email;\n        const userEmail = userProfile?.email;\n        \n        await addOrderActivity(\n          orderId,\n          userId,\n          \"deleted\",\n          `bu siparii sildi`,\n          { orderNumber: oldOrder.orderNumber || oldOrder.order_number },\n          userName,\n          userEmail\n        );\n      } catch (error) {\n        if (import.meta.env.DEV) {\n          console.error(\"Add order activity error:\", error);\n        }\n      }\n    }\n    \n    await deleteDoc(doc(firestore, \"orders\", orderId));\n    \n    // Audit log\n    if (userId) {\n      await logAudit(\"DELETE\", \"orders\", orderId, userId, oldOrder, null);\n    }\n  } catch (error) {\n    console.error(\"Delete order error:\", error);\n    throw error;\n  }\n};\n\n/**\n * Siparileri gerek zamanl olarak dinle\n * @param filters Sipari filtreleri\n * @param callback Sipariler deitiinde arlacak callback\n * @returns Unsubscribe fonksiyonu\n */\nexport const subscribeToOrders = (\n  filters: {\n    customerId?: string;\n    status?: string;\n  } = {},\n  callback: (orders: Order[]) => void\n): Unsubscribe => {\n  try {\n    const ordersRef = collection(firestore, \"orders\");\n    \n    const buildQuery = () => {\n      const constraints: QueryConstraint[] = [orderBy(\"createdAt\", \"desc\")];\n      \n      if (filters?.customerId) {\n        constraints.push(where(\"customerId\", \"==\", filters.customerId));\n      }\n      \n      if (filters?.status) {\n        constraints.push(where(\"status\", \"==\", filters.status));\n      }\n      \n      return query(ordersRef, ...constraints);\n    };\n    \n    let q = buildQuery();\n    \n    // onSnapshot ile gerek zamanl dinleme\n    const unsubscribe = onSnapshot(\n      q,\n      (snapshot) => {\n        try {\n          let orders = snapshot.docs.map((doc) => ({\n            id: doc.id,\n            ...doc.data(),\n          })) as Order[];\n          \n          // Client-side filtreleme (index hatas durumunda)\n          if (filters?.customerId) {\n            orders = orders.filter(o => o.customerId === filters.customerId);\n          }\n          if (filters?.status) {\n            orders = orders.filter(o => o.status === filters.status);\n          }\n          \n          callback(orders);\n        } catch (error) {\n          console.error(\"Subscribe to orders error:\", error);\n          callback([]);\n        }\n      },\n      (error) => {\n        // 404 ve network hatalarn sessizce handle et (Firestore otomatik yeniden balanacak)\n        // Production'da da sessizce handle et - bu normal Firestore long-polling davran\n        if (error?.code === 'unavailable' || \n            error?.code === 'not-found' ||\n            error?.message?.includes('404') || \n            error?.message?.includes('network') ||\n            error?.message?.includes('transport errored')) {\n          // Sessizce handle et - Firestore otomatik olarak yeniden balanacak\n          // Production'da console'a yazma (performans ve grlt azaltma)\n          callback([]);\n          return;\n        }\n        \n        // Sadece gerek hatalar logla\n        if (import.meta.env.DEV) {\n          console.error(\"Orders snapshot error:\", error);\n        }\n        // Index hatas durumunda basit query dene\n        if (error?.code === 'failed-precondition' || error?.message?.includes('index')) {\n          try {\n            const simpleQuery = query(ordersRef, orderBy(\"createdAt\", \"desc\"));\n            const fallbackUnsubscribe = onSnapshot(\n              simpleQuery,\n              (snapshot) => {\n                try {\n                  let orders = snapshot.docs.map((doc) => ({\n                    id: doc.id,\n                    ...doc.data(),\n                  })) as Order[];\n                  \n                  // Client-side filtreleme\n                  if (filters?.customerId) {\n                    orders = orders.filter(o => o.customerId === filters.customerId);\n                  }\n                  if (filters?.status) {\n                    orders = orders.filter(o => o.status === filters.status);\n                  }\n                  \n                  callback(orders);\n                } catch (err) {\n                  console.error(\"Fallback subscribe to orders error:\", err);\n                  callback([]);\n                }\n              },\n              (err) => {\n                console.error(\"Fallback orders snapshot error:\", err);\n                callback([]);\n              }\n            );\n            return fallbackUnsubscribe;\n          } catch (fallbackError) {\n            console.error(\"Fallback query setup error:\", fallbackError);\n            callback([]);\n          }\n        } else {\n          callback([]);\n        }\n      }\n    );\n    \n    return unsubscribe;\n  } catch (error: unknown) {\n    if (import.meta.env.DEV) {\n      console.error(\"Subscribe to orders setup error:\", error);\n    }\n    return () => {};\n  }\n};\n\n// Order Comments and Activities\n\nexport interface OrderComment {\n  id: string;\n  orderId: string;\n  userId: string;\n  userName?: string;\n  userEmail?: string;\n  content: string;\n  createdAt: Timestamp;\n  updatedAt?: Timestamp | null;\n}\n\nexport interface OrderActivity {\n  id: string;\n  orderId: string;\n  userId: string;\n  userName?: string;\n  userEmail?: string;\n  action: string;\n  description: string;\n  metadata?: Record<string, any>;\n  createdAt: Timestamp;\n}\n\n/**\n * Sipari yorumu ekle\n */\nexport const addOrderComment = async (\n  orderId: string,\n  userId: string,\n  content: string,\n  userName?: string,\n  userEmail?: string\n): Promise<OrderComment> => {\n  try {\n    const commentData: Omit<OrderComment, \"id\"> = {\n      orderId,\n      userId,\n      userName,\n      userEmail,\n      content,\n      createdAt: Timestamp.now(),\n      updatedAt: null,\n    };\n\n    const docRef = await addDoc(\n      collection(firestore, \"orders\", orderId, \"comments\"),\n      commentData\n    );\n\n    // Activity log ekle\n    await addOrderActivity(orderId, userId, \"commented\", `yorum ekledi`, { commentId: docRef.id }, userName, userEmail);\n\n    // Siparii oluturan kiiye bildirim gnder (yorum ekleyen kii hari)\n    try {\n      const order = await getOrderById(orderId);\n      if (order?.createdBy && order.createdBy !== userId) {\n        const { createNotification } = await import(\"@/services/firebase/notificationService\");\n        await createNotification({\n          userId: order.createdBy,\n          type: \"comment_added\",\n          title: \"Sipariinize Yorum Eklendi\",\n          message: `${userName || userEmail || \"Bir kullanc\"} \"${order.orderNumber || order.order_number || orderId}\" sipariinize yorum ekledi: ${content.substring(0, 100)}${content.length > 100 ? \"...\" : \"\"}`,\n          read: false,\n          relatedId: orderId,\n          metadata: { commentId: docRef.id, commenterId: userId, commenterName: userName, commenterEmail: userEmail },\n        });\n      }\n    } catch (error) {\n      // Bildirim hatas ana ilemi etkilememeli\n      console.error(\"Send comment notification error:\", error);\n    }\n\n    return {\n      id: docRef.id,\n      ...commentData,\n    };\n  } catch (error) {\n    console.error(\"Add order comment error:\", error);\n    throw error;\n  }\n};\n\n/**\n * Sipari yorumlarn al\n */\nexport const getOrderComments = async (orderId: string): Promise<OrderComment[]> => {\n  try {\n    const snapshot = await getDocs(\n      query(\n        collection(firestore, \"orders\", orderId, \"comments\"),\n        orderBy(\"createdAt\", \"desc\")\n      )\n    );\n    return snapshot.docs.map((doc) => ({\n      id: doc.id,\n      ...doc.data(),\n    })) as OrderComment[];\n  } catch (error) {\n    console.error(\"Get order comments error:\", error);\n    throw error;\n  }\n};\n\n/**\n * Sipari aktivite log ekle\n */\nexport const addOrderActivity = async (\n  orderId: string,\n  userId: string,\n  action: string,\n  description: string,\n  metadata?: Record<string, any>,\n  userName?: string,\n  userEmail?: string\n): Promise<string> => {\n  try {\n    const activityData: Omit<OrderActivity, \"id\"> = {\n      orderId,\n      userId,\n      userName,\n      userEmail,\n      action,\n      description,\n      metadata: metadata || {},\n      createdAt: Timestamp.now(),\n    };\n\n    const docRef = await addDoc(\n      collection(firestore, \"orders\", orderId, \"activities\"),\n      activityData\n    );\n\n    return docRef.id;\n  } catch (error) {\n    if (import.meta.env.DEV) {\n      console.error(\"Add order activity error:\", error);\n    }\n    return \"\";\n  }\n};\n\n/**\n * Sipari aktivite loglarn al\n */\nexport const getOrderActivities = async (orderId: string): Promise<OrderActivity[]> => {\n  try {\n    const snapshot = await getDocs(\n      query(\n        collection(firestore, \"orders\", orderId, \"activities\"),\n        orderBy(\"createdAt\", \"desc\")\n      )\n    );\n    return snapshot.docs.map((doc) => ({\n      id: doc.id,\n      ...doc.data(),\n    })) as OrderActivity[];\n  } catch (error) {\n    console.error(\"Get order activities error:\", error);\n    throw error;\n  }\n};","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\services\\firebase\\productService.ts","messages":[{"ruleId":"prefer-const","severity":2,"message":"'products' is never reassigned. Use 'const' instead.","line":69,"column":13,"nodeType":"Identifier","messageId":"useConst","endLine":69,"endColumn":21,"fix":{"range":[1964,2081],"text":"const products = snapshot.docs.map((doc) => ({\n          id: doc.id,\n          ...doc.data(),\n        })) as Product[];"}},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":320,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":320,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8585,8588],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8585,8588],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":417,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":417,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11184,11187],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11184,11187],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":1,"fixableWarningCount":0,"source":"/**\n * Firebase Product Service\n * rn ynetimi ilemleri\n */\n\nimport {\n  collection,\n  doc,\n  getDoc,\n  getDocs,\n  addDoc,\n  updateDoc,\n  deleteDoc,\n  query,\n  orderBy,\n  limit,\n  serverTimestamp,\n  Timestamp,\n} from \"firebase/firestore\";\nimport { firestore } from \"@/lib/firebase\";\nimport { logAudit } from \"@/utils/auditLogger\";\n\nexport interface Product {\n  id: string;\n  name: string;\n  sku?: string | null; // Stock Keeping Unit\n  code?: string | null;\n  description?: string | null;\n  unitPrice?: number | null;\n  price?: number | null; // Alias for unitPrice\n  cost?: number | null;\n  unit: string; // 'adet', 'kg', 'm', vb.\n  stock?: number;\n  minStock?: number | null;\n  maxStock?: number | null;\n  category?: string | null;\n  imageUrl?: string | null;\n  image_url?: string | null; // Alias for imageUrl\n  location?: string | null;\n  createdAt: Timestamp;\n  updatedAt: Timestamp;\n  createdBy: string;\n}\n\n/**\n * Tm rnleri listele\n */\nexport const getProducts = async (): Promise<Product[]> => {\n  try {\n    // Performans iin limit ekle (500 kayt)\n    const q = query(collection(firestore, \"products\"), orderBy(\"createdAt\", \"desc\"), limit(500));\n    const snapshot = await getDocs(q);\n    return snapshot.docs.map((doc) => ({\n      id: doc.id,\n      ...doc.data(),\n    })) as Product[];\n  } catch (error: unknown) {\n    // Index hatas durumunda basit query dene\n    const errorMessage = error instanceof Error ? error.message : String(error);\n    const errorCode = (error as { code?: string })?.code;\n    if (errorCode === 'failed-precondition' || errorMessage.includes('index') || errorMessage.includes('requires an index')) {\n      if (import.meta.env.DEV) {\n        console.warn(\"Products index bulunamad, basit query kullanlyor\");\n      }\n      try {\n        // Index olmadan sralama yapmadan dene\n        const simpleQuery = query(collection(firestore, \"products\"), limit(500));\n        const snapshot = await getDocs(simpleQuery);\n        let products = snapshot.docs.map((doc) => ({\n          id: doc.id,\n          ...doc.data(),\n        })) as Product[];\n        \n        // Client-side sralama\n        products.sort((a, b) => {\n          const aDate = a.createdAt?.toMillis() || 0;\n          const bDate = b.createdAt?.toMillis() || 0;\n          return bDate - aDate;\n        });\n        \n        return products;\n      } catch (fallbackError) {\n        if (import.meta.env.DEV) {\n          console.error(\"Fallback query de baarsz:\", fallbackError);\n        }\n        // Son are: bo array dndr\n        return [];\n      }\n    }\n    // Sadece development'ta log gster\n    if (import.meta.env.DEV) {\n      console.error(\"Get products error:\", error);\n    }\n    throw error;\n  }\n};\n\n/**\n * rn detayn al\n */\nexport const getProductById = async (productId: string): Promise<Product | null> => {\n  try {\n    const productDoc = await getDoc(doc(firestore, \"products\", productId));\n    \n    if (!productDoc.exists()) {\n      return null;\n    }\n\n    return {\n      id: productDoc.id,\n      ...productDoc.data(),\n    } as Product;\n  } catch (error) {\n    // Sadece development'ta log gster\n    if (import.meta.env.DEV) {\n      if (import.meta.env.DEV) {\n        console.error(\"Get product by id error:\", error);\n      }\n    }\n    throw error;\n  }\n};\n\n/**\n * Yeni rn olutur\n */\nexport const createProduct = async (\n  productData: Omit<Product, \"id\" | \"createdAt\" | \"updatedAt\">\n): Promise<Product> => {\n  try {\n    const docRef = await addDoc(collection(firestore, \"products\"), {\n      ...productData,\n      createdAt: serverTimestamp(),\n      updatedAt: serverTimestamp(),\n    });\n\n    const createdProduct = await getProductById(docRef.id);\n    if (!createdProduct) {\n      throw new Error(\"rn oluturulamad\");\n    }\n\n    // Audit log\n    await logAudit(\"CREATE\", \"products\", docRef.id, productData.createdBy, null, createdProduct);\n\n    // Aktivite log ekle\n    if (productData.createdBy) {\n      try {\n        const { getUserProfile } = await import(\"./authService\");\n        const userProfile = await getUserProfile(productData.createdBy);\n        const userName = userProfile?.fullName || userProfile?.displayName || userProfile?.email;\n        const userEmail = userProfile?.email;\n        \n        await addProductActivity(\n          docRef.id,\n          productData.createdBy,\n          \"created\",\n          `bu rn oluturdu`,\n          { productName: productData.name },\n          userName,\n          userEmail\n        );\n      } catch (error) {\n        if (import.meta.env.DEV) {\n          if (import.meta.env.DEV) {\n            console.error(\"Add product activity error:\", error);\n          }\n        }\n      }\n    }\n\n    return createdProduct;\n  } catch (error) {\n    // Sadece development'ta log gster\n    if (import.meta.env.DEV) {\n      if (import.meta.env.DEV) {\n        console.error(\"Create product error:\", error);\n      }\n    }\n    throw error;\n  }\n};\n\n/**\n * rn gncelle\n */\nexport const updateProduct = async (\n  productId: string,\n  updates: Partial<Omit<Product, \"id\" | \"createdAt\" | \"createdBy\">>,\n  userId?: string\n): Promise<void> => {\n  try {\n    // Eski veriyi al\n    const oldProduct = await getProductById(productId);\n    \n    await updateDoc(doc(firestore, \"products\", productId), {\n      ...updates,\n      updatedAt: serverTimestamp(),\n    });\n    \n    // Yeni veriyi al\n    const newProduct = await getProductById(productId);\n    \n    // Audit log\n    if (userId) {\n      await logAudit(\"UPDATE\", \"products\", productId, userId, oldProduct, newProduct);\n    }\n\n    // Aktivite log ekle\n    if (userId && oldProduct) {\n      try {\n        const { getUserProfile } = await import(\"./authService\");\n        const userProfile = await getUserProfile(userId);\n        const userName = userProfile?.fullName || userProfile?.displayName || userProfile?.email;\n        const userEmail = userProfile?.email;\n\n        const changedFields = Object.keys(updates).filter(key => {\n          const oldValue = (oldProduct as Record<string, unknown>)[key];\n          const newValue = (updates as Record<string, unknown>)[key];\n          return oldValue !== newValue;\n        });\n        \n        if (changedFields.length > 0) {\n          await addProductActivity(\n            productId,\n            userId,\n            \"updated\",\n            `bu rn gncelledi`,\n            { changedFields },\n            userName,\n            userEmail\n          );\n        }\n      } catch (error) {\n        if (import.meta.env.DEV) {\n          if (import.meta.env.DEV) {\n            console.error(\"Add product activity error:\", error);\n          }\n        }\n      }\n    }\n  } catch (error) {\n    // Sadece development'ta log gster\n    if (import.meta.env.DEV) {\n      console.error(\"Update product error:\", error);\n    }\n    throw error;\n  }\n};\n\n/**\n * rn sil\n */\nexport const deleteProduct = async (productId: string, userId?: string): Promise<void> => {\n  try {\n    // Eski veriyi al\n    const oldProduct = await getProductById(productId);\n    \n    // Aktivite log ekle (silmeden nce)\n    if (userId && oldProduct) {\n      try {\n        const { getUserProfile } = await import(\"./authService\");\n        const userProfile = await getUserProfile(userId);\n        const userName = userProfile?.fullName || userProfile?.displayName || userProfile?.email;\n        const userEmail = userProfile?.email;\n        \n        await addProductActivity(\n          productId,\n          userId,\n          \"deleted\",\n          `bu rn sildi`,\n          { productName: oldProduct.name },\n          userName,\n          userEmail\n        );\n      } catch (error) {\n        if (import.meta.env.DEV) {\n          if (import.meta.env.DEV) {\n            console.error(\"Add product activity error:\", error);\n          }\n        }\n      }\n    }\n    \n    await deleteDoc(doc(firestore, \"products\", productId));\n    \n    // Audit log\n    if (userId) {\n      await logAudit(\"DELETE\", \"products\", productId, userId, oldProduct, null);\n    }\n  } catch (error) {\n    // Sadece development'ta log gster\n    if (import.meta.env.DEV) {\n      console.error(\"Delete product error:\", error);\n    }\n    throw error;\n  }\n};\n\n// Product Comments and Activities\n\nexport interface ProductComment {\n  id: string;\n  productId: string;\n  userId: string;\n  userName?: string;\n  userEmail?: string;\n  content: string;\n  createdAt: Timestamp;\n  updatedAt?: Timestamp | null;\n}\n\nexport interface ProductActivity {\n  id: string;\n  productId: string;\n  userId: string;\n  userName?: string;\n  userEmail?: string;\n  action: string;\n  description: string;\n  metadata?: Record<string, any>;\n  createdAt: Timestamp;\n}\n\n/**\n * rn yorumu ekle\n */\nexport const addProductComment = async (\n  productId: string,\n  userId: string,\n  content: string,\n  userName?: string,\n  userEmail?: string\n): Promise<ProductComment> => {\n  try {\n    const commentData: Omit<ProductComment, \"id\"> = {\n      productId,\n      userId,\n      userName,\n      userEmail,\n      content,\n      createdAt: Timestamp.now(),\n      updatedAt: null,\n    };\n\n    const docRef = await addDoc(\n      collection(firestore, \"products\", productId, \"comments\"),\n      commentData\n    );\n\n    // Activity log ekle\n    await addProductActivity(productId, userId, \"commented\", `yorum ekledi`, { commentId: docRef.id }, userName, userEmail);\n\n    // rn oluturan kiiye bildirim gnder (yorum ekleyen kii hari)\n    try {\n      const product = await getProductById(productId);\n      if (product?.createdBy && product.createdBy !== userId) {\n        const { createNotification } = await import(\"@/services/firebase/notificationService\");\n        await createNotification({\n          userId: product.createdBy,\n          type: \"comment_added\",\n          title: \"rnnze Yorum Eklendi\",\n          message: `${userName || userEmail || \"Bir kullanc\"} \"${product.name}\" rnnze yorum ekledi: ${content.substring(0, 100)}${content.length > 100 ? \"...\" : \"\"}`,\n          read: false,\n          relatedId: productId,\n          metadata: { commentId: docRef.id, commenterId: userId, commenterName: userName, commenterEmail: userEmail },\n        });\n      }\n    } catch (error) {\n      if (import.meta.env.DEV) {\n        console.error(\"Send comment notification error:\", error);\n      }\n    }\n\n    return {\n      id: docRef.id,\n      ...commentData,\n    };\n  } catch (error) {\n    if (import.meta.env.DEV) {\n      console.error(\"Add product comment error:\", error);\n    }\n    throw error;\n  }\n};\n\n/**\n * rn yorumlarn al\n */\nexport const getProductComments = async (productId: string): Promise<ProductComment[]> => {\n  try {\n    const snapshot = await getDocs(\n      query(\n        collection(firestore, \"products\", productId, \"comments\"),\n        orderBy(\"createdAt\", \"desc\")\n      )\n    );\n    return snapshot.docs.map((doc) => ({\n      id: doc.id,\n      ...doc.data(),\n    })) as ProductComment[];\n  } catch (error) {\n    if (import.meta.env.DEV) {\n      console.error(\"Get product comments error:\", error);\n    }\n    throw error;\n  }\n};\n\n/**\n * rn aktivite log ekle\n */\nexport const addProductActivity = async (\n  productId: string,\n  userId: string,\n  action: string,\n  description: string,\n  metadata?: Record<string, any>,\n  userName?: string,\n  userEmail?: string\n): Promise<string> => {\n  try {\n    const activityData: Omit<ProductActivity, \"id\"> = {\n      productId,\n      userId,\n      userName,\n      userEmail,\n      action,\n      description,\n      metadata: metadata || {},\n      createdAt: Timestamp.now(),\n    };\n\n    const docRef = await addDoc(\n      collection(firestore, \"products\", productId, \"activities\"),\n      activityData\n    );\n\n    return docRef.id;\n  } catch (error) {\n    if (import.meta.env.DEV) {\n      console.error(\"Add product activity error:\", error);\n    }\n    return \"\";\n  }\n};\n\n/**\n * rn aktivite loglarn al\n */\nexport const getProductActivities = async (productId: string): Promise<ProductActivity[]> => {\n  try {\n    const snapshot = await getDocs(\n      query(\n        collection(firestore, \"products\", productId, \"activities\"),\n        orderBy(\"createdAt\", \"desc\")\n      )\n    );\n    return snapshot.docs.map((doc) => ({\n      id: doc.id,\n      ...doc.data(),\n    })) as ProductActivity[];\n  } catch (error) {\n    if (import.meta.env.DEV) {\n      console.error(\"Get product activities error:\", error);\n    }\n    throw error;\n  }\n};\n\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\services\\firebase\\projectService.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\services\\firebase\\recipeService.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\services\\firebase\\reportService.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\services\\firebase\\requestService.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\services\\firebase\\rolePermissionsService.ts","messages":[{"ruleId":"prefer-const","severity":2,"message":"'subPermissions' is never reassigned. Use 'const' instead.","line":357,"column":15,"nodeType":"Identifier","messageId":"useConst","endLine":357,"endColumn":45,"fix":{"range":[10085,10125],"text":"const subPermissions: SubPermissions = {};"}},{"ruleId":"prefer-const","severity":2,"message":"'subPermissions' is never reassigned. Use 'const' instead.","line":458,"column":15,"nodeType":"Identifier","messageId":"useConst","endLine":458,"endColumn":45,"fix":{"range":[14336,14376],"text":"const subPermissions: SubPermissions = {};"}},{"ruleId":"prefer-const","severity":2,"message":"'updatedSubPermissions' is never reassigned. Use 'const' instead.","line":601,"column":11,"nodeType":"Identifier","messageId":"useConst","endLine":601,"endColumn":48,"fix":{"range":[19975,20060],"text":"const updatedSubPermissions: SubPermissions = { ...(permission.subPermissions || {}) };"}}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":3,"fixableWarningCount":0,"source":"import { db } from \"@/lib/firebase\";\nimport {\n  collection,\n  doc,\n  getDocs,\n  getDoc,\n  addDoc,\n  updateDoc,\n  deleteDoc,\n  query,\n  where,\n  Timestamp,\n  setDoc,\n  writeBatch,\n  onSnapshot,\n  Unsubscribe,\n} from \"firebase/firestore\";\n\nexport interface SubPermissions {\n  [key: string]: boolean;\n}\n\nexport interface RolePermission {\n  id: string;\n  role: string;\n  resource: string;\n  canCreate: boolean;\n  canRead: boolean;\n  canUpdate: boolean;\n  canDelete: boolean;\n  subPermissions?: SubPermissions; // Alt yetkiler\n  createdAt: Timestamp;\n  updatedAt: Timestamp;\n}\n\nexport interface RoleDefinition {\n  id: string;\n  key: string;\n  label: string;\n  color: string;\n  isSystem?: boolean; // Sistem rolleri silinemez\n}\n\nconst ROLE_PERMISSIONS_COLLECTION = \"role_permissions\";\nconst ROLES_COLLECTION = \"roles\";\n\n// Permission cache configuration\nconst CACHE_TTL = 5 * 60 * 1000; // 5 dakika cache TTL\nconst cacheTimestamps = new Map<string, number>();\n\n// Permission cache for real-time updates\nconst permissionCache = new Map<string, RolePermission | null>();\nconst permissionListeners = new Map<string, Unsubscribe>();\nconst cacheCallbacks = new Set<() => void>();\n\n/**\n * Check if cache entry is expired\n */\nconst isCacheExpired = (cacheKey: string): boolean => {\n  const timestamp = cacheTimestamps.get(cacheKey);\n  if (!timestamp) return true;\n  return Date.now() - timestamp > CACHE_TTL;\n};\n\n/**\n * Update cache timestamp\n */\nconst updateCacheTimestamp = (cacheKey: string): void => {\n  cacheTimestamps.set(cacheKey, Date.now());\n};\n\n/**\n * Clear permission cache (optionally for specific role)\n */\nexport const clearPermissionCache = (role?: string): void => {\n  if (role) {\n    // Clear only specific role's cache\n    for (const key of permissionCache.keys()) {\n      if (key.startsWith(`${role}:`)) {\n        permissionCache.delete(key);\n        cacheTimestamps.delete(key);\n      }\n    }\n  } else {\n    // Clear all cache\n    permissionCache.clear();\n    cacheTimestamps.clear();\n  }\n  // Notify all callbacks\n  cacheCallbacks.forEach(callback => {\n    try {\n      callback();\n    } catch (e) {\n      // Callback hatas dierlerini etkilemesin\n    }\n  });\n};\n\n/**\n * Force refresh all permissions from Firestore\n */\nexport const forceRefreshPermissions = async (): Promise<void> => {\n  // Clear all cache\n  permissionCache.clear();\n  cacheTimestamps.clear();\n\n  // Unsubscribe all listeners\n  permissionListeners.forEach(unsubscribe => unsubscribe());\n  permissionListeners.clear();\n\n  // Notify callbacks\n  cacheCallbacks.forEach(callback => {\n    try {\n      callback();\n    } catch (e) {\n      // Ignore callback errors\n    }\n  });\n};\n\n/**\n * Subscribe to permission cache changes\n */\nexport const onPermissionCacheChange = (callback: () => void): (() => void) => {\n  cacheCallbacks.add(callback);\n  return () => {\n    cacheCallbacks.delete(callback);\n  };\n};\n\nconst RESOURCES = [\n  \"tasks\",\n  \"users\",\n  \"departments\",\n  \"orders\",\n  \"production_orders\",\n  \"customers\",\n  \"products\",\n  \"projects\",\n  \"audit_logs\",\n  \"role_permissions\",\n  \"raw_materials\",\n  \"warranty\",\n];\n\n// Default System Roles\nconst DEFAULT_ROLES: RoleDefinition[] = [\n  { id: \"super_admin\", key: \"super_admin\", label: \"Sper Ynetici\", color: \"bg-red-500\", isSystem: true },\n  { id: \"team_leader\", key: \"team_leader\", label: \"Ekip Lideri\", color: \"bg-blue-500\", isSystem: true },\n  { id: \"personnel\", key: \"personnel\", label: \"Personel\", color: \"bg-green-500\", isSystem: true },\n];\n\n/**\n * Initialize default roles if they don't exist\n */\nconst initializeDefaultRoles = async (): Promise<void> => {\n  try {\n    // Sadece authenticated kullanclar iin al\n    const { getAuth } = await import(\"firebase/auth\");\n    const { auth } = await import(\"@/lib/firebase\");\n    const currentAuth = auth || getAuth();\n\n    if (!currentAuth?.currentUser) {\n      // Giri yapmam kullanclar iin sessizce k\n      return;\n    }\n\n    const rolesRef = collection(db, ROLES_COLLECTION);\n    const snapshot = await getDocs(rolesRef);\n\n    if (snapshot.empty) {\n      for (const role of DEFAULT_ROLES) {\n        await setDoc(doc(db, ROLES_COLLECTION, role.key), role);\n      }\n    }\n  } catch (error) {\n    // Permission hatalarn sessizce handle et\n    const errorObj = error && typeof error === 'object' ? error as { code?: string; message?: string } : null;\n    if (errorObj?.code !== 'permission-denied' && !errorObj?.message?.includes('permissions')) {\n      if (import.meta.env.DEV) {\n        console.error(\"Error initializing default roles:\", error);\n      }\n    }\n  }\n};\n\n/**\n * Get all roles\n */\nexport const getRoles = async (): Promise<RoleDefinition[]> => {\n  try {\n    // Sadece authenticated kullanclar iin initializeDefaultRoles ar\n    const { getAuth } = await import(\"firebase/auth\");\n    const { auth } = await import(\"@/lib/firebase\");\n    const currentAuth = auth || getAuth();\n\n    if (currentAuth?.currentUser) {\n      await initializeDefaultRoles();\n    }\n\n    const rolesRef = collection(db, ROLES_COLLECTION);\n    const snapshot = await getDocs(rolesRef);\n    return snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() } as RoleDefinition));\n  } catch (error) {\n    // Permission hatalarn sessizce handle et\n    const errorObj = error && typeof error === 'object' ? error as { code?: string; message?: string } : null;\n    if (errorObj?.code !== 'permission-denied' && !errorObj?.message?.includes('permissions')) {\n      if (import.meta.env.DEV) {\n        console.error(\"Error getting roles:\", error);\n      }\n    }\n    return DEFAULT_ROLES;\n  }\n};\n\n/**\n * Add a new role\n */\nexport const addRole = async (role: Omit<RoleDefinition, \"id\" | \"isSystem\">): Promise<void> => {\n  try {\n    const roleKey = role.key.toLowerCase().replace(/\\s+/g, \"_\");\n    const newRole = {\n      ...role,\n      key: roleKey,\n      isSystem: false\n    };\n\n    await setDoc(doc(db, ROLES_COLLECTION, roleKey), newRole);\n\n    // Initialize permissions for the new role\n    const permissionsRef = collection(db, ROLE_PERMISSIONS_COLLECTION);\n    for (const resource of RESOURCES) {\n      // Alt yetkileri al (yeni roller iin varsaylan olarak bo)\n      const permissionData: Record<string, unknown> = {\n        role: roleKey,\n        resource,\n        canCreate: false,\n        canRead: true, // Default read access\n        canUpdate: false,\n        canDelete: false,\n        createdAt: Timestamp.now(),\n        updatedAt: Timestamp.now(),\n      };\n\n      // undefined deerleri kaldr (Firestore undefined kabul etmez)\n      const cleanPermission = Object.fromEntries(\n        Object.entries(permissionData).filter(([_, value]) => value !== undefined)\n      );\n\n      await addDoc(permissionsRef, cleanPermission);\n    }\n  } catch (error: unknown) {\n    if (import.meta.env.DEV) {\n      console.error(\"Error adding role:\", error);\n    }\n    throw new Error(error instanceof Error ? error.message : \"Rol eklenemedi\");\n  }\n};\n\n/**\n * Delete a role\n */\nexport const deleteRole = async (roleKey: string): Promise<void> => {\n  try {\n    // Sistem rolleri silinemez\n    const roleDoc = await getDoc(doc(db, ROLES_COLLECTION, roleKey));\n    if (roleDoc.exists() && roleDoc.data().isSystem) {\n      throw new Error(\"Sistem rolleri silinemez\");\n    }\n\n    // Bu role sahip kullanclar bul ve rollerini gncelle\n    const usersRef = collection(db, \"users\");\n    const usersQuery = query(usersRef);\n    const usersSnapshot = await getDocs(usersQuery);\n\n    const { writeBatch } = await import(\"firebase/firestore\");\n    let batch = writeBatch(db);\n    let batchCount = 0;\n    const maxBatchSize = 500;\n\n    for (const userDoc of usersSnapshot.docs) {\n      const userData = userDoc.data();\n      const userRoles = userData.role || [];\n\n      // Eer kullanc bu role sahipse, rol kaldr\n      if (userRoles.includes(roleKey)) {\n        const updatedRoles = userRoles.filter((r: string) => r !== roleKey);\n        // Eer hi rol kalmadysa, varsaylan rol ekle\n        const finalRoles = updatedRoles.length > 0 ? updatedRoles : [\"personnel\"];\n\n        batch.update(userDoc.ref, {\n          role: finalRoles,\n        });\n        batchCount++;\n\n        if (batchCount >= maxBatchSize) {\n          await batch.commit();\n          batchCount = 0;\n          // Yeni batch olutur\n          batch = writeBatch(db);\n        }\n      }\n    }\n\n    // Kalan batch'i commit et\n    if (batchCount > 0) {\n      await batch.commit();\n    }\n\n    // Delete role definition\n    await deleteDoc(doc(db, ROLES_COLLECTION, roleKey));\n\n    // Delete associated permissions\n    const permissionsRef = collection(db, ROLE_PERMISSIONS_COLLECTION);\n    const q = query(permissionsRef, where(\"role\", \"==\", roleKey));\n    const permissionsSnapshot = await getDocs(q);\n\n    for (const docSnap of permissionsSnapshot.docs) {\n      await deleteDoc(doc(db, ROLE_PERMISSIONS_COLLECTION, docSnap.id));\n    }\n  } catch (error: unknown) {\n    if (import.meta.env.DEV) {\n      console.error(\"Error deleting role:\", error);\n    }\n    throw new Error(error instanceof Error ? error.message : \"Rol silinemedi\");\n  }\n};\n\n/**\n * Initialize default permissions for all roles and resources\n */\nconst initializeDefaultPermissions = async (): Promise<void> => {\n  try {\n    const permissionsRef = collection(db, ROLE_PERMISSIONS_COLLECTION);\n    const snapshot = await getDocs(permissionsRef);\n\n    const roles = await getRoles();\n    const existingPermissions = snapshot.docs.map(doc => doc.data() as RolePermission);\n\n    // Eksik permissions'lar kontrol et ve olutur\n    const missingPermissions: Omit<RolePermission, \"id\">[] = [];\n\n    for (const roleDef of roles) {\n      const role = roleDef.key;\n      for (const resource of RESOURCES) {\n        // Bu rol ve kaynak iin permission var m kontrol et\n        const exists = existingPermissions.some(\n          (p) => p.role === role && p.resource === resource\n        );\n\n        if (!exists) {\n          // Eksik permission iin varsaylan deerler\n          let canCreate = false;\n          let canRead = true;\n          let canUpdate = false;\n          let canDelete = false;\n          let subPermissions: SubPermissions = {};\n\n          // Alt yetkileri al\n          const subPerms = getSubPermissionsForResource(resource);\n          const subPermKeys = Object.keys(subPerms);\n\n          if (role === \"super_admin\") {\n            canCreate = true;\n            canRead = true;\n            canUpdate = true;\n            canDelete = true;\n            // Sper ynetici ve admin iin tm alt yetkileri true yap\n            subPermKeys.forEach(key => {\n              subPermissions[key] = true;\n            });\n          } else if (role === \"team_leader\") {\n            // Ekip lideri iin tm kaynaklarda oluturma, okuma ve gncelleme yetkisi (role_permissions hari)\n            canCreate = resource !== \"role_permissions\";\n            canRead = true;\n            canUpdate = resource !== \"role_permissions\";\n            // Ekip lideri iin silme yetkisi (role_permissions ve audit_logs hari)\n            canDelete = resource !== \"role_permissions\" && resource !== \"audit_logs\";\n            // Ekip lideri iin tm alt yetkileri true yap (role_permissions hari)\n            if (resource !== \"role_permissions\") {\n              subPermKeys.forEach(key => {\n                subPermissions[key] = true;\n              });\n            }\n          } else if (role === \"personnel\") {\n            // Personnel tasks oluturamaz, sadece production_orders oluturabilir\n            canCreate = [\"production_orders\"].includes(resource);\n            canRead = true;\n            // Personnel sadece atanan grevlerin durumunu gncelleyebilir (canUpdate kontrol taskService'de yaplr)\n            canUpdate = [\"tasks\", \"production_orders\"].includes(resource);\n            canDelete = false;\n            // Personel iin snrl alt yetkiler\n            if (resource === \"tasks\") {\n              // Personnel sadece atanan grevlerde bu yetkilere sahip\n              subPermissions.canAddComment = true;\n              subPermissions.canAddAttachment = true;\n              subPermissions.canChangeStatus = true; // Sadece atanan grevler iin\n            } else if (resource === \"production_orders\") {\n              subPermissions.canViewSchedule = true;\n            }\n          }\n\n          const permissionData: Omit<RolePermission, \"id\"> & { subPermissions?: SubPermissions } = {\n            role,\n            resource,\n            canCreate,\n            canRead,\n            canUpdate,\n            canDelete,\n            createdAt: Timestamp.now(),\n            updatedAt: Timestamp.now(),\n          };\n\n          // subPermissions sadece varsa ekle (undefined deerleri Firestore kabul etmez)\n          if (Object.keys(subPermissions).length > 0) {\n            permissionData.subPermissions = subPermissions;\n          }\n\n          missingPermissions.push(permissionData);\n        }\n      }\n    }\n\n    // Eksik permissions'lar olutur\n    if (missingPermissions.length > 0) {\n      for (const permission of missingPermissions) {\n        // undefined deerleri kaldr (Firestore undefined kabul etmez)\n        const cleanPermission: Record<string, unknown> = {};\n        for (const [key, value] of Object.entries(permission)) {\n          if (value !== undefined) {\n            // Eer value bir obje ise, iindeki undefined deerleri de temizle\n            if (typeof value === 'object' && value !== null && !(value instanceof Timestamp)) {\n              const cleanValue = Object.fromEntries(\n                Object.entries(value).filter(([_, v]) => v !== undefined)\n              );\n              if (Object.keys(cleanValue).length > 0) {\n                cleanPermission[key] = cleanValue;\n              }\n            } else {\n              cleanPermission[key] = value;\n            }\n          }\n        }\n        await addDoc(permissionsRef, cleanPermission);\n      }\n    }\n\n    // Eer hi permission yoksa, tm roller iin olutur\n    if (snapshot.size === 0 && missingPermissions.length === 0) {\n      const defaultPermissions: Omit<RolePermission, \"id\">[] = [];\n\n      for (const roleDef of roles) {\n        const role = roleDef.key;\n        for (const resource of RESOURCES) {\n          // Alt yetkileri al\n          const subPerms = getSubPermissionsForResource(resource);\n          const subPermKeys = Object.keys(subPerms);\n          let subPermissions: SubPermissions = {};\n\n          // Super Admin and Admin have all permissions\n          if (role === \"super_admin\") {\n            // Sper ynetici ve admin iin tm alt yetkileri true yap\n            subPermKeys.forEach(key => {\n              subPermissions[key] = true;\n            });\n            const permissionData: Omit<RolePermission, \"id\"> & { subPermissions?: SubPermissions } = {\n              role,\n              resource,\n              canCreate: true,\n              canRead: true,\n              canUpdate: true,\n              canDelete: true,\n              createdAt: Timestamp.now(),\n              updatedAt: Timestamp.now(),\n            };\n\n            // subPermissions sadece varsa ekle (undefined deerleri Firestore kabul etmez)\n            if (Object.keys(subPermissions).length > 0) {\n              permissionData.subPermissions = subPermissions;\n            }\n\n            defaultPermissions.push(permissionData);\n          }\n          // Team Leader has most permissions except role_permissions\n          else if (role === \"team_leader\") {\n            // Ekip lideri iin tm alt yetkileri true yap (role_permissions hari)\n            if (resource !== \"role_permissions\") {\n              subPermKeys.forEach(key => {\n                subPermissions[key] = true;\n              });\n            }\n            const permissionData: Omit<RolePermission, \"id\"> & { subPermissions?: SubPermissions } = {\n              role,\n              resource,\n              canCreate: resource !== \"role_permissions\",\n              canRead: true,\n              canUpdate: resource !== \"role_permissions\",\n              canDelete: resource !== \"role_permissions\" && resource !== \"audit_logs\",\n              createdAt: Timestamp.now(),\n              updatedAt: Timestamp.now(),\n            };\n\n            // subPermissions sadece varsa ekle (undefined deerleri Firestore kabul etmez)\n            if (Object.keys(subPermissions).length > 0) {\n              permissionData.subPermissions = subPermissions;\n            }\n\n            defaultPermissions.push(permissionData);\n          }\n          // Personnel has limited permissions\n          else if (role === \"personnel\") {\n            // Personel iin snrl alt yetkiler\n            if (resource === \"tasks\") {\n              subPermissions.canEditOwn = true;\n              subPermissions.canDeleteOwn = true;\n              subPermissions.canAddComment = true;\n              subPermissions.canAddAttachment = true;\n            } else if (resource === \"production_orders\") {\n              subPermissions.canViewSchedule = true;\n            }\n            const permissionData: Omit<RolePermission, \"id\"> & { subPermissions?: SubPermissions } = {\n              role,\n              resource,\n              canCreate: [\"tasks\", \"production_orders\"].includes(resource),\n              canRead: true,\n              canUpdate: [\"tasks\", \"production_orders\"].includes(resource),\n              canDelete: false,\n              createdAt: Timestamp.now(),\n              updatedAt: Timestamp.now(),\n            };\n\n            // subPermissions sadece varsa ekle (undefined deerleri Firestore kabul etmez)\n            if (Object.keys(subPermissions).length > 0) {\n              permissionData.subPermissions = subPermissions;\n            }\n\n            defaultPermissions.push(permissionData);\n          }\n          // Other roles (viewer, custom roles) have read-only permissions\n          else {\n            defaultPermissions.push({\n              role,\n              resource,\n              canCreate: false,\n              canRead: true,\n              canUpdate: false,\n              canDelete: false,\n              // subPermissions eklenmiyor (undefined deerleri Firestore kabul etmez)\n              createdAt: Timestamp.now(),\n              updatedAt: Timestamp.now(),\n            });\n          }\n        }\n      }\n\n      // Add all permissions to Firestore\n      for (const permission of defaultPermissions) {\n        // undefined deerleri kaldr (Firestore undefined kabul etmez)\n        const cleanPermission: Record<string, unknown> = {};\n        for (const [key, value] of Object.entries(permission)) {\n          if (value !== undefined) {\n            // Eer value bir obje ise, iindeki undefined deerleri de temizle\n            if (typeof value === 'object' && value !== null && !(value instanceof Timestamp)) {\n              const cleanValue = Object.fromEntries(\n                Object.entries(value).filter(([_, v]) => v !== undefined)\n              );\n              if (Object.keys(cleanValue).length > 0) {\n                cleanPermission[key] = cleanValue;\n              }\n            } else {\n              cleanPermission[key] = value;\n            }\n          }\n        }\n        await addDoc(permissionsRef, cleanPermission);\n      }\n    }\n  } catch (error) {\n    if (import.meta.env.DEV) {\n      console.error(\"Error initializing default permissions:\", error);\n    }\n  }\n};\n\n/**\n * Update existing permissions to include missing sub-permissions\n * Bu fonksiyon mevcut izinleri kontrol edip eksik alt yetkileri ekler\n */\nexport const updatePermissionsWithSubPermissions = async (): Promise<void> => {\n  try {\n    const permissionsRef = collection(db, ROLE_PERMISSIONS_COLLECTION);\n    const snapshot = await getDocs(permissionsRef);\n\n    for (const docSnap of snapshot.docs) {\n      const permission = docSnap.data() as RolePermission;\n      const subPerms = getSubPermissionsForResource(permission.resource);\n      const subPermKeys = Object.keys(subPerms);\n\n      // Eer alt yetkiler yoksa veya eksikse, ekle\n      let needsUpdate = false;\n      let updatedSubPermissions: SubPermissions = { ...(permission.subPermissions || {}) };\n\n      // Sper ynetici iin tm alt yetkileri true yap\n      if (permission.role === \"super_admin\" && subPermKeys.length > 0) {\n        subPermKeys.forEach(key => {\n          if (updatedSubPermissions[key] !== true) {\n            updatedSubPermissions[key] = true;\n            needsUpdate = true;\n          }\n        });\n      }\n      // Ekip lideri iin tm alt yetkileri true yap (role_permissions hari)\n      else if (permission.role === \"team_leader\" && permission.resource !== \"role_permissions\") {\n        if (subPermKeys.length > 0) {\n          subPermKeys.forEach(key => {\n            if (updatedSubPermissions[key] !== true) {\n              updatedSubPermissions[key] = true;\n              needsUpdate = true;\n            }\n          });\n        }\n\n        // Ekip lideri iin canCreate, canUpdate ve canDelete yetkilerini de kontrol et\n        if (permission.canCreate !== true) {\n          needsUpdate = true;\n        }\n        if (permission.canUpdate !== true) {\n          needsUpdate = true;\n        }\n        // canDelete: role_permissions ve audit_logs hari tm kaynaklar iin true\n        if (permission.resource !== \"audit_logs\" && permission.canDelete !== true) {\n          needsUpdate = true;\n        }\n      }\n      // Personel iin snrl alt yetkiler\n      else if (permission.role === \"personnel\") {\n        if (permission.resource === \"tasks\") {\n          const taskSubPerms = [\"canEditOwn\", \"canDeleteOwn\", \"canAddComment\", \"canAddAttachment\"];\n          taskSubPerms.forEach(key => {\n            if (updatedSubPermissions[key] !== true) {\n              updatedSubPermissions[key] = true;\n              needsUpdate = true;\n            }\n          });\n        } else if (permission.resource === \"production_orders\") {\n          if (updatedSubPermissions.canViewSchedule !== true) {\n            updatedSubPermissions.canViewSchedule = true;\n            needsUpdate = true;\n          }\n        }\n      }\n\n      // Gncelleme gerekiyorsa yap\n      if (needsUpdate) {\n        const updateData: Partial<RolePermission> = {\n          updatedAt: Timestamp.now(),\n        };\n\n        // Ekip lideri iin ana yetkileri de gncelle\n        if (permission.role === \"team_leader\" && permission.resource !== \"role_permissions\") {\n          if (permission.canCreate !== true) {\n            updateData.canCreate = true;\n          }\n          if (permission.canUpdate !== true) {\n            updateData.canUpdate = true;\n          }\n          // canDelete: role_permissions ve audit_logs hari tm kaynaklar iin true\n          if (permission.resource !== \"audit_logs\" && permission.canDelete !== true) {\n            updateData.canDelete = true;\n          }\n        }\n\n        // subPermissions sadece varsa ekle (undefined deerleri Firestore kabul etmez)\n        if (Object.keys(updatedSubPermissions).length > 0) {\n          updateData.subPermissions = updatedSubPermissions;\n        }\n\n        // undefined deerleri kaldr\n        const cleanUpdateData = Object.fromEntries(\n          Object.entries(updateData).filter(([_, value]) => value !== undefined)\n        );\n\n        await updateDoc(doc(db, ROLE_PERMISSIONS_COLLECTION, docSnap.id), cleanUpdateData);\n      }\n    }\n  } catch (error) {\n    if (import.meta.env.DEV) {\n      console.error(\"Error updating permissions with sub-permissions:\", error);\n    }\n  }\n};\n\n/**\n * Get all role permissions\n */\nexport const getRolePermissions = async (): Promise<RolePermission[]> => {\n  try {\n    // Initialize default roles first\n    await initializeDefaultRoles();\n\n    // Initialize default permissions if needed\n    await initializeDefaultPermissions();\n\n    // Mevcut izinleri alt yetkilerle gncelle\n    await updatePermissionsWithSubPermissions();\n\n    const permissionsRef = collection(db, ROLE_PERMISSIONS_COLLECTION);\n    const snapshot = await getDocs(permissionsRef);\n\n    const permissions = snapshot.docs.map((docSnap) => ({\n      id: docSnap.id,\n      ...docSnap.data(),\n    })) as RolePermission[];\n\n    // Pre-populate cache with all permissions for faster access\n    permissions.forEach(permission => {\n      const cacheKey = `${permission.role}:${permission.resource}`;\n      if (!permissionCache.has(cacheKey) || isCacheExpired(cacheKey)) {\n        permissionCache.set(cacheKey, permission);\n        updateCacheTimestamp(cacheKey);\n      }\n    });\n\n    return permissions;\n  } catch (error: unknown) {\n    if (import.meta.env.DEV) {\n      console.error(\"Error getting role permissions:\", error);\n    }\n    throw new Error(error instanceof Error ? error.message : \"Rol yetkileri yklenemedi\");\n  }\n};\n\n/**\n * Get permission for a specific role and resource\n * Uses cache and real-time listener for dynamic updates\n * IMPORTANT: Always returns the latest value from cache (updated by real-time listener)\n */\nexport const getPermission = async (\n  role: string,\n  resource: string,\n  useCache: boolean = true\n): Promise<RolePermission | null> => {\n  const cacheKey = `${role}:${resource}`;\n\n  try {\n    const permissionsRef = collection(db, ROLE_PERMISSIONS_COLLECTION);\n    const q = query(\n      permissionsRef,\n      where(\"role\", \"==\", role),\n      where(\"resource\", \"==\", resource)\n    );\n\n    // If cache is disabled, get directly from Firestore\n    if (!useCache) {\n      const snapshot = await getDocs(q);\n      if (snapshot.empty) {\n        return null;\n      }\n      const docSnap = snapshot.docs[0];\n      return {\n        id: docSnap.id,\n        ...docSnap.data(),\n      } as RolePermission;\n    }\n\n    // If cache already has value, return it immediately if not expired\n    if (permissionCache.has(cacheKey)) {\n      if (!isCacheExpired(cacheKey)) {\n        return permissionCache.get(cacheKey) || null;\n      }\n      // If expired, assume listener will refresh it or we just update timestamp if listener is active\n      // Since we have real-time listener, treat as fresh but update timestamp\n      updateCacheTimestamp(cacheKey);\n      return permissionCache.get(cacheKey) || null;\n    }\n\n    // Set up real-time listener if not already set\n    if (!permissionListeners.has(cacheKey)) {\n      // First, get initial value synchronously to avoid race condition\n      const initialSnapshot = await getDocs(q);\n      let initialPermission: RolePermission | null = null;\n\n      if (!initialSnapshot.empty) {\n        const docSnap = initialSnapshot.docs[0];\n        initialPermission = {\n          id: docSnap.id,\n          ...docSnap.data(),\n        } as RolePermission;\n      }\n\n      // Cache the initial value immediately\n      permissionCache.set(cacheKey, initialPermission);\n      updateCacheTimestamp(cacheKey);\n\n      // Then set up real-time listener for future updates\n      const unsubscribe = onSnapshot(q, (snapshot) => {\n        if (snapshot.empty) {\n          permissionCache.set(cacheKey, null);\n        } else {\n          const docSnap = snapshot.docs[0];\n          const permission = {\n            id: docSnap.id,\n            ...docSnap.data(),\n          } as RolePermission;\n          permissionCache.set(cacheKey, permission);\n        }\n        updateCacheTimestamp(cacheKey);\n        // Notify all callbacks about cache change\n        cacheCallbacks.forEach(callback => callback());\n      }, (error) => {\n        if (import.meta.env.DEV) {\n          console.error(`Error listening to permission ${cacheKey}:`, error);\n        }\n      });\n\n      permissionListeners.set(cacheKey, unsubscribe);\n\n      // Return the initial value we just cached\n      return initialPermission;\n    }\n\n    // Listener already exists, return cached value (should be available now)\n    updateCacheTimestamp(cacheKey);\n    return permissionCache.get(cacheKey) || null;\n  } catch (error: unknown) {\n    if (import.meta.env.DEV) {\n      console.error(\"Error getting permission:\", error);\n    }\n    throw new Error(error instanceof Error ? error.message : \"Yetki yklenemedi\");\n  }\n};\n\n/**\n * Cleanup all permission listeners\n */\nexport const cleanupPermissionListeners = (): void => {\n  permissionListeners.forEach(unsubscribe => unsubscribe());\n  permissionListeners.clear();\n  permissionCache.clear();\n  cacheCallbacks.clear();\n};\n\n/**\n * Get sub-permissions for a resource\n */\nexport const getSubPermissionsForResource = (resource: string): Record<string, string> => {\n  const subPermissions: Record<string, Record<string, string>> = {\n    tasks: {\n      canAssign: \"Grev atama\",\n      canChangeStatus: \"Durum deitirme\",\n      canAddComment: \"Yorum ekleme\",\n      canAddAttachment: \"Dosya ekleme\",\n      canViewAll: \"Tm grevleri grme\",\n      canEditOwn: \"Kendi grevlerini dzenleme\",\n      canDeleteOwn: \"Kendi grevlerini silme\",\n      canApprove: \"Grev onaylama\",\n      canAddChecklist: \"Checklist ekleme\",\n      canEditChecklist: \"Checklist dzenleme/silme\",\n      canViewPrivate: \"Gizli grevleri grme\",\n    },\n    users: {\n      canChangeRole: \"Rol deitirme\",\n      canViewSensitiveData: \"Hassas verileri grme\",\n      canViewAuditLogs: \"Denetim kaytlarn grme\",\n    },\n    departments: {\n      canAssignMembers: \"ye atama\",\n      canChangeLeader: \"Lider deitirme\",\n      canViewAll: \"Tm departmanlar grme\",\n      canApproveTeamRequest: \"Ekip taleplerini onaylama\",\n      canViewTeamManagement: \"Ekip ynetimi mensn grme\",\n    },\n    orders: {\n      canApprove: \"Onaylama\",\n      canCancel: \"ptal etme\",\n      canExport: \"Da aktarma\",\n      canViewFinancials: \"Finansal bilgileri grme\",\n      canEditPrice: \"Fiyat dzenleme\",\n    },\n    production_orders: {\n      canStartProduction: \"retimi balatma\",\n      canCompleteProduction: \"retimi tamamlama\",\n      canViewSchedule: \"retim plann grme\",\n      canEditSchedule: \"retim plann dzenleme\",\n    },\n    customers: {\n      canViewFinancials: \"Finansal bilgileri grme\",\n      canEditFinancials: \"Finansal bilgileri dzenleme\",\n      canExport: \"Da aktarma\",\n      canViewHistory: \"Gemi kaytlar grme\",\n    },\n    products: {\n      canEditPrice: \"Fiyat dzenleme\",\n      canEditStock: \"Stok dzenleme\",\n      canViewCost: \"Maliyet grme\",\n      canEditCost: \"Maliyet dzenleme\",\n      canExport: \"Da aktarma\",\n    },\n    projects: {\n      canAssignMembers: \"ye atama\",\n      canChangeStatus: \"Durum deitirme\",\n      canViewAll: \"Tm projeleri grme\",\n      canEditBudget: \"Bte dzenleme\",\n      canViewPrivate: \"Gizli projeleri grme\",\n    },\n    audit_logs: {\n      canViewAll: \"Tm kaytlar grme\",\n      canExport: \"Da aktarma\",\n      canDelete: \"Kayt silme\",\n    },\n    role_permissions: {\n      canCreateRoles: \"Rol oluturma\",\n      canDeleteRoles: \"Rol silme\",\n      canEditSystemRoles: \"Sistem rollerini dzenleme\",\n      canViewAdminPanel: \"Admin paneli mensn grme\",\n    },\n    raw_materials: {\n      canEditStock: \"Stok dzenleme\",\n      canViewCost: \"Maliyet grme\",\n      canEditCost: \"Maliyet dzenleme\",\n      canExport: \"Da aktarma\",\n      canViewTransactions: \"lem gemiini grme\",\n      canCreateTransactions: \"Stok ilemi oluturma\",\n    },\n    warranty: {\n      canApprove: \"Garanti onaylama\",\n      canReject: \"Garanti reddetme\",\n      canViewFinancials: \"Finansal bilgileri grme\",\n      canExport: \"Da aktarma\",\n      canViewHistory: \"Gemi kaytlar grme\",\n    },\n  };\n\n  return subPermissions[resource] || {};\n};\n\n/**\n * Update a permission\n */\nexport const updatePermission = async (\n  permissionId: string,\n  updates: Partial<Omit<RolePermission, \"id\" | \"createdAt\" | \"updatedAt\">>\n): Promise<void> => {\n  try {\n    const permissionRef = doc(db, ROLE_PERMISSIONS_COLLECTION, permissionId);\n\n    // Get current permission to find cache key\n    const currentPermission = await getDoc(permissionRef);\n    if (currentPermission.exists()) {\n      const data = currentPermission.data() as RolePermission;\n      const cacheKey = `${data.role}:${data.resource}`;\n      // Invalidate cache for this permission - listener will update it\n      permissionCache.delete(cacheKey);\n    }\n\n    // undefined deerleri kaldr (Firestore undefined kabul etmez)\n    const cleanUpdates: Record<string, unknown> = {};\n    for (const [key, value] of Object.entries(updates)) {\n      if (value !== undefined) {\n        // Eer value bir obje ise (subPermissions gibi), iindeki undefined deerleri de temizle\n        if (typeof value === 'object' && value !== null && !(value instanceof Timestamp)) {\n          const cleanValue = Object.fromEntries(\n            Object.entries(value).filter(([_, v]) => v !== undefined)\n          );\n          if (Object.keys(cleanValue).length > 0) {\n            cleanUpdates[key] = cleanValue;\n          }\n        } else {\n          cleanUpdates[key] = value;\n        }\n      }\n    }\n\n    await updateDoc(permissionRef, {\n      ...cleanUpdates,\n      updatedAt: Timestamp.now(),\n    });\n\n    // Cache will be updated by real-time listener automatically\n    // No need to manually update cache\n  } catch (error: unknown) {\n    if (import.meta.env.DEV) {\n      console.error(\"Error updating permission:\", error);\n    }\n    throw new Error(error instanceof Error ? error.message : \"Yetki gncellenemedi\");\n  }\n};\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\services\\firebase\\settingsService.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\services\\firebase\\storageService.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\services\\firebase\\taskService.ts","messages":[{"ruleId":"prefer-const","severity":2,"message":"'q' is never reassigned. Use 'const' instead.","line":364,"column":9,"nodeType":"Identifier","messageId":"useConst","endLine":364,"endColumn":10,"fix":{"range":[13535,13556],"text":"const q = buildQuery();"}},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":532,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":532,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[19856,19859],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[19856,19859],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":533,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":533,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[19899,19902],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[19899,19902],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":722,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":722,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[26617,26620],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[26617,26620],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":897,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":897,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[33221,33224],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[33221,33224],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":908,"column":76,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":908,"endColumn":79,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[33646,33649],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[33646,33649],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":2019,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2019,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[75391,75394],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[75391,75394],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":2122,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2122,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[78267,78270],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[78267,78270],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":2518,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2518,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[90950,90953],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[90950,90953],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":2524,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2524,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[91258,91261],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[91258,91261],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":2849,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2849,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[104234,104237],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[104234,104237],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":11,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":1,"fixableWarningCount":0,"source":"/**\n * Firebase Task Service\n * Grev ynetimi ilemleri\n */\n\nimport {\n  collection,\n  doc,\n  getDoc,\n  getDocs,\n  addDoc,\n  updateDoc,\n  deleteDoc,\n  query,\n  where,\n  orderBy,\n  limit,\n  serverTimestamp,\n  Timestamp,\n  writeBatch,\n  onSnapshot,\n  Unsubscribe,\n  QueryConstraint,\n  FieldValue,\n} from \"firebase/firestore\";\nimport { firestore, auth } from \"@/lib/firebase\";\nimport { logAudit } from \"@/utils/auditLogger\";\nimport { handlePermissionError, isPermissionError } from \"@/utils/errorLogger\";\nimport { createNotification, updateNotification } from \"./notificationService\";\nimport { getAllUsers, getUserProfile, UserProfile } from \"./authService\";\nimport { getDepartments } from \"./departmentService\";\nimport { getProjectById } from \"./projectService\";\n\nexport interface TaskAttachment {\n  id: string;\n  name: string;\n  url: string;\n  size: number;\n  type: string;\n  attachmentType?: \"file\" | \"drive_link\"; // Dosya tipi\n  driveLink?: string; // Google Drive linki\n  storageProvider?: \"firebase\" | \"google_drive\";\n  driveFileId?: string;\n  uploadedBy: string;\n  uploadedAt: Timestamp;\n}\n\nexport interface StatusHistoryEntry {\n  status: \"pending\" | \"in_progress\" | \"completed\" | \"cancelled\";\n  changedAt: Timestamp;\n  changedBy: string;\n}\n\nexport interface Task {\n  id: string;\n  title: string;\n  description?: string | null;\n  status: \"pending\" | \"in_progress\" | \"completed\" | \"cancelled\";\n  priority: 1 | 2 | 3 | 4 | 5; // 1: low, 5: critical (eski sistemle uyumlu)\n  dueDate?: Timestamp | null;\n  projectId?: string | null; // Proje ID'si\n  isPrivate?: boolean; // Gizli grev mi? (Sadece atananlar ve oluturan grebilir)\n  productionOrderId?: string | null;\n  productionProcessId?: string | null;\n  labels?: string[] | null;\n  attachments?: TaskAttachment[] | null;\n  assignedUsers?: string[] | null; // Atanan kullanc ID'leri (Firestore rules iin)\n  isInPool?: boolean; // Grev havuzunda m?\n  poolRequests?: string[]; // Grev havuzuna eklenmek isteyen kullanclar\n  approvalStatus?: \"pending\" | \"approved\" | \"rejected\"; // Onay durumu\n  approvalRequestedBy?: string; // Onay isteyen\n  approvedBy?: string; // Onaylayan\n  approvedAt?: Timestamp; // Onay tarihi\n  rejectedBy?: string; // Reddeden\n  rejectedAt?: Timestamp; // Reddetme tarihi\n  rejectionReason?: string | null; // Reddetme nedeni\n  isArchived?: boolean; // Arivlendi mi?\n  onlyInMyTasks?: boolean; // Sadece \"Benim Grevlerim\" sayfasnda grnsn m?\n  statusHistory?: StatusHistoryEntry[]; // Aama gemii\n  statusUpdatedBy?: string; // Durum deitiren kullanc\n  statusUpdatedAt?: Timestamp | FieldValue; // Durum deiiklik tarihi\n  updatedBy?: string; // Son gncelleyen kullanc (her trl gncelleme iin)\n  createdBy: string;\n  createdAt: Timestamp;\n  updatedAt: Timestamp;\n}\n\nexport interface TaskAssignment {\n  id: string;\n  taskId: string;\n  assignedTo: string;\n  assignedBy: string;\n  status: \"pending\" | \"accepted\" | \"rejected\" | \"completed\";\n  rejectionReason?: string | null;\n  // Red onay/red sistemi\n  rejectionApprovedBy?: string | null; // Reddi onaylayan (grevi veren)\n  rejectionApprovedAt?: Timestamp | null; // Red onay tarihi\n  rejectionRejectedBy?: string | null; // Reddi reddeden (grevi veren)\n  rejectionRejectedAt?: Timestamp | null; // Red red tarihi\n  rejectionRejectionReason?: string | null; // Reddi reddetme nedeni (grevi veren)\n  notes?: string | null;\n  assignedAt: Timestamp;\n  acceptedAt?: Timestamp | null;\n  completedAt?: Timestamp | null;\n}\n\nexport interface ChecklistItem {\n  id: string;\n  text: string;\n  completed: boolean;\n  createdAt: Timestamp;\n  completedAt?: Timestamp | null;\n}\n\nexport interface Checklist {\n  id: string;\n  taskId: string;\n  title: string;\n  items: ChecklistItem[];\n  createdAt: Timestamp;\n  updatedAt: Timestamp;\n}\n\n/**\n * Tm grevleri listele\n * Not: assignedTo filtresi iin tm task'lar alp assignments'lar kontrol eder\n */\nexport const getTasks = async (filters?: {\n  assignedTo?: string;\n  createdBy?: string;\n  status?: string;\n  projectId?: string;\n  productionOrderId?: string;\n  approvalStatus?: \"pending\" | \"approved\" | \"rejected\";\n  limit?: number; // Pagination iin limit destei\n}): Promise<Task[]> => {\n  try {\n    const tasksRef = collection(firestore, \"tasks\");\n    const buildQuery = (options?: { skipOrder?: boolean }) => {\n      const constraints: QueryConstraint[] = [];\n      if (!options?.skipOrder) {\n        constraints.push(orderBy(\"createdAt\", \"desc\"));\n      }\n      if (filters?.createdBy) {\n        constraints.push(where(\"createdBy\", \"==\", filters.createdBy));\n      }\n      if (filters?.status) {\n        constraints.push(where(\"status\", \"==\", filters.status));\n      }\n      if (filters?.projectId) {\n        constraints.push(where(\"projectId\", \"==\", filters.projectId));\n      }\n      if (filters?.productionOrderId) {\n        constraints.push(where(\"productionOrderId\", \"==\", filters.productionOrderId));\n      }\n      if (filters?.approvalStatus) {\n        constraints.push(where(\"approvalStatus\", \"==\", filters.approvalStatus));\n      }\n      // Performans iin limit ekle (varsaylan 100, maksimum 500)\n      const taskLimit = filters?.limit ? Math.min(filters.limit, 500) : 100;\n      constraints.push(limit(taskLimit));\n      return constraints.length ? query(tasksRef, ...constraints) : query(tasksRef, limit(taskLimit));\n    };\n\n    let snapshot;\n    try {\n      snapshot = await getDocs(buildQuery());\n    } catch (error: unknown) {\n      const errorMessage = error instanceof Error ? error.message : String(error);\n      const requiresIndex = typeof errorMessage === \"string\" && errorMessage.includes(\"requires an index\");\n\n      if (requiresIndex) {\n        if (import.meta.env.DEV) {\n          console.warn(\n            \" Firestore index gerekiyor, sralama olmadan grevler getiriliyor. Index linki:\",\n            errorMessage.match(/https:\\/\\/[^\\s]+/)?.[0] || \"\"\n          );\n        }\n        snapshot = await getDocs(buildQuery({ skipOrder: true }));\n      } else {\n        throw error;\n      }\n    }\n\n    let tasks = snapshot.docs.map((doc) => ({\n      id: doc.id,\n      ...doc.data(),\n    })) as Task[];\n\n    if (filters?.projectId) {\n      // KRTK: Sadece bu projeye ait grevleri gster\n      // projectId null, undefined veya farkl bir deer ise filtrelenmeli\n      tasks = tasks\n        .filter((task) => {\n          // projectId kesin olarak elemeli, null veya undefined olmamal\n          return task.projectId === filters.projectId && task.projectId !== null && task.projectId !== undefined;\n        })\n        .sort((a, b) => {\n          const aTime = a.createdAt instanceof Timestamp ? a.createdAt.toMillis() : 0;\n          const bTime = b.createdAt instanceof Timestamp ? b.createdAt.toMillis() : 0;\n          return bTime - aTime;\n        });\n    }\n\n    // assignedTo filtresi varsa, assignments'lar kontrol et\n    if (filters?.assignedTo) {\n      const tasksWithAssignments = await Promise.all(\n        tasks.map(async (task) => {\n          // Gizli grev kontrol\n          if (task.isPrivate) {\n            // Eer task oluturan kiiyse grebilir\n            if (task.createdBy === filters.assignedTo) return task;\n            \n            // Eer atanan kiiyse grebilir\n            const assignments = await getTaskAssignments(task.id);\n            const hasAssignment = assignments.some(\n              (a) => a.assignedTo === filters.assignedTo && a.status !== \"rejected\"\n            );\n            return hasAssignment ? task : null;\n          }\n          \n          // Normal grevler iin assignment kontrol\n          const assignments = await getTaskAssignments(task.id);\n          const hasAssignment = assignments.some(\n            (a) => a.assignedTo === filters.assignedTo && a.status !== \"rejected\"\n          );\n          return hasAssignment ? task : null;\n        })\n      );\n      tasks = tasksWithAssignments.filter((t) => t !== null) as Task[];\n    } else {\n      // Eer assignedTo filtresi yoksa (genel liste), gizli grevleri ve onlyInMyTasks grevlerini filtrele\n      // Bu durumda auth.currentUser kullanlmal ama parametre olarak gelmiyor\n      // Gvenlik kurallar zaten Firestore tarafnda olmal ama client-side filtreleme de yapalm\n      const currentUserId = auth?.currentUser?.uid;\n      if (currentUserId) {\n         // Personnel kullanclar iin zel kontrol\n         let isPersonnel = false;\n         try {\n           const userProfile = await getUserProfile(currentUserId);\n           if (userProfile?.role) {\n             isPersonnel = userProfile.role.includes(\"personnel\") && \n                          !userProfile.role.includes(\"super_admin\") && \n                          !userProfile.role.includes(\"main_admin\") &&\n                          !userProfile.role.includes(\"team_leader\");\n           }\n         } catch (error: unknown) {\n           if (import.meta.env.DEV) {\n             console.error(\"Error checking user role:\", error);\n           }\n         }\n\n         tasks = await Promise.all(tasks.map(async (task) => {\n           // Personnel kullanclar sadece atanan grevleri grebilir\n           if (isPersonnel) {\n             // Gizli olmayan grevleri grebilir (ama sadece atananlar)\n             if (!task.isPrivate) {\n               // Gizli olmayan grevler iin assignment kontrol yap\n               const assignments = await getTaskAssignments(task.id);\n               const isAssigned = assignments.some(a => a.assignedTo === currentUserId && a.status !== \"rejected\");\n               // assignedUsers array'inde de kontrol et\n               const isInAssignedUsers = Array.isArray(task.assignedUsers) && task.assignedUsers.includes(currentUserId);\n               return (isAssigned || isInAssignedUsers) ? task : null;\n             } else {\n               // Gizli grevler iin: sadece atananlar grebilir\n               const assignments = await getTaskAssignments(task.id);\n               const isAssigned = assignments.some(a => a.assignedTo === currentUserId && a.status !== \"rejected\");\n               const isInAssignedUsers = Array.isArray(task.assignedUsers) && task.assignedUsers.includes(currentUserId);\n               return (isAssigned || isInAssignedUsers) ? task : null;\n             }\n           }\n\n           // Dier kullanclar iin normal filtreleme\n           // onlyInMyTasks grevleri sadece oluturan grebilir, dier listelerde grnmez\n           if (task.onlyInMyTasks) {\n             return task.createdBy === currentUserId ? task : null;\n           }\n           \n           // Gizli grevler iin canViewPrivateTask kontrol\n           if (task.isPrivate) {\n             const { getUserProfile } = await import(\"./authService\");\n             const userProfile = await getUserProfile(currentUserId);\n             if (userProfile) {\n               const { canViewPrivateTask } = await import(\"@/utils/permissions\");\n               const assignments = await getTaskAssignments(task.id);\n               const assignedUserIds = assignments\n                 .filter((a) => a.status === \"accepted\" || a.status === \"pending\")\n                 .map((a) => a.assignedTo);\n               const canView = await canViewPrivateTask(task, userProfile, assignedUserIds);\n               return canView ? task : null;\n             }\n             return null;\n           }\n           \n           return task;\n         })).then(results => results.filter(t => t !== null) as Task[]);\n      } else {\n        // Kullanc yoksa onlyInMyTasks grevlerini filtrele\n        tasks = tasks.filter(task => !task.onlyInMyTasks);\n      }\n    }\n\n    return tasks;\n  } catch (error: unknown) {\n    if (import.meta.env.DEV) {\n      console.error(\"Get tasks error:\", error);\n    }\n    if (isPermissionError(error)) {\n      throw handlePermissionError(error, {\n        operation: \"read\",\n        collection: \"tasks\",\n        userId: auth?.currentUser?.uid,\n      });\n    }\n    throw error;\n  }\n};\n\n/**\n * Grevleri gerek zamanl olarak dinle\n * @param filters Grev filtreleri\n * @param callback Grevler deitiinde arlacak callback\n * @returns Unsubscribe fonksiyonu\n */\nexport const subscribeToTasks = (\n  filters: {\n    assignedTo?: string;\n    createdBy?: string;\n    status?: string;\n    projectId?: string;\n    productionOrderId?: string;\n    approvalStatus?: \"pending\" | \"approved\" | \"rejected\";\n  } = {},\n  callback: (tasks: Task[]) => void\n): Unsubscribe => {\n  try {\n    const tasksRef = collection(firestore, \"tasks\");\n    const buildQuery = (options?: { skipOrder?: boolean }) => {\n      const constraints: QueryConstraint[] = [];\n      if (!options?.skipOrder) {\n        constraints.push(orderBy(\"createdAt\", \"desc\"));\n      }\n      if (filters?.createdBy) {\n        constraints.push(where(\"createdBy\", \"==\", filters.createdBy));\n      }\n      if (filters?.status) {\n        constraints.push(where(\"status\", \"==\", filters.status));\n      }\n      if (filters?.projectId) {\n        constraints.push(where(\"projectId\", \"==\", filters.projectId));\n      }\n      if (filters?.productionOrderId) {\n        constraints.push(where(\"productionOrderId\", \"==\", filters.productionOrderId));\n      }\n      if (filters?.approvalStatus) {\n        constraints.push(where(\"approvalStatus\", \"==\", filters.approvalStatus));\n      }\n      // Performans iin limit ekle (varsaylan 100, maksimum 500)\n      const taskLimit = filters?.limit ? Math.min(filters.limit, 500) : 100;\n      constraints.push(limit(taskLimit));\n      return constraints.length ? query(tasksRef, ...constraints) : query(tasksRef, limit(taskLimit));\n    };\n\n    let q = buildQuery();\n    \n    // onSnapshot ile gerek zamanl dinleme\n    const unsubscribe = onSnapshot(\n      q,\n      async (snapshot) => {\n        try {\n          let tasks = snapshot.docs.map((doc) => ({\n            id: doc.id,\n            ...doc.data(),\n          })) as Task[];\n\n          // projectId filtresi zaten server-side'da uygulanyor, client-side filtreleme gereksiz\n\n          // assignedTo filtresi varsa, assignments'lar kontrol et\n          if (filters?.assignedTo) {\n            const tasksWithAssignments = await Promise.all(\n              tasks.map(async (task) => {\n                // Gizli grev kontrol\n                if (task.isPrivate) {\n                  if (task.createdBy === filters.assignedTo) return task;\n                  \n                  const assignments = await getTaskAssignments(task.id);\n                  const hasAssignment = assignments.some(\n                    (a) => a.assignedTo === filters.assignedTo && a.status !== \"rejected\"\n                  );\n                  return hasAssignment ? task : null;\n                }\n                \n                // Normal grevler iin assignment kontrol\n                const assignments = await getTaskAssignments(task.id);\n                const hasAssignment = assignments.some(\n                  (a) => a.assignedTo === filters.assignedTo && a.status !== \"rejected\"\n                );\n                return hasAssignment ? task : null;\n              })\n            );\n            tasks = tasksWithAssignments.filter((t) => t !== null) as Task[];\n          } else {\n            // assignedTo filtresi yoksa, gizli grevleri ve onlyInMyTasks grevlerini filtrele\n            const currentUserId = auth?.currentUser?.uid;\n            if (currentUserId) {\n              tasks = await Promise.all(tasks.map(async (task) => {\n                // onlyInMyTasks grevleri sadece oluturan grebilir\n                if (task.onlyInMyTasks) {\n                  return task.createdBy === currentUserId ? task : null;\n                }\n                \n                if (!task.isPrivate) return task;\n                \n                if (task.createdBy === currentUserId) return task;\n                \n                const assignments = await getTaskAssignments(task.id);\n                const isAssigned = assignments.some(a => a.assignedTo === currentUserId);\n                \n                return isAssigned ? task : null;\n              })).then(results => results.filter(t => t !== null) as Task[]);\n            } else {\n              // Kullanc yoksa onlyInMyTasks grevlerini filtrele\n              tasks = tasks.filter(task => !task.onlyInMyTasks);\n            }\n          }\n\n          callback(tasks);\n        } catch (error: unknown) {\n          if (import.meta.env.DEV) {\n            console.error(\"Subscribe to tasks error:\", error);\n          }\n          // Hata durumunda bo array gnder\n          callback([]);\n        }\n      },\n      (error) => {\n        // 404 ve network hatalarn sessizce handle et (Firestore otomatik yeniden balanacak)\n        // Production'da da sessizce handle et - bu normal Firestore long-polling davran\n        if (error?.code === 'unavailable' || \n            error?.code === 'not-found' ||\n            error?.message?.includes('404') || \n            error?.message?.includes('network') ||\n            error?.message?.includes('transport errored')) {\n          // Sessizce handle et - Firestore otomatik olarak yeniden balanacak\n          // Production'da console'a yazma (performans ve grlt azaltma)\n          callback([]);\n          return;\n        }\n        \n        // Sadece gerek hatalar logla\n        if (import.meta.env.DEV) {\n          console.error(\"Tasks snapshot error:\", error);\n        }\n        // Hata durumunda bo array gnder (uygulama kmesin)\n        callback([]);\n      }\n    );\n\n    return unsubscribe;\n  } catch (error: unknown) {\n    if (import.meta.env.DEV) {\n      console.error(\"Subscribe to tasks setup error:\", error);\n    }\n    // Hata durumunda bo unsubscribe fonksiyonu dndr\n    return () => {};\n  }\n};\n\n/**\n * Grev detayn al\n */\nexport const getTaskById = async (taskId: string): Promise<Task | null> => {\n  try {\n    const taskDoc = await getDoc(doc(firestore, \"tasks\", taskId));\n    \n    if (!taskDoc.exists()) {\n      return null;\n    }\n\n    return {\n      id: taskDoc.id,\n      ...taskDoc.data(),\n    } as Task;\n  } catch (error: unknown) {\n    if (import.meta.env.DEV) {\n      console.error(\"Get task by id error:\", error);\n    }\n    if (isPermissionError(error)) {\n      throw handlePermissionError(error, {\n        operation: \"read\",\n        collection: \"tasks\",\n        documentId: taskId,\n        userId: auth?.currentUser?.uid,\n      });\n    }\n    throw error;\n  }\n};\n\n/**\n * Yeni grev olutur\n */\nexport const createTask = async (taskData: Omit<Task, \"id\" | \"createdAt\" | \"updatedAt\">): Promise<Task> => {\n  try {\n    // Projeye grev ekleme yetkisi kontrol\n    if (taskData.projectId) {\n      const { getProjectById } = await import(\"@/services/firebase/projectService\");\n      const { getUserProfile } = await import(\"@/services/firebase/authService\");\n      const { canCreateTask, canEditProject } = await import(\"@/utils/permissions\");\n      \n      const project = await getProjectById(taskData.projectId);\n      if (project) {\n        const userProfile = await getUserProfile(taskData.createdBy);\n        if (userProfile) {\n          // Grev oluturma yetkisi kontrol\n          const canCreate = await canCreateTask(userProfile, []);\n          if (!canCreate) {\n            throw new Error(\"Grev oluturma yetkiniz yok. Sadece yneticiler ve ekip liderleri grev oluturabilir.\");\n          }\n          \n          // Proje sahibi kontrol - ekip lideri veya admin deilse, sadece proje sahibi grev ekleyebilir\n          const canEdit = await canEditProject(project, userProfile);\n          if (!canEdit && project.createdBy !== taskData.createdBy) {\n            throw new Error(\"Bu projeye grev ekleme yetkiniz yok. Sadece proje sahibi, yneticiler veya ekip liderleri grev ekleyebilir.\");\n          }\n        }\n      }\n    }\n    \n    const taskDoc: Partial<Task> & { createdAt: FieldValue | Timestamp; updatedAt: FieldValue | Timestamp } = {\n      ...taskData,\n      createdAt: serverTimestamp() as any,\n      updatedAt: serverTimestamp() as any,\n    };\n    \n    // dueDate'i Timestamp'e evir\n    if (taskData.dueDate !== undefined && taskData.dueDate !== null) {\n      if (taskData.dueDate instanceof Date) {\n        taskDoc.dueDate = Timestamp.fromDate(taskData.dueDate);\n      } else if (typeof taskData.dueDate === 'string') {\n        taskDoc.dueDate = Timestamp.fromDate(new Date(taskData.dueDate));\n      }\n    } else {\n      taskDoc.dueDate = null;\n    }\n    \n    const docRef = await addDoc(collection(firestore, \"tasks\"), taskDoc);\n\n    const createdTask = await getTaskById(docRef.id);\n    if (!createdTask) {\n      throw new Error(\"Grev oluturulamad\");\n    }\n\n    // Audit log\n    await logAudit(\"CREATE\", \"tasks\", docRef.id, taskData.createdBy, null, createdTask);\n\n    // Aktivite log ekle\n    if (taskData.createdBy) {\n      try {\n        const { getUserProfile } = await import(\"./authService\");\n        const userProfile = await getUserProfile(taskData.createdBy);\n        const userName = userProfile?.fullName || userProfile?.displayName || userProfile?.email;\n        const userEmail = userProfile?.email;\n        \n        await addTaskActivity(\n          docRef.id,\n          taskData.createdBy,\n          \"created\",\n          `bu grevi oluturdu`,\n          { taskTitle: createdTask.title },\n          userName,\n          userEmail\n        );\n      } catch (error: unknown) {\n        if (import.meta.env.DEV) {\n          console.error(\"Add task activity error:\", error);\n        }\n      }\n    }\n\n    // Grev oluturulduunda ekip liderlerine bildirim gnder\n    try {\n      const teamLeaders = await getTaskTeamLeaders(createdTask);\n      const { createNotification } = await import(\"@/services/firebase/notificationService\");\n      const { getUserProfile } = await import(\"@/services/firebase/authService\");\n      const creatorProfile = await getUserProfile(taskData.createdBy);\n      const creatorName = creatorProfile?.fullName || creatorProfile?.displayName || creatorProfile?.email || \"Bir kullanc\";\n      \n      await Promise.all(\n        teamLeaders.map(async (leaderId) => {\n          try {\n            // Grevi oluturan kii ekip lideri ise bildirim gnderme\n            if (leaderId === taskData.createdBy) return;\n            \n            await createNotification({\n              userId: leaderId,\n              type: \"task_created\",\n              title: \"Yeni grev oluturuldu\",\n              message: `${creatorName} kullancs tarafndan \"${createdTask.title}\" balkl yeni bir grev oluturuldu.\\n\\nYeni grev sisteme eklendi. Grev detaylarn grntlemek iin bildirime tklayabilirsiniz.\\n\\nOluturulma Zaman: ${new Date().toLocaleString('tr-TR', { day: 'numeric', month: 'long', year: 'numeric', hour: '2-digit', minute: '2-digit' })}`,\n              read: false,\n              relatedId: docRef.id,\n              metadata: { createdBy: taskData.createdBy },\n            });\n          } catch (notifError) {\n            if (import.meta.env.DEV) {\n              console.error(\"Error sending task creation notification to team leader:\", leaderId, notifError);\n            }\n          }\n        })\n      );\n    } catch (notifError) {\n      if (import.meta.env.DEV) {\n        console.error(\"Error sending task creation notifications:\", notifError);\n      }\n      // Bildirim hatas grev oluturmay engellemez\n    }\n\n    return createdTask;\n  } catch (error: unknown) {\n    if (import.meta.env.DEV) {\n      console.error(\"Create task error:\", error);\n    }\n    if (isPermissionError(error)) {\n      throw handlePermissionError(error, {\n        operation: \"create\",\n        collection: \"tasks\",\n        userId: taskData.createdBy,\n        data: taskData,\n      });\n    }\n    throw error;\n  }\n};\n\n/**\n * Grevin ekip liderlerini bul\n */\nconst getTaskTeamLeaders = async (task: Task | null): Promise<string[]> => {\n  if (!task) return [];\n  \n  try {\n    const departments = await getDepartments();\n    const teamLeaderIds: string[] = [];\n    \n    // Grevi oluturan kiinin ekibini bul\n    if (task.createdBy) {\n      const creatorProfile = await getUserProfile(task.createdBy);\n      if (creatorProfile?.approvedTeams && creatorProfile.approvedTeams.length > 0) {\n        for (const teamId of creatorProfile.approvedTeams) {\n          const dept = departments.find(d => d.id === teamId);\n          if (dept?.managerId && !teamLeaderIds.includes(dept.managerId)) {\n            teamLeaderIds.push(dept.managerId);\n          }\n        }\n      }\n    }\n    \n    // Proje varsa projenin ekibini kontrol et\n    if (task.projectId) {\n      try {\n        const project = await getProjectById(task.projectId);\n        // Projelerde imdilik departmentId yok, bu yzden sadece creator'n ekibini kullanyoruz\n      } catch (error: unknown) {\n        if (import.meta.env.DEV) {\n          console.error(\"Error fetching project:\", error);\n        }\n      }\n    }\n    \n    return teamLeaderIds;\n  } catch (error: unknown) {\n    if (import.meta.env.DEV) {\n      console.error(\"Error getting team leaders:\", error);\n    }\n    return [];\n  }\n};\n\n/**\n * Grevi gncelle\n */\nexport const updateTask = async (\n  taskId: string,\n  updates: Partial<Omit<Task, \"id\" | \"createdAt\" | \"createdBy\">>,\n  userId?: string\n): Promise<void> => {\n  try {\n    // Eski veriyi al\n    const oldTask = await getTaskById(taskId);\n    if (!oldTask) {\n      throw new Error(\"Grev bulunamad\");\n    }\n    \n    // Yetki kontrol - sadece ierik gncellemeleri iin (status, approvalStatus gibi alanlar iin deil)\n    const isContentUpdate = updates.title !== undefined || \n                            updates.description !== undefined || \n                            updates.priority !== undefined || \n                            updates.dueDate !== undefined || \n                            updates.labels !== undefined ||\n                            updates.projectId !== undefined ||\n                            updates.isPrivate !== undefined;\n    \n    if (isContentUpdate && userId) {\n      const { getUserProfile } = await import(\"@/services/firebase/authService\");\n      const { canEditTask } = await import(\"@/utils/permissions\");\n      const userProfile = await getUserProfile(userId);\n      \n      if (!userProfile) {\n        throw new Error(\"Kullanc profili bulunamad\");\n      }\n      \n      const canEdit = await canEditTask(oldTask, userProfile);\n      if (!canEdit) {\n        throw new Error(\"Bu grevi dzenlemek iin yetkiniz yok. Sadece yneticiler, ekip liderleri veya grevi oluturan kii dzenleyebilir.\");\n      }\n    }\n    \n    const currentUserId = userId || auth?.currentUser?.uid;\n    \n    const updateData: Partial<Task> & { updatedAt: FieldValue | Timestamp } = {\n      ...updates,\n      updatedAt: serverTimestamp() as any,\n    };\n    \n    // Son gncelleyen kullancy gncelle\n    if (currentUserId) {\n      (updateData as Partial<Task>).updatedBy = currentUserId;\n    }\n    \n    // dueDate'i Timestamp'e evir\n    if (updates.dueDate !== undefined) {\n      if (updates.dueDate === null) {\n        updateData.dueDate = null;\n      } else if (updates.dueDate instanceof Date) {\n        updateData.dueDate = Timestamp.fromDate(updates.dueDate);\n      }\n    }\n    \n    await updateDoc(doc(firestore, \"tasks\", taskId), updateData);\n    \n    // Yeni veriyi al\n    const newTask = await getTaskById(taskId);\n    \n    // Audit log\n    if (userId) {\n      await logAudit(\"UPDATE\", \"tasks\", taskId, userId, oldTask, newTask);\n    }\n\n    // Aktivite log ekle\n    if (userId && oldTask && newTask) {\n      try {\n        const { getUserProfile } = await import(\"./authService\");\n        const userProfile = await getUserProfile(userId);\n        const userName = userProfile?.fullName || userProfile?.displayName || userProfile?.email;\n        const userEmail = userProfile?.email;\n\n        const changedFields = Object.keys(updates).filter(key => {\n          const oldValue = (oldTask as unknown as Record<string, unknown>)[key];\n          const newValue = (updates as Record<string, unknown>)[key];\n          return oldValue !== newValue;\n        });\n        \n        if (changedFields.length > 0) {\n          await addTaskActivity(\n            taskId,\n            userId,\n            \"updated\",\n            `bu grevi gncelledi`,\n            { changedFields, taskTitle: newTask.title },\n            userName,\n            userEmail\n          );\n        }\n      } catch (error: unknown) {\n        if (import.meta.env.DEV) {\n          console.error(\"Add task activity error:\", error);\n        }\n      }\n    }\n\n    // Grev gncellemelerinde atanan kullanclara bildirim gnder\n    if (newTask && userId) {\n      try {\n        const assignments = await getTaskAssignments(taskId);\n        const allUsers = await getAllUsers();\n        const updaterUser = allUsers.find(u => u.id === userId);\n        \n        // Atanan kullanclara bildirim gnder (gncelleyen kii hari)\n        const assignedUserIds = assignments\n          .filter(a => a.status === \"accepted\" || a.status === \"pending\")\n          .map(a => a.assignedTo)\n          .filter(id => id !== userId);\n        \n        await Promise.all(\n          assignedUserIds.map(async (assignedUserId) => {\n            try {\n              await createNotification({\n                userId: assignedUserId,\n                type: \"task_updated\",\n                title: \"Grev gncellendi\",\n                message: `${updaterUser?.fullName || updaterUser?.email || \"Bir kullanc\"} kullancs tarafndan \"${newTask.title}\" grevinde deiiklik yapld.\\n\\nGrev bilgileri gncellendi. Detaylar grntlemek iin bildirime tklayabilirsiniz.\\n\\nlem Zaman: ${new Date().toLocaleString('tr-TR', { day: 'numeric', month: 'long', year: 'numeric', hour: '2-digit', minute: '2-digit' })}`,\n                read: false,\n                relatedId: taskId,\n                metadata: null,\n              });\n            } catch (notifError) {\n              // Bildirim hatas sessizce handle edilir - grev gncellemesini engellemez\n              if (import.meta.env.DEV) {\n                console.debug(\"Bildirim gnderilemedi (email servisi almyor olabilir):\", assignedUserId);\n              }\n            }\n          })\n        );\n      } catch (notifError) {\n        // Bildirim hatas sessizce handle edilir - grev gncellemesini engellemez\n        if (import.meta.env.DEV) {\n          console.debug(\"Grev gncelleme bildirimleri gnderilemedi (email servisi almyor olabilir)\");\n        }\n      }\n    }\n  } catch (error: unknown) {\n    if (import.meta.env.DEV) {\n      console.error(\"Update task error:\", error);\n    }\n    if (isPermissionError(error)) {\n      throw handlePermissionError(error, {\n        operation: \"update\",\n        collection: \"tasks\",\n        documentId: taskId,\n        userId: userId || auth?.currentUser?.uid,\n        data: updates,\n      });\n    }\n    throw error;\n  }\n};\n\n/**\n * Grev durumunu gncelle\n */\nexport const updateTaskStatus = async (\n  taskId: string,\n  status: \"pending\" | \"in_progress\" | \"completed\" | \"cancelled\"\n): Promise<void> => {\n  try {\n    // nce mevcut grevi al\n    const task = await getTaskById(taskId);\n    if (!task) {\n      throw new Error(\"Grev bulunamad\");\n    }\n\n    const oldStatus = task.status;\n    const currentUserId = auth?.currentUser?.uid;\n    \n    // Yetki kontrol: SADECE grev yesi (rejected hari) veya oluturan durum deitirebilir\n    // Yneticiler iin zel durum YOK\n    if (!currentUserId) {\n      throw new Error(\"Kullanc bilgisi bulunamad\");\n    }\n    \n    const isCreator = task.createdBy === currentUserId;\n    \n    // Grev yesi kontrol (rejected hari)\n    const assignments = await getTaskAssignments(taskId);\n    const isAssigned = assignments.some(a => a.assignedTo === currentUserId && a.status !== \"rejected\");\n    \n    // Fallback: task.assignedUsers array'inden kontrol\n    const isInTaskAssignedUsers = Array.isArray(task.assignedUsers) && task.assignedUsers.includes(currentUserId);\n    \n    const hasPermission = isCreator || isAssigned || isInTaskAssignedUsers;\n    \n    if (!hasPermission) {\n      throw new Error(\"Bu grevin durumunu deitirme yetkiniz yok. Sadece grev yesi olduunuz grevlerin durumunu deitirebilirsiniz.\");\n    }\n    \n    // NEML: Eer kullanc assignments'da varsa ama task.assignedUsers array'inde yoksa,\n    // NCE array'i gncelle (Firestore kurallar mevcut veri zerinde alt iin)\n    // Sonra durum gncellemesini yap\n    const currentAssignedUsers = Array.isArray(task.assignedUsers) ? task.assignedUsers : [];\n    const shouldUpdateAssignedUsers = isAssigned && !currentAssignedUsers.includes(currentUserId);\n    \n    if (shouldUpdateAssignedUsers) {\n      const taskRef = doc(firestore, \"tasks\", taskId);\n      await updateDoc(taskRef, {\n        assignedUsers: [...currentAssignedUsers, currentUserId],\n      });\n      if (import.meta.env.DEV) {\n        console.log(\" task.assignedUsers array'i gncellendi (Firestore kurallar iin):\", taskId, currentUserId);\n      }\n      // Array gncellendikten sonra task' tekrar al (Firestore kurallar iin)\n      // Ama aslnda gerek yok nk bir sonraki update'te zaten gncel olacak\n    }\n    \n    // Durumu gncelle\n    const updateData: Partial<Task> & { status: Task[\"status\"]; updatedAt: FieldValue | Timestamp } = {\n      status,\n      updatedAt: serverTimestamp() as any,\n    };\n    \n    // Son gncelleyen kullancy gncelle\n    if (currentUserId) {\n      (updateData as Partial<Task>).updatedBy = currentUserId;\n    }\n    \n    // Status deiiklii varsa statusUpdatedBy ve statusUpdatedAt ekle\n    if (oldStatus !== status && currentUserId) {\n      (updateData as Partial<Task>).statusUpdatedBy = currentUserId;\n      (updateData as Partial<Task>).statusUpdatedAt = serverTimestamp() as any;\n      \n      // Aama gemiine yeni kayt ekle\n      const statusHistory: StatusHistoryEntry[] = task.statusHistory || [];\n      statusHistory.push({\n        status,\n        changedAt: Timestamp.now(),\n        changedBy: currentUserId,\n      });\n      updateData.statusHistory = statusHistory;\n    }\n    \n    await updateDoc(doc(firestore, \"tasks\", taskId), updateData);\n\n    // Audit log\n    await logAudit(\"UPDATE\", \"tasks\", taskId, auth?.currentUser?.uid || \"system\", { status: oldStatus }, { status });\n\n    // Aktivite log ekle (durum deiiklii)\n    if (oldStatus !== status && currentUserId) {\n      try {\n        const { getUserProfile } = await import(\"./authService\");\n        const userProfile = await getUserProfile(currentUserId);\n        const userName = userProfile?.fullName || userProfile?.displayName || userProfile?.email;\n        const userEmail = userProfile?.email;\n        \n        const statusNames: Record<string, string> = {\n          pending: \"Beklemede\",\n          in_progress: \"Devam Ediyor\",\n          completed: \"Tamamland\",\n          cancelled: \"ptal Edildi\"\n        };\n        \n        const oldStatusName = statusNames[oldStatus] || oldStatus;\n        const newStatusName = statusNames[status] || status;\n        \n        await addTaskActivity(\n          taskId,\n          currentUserId,\n          \"status_changed\",\n          `grev durumunu \"${oldStatusName}\"  \"${newStatusName}\" olarak deitirdi`,\n          { oldStatus, newStatus: status, taskTitle: task.title },\n          userName,\n          userEmail\n        );\n      } catch (error: unknown) {\n        if (import.meta.env.DEV) {\n          console.error(\"Add task activity error:\", error);\n        }\n      }\n    }\n\n    // Durum deiiklii bildirimleri gnder (sadece durum gerekten deitiyse)\n    if (oldStatus !== status) {\n      try {\n        const assignments = await getTaskAssignments(taskId);\n        const allUsers = await getAllUsers();\n        const currentUser = auth?.currentUser;\n        const changerUser = allUsers.find(u => u.id === currentUser?.uid);\n        \n        // Durum isimlerini Trke'ye evir\n        const statusNames: Record<string, string> = {\n          pending: \"Beklemede\",\n          in_progress: \"Devam Ediyor\",\n          completed: \"Tamamland\",\n          cancelled: \"ptal Edildi\"\n        };\n\n        const statusName = statusNames[status] || status;\n        const oldStatusName = statusNames[oldStatus] || oldStatus;\n\n        // Grevi oluturan kiiye bildirim gnder (durum deitiren kii hari)\n        if (task.createdBy && task.createdBy !== currentUser?.uid) {\n          try {\n            const changeTime = new Date().toLocaleString('tr-TR', { day: 'numeric', month: 'long', year: 'numeric', hour: '2-digit', minute: '2-digit' });\n            await createNotification({\n              userId: task.createdBy,\n              type: \"task_updated\",\n              title: \"Grev durumu deiti\",\n              message: `${changerUser?.fullName || changerUser?.email || \"Bir kullanc\"} kullancs tarafndan \"${task.title}\" grevinin durumu \"${oldStatusName}\" durumundan \"${statusName}\" durumuna gncellendi.\\n\\nlem Zaman: ${changeTime}`,\n              read: false,\n              relatedId: taskId,\n              metadata: { \n                oldStatus, \n                newStatus: status,\n                updatedAt: new Date(),\n                priority: task.priority,\n                dueDate: task.dueDate,\n              },\n            });\n          } catch (notifError) {\n            console.error(\"Error sending notification to task creator:\", notifError);\n          }\n        }\n\n        // Atanan kullanclara bildirim gnder (durum deitiren kii hari)\n        const assignedUserIds = assignments\n          .filter(a => (a.status === \"accepted\" || a.status === \"pending\") && a.assignedTo !== currentUser?.uid)\n          .map(a => a.assignedTo);\n\n        await Promise.all(\n          assignedUserIds.map(async (assignedUserId) => {\n            try {\n              const changeTime = new Date().toLocaleString('tr-TR', { day: 'numeric', month: 'long', year: 'numeric', hour: '2-digit', minute: '2-digit' });\n              await createNotification({\n                userId: assignedUserId,\n                type: \"task_updated\",\n                title: \"Grev durumu deiti\",\n                message: `${changerUser?.fullName || changerUser?.email || \"Bir kullanc\"} tarafndan \"${task.title}\" grevinin durumu \"${oldStatusName}\" durumundan \"${statusName}\" durumuna gncellendi.\\n\\nlem Zaman: ${changeTime}`,\n                read: false,\n                relatedId: taskId,\n                metadata: { \n                  oldStatus, \n                  newStatus: status,\n                  updatedAt: new Date(),\n                  priority: task.priority,\n                  dueDate: task.dueDate,\n                },\n              });\n            } catch (notifError) {\n              console.error(\"Error sending notification to assigned user:\", assignedUserId, notifError);\n            }\n          })\n        );\n      } catch (notifError) {\n        console.error(\"Error sending task status change notifications:\", notifError);\n        // Bildirim hatas grev durumu gncellemesini engellemez\n      }\n    }\n  } catch (error: unknown) {\n    if (import.meta.env.DEV) {\n      console.error(\"Update task status error:\", error);\n    }\n    \n    // Firestore izin hatasn daha anlalr hale getir\n    const errorMsg = error instanceof Error ? error.message : String(error);\n    if (errorMsg.includes(\"Missing or insufficient permissions\") || errorMsg.includes(\"permission-denied\")) {\n      // Frontend'de izin kontrol yapld ama Firestore security rules izin vermiyor\n      // Bu durumda kullancya aklayc bir mesaj gster\n      throw new Error(\"Firestore gvenlik kurallar grev durumunu deitirmenize izin vermiyor. Ltfen yneticinizle iletiime gein.\");\n    }\n    \n    throw error;\n  }\n};\n\n/**\n * Grevi sil\n */\nexport const deleteTask = async (taskId: string, userId?: string): Promise<void> => {\n  try {\n    // Eski veriyi al\n    const oldTask = await getTaskById(taskId);\n    if (!oldTask) {\n      throw new Error(\"Grev bulunamad\");\n    }\n    \n    // Yetki kontrol\n    if (userId) {\n      const { getUserProfile } = await import(\"@/services/firebase/authService\");\n      const { canDeleteTask } = await import(\"@/utils/permissions\");\n      const userProfile = await getUserProfile(userId);\n      \n      if (!userProfile) {\n        throw new Error(\"Kullanc profili bulunamad\");\n      }\n      \n      const canDelete = await canDeleteTask(oldTask, userProfile);\n      if (!canDelete) {\n        throw new Error(\"Bu grevi silmek iin yetkiniz yok. Sadece yneticiler, ekip liderleri veya grevi oluturan kii silebilir.\");\n      }\n    }\n    \n    // Aktivite log ekle (silmeden nce)\n    if (userId && oldTask) {\n      try {\n        const { getUserProfile } = await import(\"./authService\");\n        const userProfile = await getUserProfile(userId);\n        const userName = userProfile?.fullName || userProfile?.displayName || userProfile?.email;\n        const userEmail = userProfile?.email;\n        \n        await addTaskActivity(\n          taskId,\n          userId,\n          \"deleted\",\n          `bu grevi sildi`,\n          { taskTitle: oldTask.title },\n          userName,\n          userEmail\n        );\n      } catch (error: unknown) {\n        if (import.meta.env.DEV) {\n          console.error(\"Add task activity error:\", error);\n        }\n      }\n    }\n\n    // Bildirim gndermek iin gerekli bilgileri al\n    let assignments: TaskAssignment[] = [];\n    let allUsers: UserProfile[] = [];\n    let deleterUser: UserProfile | undefined;\n    \n    try {\n      assignments = await getTaskAssignments(taskId);\n      allUsers = await getAllUsers();\n      deleterUser = allUsers.find(u => u.id === userId);\n    } catch (notifError) {\n      console.error(\"Error fetching data for notifications:\", notifError);\n      // Bildirim hatas grev silinmesini engellemez\n    }\n    \n    // nce subcollection'lar sil (assignments, checklists, attachments)\n    try {\n      // Assignments'lar sil\n      const assignmentsSnapshot = await getDocs(collection(firestore, \"tasks\", taskId, \"assignments\"));\n      const deleteAssignmentsPromises = assignmentsSnapshot.docs.map((doc) => deleteDoc(doc.ref));\n      await Promise.all(deleteAssignmentsPromises);\n      \n      // Checklists'leri sil\n      const checklistsSnapshot = await getDocs(collection(firestore, \"tasks\", taskId, \"checklists\"));\n      const deleteChecklistsPromises = checklistsSnapshot.docs.map((doc) => deleteDoc(doc.ref));\n      await Promise.all(deleteChecklistsPromises);\n      \n      // Attachments'lar sil (eer varsa)\n      try {\n        const attachmentsSnapshot = await getDocs(collection(firestore, \"tasks\", taskId, \"attachments\"));\n        const deleteAttachmentsPromises = attachmentsSnapshot.docs.map((doc) => deleteDoc(doc.ref));\n        await Promise.all(deleteAttachmentsPromises);\n      } catch (attachmentsError) {\n        // Attachments collection' yoksa hata verme\n        if (import.meta.env.DEV) {\n          console.warn(\"Attachments collection not found or error:\", attachmentsError);\n        }\n      }\n    } catch (subcollectionError) {\n      console.error(\"Error deleting subcollections:\", subcollectionError);\n      // Subcollection silme hatas grev silinmesini engellemez, devam et\n    }\n    \n    // Ana grev document'ini sil\n    await deleteDoc(doc(firestore, \"tasks\", taskId));\n    \n    // Audit log\n    if (userId) {\n      await logAudit(\"DELETE\", \"tasks\", taskId, userId, oldTask, null);\n    }\n    \n    // Bildirim gnder (grev silindikten sonra)\n    try {\n      const currentUser = auth?.currentUser;\n      \n      // Grevi oluturan kiiye bildirim gnder (silen kii hari)\n      if (oldTask.createdBy && oldTask.createdBy !== currentUser?.uid) {\n        try {\n          const deleteTime = new Date().toLocaleString('tr-TR', { day: 'numeric', month: 'long', year: 'numeric', hour: '2-digit', minute: '2-digit' });\n          await createNotification({\n            userId: oldTask.createdBy,\n            type: \"task_deleted\",\n            title: \"Grev silindi\",\n            message: `${deleterUser?.fullName || deleterUser?.email || \"Bir kullanc\"} kullancs tarafndan \"${oldTask.title}\" grevi silindi.\\n\\nGrev sistemden kalc olarak kaldrld. Bu ilem geri alnamaz.\\n\\nSilme Zaman: ${deleteTime}`,\n            read: false,\n            relatedId: taskId,\n            metadata: { \n              taskTitle: oldTask.title,\n              updatedAt: new Date(),\n            },\n          });\n        } catch (notifError) {\n          console.error(\"Error sending notification to task creator:\", notifError);\n        }\n      }\n      \n      // Atanan kullanclara bildirim gnder (silen kii hari)\n      const assignedUserIds = assignments\n        .filter(a => (a.status === \"accepted\" || a.status === \"pending\") && a.assignedTo !== currentUser?.uid)\n        .map(a => a.assignedTo);\n      \n      await Promise.all(\n        assignedUserIds.map(async (assignedUserId) => {\n          try {\n            const deleteTime = new Date().toLocaleString('tr-TR', { day: 'numeric', month: 'long', year: 'numeric', hour: '2-digit', minute: '2-digit' });\n            await createNotification({\n              userId: assignedUserId,\n              type: \"task_deleted\",\n              title: \"Grev silindi\",\n              message: `${deleterUser?.fullName || deleterUser?.email || \"Bir kullanc\"} kullancs tarafndan \"${oldTask.title}\" grevi silindi.\\n\\nGrev sistemden kalc olarak kaldrld. Bu ilem geri alnamaz.\\n\\nSilme Zaman: ${deleteTime}`,\n              read: false,\n              relatedId: taskId,\n              metadata: { \n                taskTitle: oldTask.title,\n                updatedAt: new Date(),\n              },\n            });\n          } catch (notifError) {\n            console.error(\"Error sending notification to assigned user:\", assignedUserId, notifError);\n          }\n        })\n      );\n    } catch (notifError) {\n      console.error(\"Error sending task deletion notifications:\", notifError);\n      // Bildirim hatas grev silinmesini engellemez\n    }\n  } catch (error: unknown) {\n    if (import.meta.env.DEV) {\n      console.error(\"Delete task error:\", error);\n    }\n    throw error;\n  }\n};\n\n/**\n * Grev atamas yap\n */\nexport const assignTask = async (\n  taskId: string,\n  userId: string,\n  assignedBy: string,\n  notes?: string\n): Promise<TaskAssignment> => {\n  try {\n    const assignmentData: Omit<TaskAssignment, \"id\"> = {\n      taskId,\n      assignedTo: userId,\n      assignedBy,\n      status: \"accepted\", // Otomatik kabul edildi - grevi oluturan kii kendisini atamsa zaten kabul etmi saylr\n      notes: notes || null,\n      assignedAt: Timestamp.now(),\n      acceptedAt: Timestamp.now(), // Otomatik kabul edildii iin assignedAt ile ayn\n      completedAt: null,\n    };\n\n    const docRef = await addDoc(\n      collection(firestore, \"tasks\", taskId, \"assignments\"),\n      assignmentData\n    );\n\n    // Task document'inde assignedUsers array'ini gncelle\n    const taskRef = doc(firestore, \"tasks\", taskId);\n    const taskSnap = await getDoc(taskRef);\n    if (taskSnap.exists()) {\n      const taskData = taskSnap.data();\n      const assignedUsers = taskData.assignedUsers || [];\n      if (!assignedUsers.includes(userId)) {\n        await updateDoc(taskRef, {\n          assignedUsers: [...assignedUsers, userId],\n        });\n      }\n    }\n\n    try {\n      const [task, assignerProfile] = await Promise.all([\n        getTaskById(taskId),\n        getUserProfile(assignedBy),\n      ]);\n\n      if (task) {\n        // Grev detaylarn topla\n        const taskDetails: string[] = [];\n        if (task.description) {\n          const desc = task.description.length > 100 ? task.description.substring(0, 100) + \"...\" : task.description;\n          taskDetails.push(`Aklama: ${desc}`);\n        }\n        if (task.priority) {\n          const { getPriorityLabel, convertOldPriorityToNew } = await import(\"@/utils/priority\");\n          // TaskService hala 1-5 kullanyor, yeni sisteme (0-5) evir\n          const newPriority = convertOldPriorityToNew(task.priority);\n          const priorityLabel = getPriorityLabel(newPriority);\n          taskDetails.push(`ncelik: ${priorityLabel}`);\n        }\n        if (task.dueDate) {\n          try {\n            const dueDate = task.dueDate instanceof Timestamp ? task.dueDate.toDate() : new Date(task.dueDate);\n            const formattedDate = dueDate.toLocaleDateString('tr-TR', { day: 'numeric', month: 'long', year: 'numeric', hour: '2-digit', minute: '2-digit' });\n            taskDetails.push(`Biti Tarihi: ${formattedDate}`);\n          } catch {\n            // Tarih format hatas durumunda sessizce devam et\n          }\n        }\n        \n        const detailsText = taskDetails.length > 0 ? `\\n\\nGrev Detaylar:\\n${taskDetails.join('\\n')}` : '';\n        \n        // Metadata iin Timestamp'leri Date'e evir\n        let dueDateForMetadata: Date | null = null;\n        if (task.dueDate) {\n          try {\n            const dueDateValue = task.dueDate as unknown;\n            if (dueDateValue instanceof Timestamp) {\n              dueDateForMetadata = (dueDateValue as Timestamp).toDate();\n            } else if (dueDateValue instanceof Date) {\n              dueDateForMetadata = dueDateValue;\n            } else if (typeof dueDateValue === 'object' && dueDateValue !== null && 'seconds' in dueDateValue) {\n              // Firestore Timestamp objesi\n              const ts = dueDateValue as { seconds: number; nanoseconds?: number };\n              dueDateForMetadata = new Date(ts.seconds * 1000 + (ts.nanoseconds || 0) / 1000000);\n            }\n          } catch {\n            // Tarih format hatas durumunda null brak\n            dueDateForMetadata = null;\n          }\n        }\n        \n        await createNotification({\n          userId,\n          type: \"task_assigned\",\n          title: \"Yeni grev atand\",\n          message: `${assignerProfile?.fullName || assignerProfile?.email || \"Bir ynetici\"} kullancs tarafndan size \"${task.title}\" balkl yeni bir grev atand.${detailsText}\\n\\nGrev detaylarn grntlemek iin bildirime tklayabilirsiniz.`,\n          read: false,\n          relatedId: taskId,\n          metadata: { \n            assignment_id: docRef.id,\n            priority: task.priority,\n            dueDate: dueDateForMetadata, // Date objesi olarak gnder\n            updatedAt: new Date(),\n          },\n        });\n      }\n    } catch (notifError) {\n      // Bildirim hatas kritik deil, sessizce devam et\n      // Uygulama akn bozma\n    }\n\n    // Audit log\n    if (assignedBy) {\n      await logAudit(\"CREATE\", \"task_assignments\", docRef.id, assignedBy, null, assignmentData);\n    }\n\n    return {\n      id: docRef.id,\n      ...assignmentData,\n    };\n  } catch (error: unknown) {\n    if (import.meta.env.DEV) {\n      console.error(\"Assign task error:\", error);\n    }\n    throw error;\n  }\n};\n\n/**\n * Grev atamasn kabul et\n */\nexport const acceptTaskAssignment = async (taskId: string, assignmentId: string): Promise<void> => {\n  try {\n    await updateDoc(doc(firestore, \"tasks\", taskId, \"assignments\", assignmentId), {\n      status: \"accepted\",\n      acceptedAt: serverTimestamp(),\n    });\n    \n    // Audit log\n    const userId = auth?.currentUser?.uid;\n    if (userId) {\n      const task = await getTaskById(taskId);\n      const assignmentDoc = await getDoc(doc(firestore, \"tasks\", taskId, \"assignments\", assignmentId));\n      const oldAssignment = assignmentDoc.data();\n      await logAudit(\n        \"UPDATE\",\n        \"task_assignments\",\n        assignmentId,\n        userId,\n        oldAssignment || { status: \"pending\" },\n        { status: \"accepted\", taskId: taskId, taskTitle: task?.title },\n        { action: \"accept\", taskId }\n      );\n    }\n    \n    // Atanan kullancnn bildirimini gncelle\n    try {\n      const assignment = await getDoc(doc(firestore, \"tasks\", taskId, \"assignments\", assignmentId));\n      const assignmentData = assignment.data() as TaskAssignment;\n      \n      if (assignmentData) {\n        // Atanan kullancnn bildirimlerini bul ve gncelle\n        const { getNotifications } = await import(\"./notificationService\");\n        const userNotifications = await getNotifications(assignmentData.assignedTo, { limit: 100 });\n        \n        // lgili bildirimi bul: task_assigned tipinde, assignment_id metadata's eleen\n        const relatedNotification = userNotifications.find((notif) => {\n          if (notif.type !== \"task_assigned\" || notif.relatedId !== taskId) return false;\n          const meta = notif.metadata;\n          if (meta && typeof meta === \"object\" && \"assignment_id\" in meta) {\n            return (meta as Record<string, unknown>).assignment_id === assignmentId;\n          }\n          return false;\n        });\n        \n        if (relatedNotification) {\n          // Bildirimi gncelle: action metadata ekle ve okundu iaretle\n          const updatedMetadata = { \n            ...relatedNotification.metadata, \n            action: \"accepted\" \n          };\n          await updateNotification(relatedNotification.id, {\n            metadata: updatedMetadata,\n            read: true\n          });\n        }\n      }\n    } catch (notifUpdateError) {\n      console.error(\"Error updating assignment notification:\", notifUpdateError);\n      // Bildirim gncelleme hatas kabul ilemini engellemez\n    }\n    \n    // Ekip liderlerine bildirim gnder\n    try {\n      const task = await getTaskById(taskId);\n      const assignment = await getDoc(doc(firestore, \"tasks\", taskId, \"assignments\", assignmentId));\n      const assignmentData = assignment.data() as TaskAssignment;\n      \n      if (task && assignmentData) {\n        const teamLeaders = await getTaskTeamLeaders(task);\n        const allUsers = await getAllUsers();\n        const assignedUser = allUsers.find(u => u.id === assignmentData.assignedTo);\n        \n        await Promise.all(\n          teamLeaders.map(async (leaderId) => {\n            try {\n              const acceptTime = new Date().toLocaleString('tr-TR', { day: 'numeric', month: 'long', year: 'numeric', hour: '2-digit', minute: '2-digit' });\n              await createNotification({\n                userId: leaderId,\n                type: \"task_assigned\",\n                title: \"Grev kabul edildi\",\n                message: `${assignedUser?.fullName || assignedUser?.email || \"Bir kullanc\"} kullancs \"${task.title}\" grevini kabul etti.\\n\\nGrev artk bu kullancnn grev listesinde grnecek ve zerinde almaya balayabilir.\\n\\nKabul Zaman: ${acceptTime}`,\n                read: false,\n                relatedId: taskId,\n                metadata: { \n                  assignment_id: assignmentId, \n                  action: \"accepted\",\n                  updatedAt: new Date(),\n                  priority: task.priority,\n                  dueDate: task.dueDate,\n                },\n              });\n            } catch (notifError) {\n              console.error(\"Error sending notification to team leader:\", leaderId, notifError);\n            }\n          })\n        );\n      }\n    } catch (notifError) {\n      console.error(\"Error sending acceptance notifications:\", notifError);\n      // Bildirim hatas kabul ilemini engellemez\n    }\n  } catch (error: unknown) {\n    if (import.meta.env.DEV) {\n      console.error(\"Accept task assignment error:\", error);\n    }\n    throw error;\n  }\n};\n\n/**\n * Grev atamasn reddet\n */\nexport const rejectTaskAssignment = async (\n  taskId: string,\n  assignmentId: string,\n  reason: string\n): Promise<void> => {\n  try {\n    // Red sebebi en az 20 karakter olmal\n    if (reason.trim().length < 20) {\n      throw new Error(\"Red sebebi en az 20 karakter olmaldr\");\n    }\n    \n    await updateDoc(doc(firestore, \"tasks\", taskId, \"assignments\", assignmentId), {\n      status: \"rejected\",\n      rejectionReason: reason.trim(),\n    });\n    \n    // Audit log\n    const userId = auth?.currentUser?.uid;\n    if (userId) {\n      const task = await getTaskById(taskId);\n      const assignmentDoc = await getDoc(doc(firestore, \"tasks\", taskId, \"assignments\", assignmentId));\n      const oldAssignment = assignmentDoc.data();\n      await logAudit(\n        \"UPDATE\",\n        \"task_assignments\",\n        assignmentId,\n        userId,\n        oldAssignment || { status: \"pending\" },\n        { status: \"rejected\", rejectionReason: reason.trim(), taskId: taskId, taskTitle: task?.title },\n        { action: \"reject\", taskId, reason: reason.trim() }\n      );\n    }\n    \n    // Atanan kullancnn bildirimini gncelle\n    try {\n      const assignment = await getDoc(doc(firestore, \"tasks\", taskId, \"assignments\", assignmentId));\n      const assignmentData = assignment.data() as TaskAssignment;\n      \n      if (assignmentData) {\n        // Atanan kullancnn bildirimlerini bul ve gncelle\n        const { getNotifications } = await import(\"./notificationService\");\n        const userNotifications = await getNotifications(assignmentData.assignedTo, { limit: 100 });\n        \n        // lgili bildirimi bul: task_assigned tipinde, assignment_id metadata's eleen\n        const relatedNotification = userNotifications.find((notif) => {\n          if (notif.type !== \"task_assigned\" || notif.relatedId !== taskId) return false;\n          const meta = notif.metadata;\n          if (meta && typeof meta === \"object\" && \"assignment_id\" in meta) {\n            return (meta as Record<string, unknown>).assignment_id === assignmentId;\n          }\n          return false;\n        });\n        \n        if (relatedNotification) {\n          // Bildirimi gncelle: action metadata ekle ve okundu iaretle\n          const updatedMetadata = { \n            ...relatedNotification.metadata, \n            action: \"rejected\" \n          };\n          await updateNotification(relatedNotification.id, {\n            metadata: updatedMetadata,\n            read: true\n          });\n        }\n      }\n    } catch (notifUpdateError) {\n      console.error(\"Error updating assignment notification:\", notifUpdateError);\n      // Bildirim gncelleme hatas red ilemini engellemez\n    }\n    \n    // Bildirimler gnder\n    try {\n      const task = await getTaskById(taskId);\n      const assignment = await getDoc(doc(firestore, \"tasks\", taskId, \"assignments\", assignmentId));\n      const assignmentData = assignment.data() as TaskAssignment;\n      \n      if (task && assignmentData) {\n        const allUsers = await getAllUsers();\n        const assignedUser = allUsers.find(u => u.id === assignmentData.assignedTo);\n        const taskCreator = allUsers.find(u => u.id === task.createdBy);\n        const assignerUser = allUsers.find(u => u.id === assignmentData.assignedBy);\n        \n        // 1. Grevi veren kiiye bildirim gnder (assignedBy) - NEML: Grevi veren kii reddi bilmeli\n        if (assignmentData.assignedBy && assignmentData.assignedBy !== auth?.currentUser?.uid) {\n          try {\n            const rejectTime = new Date().toLocaleString('tr-TR', { day: 'numeric', month: 'long', year: 'numeric', hour: '2-digit', minute: '2-digit' });\n            await createNotification({\n              userId: assignmentData.assignedBy,\n              type: \"task_assigned\",\n              title: \"Grev reddedildi\",\n              message: `${assignedUser?.fullName || assignedUser?.email || \"Bir kullanc\"} kullancs \"${task.title}\" grevini reddetti.\\n\\nReddetme Sebebi: ${reason.trim().substring(0, 200)}${reason.trim().length > 200 ? \"...\" : \"\"}\\n\\nReddetme Zaman: ${rejectTime}`,\n              read: false,\n              relatedId: taskId,\n              metadata: { \n                assignment_id: assignmentId, \n                action: \"rejected\", \n                reason: reason.trim(),\n                assigned_user_id: assignmentData.assignedTo,\n                updatedAt: new Date(),\n                priority: task.priority,\n                dueDate: task.dueDate,\n              },\n            });\n          } catch (notifError) {\n            console.error(\"Error sending notification to task assigner:\", notifError);\n          }\n        }\n        \n        // 2. Grevi tanmlayan kiiye bildirim gnder (createdBy) - Eer grevi veren kii deilse\n        if (task.createdBy && task.createdBy !== auth?.currentUser?.uid && task.createdBy !== assignmentData.assignedBy) {\n          try {\n            const rejectTime2 = new Date().toLocaleString('tr-TR', { day: 'numeric', month: 'long', year: 'numeric', hour: '2-digit', minute: '2-digit' });\n            await createNotification({\n              userId: task.createdBy,\n              type: \"task_assigned\",\n              title: \"Grev reddedildi - Onaynz gerekiyor\",\n              message: `${assignedUser?.fullName || assignedUser?.email || \"Bir kullanc\"} kullancs \"${task.title}\" grevini reddetti.\\n\\nReddetme Sebebi: ${reason.trim().substring(0, 200)}${reason.trim().length > 200 ? \"...\" : \"\"}\\n\\nReddetme Zaman: ${rejectTime2}\\n\\nLtfen bu reddi onaylayn veya reddedin. Reddin onaylanmas durumunda grev baka birine atanabilir.`,\n              read: false,\n              relatedId: taskId,\n              metadata: { \n                assignment_id: assignmentId, \n                action: \"rejection_pending_approval\", \n                reason: reason.trim(),\n                assigned_user_id: assignmentData.assignedTo,\n                updatedAt: new Date(),\n                priority: task.priority,\n                dueDate: task.dueDate,\n              },\n            });\n          } catch (notifError) {\n            console.error(\"Error sending notification to task creator:\", notifError);\n          }\n        }\n        \n        // 3. Ekip liderlerine bildirim gnder\n        const teamLeaders = await getTaskTeamLeaders(task);\n        await Promise.all(\n          teamLeaders\n            .filter(leaderId => leaderId !== task.createdBy && leaderId !== assignmentData.assignedBy) // Grevi tanmlayan ve veren zaten bildirim ald\n            .map(async (leaderId) => {\n              try {\n                await createNotification({\n                  userId: leaderId,\n                  type: \"task_assigned\",\n                  title: \"Grev reddedildi\",\n                  message: `${assignedUser?.fullName || assignedUser?.email || \"Bir kullanc\"} \"${task.title}\" grevini reddetti. Sebep: ${reason.trim().substring(0, 100)}${reason.trim().length > 100 ? \"...\" : \"\"}`,\n                  read: false,\n                  relatedId: taskId,\n                  metadata: { assignment_id: assignmentId, action: \"rejected\", reason: reason.trim() },\n                });\n              } catch (notifError) {\n                console.error(\"Error sending notification to team leader:\", leaderId, notifError);\n              }\n            })\n        );\n      }\n    } catch (notifError) {\n      console.error(\"Error sending rejection notifications:\", notifError);\n      // Bildirim hatas red ilemini engellemez\n    }\n  } catch (error: unknown) {\n    if (import.meta.env.DEV) {\n      console.error(\"Reject task assignment error:\", error);\n    }\n    throw error;\n  }\n};\n\n/**\n * Grev atamalarn al\n */\nexport const getTaskAssignments = async (taskId: string): Promise<TaskAssignment[]> => {\n  try {\n    const snapshot = await getDocs(collection(firestore, \"tasks\", taskId, \"assignments\"));\n    return snapshot.docs.map((doc) => ({\n      id: doc.id,\n      ...doc.data(),\n    })) as TaskAssignment[];\n  } catch (error: unknown) {\n    if (import.meta.env.DEV) {\n      console.error(\"Get task assignments error:\", error);\n    }\n    throw error;\n  }\n};\n\n/**\n * Grev atamasn sil\n */\nexport const deleteTaskAssignment = async (taskId: string, assignmentId: string, deletedBy?: string): Promise<void> => {\n  try {\n    // nce assignment bilgilerini al (bildirim iin) - SLME LEMNDEN NCE\n    const assignmentRef = doc(firestore, \"tasks\", taskId, \"assignments\", assignmentId);\n    const assignmentSnap = await getDoc(assignmentRef);\n    \n    if (!assignmentSnap.exists()) {\n      if (import.meta.env.DEV) {\n        console.warn(\" Assignment bulunamad, silme ilemi atlanyor:\", assignmentId);\n      }\n      return;\n    }\n    \n    const assignmentData = assignmentSnap.data() as TaskAssignment | undefined;\n    \n    // Assignment' sil\n    await deleteDoc(assignmentRef);\n    \n    // Task document'inde assignedUsers array'ini gncelle\n    if (assignmentData) {\n      const taskRef = doc(firestore, \"tasks\", taskId);\n      const taskSnap = await getDoc(taskRef);\n      if (taskSnap.exists()) {\n        const taskData = taskSnap.data();\n        const assignedUsers = taskData.assignedUsers || [];\n        if (assignedUsers.includes(assignmentData.assignedTo)) {\n          await updateDoc(taskRef, {\n            assignedUsers: assignedUsers.filter((uid: string) => uid !== assignmentData.assignedTo),\n          });\n        }\n      }\n      \n      // Bildirim gnder - kaldrlan kullancya\n      if (assignmentData) {\n        try {\n          const [task, deleterProfile, removedUser] = await Promise.all([\n            getTaskById(taskId),\n            deletedBy ? getUserProfile(deletedBy) : Promise.resolve(null),\n            getUserProfile(assignmentData.assignedTo),\n          ]);\n          \n          if (task && removedUser) {\n            // Kaldrlan kullancya bildirim\n            const removeTime = new Date().toLocaleString('tr-TR', { day: 'numeric', month: 'long', year: 'numeric', hour: '2-digit', minute: '2-digit' });\n            const removedUserNotification = await createNotification({\n              userId: assignmentData.assignedTo,\n              type: \"task_updated\",\n              title: \"Grev atamanz kaldrld\",\n              message: `${deleterProfile?.fullName || deleterProfile?.email || \"Bir ynetici\"} kullancs tarafndan siz \"${task.title}\" grevinden kaldrldnz.\\n\\nArtk bu grevle ilgili bildirimler almayacaksnz ve grev zerinde ilem yapamayacaksnz.\\n\\nKaldrlma Zaman: ${removeTime}`,\n              read: false,\n              relatedId: taskId,\n              metadata: { \n                assignment_id: assignmentId, \n                action: \"removed\",\n                updatedAt: new Date(),\n                priority: task.priority,\n                dueDate: task.dueDate,\n              },\n            });\n            \n            if (import.meta.env.DEV) {\n              console.log(\" Kaldrlan kullancya bildirim gnderildi:\", removedUserNotification.id);\n            }\n            \n            // Grevi oluturan kiiye bildirim (eer kaldran kii deilse)\n            if (task.createdBy && task.createdBy !== deletedBy && task.createdBy !== assignmentData.assignedTo) {\n              const removeTime2 = new Date().toLocaleString('tr-TR', { day: 'numeric', month: 'long', year: 'numeric', hour: '2-digit', minute: '2-digit' });\n              const creatorNotification = await createNotification({\n                userId: task.createdBy,\n                type: \"task_updated\",\n                title: \"Grev atamas kaldrld\",\n                message: `${deleterProfile?.fullName || deleterProfile?.email || \"Bir ynetici\"} kullancs tarafndan \"${removedUser?.fullName || removedUser?.email || \"bir kullanc\"}\" kullancs \"${task.title}\" grevinden kaldrld.\\n\\nBu kullanc artk grevle ilgili bildirimler almayacak ve grev zerinde ilem yapamayacak.\\n\\nKaldrlma Zaman: ${removeTime2}`,\n                read: false,\n                relatedId: taskId,\n                metadata: { \n                  assignment_id: assignmentId, \n                  action: \"removed\", \n                  removed_user_id: assignmentData.assignedTo,\n                  updatedAt: new Date(),\n                  priority: task.priority,\n                  dueDate: task.dueDate,\n                },\n              });\n              \n              if (import.meta.env.DEV) {\n                console.log(\" Grev oluturucuya bildirim gnderildi:\", creatorNotification.id);\n              }\n            }\n          } else {\n            if (import.meta.env.DEV) {\n              console.warn(\" Bildirim gnderilemedi: task veya removedUser bulunamad\", { task: !!task, removedUser: !!removedUser });\n            }\n          }\n        } catch (notifError) {\n          // Bildirim hatas silme ilemini engellemez\n          // Email servisi almyor olabilir, bu normal\n          if (import.meta.env.DEV) {\n            console.debug(\"Bildirim gnderilemedi (email servisi almyor olabilir)\");\n          }\n        }\n      }\n    }\n  } catch (error) {\n    if (import.meta.env.DEV) {\n      console.error(\"Delete task assignment error:\", error);\n    }\n    throw error;\n  }\n};\n\n/**\n * Checklist olutur\n */\nexport const createChecklist = async (\n  taskId: string,\n  title: string,\n  items: Array<{ text: string; completed?: boolean }>\n): Promise<Checklist> => {\n  try {\n    const checklistData: Omit<Checklist, \"id\"> = {\n      taskId,\n      title,\n      items: items.map((item) => ({\n        id: `${Date.now()}-${Math.random()}`,\n        text: item.text,\n        completed: item.completed || false,\n        createdAt: Timestamp.now(),\n        completedAt: null,\n      })),\n      createdAt: Timestamp.now(),\n      updatedAt: Timestamp.now(),\n    };\n\n    const docRef = await addDoc(\n      collection(firestore, \"tasks\", taskId, \"checklists\"),\n      checklistData\n    );\n\n    return {\n      id: docRef.id,\n      ...checklistData,\n    };\n  } catch (error: unknown) {\n    if (import.meta.env.DEV) {\n      console.error(\"Create checklist error:\", error);\n    }\n    throw error;\n  }\n};\n\n/**\n * Checklist item'n gncelle (tik atma)\n * Sadece greve atanan kullanclar ve yneticiler iaretleyebilir\n */\nexport const updateChecklistItem = async (\n  taskId: string,\n  checklistId: string,\n  itemId: string,\n  completed: boolean,\n  userId?: string\n): Promise<void> => {\n  try {\n    // Yetki kontrol: Sadece atanan kullanclar ve yneticiler iaretleyebilir\n    if (userId) {\n      const task = await getTaskById(taskId);\n      if (!task) {\n        throw new Error(\"Grev bulunamad\");\n      }\n\n      // Yetki kontrol: Firestore'dan kontrol et\n      const { getUserProfile } = await import(\"./authService\");\n      const userProfile = await getUserProfile(userId);\n      \n      if (userProfile) {\n        const { canAddChecklist } = await import(\"@/utils/permissions\");\n        const assignments = await getTaskAssignments(taskId);\n        const assignedUserIds = assignments\n          .filter((a) => a.status === \"accepted\" || a.status === \"pending\")\n          .map((a) => a.assignedTo);\n        \n        const canAdd = await canAddChecklist(task, userProfile, assignedUserIds);\n        if (!canAdd) {\n          throw new Error(\"Checklist iaretleme yetkiniz yok. Sadece size atanan grevlerin checklist'lerini iaretleyebilirsiniz.\");\n        }\n      }\n    }\n\n    const checklistRef = doc(firestore, \"tasks\", taskId, \"checklists\", checklistId);\n    const checklistDoc = await getDoc(checklistRef);\n    \n    if (!checklistDoc.exists()) {\n      throw new Error(\"Checklist bulunamad\");\n    }\n\n    const checklist = checklistDoc.data() as Checklist;\n    const updatedItems = checklist.items.map((item) =>\n      item.id === itemId\n        ? {\n            ...item,\n            completed,\n            completedAt: completed ? Timestamp.now() : null,\n          }\n        : item\n    );\n\n    await updateDoc(checklistRef, {\n      items: updatedItems,\n      updatedAt: serverTimestamp(),\n    });\n\n    // Audit log\n    await logAudit(\n      \"UPDATE\",\n      \"checklist_items\",\n      `${taskId}/${checklistId}/${itemId}`,\n      userId || auth?.currentUser?.uid || \"system\",\n      { completed: !completed },\n      { completed }\n    );\n  } catch (error: unknown) {\n    if (import.meta.env.DEV) {\n      console.error(\"Update checklist item error:\", error);\n    }\n    throw error;\n  }\n};\n\n/**\n * Checklist'leri al\n */\nexport const getChecklists = async (taskId: string): Promise<Checklist[]> => {\n  try {\n    const snapshot = await getDocs(collection(firestore, \"tasks\", taskId, \"checklists\"));\n    return snapshot.docs.map((doc) => ({\n      id: doc.id,\n      ...doc.data(),\n    })) as Checklist[];\n  } catch (error: unknown) {\n    if (import.meta.env.DEV) {\n      console.error(\"Get checklists error:\", error);\n    }\n    throw error;\n  }\n};\n\n/**\n * Checklist item ekle\n */\nexport const addChecklistItem = async (\n  taskId: string,\n  checklistId: string,\n  text: string\n): Promise<void> => {\n  try {\n    const checklistRef = doc(firestore, \"tasks\", taskId, \"checklists\", checklistId);\n    const checklistDoc = await getDoc(checklistRef);\n    \n    if (!checklistDoc.exists()) {\n      throw new Error(\"Checklist bulunamad\");\n    }\n\n    const checklist = checklistDoc.data() as Checklist;\n    const newItem: ChecklistItem = {\n      id: `${Date.now()}-${Math.random()}`,\n      text,\n      completed: false,\n      createdAt: Timestamp.now(),\n      completedAt: null,\n    };\n\n    await updateDoc(checklistRef, {\n      items: [...checklist.items, newItem],\n      updatedAt: serverTimestamp(),\n    });\n  } catch (error: unknown) {\n    if (import.meta.env.DEV) {\n      console.error(\"Add checklist item error:\", error);\n    }\n    throw error;\n  }\n};\n\n/**\n * Checklist sil\n */\nexport const deleteChecklist = async (taskId: string, checklistId: string, userId?: string): Promise<void> => {\n  try {\n    // Yetki kontrol: Firestore'dan kontrol et\n    if (userId) {\n      const task = await getTaskById(taskId);\n      if (!task) {\n        throw new Error(\"Grev bulunamad\");\n      }\n      \n      const { getUserProfile } = await import(\"./authService\");\n      const userProfile = await getUserProfile(userId);\n      \n      if (userProfile) {\n        const { canEditChecklist } = await import(\"@/utils/permissions\");\n        const assignments = await getTaskAssignments(taskId);\n        const assignedUserIds = assignments\n          .filter((a) => a.status === \"accepted\" || a.status === \"pending\")\n          .map((a) => a.assignedTo);\n        \n        const canEdit = await canEditChecklist(task, userProfile, assignedUserIds);\n        if (!canEdit) {\n          throw new Error(\"Checklist silme yetkiniz yok. Sadece greve atanan kullanclar veya yneticiler silebilir.\");\n        }\n      }\n    }\n    \n    await deleteDoc(doc(firestore, \"tasks\", taskId, \"checklists\", checklistId));\n  } catch (error: unknown) {\n    if (import.meta.env.DEV) {\n      console.error(\"Delete checklist error:\", error);\n    }\n    throw error;\n  }\n};\n\n/**\n * Checklist item sil\n */\nexport const deleteChecklistItem = async (\n  taskId: string,\n  checklistId: string,\n  itemId: string\n): Promise<void> => {\n  try {\n    const checklistRef = doc(firestore, \"tasks\", taskId, \"checklists\", checklistId);\n    const checklistDoc = await getDoc(checklistRef);\n    \n    if (!checklistDoc.exists()) {\n      throw new Error(\"Checklist bulunamad\");\n    }\n\n    const checklist = checklistDoc.data() as Checklist;\n    const updatedItems = checklist.items.filter((item) => item.id !== itemId);\n\n    await updateDoc(checklistRef, {\n      items: updatedItems,\n      updatedAt: serverTimestamp(),\n    });\n  } catch (error: unknown) {\n    if (import.meta.env.DEV) {\n      console.error(\"Delete checklist item error:\", error);\n    }\n    throw error;\n  }\n};\n\nexport interface TaskComment {\n  id: string;\n  taskId: string;\n  userId: string;\n  userName?: string;\n  userEmail?: string;\n  content: string;\n  createdAt: Timestamp;\n  updatedAt?: Timestamp | null;\n}\n\nexport interface TaskActivity {\n  id: string;\n  taskId: string;\n  userId: string;\n  userName?: string;\n  userEmail?: string;\n  action: string;\n  description: string;\n  metadata?: Record<string, any>;\n  createdAt: Timestamp;\n}\n\n/**\n * Yorum ekle\n */\nexport const addTaskComment = async (\n  taskId: string,\n  userId: string,\n  content: string,\n  userName?: string,\n  userEmail?: string\n): Promise<TaskComment> => {\n  try {\n    const commentData: Omit<TaskComment, \"id\"> = {\n      taskId,\n      userId,\n      userName,\n      userEmail,\n      content,\n      createdAt: Timestamp.now(),\n      updatedAt: null,\n    };\n\n    const docRef = await addDoc(\n      collection(firestore, \"tasks\", taskId, \"comments\"),\n      commentData\n    );\n\n    // Activity log ekle\n    await addTaskActivity(taskId, userId, \"commented\", `yorum ekledi`, { commentId: docRef.id }, userName, userEmail);\n\n    // Grevi oluturan kiiye bildirim gnder (yorum ekleyen kii hari)\n    try {\n      const task = await getTaskById(taskId);\n      if (task?.createdBy && task.createdBy !== userId) {\n        const { createNotification } = await import(\"@/services/firebase/notificationService\");\n        await createNotification({\n          userId: task.createdBy,\n          type: \"comment_added\",\n          title: \"Grevinize Yorum Eklendi\",\n          message: `${userName || userEmail || \"Bir kullanc\"} kullancs \"${task.title || \"Grev\"}\" grevinize yorum ekledi.\\n\\nYorum: ${content.substring(0, 200)}${content.length > 200 ? \"...\" : \"\"}\\n\\nYorumu grntlemek ve yantlamak iin bildirime tklayabilirsiniz.\\n\\nYorum Zaman: ${new Date().toLocaleString('tr-TR', { day: 'numeric', month: 'long', year: 'numeric', hour: '2-digit', minute: '2-digit' })}`,\n          read: false,\n          relatedId: taskId,\n          metadata: { \n            commentId: docRef.id, \n            commenterId: userId, \n            commenterName: userName, \n            commenterEmail: userEmail,\n            updatedAt: new Date(),\n          },\n        });\n      }\n    } catch (error: unknown) {\n      if (import.meta.env.DEV) {\n        console.error(\"Send comment notification error:\", error);\n      }\n    }\n\n    return {\n      id: docRef.id,\n      ...commentData,\n    };\n  } catch (error: unknown) {\n    if (import.meta.env.DEV) {\n      console.error(\"Add task comment error:\", error);\n    }\n    throw error;\n  }\n};\n\n/**\n * Yorumlar al\n */\nexport const getTaskComments = async (taskId: string): Promise<TaskComment[]> => {\n  try {\n    const snapshot = await getDocs(\n      query(\n        collection(firestore, \"tasks\", taskId, \"comments\"),\n        orderBy(\"createdAt\", \"desc\")\n      )\n    );\n    return snapshot.docs.map((doc) => ({\n      id: doc.id,\n      ...doc.data(),\n    })) as TaskComment[];\n  } catch (error: unknown) {\n    if (import.meta.env.DEV) {\n      console.error(\"Get task comments error:\", error);\n    }\n    throw error;\n  }\n};\n\n/**\n * Aktivite log ekle\n */\nexport const addTaskActivity = async (\n  taskId: string,\n  userId: string,\n  action: string,\n  description: string,\n  metadata?: Record<string, any>,\n  userName?: string,\n  userEmail?: string\n): Promise<string> => {\n  try {\n    const activityData: Omit<TaskActivity, \"id\"> = {\n      taskId,\n      userId,\n      userName,\n      userEmail,\n      action,\n      description,\n      metadata: metadata || {},\n      createdAt: Timestamp.now(),\n    };\n\n    const docRef = await addDoc(\n      collection(firestore, \"tasks\", taskId, \"activities\"),\n      activityData\n    );\n\n    return docRef.id;\n  } catch (error: unknown) {\n    // Firestore security rules hatas normal - sessizce handle et\n    // Bu hata grev gncellemesini engellemez\n    if (import.meta.env.DEV) {\n      // Sadece development'ta debug log gster\n      const errorMsg = error instanceof Error ? error.message : String(error);\n      if (!errorMsg.includes(\"Missing or insufficient permissions\")) {\n        // zin hatas deilse log gster (gerek bir sorun olabilir)\n        console.debug(\"Add task activity error:\", error);\n      }\n    }\n    return \"\";\n  }\n};\n\n/**\n * Aktivite loglarn al\n */\nexport const getTaskActivities = async (taskId: string): Promise<TaskActivity[]> => {\n  try {\n    const snapshot = await getDocs(\n      query(\n        collection(firestore, \"tasks\", taskId, \"activities\"),\n        orderBy(\"createdAt\", \"desc\")\n      )\n    );\n    return snapshot.docs.map((doc) => ({\n      id: doc.id,\n      ...doc.data(),\n    })) as TaskActivity[];\n  } catch (error: unknown) {\n    if (import.meta.env.DEV) {\n      console.error(\"Get task activities error:\", error);\n    }\n    throw error;\n  }\n};\n\n/**\n * Grev ekini ekle\n * NEML: Sadece greve atanan kullanclar veya grevi oluturan kii dosya ekleyebilir\n */\nexport const addTaskAttachment = async (\n  taskId: string,\n  attachment: Omit<TaskAttachment, \"id\" | \"uploadedAt\">\n): Promise<TaskAttachment> => {\n  try {\n    // nce grevi kontrol et\n    const task = await getTaskById(taskId);\n    if (!task) {\n      throw new Error(\"Grev bulunamad\");\n    }\n\n    // Kullanc kontrol\n    const currentUserId = auth?.currentUser?.uid;\n    if (!currentUserId) {\n      throw new Error(\"Kullanc oturumu bulunamad\");\n    }\n\n    // Kullanc profilini al (admin kontrol iin)\n    const userProfile = await getUserProfile(currentUserId);\n    if (!userProfile) {\n      throw new Error(\"Kullanc profili bulunamad\");\n    }\n\n    // Admin kontrol - adminler her zaman dosya ekleyebilir\n    const { isAdmin: checkIsAdmin, isMainAdmin } = await import(\"@/utils/permissions\");\n    const isAdmin = await checkIsAdmin(userProfile) || await isMainAdmin(userProfile);\n\n    // Eer admin deilse, greve atanm olup olmadn veya grevi oluturmu olup olmadn kontrol et\n    if (!isAdmin) {\n      const isCreator = task.createdBy === currentUserId;\n      \n      if (!isCreator) {\n        // Greve atanm olup olmadn kontrol et\n        const assignments = await getTaskAssignments(taskId);\n        const assignedUserIds = assignments\n          .filter(a => a.status === \"accepted\") // Sadece kabul edilen atamalar\n          .map(a => a.assignedTo);\n        \n        const isAssigned = assignedUserIds.includes(currentUserId);\n        \n        if (!isAssigned) {\n          throw new Error(\"Bu greve dosya eklemek iin yetkiniz yok. Sadece size atanan grevlere veya oluturduunuz grevlere dosya ekleyebilirsiniz.\");\n        }\n      }\n    }\n\n    const attachmentData = {\n      ...attachment,\n      uploadedAt: serverTimestamp(),\n    };\n\n    const docRef = await addDoc(\n      collection(firestore, \"tasks\", taskId, \"attachments\"),\n      attachmentData\n    );\n\n    const createdAttachment = await getDoc(docRef);\n    return {\n      id: docRef.id,\n      ...createdAttachment.data(),\n      uploadedAt: createdAttachment.data()?.uploadedAt || Timestamp.now(),\n    } as TaskAttachment;\n  } catch (error: unknown) {\n    if (import.meta.env.DEV) {\n      console.error(\"Add task attachment error:\", error);\n    }\n    throw error;\n  }\n};\n\n/**\n * Grev eklerini al\n */\nexport const getTaskAttachments = async (taskId: string): Promise<TaskAttachment[]> => {\n  try {\n    const snapshot = await getDocs(\n      query(\n        collection(firestore, \"tasks\", taskId, \"attachments\"),\n        orderBy(\"uploadedAt\", \"desc\")\n      )\n    );\n    return snapshot.docs.map((doc) => ({\n      id: doc.id,\n      ...doc.data(),\n    })) as TaskAttachment[];\n  } catch (error: unknown) {\n    if (import.meta.env.DEV) {\n      console.error(\"Get task attachments error:\", error);\n    }\n    throw error;\n  }\n};\n\n/**\n * Grev ekini sil\n * NEML: Sadece greve atanan kullanclar, grevi oluturan kii veya adminler dosya silebilir\n */\nexport const deleteTaskAttachment = async (taskId: string, attachmentId: string): Promise<void> => {\n  try {\n    // nce grevi kontrol et\n    const task = await getTaskById(taskId);\n    if (!task) {\n      throw new Error(\"Grev bulunamad\");\n    }\n\n    // Kullanc kontrol\n    const currentUserId = auth?.currentUser?.uid;\n    if (!currentUserId) {\n      throw new Error(\"Kullanc oturumu bulunamad\");\n    }\n\n    // Kullanc profilini al (admin kontrol iin)\n    const userProfile = await getUserProfile(currentUserId);\n    if (!userProfile) {\n      throw new Error(\"Kullanc profili bulunamad\");\n    }\n\n    // Admin kontrol - adminler her zaman dosya silebilir\n    const { isAdmin: checkIsAdmin, isMainAdmin } = await import(\"@/utils/permissions\");\n    const isAdmin = await checkIsAdmin(userProfile) || await isMainAdmin(userProfile);\n\n    // Eer admin deilse, greve atanm olup olmadn veya grevi oluturmu olup olmadn kontrol et\n    if (!isAdmin) {\n      const isCreator = task.createdBy === currentUserId;\n      \n      if (!isCreator) {\n        // Greve atanm olup olmadn kontrol et\n        const assignments = await getTaskAssignments(taskId);\n        const assignedUserIds = assignments\n          .filter(a => a.status === \"accepted\") // Sadece kabul edilen atamalar\n          .map(a => a.assignedTo);\n        \n        const isAssigned = assignedUserIds.includes(currentUserId);\n        \n        if (!isAssigned) {\n          throw new Error(\"Bu grevden dosya silmek iin yetkiniz yok. Sadece size atanan grevlerden veya oluturduunuz grevlerden dosya silebilirsiniz.\");\n        }\n      }\n    }\n\n    await deleteDoc(doc(firestore, \"tasks\", taskId, \"attachments\", attachmentId));\n  } catch (error: unknown) {\n    if (import.meta.env.DEV) {\n      console.error(\"Delete task attachment error:\", error);\n    }\n    throw error;\n  }\n};\n\n/**\n * Grevi havuza ekle\n */\nexport const addTaskToPool = async (taskId: string): Promise<void> => {\n  try {\n    // nce grev bilgilerini al\n    const taskRef = doc(firestore, \"tasks\", taskId);\n    const taskSnap = await getDoc(taskRef);\n    \n    if (!taskSnap.exists()) {\n      throw new Error(\"Grev bulunamad\");\n    }\n    \n    const taskData = taskSnap.data() as Task;\n    \n    // Grevi havuza ekle\n    await updateDoc(taskRef, {\n      isInPool: true,\n      poolRequests: [],\n      updatedAt: serverTimestamp(),\n    });\n\n    // Audit log\n    await logAudit(\"UPDATE\", \"tasks\", taskId, auth?.currentUser?.uid || \"system\", { isInPool: false }, { isInPool: true });\n\n    // Tm yelere bildirim gnder\n    try {\n      const allUsers = await getAllUsers();\n      const currentUserId = auth?.currentUser?.uid;\n      const currentUser = await getUserProfile(currentUserId || \"\");\n      const currentUserName = currentUser?.fullName || currentUser?.displayName || currentUser?.email || \"Bir kullanc\";\n      \n      // Grevi oluturan hari tm kullanclara bildirim gnder\n      const notificationPromises = allUsers\n        .filter(user => user.id && user.id !== currentUserId && user.id !== taskData.createdBy)\n        .map(user => \n          createNotification({\n            userId: user.id,\n            type: \"task_pool_request\",\n            title: \"Grev Havuzuna Yeni Grev Eklendi\",\n            message: `${currentUserName} \"${taskData.title}\" grevini grev havuzuna ekledi. Bu grevi talep edebilirsiniz.`,\n            read: false,\n            metadata: {\n              taskId: taskId,\n              taskTitle: taskData.title,\n              addedBy: currentUserId,\n              addedByName: currentUserName,\n              link: `/tasks?taskId=${taskId}&view=list`,\n            },\n          })\n        );\n      \n      await Promise.all(notificationPromises);\n    } catch (notificationError) {\n      if (import.meta.env.DEV) {\n        console.error(\"Bildirim gnderme hatas:\", notificationError);\n      }\n      // Bildirim hatas grevi havuza eklemeyi engellemez\n    }\n  } catch (error: unknown) {\n    if (import.meta.env.DEV) {\n      console.error(\"Add task to pool error:\", error);\n    }\n    throw error;\n  }\n};\n\n/**\n * Grevi havuzdan kar\n */\nexport const removeTaskFromPool = async (taskId: string): Promise<void> => {\n  try {\n    await updateDoc(doc(firestore, \"tasks\", taskId), {\n      isInPool: false,\n      poolRequests: [],\n      updatedAt: serverTimestamp(),\n    });\n  } catch (error: unknown) {\n    if (import.meta.env.DEV) {\n      console.error(\"Remove task from pool error:\", error);\n    }\n    throw error;\n  }\n};\n\n/**\n * Grev havuzundan grev talep et\n */\nexport const requestTaskFromPool = async (taskId: string, userId: string): Promise<void> => {\n  try {\n    const taskRef = doc(firestore, \"tasks\", taskId);\n    const taskSnap = await getDoc(taskRef);\n    \n    if (!taskSnap.exists()) {\n      throw new Error(\"Grev bulunamad\");\n    }\n    \n    const taskData = taskSnap.data();\n    const poolRequests = taskData.poolRequests || [];\n    \n    if (poolRequests.includes(userId)) {\n      throw new Error(\"Bu grev iin zaten talep yaptnz\");\n    }\n    \n    await updateDoc(taskRef, {\n      poolRequests: [...poolRequests, userId],\n      updatedAt: serverTimestamp(),\n    });\n\n    // Audit log\n    await logAudit(\"UPDATE\", \"tasks\", taskId, userId, { poolRequests }, { poolRequests: [...poolRequests, userId] });\n\n    // Grevi havuza ekleyen kiiye bildirim gnder (grevi oluturan kii)\n    // Not: Grev havuzuna ekleme ilemi genellikle grevi oluturan kii tarafndan yaplr\n    const taskCreatorId = taskData.createdBy;\n    if (taskCreatorId && taskCreatorId !== userId) {\n      try {\n        const requestingUser = await getUserProfile(userId);\n        const requestingUserName = requestingUser?.fullName || requestingUser?.displayName || requestingUser?.email || \"Bir kullanc\";\n        \n        await createNotification({\n          userId: taskCreatorId,\n          type: \"task_pool_request\",\n          title: \"Grev Havuzu Talebi\",\n          message: `${requestingUserName} \"${taskData.title}\" grevi iin talep gnderdi. Talebi onaylayabilirsiniz.`,\n          read: false,\n          relatedId: taskId, // Ynlendirme iin gerekli\n          metadata: {\n            taskId: taskId,\n            taskTitle: taskData.title,\n            requestedBy: userId,\n            requestedByName: requestingUserName,\n            link: `/tasks?taskId=${taskId}&view=list`,\n          },\n        });\n      } catch (notificationError) {\n        if (import.meta.env.DEV) {\n          console.error(\"Bildirim gnderme hatas:\", notificationError);\n        }\n        // Bildirim hatas grev talebini engellemez\n      }\n    }\n  } catch (error: unknown) {\n    if (import.meta.env.DEV) {\n      console.error(\"Request task from pool error:\", error);\n    }\n    throw error;\n  }\n};\n\n/**\n * Grev havuzu talebini onayla\n */\nexport const approvePoolRequest = async (taskId: string, userId: string, approvedBy: string, keepInPool: boolean = false): Promise<void> => {\n  try {\n    const taskRef = doc(firestore, \"tasks\", taskId);\n    const taskSnap = await getDoc(taskRef);\n    \n    if (!taskSnap.exists()) {\n      throw new Error(\"Grev bulunamad\");\n    }\n    \n    const taskData = taskSnap.data() as Task;\n    const poolRequests = taskData.poolRequests || [];\n    \n    if (!poolRequests.includes(userId)) {\n      throw new Error(\"Bu kullanc iin talep bulunamad\");\n    }\n    \n    // Grevi havuza ekleyen kii kontrol (genellikle grevi oluturan kii)\n    // Not: Grev havuzuna ekleme ilemi genellikle grevi oluturan kii tarafndan yaplr\n    if (taskData.createdBy !== approvedBy) {\n      throw new Error(\"Sadece grevi havuza ekleyen kii talepleri onaylayabilir\");\n    }\n    \n    // Kullancy greve ata\n    const assignment = await assignTask(taskId, userId, approvedBy);\n\n    // Grev havuzu talebi onaylandnda grev otomatik olarak kabul edilir\n    // Assignment' direkt \"accepted\" olarak gncelle\n    const assignmentRef = doc(firestore, \"tasks\", taskId, \"assignments\", assignment.id);\n    await updateDoc(assignmentRef, {\n      status: \"accepted\",\n      acceptedAt: serverTimestamp() as any,\n    });\n\n    // Havuz durumunu gncelle\n    const updates: Partial<Task> & { poolRequests?: string[]; updatedAt?: FieldValue | Timestamp } = {\n      poolRequests: poolRequests.filter((id: string) => id !== userId), // Sadece onaylanan kullancy taleplerden kar\n      updatedAt: serverTimestamp() as any,\n    };\n\n    if (!keepInPool) {\n      updates.isInPool = false;\n      updates.poolRequests = []; // Havuzdan kyorsa tm talepleri temizle\n    }\n\n    await updateDoc(taskRef, updates);\n\n    // assignTask'n gnderdii bildirimi bulup gncelle - \"Talebiniz onayland, bu greve atandnz\"\n    try {\n      const { getNotifications, updateNotification } = await import(\"./notificationService\");\n      const [task, approverProfile, notifications] = await Promise.all([\n        getTaskById(taskId),\n        getUserProfile(approvedBy),\n        getNotifications(userId, { limit: 10 }), // Son 10 bildirimi al\n      ]);\n\n      if (task) {\n        // assignTask'n gnderdii bildirimi bul (assignment_id ve relatedId ile eleen)\n        const assignmentNotification = notifications.find(\n          (n) => \n            n.type === \"task_assigned\" && \n            n.relatedId === taskId && \n            n.metadata?.assignment_id === assignment.id &&\n            !n.read\n        );\n\n        if (assignmentNotification) {\n          // Bildirimi gncelle\n          await updateNotification(assignmentNotification.id, {\n            title: \"Grev havuzu talebiniz onayland\",\n            message: `${approverProfile?.fullName || approverProfile?.email || \"Bir ynetici\"} kullancs grev havuzu talebinizi onaylad. \"${task.title}\" grevine atandnz ve grev otomatik olarak kabul edildi.`,\n            metadata: {\n              ...assignmentNotification.metadata,\n              action: \"pool_request_approved\",\n            },\n          });\n        } else {\n          // Bildirim bulunamadysa yeni bir bildirim gnder\n          await createNotification({\n            userId,\n            type: \"task_assigned\",\n            title: \"Grev havuzu talebiniz onayland\",\n            message: `${approverProfile?.fullName || approverProfile?.email || \"Bir ynetici\"} kullancs grev havuzu talebinizi onaylad. \"${task.title}\" grevine atandnz ve grev otomatik olarak kabul edildi.`,\n            read: false,\n            relatedId: taskId,\n            metadata: { \n              assignment_id: assignment.id,\n              action: \"pool_request_approved\",\n              priority: task.priority,\n              dueDate: task.dueDate,\n              updatedAt: new Date(),\n            },\n          });\n        }\n      }\n    } catch (notifError) {\n      // Bildirim hatas kritik deil, sessizce devam et\n      if (import.meta.env.DEV) {\n        console.error(\"Error updating pool request approval notification:\", notifError);\n      }\n    }\n\n    // Audit log\n    await logAudit(\"UPDATE\", \"tasks\", taskId, approvedBy, { isInPool: true, poolRequests }, { isInPool: keepInPool, poolRequests: updates.poolRequests, assignedTo: userId });\n    await logAudit(\"UPDATE\", \"task_assignments\", assignment.id, approvedBy, { status: \"pending\" }, { status: \"accepted\", taskId: taskId, taskTitle: taskData.title });\n  } catch (error: unknown) {\n    if (import.meta.env.DEV) {\n      console.error(\"Approve pool request error:\", error);\n    }\n    throw error;\n  }\n};\n\n/**\n * Grev havuzu talebini reddet\n */\nexport const rejectPoolRequest = async (taskId: string, userId: string): Promise<void> => {\n  try {\n    const taskRef = doc(firestore, \"tasks\", taskId);\n    const taskSnap = await getDoc(taskRef);\n    \n    if (!taskSnap.exists()) {\n      throw new Error(\"Grev bulunamad\");\n    }\n    \n    const taskData = taskSnap.data();\n    const poolRequests = taskData.poolRequests || [];\n    \n    if (!poolRequests.includes(userId)) {\n      throw new Error(\"Bu kullanc iin talep bulunamad\");\n    }\n    \n    await updateDoc(taskRef, {\n      poolRequests: poolRequests.filter((id: string) => id !== userId),\n      updatedAt: serverTimestamp(),\n    });\n\n    // Audit log\n    await logAudit(\"UPDATE\", \"tasks\", taskId, auth?.currentUser?.uid || \"system\", { poolRequests }, { poolRequests: poolRequests.filter((id: string) => id !== userId), rejectedUser: userId });\n  } catch (error: unknown) {\n    if (import.meta.env.DEV) {\n      console.error(\"Reject pool request error:\", error);\n    }\n    throw error;\n  }\n};\n\n/**\n * Grev onay istei gnder (completed  pending approval)\n * NEML: Sadece greve atanan kullanclar onaya gnderebilir\n */\nexport const requestTaskApproval = async (taskId: string, requestedBy: string): Promise<void> => {\n  try {\n    // nce grevi ve atamalar kontrol et\n    const task = await getTaskById(taskId);\n    if (!task) {\n      throw new Error(\"Grev bulunamad\");\n    }\n\n    // Eer zaten onay bekleniyorsa, tekrar bildirim gnderme\n    if (task.approvalStatus === \"pending\") {\n      // Zaten pending durumunda, sadece gncelleme yapma\n      return;\n    }\n\n    // Eer zaten onaylandysa, hata frlat\n    if (task.approvalStatus === \"approved\") {\n      throw new Error(\"Bu grev zaten onaylanm.\");\n    }\n\n    // Kullanc profilini al (admin kontrol iin)\n    const requesterProfile = await getUserProfile(requestedBy);\n    if (!requesterProfile) {\n      throw new Error(\"Kullanc profili bulunamad\");\n    }\n\n    // Admin kontrol - adminler her zaman onaya gnderebilir\n    const { isAdmin: checkIsAdmin, isMainAdmin } = await import(\"@/utils/permissions\");\n    const isAdmin = await checkIsAdmin(requesterProfile) || await isMainAdmin(requesterProfile);\n    \n    // Eer admin deilse, greve atanm olup olmadn kontrol et\n    if (!isAdmin) {\n      const assignments = await getTaskAssignments(taskId);\n      const assignedUserIds = assignments\n        .filter(a => a.status === \"accepted\") // Sadece kabul edilen atamalar\n        .map(a => a.assignedTo);\n      \n      const isAssigned = assignedUserIds.includes(requestedBy);\n      \n      if (!isAssigned) {\n        throw new Error(\"Bu grevi onaya gndermek iin yetkiniz yok. Sadece size atanan grevleri onaya gnderebilirsiniz.\");\n      }\n    }\n\n    // Grev oluturan kii direkt tamamlayabilir, onaya gndermesine gerek yok\n    // Ama eer zaten onaya gnderiyorsa, bu durumda izin ver (belki bir hata durumu)\n    \n    await updateDoc(doc(firestore, \"tasks\", taskId), {\n      approvalStatus: \"pending\",\n      approvalRequestedBy: requestedBy,\n      updatedAt: serverTimestamp(),\n    });\n\n    // Audit log for approval request\n    await logAudit(\"UPDATE\", \"tasks\", taskId, requestedBy, { approvalStatus: task.approvalStatus || \"none\" }, { approvalStatus: \"pending\" });\n\n    // Grev sahibine (yneticiye) bildirim gnder - sadece duplicate kontrol ile\n    try {\n      if (task && task.createdBy) {\n        // Ayn trde ve ayn grev iin okunmam bildirim var m kontrol et\n        let duplicateExists = false;\n        try {\n          const { getNotifications } = await import(\"./notificationService\");\n          const existingNotifications = await getNotifications(task.createdBy, { unreadOnly: true });\n          duplicateExists = existingNotifications.some(\n            n => n.type === \"task_approval\" && \n                 n.relatedId === taskId && \n                 n.metadata?.action === \"approval_requested\"\n          );\n        } catch (getNotifError) {\n          // Index hatas veya baka bir hata - duplicate kontroln atla ve bildirim oluturmay dene\n          if (import.meta.env.DEV) {\n            console.warn(\"Bildirim duplicate kontrol yaplamad, bildirim oluturulacak:\", getNotifError);\n          }\n          duplicateExists = false; // Hata durumunda duplicate kontroln atla\n        }\n\n        if (!duplicateExists) {\n          try {\n            await createNotification({\n              userId: task.createdBy,\n              type: \"task_approval\",\n              title: \"Grev onay bekleniyor\",\n              message: `${requesterProfile?.fullName || requesterProfile?.email || \"Bir kullanc\"} kullancs \"${task.title}\" grevini tamamlad ve onaynz bekliyor.\\n\\n\"${task.title}\" balkl grev iin onay talebi gnderildi. Ltfen grevi inceleyip onaylayn veya gerekirse geri gnderin.\\n\\nlem Zaman: ${new Date().toLocaleString('tr-TR', { day: 'numeric', month: 'long', year: 'numeric', hour: '2-digit', minute: '2-digit' })}`,\n              read: false,\n              relatedId: taskId,\n              metadata: { \n                action: \"approval_requested\",\n                updatedAt: new Date(),\n                priority: task.priority,\n                dueDate: task.dueDate,\n              },\n            });\n          } catch (createNotifError) {\n            // Bildirim oluturma hatas (email CORS hatas vb.) - kritik deil, sadece logla\n            if (import.meta.env.DEV) {\n              console.warn(\"Bildirim oluturulamad (email hatas vb. kritik deil):\", createNotifError);\n            }\n          }\n        }\n      }\n    } catch (notifError) {\n      // Genel bildirim hatas - kritik deil, sadece logla\n      if (import.meta.env.DEV) {\n        console.warn(\"Bildirim gnderme hatas (kritik deil):\", notifError);\n      }\n    }\n  } catch (error: unknown) {\n    if (import.meta.env.DEV) {\n      console.error(\"Request task approval error:\", error);\n    }\n    throw error;\n  }\n};\n\n/**\n * Grev onayn onayla - Onaylandnda \"Onayland\" (approved) durumuna geer ve status \"completed\" olur\n * Sadece ynetici veya grevi veren ekip lideri onaylayabilir\n */\nexport const approveTask = async (taskId: string, approvedBy: string): Promise<void> => {\n  try {\n    const task = await getTaskById(taskId);\n    if (!task) {\n      throw new Error(\"Grev bulunamad\");\n    }\n\n    // Eer zaten onaylandysa, hata frlat\n    if (task.approvalStatus === \"approved\") {\n      throw new Error(\"Bu grev zaten onaylanm. Tekrar onaylanamaz.\");\n    }\n\n    // Eer onay beklenmiyorsa, hata frlat\n    if (task.approvalStatus !== \"pending\") {\n      throw new Error(\"Bu grev onay beklenmiyor.\");\n    }\n\n    // Yetki kontrol: Sadece ynetici veya grevi veren ekip lideri onaylayabilir\n    const approverProfile = await getUserProfile(approvedBy);\n    if (!approverProfile) {\n      throw new Error(\"Kullanc profili bulunamad\");\n    }\n\n    const { isAdmin: checkIsAdmin, isMainAdmin } = await import(\"@/utils/permissions\");\n    const isAdmin = await checkIsAdmin(approverProfile) || await isMainAdmin(approverProfile);\n    const isTeamLeader = approverProfile.role?.includes(\"team_leader\");\n    const isCreator = task.createdBy === approvedBy;\n\n    // Ynetici veya grevi veren ekip lideri onaylayabilir\n    // Ekip lideri kontrol iin role_permissions sisteminden kontrol et\n    const { canPerformSubPermission } = await import(\"@/utils/permissions\");\n    const canApprove = await canPerformSubPermission(approverProfile, \"tasks\", \"canApprove\");\n    const hasTeamLeaderPermission = isTeamLeader && (canApprove || isCreator);\n\n    if (!isAdmin && !hasTeamLeaderPermission) {\n      throw new Error(\"Bu grevi onaylamak iin yetkiniz yok. Sadece yneticiler veya grevi veren ekip liderleri onaylayabilir.\");\n    }\n\n    const oldStatus = task.status;\n    const currentUser = auth?.currentUser;\n\n    await updateDoc(doc(firestore, \"tasks\", taskId), {\n      approvalStatus: \"approved\",\n      status: \"completed\", // Onaylannca \"Tamamland\" durumuna geer\n      approvedBy: approvedBy,\n      approvedAt: serverTimestamp(),\n      updatedAt: serverTimestamp(),\n    });\n\n    // Status deitiyse gncelleyen bilgisi ekle\n    if (oldStatus !== \"completed\" && currentUser?.uid) {\n      await updateDoc(doc(firestore, \"tasks\", taskId), {\n        statusUpdatedBy: currentUser.uid,\n        statusUpdatedAt: serverTimestamp(),\n      });\n    }\n\n    // Audit log for approval\n    await logAudit(\"UPDATE\", \"tasks\", taskId, approvedBy, { approvalStatus: \"pending\", status: oldStatus }, { approvalStatus: \"approved\", status: \"completed\" });\n\n    // Onay isteyene ve atanan kiilere bildirim gnder\n    try {\n      const updatedTask = await getTaskById(taskId);\n      const approverProfile = await getUserProfile(approvedBy);\n      const approverName = approverProfile?.fullName || approverProfile?.email || \"Ynetici\";\n      \n      // Atanan kiileri bul\n      const assignments = await getTaskAssignments(taskId);\n      const assignedUserIds = assignments\n        .filter(a => a.status === \"accepted\") // Sadece kabul edilen atamalar\n        .map(a => a.assignedTo);\n      \n      // Bildirim gnderilecek kullanclar topla\n      const notificationUserIds = new Set<string>();\n      \n      // Onay isteyen kiiye bildirim gnder\n      if (updatedTask && updatedTask.approvalRequestedBy) {\n        notificationUserIds.add(updatedTask.approvalRequestedBy);\n      }\n      \n      // Atanan kiilere bildirim gnder\n      assignedUserIds.forEach(userId => {\n        if (userId !== updatedTask?.approvalRequestedBy) {\n          notificationUserIds.add(userId);\n        }\n      });\n      \n      // Her kullancya bildirim gnder\n      const { getNotifications } = await import(\"./notificationService\");\n      \n      for (const userId of notificationUserIds) {\n        try {\n          // Duplicate kontrol - index hatas durumunda sessizce devam et\n          let existingNotifications: any[] = [];\n          try {\n            existingNotifications = await getNotifications(userId, { unreadOnly: true });\n          } catch (notifError) {\n            // Index hatas veya dier hatalar - sessizce devam et\n            // getNotifications zaten bo array dndryor, burada da sessizce handle et\n            if (import.meta.env.DEV) {\n              // Sadece gerek hatalar logla (index hatas deilse)\n              const isIndexError = \n                typeof notifError === \"object\" &&\n                notifError !== null &&\n                \"code\" in notifError &&\n                (notifError as { code?: string }).code === \"failed-precondition\";\n              if (!isIndexError) {\n                console.debug(\"Get notifications error in approveTask:\", notifError);\n              }\n            }\n          }\n          \n          const duplicateExists = existingNotifications.some(\n            n => n.type === \"task_approval\" && \n                 n.relatedId === taskId && \n                 n.metadata?.action === \"approved\"\n          );\n\n          if (!duplicateExists) {\n            const approvalTime = new Date().toLocaleString('tr-TR', { day: 'numeric', month: 'long', year: 'numeric', hour: '2-digit', minute: '2-digit' });\n            await createNotification({\n              userId: userId,\n              type: \"task_approval\",\n              title: \"Grev onayland\",\n              message: `${approverName} kullancs tarafndan \"${updatedTask?.title || \"grev\"}\" grevi onayland ve \"Onayland\" durumuna geirildi.\\n\\nGrev baaryla onaylanm olarak iaretlendi. Tm grev yeleri bu durumu grebilir.\\n\\nOnay Zaman: ${approvalTime}`,\n              read: false,\n              relatedId: taskId,\n              metadata: { \n                action: \"approved\",\n                updatedAt: new Date(),\n                priority: updatedTask?.priority,\n                dueDate: updatedTask?.dueDate,\n              },\n            });\n          }\n        } catch (userNotifError) {\n          console.error(`Error sending notification to user ${userId}:`, userNotifError);\n        }\n      }\n    } catch (notifError) {\n      console.error(\"Error sending approval notification:\", notifError);\n    }\n  } catch (error: unknown) {\n    if (import.meta.env.DEV) {\n      console.error(\"Approve task error:\", error);\n    }\n    throw error;\n  }\n};\n\n/**\n * Grev onayn reddet - Reddedildiinde \"Devam Ediyor\" (in_progress) durumuna dner\n */\nexport const rejectTaskApproval = async (taskId: string, rejectedBy: string, rejectionReason?: string | null): Promise<void> => {\n  try {\n    const task = await getTaskById(taskId);\n    if (!task) {\n      throw new Error(\"Grev bulunamad\");\n    }\n\n    const oldStatus = task.status;\n    const currentUser = auth?.currentUser;\n\n    await updateDoc(doc(firestore, \"tasks\", taskId), {\n      approvalStatus: \"rejected\",\n      status: \"in_progress\", // Reddedilince \"Devam Ediyor\" durumuna dner\n      rejectedBy: rejectedBy,\n      rejectedAt: serverTimestamp(),\n      rejectionReason: rejectionReason || null,\n      updatedAt: serverTimestamp(),\n    });\n\n    // Status deitiyse gncelleyen bilgisi ekle\n    if (oldStatus !== \"in_progress\" && currentUser?.uid) {\n      await updateDoc(doc(firestore, \"tasks\", taskId), {\n        statusUpdatedBy: currentUser.uid,\n        statusUpdatedAt: serverTimestamp(),\n      });\n    }\n\n    // Audit log for rejection\n    await logAudit(\"UPDATE\", \"tasks\", taskId, rejectedBy, { approvalStatus: \"pending\", status: oldStatus }, { approvalStatus: \"rejected\", status: \"in_progress\", rejectionReason });\n\n    // Grevdeki tm kiilere (atananlar, grev oluturan, onay isteyen) bildirim gnder\n    try {\n      const task = await getTaskById(taskId);\n      const rejecterProfile = await getUserProfile(rejectedBy);\n      \n      if (task) {\n        const assignments = await getTaskAssignments(taskId);\n        // Statusu rejected olmayan tm atanm kullanclar al\n        const assignedUserIds = assignments\n          .filter(a => a.status !== \"rejected\")\n          .map(a => a.assignedTo);\n        \n        // Grevdeki tm kiileri topla (atananlar + grev oluturan + onay isteyen)\n        const allTaskUserIds = new Set<string>();\n        \n        // Atanan kullanclar ekle\n        assignedUserIds.forEach(id => allTaskUserIds.add(id));\n        \n        // Grev oluturan kiiyi ekle (eer varsa ve listede yoksa)\n        if (task.createdBy && !allTaskUserIds.has(task.createdBy)) {\n          allTaskUserIds.add(task.createdBy);\n        }\n        \n        // Onay isteyen kiiyi ekle (eer varsa ve listede yoksa)\n        if (task.approvalRequestedBy && !allTaskUserIds.has(task.approvalRequestedBy)) {\n          allTaskUserIds.add(task.approvalRequestedBy);\n        }\n        \n        const rejectionMessage = rejectionReason \n          ? `${rejecterProfile?.fullName || rejecterProfile?.email || \"Ynetici\"} \"${task.title}\" grevi iin tamamlanma onayn reddetti. Not: ${rejectionReason}`\n          : `${rejecterProfile?.fullName || rejecterProfile?.email || \"Ynetici\"} \"${task.title}\" grevi iin tamamlanma onayn reddetti.`;\n        \n        // Grevdeki tm kiilere bildirim gnder (her biri mail alacak - createNotification otomatik mail gnderir)\n        await Promise.all(\n          Array.from(allTaskUserIds).map(async (userId) => {\n            try {\n              const rejectTime3 = new Date().toLocaleString('tr-TR', { day: 'numeric', month: 'long', year: 'numeric', hour: '2-digit', minute: '2-digit' });\n              const detailedRejectionMessage = rejectionReason \n                ? `${rejecterProfile?.fullName || rejecterProfile?.email || \"Ynetici\"} kullancs tarafndan \"${task.title}\" grevi iin tamamlanma onay reddedildi.\\n\\nReddetme Notu: ${rejectionReason}\\n\\nGrev tekrar \"Devam Ediyor\" durumuna alnd. Ltfen gerekli dzeltmeleri yapp tekrar onay talebi gnderin.\\n\\nReddetme Zaman: ${rejectTime3}`\n                : `${rejecterProfile?.fullName || rejecterProfile?.email || \"Ynetici\"} kullancs tarafndan \"${task.title}\" grevi iin tamamlanma onay reddedildi.\\n\\nGrev tekrar \"Devam Ediyor\" durumuna alnd. Ltfen gerekli dzeltmeleri yapp tekrar onay talebi gnderin.\\n\\nReddetme Zaman: ${rejectTime3}`;\n              await createNotification({\n                userId: userId,\n                type: \"task_approval\",\n                title: \"Grev onay reddedildi\",\n                message: detailedRejectionMessage,\n                read: false,\n                relatedId: taskId,\n                metadata: { \n                  action: \"rejected\", \n                  rejectionReason,\n                  updatedAt: new Date(),\n                  priority: task.priority,\n                  dueDate: task.dueDate,\n                },\n              });\n            } catch (notifError) {\n              if (import.meta.env.DEV) {\n                console.error(\"Error sending notification to task user:\", userId, notifError);\n              }\n            }\n          })\n        );\n      }\n    } catch (notifError) {\n      if (import.meta.env.DEV) {\n        console.error(\"Error sending rejection notification:\", notifError);\n      }\n    }\n  } catch (error: unknown) {\n    if (import.meta.env.DEV) {\n      console.error(\"Reject task approval error:\", error);\n    }\n    throw error;\n  }\n};\n\n/**\n * Grev reddi onayla (grevi veren kii reddi kabul eder)\n */\nexport const approveTaskRejection = async (\n  taskId: string,\n  assignmentId: string\n): Promise<void> => {\n  try {\n    const userId = auth?.currentUser?.uid;\n    if (!userId) {\n      throw new Error(\"Kullanc kimlii bulunamad\");\n    }\n\n    const assignmentRef = doc(firestore, \"tasks\", taskId, \"assignments\", assignmentId);\n    const assignmentDoc = await getDoc(assignmentRef);\n    \n    if (!assignmentDoc.exists()) {\n      throw new Error(\"Grev atamas bulunamad\");\n    }\n\n    const assignmentData = assignmentDoc.data() as TaskAssignment;\n    \n    if (assignmentData.status !== \"rejected\") {\n      throw new Error(\"Grev reddedilmemi\");\n    }\n\n    // Reddi onayla\n    await updateDoc(assignmentRef, {\n      rejectionApprovedBy: userId,\n      rejectionApprovedAt: serverTimestamp(),\n    });\n\n    // Audit log\n    const task = await getTaskById(taskId);\n    await logAudit(\n      \"UPDATE\",\n      \"task_assignments\",\n      assignmentId,\n      userId,\n      { rejectionApprovedBy: null },\n      { rejectionApprovedBy: userId, taskId, taskTitle: task?.title }\n    );\n\n    // Bildirim gnder\n    try {\n      const allUsers = await getAllUsers();\n      const assignedUser = allUsers.find(u => u.id === assignmentData.assignedTo);\n      const approverUser = allUsers.find(u => u.id === userId);\n\n      if (assignedUser) {\n        const approvalTime2 = new Date().toLocaleString('tr-TR', { day: 'numeric', month: 'long', year: 'numeric', hour: '2-digit', minute: '2-digit' });\n        await createNotification({\n          userId: assignmentData.assignedTo,\n          type: \"task_assigned\",\n          title: \"Grev reddi onayland\",\n          message: `${approverUser?.fullName || approverUser?.email || \"Ynetici\"} kullancs tarafndan \"${task?.title}\" grevi iin reddiniz onayland.\\n\\nGrev artk baka birine atanabilir veya iptal edilebilir. Bu grevle ilgili artk bildirim almayacaksnz.\\n\\nOnay Zaman: ${approvalTime2}`,\n          read: false,\n          relatedId: taskId,\n          metadata: { \n            assignment_id: assignmentId, \n            action: \"rejection_approved\",\n            updatedAt: new Date(),\n            priority: task?.priority,\n            dueDate: task?.dueDate,\n          },\n        });\n      }\n    } catch (notifError) {\n      console.error(\"Error sending approval notification:\", notifError);\n    }\n  } catch (error: unknown) {\n    if (import.meta.env.DEV) {\n      console.error(\"Approve task rejection error:\", error);\n    }\n    throw error;\n  }\n};\n\n/**\n * Grev reddi reddet (grevi veren kii reddi reddeder, grev tekrar atanan kiiye dner)\n */\nexport const rejectTaskRejection = async (\n  taskId: string,\n  assignmentId: string,\n  reason: string\n): Promise<void> => {\n  try {\n    const userId = auth?.currentUser?.uid;\n    if (!userId) {\n      throw new Error(\"Kullanc kimlii bulunamad\");\n    }\n\n    // Red sebebi en az 20 karakter olmal\n    if (reason.trim().length < 20) {\n      throw new Error(\"Red sebebi en az 20 karakter olmaldr\");\n    }\n\n    const assignmentRef = doc(firestore, \"tasks\", taskId, \"assignments\", assignmentId);\n    const assignmentDoc = await getDoc(assignmentRef);\n    \n    if (!assignmentDoc.exists()) {\n      throw new Error(\"Grev atamas bulunamad\");\n    }\n\n    const assignmentData = assignmentDoc.data() as TaskAssignment;\n    \n    if (assignmentData.status !== \"rejected\") {\n      throw new Error(\"Grev reddedilmemi\");\n    }\n\n    // Reddi reddet - grevi tekrar pending durumuna getir\n    await updateDoc(assignmentRef, {\n      status: \"pending\",\n      rejectionRejectedBy: userId,\n      rejectionRejectedAt: serverTimestamp(),\n      rejectionRejectionReason: reason.trim(),\n      rejectionReason: null, // lk red sebebini temizle (yeni red sebebi iin)\n    });\n\n    // Audit log\n    const task = await getTaskById(taskId);\n    await logAudit(\n      \"UPDATE\",\n      \"task_assignments\",\n      assignmentId,\n      userId,\n      { status: \"rejected\" },\n      { \n        status: \"pending\", \n        rejectionRejectedBy: userId,\n        rejectionRejectionReason: reason.trim(),\n        taskId, \n        taskTitle: task?.title \n      }\n    );\n\n    // Bildirim gnder - grevi alan kiiye\n    try {\n      const allUsers = await getAllUsers();\n      const assignedUser = allUsers.find(u => u.id === assignmentData.assignedTo);\n      const rejecterUser = allUsers.find(u => u.id === userId);\n\n      if (assignedUser) {\n        const rejectionTime = new Date().toLocaleString('tr-TR', { day: 'numeric', month: 'long', year: 'numeric', hour: '2-digit', minute: '2-digit' });\n        await createNotification({\n          userId: assignmentData.assignedTo,\n          type: \"task_assigned\",\n          title: \"Grev reddi reddedildi\",\n          message: `${rejecterUser?.fullName || rejecterUser?.email || \"Ynetici\"} kullancs tarafndan \"${task?.title}\" grevi iin reddiniz reddedildi.\\n\\nGrev tekrar size atand ve zerinde almaya devam etmeniz bekleniyor.\\n\\nYnetici Notu: ${reason.trim().substring(0, 200)}${reason.trim().length > 200 ? \"...\" : \"\"}\\n\\nReddetme Zaman: ${rejectionTime}`,\n          read: false,\n          relatedId: taskId,\n          metadata: { \n            assignment_id: assignmentId, \n            action: \"rejection_rejected\",\n            reason: reason.trim()\n          },\n        });\n      }\n    } catch (notifError) {\n      console.error(\"Error sending rejection notification:\", notifError);\n    }\n  } catch (error: unknown) {\n    if (import.meta.env.DEV) {\n      console.error(\"Reject task rejection error:\", error);\n    }\n    throw error;\n  }\n};\n\n/**\n * Grev dzenleme yetkisi kontrol\n */\nexport const canEditTask = (task: Task, userId: string): boolean => {\n  return task.createdBy === userId;\n};\n\n/**\n * Grevi arivle\n */\nexport const archiveTask = async (taskId: string, userId: string): Promise<void> => {\n  try {\n    await updateDoc(doc(firestore, \"tasks\", taskId), {\n      isArchived: true,\n      updatedAt: serverTimestamp(),\n    });\n\n    // Audit log\n    await logAudit(\"UPDATE\", \"tasks\", taskId, userId, { isArchived: false }, { isArchived: true });\n  } catch (error) {\n    if (import.meta.env.DEV) {\n      console.error(\"Archive task error:\", error);\n    }\n    throw error;\n  }\n};\n\n/**\n * Grevi arivden kar\n */\nexport const unarchiveTask = async (taskId: string, userId: string): Promise<void> => {\n  try {\n    await updateDoc(doc(firestore, \"tasks\", taskId), {\n      isArchived: false,\n      updatedAt: serverTimestamp(),\n    });\n\n    // Audit log\n    await logAudit(\"UPDATE\", \"tasks\", taskId, userId, { isArchived: true }, { isArchived: false });\n  } catch (error) {\n    if (import.meta.env.DEV) {\n      console.error(\"Unarchive task error:\", error);\n    }\n    throw error;\n  }\n};\n\n/**\n * Kullancy tm grevlerden kar ve eer greve kimse kalmamsa havuza al\n */\nexport const removeUserFromAllTasks = async (userId: string): Promise<void> => {\n  try {\n    // Kullancnn atand tm grevleri bul\n    const tasksRef = collection(firestore, \"tasks\");\n    const allTasksSnapshot = await getDocs(tasksRef);\n    \n    let batch = writeBatch(firestore);\n    let batchCount = 0;\n    const maxBatchSize = 500;\n    \n    for (const taskDoc of allTasksSnapshot.docs) {\n      const taskData = taskDoc.data();\n      const taskId = taskDoc.id;\n      \n      // assignedUsers array'inden kullancy kar\n      const assignedUsers = taskData.assignedUsers || [];\n      if (assignedUsers.includes(userId)) {\n        const updatedAssignedUsers = assignedUsers.filter((uid: string) => uid !== userId);\n        \n        // Eer greve kimse kalmamsa havuza al\n        const shouldMoveToPool = updatedAssignedUsers.length === 0;\n        \n        const updates: Partial<Task> & { assignedUsers?: string[]; isInPool?: boolean; poolRequests?: string[] } = {\n          assignedUsers: updatedAssignedUsers,\n        };\n        \n        if (shouldMoveToPool) {\n          updates.isInPool = true;\n          updates.poolRequests = [];\n        }\n        \n        batch.update(taskDoc.ref, updates);\n        batchCount++;\n        \n        // Batch size limit\n        if (batchCount >= maxBatchSize) {\n          await batch.commit();\n          batchCount = 0;\n          // Yeni batch olutur\n          batch = writeBatch(firestore);\n        }\n      }\n      \n      // Task assignments collection'ndan kullancnn atamalarn sil\n      const assignmentsRef = collection(firestore, `tasks/${taskId}/assignments`);\n      const assignmentsSnapshot = await getDocs(\n        query(assignmentsRef, where(\"assignedTo\", \"==\", userId))\n      );\n      \n      for (const assignmentDoc of assignmentsSnapshot.docs) {\n        batch.delete(assignmentDoc.ref);\n        batchCount++;\n        \n        if (batchCount >= maxBatchSize) {\n          await batch.commit();\n          batchCount = 0;\n          // Yeni batch olutur\n          batch = writeBatch(firestore);\n        }\n      }\n    }\n    \n    // Kalan batch'i commit et\n    if (batchCount > 0) {\n      await batch.commit();\n    }\n    \n    // Kullancnn oluturduu grevlerin createdBy'sini \"deleted_user\" olarak gncelle\n    const createdTasksSnapshot = await getDocs(\n      query(tasksRef, where(\"createdBy\", \"==\", userId))\n    );\n    \n    let updateBatch = writeBatch(firestore);\n    let updateBatchCount = 0;\n    \n    for (const taskDoc of createdTasksSnapshot.docs) {\n      updateBatch.update(taskDoc.ref, {\n        createdBy: \"deleted_user\",\n        createdByName: \"Silinmi Kullanc\",\n      });\n      updateBatchCount++;\n      \n      if (updateBatchCount >= maxBatchSize) {\n        await updateBatch.commit();\n        updateBatchCount = 0;\n        // Yeni batch olutur\n        updateBatch = writeBatch(firestore);\n      }\n    }\n    \n    if (updateBatchCount > 0) {\n      await updateBatch.commit();\n    }\n    \n  } catch (error: unknown) {\n    if (import.meta.env.DEV) {\n      console.error(\"Error removing user from tasks:\", error);\n    }\n    throw error;\n  }\n};\n\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\services\\firebase\\teamApprovalService.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":64,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":64,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1747,1750],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1747,1750],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":129,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":129,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3856,3859],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3856,3859],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":357,"column":72,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":357,"endColumn":75,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11468,11471],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11468,11471],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"prefer-const","severity":2,"message":"'requests' is never reassigned. Use 'const' instead.","line":362,"column":15,"nodeType":"Identifier","messageId":"useConst","endLine":362,"endColumn":46,"fix":{"range":[11589,11630],"text":"const requests: TeamApprovalRequest[] = [];"}}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":1,"fixableWarningCount":0,"source":"/**\n * Team Approval Service\n * Ekip onay ilemleri\n */\n\nimport {\n  collection,\n  doc,\n  getDoc,\n  getDocs,\n  updateDoc,\n  query,\n  where,\n  serverTimestamp,\n  Timestamp,\n  onSnapshot,\n  Unsubscribe,\n} from \"firebase/firestore\";\nimport { firestore } from \"@/lib/firebase\";\nimport { getUserProfile, getAllUsers, UserProfile } from \"./authService\";\nimport { getDepartmentById, Department, getDepartments } from \"./departmentService\";\nimport { createNotification } from \"./notificationService\";\n\nexport interface TeamApprovalRequest {\n  userId: string;\n  userName: string;\n  userEmail: string;\n  teamId: string;\n  teamName: string;\n  requestedAt: Timestamp;\n  status: \"pending\" | \"approved\" | \"rejected\";\n  approvedBy?: string;\n  approvedAt?: Timestamp;\n  rejectedReason?: string;\n}\n\n/**\n * Onay bekleyen ekip taleplerini al (ekip lideri iin)\n */\nexport const getPendingTeamRequests = async (teamLeaderId: string): Promise<TeamApprovalRequest[]> => {\n  try {\n    // Ekip liderinin ynettii ekipleri bul\n    const departmentsRef = collection(firestore, \"departments\");\n    const departmentsQuery = query(departmentsRef, where(\"managerId\", \"==\", teamLeaderId));\n    const departmentsSnapshot = await getDocs(departmentsQuery);\n    \n    const teamIds = departmentsSnapshot.docs.map(doc => doc.id);\n    \n    if (teamIds.length === 0) {\n      return [];\n    }\n\n    // Bu ekiplere ait onay bekleyen kullanclar bul\n    const allUsers = await getAllUsers();\n    \n    const requests: TeamApprovalRequest[] = [];\n    \n    for (const user of allUsers) {\n      // Silinen veya geersiz kullanclar atla\n      if (!user || !user.id || !user.email) {\n        continue;\n      }\n      // Silinmi kullanclar atla (deleted flag kontrol)\n      if ((user as any).deleted === true) {\n        continue;\n      }\n      if (user.pendingTeams && user.pendingTeams.length > 0) {\n        for (const teamId of user.pendingTeams) {\n          if (teamIds.includes(teamId)) {\n            const team = await getDepartmentById(teamId);\n            if (team) {\n              requests.push({\n                userId: user.id,\n                userName: user.fullName || user.displayName || user.email,\n                userEmail: user.email,\n                teamId: teamId,\n                teamName: team.name,\n                requestedAt: user.createdAt || Timestamp.now(),\n                status: \"pending\",\n              });\n            }\n          }\n        }\n      }\n    }\n    \n    return requests.sort((a, b) => {\n      const aTime = a.requestedAt?.toMillis() || 0;\n      const bTime = b.requestedAt?.toMillis() || 0;\n      return bTime - aTime;\n    });\n  } catch (error) {\n    if (import.meta.env.DEV) {\n      console.error(\"Get pending team requests error:\", error);\n    }\n    throw error;\n  }\n};\n\n/**\n * Ana yneticiler iin tm onay bekleyen talepleri al\n * Sadece ekip lideri olmayan (managerId yok veya null olan) ekiplerin taleplerini gsterir\n */\nexport const getAllPendingTeamRequests = async (): Promise<TeamApprovalRequest[]> => {\n  try {\n    // Tm departmanlar al\n    const departmentsRef = collection(firestore, \"departments\");\n    const departmentsSnapshot = await getDocs(departmentsRef);\n    \n    // Ekip lideri olan ekipleri bul (managerId var ve null deil)\n    const teamsWithLeader = new Set<string>();\n    departmentsSnapshot.docs.forEach(doc => {\n      const data = doc.data();\n      if (data.managerId && data.managerId.trim() !== '') {\n        teamsWithLeader.add(doc.id);\n      }\n    });\n    \n    // Tm kullanclar al\n    const allUsers = await getAllUsers();\n    const requests: TeamApprovalRequest[] = [];\n    \n    for (const user of allUsers) {\n      // Silinen veya geersiz kullanclar atla\n      if (!user || !user.id || !user.email) {\n        continue;\n      }\n      // Silinmi kullanclar atla (deleted flag kontrol)\n      if ((user as any).deleted === true) {\n        continue;\n      }\n      if (user.pendingTeams && user.pendingTeams.length > 0) {\n        for (const teamId of user.pendingTeams) {\n          // Sadece ekip lideri olmayan ekiplerin taleplerini ekle\n          if (!teamsWithLeader.has(teamId)) {\n            const team = await getDepartmentById(teamId);\n            if (team) {\n              requests.push({\n                userId: user.id,\n                userName: user.fullName || user.displayName || user.email,\n                userEmail: user.email,\n                teamId: teamId,\n                teamName: team.name,\n                requestedAt: user.createdAt || Timestamp.now(),\n                status: \"pending\",\n              });\n            }\n          }\n        }\n      }\n    }\n    \n    return requests.sort((a, b) => {\n      const aTime = a.requestedAt?.toMillis() || 0;\n      const bTime = b.requestedAt?.toMillis() || 0;\n      return bTime - aTime;\n    });\n  } catch (error) {\n    console.error(\"Get all pending team requests error:\", error);\n    throw error;\n  }\n};\n\n/**\n * Ekip talebini onayla\n */\nexport const approveTeamRequest = async (\n  userId: string,\n  teamId: string,\n  approvedBy: string\n): Promise<void> => {\n  try {\n    // Yetki kontrol: Firestore'dan kontrol et\n    const { getUserProfile } = await import(\"./authService\");\n    const approverProfile = await getUserProfile(approvedBy);\n    if (approverProfile) {\n      const { canApproveTeamRequest } = await import(\"@/utils/permissions\");\n      const departments = await getDepartments();\n      const canApprove = await canApproveTeamRequest(approverProfile, departments);\n      if (!canApprove) {\n        throw new Error(\"Ekip talebi onaylama yetkiniz yok.\");\n      }\n    }\n    const userRef = doc(firestore, \"users\", userId);\n    const userDoc = await getDoc(userRef);\n    \n    if (!userDoc.exists()) {\n      throw new Error(\"Kullanc bulunamad\");\n    }\n    \n    const userData = userDoc.data() as UserProfile;\n    const pendingTeams = userData.pendingTeams || [];\n    const approvedTeams = userData.approvedTeams || [];\n    const currentRoles = userData.role || [];\n    \n    // Ekip pendingTeams'den kar ve approvedTeams'e ekle\n    // Eer talep zaten onaylanm veya reddedilmise (pendingTeams'de yoksa), sessizce baarl dn\n    if (!pendingTeams.includes(teamId)) {\n      // Talep zaten onaylanm olabilir, kontrol et\n      if (approvedTeams.includes(teamId)) {\n        // Talep zaten onaylanm, sessizce baarl dn\n        return;\n      }\n      // Talep bulunamad - muhtemelen zaten ilenmi veya kaldrlm\n      throw new Error(\"Bu ekip talebi bulunamad. Talep zaten ilenmi olabilir.\");\n    }\n    \n    const updatedPendingTeams = pendingTeams.filter(id => id !== teamId);\n    const updatedApprovedTeams = [...approvedTeams, teamId];\n    \n    // Eer kullancnn rol \"viewer\" (izleyici) ise, \"personnel\" (personel) olarak gncelle\n    let updatedRoles = [...currentRoles];\n    if (currentRoles.includes(\"viewer\") && !currentRoles.includes(\"personnel\")) {\n      // viewer roln kaldr ve personnel ekle\n      updatedRoles = currentRoles.filter((r: string) => r !== \"viewer\");\n      if (!updatedRoles.includes(\"personnel\")) {\n        updatedRoles.push(\"personnel\");\n      }\n      // Eer hi rol kalmadysa, en azndan personnel olsun\n      if (updatedRoles.length === 0) {\n        updatedRoles = [\"personnel\"];\n      }\n    }\n    \n    await updateDoc(userRef, {\n      pendingTeams: updatedPendingTeams,\n      approvedTeams: updatedApprovedTeams,\n      role: updatedRoles,\n      updatedAt: serverTimestamp(),\n    });\n\n    // Kullancya bildirim gnder\n    try {\n      const team = await getDepartmentById(teamId);\n      const approverProfile = await getUserProfile(approvedBy);\n      const approverName = approverProfile?.fullName || approverProfile?.displayName || approverProfile?.email || \"Ynetici\";\n      \n      await createNotification({\n        userId: userId,\n        type: \"system\",\n        title: \"Ekip talebi onayland\",\n        message: `${approverName} \"${team?.name || \"ekip\"}\" ekibine katlm talebinizi onaylad.`,\n        read: false,\n        metadata: {\n          teamId: teamId,\n          teamName: team?.name,\n          approvedBy: approvedBy,\n        },\n      });\n    } catch (notifError) {\n      console.error(\"Error sending approval notification:\", notifError);\n      // Bildirim hatas onay ilemini engellemez\n    }\n  } catch (error) {\n    console.error(\"Approve team request error:\", error);\n    throw error;\n  }\n};\n\n/**\n * Ekip talebini reddet\n */\nexport const rejectTeamRequest = async (\n  userId: string,\n  teamId: string,\n  rejectedReason?: string,\n  rejectedBy?: string\n): Promise<void> => {\n  try {\n    // Yetki kontrol: Firestore'dan kontrol et\n    if (rejectedBy) {\n      const { getUserProfile } = await import(\"./authService\");\n      const rejecterProfile = await getUserProfile(rejectedBy);\n      if (rejecterProfile) {\n        const { canApproveTeamRequest, getDepartments } = await import(\"@/utils/permissions\");\n        const departments = await getDepartments();\n        const canApprove = await canApproveTeamRequest(rejecterProfile, departments);\n        if (!canApprove) {\n          throw new Error(\"Ekip talebi reddetme yetkiniz yok.\");\n        }\n      }\n    }\n    const userRef = doc(firestore, \"users\", userId);\n    const userDoc = await getDoc(userRef);\n    \n    if (!userDoc.exists()) {\n      throw new Error(\"Kullanc bulunamad\");\n    }\n    \n    const userData = userDoc.data() as UserProfile;\n    const pendingTeams = userData.pendingTeams || [];\n    \n    // Ekip pendingTeams'den kar\n    if (!pendingTeams.includes(teamId)) {\n      throw new Error(\"Bu ekip talebi bulunamad\");\n    }\n    \n    const updatedPendingTeams = pendingTeams.filter(id => id !== teamId);\n    \n    await updateDoc(userRef, {\n      pendingTeams: updatedPendingTeams,\n      updatedAt: serverTimestamp(),\n    });\n\n    // Kullancya bildirim gnder\n    try {\n      const team = await getDepartmentById(teamId);\n      \n      await createNotification({\n        userId: userId,\n        type: \"system\",\n        title: \"Ekip talebi reddedildi\",\n        message: `\"${team?.name || \"ekip\"}\" ekibine katlm talebiniz reddedildi.${rejectedReason ? ` Sebep: ${rejectedReason}` : \"\"}`,\n        read: false,\n        metadata: {\n          teamId: teamId,\n          teamName: team?.name,\n          rejectedReason: rejectedReason,\n        },\n      });\n    } catch (notifError) {\n      console.error(\"Error sending rejection notification:\", notifError);\n      // Bildirim hatas red ilemini engellemez\n    }\n  } catch (error) {\n    console.error(\"Reject team request error:\", error);\n    throw error;\n  }\n};\n\n/**\n * Katlm isteklerini gerek zamanl olarak dinle\n * @param isAdmin Admin mi?\n * @param teamLeaderId Ekip lideri ID'si (admin deilse)\n * @param callback stekler deitiinde arlacak callback\n * @returns Unsubscribe fonksiyonu\n */\nexport const subscribeToTeamRequests = (\n  isAdmin: boolean,\n  teamLeaderId: string | null,\n  callback: (requests: TeamApprovalRequest[]) => void\n): Unsubscribe => {\n  try {\n    const usersRef = collection(firestore, \"users\");\n    \n    // Tm kullanclar dinle (pendingTeams alan olanlar filtreleyeceiz)\n    const unsubscribe = onSnapshot(\n      usersRef,\n      async (snapshot) => {\n        try {\n          // Tm kullanclar al\n          const allUsers = snapshot.docs\n            .map(doc => ({\n              id: doc.id,\n              ...doc.data(),\n            } as UserProfile))\n            .filter(user => user && user.id && user.email && !(user as any).deleted);\n\n          // Departmanlar al\n          const departments = await getDepartments();\n          \n          let requests: TeamApprovalRequest[] = [];\n\n          if (isAdmin) {\n            // Admin iin: Ekip lideri olmayan ekiplerin taleplerini gster\n            const teamsWithLeader = new Set<string>();\n            departments.forEach(dept => {\n              if (dept.managerId && dept.managerId.trim() !== '') {\n                teamsWithLeader.add(dept.id);\n              }\n            });\n\n            for (const user of allUsers) {\n              if (user.pendingTeams && user.pendingTeams.length > 0) {\n                for (const teamId of user.pendingTeams) {\n                  if (!teamsWithLeader.has(teamId)) {\n                    const team = departments.find(d => d.id === teamId);\n                    if (team) {\n                      requests.push({\n                        userId: user.id,\n                        userName: user.fullName || user.displayName || user.email,\n                        userEmail: user.email,\n                        teamId: teamId,\n                        teamName: team.name,\n                        requestedAt: user.createdAt || Timestamp.now(),\n                        status: \"pending\",\n                      });\n                    }\n                  }\n                }\n              }\n            }\n          } else if (teamLeaderId) {\n            // Ekip lideri iin: Ynettii ekiplerin taleplerini gster\n            const managedDepartments = departments.filter(d => d.managerId === teamLeaderId);\n            const teamIds = managedDepartments.map(d => d.id);\n\n            if (teamIds.length > 0) {\n              for (const user of allUsers) {\n                if (user.pendingTeams && user.pendingTeams.length > 0) {\n                  for (const teamId of user.pendingTeams) {\n                    if (teamIds.includes(teamId)) {\n                      const team = departments.find(d => d.id === teamId);\n                      if (team) {\n                        requests.push({\n                          userId: user.id,\n                          userName: user.fullName || user.displayName || user.email,\n                          userEmail: user.email,\n                          teamId: teamId,\n                          teamName: team.name,\n                          requestedAt: user.createdAt || Timestamp.now(),\n                          status: \"pending\",\n                        });\n                      }\n                    }\n                  }\n                }\n              }\n            }\n          }\n\n          // Tarihe gre srala\n          requests.sort((a, b) => {\n            const aTime = a.requestedAt?.toMillis() || 0;\n            const bTime = b.requestedAt?.toMillis() || 0;\n            return bTime - aTime;\n          });\n\n          callback(requests);\n        } catch (error) {\n          if (import.meta.env.DEV) {\n            console.error(\"Subscribe to team requests error:\", error);\n          }\n          callback([]);\n        }\n      },\n      (error) => {\n        if (import.meta.env.DEV) {\n          console.error(\"Team requests snapshot error:\", error);\n        }\n        callback([]);\n      }\n    );\n\n    return unsubscribe;\n  } catch (error) {\n    if (import.meta.env.DEV) {\n      console.error(\"Subscribe to team requests setup error:\", error);\n    }\n    // Hata durumunda bo callback dndr\n    callback([]);\n    return () => {}; // Bo unsubscribe fonksiyonu\n  }\n};\n\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\services\\firebase\\warrantyService.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":59,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":59,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1263,1266],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1263,1266],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":401,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":401,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11052,11055],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11052,11055],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Warranty/After-Sales Service\n * Sat sonras takip ilemleri\n */\n\nimport {\n  collection,\n  doc,\n  getDoc,\n  getDocs,\n  addDoc,\n  updateDoc,\n  deleteDoc,\n  query,\n  where,\n  orderBy,\n  serverTimestamp,\n  Timestamp,\n} from \"firebase/firestore\";\nimport { firestore } from \"@/lib/firebase\";\nimport { logAudit } from \"@/utils/auditLogger\";\n\nexport interface WarrantyRecord {\n  id: string;\n  customerId: string;\n  productId: string;\n  orderId?: string | null;\n  reason: string; // Neden geldi\n  receivedDate: Timestamp;\n  status: \"received\" | \"in_repair\" | \"completed\" | \"returned\";\n  repairDescription?: string | null; // Nasl bir ilem yapld\n  cost: number; // Maliyet\n  completedDate?: Timestamp | null;\n  returnedDate?: Timestamp | null;\n  createdBy: string;\n  createdAt: Timestamp;\n  updatedAt: Timestamp;\n}\n\nexport interface WarrantyComment {\n  id: string;\n  warrantyId: string;\n  userId: string;\n  userName?: string;\n  userEmail?: string;\n  content: string;\n  createdAt: Timestamp | Date | string;\n  updatedAt?: Timestamp | Date | string | null;\n}\n\nexport interface WarrantyActivity {\n  id: string;\n  warrantyId: string;\n  userId: string;\n  userName?: string;\n  userEmail?: string;\n  action: string;\n  description: string;\n  metadata?: Record<string, any>;\n  createdAt: Timestamp | Date | string;\n}\n\nconst WARRANTY_COLLECTION = \"warranty\";\n\n/**\n * Tm garanti kaytlarn al\n */\nexport const getWarrantyRecords = async (filters?: {\n  customerId?: string;\n  status?: string;\n}): Promise<WarrantyRecord[]> => {\n  try {\n    let q = query(collection(firestore, WARRANTY_COLLECTION), orderBy(\"receivedDate\", \"desc\"));\n\n    if (filters?.customerId) {\n      q = query(q, where(\"customerId\", \"==\", filters.customerId));\n    }\n\n    if (filters?.status) {\n      q = query(q, where(\"status\", \"==\", filters.status));\n    }\n\n    const snapshot = await getDocs(q);\n    return snapshot.docs.map((doc) => ({\n      id: doc.id,\n      ...doc.data(),\n    })) as WarrantyRecord[];\n  } catch (error) {\n    if (import.meta.env.DEV) {\n      if (import.meta.env.DEV) {\n        console.error(\"Get warranty records error:\", error);\n      }\n    }\n    throw error;\n  }\n};\n\n/**\n * Garanti kayd detayn al\n */\nexport const getWarrantyRecordById = async (warrantyId: string): Promise<WarrantyRecord | null> => {\n  try {\n    const warrantyDoc = await getDoc(doc(firestore, WARRANTY_COLLECTION, warrantyId));\n    \n    if (!warrantyDoc.exists()) {\n      return null;\n    }\n\n    return {\n      id: warrantyDoc.id,\n      ...warrantyDoc.data(),\n    } as WarrantyRecord;\n  } catch (error) {\n    if (import.meta.env.DEV) {\n      if (import.meta.env.DEV) {\n        console.error(\"Get warranty record by id error:\", error);\n      }\n    }\n    throw error;\n  }\n};\n\n/**\n * Yeni garanti kayd olutur\n */\nexport const createWarrantyRecord = async (\n  warrantyData: Omit<WarrantyRecord, \"id\" | \"createdAt\" | \"updatedAt\">\n): Promise<WarrantyRecord> => {\n  try {\n    const warrantyDoc: Partial<WarrantyRecord> & { receivedDate: Timestamp; createdAt: ReturnType<typeof serverTimestamp>; updatedAt: ReturnType<typeof serverTimestamp> } = {\n      ...warrantyData,\n      receivedDate: warrantyData.receivedDate || Timestamp.now(),\n      createdAt: serverTimestamp(),\n      updatedAt: serverTimestamp(),\n    };\n    \n    const docRef = await addDoc(collection(firestore, WARRANTY_COLLECTION), warrantyDoc);\n\n    const createdWarranty = await getWarrantyRecordById(docRef.id);\n    if (!createdWarranty) {\n      throw new Error(\"Garanti kayd oluturulamad\");\n    }\n\n    // Audit log\n    await logAudit(\"CREATE\", \"warranty\", docRef.id, warrantyData.createdBy, null, createdWarranty);\n\n    // Aktivite log ekle\n    if (warrantyData.createdBy) {\n      try {\n        const { getUserProfile } = await import(\"./authService\");\n        const userProfile = await getUserProfile(warrantyData.createdBy);\n        const userName = userProfile?.fullName || userProfile?.displayName || userProfile?.email;\n        const userEmail = userProfile?.email;\n        \n        await addWarrantyActivity(\n          docRef.id,\n          warrantyData.createdBy,\n          \"created\",\n          `bu garanti kaydn oluturdu`,\n          { reason: warrantyData.reason },\n          userName,\n          userEmail\n        );\n      } catch (error) {\n        if (import.meta.env.DEV) {\n          if (import.meta.env.DEV) {\n            console.error(\"Add warranty activity error:\", error);\n          }\n        }\n      }\n    }\n\n    return createdWarranty;\n  } catch (error) {\n    if (import.meta.env.DEV) {\n      if (import.meta.env.DEV) {\n        console.error(\"Create warranty record error:\", error);\n      }\n    }\n    throw error;\n  }\n};\n\n/**\n * Garanti kaydn gncelle\n */\nexport const updateWarrantyRecord = async (\n  warrantyId: string,\n  updates: Partial<Omit<WarrantyRecord, \"id\" | \"createdAt\" | \"createdBy\">>,\n  userId?: string\n): Promise<void> => {\n  try {\n    // Eski veriyi al\n    const oldWarranty = await getWarrantyRecordById(warrantyId);\n    \n    const updateData: Partial<WarrantyRecord> & { updatedAt: ReturnType<typeof serverTimestamp> } = {\n      ...updates,\n      updatedAt: serverTimestamp(),\n    };\n\n    // Status gncellemelerinde tarih alanlarn gncelle\n    if (updates.status === \"completed\" && !oldWarranty?.completedDate) {\n      updateData.completedDate = serverTimestamp();\n    }\n    if (updates.status === \"returned\" && !oldWarranty?.returnedDate) {\n      updateData.returnedDate = serverTimestamp();\n    }\n    \n    await updateDoc(doc(firestore, WARRANTY_COLLECTION, warrantyId), updateData);\n    \n    // Yeni veriyi al\n    const newWarranty = await getWarrantyRecordById(warrantyId);\n    \n    // Audit log\n    if (userId) {\n      await logAudit(\"UPDATE\", \"warranty\", warrantyId, userId, oldWarranty, newWarranty);\n    }\n\n    // Aktivite log ekle\n    if (userId && oldWarranty && newWarranty) {\n      try {\n        const { getUserProfile } = await import(\"./authService\");\n        const userProfile = await getUserProfile(userId);\n        const userName = userProfile?.fullName || userProfile?.displayName || userProfile?.email;\n        const userEmail = userProfile?.email;\n\n        const changedFields = Object.keys(updates).filter(key => {\n          const oldValue = (oldWarranty as Record<string, unknown>)[key];\n          const newValue = (updates as Record<string, unknown>)[key];\n          return oldValue !== newValue;\n        });\n        \n        if (changedFields.length > 0) {\n          await addWarrantyActivity(\n            warrantyId,\n            userId,\n            \"updated\",\n            `bu garanti kaydn gncelledi`,\n            { changedFields },\n            userName,\n            userEmail\n          );\n        }\n      } catch (error) {\n        if (import.meta.env.DEV) {\n          if (import.meta.env.DEV) {\n            console.error(\"Add warranty activity error:\", error);\n          }\n        }\n      }\n    }\n  } catch (error) {\n    if (import.meta.env.DEV) {\n      console.error(\"Update warranty record error:\", error);\n    }\n    throw error;\n  }\n};\n\n/**\n * Garanti kaydn sil\n */\nexport const deleteWarrantyRecord = async (warrantyId: string, userId?: string): Promise<void> => {\n  try {\n    // Eski veriyi al\n    const oldWarranty = await getWarrantyRecordById(warrantyId);\n    \n    // Aktivite log ekle (silmeden nce)\n    if (userId && oldWarranty) {\n      try {\n        const { getUserProfile } = await import(\"./authService\");\n        const userProfile = await getUserProfile(userId);\n        const userName = userProfile?.fullName || userProfile?.displayName || userProfile?.email;\n        const userEmail = userProfile?.email;\n        \n        await addWarrantyActivity(\n          warrantyId,\n          userId,\n          \"deleted\",\n          `bu garanti kaydn sildi`,\n          { reason: oldWarranty.reason },\n          userName,\n          userEmail\n        );\n      } catch (error) {\n        if (import.meta.env.DEV) {\n          if (import.meta.env.DEV) {\n            console.error(\"Add warranty activity error:\", error);\n          }\n        }\n      }\n    }\n    \n    await deleteDoc(doc(firestore, WARRANTY_COLLECTION, warrantyId));\n    \n    // Audit log\n    if (userId) {\n      await logAudit(\"DELETE\", \"warranty\", warrantyId, userId, oldWarranty, null);\n    }\n  } catch (error) {\n    if (import.meta.env.DEV) {\n      console.error(\"Delete warranty record error:\", error);\n    }\n    throw error;\n  }\n};\n\n/**\n * Garanti kaydna yorum ekle\n */\nexport const addWarrantyComment = async (\n  warrantyId: string,\n  userId: string,\n  content: string,\n  userName?: string,\n  userEmail?: string\n): Promise<WarrantyComment> => {\n  try {\n    const commentData: Omit<WarrantyComment, \"id\"> = {\n      warrantyId,\n      userId,\n      userName,\n      userEmail,\n      content,\n      createdAt: Timestamp.now(),\n      updatedAt: null,\n    };\n\n    const docRef = await addDoc(\n      collection(firestore, WARRANTY_COLLECTION, warrantyId, \"comments\"),\n      commentData\n    );\n\n    // Activity log ekle\n    await addWarrantyActivity(warrantyId, userId, \"commented\", `yorum ekledi`, { commentId: docRef.id }, userName, userEmail);\n\n    // Garanti kaydn oluturan kiiye bildirim gnder (yorum ekleyen kii hari)\n    try {\n      const warranty = await getWarrantyRecordById(warrantyId);\n      if (warranty?.createdBy && warranty.createdBy !== userId) {\n        const { createNotification } = await import(\"@/services/firebase/notificationService\");\n        await createNotification({\n          userId: warranty.createdBy,\n          type: \"comment_added\",\n          title: \"Garanti Kaydnza Yorum Eklendi\",\n          message: `${userName || userEmail || \"Bir kullanc\"} garanti kaydnza yorum ekledi: ${content.substring(0, 100)}${content.length > 100 ? \"...\" : \"\"}`,\n          read: false,\n          relatedId: warrantyId,\n          metadata: { commentId: docRef.id, commenterId: userId, commenterName: userName, commenterEmail: userEmail },\n        });\n      }\n    } catch (error) {\n      if (import.meta.env.DEV) {\n        console.error(\"Send comment notification error:\", error);\n      }\n    }\n\n    return {\n      id: docRef.id,\n      ...commentData,\n    };\n  } catch (error) {\n    if (import.meta.env.DEV) {\n      console.error(\"Add warranty comment error:\", error);\n    }\n    throw error;\n  }\n};\n\n/**\n * Garanti kayd yorumlarn al\n */\nexport const getWarrantyComments = async (warrantyId: string): Promise<WarrantyComment[]> => {\n  try {\n    const snapshot = await getDocs(\n      query(\n        collection(firestore, WARRANTY_COLLECTION, warrantyId, \"comments\"),\n        orderBy(\"createdAt\", \"desc\")\n      )\n    );\n    return snapshot.docs.map((doc) => ({\n      id: doc.id,\n      ...doc.data(),\n    })) as WarrantyComment[];\n  } catch (error) {\n    if (import.meta.env.DEV) {\n      console.error(\"Get warranty comments error:\", error);\n    }\n    throw error;\n  }\n};\n\n/**\n * Garanti kayd aktivite log ekle\n */\nexport const addWarrantyActivity = async (\n  warrantyId: string,\n  userId: string,\n  action: string,\n  description: string,\n  metadata?: Record<string, any>,\n  userName?: string,\n  userEmail?: string\n): Promise<string> => {\n  try {\n    const activityData: Omit<WarrantyActivity, \"id\"> = {\n      warrantyId,\n      userId,\n      userName,\n      userEmail,\n      action,\n      description,\n      metadata: metadata || {},\n      createdAt: Timestamp.now(),\n    };\n\n    const docRef = await addDoc(\n      collection(firestore, WARRANTY_COLLECTION, warrantyId, \"activities\"),\n      activityData\n    );\n\n    return docRef.id;\n  } catch (error) {\n    if (import.meta.env.DEV) {\n      console.error(\"Add warranty activity error:\", error);\n    }\n    return \"\";\n  }\n};\n\n/**\n * Garanti kayd aktivite loglarn al\n */\nexport const getWarrantyActivities = async (warrantyId: string): Promise<WarrantyActivity[]> => {\n  try {\n    const snapshot = await getDocs(\n      query(\n        collection(firestore, WARRANTY_COLLECTION, warrantyId, \"activities\"),\n        orderBy(\"createdAt\", \"desc\")\n      )\n    );\n    return snapshot.docs.map((doc) => ({\n      id: doc.id,\n      ...doc.data(),\n    })) as WarrantyActivity[];\n  } catch (error) {\n    if (import.meta.env.DEV) {\n      console.error(\"Get warranty activities error:\", error);\n    }\n    throw error;\n  }\n};\n\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\services\\pdfGenerator.ts","messages":[{"ruleId":"prefer-const","severity":2,"message":"'nextY' is never reassigned. Use 'const' instead.","line":572,"column":9,"nodeType":"Identifier","messageId":"useConst","endLine":572,"endColumn":14,"fix":{"range":[22811,22835],"text":"const nextY = margin + 30;"}},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":1033,"column":60,"nodeType":"BlockStatement","messageId":"unexpected","endLine":1034,"endColumn":8,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[38985,38992],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"prefer-const","severity":2,"message":"'nextY' is never reassigned. Use 'const' instead.","line":1370,"column":9,"nodeType":"Identifier","messageId":"useConst","endLine":1370,"endColumn":14,"fix":{"range":[49397,49421],"text":"const nextY = margin + 30;"}},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":1809,"column":23,"nodeType":"BlockStatement","messageId":"unexpected","endLine":1810,"endColumn":4,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[65975,65978],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":2596,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2596,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[95185,95188],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[95185,95188],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":2597,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2597,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[95247,95250],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[95247,95250],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":2785,"column":16,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2785,"endColumn":19,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[101261,101264],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[101261,101264],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":2825,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2825,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[102900,102903],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[102900,102903],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":2826,"column":58,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2826,"endColumn":61,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[102990,102993],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[102990,102993],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":2827,"column":55,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2827,"endColumn":58,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[103079,103082],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[103079,103082],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":3041,"column":60,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":3041,"endColumn":63,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[112283,112286],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[112283,112286],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":3042,"column":58,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":3042,"endColumn":61,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[112378,112381],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[112378,112381],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":3043,"column":59,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":3043,"endColumn":62,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[112476,112479],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[112476,112479],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":3057,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":3057,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[113149,113152],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[113149,113152],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":3058,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":3058,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[113237,113240],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[113237,113240],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":3059,"column":51,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":3059,"endColumn":54,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[113328,113331],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[113328,113331],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":3413,"column":16,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":3413,"endColumn":19,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[126044,126047],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[126044,126047],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":3413,"column":47,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":3413,"endColumn":50,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[126075,126078],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[126075,126078],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":3423,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":3423,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[126587,126590],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[126587,126590],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":3423,"column":62,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":3423,"endColumn":65,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[126618,126621],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[126618,126621],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":3950,"column":89,"nodeType":"BlockStatement","messageId":"unexpected","endLine":3951,"endColumn":4,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[147241,147244],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":4000,"column":31,"nodeType":"BlockStatement","messageId":"unexpected","endLine":4001,"endColumn":8,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[149012,149019],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":4022,"column":19,"nodeType":"BlockStatement","messageId":"unexpected","endLine":4023,"endColumn":4,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[149637,149640],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":4086,"column":19,"nodeType":"BlockStatement","messageId":"unexpected","endLine":4087,"endColumn":4,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[152087,152090],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"prefer-const","severity":2,"message":"'currentY' is never reassigned. Use 'const' instead.","line":4180,"column":7,"nodeType":"Identifier","messageId":"useConst","endLine":4180,"endColumn":15,"fix":{"range":[155809,155840],"text":"const currentY = maxBottomY + 30;"}},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":4485,"column":19,"nodeType":"BlockStatement","messageId":"unexpected","endLine":4486,"endColumn":4,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[167547,167550],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]}],"suppressedMessages":[],"errorCount":26,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":3,"fixableWarningCount":0,"source":"import jsPDF, { jsPDFOptions } from \"jspdf\";\nimport autoTable, { CellHookData as AutoTableCellHookData } from \"jspdf-autotable\";\nimport { REV_LOGO_DATA_URI } from \"@/assets/rev-logo-base64\";\nimport { ROBOTO_REGULAR_BASE64, ROBOTO_BOLD_BASE64 } from \"@/assets/fonts/roboto-base64\";\n\n// Sabit irket bilgileri - cache'lenmi, deimeyen deerler\nconst COMPANY_INFO = {\n  name: \"Revium Ltd. ti.\",\n  address: \"Fevzi Cakmak Mah. Milenyum Cad. No:81\",\n  city: \"Karatay/KONYA\",\n  email: \"info@reviumtech.com\",\n  website: \"www.reviumtech.com\",\n  phone: \"+90 (551) 829-1613\",\n  fullAddress: \"Fevzi Cakmak Mah. Milenyum Cad. No:81, Karatay/KONYA\",\n  contactInfo: \"info@reviumtech.com | www.reviumtech.com | +90 (551) 829-1613\",\n  headerAddress: \"Fevzi Cakmak Mah. Milenyum Cad. No:81\",\n} as const;\n\n// PDF sabit deerleri - cache'lenmi\nconst PDF_CONSTANTS = {\n  margin: 50,\n  headerHeight: 120, // Header ierii iin yeterli ykseklik\n  footerHeight: 50,\n  logoSize: 40, // 50  40 (daha kk)\n  footerLogoSize: 28, // 32  28 (daha kk)\n  // Profesyonel renk paleti - modern ve minimal\n  primaryColor: [30, 58, 138] as [number, number, number], // Koyu mavi - profesyonel\n  mutedColor: [71, 85, 105] as [number, number, number], // Koyu gri-mavi\n  accentColor: [59, 130, 246] as [number, number, number], // Ak mavi vurgu\n  successColor: [16, 185, 129] as [number, number, number], // Yeil - baar\n  warningColor: [245, 158, 11] as [number, number, number], // Turuncu - uyar\n  errorColor: [239, 68, 68] as [number, number, number], // Krmz - hata\n  // Kart boyutlar ve spacing - Web sayfasndaki deerler (kltlm)\n  cardHeight: 95, // 120  95 (daha kompakt)\n  cardGap: 12, // 16  12 (daha az boluk)\n  cardPadding: 14, // 18  14 (daha kompakt)\n  cardHeaderPadding: 10, // 12  10 (daha az padding)\n  // Tablo balk boyutlar\n  tableHeaderHeight: 32, // 36  32 (daha kompakt)\n  tableHeaderPadding: 8, // 10  8\n  tableHeaderSpacing: 24, // 30  24\n  // Section spacing - Web sayfasndaki gibi (space-y-6 = 24px)\n  sectionSpacing: 20, // 24  20 (daha kompakt)\n  tableSpacing: 20, // 24  20 (daha kompakt)\n  // Font boyutlar - Web sayfasndaki deerler (kltlm)\n  fontSizeCardTitle: 12, // 14  12 (daha kk)\n  fontSizeCardValue: 24, // 30  24 (daha kk)\n  fontSizeCardDescription: 11, // 12  11 (daha kk)\n  fontSizeTableHeader: 16, // 18  16 (daha kk)\n  fontSizeTableBody: 11,\n  fontSizeTableHeaderText: 12,\n} as const;\n\n// Profesyonel renk paleti - modern, minimal ve sofistike\nconst TAILWIND_COLORS = {\n  // Profesyonel kart renkleri - ntr ve minimal\n  cardBackground: [248, 250, 252] as [number, number, number], // ok ak gri - kart arka plan\n  cardBorder: [226, 232, 240] as [number, number, number], // Ak gri - kart border\n  cardText: [71, 85, 105] as [number, number, number], // Koyu gri-mavi - kart metin\n  // Primary kart (vurgulu) - Web sayfasndaki renkler\n  primaryCardBg: [255, 255, 255] as [number, number, number], // Beyaz (rgba(221, 83, 53, 0.05) overlay ile)\n  primaryCardBorder: [221, 83, 53] as [number, number, number], // Krmz-turuncu (web: border-[rgb(221,83,53)])\n  primaryCardValue: [221, 83, 53] as [number, number, number], // Krmz-turuncu (text-primary)\n  // Success kart (yeil tonlar) - Web sayfasndaki renkler\n  successCardBg: [240, 253, 244] as [number, number, number], // ok ak yeil (web: bg-[rgb(240,253,244)])\n  successCardBorder: [187, 247, 208] as [number, number, number], // Ak yeil (web: border-[rgb(187,247,208)])\n  successCardValue: [22, 163, 74] as [number, number, number], // Yeil (web: text-green-600)\n  // Info kart (mavi tonlar) - Web sayfasndaki renkler\n  infoCardBg: [239, 246, 255] as [number, number, number], // ok ak mavi (web: bg-[rgb(239,246,255)])\n  infoCardBorder: [191, 219, 254] as [number, number, number], // Ak mavi (web: border-[rgb(191,219,254)])\n  infoCardValue: [37, 99, 235] as [number, number, number], // Koyu mavi (web: text-blue-600)\n  // Warning kart (turuncu tonlar - daha yumuak)\n  warningCardBg: [255, 251, 235] as [number, number, number], // ok ak turuncu\n  warningCardBorder: [253, 230, 138] as [number, number, number], // Ak turuncu\n  warningCardValue: [217, 119, 6] as [number, number, number], // Koyu turuncu\n  // Error kart (krmz tonlar - daha yumuak)\n  errorCardBg: [254, 242, 242] as [number, number, number], // ok ak krmz\n  errorCardBorder: [254, 202, 202] as [number, number, number], // Ak krmz\n  errorCardValue: [220, 38, 38] as [number, number, number], // Koyu krmz\n  // Gray palette - profesyonel tonlar\n  gray50: [249, 250, 251] as [number, number, number],\n  gray100: [243, 244, 246] as [number, number, number],\n  gray200: [229, 231, 235] as [number, number, number],\n  gray300: [209, 213, 219] as [number, number, number],\n  gray500: [107, 114, 128] as [number, number, number],\n  gray600: [71, 85, 105] as [number, number, number], // Gncellenmi - daha profesyonel\n  gray700: [51, 65, 85] as [number, number, number], // Yeni - orta koyu\n  gray800: [30, 41, 59] as [number, number, number], // Gncellenmi - daha koyu\n  gray900: [15, 23, 42] as [number, number, number], // Gncellenmi - ok koyu\n  // White\n  white: [255, 255, 255] as [number, number, number],\n  // Eski renkler - geriye dnk uyumluluk iin (kullanlmyor ama referans iin)\n  green50: [240, 253, 250] as [number, number, number],\n  green200: [167, 243, 208] as [number, number, number],\n  green500: [16, 185, 129] as [number, number, number],\n  green600: [5, 150, 105] as [number, number, number],\n  blue50: [239, 246, 255] as [number, number, number],\n  blue200: [191, 219, 254] as [number, number, number],\n  blue500: [59, 130, 246] as [number, number, number],\n  blue600: [37, 99, 235] as [number, number, number],\n  red50: [254, 242, 242] as [number, number, number],\n  red200: [254, 202, 202] as [number, number, number],\n  red500: [239, 68, 68] as [number, number, number],\n  red600: [220, 38, 38] as [number, number, number],\n  emerald50: [240, 253, 250] as [number, number, number],\n  emerald200: [167, 243, 208] as [number, number, number],\n  emerald500: [16, 185, 129] as [number, number, number],\n  emerald600: [5, 150, 105] as [number, number, number],\n  purple50: [250, 245, 255] as [number, number, number],\n  purple200: [233, 213, 255] as [number, number, number],\n  purple500: [168, 85, 247] as [number, number, number],\n  purple600: [147, 51, 234] as [number, number, number],\n} as const;\n\n// PDF Template Layout - Sabit alanlar ve dinamik ierik alanlar\ninterface PDFTemplateLayout {\n  // Sabit alanlar (her sayfada ayn)\n  background: {\n    startY: number;\n    endY: number;\n  };\n  header: {\n    startY: number;\n    endY: number;\n    contentStartY: number; // Dinamik ieriin balayaca Y pozisyonu\n  };\n  footer: {\n    startY: number;\n    endY: number;\n  };\n  // Dinamik ierik alan\n  contentArea: {\n    startY: number;\n    endY: number;\n    width: number;\n    leftMargin: number;\n    rightMargin: number;\n  };\n}\n\n// statistik Kart Tipi - sabit tasarm, dinamik deerler\ninterface StatCardConfig {\n  title: string;\n  value: string | number;\n  description?: string;\n  color: {\n    background: [number, number, number];\n    border: [number, number, number];\n    text: [number, number, number];\n    value: [number, number, number];\n  };\n}\n\n// Tablo Balk Konfigrasyonu - sabit tasarm\ninterface TableHeaderConfig {\n  title: string;\n  backgroundColor?: [number, number, number];\n  textColor?: [number, number, number];\n  borderColor?: [number, number, number];\n}\n\n// PDF Template olutur - sabit layout hesaplamalar\nconst createPDFTemplate = (doc: jsPDFWithFontStatus): PDFTemplateLayout => {\n  const pageWidth = doc.internal.pageSize.getWidth();\n  const pageHeight = doc.internal.pageSize.getHeight();\n  const mar = PDF_CONSTANTS.margin;\n\n  return {\n    background: {\n      startY: 0,\n      endY: pageHeight,\n    },\n    header: {\n      startY: 0,\n      endY: PDF_CONSTANTS.headerHeight,\n      contentStartY: PDF_CONSTANTS.headerHeight + 50, // Header'dan sonra 50px boluk (30  50, altnda ek boluk)\n    },\n    footer: {\n      startY: pageHeight - PDF_CONSTANTS.footerHeight,\n      endY: pageHeight,\n    },\n    contentArea: {\n      startY: PDF_CONSTANTS.headerHeight + 50, // Header'dan sonra balar (30  50, altnda ek boluk)\n      endY: pageHeight - PDF_CONSTANTS.footerHeight - 20, // Footer'dan nce biter (20px boluk)\n      width: pageWidth - (mar * 2),\n      leftMargin: mar,\n      rightMargin: mar,\n    },\n  };\n};\n\n// Kart boyutlarn hesapla - standardize edilmi helper fonksiyon\nconst calculateCardDimensions = (contentWidth: number, cardCount: number): { width: number; gap: number } => {\n  const gap = PDF_CONSTANTS.cardGap;\n  if (cardCount === 3) {\n    return {\n      width: (contentWidth - (2 * gap)) / 3,\n      gap: gap,\n    };\n  } else if (cardCount === 4) {\n    // 4 kart iin gap'i daha da klt (tamay nlemek iin)\n    const reducedGap = 8; // 12  8 (daha kompakt)\n    return {\n      width: (contentWidth - (3 * reducedGap)) / 4,\n      gap: reducedGap,\n    };\n  } else {\n    // Varsaylan: 3 kart\n    return {\n      width: (contentWidth - (2 * gap)) / 3,\n      gap: gap,\n    };\n  }\n};\n\n// Ortak safeText helper fonksiyonu - tm raporlarda kullanlabilir\n// Trke karakterleri ASCII'ye evir (sadece Helvetica iin, Roboto destekliyor)\nconst transliterateTurkish = (text: string): string => {\n  const turkishMap: Record<string, string> = {\n    '': 'c', '': 'C',\n    '': 'g', '': 'G',\n    '': 'i', '': 'I',\n    '': 'o', '': 'O',\n    '': 's', '': 'S',\n    '': 'u', '': 'U',\n  };\n  return text.replace(/[]/g, (char) => turkishMap[char] || char);\n};\n\n// AutoTable verilerini transliterate et - sadece Helvetica kullanlrken\n// Roboto font Trke karakterleri destekliyor, bu yzden font yklyse transliterate yapma\nconst transliterateTableData = (\n  data: (string | number)[][] | null | undefined,\n  doc?: jsPDFWithFontStatus\n): (string | number)[][] => {\n  if (!data || !Array.isArray(data)) {\n    return [];\n  }\n\n  // Roboto font yklyse transliterate yapma\n  if (doc && doc._robotoFontLoaded && !doc._robotoFontLoadFailed) {\n    return data.map((row) => {\n      if (!Array.isArray(row)) {\n        return [];\n      }\n      return row.map((cell) => cell);\n    });\n  }\n\n  // Helvetica kullanlyorsa transliterate et\n  return data.map((row) => {\n    if (!Array.isArray(row)) {\n      return [];\n    }\n    return row.map((cell) => {\n      if (typeof cell === 'string') {\n        return transliterateTurkish(cell);\n      }\n      return cell;\n    });\n  });\n};\n\nconst createSafeText = (doc: jsPDFWithFontStatus) => {\n  // Roboto font Trke karakterleri destekliyor\n  // Sadece Helvetica kullanlrken transliterate et\n  return (text: string, x: number, y: number, fontSize: number, isBold: boolean = false) => {\n    // null/undefined kontrol\n    if (text == null || text === '') {\n      return;\n    }\n\n    const textStr = String(text);\n\n    // NCE translitere edilmi versiyonu hazrla (yedek olarak)\n    const transliteratedText = transliterateTurkish(textStr);\n\n    // Font yklenmemise veya ykleme baarszsa direkt helvetica kullan ve transliterate et\n    if (!doc._robotoFontLoaded || doc._robotoFontLoadFailed) {\n      try {\n        doc.setFont(\"helvetica\", isBold ? \"bold\" : \"normal\");\n        doc.setFontSize(fontSize);\n        doc.text(transliteratedText, x, y);\n      } catch (error: unknown) {\n        // Hata durumunda sessizce devam et - ama loglayalm\n        console.warn('createSafeText: Helvetica ile yazlamad:', error);\n      }\n      return;\n    }\n\n    // Roboto kullanmay dene\n    let robotoSuccess = false;\n    try {\n      doc.setFont(\"Roboto\", isBold ? \"bold\" : \"normal\");\n      doc.setFontSize(fontSize);\n      const currentFont = doc.getFont();\n\n      if (currentFont && isRobotoName(currentFont.fontName)) {\n        // Roboto font baaryla ayarland, Trke karakterleri koruyarak yaz\n        try {\n          doc.text(textStr, x, y);\n          robotoSuccess = true;\n        } catch (writeError) {\n          // Text yazma hatas - robotoSuccess false kalacak, fallback'e geilecek\n          console.warn('createSafeText: Roboto textStr yazlamad, fallback deneniyor:', writeError);\n        }\n      }\n    } catch (fontError) {\n      // Font ayarlama hatas\n      console.warn('createSafeText: Roboto font ayarlanamad:', fontError);\n    }\n\n    // Roboto baarsz olduysa, Helvetica ile translitere edilmi text'i yaz\n    if (!robotoSuccess) {\n      try {\n        doc.setFont(\"helvetica\", isBold ? \"bold\" : \"normal\");\n        doc.setFontSize(fontSize);\n        doc.text(transliteratedText, x, y);\n      } catch (fallbackError) {\n        // Son are: loglayp devam et\n        console.error('createSafeText: Fallback da baarsz:', fallbackError);\n      }\n    }\n  };\n};\n\n// Arka plan template'i - sabit, her sayfada ayn\nconst drawPDFBackground = (doc: jsPDFWithFontStatus, template: PDFTemplateLayout) => {\n  const pageWidth = doc.internal.pageSize.getWidth();\n  const [primaryR, primaryG, primaryB] = PDF_CONSTANTS.primaryColor;\n\n  // Header background - profesyonel ve minimal (daha hafif)\n  doc.setFillColor(primaryR, primaryG, primaryB);\n  doc.setGState(doc.GState({ opacity: 0.04 })); // Daha hafif: 0.08  0.04\n  doc.rect(0, 0, pageWidth, PDF_CONSTANTS.headerHeight, \"F\");\n  doc.setGState(doc.GState({ opacity: 1 }));\n\n  // Footer background - sabit (profesyonel gri)\n  const footerY = doc.internal.pageSize.getHeight() - PDF_CONSTANTS.footerHeight;\n  doc.setFillColor(TAILWIND_COLORS.gray50[0], TAILWIND_COLORS.gray50[1], TAILWIND_COLORS.gray50[2]);\n  doc.rect(0, footerY, pageWidth, PDF_CONSTANTS.footerHeight, \"F\");\n};\n\n// Sabit statistik Kart izme Fonksiyonu - profesyonel ve sade tasarm\nconst drawStatCard = (\n  doc: jsPDFWithFontStatus,\n  x: number,\n  y: number,\n  width: number,\n  height: number,\n  config: StatCardConfig\n): void => {\n  const safeText = createSafeText(doc);\n  const [bgR, bgG, bgB] = config.color.background;\n  const [borderR, borderG, borderB] = config.color.border;\n  const [textR, textG, textB] = config.color.text;\n  const [valueR, valueG, valueB] = config.color.value;\n\n  // Primary kart iin zel arka plan (opacity ile) - Web sayfasndaki gibi\n  const isPrimaryCard = borderR === TAILWIND_COLORS.primaryCardBorder[0] &&\n    borderG === TAILWIND_COLORS.primaryCardBorder[1] &&\n    borderB === TAILWIND_COLORS.primaryCardBorder[2] &&\n    bgR === TAILWIND_COLORS.white[0] &&\n    bgG === TAILWIND_COLORS.white[1] &&\n    bgB === TAILWIND_COLORS.white[2];\n\n  if (isPrimaryCard) {\n    // Primary kart iin hafif arka plan (web: rgba(221, 83, 53, 0.05))\n    doc.setFillColor(borderR, borderG, borderB);\n    doc.setGState(doc.GState({ opacity: 0.05 }));\n    doc.roundedRect(x, y, width, height, 6, 6, \"F\");\n    doc.setGState(doc.GState({ opacity: 1 }));\n  } else {\n    // Normal kart arka plan\n    doc.setFillColor(bgR, bgG, bgB);\n    doc.roundedRect(x, y, width, height, 6, 6, \"F\");\n  }\n\n  // Border - Web sayfasndaki gibi (2pt kalnlk - border-2)\n  doc.setDrawColor(borderR, borderG, borderB);\n  doc.setLineWidth(2);\n  doc.roundedRect(x, y, width, height, 6, 6, \"S\");\n\n  // Balk - Web sayfasndaki gibi (kltlm spacing)\n  // Title: y + cardPadding (14px) + title baseline (~12px) = y + 26\n  doc.setTextColor(textR, textG, textB);\n  safeText(config.title, x + PDF_CONSTANTS.cardPadding, y + 26, PDF_CONSTANTS.fontSizeCardTitle, true);\n\n  // Deer - Web sayfasndaki gibi (kltlm spacing)\n  // Value: title'dan sonra (10px) + value baseline (~24px) = y + 26 + 10 + 24 = y + 60\n  const valueText = typeof config.value === 'number' ? config.value.toString() : config.value;\n  doc.setTextColor(valueR, valueG, valueB);\n  safeText(valueText, x + PDF_CONSTANTS.cardPadding, y + 60, PDF_CONSTANTS.fontSizeCardValue, true);\n\n  // Aklama - Web sayfasndaki gibi (kltlm spacing)\n  // Description: value'dan sonra (4px) + description baseline (~11px) = y + 60 + 4 + 11 = y + 75\n  if (config.description) {\n    doc.setTextColor(textR, textG, textB);\n    safeText(config.description, x + PDF_CONSTANTS.cardPadding, y + 75, PDF_CONSTANTS.fontSizeCardDescription, false);\n  }\n\n  doc.setTextColor(0, 0, 0);\n};\n\n// Profesyonel Tablo Bal izme Fonksiyonu - profesyonel ve sade tasarm\nconst drawProfessionalTableHeader = (\n  doc: jsPDFWithFontStatus,\n  x: number,\n  y: number,\n  width: number,\n  config: TableHeaderConfig\n): number => {\n  const safeText = createSafeText(doc);\n  const [primaryR, primaryG, primaryB] = PDF_CONSTANTS.primaryColor;\n\n  // Web sayfasndaki renkler - bg-[rgb(249,250,251)] border-b\n  const bgColor = config.backgroundColor || TAILWIND_COLORS.gray50; // Web: bg-[rgb(249,250,251)]\n  const textColor = config.textColor || PDF_CONSTANTS.primaryColor; // Web: text-primary\n  const borderColor = config.borderColor || [229, 231, 235]; // Web: border-b (gray200)\n\n  // Balk iin arka plan - Web sayfasndaki gibi (bg-[rgb(249,250,251)])\n  doc.setFillColor(bgColor[0], bgColor[1], bgColor[2]);\n  doc.roundedRect(x, y - PDF_CONSTANTS.tableHeaderPadding, width, PDF_CONSTANTS.tableHeaderHeight, 4, 4, \"F\");\n\n  // Alt border - Web sayfasndaki gibi (border-b)\n  doc.setDrawColor(borderColor[0], borderColor[1], borderColor[2]);\n  doc.setLineWidth(1);\n  doc.line(x, y + PDF_CONSTANTS.tableHeaderHeight - PDF_CONSTANTS.tableHeaderPadding, x + width, y + PDF_CONSTANTS.tableHeaderHeight - PDF_CONSTANTS.tableHeaderPadding);\n\n  // Balk text - Web sayfasndaki gibi (text-lg font-bold = 18px, bold)\n  doc.setTextColor(textColor[0], textColor[1], textColor[2]);\n  // Font'u bold yap\n  if (doc._robotoFontLoaded && !doc._robotoFontLoadFailed) {\n    doc.setFont(\"Roboto\", \"bold\");\n  } else {\n    doc.setFont(\"helvetica\", \"bold\");\n  }\n  safeText(config.title, x + 10, y + PDF_CONSTANTS.tableHeaderPadding, PDF_CONSTANTS.fontSizeTableHeader, true); // Kltlm: 18  16\n  doc.setTextColor(0, 0, 0);\n\n  // Balktan sonraki Y pozisyonu: headerHeight + padding + spacing (iyiletirilmi)\n  // Yeterli boluk iin optimize edildi\n  return y + PDF_CONSTANTS.tableHeaderHeight + PDF_CONSTANTS.tableHeaderSpacing - 2; // Daha kompakt (-2px)\n};\n\n// Eski fonksiyon iin alias (geriye dnk uyumluluk)\nconst drawTableHeader = drawProfessionalTableHeader;\n\n// Profesyonel Tablo Stil Konfigrasyonu - tm tablolarda kullanlacak\ninterface ProfessionalTableStyles {\n  headStyles: Record<string, unknown>;\n  bodyStyles: Record<string, unknown>;\n  styles: Record<string, unknown>;\n  alternateRowStyles: Record<string, unknown>;\n}\n\nconst createProfessionalTableStyles = (\n  doc: jsPDFWithFontStatus,\n  options?: {\n    headerFontSize?: number;\n    bodyFontSize?: number;\n    cellPadding?: { top: number; right: number; bottom: number; left: number };\n  }\n): ProfessionalTableStyles => {\n  // Standardize edilmi varsaylan deerler\n  const headerFontSize = options?.headerFontSize || PDF_CONSTANTS.fontSizeTableHeaderText;\n  const bodyFontSize = options?.bodyFontSize || PDF_CONSTANTS.fontSizeTableBody;\n  const cellPadding = options?.cellPadding || { top: 10, right: 12, bottom: 10, left: 12 };\n\n  // Font'u zorla Roboto yap - OK AGRESF YAKLAIM\n  // Font'un gerekten ykl olduunu kontrol et ve MUTLAKA Roboto kullan\n  let fontName = \"helvetica\";\n  if (doc._robotoFontLoaded && !doc._robotoFontLoadFailed) {\n    // Font'u zorla Roboto olarak ayarla - daha fazla deneme\n    for (let i = 0; i < 10; i++) {\n      try {\n        doc.setFont(\"Roboto\", \"normal\");\n        const currentFont = doc.getFont();\n        if (currentFont && isRobotoName(currentFont.fontName)) {\n          fontName = \"Roboto\";\n          break;\n        }\n      } catch {\n        // Tekrar dene\n      }\n    }\n\n    // Font listesinde Roboto var m kontrol et\n    if (fontName === \"helvetica\") {\n      try {\n        const fontList = doc.getFontList();\n        if (fontList && Object.keys(fontList).some((key) => isRobotoName(key))) {\n          // Font listesinde var, zorla kullan\n          fontName = \"Roboto\";\n          // Font'u tekrar ayarla\n          for (let i = 0; i < 5; i++) {\n            try {\n              doc.setFont(\"Roboto\", \"normal\");\n              const currentFont = doc.getFont();\n              if (currentFont && isRobotoName(currentFont.fontName)) {\n                break;\n              }\n            } catch {\n              // Tekrar dene\n            }\n          }\n        }\n      } catch {\n        // Font listesi alnamad\n      }\n    }\n  }\n\n  return {\n    headStyles: {\n      fillColor: [249, 250, 251], // Web: bg-gray-50/50 (gray50 with opacity, PDF'te tam gray50)\n      textColor: [30, 41, 59], // Koyu gri-mavi - Web: text-muted-foreground\n      fontStyle: \"bold\", // Web: font-semibold (bold kullanyoruz)\n      fontSize: headerFontSize,\n      font: fontName, // Zorla Roboto veya helvetica\n      halign: \"center\", // Balklar ortalanm\n      lineColor: TAILWIND_COLORS.gray200, // gray-200\n      lineWidth: { top: 0, bottom: 1, left: 0, right: 0 }, // Sadece alt border - Web: border-b\n      cellPadding: cellPadding,\n      minCellHeight: 40, // Minimum satr ykseklii\n      overflow: 'linebreak', // Metin tamasn nle\n      wrap: true, // Metin sarmalama\n    },\n    bodyStyles: {\n      fillColor: [255, 255, 255], // Web: beyaz arka plan\n      textColor: [30, 41, 59], // Koyu gri-mavi - Web: text-foreground\n      fontSize: bodyFontSize,\n      font: fontName, // Zorla Roboto veya helvetica\n      fontStyle: \"normal\", // Web: font-medium (normal kullanyoruz)\n      lineColor: TAILWIND_COLORS.gray200, // gray-200\n      lineWidth: { bottom: 1, top: 0, left: 0, right: 0 }, // Sadece alt border\n      cellPadding: cellPadding,\n      minCellHeight: 40, // Minimum satr ykseklii\n      overflow: 'linebreak', // Metin tamasn nle\n      wrap: true, // Metin sarmalama\n    },\n    styles: {\n      font: fontName, // Zorla Roboto veya helvetica\n      fontStyle: \"normal\",\n      fontSize: bodyFontSize,\n      cellPadding: cellPadding,\n      minCellHeight: 40, // Minimum satr ykseklii\n      overflow: 'linebreak', // Metin tamasn nle\n      wrap: true, // Metin sarmalama\n    },\n    alternateRowStyles: {\n      fillColor: TAILWIND_COLORS.gray50, // gray-50 - alternatif satrlar (ok ak)\n    },\n  };\n};\n\n// Tablo sayfa smazsa yeni sayfa ekle\nconst ensureTableFitsPage = (\n  doc: jsPDFWithFontStatus,\n  currentY: number,\n  requiredHeight: number,\n  margin: number = 40,\n  titleForNextPage?: string\n): number => {\n  const pageHeight = doc.internal.pageSize.getHeight();\n  const footerHeight = PDF_CONSTANTS.footerHeight;\n\n  // Eer tablo sayfa smazsa yeni sayfa ekle (daha fazla boluk brak)\n  const minSpaceNeeded = requiredHeight + 70; // 70pt ekstra boluk (50pt'den artrld)\n  if (currentY + minSpaceNeeded > pageHeight - footerHeight - margin) {\n    doc.addPage();\n    let nextY = margin + 30; // stten 30pt daha fazla boluk (20pt'den artrld)\n\n    // Yeni sayfada template'i uygula\n    const template = createPDFTemplate(doc);\n    drawPDFBackground(doc, template);\n\n    // \"(devam)\" etiketi kaldrld - kullanc istei\n\n    return nextY;\n  }\n\n  return currentY;\n};\n\n// Sabit zet Blm izme Fonksiyonu - tasarm sabit, veriler dinamik\nconst drawSummarySection = (\n  doc: jsPDFWithFontStatus,\n  x: number,\n  y: number,\n  width: number,\n  title: string,\n  data: Array<[string, string]>,\n  headerColor: [number, number, number] = PDF_CONSTANTS.primaryColor\n): number => {\n  const safeText = createSafeText(doc);\n  const [headerR, headerG, headerB] = headerColor;\n\n  // zet balk arka plan - sabit tasarm\n  doc.setFillColor(headerR, headerG, headerB);\n  doc.roundedRect(x, y, width, 40, 5, 5, \"F\");\n  doc.setDrawColor(headerR, headerG, headerB);\n  doc.roundedRect(x, y, width, 40, 5, 5, \"S\");\n\n  // Dekoratif izgi - sabit tasarm\n  doc.setDrawColor(255, 255, 255);\n  doc.setGState(doc.GState({ opacity: 0.3 }));\n  doc.setLineWidth(1);\n  const pageWidth = doc.internal.pageSize.getWidth();\n  doc.line(x + 5, y + 38, pageWidth - x - 5, y + 38);\n  doc.setGState(doc.GState({ opacity: 1 }));\n\n  // Balk text - dinamik (daha okunabilir font size)\n  doc.setTextColor(255, 255, 255);\n  safeText(title, x + 15, y + 26, 19, true); // yiletirildi: 18px  19px\n  doc.setTextColor(0, 0, 0);\n\n  const summaryY = y + 50;\n\n  // Font'u zorla Roboto olarak ayarla (autoTable ncesi)\n  forceRobotoFont(doc, \"normal\");\n\n  // zet tablosu - sabit stil, dinamik veriler\n  autoTable(doc, {\n    startY: summaryY,\n    head: transliterateTableData([['Metrik', 'Deer']], doc),\n    body: transliterateTableData(data, doc),\n    margin: { left: x, right: x },\n    willDrawCell: createWillDrawCell(doc),\n    headStyles: {\n      fillColor: [headerR, headerG, headerB],\n      textColor: [255, 255, 255],\n      fontStyle: \"bold\",\n      fontSize: 12,\n      font: getFontName(doc),\n      lineColor: [headerR, headerG, headerB],\n      lineWidth: { top: 1, bottom: 1, left: 1, right: 1 },\n      cellPadding: { top: 12, right: 14, bottom: 12, left: 14 }\n    },\n    bodyStyles: {\n      textColor: [31, 41, 55],\n      fontSize: 11,\n      font: getFontName(doc),\n      lineColor: [229, 231, 235],\n      lineWidth: { bottom: 1 },\n      cellPadding: { top: 12, right: 14, bottom: 12, left: 14 }\n    },\n    styles: {\n      font: getFontName(doc),\n      fontStyle: \"normal\",\n      fontSize: 11,\n      cellPadding: { top: 12, right: 14, bottom: 12, left: 14 }\n    },\n    columnStyles: {\n      0: { cellWidth: \"auto\", halign: \"left\", fontStyle: \"bold\" },\n      1: { cellWidth: 150, halign: \"right\", fontStyle: \"bold\", textColor: [headerR, headerG, headerB] },\n    },\n    alternateRowStyles: {\n      fillColor: [249, 250, 251]\n    },\n  });\n\n  const finalY = (doc.lastAutoTable?.finalY || summaryY) + 50; // Optimize edilmi boluk: 50pt\n  return finalY;\n};\n\n// Font ykleme durumunu takip etmek iin doc objesine property ekle\ninterface jsPDFWithFontStatus extends jsPDF {\n  _robotoFontLoaded?: boolean;\n  _robotoFontLoadFailed?: boolean; // Font ykleme baarsz olduysa tekrar deneme\n  _robotoSupportsTurkish?: boolean; // Font'un Trke karakterleri destekleyip desteklemedii\n  _turkishCharsTested?: boolean; // Trke karakter testi yapld m?\n  lastAutoTable?: {\n    finalY?: number;\n  };\n}\n\n// Font URLs (Google Fonts CDN) - Artk kullanlmyor ama referans iin tutulabilir veya silinebilir\n// const ROBOTO_REGULAR_URL = \"https://fonts.gstatic.com/s/roboto/v30/KFOmCnqEu92Fr1Mu4mxP.ttf\";\n// const ROBOTO_BOLD_URL = \"https://fonts.gstatic.com/s/roboto/v30/KFOlCnqEu92Fr1MmWUlfBBc9.ttf\";\n\n// Font cache - Base64 import edildii iin gerek kalmad\n// const fontCache: Record<string, string> = {};\n\n// Fetch font and convert to base64 - Artk kullanlmyor\n// const fetchFont = async (url: string): Promise<string> => { ... };\n\nconst isRobotoName = (fontName?: string): boolean => {\n  if (!fontName) return false;\n  return fontName.toLowerCase().includes(\"roboto\");\n};\n\n// Glendirilmi Font Ynetimi\nconst registerFonts = async (doc: jsPDFWithFontStatus) => {\n  // Eer font zaten yklendiyse tekrar ykleme\n  if (doc._robotoFontLoaded && !doc._robotoFontLoadFailed) {\n    // Font'un gerekten ykl olduunu dorula\n    try {\n      const currentFont = doc.getFont();\n      if (currentFont && isRobotoName(currentFont.fontName)) {\n        // Font ykl, Trke karakter desteini test et\n        try {\n          doc.setFontSize(12);\n          doc.text(\"\", -1000, -1000);\n          return; // Font zaten ykl ve alyor\n        } catch (testError) {\n          // Trke karakter testi baarsz, ama font ykl olabilir\n          // Font'u yeniden ykle\n          doc._robotoFontLoaded = false;\n        }\n      } else {\n        // Font ykl deil, yeniden ykle\n        doc._robotoFontLoaded = false;\n      }\n    } catch {\n      // Font kontrol baarsz, yeniden ykle\n      doc._robotoFontLoaded = false;\n    }\n  }\n\n  // Eer daha nce ykleme baarsz olduysa, tekrar dene (flag'i reset et)\n  if (doc._robotoFontLoadFailed) {\n    // Bir kez daha deneme ans ver\n    doc._robotoFontLoadFailed = false;\n    // Devam et, font ykleme ilemini tekrar dene\n  }\n\n  // Font string'lerinin kesilmi olup olmadn kontrol et\n  // Eer \"...\" ile bitiyorsa, font string'leri kesilmi demektir\n  // Ayrca string'lerin ok ksa olup olmadn kontrol et (base64 font'lar genellikle ok uzun olur)\n  if (ROBOTO_REGULAR_BASE64.endsWith('...') || ROBOTO_BOLD_BASE64.endsWith('...') ||\n    ROBOTO_REGULAR_BASE64.length < 1000 || ROBOTO_BOLD_BASE64.length < 1000) {\n    doc.setFont(\"helvetica\", \"normal\");\n    doc._robotoFontLoaded = false;\n    doc._robotoFontLoadFailed = true;\n    return;\n  }\n\n  try {\n    // Base64 string'lerin dzgn formatta olduundan emin ol\n    // nce data: prefix'i varsa temizle\n    let cleanRegular = ROBOTO_REGULAR_BASE64.replace(/^data:.*?,/, '').trim();\n    let cleanBold = ROBOTO_BOLD_BASE64.replace(/^data:.*?,/, '').trim();\n\n\n    // \"...\" gibi kesilme iaretlerini kaldr (eer varsa)\n    cleanRegular = cleanRegular.replace(/\\.\\.\\.$/, '').trim();\n    cleanBold = cleanBold.replace(/\\.\\.\\.$/, '').trim();\n\n    // Eer string'ler bosa, direkt helvetica'ya ge\n    if (!cleanRegular || !cleanBold || cleanRegular.length === 0 || cleanBold.length === 0) {\n      throw new Error(\"Font base64 string'leri bo\");\n    }\n\n    // Tm whitespace karakterlerini kaldr (boluk, tab, newline, vb.)\n    cleanRegular = cleanRegular.replace(/\\s+/g, '');\n    cleanBold = cleanBold.replace(/\\s+/g, '');\n\n    // Sadece geerli base64 karakterlerini tut (A-Z, a-z, 0-9, +, /, =)\n    cleanRegular = cleanRegular.replace(/[^A-Za-z0-9+/=]/g, '');\n    cleanBold = cleanBold.replace(/[^A-Za-z0-9+/=]/g, '');\n\n    // Padding dzeltmesi (Base64 string uzunluu 4'n kat olmal)\n    const regularPadding = (4 - (cleanRegular.length % 4)) % 4;\n    const boldPadding = (4 - (cleanBold.length % 4)) % 4;\n    cleanRegular += '='.repeat(regularPadding);\n    cleanBold += '='.repeat(boldPadding);\n\n    if (cleanRegular.length === 0 || cleanBold.length === 0) {\n      throw new Error(\"Font base64 string'leri bo\");\n    }\n\n    // Add to VFS - her admda hata kontrol yap\n    try {\n      doc.addFileToVFS(\"Roboto-Regular.ttf\", cleanRegular);\n      doc.addFileToVFS(\"Roboto-Bold.ttf\", cleanBold);\n    } catch (vfsError) {\n      throw new Error(\"Font VFS'e eklenemedi: \" + vfsError);\n    }\n\n    // Add fonts - her admda hata kontrol yap\n    // NEML: Font'u eklemeden nce VFS'de olduundan emin ol\n    try {\n      const fontListBefore = doc.getFontList();\n\n      // Font'u ekle - font ad \"Roboto\" olmal\n      doc.addFont(\"Roboto-Regular.ttf\", \"Roboto\", \"normal\");\n\n      // Font'un eklendiini dorula\n      const fontListAfterRegular = doc.getFontList();\n      const hasRobotoRegular = fontListAfterRegular && Object.keys(fontListAfterRegular).some((key) => isRobotoName(key));\n\n\n      if (!hasRobotoRegular) {\n        throw new Error(\"Roboto Regular font eklenemedi\");\n      }\n\n      doc.addFont(\"Roboto-Bold.ttf\", \"Roboto\", \"bold\");\n\n      // Font'un eklendiini dorula\n      const fontListAfterBold = doc.getFontList();\n      const hasRobotoBold = fontListAfterBold && Object.keys(fontListAfterBold).some((key) => isRobotoName(key));\n\n      if (!hasRobotoBold) {\n        // Roboto Bold font eklenemedi, ama Regular ykl\n      }\n    } catch (addFontError) {\n      // Font eklenemedi, VFS'den temizle\n      try {\n        // VFS'den silmek iin bir yntem yok, ama flag'i set edelim\n      } catch (error) {\n        // VFS'den silmek iin bir yntem yok, ama flag'i set edelim\n      }\n      throw new Error(\"Font eklenemedi: \" + addFontError);\n    }\n\n    // Set default font ve test et\n    try {\n      doc.setFont(\"Roboto\", \"normal\");\n\n      const fontAfterSet = doc.getFont();\n    } catch (setFontError) {\n      throw new Error(\"Font ayarlanamad: \" + setFontError);\n    }\n\n    // Font'un gerekten yklendiini test et - basit bir text yazmay dene\n    try {\n      const fontList = doc.getFontList();\n      // Font listesinde Roboto var m kontrol et\n      const hasRoboto =\n        fontList &&\n        Object.keys(fontList).some((fontKey) => isRobotoName(fontKey));\n\n\n      if (!hasRoboto) {\n        throw new Error(\"Roboto font listesinde bulunamad\");\n      }\n      // Font'un gerekten altn test et - Trke karakter testi\n      const currentFont = doc.getFont();\n      if (!currentFont || !isRobotoName(currentFont.fontName)) {\n        throw new Error(\"Font ayarland ama font name elemiyor\");\n      }\n\n      // Trke karakter testi - \"\" karakterlerini test et - daha kapsaml test\n      // zellikle , , ,  karakterlerini test et (kullancnn belirttii karakterler)\n      let turkishTestPassed = false;\n      try {\n        doc.setFontSize(12);\n        // Test text'i yaz (grnmez bir yere) - tm Trke karakterleri test et\n        // zellikle , , ,  karakterlerini test et (kullancnn belirttii karakterler)\n        const testText = \"\";\n\n        // Font'u tekrar ayarla ve test et - daha agresif\n        for (let i = 0; i < 5; i++) {\n          try {\n            doc.setFont(\"Roboto\", \"normal\");\n            doc.setFontSize(12);\n            const checkFont = doc.getFont();\n            if (checkFont && isRobotoName(checkFont.fontName)) {\n              // Font Roboto, test text'i yaz\n              doc.text(testText, -1000, -1000);\n              turkishTestPassed = true;\n              break;\n            }\n          } catch {\n            // Tekrar dene\n          }\n        }\n\n        if (!turkishTestPassed) {\n          // Trke karakter testi baarsz, ama font ykl olabilir\n          // Font listesini kontrol et\n          try {\n            const fontList = doc.getFontList();\n            const hasRoboto = fontList && Object.keys(fontList).some((key) => isRobotoName(key));\n            if (hasRoboto) {\n              // Font listesinde var, ykleme baarl saylabilir\n              turkishTestPassed = true;\n            }\n          } catch {\n            // Font listesi alnamad\n          }\n        }\n\n        // Font'un gerekten altn dorula\n        const verifyFont = doc.getFont();\n        if (verifyFont && isRobotoName(verifyFont.fontName) && turkishTestPassed) {\n          doc._robotoFontLoaded = true;\n          doc._robotoFontLoadFailed = false;\n          // Font ykl ve ayarlanm - Trke karakterleri destekliyor\n        } else if (turkishTestPassed) {\n          // Trke test baarl ama font ad elemiyor, yine de kabul et\n          doc._robotoFontLoaded = true;\n          doc._robotoFontLoadFailed = false;\n        } else {\n          throw new Error(\"Font test sonras dorulama baarsz\");\n        }\n      } catch (textWriteError) {\n        // Text yazma hatas - font Trke karakterleri desteklemiyor olabilir\n        // Ama yine de font ykl olabilir, bu yzden devam et\n        // Font listesinde varsa kabul et\n        try {\n          const fontList = doc.getFontList();\n          const hasRoboto = fontList && Object.keys(fontList).some((key) => isRobotoName(key));\n          const currentFont = doc.getFont();\n          if (hasRoboto && currentFont && isRobotoName(currentFont.fontName)) {\n            doc._robotoFontLoaded = true;\n            doc._robotoFontLoadFailed = false;\n          } else {\n            throw new Error(\"Font test baarsz: \" + textWriteError);\n          }\n        } catch (finalError) {\n          throw new Error(\"Font test baarsz: \" + textWriteError);\n        }\n      }\n    } catch (fontTestError) {\n      // Font test baarsz, helvetica'ya ge\n      doc.setFont(\"helvetica\", \"normal\");\n      throw new Error(\"Font yklendi ama kullanlamyor: \" + fontTestError);\n    }\n  } catch (e) {\n    doc.setFont(\"helvetica\", \"normal\");\n    doc._robotoFontLoaded = false;\n    doc._robotoFontLoadFailed = true; // Bir daha deneme\n  }\n};\n\nconst safeSetFont = (doc: jsPDFWithFontStatus, style: \"normal\" | \"bold\" = \"normal\") => {\n  // Font yklenmemise veya ykleme baarszsa direkt helvetica kullan\n  if (!doc._robotoFontLoaded || doc._robotoFontLoadFailed) {\n    try {\n      doc.setFont(\"helvetica\", style);\n    } catch {\n      // Helvetica bile baarsz olursa hibir ey yapma\n    }\n    return;\n  }\n\n  // Roboto font'unu zorla ayarla - daha agresif yaklam\n\n  let attempts = 0;\n  let fontSet = false;\n  const maxAttempts = 3;\n\n  while (attempts < maxAttempts && !fontSet) {\n    try {\n      // Roboto font'unu kullanmay dene\n      doc.setFont(\"Roboto\", style);\n\n      // Font'un gerekten ayarlandn kontrol et - daha sk kontrol\n      const currentFont = doc.getFont();\n      if (currentFont && isRobotoName(currentFont.fontName)) {\n        // Font baaryla ayarland, dorula\n        // Trke karakter testi yap (grnmez yere)\n        try {\n          doc.setFontSize(12);\n          doc.text(\"\", -1000, -1000);\n          fontSet = true;\n          break;\n        } catch (testError) {\n          // Test baarsz ama font ykl olabilir, font listesini kontrol et\n          const fontList = doc.getFontList();\n          const hasRoboto = fontList && Object.keys(fontList).some((key) => isRobotoName(key));\n          if (hasRoboto) {\n            fontSet = true;\n            break;\n          }\n        }\n      }\n\n      attempts++;\n      if (attempts < maxAttempts) {\n        // Ksa bir bekleme (synchronous delay simlasyonu)\n        // Tekrar dene\n      }\n    } catch (error) {\n      attempts++;\n      if (attempts >= maxAttempts) {\n        // Tm denemeler baarsz, helvetica'ya ge\n        try {\n          doc.setFont(\"helvetica\", style);\n          doc._robotoFontLoaded = false;\n          doc._robotoFontLoadFailed = true;\n        } catch {\n          // Son are: hibir ey yapma\n        }\n        return;\n      }\n    }\n  }\n\n  // Font ayarlanamadysa helvetica'ya geri dn\n  if (!fontSet) {\n    try {\n      doc.setFont(\"helvetica\", style);\n      doc._robotoFontLoaded = false;\n      doc._robotoFontLoadFailed = true;\n    } catch {\n      // Son are: hibir ey yapma\n    }\n  }\n};\n\n// Glendirilmi Tipografi Ayarlar\nconst applyDocumentTypography = (doc: jsPDFWithFontStatus) => {\n  doc.setLineHeightFactor(1.5); // Profesyonel satr aral (1.4  1.5)\n\n  // Font'u OK AGRESF ekilde ayarla - MUTLAKA Roboto kullan\n  if (doc._robotoFontLoaded && !doc._robotoFontLoadFailed) {\n    // Font'u 10 kez deneyerek zorla Roboto olarak ayarla\n    let fontSet = false;\n    for (let i = 0; i < 10; i++) {\n      try {\n        doc.setFont(\"Roboto\", \"normal\");\n        const currentFont = doc.getFont();\n        if (currentFont && isRobotoName(currentFont.fontName)) {\n          fontSet = true;\n          break;\n        }\n      } catch {\n        // Tekrar dene\n      }\n    }\n\n    if (!fontSet) {\n      // Font ayarlanamad, Helvetica'ya ge\n      doc.setFont(\"helvetica\", \"normal\");\n      doc._robotoFontLoaded = false;\n      doc._robotoFontLoadFailed = true;\n    } else {\n      // Font baaryla ayarland, dorula\n      const verifyFont = doc.getFont();\n      if (verifyFont && isRobotoName(verifyFont.fontName)) {\n      }\n    }\n  } else {\n    doc.setFont(\"helvetica\", \"normal\");\n  }\n\n  doc.setFontSize(11); // Profesyonel font boyutu\n};\n\n// Font'u zorla Roboto olarak ayarla - helper fonksiyon\nconst forceRobotoFont = (doc: jsPDFWithFontStatus, style: \"normal\" | \"bold\" = \"normal\") => {\n  if (doc._robotoFontLoaded && !doc._robotoFontLoadFailed) {\n    for (let i = 0; i < 10; i++) {\n      try {\n        doc.setFont(\"Roboto\", style);\n        const currentFont = doc.getFont();\n        if (currentFont && isRobotoName(currentFont.fontName)) {\n          return true;\n        }\n      } catch {\n        // Tekrar dene\n      }\n    }\n  }\n  return false;\n};\n\nconst getFontName = (doc?: jsPDFWithFontStatus): string => {\n  // Roboto font yklyse ve baarsz olmadysa kullan\n  if (doc?._robotoFontLoaded && !doc?._robotoFontLoadFailed) {\n    // Font'un gerekten ykl olduunu kontrol et\n    try {\n      // nce mevcut font'u kontrol et\n      const currentFont = doc?.getFont();\n      if (currentFont && isRobotoName(currentFont.fontName)) {\n        return \"Roboto\";\n      }\n\n      // Font listesini kontrol et\n      const fontList = doc?.getFontList();\n      if (fontList && Object.keys(fontList).some((key) => isRobotoName(key))) {\n        // Font listesinde var, zorla ayarla\n        try {\n          doc?.setFont(\"Roboto\", \"normal\");\n          const verifyFont = doc?.getFont();\n          if (verifyFont && isRobotoName(verifyFont.fontName)) {\n            return \"Roboto\";\n          }\n        } catch {\n          // Font ayarlanamad\n        }\n        // Yine de Roboto dndr - font listesinde var\n        return \"Roboto\";\n      }\n    } catch (error) {\n      // Font kontrol baarsz, ama yine de Roboto dene\n      if (doc?._robotoFontLoaded && !doc?._robotoFontLoadFailed) {\n        return \"Roboto\";\n      }\n    }\n  }\n  // Eer Roboto yklenemezse, Helvetica kullan (autoTable iin)\n  // Helvetica Trke karakterleri desteklemez ama en azndan alr\n  return \"helvetica\";\n};\n\n// Glendirilmi Trke Karakter Destei - willDrawCell hook'u (didParseCell yerine)\n// willDrawCell daha ge alr ve font ayarlarnn override edilmesini nler\ninterface CellHookData {\n  cell?: {\n    text?: string | string[];\n    fontStyle?: string;\n    font?: string;\n    styles?: {\n      font?: string;\n      fontStyle?: string;\n      fontSize?: number;\n    };\n    x?: number;\n    y?: number;\n    width?: number;\n    height?: number;\n  };\n  row?: {\n    index?: number;\n  };\n  column?: {\n    index?: number;\n  };\n  x?: number;\n  y?: number;\n  width?: number;\n  height?: number;\n}\n\nconst createWillDrawCell = (doc: jsPDFWithFontStatus) => {\n  return (data: CellHookData) => {\n    if (!data.cell) return;\n\n    const cell = data.cell;\n\n    // Font style' belirle\n    const fontStyle = (cell.fontStyle === \"bold\" || cell.styles?.fontStyle === \"bold\" || cell.styles?.font === \"bold\") ? \"bold\" : \"normal\";\n\n    // Eer Roboto font yklyse, font'u zorla ayarla\n    if (doc._robotoFontLoaded && !doc._robotoFontLoadFailed) {\n      try {\n        // Font'u gvenli ekilde ayarla - daha agresif\n        safeSetFont(doc, fontStyle);\n\n        // Font'un gerekten Roboto olduunu kontrol et - daha sk kontrol\n        let attempts = 0;\n        let fontVerified = false;\n        const maxAttempts = 10;\n\n        while (attempts < maxAttempts && !fontVerified) {\n          try {\n            doc.setFont(\"Roboto\", fontStyle);\n            const currentFont = doc.getFont();\n            if (currentFont && isRobotoName(currentFont.fontName)) {\n              fontVerified = true;\n              break;\n            }\n            attempts++;\n          } catch {\n            attempts++;\n            if (attempts >= maxAttempts) break;\n          }\n        }\n\n        // cell.styles'i mutlaka ayarla\n        if (!cell.styles) {\n          cell.styles = {};\n        }\n\n        if (fontVerified) {\n          // Font Roboto - cell.styles.font kullan (willDrawCell'de bu daha etkili)\n          cell.styles.font = \"Roboto\";\n          cell.styles.fontStyle = fontStyle;\n\n          // Roboto font Trke karakterleri destekler, translitere etmeye gerek yok\n          // Text'i olduu gibi brak - Trke karakterler korunacak\n\n          // Font ayarlamas iin string kontrol yap\n          const textString = typeof cell.text === 'string' ? cell.text : (Array.isArray(cell.text) ? (cell.text as string[]).join(' ') : '');\n          if (textString) {\n            // Font'u zorla ayarla - Roboto kullan\n            try {\n              const fontList = doc.getFontList();\n              const hasRoboto = fontList && Object.keys(fontList).some((key) => isRobotoName(key));\n              if (hasRoboto) {\n                // Font listesinde var, zorla ayarla\n                for (let i = 0; i < 10; i++) {\n                  try {\n                    doc.setFont(\"Roboto\", fontStyle);\n                    if (cell.styles?.fontSize) {\n                      doc.setFontSize(cell.styles.fontSize);\n                    }\n                    const verifyFont = doc.getFont();\n                    if (verifyFont && isRobotoName(verifyFont.fontName)) {\n                      break;\n                    }\n                  } catch {\n                    // Tekrar dene\n                  }\n                }\n              }\n            } catch {\n              // Font listesi alnamad, yine de zorla ayarla\n              try {\n                doc.setFont(\"Roboto\", fontStyle);\n                if (cell.styles?.fontSize) {\n                  doc.setFontSize(cell.styles.fontSize);\n                }\n              } catch {\n                // Font ayarlanamad\n              }\n            }\n          } else {\n            // Text yok, normal font ayarlamas yap\n            for (let i = 0; i < 5; i++) {\n              try {\n                doc.setFont(\"Roboto\", fontStyle);\n                const verifyFont = doc.getFont();\n                if (verifyFont && isRobotoName(verifyFont.fontName)) {\n                  break;\n                }\n              } catch {\n                // Tekrar dene\n              }\n            }\n          }\n        } else {\n          // Font Roboto deilse, Helvetica'ya ge\n          cell.styles.font = \"helvetica\";\n          cell.styles.fontStyle = fontStyle;\n\n          // Helvetica Trke karakterleri desteklemiyor, transliterate et\n          if (cell.text && typeof cell.text === 'string') {\n            try {\n              cell.text = transliterateTurkish(cell.text);\n            } catch {\n              // Text deitirilemez, devam et\n            }\n          } else if (cell.text && Array.isArray(cell.text)) {\n            try {\n              cell.text = (cell.text as string[]).map((item: unknown): string => {\n                if (typeof item === 'string') {\n                  return transliterateTurkish(item);\n                }\n                return String(item);\n              });\n            } catch {\n              // Text deitirilemez, devam et\n            }\n          }\n        }\n      } catch {\n        // Font ayarlama hatas, Helvetica'ya ge\n        if (!cell.styles) {\n          cell.styles = {};\n        }\n        cell.styles.font = \"helvetica\";\n        cell.styles.fontStyle = fontStyle;\n      }\n    } else {\n      // Helvetica kullanlyorsa veya font yklenmemise\n      if (!cell.styles) {\n        cell.styles = {};\n      }\n      cell.styles.font = \"helvetica\";\n      cell.styles.fontStyle = fontStyle;\n\n      // Helvetica Trke karakterleri desteklemiyor, transliterate et\n      if (cell.text) {\n        if (typeof cell.text === 'string') {\n          try {\n            cell.text = transliterateTurkish(cell.text);\n          } catch {\n            // Text deitirilemez, devam et\n          }\n        } else if (Array.isArray(cell.text)) {\n          try {\n            cell.text = (cell.text as string[]).map((item: unknown): string => {\n              if (typeof item === 'string') {\n                return transliterateTurkish(item);\n              }\n              return String(item);\n            });\n          } catch {\n            // Text deitirilemez, devam et\n          }\n        }\n      }\n    }\n  };\n};\n\n// Eski didParseCell hook'u - geriye dnk uyumluluk iin (kullanlmyor ama silmiyoruz)\nconst createDidParseCell = (doc: jsPDFWithFontStatus) => {\n  return (data: CellHookData) => {\n    // willDrawCell kullanyoruz, bu fonksiyon artk kullanlmyor\n    // Ama baz yerlerde hala didParseCell kullanlyor olabilir, bu yzden willDrawCell'i ar\n    return createWillDrawCell(doc)(data);\n  };\n};\n\n// PDF oluturma helper fonksiyonu\nconst createPdf = (options: jsPDFOptions = { format: \"a4\", unit: \"pt\" }) => {\n  const doc = new jsPDF(options) as jsPDFWithFontStatus;\n  return doc;\n};\n\n// Ortak yardmc fonksiyonlar\nconst formatDate = (dateStr: string) => {\n  if (!dateStr || dateStr.trim() === \"\") return \"-\";\n  try {\n    const date = new Date(dateStr);\n    // Geersiz tarih kontrol\n    if (isNaN(date.getTime()) || !isFinite(date.getTime())) {\n      return \"-\";\n    }\n    const months = [\n      \"Ocak\", \"ubat\", \"Mart\", \"Nisan\", \"Mays\", \"Haziran\",\n      \"Temmuz\", \"Austos\", \"Eyll\", \"Ekim\", \"Kasm\", \"Aralk\"\n    ];\n    // Grseldeki format: \"20 Austos 2025\" (ay ve yl arasnda boluk var)\n    const day = date.getDate();\n    const monthIndex = date.getMonth();\n    const year = date.getFullYear();\n\n    // Geerli deerler kontrol - tm deerlerin geerli olduundan emin ol\n    if (isNaN(day) || isNaN(monthIndex) || isNaN(year) ||\n      monthIndex < 0 || monthIndex > 11 ||\n      day < 1 || day > 31 ||\n      year < 1900 || year > 2100) {\n      return \"-\";\n    }\n\n    const month = months[monthIndex];\n    if (!month) {\n      return \"-\";\n    }\n\n    return `${day} ${month} ${year}`;\n  } catch (error) {\n    return \"-\";\n  }\n};\n\nconst formatDateShort = (dateStr: string) => {\n  const date = new Date(dateStr);\n  return date.toLocaleDateString('tr-TR');\n};\n\ntype TotalsSummary = {\n  subtotal: number;\n  discount: number;\n  tax: number;\n  grandTotal: number;\n};\n\nconst ensureSpace = (\n  doc: jsPDF,\n  currentY: number,\n  requiredHeight: number,\n  margin = 40,\n  titleForNextPage?: string\n) => {\n  const pageHeight = doc.internal.pageSize.getHeight();\n  const footerHeight = PDF_CONSTANTS.footerHeight;\n\n  // Daha fazla boluk brak (70pt ekstra - 50pt'den artrld)\n  const minSpaceNeeded = requiredHeight + 70;\n  if (currentY + minSpaceNeeded > pageHeight - footerHeight - margin) {\n    doc.addPage();\n    let nextY = margin + 30; // stten 30pt daha fazla boluk (20pt'den artrld)\n\n    // Yeni sayfada template'i uygula\n    const template = createPDFTemplate(doc as jsPDFWithFontStatus);\n    drawPDFBackground(doc as jsPDFWithFontStatus, template);\n\n    if (titleForNextPage) {\n      const safeText = createSafeText(doc as jsPDFWithFontStatus);\n      safeSetFont(doc as jsPDFWithFontStatus, \"bold\");\n      // \"(devam)\" etiketi kaldrld - kullanc istei\n    }\n    return nextY;\n  }\n  return currentY;\n};\n\nconst formatCurrency = (value: number, currency = \"\") => {\n  const safeValue = Number.isFinite(value) ? value : 0;\n  // Binlik ayrclar ile formatla (web UI ile uyumlu)\n  const formatted = safeValue.toLocaleString(\"tr-TR\", {\n    minimumFractionDigits: 2,\n    maximumFractionDigits: 2\n  });\n  return `${currency}${formatted}`;\n};\n\n// Optimize edilmi helper fonksiyonlar - tm PDF'lerde kullanlabilir\nconst safeNumber = (value: unknown): number => {\n  const num = Number(value);\n  return (isNaN(num) || !isFinite(num)) ? 0 : num;\n};\n\nconst safeFormatCurrency = (value: number): string => {\n  const safeVal = safeNumber(value);\n  // Daha okunabilir format: binlik ayrclar ve 2 ondalk basamak\n  const formatted = safeVal.toLocaleString(\"tr-TR\", {\n    minimumFractionDigits: 2,\n    maximumFractionDigits: 2\n  });\n  return `${formatted}`;\n};\n\nconst drawInfoCard = (\n  doc: jsPDF,\n  {\n    x,\n    y,\n    width,\n    title,\n    rows,\n  }: { x: number; y: number; width: number; title: string; rows: Array<{ label: string; value?: string }> }\n) => {\n  const padding = 16;\n  const innerWidth = width - padding * 2;\n  const preparedRows = rows.map((row) => ({\n    label: row.label,\n    lines: doc.splitTextToSize(row.value && row.value.trim() ? row.value : \"-\", innerWidth),\n  }));\n  const baseHeight = padding + 18;\n  const rowsHeight = preparedRows.reduce((sum, row) => sum + 12 + row.lines.length * 14 + 6, 0);\n  const height = baseHeight + rowsHeight + padding / 2;\n\n  doc.setFillColor(248, 249, 252);\n  doc.setDrawColor(229, 234, 244);\n  doc.roundedRect(x, y, width, height, 10, 10, \"F\");\n  doc.roundedRect(x, y, width, height, 10, 10, \"S\");\n\n  const safeText = createSafeText(doc as jsPDFWithFontStatus);\n  let cursorY = y + padding;\n  safeText(title, x + padding, cursorY, 12, true);\n  cursorY += 18;\n\n  preparedRows.forEach((row) => {\n    safeText(row.label.toUpperCase(), x + padding, cursorY, 9, true);\n    cursorY += 12;\n\n    row.lines.forEach((line) => {\n      safeText(line, x + padding, cursorY, 11, false);\n      cursorY += 14;\n    });\n    cursorY += 6;\n  });\n\n  doc.setTextColor(0, 0, 0);\n  return height;\n};\n\nconst drawTermsBlock = (\n  doc: jsPDF,\n  { x, y, width, terms }: { x: number; y: number; width: number; terms?: string[] }\n) => {\n  const padding = 16;\n  const innerWidth = width - padding * 2;\n  const termsList = (terms && terms.length > 0 ? terms : [\"zel art belirtilmemitir.\"]).filter(\n    (term) => term && term.trim()\n  );\n  const termLines = termsList.flatMap((term) => doc.splitTextToSize(` ${term}`, innerWidth));\n  const height = padding * 2 + 18 + termLines.length * 14;\n\n  doc.setFillColor(253, 253, 255);\n  doc.setDrawColor(229, 234, 244);\n  doc.roundedRect(x, y, width, height, 10, 10, \"F\");\n  doc.roundedRect(x, y, width, height, 10, 10, \"S\");\n\n  const safeText = createSafeText(doc as jsPDFWithFontStatus);\n  let cursorY = y + padding;\n  safeText(\"artlar\", x + padding, cursorY, 12, true);\n  cursorY += 18;\n\n  termLines.forEach((line) => {\n    safeText(line, x + padding, cursorY, 11, false);\n    cursorY += 14;\n  });\n\n  doc.setTextColor(0, 0, 0);\n  return height;\n};\n\nconst drawSummaryBlock = (\n  doc: jsPDF,\n  {\n    x,\n    y,\n    width,\n    totals,\n    currency,\n    taxRate,\n  }: { x: number; y: number; width: number; totals: TotalsSummary; currency: string; taxRate: number }\n) => {\n  const padding = 16;\n  const rows: Array<{ label: string; value: string; isAccent?: boolean }> = [];\n\n  if ((totals.discount || 0) > 0) {\n    rows.push({\n      label: \"Toplam skonto\",\n      value: `-${formatCurrency(totals.discount, currency)}`,\n      isAccent: true,\n    });\n  }\n\n  rows.push(\n    { label: \"Ara Toplam\", value: formatCurrency(totals.subtotal, currency) },\n    { label: `KDV (%${taxRate || 0})`, value: formatCurrency(totals.tax, currency) }\n  );\n\n  const contentHeight = rows.length * 20 + 40;\n  const height = padding * 2 + contentHeight + 32;\n\n  doc.setFillColor(248, 249, 252);\n  doc.setDrawColor(229, 234, 244);\n  doc.roundedRect(x, y, width, height, 10, 10, \"F\");\n  doc.roundedRect(x, y, width, height, 10, 10, \"S\");\n\n  const safeText = createSafeText(doc as jsPDFWithFontStatus);\n  let cursorY = y + padding;\n  safeText(\"deme zeti\", x + padding, cursorY, 12, true);\n  cursorY += 18;\n\n  rows.forEach((row) => {\n    safeText(row.label, x + padding, cursorY, 10, true);\n\n    const valueWidth = doc.getTextWidth(row.value);\n    safeText(row.value, x + width - padding - valueWidth, cursorY, row.isAccent ? 11 : 11, row.isAccent);\n    cursorY += 20;\n  });\n\n  doc.setDrawColor(229, 234, 244);\n  doc.line(x + padding, cursorY, x + width - padding, cursorY);\n  cursorY += 18;\n\n  safeText(\"GENEL TOPLAM\", x + padding, cursorY, 13, true);\n\n  const grandTotalText = formatCurrency(totals.grandTotal, currency);\n  const grandTotalWidth = doc.getTextWidth(grandTotalText);\n  safeText(grandTotalText, x + width - padding - grandTotalWidth, cursorY, 16, true);\n\n  doc.setTextColor(0, 0, 0);\n  return height;\n};\n\n// Header template'i - sabit komponentler + dinamik ierik\nconst drawPDFHeader = (doc: jsPDFWithFontStatus, template: PDFTemplateLayout, title: string, reportDate: string, startDate?: string, endDate?: string) => {\n  const mar = PDF_CONSTANTS.margin;\n  const pageWidth = doc.internal.pageSize.getWidth();\n  const logoSize = PDF_CONSTANTS.logoSize;\n  const [primaryR, primaryG, primaryB] = PDF_CONSTANTS.primaryColor;\n  const [mutedR, mutedG, mutedB] = PDF_CONSTANTS.mutedColor;\n\n  // Header izgisi header ieriinden SONRA izilecek (drawPDFHeader iinde)\n\n  const safeText = createSafeText(doc);\n\n  // Font'u Roboto olarak ayarla\n  if (doc._robotoFontLoaded && !doc._robotoFontLoadFailed) {\n    for (let i = 0; i < 10; i++) {\n      try {\n        doc.setFont(\"Roboto\", \"normal\");\n        const currentFont = doc.getFont();\n        if (currentFont && isRobotoName(currentFont.fontName)) {\n          break;\n        }\n      } catch {\n        // Tekrar dene\n      }\n    }\n  }\n\n  // YEN HEADER TASARIMI: Logo sol, Balk orta, Tarih/irket bilgileri sa\n\n  // === SOL TARAF: Logo ve REVIUM (en solda, margin iinde) ===\n  const logoX = mar; // En solda, margin'den balar\n  const logoY = 35; // stten 35px (25  35, stte ek boluk)\n  const logoFramePadding = 2; // ereve padding'i\n  const logoFrameSize = logoSize + (logoFramePadding * 2); // ereve boyutu\n\n  // Logo iin arka plan kutusu - minimal\n  doc.setFillColor(255, 255, 255);\n  doc.roundedRect(logoX - logoFramePadding, logoY - logoFramePadding, logoFrameSize, logoFrameSize, 4, 4, \"F\");\n  doc.setDrawColor(primaryR, primaryG, primaryB);\n  doc.setGState(doc.GState({ opacity: 0.1 }));\n  doc.setLineWidth(1);\n  doc.roundedRect(logoX - logoFramePadding, logoY - logoFramePadding, logoFrameSize, logoFrameSize, 4, 4, \"S\");\n  doc.setGState(doc.GState({ opacity: 1 }));\n\n  try {\n    doc.addImage(REV_LOGO_DATA_URI, 'PNG', logoX, logoY, logoSize, logoSize);\n  } catch (error) {\n    // Logo eklenemezse sessizce devam et\n  }\n\n  // REVIUM brand name - logonun EREVESNN altnda ORTALANMI\n  doc.setTextColor(primaryR, primaryG, primaryB);\n  // REVIUM text geniliini hesapla ve logonun erevesinin ortasna hizala\n  if (doc._robotoFontLoaded && !doc._robotoFontLoadFailed) {\n    doc.setFont(\"Roboto\", \"bold\");\n    doc.setFontSize(14);\n  } else {\n    doc.setFont(\"helvetica\", \"bold\");\n    doc.setFontSize(14);\n  }\n  const reviumTextWidth = doc.getTextWidth(\"REVIUM\");\n  const reviumX = logoX - logoFramePadding + (logoFrameSize / 2) - (reviumTextWidth / 2); // ereve ortasna hizala\n  const reviumY = logoY + logoSize + logoFramePadding + 12; // Logo + ereve altndan 12px aa (6  12, daha aa)\n  safeText(\"REVIUM\", reviumX, reviumY, 14, true);\n  doc.setTextColor(0, 0, 0);\n\n  // === ORTA TARAF: Balk (sayfa geniliinde ortalanm) ===\n  // Bal sayfa geniliinde ortala\n  const titleY = 45; // stten 45px (35  45, stte ek boluk)\n\n  // Report title - dinamik (sayfa geniliinde ortada)\n  doc.setTextColor(primaryR, primaryG, primaryB);\n  if (doc._robotoFontLoaded && !doc._robotoFontLoadFailed) {\n    for (let i = 0; i < 10; i++) {\n      try {\n        doc.setFont(\"Roboto\", \"bold\");\n        const currentFont = doc.getFont();\n        if (currentFont && isRobotoName(currentFont.fontName)) {\n          break;\n        }\n      } catch {\n        // Tekrar dene\n      }\n    }\n    doc.setFontSize(22);\n  } else {\n    doc.setFont(\"helvetica\", \"bold\");\n    doc.setFontSize(22);\n  }\n\n  // Balk geniliini hesapla ve sayfa geniliinde ortala\n  const titleWidth = doc.getTextWidth(title);\n  const titleStartX = (pageWidth - titleWidth) / 2; // Sayfa geniliinin ortas\n\n  safeText(title, titleStartX, titleY, 22, true);\n\n  // Title altnda ince izgi\n  doc.setDrawColor(primaryR, primaryG, primaryB);\n  doc.setGState(doc.GState({ opacity: 0.2 }));\n  doc.setLineWidth(1.5);\n  doc.line(titleStartX, titleY + 7, titleStartX + titleWidth, titleY + 7);\n  doc.setGState(doc.GState({ opacity: 1 }));\n  doc.setTextColor(0, 0, 0);\n\n  // === SA TARAF: Tarih (en st) ve irket Bilgileri (altnda) ===\n  const rightSectionX = pageWidth - mar - 200; // Sadan 200px ieride (tamamas iin)\n  let rightSectionY = 30; // En stten balar (20  30, stte ek boluk)\n\n  // Telefon numaras geniliini hesapla (referans pozisyon iin - nce hesapla)\n  if (doc._robotoFontLoaded && !doc._robotoFontLoadFailed) {\n    doc.setFont(\"Roboto\", \"normal\");\n    doc.setFontSize(8);\n  } else {\n    doc.setFont(\"helvetica\", \"normal\");\n    doc.setFontSize(8);\n  }\n  const phoneText = \"+90 (551) 829-1613\";\n  const phoneTextWidth = doc.getTextWidth(phoneText);\n  const phoneX = pageWidth - mar - phoneTextWidth; // Saa hizal - referans pozisyon\n\n  // \"2025\" metninin geniliini hesapla (saa kaydrma miktar iin)\n  if (doc._robotoFontLoaded && !doc._robotoFontLoadFailed) {\n    doc.setFont(\"Roboto\", \"normal\");\n    doc.setFontSize(9);\n  } else {\n    doc.setFont(\"helvetica\", \"normal\");\n    doc.setFontSize(9);\n  }\n  const year2025Width = doc.getTextWidth(\"2025\");\n  // Tm bilgileri \"2025\" genilii kadar saa kaydr\n  const rightInfoX = phoneX - year2025Width;\n\n  // 1. TARH BLGLER - Telefon numarasyla ayn hizaya alnd, \"2025\" genilii kadar saa kaydrld\n  doc.setTextColor(mutedR, mutedG, mutedB);\n\n  if (startDate && endDate) {\n    // Dnem bilgisi - saa kaydrlm pozisyon\n    safeText(`Dnem: ${formatDateShort(startDate)} - ${formatDateShort(endDate)}`, rightInfoX, rightSectionY, 9, false);\n\n    // Rapor tarihi (altnda, saa kaydrlm pozisyon)\n    rightSectionY += 12; // Bir sonraki satr iin boluk\n    safeText(`Tarih: ${reportDate}`, rightInfoX, rightSectionY, 9, true);\n\n    rightSectionY += 15; // irket bilgileri iin boluk\n  } else {\n    // Sadece rapor tarihi varsa\n    safeText(`Tarih: ${reportDate}`, rightInfoX, rightSectionY, 9, true);\n\n    rightSectionY += 15; // irket bilgileri iin boluk\n  }\n\n  doc.setTextColor(0, 0, 0);\n\n  // 2. RKET BLGLER - Tarih altnda, YETERL BOLUKLA (saa kaydrlm pozisyon)\n  let companyInfoY = rightSectionY; // Tarih bilgilerinden sonra balar\n\n  // Tm bilgiler saa kaydrlm X pozisyonundan hizal\n  doc.setTextColor(mutedR, mutedG, mutedB);\n  // Adres - ilk satr (Milenyum Cad. alt satra alnd)\n  safeText(\"Fevzi Cakmak Mah.\", rightInfoX, companyInfoY, 8, false); // Saa kaydrlm pozisyon\n  companyInfoY += 10; // Satrlar aras boluk\n  safeText(\"Milenyum Cad. No:81\", rightInfoX, companyInfoY, 8, false); // Milenyum Cad. alt satrda\n  companyInfoY += 10; // Satrlar aras boluk\n  safeText(COMPANY_INFO.city, rightInfoX, companyInfoY, 8, false); // Saa kaydrlm pozisyon\n  companyInfoY += 10;\n  // Email - alt satrda (saa kaydrlm pozisyon)\n  safeText(\"info@reviumtech.com\", rightInfoX, companyInfoY, 8, false);\n  companyInfoY += 10;\n  // Website - alt satrda (saa kaydrlm pozisyon)\n  safeText(\"www.reviumtech.com\", rightInfoX, companyInfoY, 8, false);\n  companyInfoY += 10;\n  // Telefon numaras - saa kaydrlm pozisyon (ama telefon numaras kendisi saa hizal kalacak)\n  // Telefon numarasn saa hizal tutmak iin, rightInfoX'ten balayp geniliini hesaplayarak saa hizala\n  if (doc._robotoFontLoaded && !doc._robotoFontLoadFailed) {\n    doc.setFont(\"Roboto\", \"normal\");\n    doc.setFontSize(8);\n  } else {\n    doc.setFont(\"helvetica\", \"normal\");\n    doc.setFontSize(8);\n  }\n  const phoneXAligned = rightInfoX; // Saa kaydrlm pozisyon, ama telefon numaras kendisi saa hizal deil, soldan balyor\n  safeText(phoneText, phoneXAligned, companyInfoY, 8, false);\n  doc.setTextColor(0, 0, 0);\n\n  // Header'n son pozisyonunu hesapla (sol taraftaki logo+REVIUM veya sa taraftaki irket bilgileri, hangisi daha aadaysa)\n  const leftSectionEndY = reviumY + 8; // REVIUM yazs + boluk (daha aada olduu iin)\n  const headerEndY = Math.max(leftSectionEndY, companyInfoY + 8); // Her iki taraftan da en aadaki pozisyon\n\n  // Header alt izgisi - header ieriinden SONRA iz (istatistiklerin stnde olmas iin)\n  doc.setDrawColor(primaryR, primaryG, primaryB);\n  doc.setLineWidth(2);\n  doc.line(mar, headerEndY + 5, pageWidth - mar, headerEndY + 5); // Header ieriinden 5px aada\n\n  // Dekoratif izgi - sabit (daha hafif)\n  doc.setDrawColor(primaryR, primaryG, primaryB);\n  doc.setGState(doc.GState({ opacity: 0.2 }));\n  doc.setLineWidth(1);\n  doc.line(mar, headerEndY + 8, pageWidth - mar, headerEndY + 8); // Ana izgiden 3px aada\n  doc.setGState(doc.GState({ opacity: 1 }));\n\n  // Template'in contentStartY'sini gncelle - header'dan sonra yeterli boluk (altnda ek boluk)\n  return headerEndY + 50; // Header'dan sonra 50px boluk (30  50, altnda ek boluk, ierik aa kaydrld)\n};\n\n// Footer template'i - sabit komponentler + dinamik sayfa numaras\nconst drawPDFFooter = (doc: jsPDFWithFontStatus, template: PDFTemplateLayout, pageNumber?: number, totalPages?: number) => {\n  const mar = PDF_CONSTANTS.margin;\n  const pageWidth = doc.internal.pageSize.getWidth();\n  const footerY = template.footer.startY;\n  const footerLogoSize = PDF_CONSTANTS.footerLogoSize;\n  const [primaryR, primaryG, primaryB] = PDF_CONSTANTS.primaryColor;\n  const [mutedR, mutedG, mutedB] = PDF_CONSTANTS.mutedColor;\n\n  // Footer st izgisi - sabit (daha ince ve profesyonel)\n  doc.setDrawColor(primaryR, primaryG, primaryB);\n  doc.setLineWidth(1.5); // Daha ince: 2  1.5\n  doc.line(mar, footerY - 18, pageWidth - mar, footerY - 18);\n\n  // Dekoratif izgi - sabit (daha hafif)\n  doc.setDrawColor(primaryR, primaryG, primaryB);\n  doc.setGState(doc.GState({ opacity: 0.2 })); // Daha hafif: 0.3  0.2\n  doc.setLineWidth(1);\n  doc.line(mar, footerY - 15, pageWidth - mar, footerY - 15);\n  doc.setGState(doc.GState({ opacity: 1 }));\n\n  const safeText = createSafeText(doc);\n\n  // Footer bilgileri - sol taraf - sabit bilgiler, cache'lenmi\n  doc.setTextColor(mutedR, mutedG, mutedB);\n  safeText(COMPANY_INFO.name, mar, footerY, 10, true);\n  safeText(COMPANY_INFO.fullAddress, mar, footerY + 12, 9, false);\n  safeText(COMPANY_INFO.contactInfo, mar, footerY + 24, 9, false);\n  doc.setTextColor(0, 0, 0);\n\n  // Sayfa numaras kaldrld - kullanc istei\n\n  // Footer logo - sabit komponent\n  const footerLogoX = pageWidth - mar - footerLogoSize - 120;\n  const footerLogoY = footerY - 3;\n\n  // Logo iin arka plan kutusu - sabit\n  try {\n    doc.setFillColor(255, 255, 255);\n    doc.roundedRect(footerLogoX - 3, footerLogoY - 3, footerLogoSize + 6, footerLogoSize + 6, 4, 4, \"F\");\n    doc.setDrawColor(primaryR, primaryG, primaryB);\n    doc.setGState(doc.GState({ opacity: 0.2 }));\n    doc.setLineWidth(1);\n    doc.roundedRect(footerLogoX - 3, footerLogoY - 3, footerLogoSize + 6, footerLogoSize + 6, 4, 4, \"S\");\n    doc.setGState(doc.GState({ opacity: 1 }));\n\n    try {\n      doc.addImage(REV_LOGO_DATA_URI, 'PNG', footerLogoX, footerLogoY, footerLogoSize, footerLogoSize);\n    } catch (error) {\n      // Logo eklenemezse sessizce devam et\n    }\n\n    doc.setTextColor(primaryR, primaryG, primaryB);\n    safeText(\"REVIUM\", footerLogoX + footerLogoSize + 8, footerY + 10, 12, true);\n    doc.setTextColor(0, 0, 0);\n  } catch (logoError) {\n  }\n};\n\n// PDF Template sistemi - tm sayfalar iin sabit layout\nconst applyPDFTemplate = (\n  doc: jsPDFWithFontStatus,\n  title: string,\n  reportDate: string,\n  startDate?: string,\n  endDate?: string\n): PDFTemplateLayout => {\n  // Template layout'u olutur\n  const template = createPDFTemplate(doc);\n\n  // Arka plan iz (sabit)\n  drawPDFBackground(doc, template);\n\n  // Header' iz (sabit + dinamik)\n  const contentStartY = drawPDFHeader(doc, template, title, reportDate, startDate, endDate);\n\n  // Content area'y gncelle (header'dan sonraki gerek balang pozisyonu)\n  template.contentArea.startY = contentStartY;\n\n  return template;\n};\n\n// Yeni sayfa iin template uygula\nconst applyPDFTemplateToNewPage = (doc: jsPDFWithFontStatus, template: PDFTemplateLayout) => {\n  // Yeni sayfa iin template'i yeniden hesapla\n  const newTemplate = createPDFTemplate(doc);\n\n  // Arka plan iz\n  drawPDFBackground(doc, newTemplate);\n\n  // Header' iz (sadece sabit ksmlar, dinamik ierik yok)\n  const mar = PDF_CONSTANTS.margin;\n  const pageWidth = doc.internal.pageSize.getWidth();\n  const logoSize = PDF_CONSTANTS.logoSize;\n  const [primaryR, primaryG, primaryB] = PDF_CONSTANTS.primaryColor;\n  const [mutedR, mutedG, mutedB] = PDF_CONSTANTS.mutedColor;\n\n  // Header alt izgisi\n  doc.setDrawColor(primaryR, primaryG, primaryB);\n  doc.setLineWidth(3);\n  doc.line(mar, newTemplate.header.endY, pageWidth - mar, newTemplate.header.endY);\n\n  // Logo ve irket bilgileri (sadece sabit ksmlar)\n  const rightX = pageWidth - mar - 200;\n  const logoY = 28;\n\n  doc.setFillColor(255, 255, 255);\n  doc.roundedRect(rightX - 5, logoY - 5, logoSize + 10, logoSize + 10, 4, 4, \"F\");\n  doc.setDrawColor(primaryR, primaryG, primaryB);\n  doc.setGState(doc.GState({ opacity: 0.1 })); // Daha hafif: 0.2  0.1\n  doc.setLineWidth(1);\n  doc.roundedRect(rightX - 5, logoY - 5, logoSize + 10, logoSize + 10, 4, 4, \"S\");\n  doc.setGState(doc.GState({ opacity: 1 }));\n\n  try {\n    doc.addImage(REV_LOGO_DATA_URI, 'PNG', rightX, logoY, logoSize, logoSize);\n  } catch (error) {\n    // Logo eklenemezse sessizce devam et\n  }\n\n  const safeText = createSafeText(doc);\n  doc.setTextColor(primaryR, primaryG, primaryB);\n  safeText(\"REVIUM\", rightX + logoSize + 10, 58, 24, true);\n  doc.setTextColor(mutedR, mutedG, mutedB);\n  safeText(COMPANY_INFO.headerAddress, rightX, 75, 10, false);\n  safeText(COMPANY_INFO.city, rightX, 87, 10, false);\n  safeText(COMPANY_INFO.contactInfo, rightX, 99, 10, false);\n  doc.setTextColor(0, 0, 0);\n\n  return newTemplate;\n};\n\ninterface SalesReportData {\n  totalRevenue?: number;\n  totalOrders?: number;\n  activeCustomers?: number;\n  avgOrderValue?: number; // Web sayfasndan gelen hesaplanm deer\n  orders?: Array<{\n    status?: string;\n    total?: number;\n    totalAmount?: number;\n    total_amount?: number;\n    subtotal?: number;\n  }>;\n  topProducts?: Array<{\n    name?: string;\n    quantity?: number;\n    revenue?: number;\n  }>;\n}\n\nexport const generateSalesReportPDF = async (data: SalesReportData, startDate: string, endDate: string) => {\n  const doc = createPdf({ format: \"a4\", unit: \"pt\" });\n\n  // Font'u MUTLAKA ykle - daha agresif yaklam\n  try {\n    await registerFonts(doc);\n  } catch (fontError) {\n    // Font ykleme hatas, tekrar dene\n    try {\n      await registerFonts(doc);\n    } catch (retryError) {\n      // kinci deneme de baarsz, devam et\n    }\n  }\n\n  // Font'un gerekten yklendiini dorula - daha agresif kontrol\n  if (!doc._robotoFontLoaded || doc._robotoFontLoadFailed) {\n    // Font yklenemedi, tekrar dene\n    try {\n      await registerFonts(doc);\n    } catch (retryError) {\n      // Font yklenemedi, devam et\n    }\n  }\n\n  // Font'u zorla Roboto olarak ayarla\n  if (doc._robotoFontLoaded && !doc._robotoFontLoadFailed) {\n    for (let i = 0; i < 10; i++) {\n      try {\n        doc.setFont(\"Roboto\", \"normal\");\n        const currentFont = doc.getFont();\n        if (currentFont && isRobotoName(currentFont.fontName)) {\n          break;\n        }\n      } catch {\n        // Tekrar dene\n      }\n    }\n  }\n\n  applyDocumentTypography(doc);\n\n  const reportDate = formatDate(new Date().toISOString());\n\n  // PDF Template'i uygula - sabit layout + dinamik ierik\n  const template = applyPDFTemplate(doc, \"SATI RAPORU\", reportDate, startDate, endDate);\n\n  // Font'u tekrar kontrol et ve ayarla\n  if (doc._robotoFontLoaded && !doc._robotoFontLoadFailed) {\n    for (let i = 0; i < 5; i++) {\n      try {\n        doc.setFont(\"Roboto\", \"normal\");\n        const currentFont = doc.getFont();\n        if (currentFont && isRobotoName(currentFont.fontName)) {\n          break;\n        }\n      } catch {\n        // Tekrar dene\n      }\n    }\n  }\n\n  // Dinamik ierik alanndan bala (iyiletirilmi spacing)\n  let currentY = template.contentArea.startY + 5; // Header'dan sonra ekstra 5px boluk\n  const contentWidth = template.contentArea.width;\n  const mar = template.contentArea.leftMargin;\n\n  const safeText = createSafeText(doc);\n  const [primaryR, primaryG, primaryB] = PDF_CONSTANTS.primaryColor;\n  const [mutedR, mutedG, mutedB] = PDF_CONSTANTS.mutedColor;\n\n  // statistik Kartlar - Sabit tasarm, dinamik deerler (standardize edilmi)\n  const cardDimensions = calculateCardDimensions(contentWidth, 3);\n  const cardWidth = cardDimensions.width;\n  const cardGap = cardDimensions.gap;\n  const cardHeight = PDF_CONSTANTS.cardHeight;\n  let cardX = mar;\n\n  // Kart 1: Toplam Gelir - Web sayfasndaki gibi (ayn veriler)\n  const totalRevenue = safeNumber(data.totalRevenue);\n  // Web sayfasnda avgOrderValue zaten hesaplanm geliyor, aynsn kullan\n  const avgOrderValue = safeNumber(data.avgOrderValue ?? (data.totalOrders && data.totalOrders > 0 ? totalRevenue / data.totalOrders : 0));\n  drawStatCard(doc, cardX, currentY, cardWidth, cardHeight, {\n    title: \"Toplam Gelir\",\n    value: safeFormatCurrency(totalRevenue),\n    description: `Ortalama: ${safeFormatCurrency(avgOrderValue)}`,\n    color: {\n      background: TAILWIND_COLORS.primaryCardBg,\n      border: TAILWIND_COLORS.primaryCardBorder,\n      text: TAILWIND_COLORS.cardText,\n      value: TAILWIND_COLORS.primaryCardValue,\n    },\n  });\n\n  // Kart 2: Toplam Sipari - profesyonel ve minimal (info)\n  cardX += cardWidth + cardGap;\n  const totalOrders = safeNumber(data.totalOrders);\n  drawStatCard(doc, cardX, currentY, cardWidth, cardHeight, {\n    title: \"Toplam Sipari\",\n    value: totalOrders.toString(),\n    description: \"Tarih aralnda\",\n    color: {\n      background: TAILWIND_COLORS.infoCardBg,\n      border: TAILWIND_COLORS.infoCardBorder,\n      text: TAILWIND_COLORS.cardText,\n      value: TAILWIND_COLORS.infoCardValue,\n    },\n  });\n\n  // Kart 3: Aktif Mteri - profesyonel ve minimal (success)\n  cardX += cardWidth + cardGap;\n  const activeCustomers = safeNumber(data.activeCustomers);\n  drawStatCard(doc, cardX, currentY, cardWidth, cardHeight, {\n    title: \"Aktif Mteri\",\n    value: activeCustomers.toString(),\n    description: \"Sipari veren mteri\",\n    color: {\n      background: TAILWIND_COLORS.successCardBg,\n      border: TAILWIND_COLORS.successCardBorder,\n      text: TAILWIND_COLORS.cardText,\n      value: TAILWIND_COLORS.successCardValue,\n    },\n  });\n\n  currentY += cardHeight + PDF_CONSTANTS.sectionSpacing + 5; // Kartlar ve tablolar aras boluk - iyiletirilmi (ekstra 5px)\n\n  // Sipari Durumu Dalm Tablosu - sabit balk tasarm (iyiletirilmi)\n  if (data.orders && data.orders.length > 0) {\n    // Tablolar aras boluk kontrol\n    currentY = ensureSpace(doc, currentY, 200, mar, \"Sipari Durumu Dalm\");\n    currentY = drawTableHeader(doc, mar, currentY, 300, {\n      title: \"Sipari Durumu Dalm\",\n      backgroundColor: TAILWIND_COLORS.gray50, // Web: bg-[rgb(249,250,251)]\n      textColor: PDF_CONSTANTS.primaryColor, // Web: text-primary\n      borderColor: [229, 231, 235], // Web: border-b (gray200)\n    });\n\n    const statusMap = new Map<string, { count: number; total: number }>();\n    data.orders?.forEach((order) => {\n      const status = order.status || \"Bilinmeyen\";\n      const total = safeNumber(order.total ?? order.totalAmount ?? order.total_amount ?? order.subtotal ?? 0);\n      if (!statusMap.has(status)) {\n        statusMap.set(status, { count: 0, total: 0 });\n      }\n      const stat = statusMap.get(status)!;\n      stat.count += 1;\n      stat.total += total;\n    });\n\n    const statusLabels: Record<string, string> = {\n      draft: \"Taslak\",\n      pending: \"Beklemede\",\n      confirmed: \"Onayland\",\n      planned: \"Planland\",\n      in_production: \"retimde\",\n      in_progress: \"retimde\",\n      quality_check: \"Kalite Kontrol\",\n      on_hold: \"Beklemede\",\n      completed: \"Tamamland\",\n      shipped: \"Kargoda\",\n      delivered: \"Teslim Edildi\",\n      cancelled: \"ptal\",\n    };\n\n    const totalOrders = data.orders.length;\n    const statusTableData = Array.from(statusMap.entries())\n      .sort((a, b) => b[1].count - a[1].count)\n      .map(([status, data]) => [\n        statusLabels[status] || status,\n        data.count.toString(),\n        safeFormatCurrency(data.total),\n        totalOrders > 0 ? `${((data.count / totalOrders) * 100).toFixed(1)}%` : \"0%\"\n      ]);\n\n    // Profesyonel tablo stilleri kullan - Web sayfasndaki gibi\n    const tableStyles = createProfessionalTableStyles(doc, {\n      headerFontSize: 12,\n      bodyFontSize: 11,\n      cellPadding: { top: 12, right: 14, bottom: 12, left: 14 }\n    });\n    // Web sayfasndaki tablo stilleri (zaten createProfessionalTableStyles'da ayarland)\n    tableStyles.bodyStyles.overflow = 'linebreak';\n    tableStyles.styles.overflow = 'linebreak';\n\n    // Sayfa sma kontrol\n    currentY = ensureTableFitsPage(doc, currentY, 200, mar, \"Sipari Durumu Dalm\");\n\n    // Tablo geniliini sayfa geniliine gre ayarla\n    const currentPageWidth = doc.internal.pageSize.getWidth();\n    const tableWidth = currentPageWidth - (mar * 2);\n\n    // Font'u zorla Roboto olarak ayarla (autoTable ncesi)\n    forceRobotoFont(doc, \"normal\");\n\n    autoTable(doc, {\n      startY: currentY,\n      head: transliterateTableData([['Durum', 'Sipari Says', 'Toplam Tutar', 'Oran']]),\n      body: transliterateTableData(statusTableData),\n      margin: { left: mar, right: mar },\n      tableWidth: tableWidth,\n      willDrawCell: createWillDrawCell(doc),\n      ...tableStyles,\n      columnStyles: {\n        0: { cellWidth: tableWidth * 0.35, halign: \"center\", overflow: 'linebreak', fontStyle: \"normal\" }, // Ortalanm\n        1: { cellWidth: tableWidth * 0.20, halign: \"center\", fontStyle: \"bold\" }, // Ortalanm\n        2: { cellWidth: tableWidth * 0.25, halign: \"center\", fontStyle: \"bold\", textColor: PDF_CONSTANTS.primaryColor }, // Ortalanm\n        3: { cellWidth: tableWidth * 0.20, halign: \"center\", fontStyle: \"bold\", textColor: [107, 114, 128] }, // Ortalanm\n      },\n    });\n\n    // Tablo sonras currentY'yi gvenli ekilde gncelle - yeterli boluk\n    const tableEndY = doc.lastAutoTable?.finalY;\n    if (tableEndY && tableEndY > currentY) {\n      currentY = tableEndY + PDF_CONSTANTS.tableSpacing; // Tablo sonras boluk - standardize edilmi\n    } else {\n      currentY += PDF_CONSTANTS.tableSpacing; // Fallback: eer lastAutoTable yoksa\n    }\n  }\n\n  // En ok Satan rnler Tablosu - sabit balk tasarm\n  if (data.topProducts && data.topProducts.length > 0) {\n    // Tablolar aras boluk kontrol\n    currentY = ensureSpace(doc, currentY, 200, mar, \"En ok Satan rnler\");\n    currentY = drawTableHeader(doc, mar, currentY, 300, {\n      title: \"En ok Satan rnler\",\n      backgroundColor: TAILWIND_COLORS.gray50, // Web: bg-[rgb(249,250,251)]\n      textColor: PDF_CONSTANTS.primaryColor, // Web: text-primary\n      borderColor: [229, 231, 235], // Web: border-b (gray200)\n    });\n\n    // Web sayfasndaki gibi - sadece ilk 10 rn, TOPLAM satr yok\n    const topProductsData = data.topProducts?.slice(0, 10).map((p, index: number) => [\n      `#${index + 1}`,\n      p.name || '-',\n      safeNumber(p.quantity).toString(),\n      safeFormatCurrency(safeNumber(p.revenue))\n    ]) || [];\n\n    // Profesyonel tablo stilleri kullan - Web sayfasndaki gibi\n    const tableStyles2 = createProfessionalTableStyles(doc, {\n      headerFontSize: 12,\n      bodyFontSize: 11,\n      cellPadding: { top: 12, right: 14, bottom: 12, left: 14 }\n    });\n    // Web sayfasndaki tablo stilleri (zaten createProfessionalTableStyles'da ayarland)\n    tableStyles2.bodyStyles.overflow = 'linebreak';\n    tableStyles2.styles.overflow = 'linebreak';\n\n    // Sayfa sma kontrol\n    currentY = ensureTableFitsPage(doc, currentY, 200, mar, \"En ok Satan rnler\");\n\n    // Tablo geniliini sayfa geniliine gre ayarla\n    const currentPageWidth2 = doc.internal.pageSize.getWidth();\n    const tableWidth2 = currentPageWidth2 - (mar * 2);\n\n    // Font'u zorla Roboto olarak ayarla (autoTable ncesi)\n    forceRobotoFont(doc, \"normal\");\n\n    autoTable(doc, {\n      startY: currentY,\n      head: transliterateTableData([['Sra', 'rn Ad', 'Adet', 'Gelir']]),\n      body: transliterateTableData(topProductsData),\n      margin: { left: mar, right: mar },\n      tableWidth: tableWidth2,\n      willDrawCell: createWillDrawCell(doc),\n      ...tableStyles2,\n      columnStyles: {\n        0: { cellWidth: tableWidth2 * 0.10, halign: \"center\", fontStyle: \"normal\", textColor: [107, 114, 128] }, // Ortalanm\n        1: { cellWidth: tableWidth2 * 0.50, halign: \"center\", fontStyle: \"normal\", overflow: 'linebreak' }, // Ortalanm\n        2: { cellWidth: tableWidth2 * 0.15, halign: \"center\", fontStyle: \"bold\" }, // Ortalanm\n        3: { cellWidth: tableWidth2 * 0.25, halign: \"center\", fontStyle: \"bold\", textColor: PDF_CONSTANTS.primaryColor }, // Ortalanm\n      },\n    });\n\n    // Tablo sonras currentY'yi gvenli ekilde gncelle\n    const tableEndY2 = doc.lastAutoTable?.finalY;\n    if (tableEndY2 && tableEndY2 > currentY) {\n      currentY = tableEndY2 + PDF_CONSTANTS.tableSpacing;\n    } else {\n      currentY += PDF_CONSTANTS.tableSpacing;\n    }\n  }\n\n  // Web sayfasnda sadece 3 blm var: Kartlar, Sipari Durumu Dalm, En ok Satan rnler\n  // Ekstra blmler (Mteri Bazl Analiz, Zaman Bazl Analiz, zet) kaldrld\n\n  // Sayfa numaralarn ekle - template footer kullan\n  try {\n    const totalPages = doc.internal.pages.length - 1;\n    if (totalPages > 0) {\n      for (let i = 1; i <= totalPages; i++) {\n        try {\n          doc.setPage(i);\n          const pageTemplate = createPDFTemplate(doc);\n          drawPDFFooter(doc, pageTemplate, i, totalPages);\n        } catch (pageError) {\n          // Devam et, dier sayfalar eklemeye al\n        }\n      }\n    }\n  } catch (footerError) {\n    // Footer hatas kritik deil, PDF'i yine de dndr\n  }\n\n  // PDF'i gvenli bir ekilde olutur\n  try {\n    const blob = doc.output('blob');\n    if (!blob || blob.size === 0) {\n      throw new Error(\"PDF blob bo veya geersiz\");\n    }\n    return blob;\n  } catch (outputError) {\n    throw new Error(\"PDF oluturulamad: \" + (outputError instanceof Error ? outputError.message : \"Bilinmeyen hata\"));\n  }\n};\n\ninterface ProductionReportData {\n  totalOrders?: number;\n  completed?: number;\n  completionRate?: number;\n  statusDistribution?: Record<string, number>;\n  topProducts?: Array<{\n    name?: string;\n    quantity?: number;\n    orders?: number;\n  }>;\n}\n\nexport const generateProductionReportPDF = async (data: ProductionReportData, startDate: string, endDate: string) => {\n  const doc = createPdf({ format: \"a4\", unit: \"pt\" });\n\n  // Font'u MUTLAKA ykle - daha agresif yaklam\n  try {\n    await registerFonts(doc);\n  } catch (fontError) {\n    // Font ykleme hatas, tekrar dene\n    try {\n      await registerFonts(doc);\n    } catch (retryError) {\n      // kinci deneme de baarsz, devam et\n    }\n  }\n\n  // Font'un gerekten yklendiini dorula - daha agresif kontrol\n  if (!doc._robotoFontLoaded || doc._robotoFontLoadFailed) {\n    // Font yklenemedi, tekrar dene\n    try {\n      await registerFonts(doc);\n    } catch (retryError) {\n      // Font yklenemedi, devam et\n    }\n  }\n\n  // Font'u zorla Roboto olarak ayarla\n  if (doc._robotoFontLoaded && !doc._robotoFontLoadFailed) {\n    for (let i = 0; i < 10; i++) {\n      try {\n        doc.setFont(\"Roboto\", \"normal\");\n        const currentFont = doc.getFont();\n        if (currentFont && isRobotoName(currentFont.fontName)) {\n          break;\n        }\n      } catch {\n        // Tekrar dene\n      }\n    }\n  }\n\n  applyDocumentTypography(doc);\n\n  const reportDate = formatDate(new Date().toISOString()); // Dinamik\n\n  // PDF Template'i uygula\n  const template = applyPDFTemplate(doc, \"RETM RAPORU\", reportDate, startDate, endDate);\n\n  // Font'u tekrar kontrol et ve ayarla\n  if (doc._robotoFontLoaded && !doc._robotoFontLoadFailed) {\n    for (let i = 0; i < 5; i++) {\n      try {\n        doc.setFont(\"Roboto\", \"normal\");\n        const currentFont = doc.getFont();\n        if (currentFont && isRobotoName(currentFont.fontName)) {\n          break;\n        }\n      } catch {\n        // Tekrar dene\n      }\n    }\n  }\n\n  // Dinamik ierik alanndan bala\n  let currentY = template.contentArea.startY;\n  const contentWidth = template.contentArea.width;\n  const mar = template.contentArea.leftMargin;\n\n  const safeText = createSafeText(doc);\n  const [primaryR, primaryG, primaryB] = PDF_CONSTANTS.primaryColor;\n  const [mutedR, mutedG, mutedB] = PDF_CONSTANTS.mutedColor;\n\n  // statistik Kartlar - Profesyonel tasarm, dinamik deerler\n  const cardWidth = (contentWidth - 32) / 3;\n  const cardHeight = 110; // Daha ferah: 100  110\n  const cardGap = 16;\n  let cardX = mar;\n\n  // Kart 1: Toplam Sipari - profesyonel ve sade\n  const totalOrders = safeNumber(data.totalOrders);\n  drawStatCard(doc, cardX, currentY, cardWidth, cardHeight, {\n    title: \"Toplam Sipari\",\n    value: totalOrders.toString(),\n    description: \"Tarih aralnda\",\n    color: {\n      background: TAILWIND_COLORS.infoCardBg,\n      border: TAILWIND_COLORS.infoCardBorder,\n      text: TAILWIND_COLORS.cardText,\n      value: TAILWIND_COLORS.infoCardValue,\n    },\n  });\n\n  // Kart 2: Tamamlanan - profesyonel ve sade\n  cardX += cardWidth + cardGap;\n  const completed = safeNumber(data.completed);\n  drawStatCard(doc, cardX, currentY, cardWidth, cardHeight, {\n    title: \"Tamamlanan\",\n    value: completed.toString(),\n    description: \"Baaryla tamamland\",\n    color: {\n      background: TAILWIND_COLORS.successCardBg,\n      border: TAILWIND_COLORS.successCardBorder,\n      text: TAILWIND_COLORS.cardText,\n      value: TAILWIND_COLORS.successCardValue,\n    },\n  });\n\n  // Kart 3: Tamamlanma Oran - profesyonel ve sade\n  cardX += cardWidth + cardGap;\n  const completionRate = safeNumber(data.completionRate);\n  drawStatCard(doc, cardX, currentY, cardWidth, cardHeight, {\n    title: \"Tamamlanma Oran\",\n    value: `${completionRate.toFixed(1)}%`,\n    description: \"Baar oran\",\n    color: {\n      background: TAILWIND_COLORS.primaryCardBg,\n      border: TAILWIND_COLORS.primaryCardBorder,\n      text: TAILWIND_COLORS.cardText,\n      value: TAILWIND_COLORS.primaryCardValue,\n    },\n  });\n\n  currentY += cardHeight + PDF_CONSTANTS.sectionSpacing; // Kartlar ve tablolar aras boluk - standardize edilmi\n\n  // Durum Dalm Tablosu - sabit balk tasarm\n  if (data.statusDistribution) {\n    // Tablolar aras boluk kontrol\n    currentY = ensureSpace(doc, currentY, 200, mar, \"Durum Dalm\");\n    currentY = drawTableHeader(doc, mar, currentY, 250, {\n      title: \"Durum Dalm\",\n      backgroundColor: [249, 250, 251],\n      textColor: PDF_CONSTANTS.primaryColor,\n      borderColor: PDF_CONSTANTS.primaryColor,\n    });\n\n    const statusLabels: Record<string, string> = {\n      planned: \"Planland\",\n      in_production: \"retimde\",\n      quality_check: \"Kalite Kontrol\",\n      completed: \"Tamamland\",\n      on_hold: \"Beklemede\"\n    };\n\n    const totalOrders = safeNumber(data.totalOrders);\n    const statusData = Object.entries(data.statusDistribution)\n      .filter(([_, value]) => safeNumber(value as number) > 0)\n      .sort((a, b) => safeNumber(b[1] as number) - safeNumber(a[1] as number))\n      .map(([key, value]) => {\n        const count = safeNumber(value as number);\n        const percentage = totalOrders > 0 ? `${((count / totalOrders) * 100).toFixed(1)}%` : \"0%\";\n        return [\n          statusLabels[key] || key,\n          count.toString(),\n          percentage\n        ];\n      });\n\n    // Profesyonel tablo stilleri kullan\n    const tableStyles = createProfessionalTableStyles(doc, {\n      headerFontSize: 12,\n      bodyFontSize: 11,\n      cellPadding: { top: 12, right: 14, bottom: 12, left: 14 }\n    });\n    // Header rengi zaten createProfessionalTableStyles'da primaryColor olarak ayarland\n    // Burada override etmeye gerek yok, ama tutarllk iin brakyoruz\n    tableStyles.headStyles.fillColor = PDF_CONSTANTS.primaryColor;\n    tableStyles.headStyles.textColor = [255, 255, 255];\n    tableStyles.headStyles.halign = \"center\";\n    tableStyles.bodyStyles.overflow = 'linebreak';\n    tableStyles.styles.overflow = 'linebreak';\n\n    // Sayfa sma kontrol\n    currentY = ensureTableFitsPage(doc, currentY, 200, mar, \"Durum Dalm\");\n\n    // Tablo geniliini sayfa geniliine gre ayarla\n    const currentPageWidth = doc.internal.pageSize.getWidth();\n    const tableWidth = currentPageWidth - (mar * 2);\n\n    // Font'u zorla Roboto olarak ayarla (autoTable ncesi)\n    forceRobotoFont(doc, \"normal\");\n\n    autoTable(doc, {\n      startY: currentY,\n      head: transliterateTableData([['Durum', 'Sipari Says', 'Oran']]),\n      body: transliterateTableData(statusData),\n      margin: { left: mar, right: mar },\n      tableWidth: tableWidth,\n      willDrawCell: createWillDrawCell(doc),\n      ...tableStyles,\n      columnStyles: {\n        0: { cellWidth: tableWidth * 0.50, halign: \"left\", overflow: 'linebreak' }, // %50\n        1: { cellWidth: tableWidth * 0.25, halign: \"right\", fontStyle: \"bold\" }, // %25\n        2: { cellWidth: tableWidth * 0.25, halign: \"right\", fontStyle: \"bold\", textColor: [107, 114, 128] }, // %25\n      },\n    });\n\n    // Tablo sonras currentY'yi gvenli ekilde gncelle - yeterli boluk\n    const tableEndY = doc.lastAutoTable?.finalY;\n    if (tableEndY && tableEndY > currentY) {\n      currentY = tableEndY + PDF_CONSTANTS.tableSpacing; // Tablo sonras boluk - standardize edilmi\n    } else {\n      currentY += PDF_CONSTANTS.tableSpacing; // Fallback: eer lastAutoTable yoksa\n    }\n  }\n\n  // En ok retilen rnler - daha vurgulu balk\n  if (data.topProducts && data.topProducts.length > 0) {\n    // Tablo geniliini sayfa geniliine gre ayarla\n    const pageWidthProd = doc.internal.pageSize.getWidth();\n    const tableWidthProd = pageWidthProd - (mar * 2);\n\n    // Tablolar aras boluk kontrol\n    currentY = ensureSpace(doc, currentY, 200, mar, \"En ok retilen rnler\");\n    currentY = drawTableHeader(doc, mar, currentY, tableWidthProd, {\n      title: \"En ok retilen rnler\",\n      backgroundColor: [249, 250, 251],\n      textColor: PDF_CONSTANTS.primaryColor,\n      borderColor: PDF_CONSTANTS.primaryColor,\n    });\n\n    const topProductsData = data.topProducts?.slice(0, 10).map((p, index: number) => [\n      `#${index + 1}`,\n      p.name || '-',\n      safeNumber(p.quantity).toString(),\n      safeNumber(p.orders).toString()\n    ]);\n\n    // zet satr ekle\n    const totalQuantity = data.topProducts?.slice(0, 10).reduce((sum: number, p) => sum + safeNumber(p.quantity), 0) || 0;\n    const totalOrders = data.topProducts?.slice(0, 10).reduce((sum: number, p) => sum + safeNumber(p.orders), 0) || 0;\n    topProductsData.push([\n      'TOPLAM',\n      '',\n      totalQuantity.toString(),\n      totalOrders.toString()\n    ]);\n\n    // Profesyonel tablo stilleri kullan\n    const tableStyles2 = createProfessionalTableStyles(doc, {\n      headerFontSize: 12,\n      bodyFontSize: 11,\n      cellPadding: { top: 12, right: 14, bottom: 12, left: 14 }\n    });\n    tableStyles2.headStyles.fillColor = [59, 130, 246];\n    tableStyles2.headStyles.textColor = [255, 255, 255];\n    tableStyles2.headStyles.halign = \"center\";\n    tableStyles2.bodyStyles.overflow = 'linebreak';\n    tableStyles2.styles.overflow = 'linebreak';\n\n    // Sayfa sma kontrol\n    currentY = ensureTableFitsPage(doc, currentY, 200, mar, \"En ok retilen rnler\");\n\n    // Tablo geniliini sayfa geniliine gre ayarla\n    const currentPageWidth2 = doc.internal.pageSize.getWidth();\n    const tableWidth2 = currentPageWidth2 - (mar * 2);\n\n    // Font'u zorla Roboto olarak ayarla (autoTable ncesi)\n    forceRobotoFont(doc, \"normal\");\n\n    autoTable(doc, {\n      startY: currentY,\n      head: transliterateTableData([['Sra', 'rn Ad', 'Miktar', 'Sipari Says']]),\n      body: transliterateTableData(topProductsData),\n      margin: { left: mar, right: mar },\n      tableWidth: tableWidth2,\n      willDrawCell: createWillDrawCell(doc),\n      ...tableStyles2,\n      columnStyles: {\n        0: { cellWidth: tableWidth2 * 0.10, halign: \"left\", textColor: [107, 114, 128] }, // %10\n        1: { cellWidth: tableWidth2 * 0.50, halign: \"left\", overflow: 'linebreak' }, // %50\n        2: { cellWidth: tableWidth2 * 0.20, halign: \"right\", fontStyle: \"bold\" }, // %20\n        3: { cellWidth: tableWidth2 * 0.20, halign: \"right\", fontStyle: \"bold\" }, // %20\n      },\n    });\n\n    // Tablo sonras currentY'yi gvenli ekilde gncelle - yeterli boluk\n    const tableEndY = doc.lastAutoTable?.finalY;\n    if (tableEndY && tableEndY > currentY) {\n      currentY = tableEndY + PDF_CONSTANTS.tableSpacing; // Tablo sonras boluk - standardize edilmi\n    } else {\n      currentY += PDF_CONSTANTS.tableSpacing; // Fallback: eer lastAutoTable yoksa\n    }\n  }\n\n  // retim Verimlilii Analizi - Yeni detayl blm\n  if (data.topProducts && data.topProducts.length > 0) {\n    currentY = ensureSpace(doc, currentY, 200, mar, \"retim Verimlilii\");\n\n    const efficiencyData = data.topProducts?.slice(0, 10).map((p, index: number) => {\n      const quantity = safeNumber(p.quantity);\n      const orders = safeNumber(p.orders);\n      const avgPerOrder = orders > 0 ? (quantity / orders).toFixed(1) : \"0\";\n      const productName = (p.name || '-').length > 25 ? (p.name || '-').substring(0, 25) + \"...\" : (p.name || '-');\n      return [\n        `#${index + 1}`,\n        productName,\n        quantity.toString(),\n        orders.toString(),\n        avgPerOrder\n      ];\n    });\n\n    // Tablo geniliini sayfa geniliine gre ayarla\n    const pageWidth3 = doc.internal.pageSize.getWidth();\n    const tableWidth3 = pageWidth3 - (mar * 2);\n\n    // Tablolar aras boluk kontrol\n    currentY = ensureSpace(doc, currentY, 200, mar, \"rn Bazl retim Verimlilii\");\n    currentY = drawTableHeader(doc, mar, currentY, tableWidth3, {\n      title: \"rn Bazl retim Verimlilii\",\n      backgroundColor: [249, 250, 251],\n      textColor: PDF_CONSTANTS.primaryColor,\n      borderColor: PDF_CONSTANTS.primaryColor,\n    });\n\n    // Profesyonel tablo stilleri kullan\n    const tableStyles3 = createProfessionalTableStyles(doc, {\n      headerFontSize: 12,\n      bodyFontSize: 11,\n      cellPadding: { top: 12, right: 14, bottom: 12, left: 14 }\n    });\n    tableStyles3.headStyles.fillColor = [59, 130, 246];\n    tableStyles3.headStyles.textColor = [255, 255, 255];\n    tableStyles3.headStyles.halign = \"center\";\n    tableStyles3.bodyStyles.overflow = 'linebreak';\n    tableStyles3.styles.overflow = 'linebreak';\n\n    // Sayfa sma kontrol\n    currentY = ensureTableFitsPage(doc, currentY, 200, mar, \"rn Bazl retim Verimlilii\");\n\n    // Tablo geniliini sayfa geniliine gre ayarla\n    const currentPageWidth3 = doc.internal.pageSize.getWidth();\n    const currentTableWidth3 = currentPageWidth3 - (mar * 2);\n\n    autoTable(doc, {\n      startY: currentY,\n      head: transliterateTableData([['Sra', 'rn', 'Toplam Miktar', 'Sipari', 'Ortalama/Sipari']]),\n      body: transliterateTableData(efficiencyData),\n      margin: { left: mar, right: mar },\n      tableWidth: currentTableWidth3,\n      willDrawCell: createWillDrawCell(doc),\n      ...tableStyles3,\n      columnStyles: {\n        0: { cellWidth: currentTableWidth3 * 0.08, halign: \"left\", textColor: [107, 114, 128] }, // %8\n        1: { cellWidth: currentTableWidth3 * 0.40, halign: \"left\", overflow: 'linebreak' }, // %40\n        2: { cellWidth: currentTableWidth3 * 0.18, halign: \"right\", fontStyle: \"bold\" }, // %18\n        3: { cellWidth: currentTableWidth3 * 0.15, halign: \"right\", fontStyle: \"bold\" }, // %15\n        4: { cellWidth: currentTableWidth3 * 0.19, halign: \"right\", textColor: [107, 114, 128] }, // %19\n      },\n    });\n\n    // Tablo sonras currentY'yi gvenli ekilde gncelle - yeterli boluk\n    const tableEndY = doc.lastAutoTable?.finalY;\n    if (tableEndY && tableEndY > currentY) {\n      currentY = tableEndY + PDF_CONSTANTS.tableSpacing; // Tablo sonras boluk - standardize edilmi\n    } else {\n      currentY += PDF_CONSTANTS.tableSpacing; // Fallback: eer lastAutoTable yoksa\n    }\n  }\n\n  // zet Blm - sabit tasarm, dinamik veriler\n  currentY = (doc.lastAutoTable?.finalY || currentY) + 50; // Optimize edilmi boluk: 50pt\n  currentY = ensureSpace(doc, currentY, 100, mar, \"zet\");\n\n  const onHold = safeNumber((data as any).onHold || 0);\n  const inProduction = safeNumber((data as any).inProduction || 0);\n  const planned = safeNumber(data.statusDistribution?.planned || 0);\n  const qualityCheck = safeNumber(data.statusDistribution?.quality_check || 0);\n\n  const summaryData: Array<[string, string]> = [\n    ['Toplam Sipari', totalOrders.toString()],\n    ['Tamamlanan', completed.toString()],\n    ['Tamamlanma Oran', `${completionRate.toFixed(1)}%`],\n    ['Beklemede', onHold.toString()],\n    ['retimde', inProduction.toString()],\n    ['Planland', planned.toString()],\n    ['Kalite Kontrol', qualityCheck.toString()],\n    ['En ok retilen rn Says', data.topProducts ? data.topProducts.length.toString() : \"0\"],\n  ];\n\n  currentY = drawSummarySection(doc, mar, currentY, contentWidth, \"Rapor zeti\", summaryData, [37, 99, 235]);\n\n  // Sayfa numaralarn ekle - template footer kullan\n  try {\n    const totalPages = doc.internal.pages.length - 1;\n    if (totalPages > 0) {\n      for (let i = 1; i <= totalPages; i++) {\n        try {\n          doc.setPage(i);\n          const pageTemplate = createPDFTemplate(doc);\n          drawPDFFooter(doc, pageTemplate, i, totalPages);\n        } catch (pageError) {\n          // Devam et, dier sayfalar eklemeye al\n        }\n      }\n    }\n  } catch (footerError) {\n    // Footer hatas kritik deil, PDF'i yine de dndr\n  }\n\n  // PDF'i gvenli bir ekilde olutur\n  try {\n    const blob = doc.output('blob');\n    if (!blob || blob.size === 0) {\n      throw new Error(\"PDF blob bo veya geersiz\");\n    }\n    return blob;\n  } catch (outputError) {\n    throw new Error(\"PDF oluturulamad: \" + (outputError instanceof Error ? outputError.message : \"Bilinmeyen hata\"));\n  }\n};\n\ninterface CustomerReportData {\n  totalCustomers?: number;\n  activeCustomers?: number;\n  newCustomers?: number;\n  topCustomers?: Array<{\n    name?: string;\n    total?: number;\n    orders?: number;\n    lastOrderDate?: string | Date;\n  }>;\n  customerSegments?: {\n    high?: number;\n    medium?: number;\n    low?: number;\n  };\n}\n\nexport const generateCustomerReportPDF = async (data: CustomerReportData, startDate: string, endDate: string) => {\n  const doc = createPdf({ format: \"a4\", unit: \"pt\" });\n\n  // Font'u MUTLAKA ykle - daha agresif yaklam\n  try {\n    await registerFonts(doc);\n  } catch (fontError) {\n    // Font ykleme hatas, tekrar dene\n    try {\n      await registerFonts(doc);\n    } catch (retryError) {\n      // kinci deneme de baarsz, devam et\n    }\n  }\n\n  // Font'un gerekten yklendiini dorula - daha agresif kontrol\n  if (!doc._robotoFontLoaded || doc._robotoFontLoadFailed) {\n    // Font yklenemedi, tekrar dene\n    try {\n      await registerFonts(doc);\n    } catch (retryError) {\n      // Font yklenemedi, devam et\n    }\n  }\n\n  // Font'u zorla Roboto olarak ayarla\n  if (doc._robotoFontLoaded && !doc._robotoFontLoadFailed) {\n    for (let i = 0; i < 10; i++) {\n      try {\n        doc.setFont(\"Roboto\", \"normal\");\n        const currentFont = doc.getFont();\n        if (currentFont && isRobotoName(currentFont.fontName)) {\n          break;\n        }\n      } catch {\n        // Tekrar dene\n      }\n    }\n  }\n\n  applyDocumentTypography(doc);\n\n  const reportDate = formatDate(new Date().toISOString()); // Dinamik\n\n  // PDF Template'i uygula - Trke karakterler iin font kontrol\n  const template = applyPDFTemplate(doc, \"MTER RAPORU\", reportDate, startDate, endDate);\n\n  // Font'u tekrar kontrol et ve ayarla\n  if (doc._robotoFontLoaded && !doc._robotoFontLoadFailed) {\n    for (let i = 0; i < 5; i++) {\n      try {\n        doc.setFont(\"Roboto\", \"normal\");\n        const currentFont = doc.getFont();\n        if (currentFont && isRobotoName(currentFont.fontName)) {\n          break;\n        }\n      } catch {\n        // Tekrar dene\n      }\n    }\n  }\n\n  // Dinamik ierik alanndan bala\n  let currentY = template.contentArea.startY;\n  const contentWidth = template.contentArea.width;\n  const mar = template.contentArea.leftMargin;\n\n  const safeText = createSafeText(doc);\n  const [primaryR, primaryG, primaryB] = PDF_CONSTANTS.primaryColor;\n  const [mutedR, mutedG, mutedB] = PDF_CONSTANTS.mutedColor;\n\n  // statistik Kartlar - Profesyonel tasarm, dinamik deerler\n  const cardWidth = (contentWidth - 32) / 3;\n  const cardHeight = 110; // Daha ferah: 100  110\n  const cardGap = 16;\n  let cardX = mar;\n\n  // Kart 1: Toplam Mteri - profesyonel ve sade\n  const totalCustomers = safeNumber(data.totalCustomers);\n  drawStatCard(doc, cardX, currentY, cardWidth, cardHeight, {\n    title: \"Toplam Mteri\",\n    value: totalCustomers.toString(),\n    description: \"Tm mteriler\",\n    color: {\n      background: TAILWIND_COLORS.cardBackground,\n      border: TAILWIND_COLORS.cardBorder,\n      text: TAILWIND_COLORS.cardText,\n      value: TAILWIND_COLORS.gray700,\n    },\n  });\n\n  // Kart 2: Aktif Mteri - profesyonel ve sade\n  cardX += cardWidth + cardGap;\n  const activeCustomers = safeNumber(data.activeCustomers);\n  drawStatCard(doc, cardX, currentY, cardWidth, cardHeight, {\n    title: \"Aktif Mteri\",\n    value: activeCustomers.toString(),\n    description: \"Sipari veren mteri\",\n    color: {\n      background: TAILWIND_COLORS.successCardBg,\n      border: TAILWIND_COLORS.successCardBorder,\n      text: TAILWIND_COLORS.cardText,\n      value: TAILWIND_COLORS.successCardValue,\n    },\n  });\n\n  // Kart 3: Yeni Mteri - profesyonel ve sade\n  cardX += cardWidth + cardGap;\n  const newCustomers = safeNumber(data.newCustomers);\n  drawStatCard(doc, cardX, currentY, cardWidth, cardHeight, {\n    title: \"Yeni Mteri\",\n    value: newCustomers.toString(),\n    description: \"Tarih aralnda\",\n    color: {\n      background: TAILWIND_COLORS.infoCardBg,\n      border: TAILWIND_COLORS.infoCardBorder,\n      text: TAILWIND_COLORS.cardText,\n      value: TAILWIND_COLORS.infoCardValue,\n    },\n  });\n\n  currentY += cardHeight + PDF_CONSTANTS.sectionSpacing; // Kartlar ve tablolar aras boluk - standardize edilmi\n\n  // Mteri Segmentasyonu Tablosu - sayfadaki sralamayla uyumlu (nce Segmentasyonu, sonra En Deerli Mteriler)\n  if ((data as any).segments) {\n    // Tablo geniliini sayfa geniliine gre ayarla\n    const pageWidthSeg = doc.internal.pageSize.getWidth();\n    const tableWidthSeg = pageWidthSeg - (mar * 2);\n\n    // Tablolar aras boluk kontrol\n    currentY = ensureSpace(doc, currentY, 200, mar, \"Mteri Segmentasyonu\");\n    currentY = drawTableHeader(doc, mar, currentY, tableWidthSeg, {\n      title: \"Mteri Segmentasyonu\",\n      backgroundColor: [249, 250, 251],\n      textColor: PDF_CONSTANTS.primaryColor,\n      borderColor: PDF_CONSTANTS.primaryColor,\n    });\n\n    // Profesyonel tablo stilleri kullan\n    const tableStyles2 = createProfessionalTableStyles(doc, {\n      headerFontSize: 12,\n      bodyFontSize: 11,\n      cellPadding: { top: 12, right: 14, bottom: 12, left: 14 }\n    });\n    tableStyles2.headStyles.fillColor = [59, 130, 246];\n    tableStyles2.headStyles.textColor = [255, 255, 255];\n    tableStyles2.headStyles.halign = \"center\";\n    tableStyles2.bodyStyles.overflow = 'linebreak';\n    tableStyles2.styles.overflow = 'linebreak';\n\n    // Sayfa sma kontrol\n    currentY = ensureTableFitsPage(doc, currentY, 150, mar, \"Mteri Segmentasyonu\");\n\n    // Tablo geniliini sayfa geniliine gre ayarla\n    const currentPageWidthSeg = doc.internal.pageSize.getWidth();\n    const currentTableWidthSeg = currentPageWidthSeg - (mar * 2);\n\n    // Font'u zorla Roboto olarak ayarla (autoTable ncesi)\n    forceRobotoFont(doc, \"normal\");\n\n    autoTable(doc, {\n      startY: currentY,\n      head: transliterateTableData([['Segment', 'Mteri Says']]),\n      body: transliterateTableData([\n        ['Yksek Deerli (>50K)', safeNumber((data as any).segments.high).toString()],\n        ['Orta Deerli (10K-50K)', safeNumber((data as any).segments.medium).toString()],\n        ['Dk Deerli (<10K)', safeNumber((data as any).segments.low).toString()],\n      ]),\n      margin: { left: mar, right: mar },\n      tableWidth: currentTableWidthSeg,\n      willDrawCell: createWillDrawCell(doc),\n      ...tableStyles2,\n      columnStyles: {\n        0: { cellWidth: currentTableWidthSeg * 0.70, halign: \"left\", overflow: 'linebreak' }, // %70\n        1: { cellWidth: currentTableWidthSeg * 0.30, halign: \"right\", fontStyle: \"bold\" }, // %30\n      },\n    });\n\n    // Tablo sonras currentY'yi gvenli ekilde gncelle\n    const tableEndY2 = doc.lastAutoTable?.finalY;\n    if (tableEndY2 && tableEndY2 > currentY) {\n      currentY = tableEndY2 + 50; // Optimize edilmi boluk: 50pt\n    } else {\n      currentY += PDF_CONSTANTS.tableSpacing; // Fallback: eer lastAutoTable yoksa\n    }\n  }\n\n  // En Deerli Mteriler Tablosu - sayfadaki sralamayla uyumlu (Mteri Segmentasyonu'ndan sonra)\n  if (data.topCustomers && data.topCustomers.length > 0) {\n    // Tablo geniliini sayfa geniliine gre ayarla\n    const pageWidth = doc.internal.pageSize.getWidth();\n    const tableWidth = pageWidth - (mar * 2);\n\n    // Tablolar aras boluk kontrol\n    currentY = ensureSpace(doc, currentY, 200, mar, \"En Deerli Mteriler\");\n    currentY = drawTableHeader(doc, mar, currentY, tableWidth, {\n      title: \"En Deerli Mteriler\",\n      backgroundColor: TAILWIND_COLORS.gray100,\n      textColor: PDF_CONSTANTS.primaryColor,\n      borderColor: PDF_CONSTANTS.primaryColor,\n    });\n\n    // Profesyonel tablo stilleri kullan\n    const tableStyles = createProfessionalTableStyles(doc, {\n      headerFontSize: 12,\n      bodyFontSize: 11,\n      cellPadding: { top: 12, right: 14, bottom: 12, left: 14 }\n    });\n    // Header rengi zaten createProfessionalTableStyles'da ayarland\n    // Override etmeye gerek yok\n    tableStyles.headStyles.halign = \"center\";\n    tableStyles.bodyStyles.overflow = 'linebreak';\n    tableStyles.styles.overflow = 'linebreak';\n\n    // Sayfa sma kontrol\n    currentY = ensureTableFitsPage(doc, currentY, 200, mar, \"En Deerli Mteriler\");\n\n    // Tablo geniliini sayfa geniliine gre ayarla\n    const currentPageWidth = doc.internal.pageSize.getWidth();\n    const currentTableWidth = currentPageWidth - (mar * 2);\n\n    // Font'u zorla Roboto olarak ayarla (autoTable ncesi)\n    forceRobotoFont(doc, \"normal\");\n\n    autoTable(doc, {\n      startY: currentY,\n      head: transliterateTableData([['Sra', 'Mteri', 'Sipari Says', 'Toplam Harcama']]),\n      body: transliterateTableData(\n        data.topCustomers?.slice(0, 10).map((c, index: number) => [\n          `#${index + 1}`,\n          c.name || '-',\n          safeNumber(c.orders).toString(),\n          safeFormatCurrency(safeNumber(c.total))\n        ]) || []\n      ),\n      margin: { left: mar, right: mar },\n      tableWidth: currentTableWidth,\n      willDrawCell: createWillDrawCell(doc),\n      ...tableStyles,\n      columnStyles: {\n        0: { cellWidth: currentTableWidth * 0.10, halign: \"left\", textColor: TAILWIND_COLORS.gray500 }, // %10\n        1: { cellWidth: currentTableWidth * 0.40, halign: \"left\", overflow: 'linebreak' }, // %40\n        2: { cellWidth: currentTableWidth * 0.20, halign: \"right\", fontStyle: \"bold\" }, // %20\n        3: { cellWidth: currentTableWidth * 0.30, halign: \"right\", fontStyle: \"bold\", textColor: PDF_CONSTANTS.primaryColor }, // %30\n      },\n    });\n\n    // Tablo sonras currentY'yi gvenli ekilde gncelle\n    const tableEndY = doc.lastAutoTable?.finalY;\n    if (tableEndY && tableEndY > currentY) {\n      currentY = tableEndY + 50; // Optimize edilmi boluk: 50pt\n    } else {\n      currentY += PDF_CONSTANTS.tableSpacing; // Fallback: eer lastAutoTable yoksa\n    }\n  }\n\n  // Mteri Detay Analizi - Yeni detayl blm\n  if (data.topCustomers && data.topCustomers.length > 0) {\n    // Tablo sonras currentY'yi gvenli ekilde gncelle - minimum 30pt boluk\n    const tableEndY2 = doc.lastAutoTable?.finalY;\n    if (tableEndY2 && tableEndY2 > currentY) {\n      currentY = tableEndY2 + 60; // Tablo sonras boluk artrld: 30  60\n    } else {\n      currentY += PDF_CONSTANTS.tableSpacing; // Fallback: eer lastAutoTable yoksa\n    }\n    currentY = ensureSpace(doc, currentY, 200, mar, \"Mteri Detay Analizi\");\n\n    // Mteri bazl sipari frekans ve deer analizi\n    const customerDetailData = data.topCustomers?.slice(0, 15).map((c, index: number) => {\n      const orders = safeNumber(c.orders);\n      const total = safeNumber(c.total);\n      const avgOrderValue = orders > 0 ? (total / orders) : 0;\n      const customerName = (c.name || '-').length > 30 ? (c.name || '-').substring(0, 30) + \"...\" : (c.name || '-');\n\n      return [\n        `#${index + 1}`,\n        customerName,\n        orders.toString(),\n        safeFormatCurrency(total),\n        safeFormatCurrency(avgOrderValue),\n        total >= 50000 ? \"Yksek\" : total >= 10000 ? \"Orta\" : \"Dk\"\n      ];\n    });\n\n    // Tablo geniliini sayfa geniliine gre ayarla\n    const pageWidth5 = doc.internal.pageSize.getWidth();\n    const tableWidth5 = pageWidth5 - (mar * 2);\n\n    // Tablolar aras boluk kontrol\n    currentY = ensureSpace(doc, currentY, 300, mar, \"Mteri Detay Analizi\");\n    currentY = drawTableHeader(doc, mar, currentY, tableWidth5, {\n      title: \"Mteri Detay Analizi (Top 15)\",\n      backgroundColor: [249, 250, 251],\n      textColor: PDF_CONSTANTS.primaryColor,\n      borderColor: PDF_CONSTANTS.primaryColor,\n    });\n\n    // Profesyonel tablo stilleri kullan\n    const tableStyles3 = createProfessionalTableStyles(doc, {\n      headerFontSize: 12,\n      bodyFontSize: 11,\n      cellPadding: { top: 12, right: 14, bottom: 12, left: 14 }\n    });\n    tableStyles3.headStyles.fillColor = [59, 130, 246];\n    tableStyles3.headStyles.textColor = [255, 255, 255];\n    tableStyles3.headStyles.halign = \"center\";\n    tableStyles3.bodyStyles.overflow = 'linebreak';\n    tableStyles3.styles.overflow = 'linebreak';\n\n    // Sayfa sma kontrol\n    currentY = ensureTableFitsPage(doc, currentY, 200, mar, \"Mteri Detay Analizi\");\n\n    autoTable(doc, {\n      startY: currentY,\n      head: transliterateTableData([['Sra', 'Mteri', 'Sipari', 'Toplam', 'Ortalama', 'Segment']]),\n      body: transliterateTableData(customerDetailData),\n      margin: { left: mar, right: mar },\n      tableWidth: tableWidth5,\n      willDrawCell: createWillDrawCell(doc),\n      ...tableStyles3,\n      columnStyles: {\n        0: { cellWidth: tableWidth5 * 0.07, halign: \"left\", textColor: [107, 114, 128] }, // %7\n        1: { cellWidth: tableWidth5 * 0.30, halign: \"left\", overflow: 'linebreak' }, // %30\n        2: { cellWidth: tableWidth5 * 0.12, halign: \"right\", fontStyle: \"bold\" }, // %12\n        3: { cellWidth: tableWidth5 * 0.20, halign: \"right\", fontStyle: \"bold\", textColor: PDF_CONSTANTS.primaryColor }, // %20\n        4: { cellWidth: tableWidth5 * 0.18, halign: \"right\", textColor: [107, 114, 128] }, // %18\n        5: { cellWidth: tableWidth5 * 0.13, halign: \"center\", fontStyle: \"bold\" }, // %13\n      },\n      alternateRowStyles: {\n        fillColor: [249, 250, 251]\n      },\n      didDrawCell: (data: CellHookData) => {\n        // Segment renklendirme\n        if (data.column?.index === 5 && data.cell?.text) {\n          const segment = data.cell.text.toString();\n          const x = data.cell?.x ?? data.x ?? 0;\n          const y = data.cell?.y ?? data.y ?? 0;\n          const width = data.cell?.width ?? data.width ?? 0;\n          const height = data.cell?.height ?? data.height ?? 0;\n          if (segment === \"Yksek\") {\n            doc.setFillColor(240, 253, 244);\n            doc.rect(x, y, width, height, \"F\");\n            doc.setTextColor(22, 163, 74);\n          } else if (segment === \"Orta\") {\n            doc.setFillColor(254, 249, 195);\n            doc.rect(x, y, width, height, \"F\");\n            doc.setTextColor(217, 119, 6);\n          } else {\n            doc.setFillColor(254, 242, 242);\n            doc.rect(x, y, width, height, \"F\");\n            doc.setTextColor(220, 38, 38);\n          }\n        }\n      },\n    });\n\n    // Tablo sonras currentY'yi gvenli ekilde gncelle - minimum 30pt boluk\n    const tableEndY3 = doc.lastAutoTable?.finalY;\n    if (tableEndY3 && tableEndY3 > currentY) {\n      currentY = tableEndY3 + 30; // Standart boluk: 30pt\n    } else {\n      currentY += 30; // Fallback: eer lastAutoTable yoksa\n    }\n  }\n\n  // Mteri Trend Analizi - Yeni blm\n  if (data.newCustomers !== undefined) {\n    currentY = ensureSpace(doc, currentY, 150, mar, \"Mteri Trend Analizi\");\n\n    const retentionRate = safeNumber(data.totalCustomers) > 0\n      ? ((safeNumber(data.totalCustomers) - safeNumber(data.newCustomers)) / safeNumber(data.totalCustomers) * 100).toFixed(1)\n      : \"0\";\n    const activeRate = safeNumber(data.totalCustomers) > 0\n      ? (safeNumber(data.activeCustomers) / safeNumber(data.totalCustomers) * 100).toFixed(1)\n      : \"0\";\n\n    const trendData: Array<[string, string]> = [\n      ['Yeni Mteri Oran', `${(safeNumber(data.newCustomers) / Math.max(safeNumber(data.totalCustomers), 1) * 100).toFixed(1)}%`],\n      ['Mteri Tutma Oran', `${retentionRate}%`],\n      ['Aktif Mteri Oran', `${activeRate}%`],\n      ['Segment Dalm (Yksek)', `${safeNumber((data as any).segments?.high || 0)} mteri`],\n      ['Segment Dalm (Orta)', `${safeNumber((data as any).segments?.medium || 0)} mteri`],\n      ['Segment Dalm (Dk)', `${safeNumber((data as any).segments?.low || 0)} mteri`],\n    ];\n\n    currentY = drawSummarySection(doc, mar, currentY, contentWidth, \"Mteri Trend Analizi\", trendData, [147, 51, 234]);\n  }\n\n  // zet Blm - sabit tasarm, dinamik veriler\n  currentY = (doc.lastAutoTable?.finalY || currentY) + 50; // Optimize edilmi boluk: 50pt\n  currentY = ensureSpace(doc, currentY, 100, mar, \"zet\");\n\n  const summaryData: Array<[string, string]> = [\n    ['Toplam Mteri', safeNumber(data.totalCustomers).toString()],\n    ['Aktif Mteri', safeNumber(data.activeCustomers).toString()],\n    ['Yeni Mteri', safeNumber(data.newCustomers).toString()],\n    ['Yksek Deerli Mteri', safeNumber((data as any).segments?.high || 0).toString()],\n    ['Orta Deerli Mteri', safeNumber((data as any).segments?.medium || 0).toString()],\n    ['Dk Deerli Mteri', safeNumber((data as any).segments?.low || 0).toString()],\n    ['En Deerli Mteri Says', data.topCustomers ? data.topCustomers.length.toString() : \"0\"],\n  ];\n\n  currentY = drawSummarySection(doc, mar, currentY, contentWidth, \"Rapor zeti\", summaryData, [147, 51, 234]);\n\n  // Sayfa numaralarn ekle - template footer kullan\n  try {\n    const totalPages = doc.internal.pages.length - 1;\n    if (totalPages > 0) {\n      for (let i = 1; i <= totalPages; i++) {\n        try {\n          doc.setPage(i);\n          const pageTemplate = createPDFTemplate(doc);\n          drawPDFFooter(doc, pageTemplate, i, totalPages);\n        } catch (pageError) {\n          // Devam et, dier sayfalar eklemeye al\n        }\n      }\n    }\n  } catch (footerError) {\n    // Footer hatas kritik deil, PDF'i yine de dndr\n  }\n\n  // PDF'i gvenli bir ekilde olutur\n  try {\n    const blob = doc.output('blob');\n    if (!blob || blob.size === 0) {\n      throw new Error(\"PDF blob bo veya geersiz\");\n    }\n    return blob;\n  } catch (outputError) {\n    throw new Error(\"PDF oluturulamad: \" + (outputError instanceof Error ? outputError.message : \"Bilinmeyen hata\"));\n  }\n};\n\ninterface FinancialReportData {\n  totalRevenue?: number;\n  totalCost?: number;\n  grossProfit?: number;\n  profitMargin?: number;\n  monthlyTrend?: Array<{\n    month?: string;\n    revenue?: number;\n    cost?: number;\n    profit?: number;\n  }>;\n  topProfitableProducts?: Array<{\n    name?: string;\n    revenue?: number;\n    cost?: number;\n    profit?: number;\n  }>;\n  segments?: {\n    high?: number;\n    medium?: number;\n    low?: number;\n  };\n  topCustomers?: Array<{\n    name?: string;\n    total?: number;\n  }>;\n}\n\nexport const generateFinancialReportPDF = async (data: FinancialReportData, startDate: string, endDate: string) => {\n  const doc = createPdf({ format: \"a4\", unit: \"pt\" });\n\n  // Font'u MUTLAKA ykle - daha agresif yaklam\n  try {\n    await registerFonts(doc);\n  } catch (fontError) {\n    // Font ykleme hatas, tekrar dene\n    try {\n      await registerFonts(doc);\n    } catch (retryError) {\n      // kinci deneme de baarsz, devam et\n    }\n  }\n\n  // Font'un gerekten yklendiini dorula - daha agresif kontrol\n  if (!doc._robotoFontLoaded || doc._robotoFontLoadFailed) {\n    // Font yklenemedi, tekrar dene\n    try {\n      await registerFonts(doc);\n    } catch (retryError) {\n      // Font yklenemedi, devam et\n    }\n  }\n\n  // Font'u zorla Roboto olarak ayarla\n  if (doc._robotoFontLoaded && !doc._robotoFontLoadFailed) {\n    for (let i = 0; i < 10; i++) {\n      try {\n        doc.setFont(\"Roboto\", \"normal\");\n        const currentFont = doc.getFont();\n        if (currentFont && isRobotoName(currentFont.fontName)) {\n          break;\n        }\n      } catch {\n        // Tekrar dene\n      }\n    }\n  }\n\n  applyDocumentTypography(doc);\n\n  const reportDate = formatDate(new Date().toISOString()); // Dinamik\n\n  // PDF Template'i uygula - Trke karakterler iin font kontrol\n  const template = applyPDFTemplate(doc, \"MAL RAPOR\", reportDate, startDate, endDate);\n\n  // Font'u tekrar kontrol et ve ayarla\n  if (doc._robotoFontLoaded && !doc._robotoFontLoadFailed) {\n    for (let i = 0; i < 5; i++) {\n      try {\n        doc.setFont(\"Roboto\", \"normal\");\n        const currentFont = doc.getFont();\n        if (currentFont && isRobotoName(currentFont.fontName)) {\n          break;\n        }\n      } catch {\n        // Tekrar dene\n      }\n    }\n  }\n\n  // Dinamik ierik alanndan bala\n  let currentY = template.contentArea.startY;\n  const contentWidth = template.contentArea.width;\n  const mar = template.contentArea.leftMargin;\n\n  const safeText = createSafeText(doc);\n  const [primaryR, primaryG, primaryB] = PDF_CONSTANTS.primaryColor;\n  const [mutedR, mutedG, mutedB] = PDF_CONSTANTS.mutedColor;\n\n  // statistik Kartlar - Profesyonel tasarm (4 kart) - standardize edilmi\n  const cardDimensions = calculateCardDimensions(contentWidth, 4);\n  const cardWidth = cardDimensions.width;\n  const cardGap = cardDimensions.gap;\n  const cardHeight = PDF_CONSTANTS.cardHeight;\n  let cardX = mar;\n\n  // Kart 1: Toplam Gelir (Green) - profesyonel ve sade\n  const totalRevenue = safeNumber(data.totalRevenue);\n  drawStatCard(doc, cardX, currentY, cardWidth, cardHeight, {\n    title: \"Toplam Gelir\",\n    value: safeFormatCurrency(totalRevenue),\n    description: \"Toplam ciro\",\n    color: {\n      background: TAILWIND_COLORS.successCardBg,\n      border: TAILWIND_COLORS.successCardBorder,\n      text: TAILWIND_COLORS.cardText,\n      value: TAILWIND_COLORS.successCardValue,\n    },\n  });\n\n  // Kart 2: Toplam Gider (Red) - profesyonel ve sade\n  cardX += cardWidth + cardGap;\n  const totalCost = safeNumber(data.totalCost);\n  drawStatCard(doc, cardX, currentY, cardWidth, cardHeight, {\n    title: \"Toplam Gider\",\n    value: safeFormatCurrency(totalCost),\n    description: \"Toplam maliyet\",\n    color: {\n      background: TAILWIND_COLORS.errorCardBg,\n      border: TAILWIND_COLORS.errorCardBorder,\n      text: TAILWIND_COLORS.cardText,\n      value: TAILWIND_COLORS.errorCardValue,\n    },\n  });\n\n  // Kart 3: Brt Kar (Emerald) - profesyonel ve sade\n  cardX += cardWidth + cardGap;\n  const grossProfit = safeNumber(data.grossProfit);\n  drawStatCard(doc, cardX, currentY, cardWidth, cardHeight, {\n    title: \"Brt Kar\",\n    value: safeFormatCurrency(grossProfit),\n    description: \"Net kar\",\n    color: {\n      background: TAILWIND_COLORS.successCardBg,\n      border: TAILWIND_COLORS.successCardBorder,\n      text: TAILWIND_COLORS.cardText,\n      value: TAILWIND_COLORS.successCardValue,\n    },\n  });\n\n  // Kart 4: Kar Marj (Primary) - profesyonel ve sade\n  cardX += cardWidth + cardGap;\n  const profitMargin = safeNumber(data.profitMargin);\n  drawStatCard(doc, cardX, currentY, cardWidth, cardHeight, {\n    title: \"Kar Marj\",\n    value: `${profitMargin.toFixed(1)}%`,\n    description: \"Karllk oran\",\n    color: {\n      background: TAILWIND_COLORS.primaryCardBg,\n      border: TAILWIND_COLORS.primaryCardBorder,\n      text: TAILWIND_COLORS.cardText,\n      value: TAILWIND_COLORS.primaryCardValue,\n    },\n  });\n\n  currentY += cardHeight + PDF_CONSTANTS.sectionSpacing; // Kartlar ve tablolar aras boluk - standardize edilmi\n\n  // Aylk Trend Tablosu - sayfadaki sralamayla uyumlu (nce Aylk Trend, sonra En Karl rnler)\n  if (data.monthlyTrend && data.monthlyTrend.length > 0) {\n    // Tablo geniliini sayfa geniliine gre ayarla\n    const pageWidthTrend = doc.internal.pageSize.getWidth();\n    const tableWidthTrend = pageWidthTrend - (mar * 2);\n\n    // Tablolar aras boluk kontrol\n    currentY = ensureSpace(doc, currentY, 200, mar, \"Aylk Trend\");\n    currentY = drawTableHeader(doc, mar, currentY, tableWidthTrend, {\n      title: \"Aylk Gelir-Gider-Kar Trendi\",\n      backgroundColor: TAILWIND_COLORS.gray100,\n      textColor: PDF_CONSTANTS.primaryColor,\n      borderColor: PDF_CONSTANTS.primaryColor,\n    });\n\n    const monthLabels: Record<string, string> = {\n      '01': 'Ocak', '02': 'ubat', '03': 'Mart', '04': 'Nisan',\n      '05': 'Mays', '06': 'Haziran', '07': 'Temmuz', '08': 'Austos',\n      '09': 'Eyll', '10': 'Ekim', '11': 'Kasm', '12': 'Aralk'\n    };\n\n    const trendData = data.monthlyTrend?.map((item) => {\n      const [year, month] = item.month.split('-');\n      const monthLabel = monthLabels[month] || month;\n      return [\n        `${monthLabel} ${year}`,\n        safeFormatCurrency(safeNumber(item.revenue || 0)),\n        safeFormatCurrency(safeNumber(item.cost || 0)),\n        safeFormatCurrency(safeNumber(item.profit || 0))\n      ];\n    });\n\n    // Profesyonel tablo stilleri kullan (zel header rengi ile)\n    const tableStyles2 = createProfessionalTableStyles(doc, {\n      headerFontSize: 12,\n      bodyFontSize: 11,\n      cellPadding: { top: 12, right: 14, bottom: 12, left: 14 }\n    });\n    tableStyles2.headStyles.fillColor = PDF_CONSTANTS.primaryColor; // Primary color\n    tableStyles2.headStyles.textColor = [255, 255, 255]; // White text\n    tableStyles2.headStyles.halign = \"center\";\n    tableStyles2.bodyStyles.overflow = 'linebreak';\n    tableStyles2.styles.overflow = 'linebreak';\n\n    // Sayfa sma kontrol\n    currentY = ensureTableFitsPage(doc, currentY, 200, mar, \"Aylk Gelir-Gider-Kar Trendi\");\n\n    // Tablo geniliini sayfa geniliine gre ayarla\n    const currentPageWidth2 = doc.internal.pageSize.getWidth();\n    const currentTableWidth2 = currentPageWidth2 - (mar * 2);\n\n    // Font'u zorla Roboto olarak ayarla (autoTable ncesi)\n    forceRobotoFont(doc, \"normal\");\n\n    autoTable(doc, {\n      startY: currentY,\n      head: transliterateTableData([['Ay', 'Gelir', 'Gider', 'Kar']]),\n      body: transliterateTableData(trendData),\n      margin: { left: mar, right: mar },\n      tableWidth: currentTableWidth2,\n      willDrawCell: createWillDrawCell(doc),\n      ...tableStyles2,\n      columnStyles: {\n        0: { cellWidth: currentTableWidth2 * 0.25, halign: \"left\" },  // %25\n        1: { cellWidth: currentTableWidth2 * 0.25, halign: \"right\" }, // %25\n        2: { cellWidth: currentTableWidth2 * 0.25, halign: \"right\" }, // %25\n        3: { cellWidth: currentTableWidth2 * 0.25, halign: \"right\" }, // %25\n      },\n    });\n\n    // Tablo sonras currentY'yi gvenli ekilde gncelle\n    const trendTableEndY = doc.lastAutoTable?.finalY;\n    if (trendTableEndY && trendTableEndY > currentY) {\n      currentY = trendTableEndY + 50; // Optimize edilmi boluk: 50pt\n    } else {\n      currentY += PDF_CONSTANTS.tableSpacing; // Fallback: eer lastAutoTable yoksa\n    }\n  }\n\n  // En Karl rnler Tablosu - sayfadaki sralamayla uyumlu (Aylk Trend'den sonra)\n  if (data.topProfitableProducts && data.topProfitableProducts.length > 0) {\n    // Tablo geniliini sayfa geniliine gre ayarla\n    const pageWidth = doc.internal.pageSize.getWidth();\n    const tableWidth = pageWidth - (mar * 2);\n\n    // Tablolar aras boluk kontrol\n    currentY = ensureSpace(doc, currentY, 200, mar, \"En Karl rnler\");\n    currentY = drawTableHeader(doc, mar, currentY, tableWidth, {\n      title: \"En Karl rnler\",\n      backgroundColor: TAILWIND_COLORS.gray100,\n      textColor: PDF_CONSTANTS.primaryColor,\n      borderColor: PDF_CONSTANTS.primaryColor,\n    });\n\n    // Profesyonel tablo stilleri kullan\n    const tableStyles = createProfessionalTableStyles(doc, {\n      headerFontSize: 12,\n      bodyFontSize: 11,\n      cellPadding: { top: 12, right: 14, bottom: 12, left: 14 }\n    });\n    // Header rengi zaten createProfessionalTableStyles'da ayarland\n    // Override etmeye gerek yok\n    tableStyles.headStyles.halign = \"center\";\n    tableStyles.bodyStyles.overflow = 'linebreak';\n    tableStyles.styles.overflow = 'linebreak';\n\n    // Sayfa sma kontrol\n    currentY = ensureTableFitsPage(doc, currentY, 200, mar, \"En Karl rnler\");\n\n    // Tablo geniliini sayfa geniliine gre ayarla\n    const currentPageWidth = doc.internal.pageSize.getWidth();\n    const currentTableWidth = currentPageWidth - (mar * 2);\n\n    // Font'u zorla Roboto olarak ayarla (autoTable ncesi)\n    forceRobotoFont(doc, \"normal\");\n\n    autoTable(doc, {\n      startY: currentY,\n      head: transliterateTableData([['Sra', 'rn', 'Gelir', 'Gider', 'Kar']]),\n      body: transliterateTableData(\n        data.topProfitableProducts?.slice(0, 10).map((p, index: number) => [\n          `#${index + 1}`,\n          p.name || '-',\n          safeFormatCurrency(safeNumber(p.revenue)),\n          safeFormatCurrency(safeNumber(p.cost)),\n          safeFormatCurrency(safeNumber(p.profit))\n        ]) || []\n      ),\n      margin: { left: mar, right: mar },\n      tableWidth: currentTableWidth,\n      willDrawCell: createWillDrawCell(doc),\n      ...tableStyles,\n      columnStyles: {\n        0: { cellWidth: currentTableWidth * 0.08, halign: \"left\", textColor: TAILWIND_COLORS.gray500 }, // %8\n        1: { cellWidth: currentTableWidth * 0.40, halign: \"left\", overflow: 'linebreak' }, // %40\n        2: { cellWidth: currentTableWidth * 0.17, halign: \"right\", fontStyle: \"bold\", textColor: PDF_CONSTANTS.successColor }, // %17\n        3: { cellWidth: currentTableWidth * 0.17, halign: \"right\", fontStyle: \"bold\", textColor: PDF_CONSTANTS.errorColor }, // %17\n        4: { cellWidth: currentTableWidth * 0.18, halign: \"right\", fontStyle: \"bold\", textColor: PDF_CONSTANTS.successColor }, // %18\n      },\n    });\n\n    // Tablo sonras currentY'yi gvenli ekilde gncelle\n    const productsTableEndY = doc.lastAutoTable?.finalY;\n    if (productsTableEndY && productsTableEndY > currentY) {\n      currentY = productsTableEndY + 50; // Optimize edilmi boluk: 50pt\n    } else {\n      currentY += PDF_CONSTANTS.tableSpacing; // Fallback: eer lastAutoTable yoksa\n    }\n  }\n\n  // Gider Kalemleri Analizi - Yeni detayl blm\n  if ((data as any).costBreakdown || (data as any).expenseCategories) {\n    // Tablo sonras currentY'yi gvenli ekilde gncelle - yeterli boluk\n    const tableEndY = doc.lastAutoTable?.finalY;\n    if (tableEndY && tableEndY > currentY) {\n      currentY = tableEndY + PDF_CONSTANTS.tableSpacing; // Tablo sonras boluk - standardize edilmi\n    } else {\n      currentY += PDF_CONSTANTS.tableSpacing; // Fallback: eer lastAutoTable yoksa\n    }\n    currentY = ensureSpace(doc, currentY, 200, mar, \"Gider Kalemleri Analizi\");\n\n    const costData = (data as any).costBreakdown || (data as any).expenseCategories || [];\n    if (costData.length > 0) {\n      // En Karl rnler tablosu gibi sra numaras ile\n      const costTableData = costData.map((item: { category?: string; name?: string; amount?: number; total?: number; percentage?: number }, index: number) => {\n        const category = item.category || item.name || \"Bilinmeyen\";\n        const amount = safeNumber(item.amount || item.total || 0);\n        const percentage = item.percentage !== undefined\n          ? item.percentage.toFixed(1)\n          : (safeNumber(data.totalCost) > 0\n            ? ((amount / safeNumber(data.totalCost)) * 100).toFixed(1)\n            : \"0\");\n        return [\n          `#${index + 1}`,\n          category.length > 30 ? category.substring(0, 30) + \"...\" : category,\n          safeFormatCurrency(amount),\n          `${percentage}%`\n        ];\n      });\n\n      // Tablo geniliini sayfa geniliine gre ayarla\n      const pageWidth3 = doc.internal.pageSize.getWidth();\n      const tableWidth3 = pageWidth3 - (mar * 2);\n\n      // Tablolar aras boluk kontrol\n      currentY = ensureSpace(doc, currentY, 200, mar, \"Gider Kalemleri Analizi\");\n      currentY = drawTableHeader(doc, mar, currentY, tableWidth3, {\n        title: \"Gider Kalemleri Analizi\",\n        backgroundColor: TAILWIND_COLORS.gray100,\n        textColor: PDF_CONSTANTS.primaryColor,\n        borderColor: PDF_CONSTANTS.primaryColor,\n      });\n\n      // Profesyonel tablo stilleri kullan\n      const tableStyles3 = createProfessionalTableStyles(doc, {\n        headerFontSize: 12,\n        bodyFontSize: 11,\n        cellPadding: { top: 12, right: 14, bottom: 12, left: 14 }\n      });\n      tableStyles3.headStyles.fillColor = [59, 130, 246];\n      tableStyles3.headStyles.textColor = [255, 255, 255];\n      tableStyles3.headStyles.halign = \"center\";\n      tableStyles3.bodyStyles.overflow = 'linebreak';\n      tableStyles3.styles.overflow = 'linebreak';\n\n      // Sayfa sma kontrol\n      currentY = ensureTableFitsPage(doc, currentY, 200, mar, \"Gider Kalemleri Analizi\");\n\n      // Tablo geniliini sayfa geniliine gre ayarla\n      const currentPageWidth3 = doc.internal.pageSize.getWidth();\n      const currentTableWidth3 = currentPageWidth3 - (mar * 2);\n\n      // Font'u zorla Roboto olarak ayarla (autoTable ncesi)\n      forceRobotoFont(doc, \"normal\");\n\n      autoTable(doc, {\n        startY: currentY,\n        head: transliterateTableData([['Sra', 'Gider Kalemi', 'Tutar', 'Oran']]),\n        body: transliterateTableData(costTableData),\n        margin: { left: mar, right: mar },\n        tableWidth: currentTableWidth3,\n        willDrawCell: createWillDrawCell(doc),\n        ...tableStyles3,\n        columnStyles: {\n          0: { cellWidth: currentTableWidth3 * 0.08, halign: \"left\", textColor: TAILWIND_COLORS.gray500 }, // %8 - Sra\n          1: { cellWidth: currentTableWidth3 * 0.40, halign: \"left\", overflow: 'linebreak' }, // %40 - Gider Kalemi\n          2: { cellWidth: currentTableWidth3 * 0.30, halign: \"right\", fontStyle: \"bold\", textColor: PDF_CONSTANTS.errorColor }, // %30 - Tutar\n          3: { cellWidth: currentTableWidth3 * 0.22, halign: \"right\", textColor: TAILWIND_COLORS.gray500 }, // %22 - Oran\n        },\n      });\n\n      // Tablo sonras currentY'yi gvenli ekilde gncelle - yeterli boluk\n      const tableEndY = doc.lastAutoTable?.finalY;\n      if (tableEndY && tableEndY > currentY) {\n        currentY = tableEndY + PDF_CONSTANTS.tableSpacing; // Tablo sonras boluk - standardize edilmi\n      } else {\n        currentY += PDF_CONSTANTS.tableSpacing; // Fallback: eer lastAutoTable yoksa\n      }\n    }\n  }\n\n  // Kar Analizi Detay - Yeni blm\n  currentY = ensureSpace(doc, currentY, 150, mar, \"Kar Analizi Detay\");\n\n  const profitMarginValue = safeNumber(data.profitMargin);\n  const revenue = safeNumber(data.totalRevenue);\n  const cost = safeNumber(data.totalCost);\n  const profit = safeNumber(data.grossProfit);\n  const avgMonthlyRevenue = data.monthlyTrend && data.monthlyTrend.length > 0\n    ? safeNumber(data.totalRevenue) / data.monthlyTrend.length\n    : 0;\n  const avgMonthlyCost = data.monthlyTrend && data.monthlyTrend.length > 0\n    ? safeNumber(data.totalCost) / data.monthlyTrend.length\n    : 0;\n  const avgMonthlyProfit = avgMonthlyRevenue - avgMonthlyCost;\n  const profitGrowth = data.monthlyTrend && data.monthlyTrend.length >= 2\n    ? ((data.monthlyTrend[data.monthlyTrend.length - 1].profit || 0) - (data.monthlyTrend[0].profit || 0))\n    : 0;\n\n  const profitAnalysisData: Array<[string, string]> = [\n    ['Toplam Gelir', safeFormatCurrency(revenue)],\n    ['Toplam Gider', safeFormatCurrency(cost)],\n    ['Brt Kar', safeFormatCurrency(profit)],\n    ['Kar Marj', `${profitMarginValue.toFixed(1)}%`],\n    ['Ortalama Aylk Gelir', safeFormatCurrency(avgMonthlyRevenue)],\n    ['Ortalama Aylk Gider', safeFormatCurrency(avgMonthlyCost)],\n    ['Ortalama Aylk Kar', safeFormatCurrency(avgMonthlyProfit)],\n    ['Kar Bymesi', profitGrowth > 0 ? `+${safeFormatCurrency(profitGrowth)}` : safeFormatCurrency(profitGrowth)],\n  ];\n\n  currentY = drawSummarySection(doc, mar, currentY, contentWidth, \"Kar Analizi Detay\", profitAnalysisData, [5, 150, 105]);\n\n  // zet Blm - sabit tasarm, dinamik veriler\n  currentY = (doc.lastAutoTable?.finalY || currentY) + 50; // Optimize edilmi boluk: 50pt\n  currentY = ensureSpace(doc, currentY, 100, mar, \"zet\");\n\n  const summaryData: Array<[string, string]> = [\n    ['Toplam Gelir', safeFormatCurrency(safeNumber(data.totalRevenue))],\n    ['Toplam Gider', safeFormatCurrency(safeNumber(data.totalCost))],\n    ['Brt Kar', safeFormatCurrency(safeNumber(data.grossProfit))],\n    ['Kar Marj', `${safeNumber(data.profitMargin).toFixed(1)}%`],\n    ['Ortalama Aylk Gelir', data.monthlyTrend && data.monthlyTrend.length > 0\n      ? safeFormatCurrency(safeNumber(data.totalRevenue) / data.monthlyTrend.length)\n      : safeFormatCurrency(0)],\n    ['Aylk Trend Verisi', data.monthlyTrend ? `${data.monthlyTrend.length} ay` : \"0 ay\"],\n    ['En Karl rn Says', data.topProfitableProducts ? data.topProfitableProducts.length.toString() : \"0\"],\n  ];\n\n  currentY = drawSummarySection(doc, mar, currentY, contentWidth, \"Rapor zeti\", summaryData, [5, 150, 105]);\n\n  // Sayfa numaralarn ekle - template footer kullan\n  try {\n    const totalPages = doc.internal.pages.length - 1;\n    if (totalPages > 0) {\n      for (let i = 1; i <= totalPages; i++) {\n        try {\n          doc.setPage(i);\n          const pageTemplate = createPDFTemplate(doc);\n          drawPDFFooter(doc, pageTemplate, i, totalPages);\n        } catch (pageError) {\n          // Devam et, dier sayfalar eklemeye al\n        }\n      }\n    }\n  } catch (footerError) {\n    // Footer hatas kritik deil, PDF'i yine de dndr\n  }\n\n  // PDF'i gvenli bir ekilde olutur\n  try {\n    const blob = doc.output('blob');\n    if (!blob || blob.size === 0) {\n      throw new Error(\"PDF blob bo veya geersiz\");\n    }\n    return blob;\n  } catch (outputError) {\n    throw new Error(\"PDF oluturulamad: \" + (outputError instanceof Error ? outputError.message : \"Bilinmeyen hata\"));\n  }\n};\n\ninterface SalesOfferPayload {\n  quoteNumber: string;\n  quoteDate: string;\n  validUntil: string;\n  customerName: string;\n  customerCompany: string;\n  customerAddress?: string;\n  customerPhone?: string;\n  customerEmail?: string;\n  projectName: string;\n  deliveryTerms: string;\n  paymentTerms: string;\n  notes: string;\n  currency: string;\n  taxRate: number;\n  discountRate: number;\n  items: Array<{ description: string; quantity: number; unitPrice: number; discount?: number }>;\n  totals: {\n    subtotal: number;\n    discount: number;\n    tax: number;\n    grandTotal: number;\n  };\n  terms?: string[];\n}\n\n/**\n * Kullanc istatistikleri PDF'i olutur\n */\ninterface UserStatsReportData {\n  userName: string;\n  userEmail: string;\n  total: number;\n  accepted: number;\n  rejected: number;\n  pending: number;\n  completed: number;\n  active: number;\n  assignments: Array<{\n    taskTitle: string;\n    status: string;\n    assignedAt: Date | string;\n    completedAt?: Date | string | null;\n  }>;\n}\n\nexport const generateUserStatsPDF = async (userStats: UserStatsReportData): Promise<Blob> => {\n  const doc = createPdf({ format: \"a4\", unit: \"pt\" });\n  await registerFonts(doc);\n\n  // Font'un gerekten yklendiini dorula\n  if (doc._robotoFontLoaded && !doc._robotoFontLoadFailed) {\n    const currentFont = doc.getFont();\n    if (!currentFont || !isRobotoName(currentFont.fontName)) {\n      await registerFonts(doc);\n    }\n  }\n\n  const reportDate = formatDate(new Date().toISOString());\n\n  // PDF Template'i uygula\n  const template = applyPDFTemplate(doc, \"Kullanc Performans Raporu\", reportDate);\n  let yPos = template.contentArea.startY;\n  const mar = template.contentArea.leftMargin;\n  const pageWidth = doc.internal.pageSize.getWidth();\n  const pageHeight = doc.internal.pageSize.getHeight();\n\n  const safeTextUser = createSafeText(doc);\n  const safeSetFontUser = (bold: boolean = false) => {\n    safeSetFont(doc, bold ? \"bold\" : \"normal\");\n  };\n\n  // Kullanc bilgileri kart\n  const cardHeight = 110; // Daha ferah: 100  110\n  const cardY = yPos;\n  doc.setFillColor(TAILWIND_COLORS.gray50[0], TAILWIND_COLORS.gray50[1], TAILWIND_COLORS.gray50[2]);\n  doc.setDrawColor(TAILWIND_COLORS.gray200[0], TAILWIND_COLORS.gray200[1], TAILWIND_COLORS.gray200[2]);\n  doc.setLineWidth(1.5);\n  doc.roundedRect(mar, cardY, pageWidth - 2 * mar, cardHeight, 6, 6, \"F\");\n  doc.roundedRect(mar, cardY, pageWidth - 2 * mar, cardHeight, 6, 6, \"S\");\n\n  safeSetFontUser(true);\n  doc.setTextColor(31, 41, 55);\n  safeTextUser(\"Kullanc Bilgileri\", mar + 15, cardY + 20, 16);\n\n  safeSetFontUser(false);\n  doc.setTextColor(75, 85, 99);\n  safeTextUser(`Kullanc Ad: ${userStats.userName}`, mar + 15, cardY + 45, 12);\n  safeTextUser(`E-posta: ${userStats.userEmail}`, mar + 15, cardY + 65, 12);\n  safeTextUser(`Rapor Tarihi: ${new Date().toLocaleDateString(\"tr-TR\", { day: \"2-digit\", month: \"long\", year: \"numeric\" })}`, mar + 15, cardY + 85, 12);\n\n  yPos = cardY + cardHeight + 30;\n\n  // statistik kartlar (3 stun)\n  safeSetFontUser(true);\n  doc.setTextColor(31, 41, 55);\n  safeTextUser(\"Performans zeti\", mar, yPos, 18);\n  yPos += 30;\n\n  const cardWidth = (pageWidth - 2 * mar - 20) / 3;\n  const statCards = [\n    { label: \"Toplam Grev\", value: userStats.total, color: [59, 130, 246], icon: \"\" },\n    { label: \"Tamamlanan\", value: userStats.completed, color: [34, 197, 94], icon: \"\" },\n    { label: \"Aktif\", value: userStats.active, color: [251, 191, 36], icon: \"\" },\n  ];\n\n  statCards.forEach((stat, index) => {\n    const cardX = mar + index * (cardWidth + 10);\n    const statCardHeight = 90;\n\n    // Gradient efekti simlasyonu\n    doc.setFillColor(stat.color[0], stat.color[1], stat.color[2], 0.1);\n    doc.setDrawColor(stat.color[0], stat.color[1], stat.color[2], 0.3);\n    doc.setLineWidth(1.5);\n    doc.roundedRect(cardX, yPos, cardWidth, statCardHeight, 6, 6, \"F\");\n    doc.roundedRect(cardX, yPos, cardWidth, statCardHeight, 6, 6, \"S\");\n\n    // kon ve deer\n    safeSetFontUser(true);\n    doc.setTextColor(stat.color[0], stat.color[1], stat.color[2]);\n    safeTextUser(stat.value.toString(), cardX + 15, yPos + 25, 28);\n\n    safeSetFontUser(false);\n    doc.setTextColor(75, 85, 99);\n    safeTextUser(stat.label, cardX + 15, yPos + 55, 11);\n  });\n\n  yPos += 110;\n\n  // Detayl istatistikler tablosu\n  if (yPos > pageHeight - 200) {\n    doc.addPage();\n    yPos = mar;\n  }\n\n  safeSetFontUser(true);\n  doc.setTextColor(31, 41, 55);\n  safeTextUser(\"Detayl statistikler\", mar, yPos, 18);\n  yPos += 25;\n\n  const detailedStats = [\n    [\"Metrik\", \"Deer\", \"Oran\"],\n    [\"Toplam Grev\", userStats.total.toString(), \"%100\"],\n    [\"Tamamlanan\", userStats.completed.toString(), userStats.total > 0 ? `%${Math.round((userStats.completed / userStats.total) * 100)}` : \"%0\"],\n    [\"Kabul Edilen\", userStats.accepted.toString(), userStats.total > 0 ? `%${Math.round((userStats.accepted / userStats.total) * 100)}` : \"%0\"],\n    [\"Beklemede\", userStats.pending.toString(), userStats.total > 0 ? `%${Math.round((userStats.pending / userStats.total) * 100)}` : \"%0\"],\n    [\"Reddedilen\", userStats.rejected.toString(), userStats.total > 0 ? `%${Math.round((userStats.rejected / userStats.total) * 100)}` : \"%0\"],\n    [\"Aktif Grevler\", userStats.active.toString(), userStats.total > 0 ? `%${Math.round((userStats.active / userStats.total) * 100)}` : \"%0\"],\n  ];\n\n  // Detayl istatistikler iin profesyonel tablo stilleri\n  const detailedTableStyles = createProfessionalTableStyles(doc, {\n    headerFontSize: 12,\n    bodyFontSize: 11,\n    cellPadding: { top: 12, right: 14, bottom: 12, left: 14 }\n  });\n  detailedTableStyles.headStyles.fillColor = [59, 130, 246];\n  detailedTableStyles.headStyles.textColor = [255, 255, 255];\n  detailedTableStyles.headStyles.halign = \"center\";\n  detailedTableStyles.bodyStyles.halign = \"center\";\n  detailedTableStyles.bodyStyles.textColor = [31, 41, 55];\n\n  const currentPageWidth = doc.internal.pageSize.getWidth();\n  const detailedTableWidth = currentPageWidth - (mar * 2);\n\n  autoTable(doc, {\n    startY: yPos,\n    head: [detailedStats[0]],\n    body: detailedStats.slice(1),\n    willDrawCell: createWillDrawCell(doc),\n    margin: { left: mar, right: mar },\n    tableWidth: detailedTableWidth,\n    ...detailedTableStyles,\n    columnStyles: {\n      0: { cellWidth: detailedTableWidth * 0.50, halign: \"left\" }, // %50 - metrik ad iin\n      1: { cellWidth: detailedTableWidth * 0.25, halign: \"center\" }, // %25 - deer iin\n      2: { cellWidth: detailedTableWidth * 0.25, halign: \"center\" }, // %25 - oran iin\n    },\n  });\n\n  yPos = (doc.lastAutoTable?.finalY || yPos) + 30;\n\n  // Grev listesi\n  if (userStats.assignments.length > 0) {\n    if (yPos > pageHeight - 150) {\n      doc.addPage();\n      yPos = mar;\n    }\n\n    safeSetFontUser(true);\n    doc.setTextColor(31, 41, 55);\n    safeTextUser(\"Grev Detaylar\", mar, yPos, 18);\n    yPos += 25;\n\n    const statusLabels: Record<string, string> = {\n      \"pending\": \"Beklemede\",\n      \"accepted\": \"Kabul Edildi\",\n      \"rejected\": \"Reddedildi\",\n      \"completed\": \"Tamamland\",\n      \"in_progress\": \"Devam Ediyor\",\n    };\n\n    const assignmentRows = userStats.assignments.map((assignment) => {\n      const assignedDate = assignment.assignedAt instanceof Date\n        ? assignment.assignedAt\n        : new Date(assignment.assignedAt);\n      const completedDate = assignment.completedAt\n        ? (assignment.completedAt instanceof Date\n          ? assignment.completedAt\n          : new Date(assignment.completedAt))\n        : null;\n\n      return [\n        assignment.taskTitle,\n        statusLabels[assignment.status] || assignment.status,\n        assignedDate.toLocaleDateString(\"tr-TR\", { day: \"2-digit\", month: \"2-digit\", year: \"numeric\" }),\n        completedDate\n          ? completedDate.toLocaleDateString(\"tr-TR\", { day: \"2-digit\", month: \"2-digit\", year: \"numeric\" })\n          : \"-\",\n      ];\n    });\n\n    // Profesyonel tablo stilleri kullan (zel header rengi ile)\n    const tableStyles = createProfessionalTableStyles(doc, {\n      headerFontSize: 12,\n      bodyFontSize: 11,\n      cellPadding: { top: 12, right: 14, bottom: 12, left: 14 }\n    });\n    // Header rengi zaten createProfessionalTableStyles'da primaryColor olarak ayarland\n    // Burada override etmeye gerek yok, ama tutarllk iin brakyoruz\n    tableStyles.headStyles.fillColor = PDF_CONSTANTS.primaryColor; // Blue\n    tableStyles.headStyles.textColor = [255, 255, 255]; // White\n    tableStyles.headStyles.halign = \"center\";\n    tableStyles.bodyStyles.halign = \"left\";\n    tableStyles.bodyStyles.overflow = 'linebreak';\n    tableStyles.styles.overflow = 'linebreak';\n\n    // Sayfa sma kontrol\n    yPos = ensureTableFitsPage(doc, yPos, 200, mar, \"Grev Detaylar\");\n\n    // Tablo geniliini sayfa geniliine gre ayarla\n    const currentPageWidth = doc.internal.pageSize.getWidth();\n    const tableWidth = currentPageWidth - (mar * 2);\n\n    autoTable(doc, {\n      startY: yPos,\n      head: [[\"Grev Bal\", \"Durum\", \"Atanma Tarihi\", \"Tamamlanma Tarihi\"]],\n      body: assignmentRows,\n      margin: { left: mar, right: mar },\n      tableWidth: tableWidth,\n      willDrawCell: createWillDrawCell(doc),\n      ...tableStyles,\n      columnStyles: {\n        0: { cellWidth: tableWidth * 0.40, halign: \"left\", overflow: 'linebreak' }, // %40 - grev bal iin daha fazla alan\n        1: { cellWidth: tableWidth * 0.20, halign: \"center\" }, // %20\n        2: { cellWidth: tableWidth * 0.20, halign: \"center\" }, // %20\n        3: { cellWidth: tableWidth * 0.20, halign: \"center\" }, // %20\n      },\n    });\n  }\n\n  // zet blm\n  const finalY = doc.lastAutoTable?.finalY || yPos;\n  if (finalY < pageHeight - 120) {\n    yPos = finalY + 30;\n\n    // zet metnini hazrla\n    const completionRate = userStats.total > 0 ? Math.round((userStats.completed / userStats.total) * 100) : 0;\n    const summaryText = `${userStats.userName} kullancs toplam ${userStats.total} grev alm, ${userStats.completed} grevi tamamlamtr. Tamamlanma oran: %${completionRate}`;\n\n    // Metni satrlara bl (maksimum genilik kontrol)\n    const currentPageWidth = doc.internal.pageSize.getWidth();\n    const maxWidth = currentPageWidth - 2 * mar - 30; // 30pt padding\n    const lines = doc.splitTextToSize(summaryText, maxWidth);\n    const lineHeight = 14;\n    const summaryHeight = Math.max(70, 20 + (lines.length * lineHeight) + 10); // Minimum 70pt, dinamik ykseklik\n\n    // Sayfa smazsa yeni sayfa ekle\n    if (yPos + summaryHeight > pageHeight - 100) {\n      doc.addPage();\n      const template = createPDFTemplate(doc);\n      drawPDFBackground(doc, template);\n      yPos = mar + 30;\n    }\n\n    safeSetFontUser(true);\n    doc.setTextColor(255, 255, 255);\n    doc.setFillColor(59, 130, 246);\n    doc.setDrawColor(59, 130, 246);\n    doc.setLineWidth(1.5);\n    const summaryPageWidth = doc.internal.pageSize.getWidth();\n    doc.roundedRect(mar, yPos, summaryPageWidth - 2 * mar, summaryHeight, 6, 6, \"F\");\n    doc.roundedRect(mar, yPos, summaryPageWidth - 2 * mar, summaryHeight, 6, 6, \"S\");\n\n    safeTextUser(\"zet\", mar + 15, yPos + 20, 16);\n\n    safeSetFontUser(false);\n    doc.setTextColor(255, 255, 255);\n    // Metni satr satr yaz\n    lines.forEach((line: string, index: number) => {\n      safeTextUser(line, mar + 15, yPos + 40 + (index * lineHeight), 11);\n    });\n  }\n\n  // Footer' ekle\n  try {\n    const finalTemplate = createPDFTemplate(doc);\n    drawPDFFooter(doc, finalTemplate);\n  } catch (footerError) {\n    // Footer hatas kritik deil, PDF'i yine de dndr\n  }\n\n  // PDF'i gvenli bir ekilde olutur\n  try {\n    const blob = doc.output(\"blob\");\n    if (!blob || blob.size === 0) {\n      throw new Error(\"PDF blob bo veya geersiz\");\n    }\n    return blob;\n  } catch (outputError) {\n    throw new Error(\"PDF oluturulamad: \" + (outputError instanceof Error ? outputError.message : \"Bilinmeyen hata\"));\n  }\n};\n\n/**\n * PDF Generation Summary:\n * - Library: jsPDF + jspdf-autotable (programmatic PDF generation, NOT html2canvas or react-pdf)\n * - File: src/services/pdfGenerator.ts -> generateSalesOfferPDF()\n * - A4 Dimensions: 595pt (width) x 842pt (height) in portrait\n * - Margins: 40pt on all sides\n * - Content Width: 515pt (595 - 80)\n * \n * Layout Constraints:\n * - Header: Top 20% of page (max 170pt)\n * - Table: Central area with percentage-based column widths\n * - Notes/Totals: Bottom area, split 50/50\n * - Footer: Fixed 60pt at bottom\n * \n * Column Widths (percentage-based to fit A4):\n * - No: 8% (~41pt)\n * - rn Ad: 48% (~247pt)\n * - Adet: 10% (~52pt)\n * - Birim Fiyat: 17% (~88pt)\n * - Toplam: 17% (~88pt)\n */\nexport const generateSalesOfferPDF = async (payload: SalesOfferPayload) => {\n  const doc = createPdf({ format: \"a4\", unit: \"pt\" });\n  await registerFonts(doc);\n\n  // Font'un gerekten yklendiini dorula\n  if (doc._robotoFontLoaded && !doc._robotoFontLoadFailed) {\n    const currentFont = doc.getFont();\n    if (!currentFont || !isRobotoName(currentFont.fontName)) {\n      await registerFonts(doc);\n    }\n  }\n\n  applyDocumentTypography(doc);\n\n  // A4 dimensions and margins - FIXED VALUES\n  const mar = 40; // Margin on all sides\n  const pageWidth = 595; // A4 width in pt\n  const pageHeight = 842; // A4 height in pt\n  const contentWidth = pageWidth - (mar * 2); // 515pt usable width\n\n  // Verify actual page size matches expected A4\n  const actualWidth = doc.internal.pageSize.getWidth();\n  const actualHeight = doc.internal.pageSize.getHeight();\n  if (Math.abs(actualWidth - pageWidth) > 1 || Math.abs(actualHeight - pageHeight) > 1) {\n  }\n\n  // Header - Form Preview Style\n  // Logo ve irket Bilgileri (Sa st)\n  const logoWidth = 40;\n  const logoHeight = 40;\n  const logoX = pageWidth - mar - 160; // Logo ve text iin alan ayr\n\n  // Helper functions\n  const safeNumber = (value: unknown): number => {\n    const num = Number(value);\n    return (isNaN(num) || !isFinite(num)) ? 0 : num;\n  };\n\n  const safeFormatCurrency = (value: number, currency: string): string => {\n    const safeVal = safeNumber(value);\n    // Trke locale kullan (web UI ile uyumlu)\n    return `${currency}${safeVal.toLocaleString(\"tr-TR\", { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;\n  };\n\n  // Create safeText helper with color support - createSafeText kullan\n  const baseSafeText = createSafeText(doc);\n  const safeText = (text: string, x: number, y: number, fontSize: number, isBold: boolean = false, color?: [number, number, number]) => {\n    try {\n      // Renk ayarla\n      if (color) {\n        doc.setTextColor(color[0], color[1], color[2]);\n      }\n\n      // createSafeText kullan (Trke karakter destei ile)\n      baseSafeText(text, x, y, fontSize, isBold);\n\n      // Renk sfrla\n      if (color) {\n        doc.setTextColor(0, 0, 0);\n      }\n    } catch (error) {\n      // Hata durumunda fallback\n      try {\n        doc.setFont(\"helvetica\", isBold ? \"bold\" : \"normal\");\n        doc.setFontSize(fontSize);\n        // Problemli karakterleri transliterate et\n        const hasProblematicChars = /[]/.test(text);\n        const safeTextFallback = hasProblematicChars ? transliterateTurkish(text) : text;\n        if (color) {\n          doc.setTextColor(color[0], color[1], color[2]);\n        }\n        doc.text(safeTextFallback, x, y);\n        doc.setTextColor(0, 0, 0);\n      } catch (fallbackError) {\n      }\n    }\n  };\n\n  // Background: Light grey diagonal/triangular panel on the left side\n  try {\n    doc.setFillColor(243, 244, 246); // gray-100 - light grey\n    doc.setGState(doc.GState({ opacity: 0.3 }));\n\n    // Diagonal triangular shape on the left\n    // Create a polygon-like shape using multiple rectangles\n    const bgStartX = 0;\n    const bgStartY = 0;\n    const bgWidth = 200; // Width of the grey panel\n    const bgHeight = pageHeight;\n\n    // Draw diagonal shape\n    doc.rect(bgStartX, bgStartY, bgWidth, bgHeight, \"F\");\n\n    // Reset opacity\n    doc.setGState(doc.GState({ opacity: 1 }));\n  } catch (error) {\n  }\n\n  // Header Y position - Optimized for A4 (top 20% of page = ~170pt max)\n  const headerY = 45; // Reduced from 50\n\n  // Left Side: Title - Two lines: \"SATI TEKLF\" and \"FORMU\"\n  // Reduced font size slightly for better fit\n  safeText(\"SATI TEKLF\", mar, headerY, 30, true); // Reduced from 32\n  safeText(\"FORMU\", mar, headerY + 36, 30, true); // Reduced from 32, adjusted spacing\n\n  // Customer Info Block - Left side, aligned with title\n  const customerBlockY = headerY + 90; // Reduced from 100 for tighter spacing\n  safeText(\"Mteri\", mar, customerBlockY, 14, true);\n\n  const customerName = payload.customerName || \"\";\n  const customerCompany = payload.customerCompany || \"\";\n  const customerAddress = payload.customerAddress || \"\";\n  const customerPhone = payload.customerPhone || \"\";\n  const customerEmail = payload.customerEmail || \"\";\n\n  let customerY = customerBlockY + 24;\n\n  // Customer name/company (prioritize customerName over customerCompany)\n  const customerText = customerName || customerCompany || \"\";\n  if (customerText) {\n    safeSetFont(doc, \"normal\");\n    doc.setFontSize(14);\n    const customerLines = doc.splitTextToSize(customerText, 280);\n    customerLines.forEach((line: string) => {\n      doc.setTextColor(31, 41, 55); // gray-800\n      safeText(line, mar, customerY, 14, false);\n      doc.setTextColor(0, 0, 0);\n      customerY += 18;\n    });\n  }\n\n  // Additional customer details (address, phone, email) - each on a new line\n  const customerDetails: string[] = [];\n  if (customerAddress) customerDetails.push(customerAddress);\n  if (customerPhone) customerDetails.push(customerPhone);\n  if (customerEmail) customerDetails.push(customerEmail);\n\n  customerDetails.forEach((detail) => {\n    doc.setTextColor(107, 114, 128); // gray-500\n    safeSetFont(doc, \"normal\");\n    doc.setFontSize(11);\n    const detailLines = doc.splitTextToSize(detail, 280);\n    detailLines.forEach((line: string) => {\n      safeText(line, mar, customerY, 11, false);\n      customerY += 14;\n    });\n    doc.setTextColor(0, 0, 0);\n  });\n\n  // Right Side: Logo & Company Info - Top right\n  const rightContentX = pageWidth - mar;\n  const companyInfoY = headerY;\n  const headerLogoSize = 40; // 50  40 (daha kk logo)\n\n  // Logo - sa st kede, doru pozisyonda\n  try {\n    const logoX = rightContentX - headerLogoSize;\n    doc.addImage(REV_LOGO_DATA_URI, 'PNG', logoX, companyInfoY, headerLogoSize, headerLogoSize);\n  } catch (error) {\n  }\n\n  // Company address block - under logo, right-aligned (daha kompakt)\n  const addressLines = [\n    COMPANY_INFO.address,\n    COMPANY_INFO.city,\n    COMPANY_INFO.email,\n    COMPANY_INFO.website,\n    COMPANY_INFO.phone\n  ];\n\n  let addrY = companyInfoY + headerLogoSize + 10; // 14  10 (daha az boluk)\n  safeSetFont(doc, \"normal\");\n  doc.setFontSize(9); // 10  9 (daha kk font)\n  addressLines.forEach(line => {\n    try {\n      const lineWidth = doc.getTextWidth(line);\n      doc.setTextColor(75, 85, 99); // gray-600\n      safeText(line, rightContentX - lineWidth, addrY, 9, false);\n      doc.setTextColor(0, 0, 0);\n      addrY += 11; // 13  11 (daha kompakt satr aral)\n    } catch (error) {\n      addrY += 11;\n    }\n  });\n\n  // Date Info - Right side, irket bilgilerinden sonra (st ste binmeyi nlemek iin)\n  // irket bilgileri: addrY balang + (5 satr * 11pt) = companyInfoY + headerLogoSize + 10 + 55 = companyInfoY + 105\n  const dateInfoY = companyInfoY + headerLogoSize + 10 + (addressLines.length * 11) + 12; // irket bilgilerinden sonra 12pt boluk\n\n  // Format dates in Turkish format: \"20 Austos 2025\"\n  const formatDateTurkish = (dateStr: string | Date): string => {\n    try {\n      const date = typeof dateStr === 'string' ? new Date(dateStr) : dateStr;\n      if (isNaN(date.getTime())) {\n        // If already formatted (contains Turkish month names), return as is\n        if (typeof dateStr === 'string' && (dateStr.includes('Ocak') || dateStr.includes('ubat') || dateStr.includes('Mart') || dateStr.includes('Nisan') || dateStr.includes('Mays') || dateStr.includes('Haziran') || dateStr.includes('Temmuz') || dateStr.includes('Austos') || dateStr.includes('Eyll') || dateStr.includes('Ekim') || dateStr.includes('Kasm') || dateStr.includes('Aralk'))) {\n          return dateStr;\n        }\n        return formatDate(String(dateStr));\n      }\n      const months = [\"Ocak\", \"ubat\", \"Mart\", \"Nisan\", \"Mays\", \"Haziran\", \"Temmuz\", \"Austos\", \"Eyll\", \"Ekim\", \"Kasm\", \"Aralk\"];\n      return `${date.getDate()} ${months[date.getMonth()]} ${date.getFullYear()}`;\n    } catch (error) {\n      return formatDate(String(dateStr));\n    }\n  };\n\n  // Tarih - saa yasl\n  const dateLabel = \"Tarih:\";\n  let dateValue: string = \"-\";\n  try {\n    dateValue = formatDateTurkish(payload.quoteDate);\n  } catch (error) {\n    dateValue = \"-\";\n  }\n\n  safeSetFont(doc, \"bold\");\n  doc.setFontSize(14);\n  const dateLabelWidth = doc.getTextWidth(dateLabel);\n  safeSetFont(doc, \"normal\");\n  doc.setFontSize(14);\n  const dateValueWidth = doc.getTextWidth(dateValue);\n  const dateX = rightContentX - dateValueWidth;\n  safeText(dateLabel, dateX - dateLabelWidth - 6, dateInfoY, 14, true);\n  doc.setTextColor(55, 65, 81); // gray-700\n  safeText(dateValue, dateX, dateInfoY, 14, false);\n  doc.setTextColor(0, 0, 0);\n\n  // Geerlilik Tarihi - saa yasl, altnda\n  const validLabel = \"Geerlilik Tarihi:\";\n  let validValue: string = \"-\";\n  try {\n    validValue = formatDateTurkish(payload.validUntil);\n  } catch (error) {\n    validValue = \"-\";\n  }\n\n  safeSetFont(doc, \"bold\");\n  doc.setFontSize(14);\n  const validLabelWidth = doc.getTextWidth(validLabel);\n  safeSetFont(doc, \"normal\");\n  doc.setFontSize(14);\n  const validValueWidth = doc.getTextWidth(validValue);\n  const validX = rightContentX - validValueWidth;\n  safeText(validLabel, validX - validLabelWidth - 6, dateInfoY + 22, 14, true);\n  doc.setTextColor(55, 65, 81); // gray-700\n  safeText(validValue, validX, dateInfoY + 22, 14, false);\n  doc.setTextColor(0, 0, 0);\n\n  // Table starts after customer/date blocks - ensure enough space\n  // Optimized spacing for A4 layout\n  const maxBottomY = Math.max(customerY, dateInfoY + 40); // Reduced from 45\n  let currentY = maxBottomY + 30; // Reduced from 35 for tighter layout\n\n  // Products Table - Full width with columns: No, rn Ad, Adet, Birim Fiyat, Toplam\n  const items = Array.isArray(payload.items) ? payload.items.filter(item => item.description && item.description.trim() !== \"\") : [];\n\n  const tableBody = items.map((item, index) => {\n    const unitPrice = safeNumber(item.unitPrice);\n    const quantity = safeNumber(item.quantity);\n    const discount = safeNumber(item.discount || 0);\n    const lineTotal = (quantity * unitPrice) - discount;\n\n    return [\n      (index + 1).toString(), // No (1-based)\n      item.description || \"-\", // rn Ad (supports multi-line)\n      quantity.toString(), // Adet\n      safeFormatCurrency(unitPrice, payload.currency || \"$\"), // Birim Fiyat\n      safeFormatCurrency(lineTotal, payload.currency || \"$\"), // Toplam\n    ];\n  });\n\n  const tableHead = [[\"No\", \"rn Ad\", \"Adet\", \"Birim Fiyat\", \"Toplam\"]];\n\n  let startY = currentY;\n  const baseDidParseCell = createDidParseCell(doc);\n\n  // Alternatif satr renkleri iin zel didParseCell\n  const didParseCell = (data: { row?: { index?: number }; cell?: { styles?: { fillColor?: number[] } } }) => {\n    // Base fonksiyonu ar\n    if (baseDidParseCell) {\n      baseDidParseCell(data);\n    }\n\n    // Body satrlar iin alternatif renk (header hari, index 0 header)\n    if (data.row && data.row.index !== undefined && data.cell && data.cell.styles) {\n      const rowIndex = data.row.index;\n      // Header index 0, body satrlar 1'den balar\n      if (rowIndex > 0) {\n        // ift satrlar iin alternatif renk (2, 4, 6, ... - 0-based deil, 1-based body)\n        if ((rowIndex - 1) % 2 === 1) {\n          data.cell.styles.fillColor = [248, 250, 252]; // slate-50\n        } else {\n          data.cell.styles.fillColor = [255, 255, 255]; // Beyaz\n        }\n      }\n    }\n  };\n\n  // Dinamik tablo genilii hesaplama (dier tablolarla tutarl)\n  const dynamicPageWidth = doc.internal.pageSize.getWidth();\n  const tableWidth = dynamicPageWidth - (mar * 2);\n\n  // Profesyonel tablo stilleri kullan (modern UI/UX kurallarna uygun)\n  const tableStyles = createProfessionalTableStyles(doc, {\n    headerFontSize: 11,\n    bodyFontSize: 10,\n    cellPadding: { top: 12, right: 14, bottom: 12, left: 14 }\n  });\n\n  // Modern, profesyonel renk paleti\n  tableStyles.headStyles.fillColor = [15, 23, 42]; // slate-900 - daha koyu, profesyonel\n  tableStyles.headStyles.textColor = [255, 255, 255]; // White\n  tableStyles.headStyles.halign = \"center\";\n  tableStyles.headStyles.fontStyle = \"bold\";\n  tableStyles.headStyles.fontSize = 11;\n  tableStyles.headStyles.lineColor = [15, 23, 42]; // slate-900 border\n  tableStyles.headStyles.lineWidth = { top: 0, bottom: 2, left: 0, right: 0 }; // Kaln alt border\n  tableStyles.headStyles.cellPadding = { top: 12, right: 14, bottom: 12, left: 14 };\n  tableStyles.headStyles.minCellHeight = 36;\n\n  // Body stilleri - daha temiz ve okunabilir\n  tableStyles.bodyStyles.fillColor = [255, 255, 255]; // Beyaz\n  tableStyles.bodyStyles.textColor = [30, 41, 59]; // slate-700 - daha koyu, okunabilir\n  tableStyles.bodyStyles.fontSize = 10;\n  tableStyles.bodyStyles.fontStyle = \"normal\";\n  tableStyles.bodyStyles.lineColor = [226, 232, 240]; // slate-200 - daha ak border\n  tableStyles.bodyStyles.lineWidth = { bottom: 0.5, top: 0, left: 0, right: 0 }; // nce alt border\n  tableStyles.bodyStyles.cellPadding = { top: 12, right: 14, bottom: 12, left: 14 };\n  tableStyles.bodyStyles.minCellHeight = 32;\n  tableStyles.bodyStyles.overflow = 'linebreak';\n\n  // Alternatif satr renkleri (zebra striping) - daha profesyonel\n  tableStyles.alternateRowStyles.fillColor = [248, 250, 252]; // slate-50 - ok ak gri\n  tableStyles.styles.overflow = 'linebreak';\n\n  // Sayfa sma kontrol\n  startY = ensureTableFitsPage(doc, startY, 300, mar, \"rn Listesi\");\n\n  // Font'u zorla Roboto olarak ayarla (autoTable ncesi)\n  forceRobotoFont(doc, \"normal\");\n\n  autoTable(doc, {\n    head: transliterateTableData(tableHead),\n    body: transliterateTableData(tableBody.length === 0\n      ? [[\"\", \"Kalem bilgisi girilmedi\", \"\", \"\", \"\"]]\n      : tableBody),\n    startY,\n    margin: { left: mar, right: mar },\n    didParseCell: didParseCell,\n    tableWidth: tableWidth, // Dinamik genilik kullan\n    ...tableStyles,\n    columnStyles: {\n      0: {\n        cellWidth: tableWidth * 0.08,\n        halign: \"center\",\n        textColor: [71, 85, 105], // slate-600 - daha yumuak\n        fontStyle: \"normal\"\n      }, // %8 - No\n      1: {\n        cellWidth: tableWidth * 0.48,\n        halign: \"left\",\n        overflow: 'linebreak',\n        textColor: [15, 23, 42], // slate-900 - rn ad daha koyu\n        fontStyle: \"normal\"\n      }, // %48 - rn Ad\n      2: {\n        cellWidth: tableWidth * 0.10,\n        halign: \"center\",\n        textColor: [30, 41, 59], // slate-700\n        fontStyle: \"normal\"\n      }, // %10 - Adet\n      3: {\n        cellWidth: tableWidth * 0.17,\n        halign: \"right\",\n        textColor: [30, 41, 59], // slate-700\n        fontStyle: \"normal\"\n      }, // %17 - Birim Fiyat\n      4: {\n        cellWidth: tableWidth * 0.17,\n        halign: \"right\",\n        textColor: [15, 23, 42], // slate-900 - toplam daha vurgulu\n        fontStyle: \"bold\" // Toplam stunu bold\n      }, // %17 - Toplam\n    },\n  });\n\n  // Get actual table end position - minimum 30pt boluk (dier tablolarla tutarl)\n  let tableEndY = (doc.lastAutoTable?.finalY || startY);\n  if (doc.lastAutoTable?.finalY) {\n    tableEndY = doc.lastAutoTable.finalY + 50; // Optimize edilmi boluk: 50pt\n  } else {\n    tableEndY = startY + 50; // Fallback: eer lastAutoTable yoksa\n  }\n\n  // Layout: Left (Notes) - Right (Totals) at bottom\n  // Calculate available space - ensure footer doesn't overlap\n  const footerReservedSpace = 70; // Space reserved for footer (reduced from 80)\n  const minSpaceForNotesAndTotals = 180; // Minimum space needed (reduced from 200)\n  const availableSpace = pageHeight - tableEndY - footerReservedSpace;\n\n  // Check if we need a new page for notes/totals\n  let notesStartY = tableEndY + 25; // Reduced from 30\n  if (availableSpace < minSpaceForNotesAndTotals) {\n    doc.addPage();\n    notesStartY = 45; // Reduced from 50\n    tableEndY = notesStartY - 25; // Reset for new page\n  }\n\n  // Left Column: Notes area (bottom left)\n  // Optimized for A4: exactly half width minus gap\n  let notesY = notesStartY;\n  const notesWidth = (contentWidth / 2) - 15; // Gap between columns: 15pt\n\n  // Collect all notes/terms\n  const allNotes: string[] = [];\n  if (payload.notes && payload.notes.trim() !== \"\") {\n    allNotes.push(payload.notes);\n  }\n  if (payload.deliveryTerms && payload.deliveryTerms.trim() !== \"\") {\n    allNotes.push(`Teslimat: ${payload.deliveryTerms}`);\n  }\n  if (payload.paymentTerms && payload.paymentTerms.trim() !== \"\") {\n    allNotes.push(`deme: ${payload.paymentTerms}`);\n  }\n  if (payload.terms && payload.terms.length > 0) {\n    allNotes.push(...payload.terms);\n  }\n\n  // Render notes with bullet points\n  allNotes.forEach((note) => {\n    try {\n      safeSetFont(doc, \"normal\");\n      doc.setFontSize(11);\n      doc.setTextColor(107, 114, 128); // gray-500\n      safeText(\"\", mar, notesY, 11, false);\n      doc.setTextColor(0, 0, 0);\n\n      // Wrap text\n      const noteLines = doc.splitTextToSize(note, notesWidth - 15);\n      let noteLineY = notesY;\n      noteLines.forEach((line: string) => {\n        doc.setTextColor(75, 85, 99); // gray-600\n        safeText(line, mar + 12, noteLineY, 11, false);\n        doc.setTextColor(0, 0, 0);\n        noteLineY += 14;\n      });\n      notesY += (noteLines.length * 14) + 6;\n    } catch (error) {\n      notesY += 16;\n    }\n  });\n\n  // Right Column: Totals (bottom right, aligned)\n  const totals = payload.totals || { subtotal: 0, discount: 0, tax: 0, grandTotal: 0 };\n  const currency = payload.currency || \"$\";\n\n  const safeSubtotal = safeNumber(totals.subtotal);\n  const safeDiscount = safeNumber(totals.discount);\n  const safeTax = safeNumber(totals.tax);\n  const safeGrandTotal = safeNumber(totals.grandTotal);\n  const safeTaxRate = safeNumber(payload.taxRate || 20);\n\n  // Right column X position - ensure proper alignment\n  // Start at middle of page + gap\n  const rightColX = mar + (contentWidth / 2) + 15; // Gap: 15pt (matches notesWidth gap)\n\n  // Start totals from same Y as notes\n  let totalsY = notesStartY;\n\n  // Helper for right aligned totals row\n  // Optimized font sizes for A4\n  const drawTotalRow = (label: string, value: string, isBold = false, isGrandTotal = false) => {\n    try {\n      const fontSize = isGrandTotal ? 14 : 12; // Reduced: 1614, 1412\n      safeSetFont(doc, isBold || isGrandTotal ? \"bold\" : \"normal\");\n      doc.setFontSize(fontSize);\n\n      const valueWidth = doc.getTextWidth(value);\n\n      // Label on left side of totals area, value on right\n      safeText(label, rightColX, totalsY, fontSize, isBold || isGrandTotal);\n      safeText(value, rightContentX - valueWidth, totalsY, fontSize, isBold || isGrandTotal);\n\n      totalsY += isGrandTotal ? 22 : 18; // Reduced spacing: 2622, 2018\n    } catch (error) {\n      totalsY += isGrandTotal ? 20 : 18; // Reduced spacing\n    }\n  };\n\n  // Discount (if any)\n  if (safeDiscount > 0) {\n    drawTotalRow(\"Toplam skonto:\", `-${safeFormatCurrency(safeDiscount, currency)}`);\n  }\n\n  // Ara Toplam\n  drawTotalRow(\"Ara Toplam:\", safeFormatCurrency(safeSubtotal, currency));\n\n  // KDV\n  drawTotalRow(`KDV (%${safeTaxRate.toFixed(0)}):`, safeFormatCurrency(safeTax, currency));\n\n  // Separator line\n  doc.setDrawColor(107, 114, 128); // gray-500\n  doc.setLineWidth(1.5);\n  doc.line(rightColX, totalsY - 6, rightContentX, totalsY - 6);\n  totalsY += 10;\n\n  // GENEL TOPLAM (bold, bigger) - Optimized for A4\n  const grandTotalLabel = \"GENEL TOPLAM:\";\n  const grandTotalValue = safeFormatCurrency(safeGrandTotal, currency);\n\n  safeSetFont(doc, \"bold\");\n  doc.setFontSize(14); // Reduced from 16 for better fit\n  const grandTotalValueWidth = doc.getTextWidth(grandTotalValue);\n  safeText(grandTotalLabel, rightColX, totalsY, 14, true);\n  safeText(grandTotalValue, rightContentX - grandTotalValueWidth, totalsY, 14, true);\n\n  // Footer - Bottom of page, ensure it doesn't overlap content\n  // Optimized spacing for A4\n  const maxContentY = Math.max(notesY, totalsY) + 15; // Reduced from 20\n  const footerHeight = 55; // Reduced from 60\n  const footerBottomY = pageHeight - footerHeight;\n\n  // Check if content overlaps footer area\n  if (maxContentY > footerBottomY - 25) { // Reduced threshold from 30\n    // Content too close to footer, add new page for footer\n    doc.addPage();\n  }\n\n  // Draw footer on current page (or new page if added)\n  const currentPageHeight = doc.internal.pageSize.getHeight();\n  const footerY = currentPageHeight - footerHeight;\n\n  // Footer separator line\n  doc.setDrawColor(209, 213, 219); // gray-300\n  doc.setLineWidth(1);\n  doc.line(mar, footerY - 10, rightContentX, footerY - 10);\n\n  // Left: Company legal info\n  safeSetFont(doc, \"bold\");\n  doc.setFontSize(10);\n  doc.setTextColor(31, 41, 55); // gray-800\n  safeText(COMPANY_INFO.name, mar, footerY, 10, true);\n  doc.setTextColor(0, 0, 0);\n\n  safeSetFont(doc, \"normal\");\n  doc.setFontSize(9);\n  doc.setTextColor(75, 85, 99); // gray-600\n  safeText(COMPANY_INFO.fullAddress, mar, footerY + 12, 9, false);\n  safeText(`${COMPANY_INFO.email} | ${COMPANY_INFO.website} | ${COMPANY_INFO.phone}`, mar, footerY + 22, 9, false);\n  doc.setTextColor(0, 0, 0);\n\n  // Right: Logo (smaller size, bottom-right aligned)\n  try {\n    const footerLogoSize = 28;\n    const logoX = rightContentX - footerLogoSize;\n    doc.addImage(REV_LOGO_DATA_URI, 'PNG', logoX, footerY, footerLogoSize, footerLogoSize);\n  } catch (error) {\n  }\n\n  // PDF'i gvenli bir ekilde olutur\n  try {\n    const blob = doc.output(\"blob\");\n    if (!blob || blob.size === 0) {\n      throw new Error(\"PDF blob bo veya geersiz\");\n    }\n    return blob;\n  } catch (outputError) {\n    throw new Error(\"PDF oluturulamad: \" + (outputError instanceof Error ? outputError.message : \"Bilinmeyen hata\"));\n  }\n};\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\services\\pdf\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\services\\pdf\\pdfCore.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":594,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":594,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[19286,19289],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[19286,19289],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * PDF Generator Core\r\n * Core PDF functionality, constants, types, and shared utilities\r\n * Extracted from pdfGenerator.ts for better maintainability\r\n */\r\n\r\nimport jsPDF, { jsPDFOptions } from \"jspdf\";\r\nimport autoTable, { CellHookData as AutoTableCellHookData } from \"jspdf-autotable\";\r\nimport { REV_LOGO_DATA_URI } from \"@/assets/rev-logo-base64\";\r\n\r\n// Company info\r\nexport const COMPANY_INFO = {\r\n    name: \"Revium Tech\",\r\n    contactInfo: \"info@reviumtech.com | www.reviumtech.com | +90 (551) 829-1613\",\r\n    headerAddress: \"Fevzi Cakmak Mah. Milenyum Cad. No:81\",\r\n} as const;\r\n\r\n// PDF sabit deerleri - cache'lenmi\r\nexport const PDF_CONSTANTS = {\r\n    margin: 50,\r\n    headerHeight: 120,\r\n    footerHeight: 50,\r\n    logoSize: 40,\r\n    footerLogoSize: 28,\r\n    lineHeight: 14,\r\n    primaryColor: [30, 41, 59] as [number, number, number],\r\n    secondaryColor: [100, 116, 139] as [number, number, number],\r\n    accentColor: [37, 99, 235] as [number, number, number],\r\n    backgroundColor: [248, 250, 252] as [number, number, number],\r\n    borderColor: [226, 232, 240] as [number, number, number],\r\n    sectionSpacing: 20,\r\n    tableSpacing: 20,\r\n    fontSizeTitle: 16,\r\n    fontSizeSubtitle: 12,\r\n    fontSizeBody: 11,\r\n    fontSizeSmall: 10,\r\n    fontSizeCardTitle: 12,\r\n    fontSizeCardValue: 24,\r\n    fontSizeCardDescription: 11,\r\n    fontSizeTableHeader: 16,\r\n    fontSizeTableBody: 11,\r\n    fontSizeTableHeaderText: 12,\r\n} as const;\r\n\r\n// Profesyonel renk paleti\r\nexport const TAILWIND_COLORS = {\r\n    // Card backgrounds\r\n    cardBackground: [248, 250, 252] as [number, number, number],\r\n    cardBorder: [226, 232, 240] as [number, number, number],\r\n    cardText: [51, 65, 85] as [number, number, number],\r\n    cardValue: [15, 23, 42] as [number, number, number],\r\n\r\n    // Primary kart (vurgulu)\r\n    primaryCardBg: [255, 255, 255] as [number, number, number],\r\n    primaryCardBorder: [221, 83, 53] as [number, number, number],\r\n    primaryCardValue: [221, 83, 53] as [number, number, number],\r\n\r\n    // Status colors\r\n    successCardBg: [240, 253, 244] as [number, number, number],\r\n    successCardBorder: [187, 247, 208] as [number, number, number],\r\n    successCardValue: [22, 163, 74] as [number, number, number],\r\n\r\n    infoCardBg: [239, 246, 255] as [number, number, number],\r\n    infoCardBorder: [191, 219, 254] as [number, number, number],\r\n    infoCardValue: [37, 99, 235] as [number, number, number],\r\n\r\n    warningCardBg: [255, 251, 235] as [number, number, number],\r\n    warningCardBorder: [254, 215, 170] as [number, number, number],\r\n    warningCardValue: [234, 88, 12] as [number, number, number],\r\n\r\n    dangerCardBg: [254, 242, 242] as [number, number, number],\r\n    dangerCardBorder: [254, 202, 202] as [number, number, number],\r\n    dangerCardValue: [220, 38, 38] as [number, number, number],\r\n\r\n    // Grayscale\r\n    gray50: [249, 250, 251] as [number, number, number],\r\n    gray100: [243, 244, 246] as [number, number, number],\r\n    gray200: [229, 231, 235] as [number, number, number],\r\n    gray300: [209, 213, 219] as [number, number, number],\r\n    gray400: [156, 163, 175] as [number, number, number],\r\n    gray500: [107, 114, 128] as [number, number, number],\r\n    gray600: [75, 85, 99] as [number, number, number],\r\n    gray700: [55, 65, 81] as [number, number, number],\r\n    gray800: [30, 41, 59] as [number, number, number],\r\n    gray900: [15, 23, 42] as [number, number, number],\r\n    white: [255, 255, 255] as [number, number, number],\r\n} as const;\r\n\r\n// Types\r\nexport interface PDFTemplateLayout {\r\n    background: {\r\n        startY: number;\r\n        endY: number;\r\n    };\r\n    header: {\r\n        startY: number;\r\n        endY: number;\r\n        logoX: number;\r\n        logoY: number;\r\n        titleX: number;\r\n        titleY: number;\r\n    };\r\n    contentArea: {\r\n        startY: number;\r\n        endY: number;\r\n        width: number;\r\n        leftMargin: number;\r\n        rightMargin: number;\r\n    };\r\n}\r\n\r\nexport interface StatCardConfig {\r\n    title: string;\r\n    value: string | number;\r\n    description?: string;\r\n    color: {\r\n        background: [number, number, number];\r\n        border: [number, number, number];\r\n        text: [number, number, number];\r\n        value: [number, number, number];\r\n    };\r\n}\r\n\r\nexport interface TableHeaderConfig {\r\n    title: string;\r\n    backgroundColor?: [number, number, number];\r\n    textColor?: [number, number, number];\r\n    borderColor?: [number, number, number];\r\n}\r\n\r\nexport interface TotalsSummary {\r\n    subtotal: number;\r\n    discount: number;\r\n    tax: number;\r\n    grandTotal: number;\r\n}\r\n\r\nexport interface ProfessionalTableStyles {\r\n    headStyles: Record<string, unknown>;\r\n    bodyStyles: Record<string, unknown>;\r\n    styles: Record<string, unknown>;\r\n    alternateRowStyles: Record<string, unknown>;\r\n}\r\n\r\n// Font status interface\r\nexport interface jsPDFWithFontStatus extends jsPDF {\r\n    _robotoFontLoaded?: boolean;\r\n    _robotoFontLoadFailed?: boolean;\r\n    _robotoSupportsTurkish?: boolean;\r\n    _turkishCharsTested?: boolean;\r\n    lastAutoTable?: {\r\n        finalY?: number;\r\n    };\r\n}\r\n\r\n// Helper functions\r\n\r\n/**\r\n * Trke karakterleri ASCII'ye evir\r\n */\r\nexport function transliterateTurkish(text: string): string {\r\n    const turkishMap: Record<string, string> = {\r\n        '': 'c', '': 'C',\r\n        '': 'g', '': 'G',\r\n        '': 'i', '': 'I',\r\n        '': 'o', '': 'O',\r\n        '': 's', '': 'S',\r\n        '': 'u', '': 'U',\r\n    };\r\n\r\n    return text.replace(/[]/g, (char) => turkishMap[char] || char);\r\n}\r\n\r\n/**\r\n * AutoTable verilerini transliterate et\r\n */\r\nexport function transliterateTableData(\r\n    data: (string | number)[][] | null | undefined,\r\n    doc?: jsPDFWithFontStatus\r\n): (string | number)[][] {\r\n    if (!data) return [];\r\n\r\n    // Roboto font yklyse transliterate yapma\r\n    if (doc && doc._robotoFontLoaded && !doc._robotoFontLoadFailed) {\r\n        return data; // Return original data\r\n    }\r\n\r\n    return data.map(row =>\r\n        row.map(cell =>\r\n            typeof cell === 'string' ? transliterateTurkish(cell) : cell\r\n        )\r\n    );\r\n}\r\n\r\n/**\r\n * PDF Template olutur\r\n */\r\nexport function createPDFTemplate(doc: jsPDFWithFontStatus): PDFTemplateLayout {\r\n    const pageWidth = doc.internal.pageSize.getWidth();\r\n    const pageHeight = doc.internal.pageSize.getHeight();\r\n\r\n    return {\r\n        background: {\r\n            startY: 0,\r\n            endY: pageHeight,\r\n        },\r\n        header: {\r\n            startY: 0,\r\n            endY: PDF_CONSTANTS.headerHeight,\r\n            logoX: PDF_CONSTANTS.margin,\r\n            logoY: 30,\r\n            titleX: PDF_CONSTANTS.margin + PDF_CONSTANTS.logoSize + 20,\r\n            titleY: 45,\r\n        },\r\n        contentArea: {\r\n            startY: PDF_CONSTANTS.headerHeight + 20,\r\n            endY: pageHeight - PDF_CONSTANTS.footerHeight - 20,\r\n            width: pageWidth - (PDF_CONSTANTS.margin * 2),\r\n            leftMargin: PDF_CONSTANTS.margin,\r\n            rightMargin: pageWidth - PDF_CONSTANTS.margin,\r\n        },\r\n    };\r\n}\r\n\r\n/**\r\n * Kart boyutlarn hesapla\r\n */\r\nexport function calculateCardDimensions(\r\n    contentWidth: number,\r\n    cardCount: number\r\n): { width: number; gap: number } {\r\n    const gap = 16;\r\n    const totalGaps = (cardCount - 1) * gap;\r\n    const width = (contentWidth - totalGaps) / cardCount;\r\n    return { width, gap };\r\n}\r\n\r\n/**\r\n * Para birimi formatla\r\n */\r\nexport function formatCurrency(value: number, currency = \"\"): string {\r\n    return `${currency}${value.toLocaleString('tr-TR', {\r\n        minimumFractionDigits: 2,\r\n        maximumFractionDigits: 2\r\n    })}`;\r\n}\r\n\r\n/**\r\n * Gvenli say dnm\r\n */\r\nexport function safeNumber(value: unknown): number {\r\n    if (typeof value === 'number') return value;\r\n    if (typeof value === 'string') {\r\n        const parsed = parseFloat(value);\r\n        return isNaN(parsed) ? 0 : parsed;\r\n    }\r\n    return 0;\r\n}\r\n\r\n/**\r\n * Gvenli para birimi format\r\n */\r\nexport function safeFormatCurrency(value: number): string {\r\n    if (typeof value !== 'number' || isNaN(value)) {\r\n        return '0,00';\r\n    }\r\n    return formatCurrency(value);\r\n}\r\n\r\n/**\r\n * Tarih formatla\r\n */\r\nexport function formatDate(dateStr: string): string {\r\n    try {\r\n        const date = new Date(dateStr);\r\n        if (isNaN(date.getTime())) return dateStr;\r\n\r\n        const months = [\r\n            'Ocak', 'ubat', 'Mart', 'Nisan', 'Mays', 'Haziran',\r\n            'Temmuz', 'Austos', 'Eyll', 'Ekim', 'Kasm', 'Aralk'\r\n        ];\r\n\r\n        const day = date.getDate();\r\n        const month = months[date.getMonth()];\r\n        const year = date.getFullYear();\r\n\r\n        return `${day} ${month} ${year}`;\r\n    } catch {\r\n        return dateStr;\r\n    }\r\n}\r\n\r\n/**\r\n * Ksa tarih format\r\n */\r\nexport function formatDateShort(dateStr: string): string {\r\n    try {\r\n        const date = new Date(dateStr);\r\n        if (isNaN(date.getTime())) return dateStr;\r\n        return date.toLocaleDateString('tr-TR');\r\n    } catch {\r\n        return dateStr;\r\n    }\r\n}\r\n\r\n/**\r\n * PDF olutur\r\n */\r\nexport function createPdf(\r\n    options: jsPDFOptions = { format: \"a4\", unit: \"pt\" }\r\n): jsPDFWithFontStatus {\r\n    return new jsPDF(options) as jsPDFWithFontStatus;\r\n}\r\n\r\n/**\r\n * Sayfa smazsa yeni sayfa ekle\r\n */\r\nexport function ensureSpace(\r\n    doc: jsPDF,\r\n    currentY: number,\r\n    requiredHeight: number,\r\n    margin = 40,\r\n    titleForNextPage?: string\r\n): number {\r\n    const pageHeight = doc.internal.pageSize.getHeight();\r\n\r\n    if (currentY + requiredHeight > pageHeight - margin) {\r\n        doc.addPage();\r\n        let newY = margin;\r\n\r\n        if (titleForNextPage) {\r\n            doc.setFontSize(12);\r\n            doc.text(titleForNextPage + \" (devam)\", margin, newY);\r\n            newY += 20;\r\n        }\r\n\r\n        return newY;\r\n    }\r\n\r\n    return currentY;\r\n}\r\n\r\n// Re-export for convenience\r\nexport { REV_LOGO_DATA_URI };\r\n\r\nimport { ROBOTO_REGULAR_BASE64, ROBOTO_BOLD_BASE64 } from \"@/assets/fonts/roboto-base64\";\r\n\r\nexport const isRobotoName = (fontName?: string): boolean => {\r\n    if (!fontName) return false;\r\n    return fontName.toLowerCase().includes(\"roboto\");\r\n};\r\n\r\n// Glendirilmi Font Ynetimi\r\nexport const registerFonts = async (doc: jsPDFWithFontStatus) => {\r\n    // Eer font zaten yklendiyse tekrar ykleme\r\n    if (doc._robotoFontLoaded && !doc._robotoFontLoadFailed) {\r\n        // Font'un gerekten ykl olduunu dorula\r\n        try {\r\n            const currentFont = doc.getFont();\r\n            if (currentFont && isRobotoName(currentFont.fontName)) {\r\n                // Font ykl, Trke karakter desteini test et\r\n                try {\r\n                    doc.setFontSize(12);\r\n                    doc.text(\"\", -1000, -1000);\r\n                    return; // Font zaten ykl ve alyor\r\n                } catch (testError) {\r\n                    // Trke karakter testi baarsz, ama font ykl olabilir\r\n                    // Font'u yeniden ykle\r\n                    doc._robotoFontLoaded = false;\r\n                }\r\n            } else {\r\n                // Font ykl deil, yeniden ykle\r\n                doc._robotoFontLoaded = false;\r\n            }\r\n        } catch {\r\n            // Font kontrol baarsz, yeniden ykle\r\n            doc._robotoFontLoaded = false;\r\n        }\r\n    }\r\n\r\n    // Eer daha nce ykleme baarsz olduysa, tekrar dene (flag'i reset et)\r\n    if (doc._robotoFontLoadFailed) {\r\n        // Bir kez daha deneme ans ver\r\n        doc._robotoFontLoadFailed = false;\r\n        // Devam et, font ykleme ilemini tekrar dene\r\n    }\r\n\r\n    // Font string'lerinin kesilmi olup olmadn kontrol et\r\n    if (ROBOTO_REGULAR_BASE64.endsWith('...') || ROBOTO_BOLD_BASE64.endsWith('...') ||\r\n        ROBOTO_REGULAR_BASE64.length < 1000 || ROBOTO_BOLD_BASE64.length < 1000) {\r\n        doc.setFont(\"helvetica\", \"normal\");\r\n        doc._robotoFontLoaded = false;\r\n        doc._robotoFontLoadFailed = true;\r\n        return;\r\n    }\r\n\r\n    try {\r\n        // Base64 string'lerin dzgn formatta olduundan emin ol\r\n        let cleanRegular = ROBOTO_REGULAR_BASE64.replace(/^data:.*?,/, '').trim();\r\n        let cleanBold = ROBOTO_BOLD_BASE64.replace(/^data:.*?,/, '').trim();\r\n\r\n        cleanRegular = cleanRegular.replace(/\\.\\.\\.$/, '').trim();\r\n        cleanBold = cleanBold.replace(/\\.\\.\\.$/, '').trim();\r\n\r\n        if (!cleanRegular || !cleanBold || cleanRegular.length === 0 || cleanBold.length === 0) {\r\n            throw new Error(\"Font base64 string'leri bo\");\r\n        }\r\n\r\n        cleanRegular = cleanRegular.replace(/\\s+/g, '');\r\n        cleanBold = cleanBold.replace(/\\s+/g, '');\r\n\r\n        cleanRegular = cleanRegular.replace(/[^A-Za-z0-9+/=]/g, '');\r\n        cleanBold = cleanBold.replace(/[^A-Za-z0-9+/=]/g, '');\r\n\r\n        const regularPadding = (4 - (cleanRegular.length % 4)) % 4;\r\n        const boldPadding = (4 - (cleanBold.length % 4)) % 4;\r\n        cleanRegular += '='.repeat(regularPadding);\r\n        cleanBold += '='.repeat(boldPadding);\r\n\r\n        if (cleanRegular.length === 0 || cleanBold.length === 0) {\r\n            throw new Error(\"Font base64 string'leri bo\");\r\n        }\r\n\r\n        // Add to VFS\r\n        try {\r\n            doc.addFileToVFS(\"Roboto-Regular.ttf\", cleanRegular);\r\n            doc.addFileToVFS(\"Roboto-Bold.ttf\", cleanBold);\r\n        } catch (vfsError) {\r\n            throw new Error(\"Font VFS'e eklenemedi: \" + vfsError);\r\n        }\r\n\r\n        // Add fonts\r\n        try {\r\n            doc.addFont(\"Roboto-Regular.ttf\", \"Roboto\", \"normal\");\r\n            const fontListAfterRegular = doc.getFontList();\r\n            const hasRobotoRegular = fontListAfterRegular && Object.keys(fontListAfterRegular).some((key) => isRobotoName(key));\r\n\r\n            if (!hasRobotoRegular) {\r\n                throw new Error(\"Roboto Regular font eklenemedi\");\r\n            }\r\n\r\n            doc.addFont(\"Roboto-Bold.ttf\", \"Roboto\", \"bold\");\r\n        } catch (addFontError) {\r\n            throw new Error(\"Font eklenemedi: \" + addFontError);\r\n        }\r\n\r\n        // Set default font ve test et\r\n        try {\r\n            doc.setFont(\"Roboto\", \"normal\");\r\n            doc._robotoFontLoaded = true;\r\n            doc._robotoFontLoadFailed = false;\r\n        } catch (setFontError) {\r\n            throw new Error(\"Font ayarlanamad: \" + setFontError);\r\n        }\r\n\r\n    } catch (error) {\r\n        console.error(\"Font ykleme hatas:\", error);\r\n        doc.setFont(\"helvetica\", \"normal\");\r\n        doc._robotoFontLoaded = false;\r\n        doc._robotoFontLoadFailed = true;\r\n    }\r\n};\r\n\r\nexport const createSafeText = (doc: jsPDFWithFontStatus) => {\r\n    // Roboto font Trke karakterleri destekliyor\r\n    // Sadece Helvetica kullanlrken transliterate et\r\n    return (text: string, x: number, y: number, fontSize: number, isBold: boolean = false) => {\r\n        // null/undefined kontrol\r\n        if (text == null || text === '') {\r\n            return;\r\n        }\r\n\r\n        const textStr = String(text);\r\n\r\n        // NCE translitere edilmi versiyonu hazrla (yedek olarak)\r\n        const transliteratedText = transliterateTurkish(textStr);\r\n\r\n        // Font yklenmemise veya ykleme baarszsa direkt helvetica kullan ve transliterate et\r\n        if (!doc._robotoFontLoaded || doc._robotoFontLoadFailed) {\r\n            try {\r\n                doc.setFont(\"helvetica\", isBold ? \"bold\" : \"normal\");\r\n                doc.setFontSize(fontSize);\r\n                doc.text(transliteratedText, x, y);\r\n            } catch (error: unknown) {\r\n                // Hata durumunda sessizce devam et - ama loglayalm\r\n                console.warn('createSafeText: Helvetica ile yazlamad:', error);\r\n            }\r\n            return;\r\n        }\r\n\r\n        // Roboto kullanmay dene\r\n        let robotoSuccess = false;\r\n        try {\r\n            doc.setFont(\"Roboto\", isBold ? \"bold\" : \"normal\");\r\n            doc.setFontSize(fontSize);\r\n            const currentFont = doc.getFont();\r\n\r\n            if (currentFont && isRobotoName(currentFont.fontName)) {\r\n                // Roboto font baaryla ayarland, Trke karakterleri koruyarak yaz\r\n                try {\r\n                    doc.text(textStr, x, y);\r\n                    robotoSuccess = true;\r\n                } catch (writeError) {\r\n                    // Text yazma hatas - robotoSuccess false kalacak, fallback'e geilecek\r\n                    console.warn('createSafeText: Roboto textStr yazlamad, fallback deneniyor:', writeError);\r\n                }\r\n            }\r\n        } catch (fontError) {\r\n            // Font ayarlama hatas\r\n            console.warn('createSafeText: Roboto font ayarlanamad:', fontError);\r\n        }\r\n\r\n        // Roboto baarsz olduysa, Helvetica ile translitere edilmi text'i yaz\r\n        if (!robotoSuccess) {\r\n            try {\r\n                doc.setFont(\"helvetica\", isBold ? \"bold\" : \"normal\");\r\n                doc.setFontSize(fontSize);\r\n                doc.text(transliteratedText, x, y);\r\n            } catch (fallbackError) {\r\n                // Son are: loglayp devam et\r\n                console.error('createSafeText: Fallback da baarsz:', fallbackError);\r\n            }\r\n        }\r\n    };\r\n};\r\n\r\nexport const forceRobotoFont = (doc: jsPDFWithFontStatus, style: \"normal\" | \"bold\" = \"normal\") => {\r\n    if (doc._robotoFontLoaded && !doc._robotoFontLoadFailed) {\r\n        for (let i = 0; i < 10; i++) {\r\n            try {\r\n                doc.setFont(\"Roboto\", style);\r\n                const currentFont = doc.getFont();\r\n                if (currentFont && isRobotoName(currentFont.fontName)) {\r\n                    return true;\r\n                }\r\n            } catch {\r\n                // Tekrar dene\r\n            }\r\n        }\r\n    }\r\n    return false;\r\n};\r\n\r\nexport const safeSetFont = (doc: jsPDFWithFontStatus, style: \"normal\" | \"bold\" = \"normal\") => {\r\n    if (!doc._robotoFontLoaded || doc._robotoFontLoadFailed) {\r\n        try {\r\n            doc.setFont(\"helvetica\", style);\r\n        } catch {\r\n            // ignore\r\n        }\r\n        return;\r\n    }\r\n\r\n    let attempts = 0;\r\n    let fontSet = false;\r\n    const maxAttempts = 3;\r\n\r\n    while (attempts < maxAttempts && !fontSet) {\r\n        try {\r\n            doc.setFont(\"Roboto\", style);\r\n            const currentFont = doc.getFont();\r\n            if (currentFont && isRobotoName(currentFont.fontName)) {\r\n                try {\r\n                    doc.setFontSize(12);\r\n                    doc.text(\"\", -1000, -1000);\r\n                    fontSet = true;\r\n                    break;\r\n                } catch (testError) {\r\n                    // ignore\r\n                }\r\n            }\r\n            attempts++;\r\n        } catch (error) {\r\n            attempts++;\r\n        }\r\n    }\r\n\r\n    if (!fontSet) {\r\n        try {\r\n            doc.setFont(\"helvetica\", style);\r\n            doc._robotoFontLoaded = false;\r\n            doc._robotoFontLoadFailed = true;\r\n        } catch {\r\n            // ignore\r\n        }\r\n    }\r\n};\r\n\r\nexport const createWillDrawCell = (doc: jsPDFWithFontStatus) => {\r\n    return (data: AutoTableCellHookData) => {\r\n        if (!data.cell) return;\r\n\r\n        // Cast cell to any to avoid strict type checks on styles and fontStyle which might not match exact types\r\n        const cell = data.cell as any;\r\n        const fontStyle = (cell.fontStyle === \"bold\" || cell.styles?.fontStyle === \"bold\" || cell.styles?.font === \"bold\") ? \"bold\" : \"normal\";\r\n\r\n        if (doc._robotoFontLoaded && !doc._robotoFontLoadFailed) {\r\n            try {\r\n                safeSetFont(doc, fontStyle);\r\n                if (!cell.styles) {\r\n                    cell.styles = {};\r\n                }\r\n                cell.styles.font = \"Roboto\";\r\n                cell.styles.fontStyle = fontStyle;\r\n            } catch {\r\n                if (!cell.styles) cell.styles = {};\r\n                cell.styles.font = \"helvetica\";\r\n                cell.styles.fontStyle = fontStyle;\r\n            }\r\n        } else {\r\n            if (!cell.styles) cell.styles = {};\r\n            cell.styles.font = \"helvetica\";\r\n            cell.styles.fontStyle = fontStyle;\r\n\r\n            if (cell.text) {\r\n                if (typeof cell.text === 'string') {\r\n                    cell.text = transliterateTurkish(cell.text);\r\n                } else if (Array.isArray(cell.text)) {\r\n                    cell.text = (cell.text as string[]).map((t: string) => transliterateTurkish(t));\r\n                }\r\n            }\r\n        }\r\n    };\r\n};\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\services\\pdf\\pdfDrawing.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\services\\pdf\\pdfProductionReport.ts","messages":[{"ruleId":"prefer-const","severity":2,"message":"'nextY' is never reassigned. Use 'const' instead.","line":67,"column":13,"nodeType":"Identifier","messageId":"useConst","endLine":67,"endColumn":18,"fix":{"range":[1710,1734],"text":"const nextY = margin + 30;"}},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":363,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":363,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14168,14171],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14168,14171],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":364,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":364,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14233,14236],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14233,14236],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":1,"fixableWarningCount":0,"source":"import jsPDF from \"jspdf\";\r\nimport autoTable from \"jspdf-autotable\";\r\nimport {\r\n    createPdf,\r\n    registerFonts,\r\n    formatDate,\r\n    PDF_CONSTANTS,\r\n    TAILWIND_COLORS,\r\n    createSafeText,\r\n    createPDFTemplate,\r\n    calculateCardDimensions,\r\n    safeNumber,\r\n    ensureSpace,\r\n    isRobotoName,\r\n    jsPDFWithFontStatus,\r\n    PDFTemplateLayout,\r\n    transliterateTurkish,\r\n    transliterateTableData,\r\n    forceRobotoFont,\r\n    safeSetFont,\r\n    createWillDrawCell\r\n} from \"./pdfCore\";\r\n\r\nimport {\r\n    applyPDFTemplate,\r\n    drawStatCard,\r\n    drawProfessionalTableHeader,\r\n    drawPDFBackground,\r\n    drawSummarySection,\r\n    drawPDFFooter,\r\n    createProfessionalTableStyles\r\n} from \"./pdfDrawing\";\r\n\r\n// Types derived from the component\r\nexport type ProductionStatus = \"planned\" | \"in_production\" | \"quality_check\" | \"completed\" | \"on_hold\";\r\nexport type StatusDistribution = Record<ProductionStatus, number>;\r\n\r\nexport interface ProductProductionStat {\r\n    name: string;\r\n    quantity: number;\r\n    orders: number;\r\n}\r\n\r\nexport interface ProductionReportData {\r\n    totalOrders: number;\r\n    completed: number;\r\n    completionRate: number;\r\n    statusDistribution: StatusDistribution;\r\n    topProducts: ProductProductionStat[];\r\n}\r\n\r\n\r\n\r\nconst ensureTableFitsPage = (\r\n    doc: jsPDFWithFontStatus,\r\n    currentY: number,\r\n    requiredHeight: number,\r\n    margin: number = 40,\r\n    titleForNextPage?: string\r\n): number => {\r\n    const pageHeight = doc.internal.pageSize.getHeight();\r\n    const footerHeight = PDF_CONSTANTS.footerHeight;\r\n    const minSpaceNeeded = requiredHeight + 70;\r\n\r\n    if (currentY + minSpaceNeeded > pageHeight - footerHeight - margin) {\r\n        doc.addPage();\r\n        let nextY = margin + 30;\r\n        const template = createPDFTemplate(doc);\r\n        drawPDFBackground(doc, template);\r\n        return nextY;\r\n    }\r\n    return currentY;\r\n};\r\n\r\n\r\nexport const generateProductionReportPDF = async (data: ProductionReportData, startDate: string, endDate: string) => {\r\n    const doc = createPdf({ format: \"a4\", unit: \"pt\" });\r\n\r\n    try {\r\n        await registerFonts(doc);\r\n    } catch (fontError) {\r\n        console.warn(\"Font yklenirken hata olutu:\", fontError);\r\n    }\r\n\r\n    if (!doc._robotoFontLoaded || doc._robotoFontLoadFailed) {\r\n        // Retry logic could be here\r\n    }\r\n\r\n    if (doc._robotoFontLoaded && !doc._robotoFontLoadFailed) {\r\n        forceRobotoFont(doc, \"normal\");\r\n    }\r\n\r\n    const reportDate = formatDate(new Date().toISOString());\r\n\r\n    const template = applyPDFTemplate(doc, \"RETM RAPORU\", reportDate, startDate, endDate);\r\n\r\n    if (doc._robotoFontLoaded && !doc._robotoFontLoadFailed) {\r\n        forceRobotoFont(doc, \"normal\");\r\n    }\r\n\r\n    let currentY = template.contentArea.startY;\r\n    const contentWidth = template.contentArea.width;\r\n    const mar = template.contentArea.leftMargin;\r\n\r\n    const cardWidth = (contentWidth - 32) / 3;\r\n    const cardHeight = 110;\r\n    const cardGap = 16;\r\n    let cardX = mar;\r\n\r\n    const totalOrders = safeNumber(data.totalOrders);\r\n    drawStatCard(doc, cardX, currentY, cardWidth, cardHeight, {\r\n        title: \"Toplam Sipari\",\r\n        value: totalOrders.toString(),\r\n        description: \"Tarih aralnda\",\r\n        color: {\r\n            background: TAILWIND_COLORS.infoCardBg,\r\n            border: TAILWIND_COLORS.infoCardBorder,\r\n            text: TAILWIND_COLORS.cardText,\r\n            value: TAILWIND_COLORS.infoCardValue,\r\n        },\r\n    });\r\n\r\n    cardX += cardWidth + cardGap;\r\n    const completed = safeNumber(data.completed);\r\n    drawStatCard(doc, cardX, currentY, cardWidth, cardHeight, {\r\n        title: \"Tamamlanan\",\r\n        value: completed.toString(),\r\n        description: \"Baaryla tamamland\",\r\n        color: {\r\n            background: TAILWIND_COLORS.successCardBg,\r\n            border: TAILWIND_COLORS.successCardBorder,\r\n            text: TAILWIND_COLORS.cardText,\r\n            value: TAILWIND_COLORS.successCardValue,\r\n        },\r\n    });\r\n\r\n    cardX += cardWidth + cardGap;\r\n    const completionRate = safeNumber(data.completionRate);\r\n    drawStatCard(doc, cardX, currentY, cardWidth, cardHeight, {\r\n        title: \"Tamamlanma Oran\",\r\n        value: `${completionRate.toFixed(1)}%`,\r\n        description: \"Baar oran\",\r\n        color: {\r\n            background: TAILWIND_COLORS.primaryCardBg,\r\n            border: TAILWIND_COLORS.primaryCardBorder,\r\n            text: TAILWIND_COLORS.cardText,\r\n            value: TAILWIND_COLORS.primaryCardValue,\r\n        },\r\n    });\r\n\r\n    currentY += cardHeight + PDF_CONSTANTS.sectionSpacing;\r\n\r\n    if (data.statusDistribution) {\r\n        currentY = ensureSpace(doc, currentY, 200, mar, \"Durum Dalm\");\r\n        currentY = drawProfessionalTableHeader(doc, mar, currentY, 250, {\r\n            title: \"Durum Dalm\",\r\n            backgroundColor: [249, 250, 251],\r\n            textColor: PDF_CONSTANTS.primaryColor,\r\n            borderColor: PDF_CONSTANTS.primaryColor,\r\n        });\r\n\r\n        const statusLabels: Record<string, string> = {\r\n            planned: \"Planland\",\r\n            in_production: \"retimde\",\r\n            quality_check: \"Kalite Kontrol\",\r\n            completed: \"Tamamland\",\r\n            on_hold: \"Beklemede\"\r\n        };\r\n\r\n        const statusData = Object.entries(data.statusDistribution)\r\n            .filter(([_, value]) => safeNumber(value as number) > 0)\r\n            .sort((a, b) => safeNumber(b[1] as number) - safeNumber(a[1] as number))\r\n            .map(([key, value]) => {\r\n                const count = safeNumber(value as number);\r\n                const percentage = totalOrders > 0 ? `${((count / totalOrders) * 100).toFixed(1)}%` : \"0%\";\r\n                return [\r\n                    statusLabels[key] || key,\r\n                    count.toString(),\r\n                    percentage\r\n                ];\r\n            });\r\n\r\n        const tableStyles = createProfessionalTableStyles(doc, {\r\n            headerFontSize: 12,\r\n            bodyFontSize: 11,\r\n            cellPadding: { top: 12, right: 14, bottom: 12, left: 14 }\r\n        });\r\n        tableStyles.headStyles.fillColor = PDF_CONSTANTS.primaryColor;\r\n        tableStyles.headStyles.textColor = [255, 255, 255];\r\n        tableStyles.headStyles.halign = \"center\" as const;\r\n        tableStyles.bodyStyles.overflow = 'linebreak';\r\n        tableStyles.styles.overflow = 'linebreak';\r\n\r\n        currentY = ensureTableFitsPage(doc, currentY, 200, mar, \"Durum Dalm\");\r\n        const currentPageWidth = doc.internal.pageSize.getWidth();\r\n        const tableWidth = currentPageWidth - (mar * 2);\r\n\r\n        forceRobotoFont(doc, \"normal\");\r\n\r\n        autoTable(doc, {\r\n            startY: currentY,\r\n            head: transliterateTableData([['Durum', 'Sipari Says', 'Oran']], doc),\r\n            body: transliterateTableData(statusData, doc),\r\n            margin: { left: mar, right: mar },\r\n            tableWidth: tableWidth,\r\n            willDrawCell: createWillDrawCell(doc),\r\n            ...tableStyles,\r\n            columnStyles: {\r\n                0: { cellWidth: tableWidth * 0.50, halign: \"left\", overflow: 'linebreak' },\r\n                1: { cellWidth: tableWidth * 0.25, halign: \"right\", fontStyle: \"bold\" },\r\n                2: { cellWidth: tableWidth * 0.25, halign: \"right\", fontStyle: \"bold\", textColor: [107, 114, 128] },\r\n            },\r\n        });\r\n\r\n        const tableEndY = doc.lastAutoTable?.finalY;\r\n        if (tableEndY && tableEndY > currentY) {\r\n            currentY = tableEndY + PDF_CONSTANTS.tableSpacing;\r\n        } else {\r\n            currentY += PDF_CONSTANTS.tableSpacing;\r\n        }\r\n    }\r\n\r\n    if (data.topProducts && data.topProducts.length > 0) {\r\n        const pageWidthProd = doc.internal.pageSize.getWidth();\r\n        const tableWidthProd = pageWidthProd - (mar * 2);\r\n\r\n        currentY = ensureSpace(doc, currentY, 200, mar, \"En ok retilen rnler\");\r\n        currentY = drawProfessionalTableHeader(doc, mar, currentY, tableWidthProd, {\r\n            title: \"En ok retilen rnler\",\r\n            backgroundColor: [249, 250, 251],\r\n            textColor: PDF_CONSTANTS.primaryColor,\r\n            borderColor: PDF_CONSTANTS.primaryColor,\r\n        });\r\n\r\n        const topProductsData = data.topProducts?.slice(0, 10).map((p, index: number) => [\r\n            `#${index + 1}`,\r\n            p.name || '-',\r\n            safeNumber(p.quantity).toString(),\r\n            safeNumber(p.orders).toString()\r\n        ]);\r\n\r\n        const totalQuantity = data.topProducts?.slice(0, 10).reduce((sum: number, p) => sum + safeNumber(p.quantity), 0) || 0;\r\n        const totalOrdersProd = data.topProducts?.slice(0, 10).reduce((sum: number, p) => sum + safeNumber(p.orders), 0) || 0;\r\n        topProductsData.push([\r\n            'TOPLAM',\r\n            '',\r\n            totalQuantity.toString(),\r\n            totalOrdersProd.toString()\r\n        ]);\r\n\r\n        const tableStyles2 = createProfessionalTableStyles(doc, {\r\n            headerFontSize: 12,\r\n            bodyFontSize: 11,\r\n            cellPadding: { top: 12, right: 14, bottom: 12, left: 14 }\r\n        });\r\n        tableStyles2.headStyles.fillColor = [59, 130, 246];\r\n        tableStyles2.headStyles.textColor = [255, 255, 255];\r\n        tableStyles2.headStyles.halign = \"center\" as const;\r\n        tableStyles2.bodyStyles.overflow = 'linebreak';\r\n        tableStyles2.styles.overflow = 'linebreak';\r\n\r\n        currentY = ensureTableFitsPage(doc, currentY, 200, mar, \"En ok retilen rnler\");\r\n        const currentPageWidth2 = doc.internal.pageSize.getWidth();\r\n        const tableWidth2 = currentPageWidth2 - (mar * 2);\r\n\r\n        forceRobotoFont(doc, \"normal\");\r\n\r\n        autoTable(doc, {\r\n            startY: currentY,\r\n            head: transliterateTableData([['Sra', 'rn Ad', 'Miktar', 'Sipari Says']], doc),\r\n            body: transliterateTableData(topProductsData, doc),\r\n            margin: { left: mar, right: mar },\r\n            tableWidth: tableWidth2,\r\n            willDrawCell: createWillDrawCell(doc),\r\n            ...tableStyles2,\r\n            columnStyles: {\r\n                0: { cellWidth: tableWidth2 * 0.10, halign: \"left\", textColor: [107, 114, 128] },\r\n                1: { cellWidth: tableWidth2 * 0.50, halign: \"left\", overflow: 'linebreak' },\r\n                2: { cellWidth: tableWidth2 * 0.20, halign: \"right\", fontStyle: \"bold\" },\r\n                3: { cellWidth: tableWidth2 * 0.20, halign: \"right\", fontStyle: \"bold\" },\r\n            },\r\n        });\r\n\r\n        const tableEndY = doc.lastAutoTable?.finalY;\r\n        if (tableEndY && tableEndY > currentY) {\r\n            currentY = tableEndY + PDF_CONSTANTS.tableSpacing;\r\n        } else {\r\n            currentY += PDF_CONSTANTS.tableSpacing;\r\n        }\r\n    }\r\n\r\n    if (data.topProducts && data.topProducts.length > 0) {\r\n        currentY = ensureSpace(doc, currentY, 200, mar, \"retim Verimlilii\");\r\n\r\n        const efficiencyData = data.topProducts?.slice(0, 10).map((p, index: number) => {\r\n            const quantity = safeNumber(p.quantity);\r\n            const orders = safeNumber(p.orders);\r\n            const avgPerOrder = orders > 0 ? (quantity / orders).toFixed(1) : \"0\";\r\n            const productName = (p.name || '-').length > 25 ? (p.name || '-').substring(0, 25) + \"...\" : (p.name || '-');\r\n            return [\r\n                `#${index + 1}`,\r\n                productName,\r\n                quantity.toString(),\r\n                orders.toString(),\r\n                avgPerOrder\r\n            ];\r\n        });\r\n\r\n        const pageWidth3 = doc.internal.pageSize.getWidth();\r\n        const tableWidth3 = pageWidth3 - (mar * 2);\r\n\r\n        currentY = ensureSpace(doc, currentY, 200, mar, \"rn Bazl retim Verimlilii\");\r\n        currentY = drawProfessionalTableHeader(doc, mar, currentY, tableWidth3, {\r\n            title: \"rn Bazl retim Verimlilii\",\r\n            backgroundColor: [249, 250, 251],\r\n            textColor: PDF_CONSTANTS.primaryColor,\r\n            borderColor: PDF_CONSTANTS.primaryColor,\r\n        });\r\n\r\n        const tableStyles3 = createProfessionalTableStyles(doc, {\r\n            headerFontSize: 12,\r\n            bodyFontSize: 11,\r\n            cellPadding: { top: 12, right: 14, bottom: 12, left: 14 }\r\n        });\r\n        tableStyles3.headStyles.fillColor = [59, 130, 246];\r\n        tableStyles3.headStyles.textColor = [255, 255, 255];\r\n        tableStyles3.headStyles.halign = \"center\" as const;\r\n        tableStyles3.bodyStyles.overflow = 'linebreak';\r\n        tableStyles3.styles.overflow = 'linebreak';\r\n\r\n        currentY = ensureTableFitsPage(doc, currentY, 200, mar, \"rn Bazl retim Verimlilii\");\r\n        const currentPageWidth3 = doc.internal.pageSize.getWidth();\r\n        const currentTableWidth3 = currentPageWidth3 - (mar * 2);\r\n\r\n        autoTable(doc, {\r\n            startY: currentY,\r\n            head: transliterateTableData([['Sra', 'rn', 'Toplam Miktar', 'Sipari', 'Ortalama/Sipari']], doc),\r\n            body: transliterateTableData(efficiencyData, doc),\r\n            margin: { left: mar, right: mar },\r\n            tableWidth: currentTableWidth3,\r\n            willDrawCell: createWillDrawCell(doc),\r\n            ...tableStyles3,\r\n            columnStyles: {\r\n                0: { cellWidth: currentTableWidth3 * 0.08, halign: \"left\", textColor: [107, 114, 128] },\r\n                1: { cellWidth: currentTableWidth3 * 0.40, halign: \"left\", overflow: 'linebreak' },\r\n                2: { cellWidth: currentTableWidth3 * 0.18, halign: \"right\", fontStyle: \"bold\" },\r\n                3: { cellWidth: currentTableWidth3 * 0.15, halign: \"right\", fontStyle: \"bold\" },\r\n                4: { cellWidth: currentTableWidth3 * 0.19, halign: \"right\", textColor: [107, 114, 128] },\r\n            },\r\n        });\r\n\r\n        const tableEndY = doc.lastAutoTable?.finalY;\r\n        if (tableEndY && tableEndY > currentY) {\r\n            currentY = tableEndY + PDF_CONSTANTS.tableSpacing;\r\n        } else {\r\n            currentY += PDF_CONSTANTS.tableSpacing;\r\n        }\r\n    }\r\n\r\n    currentY = (doc.lastAutoTable?.finalY || currentY) + 50;\r\n    currentY = ensureSpace(doc, currentY, 100, mar, \"zet\");\r\n\r\n    const onHold = safeNumber((data as any).onHold || 0);\r\n    const inProduction = safeNumber((data as any).inProduction || 0);\r\n    const planned = safeNumber(data.statusDistribution?.planned || 0);\r\n    const qualityCheck = safeNumber(data.statusDistribution?.quality_check || 0);\r\n\r\n    const summaryData: Array<[string, string]> = [\r\n        ['Toplam Sipari', totalOrders.toString()],\r\n        ['Tamamlanan', completed.toString()],\r\n        ['Tamamlanma Oran', `${completionRate.toFixed(1)}%`],\r\n        ['Beklemede', onHold.toString()],\r\n        ['retimde', inProduction.toString()],\r\n        ['Planland', planned.toString()],\r\n        ['Kalite Kontrol', qualityCheck.toString()],\r\n        ['En ok retilen rn Says', data.topProducts ? data.topProducts.length.toString() : \"0\"],\r\n    ];\r\n\r\n    currentY = drawSummarySection(doc, mar, currentY, contentWidth, \"Rapor zeti\", summaryData, [37, 99, 235]);\r\n\r\n    try {\r\n        const totalPages = doc.internal.pages.length - 1;\r\n        if (totalPages > 0) {\r\n            for (let i = 1; i <= totalPages; i++) {\r\n                try {\r\n                    doc.setPage(i);\r\n                    const pageTemplate = createPDFTemplate(doc);\r\n                    drawPDFFooter(doc, pageTemplate, i, totalPages);\r\n                } catch (pageError) {\r\n                    // ignore\r\n                }\r\n            }\r\n        }\r\n    } catch (footerError) {\r\n        // ignore\r\n    }\r\n\r\n    try {\r\n        const blob = doc.output('blob');\r\n        if (!blob || blob.size === 0) {\r\n            throw new Error(\"PDF blob bo veya geersiz\");\r\n        }\r\n        return blob;\r\n    } catch (outputError) {\r\n        throw new Error(\"PDF oluturulamad: \" + (outputError instanceof Error ? outputError.message : \"Bilinmeyen hata\"));\r\n    }\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\utils\\auditLogger.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\utils\\backupUtils.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\utils\\currency.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\utils\\errorHandling.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\utils\\errorLogger.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\utils\\formatLastLogin.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":25,"column":114,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":25,"endColumn":117,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[910,913],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[910,913],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":26,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":26,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[974,977],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[974,977],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":34,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":34,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1306,1309],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1306,1309],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":35,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":35,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1369,1372],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1369,1372],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":36,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":36,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1416,1419],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1416,1419],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":36,"column":73,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":36,"endColumn":76,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1455,1458],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1455,1458],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":36,"column":125,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":36,"endColumn":128,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1507,1510],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1507,1510],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":37,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":37,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1581,1584],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1581,1584],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":39,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":39,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1662,1665],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1662,1665],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":44,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":44,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1802,1805],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1802,1805],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":45,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":45,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1875,1878],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1875,1878],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":46,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":46,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1928,1931],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1928,1931],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":46,"column":79,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":46,"endColumn":82,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1971,1974],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1971,1974],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":46,"column":135,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":46,"endColumn":138,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2027,2030],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2027,2030],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":47,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":47,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2111,2114],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2111,2114],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":49,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":49,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2204,2207],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2204,2207],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":58,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":58,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2550,2553],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2550,2553],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":59,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":59,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2615,2618],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2615,2618],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":63,"column":116,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":63,"endColumn":119,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2903,2906],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2903,2906],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":64,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":64,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2978,2981],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2978,2981],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":75,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":75,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3358,3361],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3358,3361],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":142,"column":114,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":142,"endColumn":117,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5617,5620],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5617,5620],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":143,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":143,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5681,5684],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5681,5684],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":151,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":151,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6013,6016],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6013,6016],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":152,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":152,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6076,6079],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6076,6079],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":153,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":153,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6123,6126],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6123,6126],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":153,"column":73,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":153,"endColumn":76,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6162,6165],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6162,6165],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":153,"column":125,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":153,"endColumn":128,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6214,6217],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6214,6217],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":154,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":154,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6288,6291],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6288,6291],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":156,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":156,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6369,6372],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6369,6372],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":161,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":161,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6509,6512],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6509,6512],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":162,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":162,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6582,6585],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6582,6585],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":163,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":163,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6635,6638],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6635,6638],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":163,"column":79,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":163,"endColumn":82,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6678,6681],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6678,6681],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":163,"column":135,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":163,"endColumn":138,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6734,6737],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6734,6737],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":164,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":164,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6818,6821],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6818,6821],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":166,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":166,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6911,6914],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6911,6914],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":175,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":175,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7257,7260],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7257,7260],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":176,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":176,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7322,7325],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7322,7325],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":180,"column":116,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":180,"endColumn":119,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7610,7613],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7610,7613],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":181,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":181,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7685,7688],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7685,7688],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":192,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":192,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8054,8057],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8054,8057],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":42,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { Timestamp } from \"firebase/firestore\";\nimport { format, formatDistanceToNow, isToday, isYesterday } from \"date-fns\";\nimport { tr } from \"date-fns/locale\";\n\n/**\n * Son giri zamann formatlar\n * - 5 dakikadan az ise: \"evrimii\"\n * - 1 saatten az ise: \"X dakika nce\"\n * - 24 saatten az ise: \"X saat nce\" veya \"Bugn HH:mm\"\n * - 24 saatten fazla ise: Tarih formatnda\n */\nexport const formatLastLogin = (lastLoginAt: Timestamp | null | undefined): string => {\n  if (!lastLoginAt) {\n    return \"Hi giri yapmam\";\n  }\n\n  // Timestamp objesi deilse, Timestamp'e evir\n  let loginDate: Date;\n  try {\n    // nce Timestamp instance kontrol\n    if (lastLoginAt instanceof Timestamp) {\n      loginDate = lastLoginAt.toDate();\n    } \n    // Firestore Timestamp objesi (toDate metodu varsa)\n    else if (lastLoginAt && typeof lastLoginAt === 'object' && 'toDate' in lastLoginAt && typeof (lastLoginAt as any).toDate === 'function') {\n      loginDate = (lastLoginAt as any).toDate();\n    } \n    // Timestamp benzeri obje (seconds ve nanoseconds varsa) - Firestore SDK v9+ format\n    else if (lastLoginAt && typeof lastLoginAt === 'object' && 'seconds' in lastLoginAt) {\n      let seconds: number;\n      let nanoseconds: number = 0;\n      \n      // seconds deerini al\n      if (typeof (lastLoginAt as any).seconds === 'number') {\n        seconds = (lastLoginAt as any).seconds;\n      } else if ((lastLoginAt as any).seconds && typeof (lastLoginAt as any).seconds === 'object' && typeof (lastLoginAt as any).seconds.toNumber === 'function') {\n        seconds = (lastLoginAt as any).seconds.toNumber();\n      } else {\n        seconds = Number((lastLoginAt as any).seconds);\n      }\n      \n      // nanoseconds deerini al\n      if ('nanoseconds' in lastLoginAt) {\n        if (typeof (lastLoginAt as any).nanoseconds === 'number') {\n          nanoseconds = (lastLoginAt as any).nanoseconds;\n        } else if ((lastLoginAt as any).nanoseconds && typeof (lastLoginAt as any).nanoseconds === 'object' && typeof (lastLoginAt as any).nanoseconds.toNumber === 'function') {\n          nanoseconds = (lastLoginAt as any).nanoseconds.toNumber();\n        } else {\n          nanoseconds = Number((lastLoginAt as any).nanoseconds) || 0;\n        }\n      }\n      \n      // Timestamp olutur\n      loginDate = new Timestamp(seconds, nanoseconds).toDate();\n    }\n    // _seconds ve _nanoseconds (Firebase SDK internal format)\n    else if (lastLoginAt && typeof lastLoginAt === 'object' && '_seconds' in lastLoginAt) {\n      const seconds = Number((lastLoginAt as any)._seconds);\n      const nanoseconds = Number((lastLoginAt as any)._nanoseconds) || 0;\n      loginDate = new Timestamp(seconds, nanoseconds).toDate();\n    }\n    // Timestamp.fromMillis veya Timestamp.fromDate ile oluturulmu olabilir\n    else if (lastLoginAt && typeof lastLoginAt === 'object' && 'toMillis' in lastLoginAt && typeof (lastLoginAt as any).toMillis === 'function') {\n      loginDate = new Date((lastLoginAt as any).toMillis());\n    }\n    // String veya number ise Date'e evir\n    else if (typeof lastLoginAt === 'string' || typeof lastLoginAt === 'number') {\n      loginDate = new Date(lastLoginAt);\n      if (isNaN(loginDate.getTime())) {\n        return \"Geersiz tarih\";\n      }\n    }\n    // Dier durumlar iin Date'e evirmeyi dene\n    else {\n      loginDate = new Date(lastLoginAt as any);\n      if (isNaN(loginDate.getTime())) {\n        console.error(\"formatLastLogin: Geersiz tarih format\", lastLoginAt);\n        return \"Geersiz tarih\";\n      }\n    }\n  } catch (error) {\n    console.error(\"formatLastLogin error:\", error, \"lastLoginAt:\", lastLoginAt, \"type:\", typeof lastLoginAt);\n    return \"Geersiz tarih\";\n  }\n  const now = new Date();\n  const diffInMs = now.getTime() - loginDate.getTime();\n  const diffInMinutes = Math.floor(diffInMs / (1000 * 60));\n  const diffInSeconds = Math.floor(diffInMs / 1000);\n\n  // 5 dakikadan az ise evrimii say (ama formatLastLogin'de \"evrimii\" yazmayalm, sadece isUserOnline'da kullanlacak)\n  // Bu fonksiyon sadece tarih format dndrr, evrimii kontrol isUserOnline'da yaplr\n  if (diffInMinutes < 1) {\n    return `${diffInSeconds} saniye nce`;\n  }\n\n  // 1 saatten az ise dakika cinsinden gster\n  if (diffInMinutes < 60) {\n    return `${diffInMinutes} dakika nce`;\n  }\n\n  const diffInHours = Math.floor(diffInMinutes / 60);\n\n  // 24 saatten az ise saat cinsinden gster veya bugn ise saat formatnda\n  if (diffInHours < 24) {\n    if (isToday(loginDate)) {\n      return `Bugn ${format(loginDate, \"HH:mm\", { locale: tr })}`;\n    }\n    return `${diffInHours} saat nce`;\n  }\n\n  // 24 saatten fazla ise tarih formatnda gster\n  if (isYesterday(loginDate)) {\n    return `Dn ${format(loginDate, \"HH:mm\", { locale: tr })}`;\n  }\n\n  // 7 gnden az ise gn ad ile gster\n  const diffInDays = Math.floor(diffInHours / 24);\n  if (diffInDays < 7) {\n    return format(loginDate, \"EEEE HH:mm\", { locale: tr });\n  }\n\n  // Daha eski ise tam tarih gster\n  return format(loginDate, \"dd MMMM yyyy HH:mm\", { locale: tr });\n};\n\n/**\n * Kullancnn evrimii olup olmadn kontrol eder\n */\nexport const isUserOnline = (lastLoginAt: Timestamp | null | undefined): boolean => {\n  if (!lastLoginAt) {\n    return false;\n  }\n\n  // Timestamp objesi deilse, Timestamp'e evir\n  let loginDate: Date;\n  try {\n    // nce Timestamp instance kontrol\n    if (lastLoginAt instanceof Timestamp) {\n      loginDate = lastLoginAt.toDate();\n    } \n    // Firestore Timestamp objesi (toDate metodu varsa)\n    else if (lastLoginAt && typeof lastLoginAt === 'object' && 'toDate' in lastLoginAt && typeof (lastLoginAt as any).toDate === 'function') {\n      loginDate = (lastLoginAt as any).toDate();\n    } \n    // Timestamp benzeri obje (seconds ve nanoseconds varsa) - Firestore SDK v9+ format\n    else if (lastLoginAt && typeof lastLoginAt === 'object' && 'seconds' in lastLoginAt) {\n      let seconds: number;\n      let nanoseconds: number = 0;\n      \n      // seconds deerini al\n      if (typeof (lastLoginAt as any).seconds === 'number') {\n        seconds = (lastLoginAt as any).seconds;\n      } else if ((lastLoginAt as any).seconds && typeof (lastLoginAt as any).seconds === 'object' && typeof (lastLoginAt as any).seconds.toNumber === 'function') {\n        seconds = (lastLoginAt as any).seconds.toNumber();\n      } else {\n        seconds = Number((lastLoginAt as any).seconds);\n      }\n      \n      // nanoseconds deerini al\n      if ('nanoseconds' in lastLoginAt) {\n        if (typeof (lastLoginAt as any).nanoseconds === 'number') {\n          nanoseconds = (lastLoginAt as any).nanoseconds;\n        } else if ((lastLoginAt as any).nanoseconds && typeof (lastLoginAt as any).nanoseconds === 'object' && typeof (lastLoginAt as any).nanoseconds.toNumber === 'function') {\n          nanoseconds = (lastLoginAt as any).nanoseconds.toNumber();\n        } else {\n          nanoseconds = Number((lastLoginAt as any).nanoseconds) || 0;\n        }\n      }\n      \n      // Timestamp olutur\n      loginDate = new Timestamp(seconds, nanoseconds).toDate();\n    }\n    // _seconds ve _nanoseconds (Firebase SDK internal format)\n    else if (lastLoginAt && typeof lastLoginAt === 'object' && '_seconds' in lastLoginAt) {\n      const seconds = Number((lastLoginAt as any)._seconds);\n      const nanoseconds = Number((lastLoginAt as any)._nanoseconds) || 0;\n      loginDate = new Timestamp(seconds, nanoseconds).toDate();\n    }\n    // Timestamp.fromMillis veya Timestamp.fromDate ile oluturulmu olabilir\n    else if (lastLoginAt && typeof lastLoginAt === 'object' && 'toMillis' in lastLoginAt && typeof (lastLoginAt as any).toMillis === 'function') {\n      loginDate = new Date((lastLoginAt as any).toMillis());\n    }\n    // String veya number ise Date'e evir\n    else if (typeof lastLoginAt === 'string' || typeof lastLoginAt === 'number') {\n      loginDate = new Date(lastLoginAt);\n      if (isNaN(loginDate.getTime())) {\n        return false;\n      }\n    }\n    // Dier durumlar iin Date'e evirmeyi dene\n    else {\n      loginDate = new Date(lastLoginAt as any);\n      if (isNaN(loginDate.getTime())) {\n        return false;\n      }\n    }\n  } catch (error) {\n    console.error(\"isUserOnline error:\", error, \"lastLoginAt:\", lastLoginAt);\n    return false;\n  }\n  const now = new Date();\n  const diffInMinutes = Math.floor((now.getTime() - loginDate.getTime()) / (1000 * 60));\n\n  return diffInMinutes < 5;\n};\n\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\utils\\permissions.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\utils\\phoneNormalizer.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\utils\\priority.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\utils\\responsive.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\utils\\setSuperAdmin.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\utils\\setTeamLeader.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\utils\\taskHelpers.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\utils\\toastHelpers.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":102,"column":112,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":102,"endColumn":115,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4228,4231],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4228,4231],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Toast Helper Functions\n * Permission hatalar ve dier hatalar iin kullanc dostu toast mesajlar\n */\n\nimport { toast } from \"sonner\";\nimport { isPermissionError } from \"./errorLogger\";\n\n/**\n * lem tr ve kaynak trne gre detayl permission hatas mesaj\n */\nexport const getPermissionErrorMessage = (\n  operation: \"create\" | \"update\" | \"delete\" | \"read\" | \"interact\" | \"assign\" | \"approve\" | \"view\" | \"general\",\n  resource: \"task\" | \"project\" | \"user\" | \"department\" | \"checklist\" | \"attachment\" | \"log\" | \"general\" = \"general\"\n): { title: string; description: string } => {\n  const operationNames: Record<string, string> = {\n    create: \"oluturma\",\n    update: \"gncelleme\",\n    delete: \"silme\",\n    read: \"grntleme\",\n    interact: \"etkileim kurma\",\n    assign: \"atama yapma\",\n    approve: \"onaylama\",\n    view: \"grntleme\",\n  };\n\n  const resourceNames: Record<string, string> = {\n    task: \"grev\",\n    project: \"proje\",\n    user: \"kullanc\",\n    department: \"departman\",\n    checklist: \"checklist\",\n    attachment: \"ek\",\n    log: \"log\",\n    general: \"bu ilem\",\n  };\n\n  const operationName = operationNames[operation] || operation;\n  const resourceName = resourceNames[resource] || resource;\n\n  const title = \"Yetkiniz Bulunmuyor\";\n  let description = \"\";\n\n  switch (operation) {\n    case \"create\":\n      description = `${resourceName.charAt(0).toUpperCase() + resourceName.slice(1)} ${operationName} yetkiniz bulunmuyor. Bu ilem iin ekip lideri veya ynetici ile iletiime gein.`;\n      break;\n    case \"update\":\n      description = `${resourceName.charAt(0).toUpperCase() + resourceName.slice(1)} ${operationName} yetkiniz bulunmuyor. Sadece size atanan ${resourceName}leri veya oluturduunuz ${resourceName}leri gncelleyebilirsiniz.`;\n      break;\n    case \"delete\":\n      description = `${resourceName.charAt(0).toUpperCase() + resourceName.slice(1)} ${operationName} yetkiniz bulunmuyor. Bu ilem iin ekip lideri veya ynetici ile iletiime gein.`;\n      break;\n    case \"read\":\n    case \"view\":\n      description = `${resourceName.charAt(0).toUpperCase() + resourceName.slice(1)} ${operationName} yetkiniz bulunmuyor. Sadece size atanan veya oluturduunuz ${resourceName}leri grebilirsiniz.`;\n      break;\n    case \"interact\":\n      if (resource === \"task\") {\n        description = \"Bu grevle etkileim kurma yetkiniz bulunmuyor. Sadece size atanan grevlerin durumunu deitirebilir, checklist elerini iaretleyebilirsiniz.\";\n      } else {\n        description = `${resourceName.charAt(0).toUpperCase() + resourceName.slice(1)} ile ${operationName} yetkiniz bulunmuyor. Sadece size atanan ${resourceName}lerle etkileim kurabilirsiniz.`;\n      }\n      break;\n    case \"assign\":\n      description = `${resourceName.charAt(0).toUpperCase() + resourceName.slice(1)} atama yetkiniz bulunmuyor. Bu ilem iin ekip lideri veya ynetici ile iletiime gein.`;\n      break;\n    case \"approve\":\n      description = `${resourceName.charAt(0).toUpperCase() + resourceName.slice(1)} onaylama yetkiniz bulunmuyor. Bu ilem iin ekip lideri veya ynetici ile iletiime gein.`;\n      break;\n    default:\n      description = \"Bu ilem iin yetkiniz bulunmuyor. Ltfen ekip lideri veya ynetici ile iletiime gein.\";\n  }\n\n  return { title, description };\n};\n\n/**\n * Permission hatas iin toast gster\n */\nexport const showPermissionErrorToast = (\n  operation?: \"create\" | \"update\" | \"delete\" | \"read\" | \"interact\" | \"assign\" | \"approve\" | \"view\",\n  resource?: \"task\" | \"project\" | \"user\" | \"department\" | \"checklist\" | \"attachment\" | \"log\" | \"general\"\n) => {\n  const { title, description } = getPermissionErrorMessage(operation || \"general\", resource || \"general\");\n\n  toast.error(title, {\n    description,\n    duration: 7000,\n  });\n};\n\n/**\n * Hata mesajn kontrol et ve uygun toast gster\n */\nexport const handleErrorToast = (\n  error: unknown,\n  defaultMessage?: string,\n  operation?: \"create\" | \"update\" | \"delete\" | \"read\" | \"interact\" | \"assign\" | \"approve\" | \"view\",\n  resource?: \"task\" | \"project\" | \"user\" | \"department\" | \"checklist\" | \"attachment\" | \"log\" | \"general\"\n) => {\n  const errorMessage = error instanceof Error ? error.message : (typeof error === 'string' ? error : (error as any)?.message || error?.toString() || defaultMessage || \"Bilinmeyen hata\");\n\n  // Permission hatas kontrol\n  if (\n    isPermissionError(error) ||\n    errorMessage.includes(\"Yetkiniz yok\") ||\n    errorMessage.includes(\"yetkiniz bulunmuyor\") ||\n    errorMessage.includes(\"yetkiniz yok\") ||\n    errorMessage.includes(\"Missing or insufficient permissions\") ||\n    errorMessage.includes(\"permission-denied\")\n  ) {\n    showPermissionErrorToast(operation, resource);\n    return;\n  }\n\n  // Dier hatalar iin normal toast\n  toast.error(errorMessage);\n};\n\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\utils\\validateTeamLeader.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\src\\vite-env.d.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\tailwind.config.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\vite-plugin-csp.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aslan\\Downloads\\revium-erp-suite-main\\revium-erp-suite-main\\vite.config.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]}]